/*! For license information please see main.36d72781.js.LICENSE.txt */
(()=>{var e={4445:(e,t)=>{"use strict";t.byteLength=function(e){var t=s(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,i=s(e),o=i[0],c=i[1],u=new a(function(e,t,n){return 3*(t+n)/4-n}(0,o,c)),l=0,f=c>0?o-4:o;for(n=0;n<f;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],u[l++]=t>>16&255,u[l++]=t>>8&255,u[l++]=255&t;2===c&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,u[l++]=255&t);1===c&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,u[l++]=t>>8&255,u[l++]=255&t);return u},t.fromByteArray=function(e){for(var t,r=e.length,a=r%3,i=[],o=16383,s=0,u=r-a;s<u;s+=o)i.push(c(e,s,s+o>u?u:s+o));1===a?(t=e[r-1],i.push(n[t>>2]+n[t<<4&63]+"==")):2===a&&(t=(e[r-2]<<8)+e[r-1],i.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return i.join("")};for(var n=[],r=[],a="undefined"!==typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0;o<64;++o)n[o]=i[o],r[i.charCodeAt(o)]=o;function s(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function c(e,t,r){for(var a,i,o=[],s=t;s<r;s+=3)a=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(n[(i=a)>>18&63]+n[i>>12&63]+n[i>>6&63]+n[63&i]);return o.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},6382:(e,t,n)=>{"use strict";const r=n(4445),a=n(6900),i="function"===typeof Symbol&&"function"===typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50;const o=2147483647;function s(e){if(e>o)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,c.prototype),t}function c(e,t,n){if("number"===typeof e){if("string"===typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return f(e)}return u(e,t,n)}function u(e,t,n){if("string"===typeof e)return function(e,t){"string"===typeof t&&""!==t||(t="utf8");if(!c.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const n=0|g(e,t);let r=s(n);const a=r.write(e,t);a!==n&&(r=r.slice(0,a));return r}(e,t);if(ArrayBuffer.isView(e))return function(e){if(K(e,Uint8Array)){const t=new Uint8Array(e);return h(t.buffer,t.byteOffset,t.byteLength)}return d(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(K(e,ArrayBuffer)||e&&K(e.buffer,ArrayBuffer))return h(e,t,n);if("undefined"!==typeof SharedArrayBuffer&&(K(e,SharedArrayBuffer)||e&&K(e.buffer,SharedArrayBuffer)))return h(e,t,n);if("number"===typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return c.from(r,t,n);const a=function(e){if(c.isBuffer(e)){const t=0|p(e.length),n=s(t);return 0===n.length||e.copy(n,0,0,t),n}if(void 0!==e.length)return"number"!==typeof e.length||Q(e.length)?s(0):d(e);if("Buffer"===e.type&&Array.isArray(e.data))return d(e.data)}(e);if(a)return a;if("undefined"!==typeof Symbol&&null!=Symbol.toPrimitive&&"function"===typeof e[Symbol.toPrimitive])return c.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function l(e){if("number"!==typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function f(e){return l(e),s(e<0?0:0|p(e))}function d(e){const t=e.length<0?0:0|p(e.length),n=s(t);for(let r=0;r<t;r+=1)n[r]=255&e[r];return n}function h(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');let r;return r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(r,c.prototype),r}function p(e){if(e>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function g(e,t){if(c.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||K(e,ArrayBuffer))return e.byteLength;if("string"!==typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;let a=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return Y(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return X(e).length;default:if(a)return r?-1:Y(e).length;t=(""+t).toLowerCase(),a=!0}}function m(e,t,n){let r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return N(this,t,n);case"utf8":case"utf-8":return E(this,t,n);case"ascii":return I(this,t,n);case"latin1":case"binary":return k(this,t,n);case"base64":return _(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return L(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function v(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function b(e,t,n,r,a){if(0===e.length)return-1;if("string"===typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),Q(n=+n)&&(n=a?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(a)return-1;n=e.length-1}else if(n<0){if(!a)return-1;n=0}if("string"===typeof t&&(t=c.from(t,r)),c.isBuffer(t))return 0===t.length?-1:y(e,t,n,r,a);if("number"===typeof t)return t&=255,"function"===typeof Uint8Array.prototype.indexOf?a?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):y(e,[t],n,r,a);throw new TypeError("val must be string, number or Buffer")}function y(e,t,n,r,a){let i,o=1,s=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,s/=2,c/=2,n/=2}function u(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(a){let r=-1;for(i=n;i<s;i++)if(u(e,i)===u(t,-1===r?0:i-r)){if(-1===r&&(r=i),i-r+1===c)return r*o}else-1!==r&&(i-=i-r),r=-1}else for(n+c>s&&(n=s-c),i=n;i>=0;i--){let n=!0;for(let r=0;r<c;r++)if(u(e,i+r)!==u(t,r)){n=!1;break}if(n)return i}return-1}function x(e,t,n,r){n=Number(n)||0;const a=e.length-n;r?(r=Number(r))>a&&(r=a):r=a;const i=t.length;let o;for(r>i/2&&(r=i/2),o=0;o<r;++o){const r=parseInt(t.substr(2*o,2),16);if(Q(r))return o;e[n+o]=r}return o}function w(e,t,n,r){return q(Y(t,e.length-n),e,n,r)}function S(e,t,n,r){return q(function(e){const t=[];for(let n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function C(e,t,n,r){return q(X(t),e,n,r)}function M(e,t,n,r){return q(function(e,t){let n,r,a;const i=[];for(let o=0;o<e.length&&!((t-=2)<0);++o)n=e.charCodeAt(o),r=n>>8,a=n%256,i.push(a),i.push(r);return i}(t,e.length-n),e,n,r)}function _(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function E(e,t,n){n=Math.min(e.length,n);const r=[];let a=t;for(;a<n;){const t=e[a];let i=null,o=t>239?4:t>223?3:t>191?2:1;if(a+o<=n){let n,r,s,c;switch(o){case 1:t<128&&(i=t);break;case 2:n=e[a+1],128===(192&n)&&(c=(31&t)<<6|63&n,c>127&&(i=c));break;case 3:n=e[a+1],r=e[a+2],128===(192&n)&&128===(192&r)&&(c=(15&t)<<12|(63&n)<<6|63&r,c>2047&&(c<55296||c>57343)&&(i=c));break;case 4:n=e[a+1],r=e[a+2],s=e[a+3],128===(192&n)&&128===(192&r)&&128===(192&s)&&(c=(15&t)<<18|(63&n)<<12|(63&r)<<6|63&s,c>65535&&c<1114112&&(i=c))}}null===i?(i=65533,o=1):i>65535&&(i-=65536,r.push(i>>>10&1023|55296),i=56320|1023&i),r.push(i),a+=o}return function(e){const t=e.length;if(t<=T)return String.fromCharCode.apply(String,e);let n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=T));return n}(r)}t.kMaxLength=o,c.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),c.TYPED_ARRAY_SUPPORT||"undefined"===typeof console||"function"!==typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}}),c.poolSize=8192,c.from=function(e,t,n){return u(e,t,n)},Object.setPrototypeOf(c.prototype,Uint8Array.prototype),Object.setPrototypeOf(c,Uint8Array),c.alloc=function(e,t,n){return function(e,t,n){return l(e),e<=0?s(e):void 0!==t?"string"===typeof n?s(e).fill(t,n):s(e).fill(t):s(e)}(e,t,n)},c.allocUnsafe=function(e){return f(e)},c.allocUnsafeSlow=function(e){return f(e)},c.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==c.prototype},c.compare=function(e,t){if(K(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),K(t,Uint8Array)&&(t=c.from(t,t.offset,t.byteLength)),!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,r=t.length;for(let a=0,i=Math.min(n,r);a<i;++a)if(e[a]!==t[a]){n=e[a],r=t[a];break}return n<r?-1:r<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);let n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;const r=c.allocUnsafe(t);let a=0;for(n=0;n<e.length;++n){let t=e[n];if(K(t,Uint8Array))a+t.length>r.length?(c.isBuffer(t)||(t=c.from(t)),t.copy(r,a)):Uint8Array.prototype.set.call(r,t,a);else{if(!c.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(r,a)}a+=t.length}return r},c.byteLength=g,c.prototype._isBuffer=!0,c.prototype.swap16=function(){const e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)v(this,t,t+1);return this},c.prototype.swap32=function(){const e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},c.prototype.swap64=function(){const e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},c.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?E(this,0,e):m.apply(this,arguments)},c.prototype.toLocaleString=c.prototype.toString,c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){let e="";const n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},i&&(c.prototype[i]=c.prototype.inspect),c.prototype.compare=function(e,t,n,r,a){if(K(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),!c.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===a&&(a=this.length),t<0||n>e.length||r<0||a>this.length)throw new RangeError("out of range index");if(r>=a&&t>=n)return 0;if(r>=a)return-1;if(t>=n)return 1;if(this===e)return 0;let i=(a>>>=0)-(r>>>=0),o=(n>>>=0)-(t>>>=0);const s=Math.min(i,o),u=this.slice(r,a),l=e.slice(t,n);for(let c=0;c<s;++c)if(u[c]!==l[c]){i=u[c],o=l[c];break}return i<o?-1:o<i?1:0},c.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return b(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return b(this,e,t,n,!1)},c.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"===typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}const a=this.length-t;if((void 0===n||n>a)&&(n=a),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");let i=!1;for(;;)switch(r){case"hex":return x(this,e,t,n);case"utf8":case"utf-8":return w(this,e,t,n);case"ascii":case"latin1":case"binary":return S(this,e,t,n);case"base64":return C(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,e,t,n);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),i=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const T=4096;function I(e,t,n){let r="";n=Math.min(e.length,n);for(let a=t;a<n;++a)r+=String.fromCharCode(127&e[a]);return r}function k(e,t,n){let r="";n=Math.min(e.length,n);for(let a=t;a<n;++a)r+=String.fromCharCode(e[a]);return r}function N(e,t,n){const r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);let a="";for(let i=t;i<n;++i)a+=J[e[i]];return a}function L(e,t,n){const r=e.slice(t,n);let a="";for(let i=0;i<r.length-1;i+=2)a+=String.fromCharCode(r[i]+256*r[i+1]);return a}function A(e,t,n){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function R(e,t,n,r,a,i){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>a||t<i)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function D(e,t,n,r,a){W(t,r,a,e,n,7);let i=Number(t&BigInt(4294967295));e[n++]=i,i>>=8,e[n++]=i,i>>=8,e[n++]=i,i>>=8,e[n++]=i;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,n}function O(e,t,n,r,a){W(t,r,a,e,n,7);let i=Number(t&BigInt(4294967295));e[n+7]=i,i>>=8,e[n+6]=i,i>>=8,e[n+5]=i,i>>=8,e[n+4]=i;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[n+3]=o,o>>=8,e[n+2]=o,o>>=8,e[n+1]=o,o>>=8,e[n]=o,n+8}function P(e,t,n,r,a,i){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function F(e,t,n,r,i){return t=+t,n>>>=0,i||P(e,0,n,4),a.write(e,t,n,r,23,4),n+4}function z(e,t,n,r,i){return t=+t,n>>>=0,i||P(e,0,n,8),a.write(e,t,n,r,52,8),n+8}c.prototype.slice=function(e,t){const n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);const r=this.subarray(e,t);return Object.setPrototypeOf(r,c.prototype),r},c.prototype.readUintLE=c.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||A(e,t,this.length);let r=this[e],a=1,i=0;for(;++i<t&&(a*=256);)r+=this[e+i]*a;return r},c.prototype.readUintBE=c.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||A(e,t,this.length);let r=this[e+--t],a=1;for(;t>0&&(a*=256);)r+=this[e+--t]*a;return r},c.prototype.readUint8=c.prototype.readUInt8=function(e,t){return e>>>=0,t||A(e,1,this.length),this[e]},c.prototype.readUint16LE=c.prototype.readUInt16LE=function(e,t){return e>>>=0,t||A(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUint16BE=c.prototype.readUInt16BE=function(e,t){return e>>>=0,t||A(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUint32LE=c.prototype.readUInt32LE=function(e,t){return e>>>=0,t||A(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUint32BE=c.prototype.readUInt32BE=function(e,t){return e>>>=0,t||A(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readBigUInt64LE=Z((function(e){G(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||V(e,this.length-8);const r=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,a=this[++e]+256*this[++e]+65536*this[++e]+n*2**24;return BigInt(r)+(BigInt(a)<<BigInt(32))})),c.prototype.readBigUInt64BE=Z((function(e){G(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||V(e,this.length-8);const r=t*2**24+65536*this[++e]+256*this[++e]+this[++e],a=this[++e]*2**24+65536*this[++e]+256*this[++e]+n;return(BigInt(r)<<BigInt(32))+BigInt(a)})),c.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||A(e,t,this.length);let r=this[e],a=1,i=0;for(;++i<t&&(a*=256);)r+=this[e+i]*a;return a*=128,r>=a&&(r-=Math.pow(2,8*t)),r},c.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||A(e,t,this.length);let r=t,a=1,i=this[e+--r];for(;r>0&&(a*=256);)i+=this[e+--r]*a;return a*=128,i>=a&&(i-=Math.pow(2,8*t)),i},c.prototype.readInt8=function(e,t){return e>>>=0,t||A(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){e>>>=0,t||A(e,2,this.length);const n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(e,t){e>>>=0,t||A(e,2,this.length);const n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(e,t){return e>>>=0,t||A(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return e>>>=0,t||A(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readBigInt64LE=Z((function(e){G(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||V(e,this.length-8);const r=this[e+4]+256*this[e+5]+65536*this[e+6]+(n<<24);return(BigInt(r)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)})),c.prototype.readBigInt64BE=Z((function(e){G(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||V(e,this.length-8);const r=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(r)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+n)})),c.prototype.readFloatLE=function(e,t){return e>>>=0,t||A(e,4,this.length),a.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return e>>>=0,t||A(e,4,this.length),a.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return e>>>=0,t||A(e,8,this.length),a.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return e>>>=0,t||A(e,8,this.length),a.read(this,e,!1,52,8)},c.prototype.writeUintLE=c.prototype.writeUIntLE=function(e,t,n,r){if(e=+e,t>>>=0,n>>>=0,!r){R(this,e,t,n,Math.pow(2,8*n)-1,0)}let a=1,i=0;for(this[t]=255&e;++i<n&&(a*=256);)this[t+i]=e/a&255;return t+n},c.prototype.writeUintBE=c.prototype.writeUIntBE=function(e,t,n,r){if(e=+e,t>>>=0,n>>>=0,!r){R(this,e,t,n,Math.pow(2,8*n)-1,0)}let a=n-1,i=1;for(this[t+a]=255&e;--a>=0&&(i*=256);)this[t+a]=e/i&255;return t+n},c.prototype.writeUint8=c.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,1,255,0),this[t]=255&e,t+1},c.prototype.writeUint16LE=c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeUint16BE=c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeUint32LE=c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},c.prototype.writeUint32BE=c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeBigUInt64LE=Z((function(e){return D(this,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,BigInt(0),BigInt("0xffffffffffffffff"))})),c.prototype.writeBigUInt64BE=Z((function(e){return O(this,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,BigInt(0),BigInt("0xffffffffffffffff"))})),c.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){const r=Math.pow(2,8*n-1);R(this,e,t,n,r-1,-r)}let a=0,i=1,o=0;for(this[t]=255&e;++a<n&&(i*=256);)e<0&&0===o&&0!==this[t+a-1]&&(o=1),this[t+a]=(e/i|0)-o&255;return t+n},c.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){const r=Math.pow(2,8*n-1);R(this,e,t,n,r-1,-r)}let a=n-1,i=1,o=0;for(this[t+a]=255&e;--a>=0&&(i*=256);)e<0&&0===o&&0!==this[t+a+1]&&(o=1),this[t+a]=(e/i|0)-o&255;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeBigInt64LE=Z((function(e){return D(this,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),c.prototype.writeBigInt64BE=Z((function(e){return O(this,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),c.prototype.writeFloatLE=function(e,t,n){return F(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return F(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return z(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return z(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,r){if(!c.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);const a=r-n;return this===e&&"function"===typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,r):Uint8Array.prototype.set.call(e,this.subarray(n,r),t),a},c.prototype.fill=function(e,t,n,r){if("string"===typeof e){if("string"===typeof t?(r=t,t=0,n=this.length):"string"===typeof n&&(r=n,n=this.length),void 0!==r&&"string"!==typeof r)throw new TypeError("encoding must be a string");if("string"===typeof r&&!c.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){const t=e.charCodeAt(0);("utf8"===r&&t<128||"latin1"===r)&&(e=t)}}else"number"===typeof e?e&=255:"boolean"===typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;let a;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"===typeof e)for(a=t;a<n;++a)this[a]=e;else{const i=c.isBuffer(e)?e:c.from(e,r),o=i.length;if(0===o)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(a=0;a<n-t;++a)this[a+t]=i[a%o]}return this};const j={};function B(e,t,n){j[e]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name="".concat(this.name," [").concat(e,"]"),this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return"".concat(this.name," [").concat(e,"]: ").concat(this.message)}}}function U(e){let t="",n=e.length;const r="-"===e[0]?1:0;for(;n>=r+4;n-=3)t="_".concat(e.slice(n-3,n)).concat(t);return"".concat(e.slice(0,n)).concat(t)}function W(e,t,n,r,a,i){if(e>n||e<t){const r="bigint"===typeof t?"n":"";let a;throw a=i>3?0===t||t===BigInt(0)?">= 0".concat(r," and < 2").concat(r," ** ").concat(8*(i+1)).concat(r):">= -(2".concat(r," ** ").concat(8*(i+1)-1).concat(r,") and < 2 ** ")+"".concat(8*(i+1)-1).concat(r):">= ".concat(t).concat(r," and <= ").concat(n).concat(r),new j.ERR_OUT_OF_RANGE("value",a,e)}!function(e,t,n){G(t,"offset"),void 0!==e[t]&&void 0!==e[t+n]||V(t,e.length-(n+1))}(r,a,i)}function G(e,t){if("number"!==typeof e)throw new j.ERR_INVALID_ARG_TYPE(t,"number",e)}function V(e,t,n){if(Math.floor(e)!==e)throw G(e,n),new j.ERR_OUT_OF_RANGE(n||"offset","an integer",e);if(t<0)throw new j.ERR_BUFFER_OUT_OF_BOUNDS;throw new j.ERR_OUT_OF_RANGE(n||"offset",">= ".concat(n?1:0," and <= ").concat(t),e)}B("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?"".concat(e," is outside of buffer bounds"):"Attempt to access memory outside buffer bounds"}),RangeError),B("ERR_INVALID_ARG_TYPE",(function(e,t){return'The "'.concat(e,'" argument must be of type number. Received type ').concat(typeof t)}),TypeError),B("ERR_OUT_OF_RANGE",(function(e,t,n){let r='The value of "'.concat(e,'" is out of range.'),a=n;return Number.isInteger(n)&&Math.abs(n)>2**32?a=U(String(n)):"bigint"===typeof n&&(a=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(a=U(a)),a+="n"),r+=" It must be ".concat(t,". Received ").concat(a),r}),RangeError);const H=/[^+/0-9A-Za-z-_]/g;function Y(e,t){let n;t=t||1/0;const r=e.length;let a=null;const i=[];for(let o=0;o<r;++o){if(n=e.charCodeAt(o),n>55295&&n<57344){if(!a){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&i.push(239,191,189);continue}a=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),a=n;continue}n=65536+(a-55296<<10|n-56320)}else a&&(t-=3)>-1&&i.push(239,191,189);if(a=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function X(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(H,"")).length<2)return"";for(;e.length%4!==0;)e+="=";return e}(e))}function q(e,t,n,r){let a;for(a=0;a<r&&!(a+n>=t.length||a>=e.length);++a)t[a+n]=e[a];return a}function K(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function Q(e){return e!==e}const J=function(){const e="0123456789abcdef",t=new Array(256);for(let n=0;n<16;++n){const r=16*n;for(let a=0;a<16;++a)t[r+a]=e[n]+e[a]}return t}();function Z(e){return"undefined"===typeof BigInt?$:e}function $(){throw new Error("BigInt not supported")}},6522:(e,t,n)=>{var r=n(2285);t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,a=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(a=r))})),t.splice(a,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(n){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(n){}!e&&"undefined"!==typeof r&&"env"in r&&(e={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.DEBUG);return e},t.useColors=function(){if("undefined"!==typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return"undefined"!==typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!==typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!==typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=n(5237)(t);const{formatters:a}=e.exports;a.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}},5237:(e,t,n)=>{e.exports=function(e){function t(e){let n,a,i,o=null;function s(){for(var e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];if(!s.enabled)return;const i=s,o=Number(new Date),c=o-(n||o);i.diff=c,i.prev=n,i.curr=o,n=o,r[0]=t.coerce(r[0]),"string"!==typeof r[0]&&r.unshift("%O");let u=0;r[0]=r[0].replace(/%([a-zA-Z%])/g,((e,n)=>{if("%%"===e)return"%";u++;const a=t.formatters[n];if("function"===typeof a){const t=r[u];e=a.call(i,t),r.splice(u,1),u--}return e})),t.formatArgs.call(i,r);(i.log||t.log).apply(i,r)}return s.namespace=e,s.useColors=t.useColors(),s.color=t.selectColor(e),s.extend=r,s.destroy=t.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(a!==t.namespaces&&(a=t.namespaces,i=t.enabled(e)),i),set:e=>{o=e}}),"function"===typeof t.init&&t.init(s),s}function r(e,n){const r=t(this.namespace+("undefined"===typeof n?":":n)+e);return r.log=this.log,r}function a(e,t){let n=0,r=0,a=-1,i=0;for(;n<e.length;)if(r<t.length&&(t[r]===e[n]||"*"===t[r]))"*"===t[r]?(a=r,i=n,r++):(n++,r++);else{if(-1===a)return!1;r=a+1,i++,n=i}for(;r<t.length&&"*"===t[r];)r++;return r===t.length}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names,...t.skips.map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"===typeof e?e:"").trim().replace(" ",",").split(",").filter(Boolean);for(const r of n)"-"===r[0]?t.skips.push(r.slice(1)):t.names.push(r)},t.enabled=function(e){for(const n of t.skips)if(a(e,n))return!1;for(const n of t.names)if(a(e,n))return!0;return!1},t.humanize=n(7340),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((n=>{t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t}},4823:e=>{"use strict";function t(e,t){for(const n in t)Object.defineProperty(e,n,{value:t[n],enumerable:!0,configurable:!0});return e}e.exports=function(e,n,r){if(!e||"string"===typeof e)throw new TypeError("Please pass an Error to err-code");r||(r={}),"object"===typeof n&&(r=n,n=""),n&&(r.code=n);try{return t(e,r)}catch(a){r.message=e.message,r.stack=e.stack;const n=function(){};n.prototype=Object.create(Object.getPrototypeOf(e));return t(new n,r)}}},7284:e=>{"use strict";var t,n="object"===typeof Reflect?Reflect:null,r=n&&"function"===typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"===typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!==e};function i(){i.init.call(this)}e.exports=i,e.exports.once=function(e,t){return new Promise((function(n,r){function a(n){e.removeListener(t,i),r(n)}function i(){"function"===typeof e.removeListener&&e.removeListener("error",a),n([].slice.call(arguments))}g(e,t,i,{once:!0}),"error"!==t&&function(e,t,n){"function"===typeof e.on&&g(e,"error",t,n)}(e,a,{once:!0})}))},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var o=10;function s(e){if("function"!==typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?i.defaultMaxListeners:e._maxListeners}function u(e,t,n,r){var a,i,o,u;if(s(n),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events),o=i[t]),void 0===o)o=i[t]=n,++e._eventsCount;else if("function"===typeof o?o=i[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),(a=c(e))>0&&o.length>a&&!o.warned){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=o.length,u=l,console&&console.warn&&console.warn(u)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},a=l.bind(r);return a.listener=n,r.wrapFn=a,a}function d(e,t,n){var r=e._events;if(void 0===r)return[];var a=r[t];return void 0===a?[]:"function"===typeof a?n?[a.listener||a]:[a]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(a):p(a,a.length)}function h(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"===typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function g(e,t,n,r){if("function"===typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!==typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function a(i){r.once&&e.removeEventListener(t,a),n(i)}))}}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!==typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),i.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(e){if("number"!==typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},i.prototype.getMaxListeners=function(){return c(this)},i.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var a="error"===e,i=this._events;if(void 0!==i)a=a&&void 0===i.error;else if(!a)return!1;if(a){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var c=i[e];if(void 0===c)return!1;if("function"===typeof c)r(c,this,t);else{var u=c.length,l=p(c,u);for(n=0;n<u;++n)r(l[n],this,t)}return!0},i.prototype.addListener=function(e,t){return u(this,e,t,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(e,t){return u(this,e,t,!0)},i.prototype.once=function(e,t){return s(t),this.on(e,f(this,e,t)),this},i.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,f(this,e,t)),this},i.prototype.removeListener=function(e,t){var n,r,a,i,o;if(s(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!==typeof n){for(a=-1,i=n.length-1;i>=0;i--)if(n[i]===t||n[i].listener===t){o=n[i].listener,a=i;break}if(a<0)return this;0===a?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,a),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,o||t)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var a,i=Object.keys(n);for(r=0;r<i.length;++r)"removeListener"!==(a=i[r])&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},i.prototype.listeners=function(e){return d(this,e,!0)},i.prototype.rawListeners=function(e){return d(this,e,!1)},i.listenerCount=function(e,t){return"function"===typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},i.prototype.listenerCount=h,i.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},7919:e=>{e.exports=function(){if("undefined"===typeof globalThis)return null;var e={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null}},6900:(e,t)=>{t.read=function(e,t,n,r,a){var i,o,s=8*a-r-1,c=(1<<s)-1,u=c>>1,l=-7,f=n?a-1:0,d=n?-1:1,h=e[t+f];for(f+=d,i=h&(1<<-l)-1,h>>=-l,l+=s;l>0;i=256*i+e[t+f],f+=d,l-=8);for(o=i&(1<<-l)-1,i>>=-l,l+=r;l>0;o=256*o+e[t+f],f+=d,l-=8);if(0===i)i=1-u;else{if(i===c)return o?NaN:1/0*(h?-1:1);o+=Math.pow(2,r),i-=u}return(h?-1:1)*o*Math.pow(2,i-r)},t.write=function(e,t,n,r,a,i){var o,s,c,u=8*i-a-1,l=(1<<u)-1,f=l>>1,d=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:i-1,p=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),(t+=o+f>=1?d/c:d*Math.pow(2,1-f))*c>=2&&(o++,c/=2),o+f>=l?(s=0,o=l):o+f>=1?(s=(t*c-1)*Math.pow(2,a),o+=f):(s=t*Math.pow(2,f-1)*Math.pow(2,a),o=0));a>=8;e[n+h]=255&s,h+=p,s/=256,a-=8);for(o=o<<a|s,u+=a;u>0;e[n+h]=255&o,h+=p,o/=256,u-=8);e[n+h-p]|=128*g}},6329:e=>{"function"===typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},7353:e=>{e.exports=n;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(_){}function n(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function r(e){return!0===(e&&e.__isLong__)}n.prototype.__isLong__,Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=r;var a={},i={};function o(e,t){var n,r,o;return t?(o=0<=(e>>>=0)&&e<256)&&(r=i[e])?r:(n=c(e,(0|e)<0?-1:0,!0),o&&(i[e]=n),n):(o=-128<=(e|=0)&&e<128)&&(r=a[e])?r:(n=c(e,e<0?-1:0,!1),o&&(a[e]=n),n)}function s(e,t){if(isNaN(e))return t?v:m;if(t){if(e<0)return v;if(e>=h)return S}else{if(e<=-p)return C;if(e+1>=p)return w}return e<0?s(-e,t).neg():c(e%d|0,e/d|0,t)}function c(e,t,r){return new n(e,t,r)}n.fromInt=o,n.fromNumber=s,n.fromBits=c;var u=Math.pow;function l(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return m;if("number"===typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return l(e.substring(1),t,n).neg();for(var a=s(u(n,8)),i=m,o=0;o<e.length;o+=8){var c=Math.min(8,e.length-o),f=parseInt(e.substring(o,o+c),n);if(c<8){var d=s(u(n,c));i=i.mul(d).add(s(f))}else i=(i=i.mul(a)).add(s(f))}return i.unsigned=t,i}function f(e,t){return"number"===typeof e?s(e,t):"string"===typeof e?l(e,t):c(e.low,e.high,"boolean"===typeof t?t:e.unsigned)}n.fromString=l,n.fromValue=f;var d=4294967296,h=d*d,p=h/2,g=o(1<<24),m=o(0);n.ZERO=m;var v=o(0,!0);n.UZERO=v;var b=o(1);n.ONE=b;var y=o(1,!0);n.UONE=y;var x=o(-1);n.NEG_ONE=x;var w=c(-1,2147483647,!1);n.MAX_VALUE=w;var S=c(-1,-1,!0);n.MAX_UNSIGNED_VALUE=S;var C=c(0,-2147483648,!1);n.MIN_VALUE=C;var M=n.prototype;M.toInt=function(){return this.unsigned?this.low>>>0:this.low},M.toNumber=function(){return this.unsigned?(this.high>>>0)*d+(this.low>>>0):this.high*d+(this.low>>>0)},M.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(C)){var t=s(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var a=s(u(e,6),this.unsigned),i=this,o="";;){var c=i.div(a),l=(i.sub(c.mul(a)).toInt()>>>0).toString(e);if((i=c).isZero())return l+o;for(;l.length<6;)l="0"+l;o=""+l+o}},M.getHighBits=function(){return this.high},M.getHighBitsUnsigned=function(){return this.high>>>0},M.getLowBits=function(){return this.low},M.getLowBitsUnsigned=function(){return this.low>>>0},M.getNumBitsAbs=function(){if(this.isNegative())return this.eq(C)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},M.isZero=function(){return 0===this.high&&0===this.low},M.eqz=M.isZero,M.isNegative=function(){return!this.unsigned&&this.high<0},M.isPositive=function(){return this.unsigned||this.high>=0},M.isOdd=function(){return 1===(1&this.low)},M.isEven=function(){return 0===(1&this.low)},M.equals=function(e){return r(e)||(e=f(e)),(this.unsigned===e.unsigned||this.high>>>31!==1||e.high>>>31!==1)&&(this.high===e.high&&this.low===e.low)},M.eq=M.equals,M.notEquals=function(e){return!this.eq(e)},M.neq=M.notEquals,M.ne=M.notEquals,M.lessThan=function(e){return this.comp(e)<0},M.lt=M.lessThan,M.lessThanOrEqual=function(e){return this.comp(e)<=0},M.lte=M.lessThanOrEqual,M.le=M.lessThanOrEqual,M.greaterThan=function(e){return this.comp(e)>0},M.gt=M.greaterThan,M.greaterThanOrEqual=function(e){return this.comp(e)>=0},M.gte=M.greaterThanOrEqual,M.ge=M.greaterThanOrEqual,M.compare=function(e){if(r(e)||(e=f(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},M.comp=M.compare,M.negate=function(){return!this.unsigned&&this.eq(C)?C:this.not().add(b)},M.neg=M.negate,M.add=function(e){r(e)||(e=f(e));var t=this.high>>>16,n=65535&this.high,a=this.low>>>16,i=65535&this.low,o=e.high>>>16,s=65535&e.high,u=e.low>>>16,l=0,d=0,h=0,p=0;return h+=(p+=i+(65535&e.low))>>>16,d+=(h+=a+u)>>>16,l+=(d+=n+s)>>>16,l+=t+o,c((h&=65535)<<16|(p&=65535),(l&=65535)<<16|(d&=65535),this.unsigned)},M.subtract=function(e){return r(e)||(e=f(e)),this.add(e.neg())},M.sub=M.subtract,M.multiply=function(e){if(this.isZero())return m;if(r(e)||(e=f(e)),t)return c(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return m;if(this.eq(C))return e.isOdd()?C:m;if(e.eq(C))return this.isOdd()?C:m;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(g)&&e.lt(g))return s(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=65535&this.high,i=this.low>>>16,o=65535&this.low,u=e.high>>>16,l=65535&e.high,d=e.low>>>16,h=65535&e.low,p=0,v=0,b=0,y=0;return b+=(y+=o*h)>>>16,v+=(b+=i*h)>>>16,b&=65535,v+=(b+=o*d)>>>16,p+=(v+=a*h)>>>16,v&=65535,p+=(v+=i*d)>>>16,v&=65535,p+=(v+=o*l)>>>16,p+=n*h+a*d+i*l+o*u,c((b&=65535)<<16|(y&=65535),(p&=65535)<<16|(v&=65535),this.unsigned)},M.mul=M.multiply,M.divide=function(e){if(r(e)||(e=f(e)),e.isZero())throw Error("division by zero");var n,a,i;if(t)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?c((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?v:m;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return v;if(e.gt(this.shru(1)))return y;i=v}else{if(this.eq(C))return e.eq(b)||e.eq(x)?C:e.eq(C)?b:(n=this.shr(1).div(e).shl(1)).eq(m)?e.isNegative()?b:x:(a=this.sub(e.mul(n)),i=n.add(a.div(e)));if(e.eq(C))return this.unsigned?v:m;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=m}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(n)/Math.LN2),l=o<=48?1:u(2,o-48),d=s(n),h=d.mul(e);h.isNegative()||h.gt(a);)h=(d=s(n-=l,this.unsigned)).mul(e);d.isZero()&&(d=b),i=i.add(d),a=a.sub(h)}return i},M.div=M.divide,M.modulo=function(e){return r(e)||(e=f(e)),t?c((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},M.mod=M.modulo,M.rem=M.modulo,M.not=function(){return c(~this.low,~this.high,this.unsigned)},M.and=function(e){return r(e)||(e=f(e)),c(this.low&e.low,this.high&e.high,this.unsigned)},M.or=function(e){return r(e)||(e=f(e)),c(this.low|e.low,this.high|e.high,this.unsigned)},M.xor=function(e){return r(e)||(e=f(e)),c(this.low^e.low,this.high^e.high,this.unsigned)},M.shiftLeft=function(e){return r(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?c(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):c(0,this.low<<e-32,this.unsigned)},M.shl=M.shiftLeft,M.shiftRight=function(e){return r(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?c(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):c(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},M.shr=M.shiftRight,M.shiftRightUnsigned=function(e){if(r(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?c(this.low>>>e|t<<32-e,t>>>e,this.unsigned):c(32===e?t:t>>>e-32,0,this.unsigned)},M.shru=M.shiftRightUnsigned,M.shr_u=M.shiftRightUnsigned,M.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},M.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},M.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},M.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},M.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},n.fromBytes=function(e,t,r){return r?n.fromBytesLE(e,t):n.fromBytesBE(e,t)},n.fromBytesLE=function(e,t){return new n(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},n.fromBytesBE=function(e,t){return new n(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},7340:e=>{var t=1e3,n=60*t,r=60*n,a=24*r,i=7*a,o=365.25*a;function s(e,t,n,r){var a=t>=1.5*n;return Math.round(e/n)+" "+r+(a?"s":"")}e.exports=function(e,c){c=c||{};var u=typeof e;if("string"===u&&e.length>0)return function(e){if((e=String(e)).length>100)return;var s=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!s)return;var c=parseFloat(s[1]);switch((s[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*o;case"weeks":case"week":case"w":return c*i;case"days":case"day":case"d":return c*a;case"hours":case"hour":case"hrs":case"hr":case"h":return c*r;case"minutes":case"minute":case"mins":case"min":case"m":return c*n;case"seconds":case"second":case"secs":case"sec":case"s":return c*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}(e);if("number"===u&&isFinite(e))return c.long?function(e){var i=Math.abs(e);if(i>=a)return s(e,i,a,"day");if(i>=r)return s(e,i,r,"hour");if(i>=n)return s(e,i,n,"minute");if(i>=t)return s(e,i,t,"second");return e+" ms"}(e):function(e){var i=Math.abs(e);if(i>=a)return Math.round(e/a)+"d";if(i>=r)return Math.round(e/r)+"h";if(i>=n)return Math.round(e/n)+"m";if(i>=t)return Math.round(e/t)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},2285:e=>{var t,n,r=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"===typeof setTimeout?setTimeout:a}catch(e){t=a}try{n="function"===typeof clearTimeout?clearTimeout:i}catch(e){n=i}}();var s,c=[],u=!1,l=-1;function f(){u&&s&&(u=!1,s.length?c=s.concat(c):l=-1,c.length&&d())}function d(){if(!u){var e=o(f);u=!0;for(var t=c.length;t;){for(s=c,c=[];++l<t;)s&&s[l].run();l=-1,t=c.length}s=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===i||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{return n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function p(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new h(e,t)),1!==c.length||u||o(d)},h.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=p,r.addListener=p,r.once=p,r.off=p,r.removeListener=p,r.removeAllListeners=p,r.emit=p,r.prependListener=p,r.prependOnceListener=p,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},4275:(e,t,n)=>{let r;e.exports="function"===typeof queueMicrotask?queueMicrotask.bind("undefined"!==typeof window?window:n.g):e=>(r||(r=Promise.resolve())).then(e).catch((e=>setTimeout((()=>{throw e}),0)))},5838:(e,t,n)=>{"use strict";var r=n(2285),a=65536,i=4294967295;var o=n(9966).Buffer,s=n.g.crypto||n.g.msCrypto;s&&s.getRandomValues?e.exports=function(e,t){if(e>i)throw new RangeError("requested too many random bytes");var n=o.allocUnsafe(e);if(e>0)if(e>a)for(var c=0;c<e;c+=a)s.getRandomValues(n.slice(c,c+a));else s.getRandomValues(n);if("function"===typeof t)return r.nextTick((function(){t(null,n)}));return n}:e.exports=function(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}},2730:(e,t,n)=>{"use strict";var r=n(5043),a=n(8853);function i(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function c(e,t){u(e,t),u(e+"Capture",t)}function u(e,t){for(s[e]=t,e=0;e<t.length;e++)o.add(t[e])}var l=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),f=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,h={},p={};function g(e,t,n,r,a,i,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=o}var m={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){m[e]=new g(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];m[t]=new g(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){m[e]=new g(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){m[e]=new g(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){m[e]=new g(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){m[e]=new g(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){m[e]=new g(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){m[e]=new g(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){m[e]=new g(e,5,!1,e.toLowerCase(),null,!1,!1)}));var v=/[\-:]([a-z])/g;function b(e){return e[1].toUpperCase()}function y(e,t,n,r){var a=m.hasOwnProperty(t)?m[t]:null;(null!==a?0!==a.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,a,r)&&(n=null),r||null===a?function(e){return!!f.call(p,e)||!f.call(h,e)&&(d.test(e)?p[e]=!0:(h[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):a.mustUseProperty?e[a.propertyName]=null===n?3!==a.type&&"":n:(t=a.attributeName,r=a.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(a=a.type)||4===a&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(v,b);m[t]=new g(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(v,b);m[t]=new g(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(v,b);m[t]=new g(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){m[e]=new g(e,1,!1,e.toLowerCase(),null,!1,!1)})),m.xlinkHref=new g("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){m[e]=new g(e,1,!1,e.toLowerCase(),null,!0,!0)}));var x=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=Symbol.for("react.element"),S=Symbol.for("react.portal"),C=Symbol.for("react.fragment"),M=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),E=Symbol.for("react.provider"),T=Symbol.for("react.context"),I=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),N=Symbol.for("react.suspense_list"),L=Symbol.for("react.memo"),A=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var R=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var D=Symbol.iterator;function O(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=D&&e[D]||e["@@iterator"])?e:null}var P,F=Object.assign;function z(e){if(void 0===P)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);P=t&&t[1]||""}return"\n"+P+e}var j=!1;function B(e,t){if(!e||j)return"";j=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var r=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){r=u}e.call(t.prototype)}else{try{throw Error()}catch(u){r=u}e()}}catch(u){if(u&&r&&"string"===typeof u.stack){for(var a=u.stack.split("\n"),i=r.stack.split("\n"),o=a.length-1,s=i.length-1;1<=o&&0<=s&&a[o]!==i[s];)s--;for(;1<=o&&0<=s;o--,s--)if(a[o]!==i[s]){if(1!==o||1!==s)do{if(o--,0>--s||a[o]!==i[s]){var c="\n"+a[o].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}}while(1<=o&&0<=s);break}}}finally{j=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?z(e):""}function U(e){switch(e.tag){case 5:return z(e.type);case 16:return z("Lazy");case 13:return z("Suspense");case 19:return z("SuspenseList");case 0:case 2:case 15:return e=B(e.type,!1);case 11:return e=B(e.type.render,!1);case 1:return e=B(e.type,!0);default:return""}}function W(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case C:return"Fragment";case S:return"Portal";case _:return"Profiler";case M:return"StrictMode";case k:return"Suspense";case N:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case T:return(e.displayName||"Context")+".Consumer";case E:return(e._context.displayName||"Context")+".Provider";case I:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case L:return null!==(t=e.displayName||null)?t:W(e.type)||"Memo";case A:t=e._payload,e=e._init;try{return W(e(t))}catch(n){}}return null}function G(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return W(t);case 8:return t===M?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function V(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function H(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function Y(e){e._valueTracker||(e._valueTracker=function(e){var t=H(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var a=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(e){r=""+e,i.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function X(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=H(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function q(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function K(e,t){var n=t.checked;return F({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Q(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=V(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function J(e,t){null!=(t=t.checked)&&y(e,"checked",t,!1)}function Z(e,t){J(e,t);var n=V(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,V(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&q(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&r&&(e[n].defaultSelected=!0)}else{for(n=""+V(n),t=null,a=0;a<e.length;a++){if(e[a].value===n)return e[a].selected=!0,void(r&&(e[a].defaultSelected=!0));null!==t||e[a].disabled||(t=e[a])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(i(91));return F({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ae(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(i(92));if(te(n)){if(1<n.length)throw Error(i(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:V(n)}}function ie(e,t){var n=V(t.value),r=V(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ce(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ue,le,fe=(le=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ue=ue||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ue.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return le(e,t)}))}:le);function de(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var he={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function ge(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||he.hasOwnProperty(e)&&he[e]?(""+t).trim():t+"px"}function me(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),a=ge(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,a):e[n]=a}}Object.keys(he).forEach((function(e){pe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),he[t]=he[e]}))}));var ve=F({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function be(e,t){if(t){if(ve[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(i(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(i(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(i(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(i(62))}}function ye(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xe=null;function we(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Se=null,Ce=null,Me=null;function _e(e){if(e=ya(e)){if("function"!==typeof Se)throw Error(i(280));var t=e.stateNode;t&&(t=wa(t),Se(e.stateNode,e.type,t))}}function Ee(e){Ce?Me?Me.push(e):Me=[e]:Ce=e}function Te(){if(Ce){var e=Ce,t=Me;if(Me=Ce=null,_e(e),t)for(e=0;e<t.length;e++)_e(t[e])}}function Ie(e,t){return e(t)}function ke(){}var Ne=!1;function Le(e,t,n){if(Ne)return e(t,n);Ne=!0;try{return Ie(e,t,n)}finally{Ne=!1,(null!==Ce||null!==Me)&&(ke(),Te())}}function Ae(e,t){var n=e.stateNode;if(null===n)return null;var r=wa(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(i(231,t,typeof n));return n}var Re=!1;if(l)try{var De={};Object.defineProperty(De,"passive",{get:function(){Re=!0}}),window.addEventListener("test",De,De),window.removeEventListener("test",De,De)}catch(le){Re=!1}function Oe(e,t,n,r,a,i,o,s,c){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(l){this.onError(l)}}var Pe=!1,Fe=null,ze=!1,je=null,Be={onError:function(e){Pe=!0,Fe=e}};function Ue(e,t,n,r,a,i,o,s,c){Pe=!1,Fe=null,Oe.apply(Be,arguments)}function We(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Ge(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ve(e){if(We(e)!==e)throw Error(i(188))}function He(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=We(e)))throw Error(i(188));return t!==e?null:e}for(var n=e,r=t;;){var a=n.return;if(null===a)break;var o=a.alternate;if(null===o){if(null!==(r=a.return)){n=r;continue}break}if(a.child===o.child){for(o=a.child;o;){if(o===n)return Ve(a),e;if(o===r)return Ve(a),t;o=o.sibling}throw Error(i(188))}if(n.return!==r.return)n=a,r=o;else{for(var s=!1,c=a.child;c;){if(c===n){s=!0,n=a,r=o;break}if(c===r){s=!0,r=a,n=o;break}c=c.sibling}if(!s){for(c=o.child;c;){if(c===n){s=!0,n=o,r=a;break}if(c===r){s=!0,r=o,n=a;break}c=c.sibling}if(!s)throw Error(i(189))}}if(n.alternate!==r)throw Error(i(190))}if(3!==n.tag)throw Error(i(188));return n.stateNode.current===n?e:t}(e))?Ye(e):null}function Ye(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ye(e);if(null!==t)return t;e=e.sibling}return null}var Xe=a.unstable_scheduleCallback,qe=a.unstable_cancelCallback,Ke=a.unstable_shouldYield,Qe=a.unstable_requestPaint,Je=a.unstable_now,Ze=a.unstable_getCurrentPriorityLevel,$e=a.unstable_ImmediatePriority,et=a.unstable_UserBlockingPriority,tt=a.unstable_NormalPriority,nt=a.unstable_LowPriority,rt=a.unstable_IdlePriority,at=null,it=null;var ot=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(st(e)/ct|0)|0},st=Math.log,ct=Math.LN2;var ut=64,lt=4194304;function ft(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dt(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,a=e.suspendedLanes,i=e.pingedLanes,o=268435455&n;if(0!==o){var s=o&~a;0!==s?r=ft(s):0!==(i&=o)&&(r=ft(i))}else 0!==(o=n&~a)?r=ft(o):0!==i&&(r=ft(i));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&a)&&((a=r&-r)>=(i=t&-t)||16===a&&0!==(4194240&i)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)a=1<<(n=31-ot(t)),r|=e[n],t&=~a;return r}function ht(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function gt(){var e=ut;return 0===(4194240&(ut<<=1))&&(ut=64),e}function mt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function vt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-ot(t)]=n}function bt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-ot(n),a=1<<r;a&t|e[r]&t&&(e[r]|=t),n&=~a}}var yt=0;function xt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var wt,St,Ct,Mt,_t,Et=!1,Tt=[],It=null,kt=null,Nt=null,Lt=new Map,At=new Map,Rt=[],Dt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ot(e,t){switch(e){case"focusin":case"focusout":It=null;break;case"dragenter":case"dragleave":kt=null;break;case"mouseover":case"mouseout":Nt=null;break;case"pointerover":case"pointerout":Lt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":At.delete(t.pointerId)}}function Pt(e,t,n,r,a,i){return null===e||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[a]},null!==t&&(null!==(t=ya(t))&&St(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==a&&-1===t.indexOf(a)&&t.push(a),e)}function Ft(e){var t=ba(e.target);if(null!==t){var n=We(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Ge(n)))return e.blockedOn=t,void _t(e.priority,(function(){Ct(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function zt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Kt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=ya(n))&&St(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);xe=r,n.target.dispatchEvent(r),xe=null,t.shift()}return!0}function jt(e,t,n){zt(e)&&n.delete(t)}function Bt(){Et=!1,null!==It&&zt(It)&&(It=null),null!==kt&&zt(kt)&&(kt=null),null!==Nt&&zt(Nt)&&(Nt=null),Lt.forEach(jt),At.forEach(jt)}function Ut(e,t){e.blockedOn===t&&(e.blockedOn=null,Et||(Et=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,Bt)))}function Wt(e){function t(t){return Ut(t,e)}if(0<Tt.length){Ut(Tt[0],e);for(var n=1;n<Tt.length;n++){var r=Tt[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==It&&Ut(It,e),null!==kt&&Ut(kt,e),null!==Nt&&Ut(Nt,e),Lt.forEach(t),At.forEach(t),n=0;n<Rt.length;n++)(r=Rt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Rt.length&&null===(n=Rt[0]).blockedOn;)Ft(n),null===n.blockedOn&&Rt.shift()}var Gt=x.ReactCurrentBatchConfig,Vt=!0;function Ht(e,t,n,r){var a=yt,i=Gt.transition;Gt.transition=null;try{yt=1,Xt(e,t,n,r)}finally{yt=a,Gt.transition=i}}function Yt(e,t,n,r){var a=yt,i=Gt.transition;Gt.transition=null;try{yt=4,Xt(e,t,n,r)}finally{yt=a,Gt.transition=i}}function Xt(e,t,n,r){if(Vt){var a=Kt(e,t,n,r);if(null===a)Vr(e,t,r,qt,n),Ot(e,r);else if(function(e,t,n,r,a){switch(t){case"focusin":return It=Pt(It,e,t,n,r,a),!0;case"dragenter":return kt=Pt(kt,e,t,n,r,a),!0;case"mouseover":return Nt=Pt(Nt,e,t,n,r,a),!0;case"pointerover":var i=a.pointerId;return Lt.set(i,Pt(Lt.get(i)||null,e,t,n,r,a)),!0;case"gotpointercapture":return i=a.pointerId,At.set(i,Pt(At.get(i)||null,e,t,n,r,a)),!0}return!1}(a,e,t,n,r))r.stopPropagation();else if(Ot(e,r),4&t&&-1<Dt.indexOf(e)){for(;null!==a;){var i=ya(a);if(null!==i&&wt(i),null===(i=Kt(e,t,n,r))&&Vr(e,t,r,qt,n),i===a)break;a=i}null!==a&&r.stopPropagation()}else Vr(e,t,r,null,n)}}var qt=null;function Kt(e,t,n,r){if(qt=null,null!==(e=ba(e=we(r))))if(null===(t=We(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Ge(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return qt=e,null}function Qt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ze()){case $e:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Jt=null,Zt=null,$t=null;function en(){if($t)return $t;var e,t,n=Zt,r=n.length,a="value"in Jt?Jt.value:Jt.textContent,i=a.length;for(e=0;e<r&&n[e]===a[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===a[i-t];t++);return $t=a.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function an(e){function t(t,n,r,a,i){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=a,this.target=i,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(a):a[o]);return this.isDefaultPrevented=(null!=a.defaultPrevented?a.defaultPrevented:!1===a.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return F(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var on,sn,cn,un={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ln=an(un),fn=F({},un,{view:0,detail:0}),dn=an(fn),hn=F({},fn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:_n,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==cn&&(cn&&"mousemove"===e.type?(on=e.screenX-cn.screenX,sn=e.screenY-cn.screenY):sn=on=0,cn=e),on)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),pn=an(hn),gn=an(F({},hn,{dataTransfer:0})),mn=an(F({},fn,{relatedTarget:0})),vn=an(F({},un,{animationName:0,elapsedTime:0,pseudoElement:0})),bn=F({},un,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),yn=an(bn),xn=an(F({},un,{data:0})),wn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Sn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Cn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Mn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Cn[e])&&!!t[e]}function _n(){return Mn}var En=F({},fn,{key:function(e){if(e.key){var t=wn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Sn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:_n,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Tn=an(En),In=an(F({},hn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),kn=an(F({},fn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:_n})),Nn=an(F({},un,{propertyName:0,elapsedTime:0,pseudoElement:0})),Ln=F({},hn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),An=an(Ln),Rn=[9,13,27,32],Dn=l&&"CompositionEvent"in window,On=null;l&&"documentMode"in document&&(On=document.documentMode);var Pn=l&&"TextEvent"in window&&!On,Fn=l&&(!Dn||On&&8<On&&11>=On),zn=String.fromCharCode(32),jn=!1;function Bn(e,t){switch(e){case"keyup":return-1!==Rn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Un(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Wn=!1;var Gn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Gn[e.type]:"textarea"===t}function Hn(e,t,n,r){Ee(r),0<(t=Yr(t,"onChange")).length&&(n=new ln("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Yn=null,Xn=null;function qn(e){zr(e,0)}function Kn(e){if(X(xa(e)))return e}function Qn(e,t){if("change"===e)return t}var Jn=!1;if(l){var Zn;if(l){var $n="oninput"in document;if(!$n){var er=document.createElement("div");er.setAttribute("oninput","return;"),$n="function"===typeof er.oninput}Zn=$n}else Zn=!1;Jn=Zn&&(!document.documentMode||9<document.documentMode)}function tr(){Yn&&(Yn.detachEvent("onpropertychange",nr),Xn=Yn=null)}function nr(e){if("value"===e.propertyName&&Kn(Xn)){var t=[];Hn(t,Xn,e,we(e)),Le(qn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Xn=n,(Yn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ar(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Kn(Xn)}function ir(e,t){if("click"===e)return Kn(t)}function or(e,t){if("input"===e||"change"===e)return Kn(t)}var sr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function cr(e,t){if(sr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var a=n[r];if(!f.call(t,a)||!sr(e[a],t[a]))return!1}return!0}function ur(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function lr(e,t){var n,r=ur(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=ur(r)}}function fr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?fr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function dr(){for(var e=window,t=q();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=q((e=t.contentWindow).document)}return t}function hr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function pr(e){var t=dr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&fr(n.ownerDocument.documentElement,n)){if(null!==r&&hr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var a=n.textContent.length,i=Math.min(r.start,a);r=void 0===r.end?i:Math.min(r.end,a),!e.extend&&i>r&&(a=r,r=i,i=a),a=lr(n,i);var o=lr(n,r);a&&o&&(1!==e.rangeCount||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(a.node,a.offset),e.removeAllRanges(),i>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var gr=l&&"documentMode"in document&&11>=document.documentMode,mr=null,vr=null,br=null,yr=!1;function xr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;yr||null==mr||mr!==q(r)||("selectionStart"in(r=mr)&&hr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},br&&cr(br,r)||(br=r,0<(r=Yr(vr,"onSelect")).length&&(t=new ln("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=mr)))}function wr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Sr={animationend:wr("Animation","AnimationEnd"),animationiteration:wr("Animation","AnimationIteration"),animationstart:wr("Animation","AnimationStart"),transitionend:wr("Transition","TransitionEnd")},Cr={},Mr={};function _r(e){if(Cr[e])return Cr[e];if(!Sr[e])return e;var t,n=Sr[e];for(t in n)if(n.hasOwnProperty(t)&&t in Mr)return Cr[e]=n[t];return e}l&&(Mr=document.createElement("div").style,"AnimationEvent"in window||(delete Sr.animationend.animation,delete Sr.animationiteration.animation,delete Sr.animationstart.animation),"TransitionEvent"in window||delete Sr.transitionend.transition);var Er=_r("animationend"),Tr=_r("animationiteration"),Ir=_r("animationstart"),kr=_r("transitionend"),Nr=new Map,Lr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ar(e,t){Nr.set(e,t),c(t,[e])}for(var Rr=0;Rr<Lr.length;Rr++){var Dr=Lr[Rr];Ar(Dr.toLowerCase(),"on"+(Dr[0].toUpperCase()+Dr.slice(1)))}Ar(Er,"onAnimationEnd"),Ar(Tr,"onAnimationIteration"),Ar(Ir,"onAnimationStart"),Ar("dblclick","onDoubleClick"),Ar("focusin","onFocus"),Ar("focusout","onBlur"),Ar(kr,"onTransitionEnd"),u("onMouseEnter",["mouseout","mouseover"]),u("onMouseLeave",["mouseout","mouseover"]),u("onPointerEnter",["pointerout","pointerover"]),u("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Or="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Pr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Or));function Fr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,a,o,s,c,u){if(Ue.apply(this,arguments),Pe){if(!Pe)throw Error(i(198));var l=Fe;Pe=!1,Fe=null,ze||(ze=!0,je=l)}}(r,t,void 0,e),e.currentTarget=null}function zr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],a=r.event;r=r.listeners;e:{var i=void 0;if(t)for(var o=r.length-1;0<=o;o--){var s=r[o],c=s.instance,u=s.currentTarget;if(s=s.listener,c!==i&&a.isPropagationStopped())break e;Fr(a,s,u),i=c}else for(o=0;o<r.length;o++){if(c=(s=r[o]).instance,u=s.currentTarget,s=s.listener,c!==i&&a.isPropagationStopped())break e;Fr(a,s,u),i=c}}}if(ze)throw e=je,ze=!1,je=null,e}function jr(e,t){var n=t[ga];void 0===n&&(n=t[ga]=new Set);var r=e+"__bubble";n.has(r)||(Gr(t,e,2,!1),n.add(r))}function Br(e,t,n){var r=0;t&&(r|=4),Gr(n,e,r,t)}var Ur="_reactListening"+Math.random().toString(36).slice(2);function Wr(e){if(!e[Ur]){e[Ur]=!0,o.forEach((function(t){"selectionchange"!==t&&(Pr.has(t)||Br(t,!1,e),Br(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Ur]||(t[Ur]=!0,Br("selectionchange",!1,t))}}function Gr(e,t,n,r){switch(Qt(t)){case 1:var a=Ht;break;case 4:a=Yt;break;default:a=Xt}n=a.bind(null,t,n,e),a=void 0,!Re||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(a=!0),r?void 0!==a?e.addEventListener(t,n,{capture:!0,passive:a}):e.addEventListener(t,n,!0):void 0!==a?e.addEventListener(t,n,{passive:a}):e.addEventListener(t,n,!1)}function Vr(e,t,n,r,a){var i=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var s=r.stateNode.containerInfo;if(s===a||8===s.nodeType&&s.parentNode===a)break;if(4===o)for(o=r.return;null!==o;){var c=o.tag;if((3===c||4===c)&&((c=o.stateNode.containerInfo)===a||8===c.nodeType&&c.parentNode===a))return;o=o.return}for(;null!==s;){if(null===(o=ba(s)))return;if(5===(c=o.tag)||6===c){r=i=o;continue e}s=s.parentNode}}r=r.return}Le((function(){var r=i,a=we(n),o=[];e:{var s=Nr.get(e);if(void 0!==s){var c=ln,u=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":c=Tn;break;case"focusin":u="focus",c=mn;break;case"focusout":u="blur",c=mn;break;case"beforeblur":case"afterblur":c=mn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=gn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=kn;break;case Er:case Tr:case Ir:c=vn;break;case kr:c=Nn;break;case"scroll":c=dn;break;case"wheel":c=An;break;case"copy":case"cut":case"paste":c=yn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=In}var l=0!==(4&t),f=!l&&"scroll"===e,d=l?null!==s?s+"Capture":null:s;l=[];for(var h,p=r;null!==p;){var g=(h=p).stateNode;if(5===h.tag&&null!==g&&(h=g,null!==d&&(null!=(g=Ae(p,d))&&l.push(Hr(p,g,h)))),f)break;p=p.return}0<l.length&&(s=new c(s,u,null,n,a),o.push({event:s,listeners:l}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===xe||!(u=n.relatedTarget||n.fromElement)||!ba(u)&&!u[pa])&&(c||s)&&(s=a.window===a?a:(s=a.ownerDocument)?s.defaultView||s.parentWindow:window,c?(c=r,null!==(u=(u=n.relatedTarget||n.toElement)?ba(u):null)&&(u!==(f=We(u))||5!==u.tag&&6!==u.tag)&&(u=null)):(c=null,u=r),c!==u)){if(l=pn,g="onMouseLeave",d="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(l=In,g="onPointerLeave",d="onPointerEnter",p="pointer"),f=null==c?s:xa(c),h=null==u?s:xa(u),(s=new l(g,p+"leave",c,n,a)).target=f,s.relatedTarget=h,g=null,ba(a)===r&&((l=new l(d,p+"enter",u,n,a)).target=h,l.relatedTarget=f,g=l),f=g,c&&u)e:{for(d=u,p=0,h=l=c;h;h=Xr(h))p++;for(h=0,g=d;g;g=Xr(g))h++;for(;0<p-h;)l=Xr(l),p--;for(;0<h-p;)d=Xr(d),h--;for(;p--;){if(l===d||null!==d&&l===d.alternate)break e;l=Xr(l),d=Xr(d)}l=null}else l=null;null!==c&&qr(o,s,c,l,!1),null!==u&&null!==f&&qr(o,f,u,l,!0)}if("select"===(c=(s=r?xa(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===c&&"file"===s.type)var m=Qn;else if(Vn(s))if(Jn)m=or;else{m=ar;var v=rr}else(c=s.nodeName)&&"input"===c.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(m=ir);switch(m&&(m=m(e,r))?Hn(o,m,n,a):(v&&v(e,s,r),"focusout"===e&&(v=s._wrapperState)&&v.controlled&&"number"===s.type&&ee(s,"number",s.value)),v=r?xa(r):window,e){case"focusin":(Vn(v)||"true"===v.contentEditable)&&(mr=v,vr=r,br=null);break;case"focusout":br=vr=mr=null;break;case"mousedown":yr=!0;break;case"contextmenu":case"mouseup":case"dragend":yr=!1,xr(o,n,a);break;case"selectionchange":if(gr)break;case"keydown":case"keyup":xr(o,n,a)}var b;if(Dn)e:{switch(e){case"compositionstart":var y="onCompositionStart";break e;case"compositionend":y="onCompositionEnd";break e;case"compositionupdate":y="onCompositionUpdate";break e}y=void 0}else Wn?Bn(e,n)&&(y="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(y="onCompositionStart");y&&(Fn&&"ko"!==n.locale&&(Wn||"onCompositionStart"!==y?"onCompositionEnd"===y&&Wn&&(b=en()):(Zt="value"in(Jt=a)?Jt.value:Jt.textContent,Wn=!0)),0<(v=Yr(r,y)).length&&(y=new xn(y,e,null,n,a),o.push({event:y,listeners:v}),b?y.data=b:null!==(b=Un(n))&&(y.data=b))),(b=Pn?function(e,t){switch(e){case"compositionend":return Un(t);case"keypress":return 32!==t.which?null:(jn=!0,zn);case"textInput":return(e=t.data)===zn&&jn?null:e;default:return null}}(e,n):function(e,t){if(Wn)return"compositionend"===e||!Dn&&Bn(e,t)?(e=en(),$t=Zt=Jt=null,Wn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Fn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Yr(r,"onBeforeInput")).length&&(a=new xn("onBeforeInput","beforeinput",null,n,a),o.push({event:a,listeners:r}),a.data=b))}zr(o,t)}))}function Hr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Yr(e,t){for(var n=t+"Capture",r=[];null!==e;){var a=e,i=a.stateNode;5===a.tag&&null!==i&&(a=i,null!=(i=Ae(e,n))&&r.unshift(Hr(e,i,a)),null!=(i=Ae(e,t))&&r.push(Hr(e,i,a))),e=e.return}return r}function Xr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function qr(e,t,n,r,a){for(var i=t._reactName,o=[];null!==n&&n!==r;){var s=n,c=s.alternate,u=s.stateNode;if(null!==c&&c===r)break;5===s.tag&&null!==u&&(s=u,a?null!=(c=Ae(n,i))&&o.unshift(Hr(n,c,s)):a||null!=(c=Ae(n,i))&&o.push(Hr(n,c,s))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Kr=/\r\n?/g,Qr=/\u0000|\uFFFD/g;function Jr(e){return("string"===typeof e?e:""+e).replace(Kr,"\n").replace(Qr,"")}function Zr(e,t,n){if(t=Jr(t),Jr(e)!==t&&n)throw Error(i(425))}function $r(){}var ea=null,ta=null;function na(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ra="function"===typeof setTimeout?setTimeout:void 0,aa="function"===typeof clearTimeout?clearTimeout:void 0,ia="function"===typeof Promise?Promise:void 0,oa="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ia?function(e){return ia.resolve(null).then(e).catch(sa)}:ra;function sa(e){setTimeout((function(){throw e}))}function ca(e,t){var n=t,r=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&8===a.nodeType)if("/$"===(n=a.data)){if(0===r)return e.removeChild(a),void Wt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=a}while(n);Wt(t)}function ua(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function la(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var fa=Math.random().toString(36).slice(2),da="__reactFiber$"+fa,ha="__reactProps$"+fa,pa="__reactContainer$"+fa,ga="__reactEvents$"+fa,ma="__reactListeners$"+fa,va="__reactHandles$"+fa;function ba(e){var t=e[da];if(t)return t;for(var n=e.parentNode;n;){if(t=n[pa]||n[da]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=la(e);null!==e;){if(n=e[da])return n;e=la(e)}return t}n=(e=n).parentNode}return null}function ya(e){return!(e=e[da]||e[pa])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function xa(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(i(33))}function wa(e){return e[ha]||null}var Sa=[],Ca=-1;function Ma(e){return{current:e}}function _a(e){0>Ca||(e.current=Sa[Ca],Sa[Ca]=null,Ca--)}function Ea(e,t){Ca++,Sa[Ca]=e.current,e.current=t}var Ta={},Ia=Ma(Ta),ka=Ma(!1),Na=Ta;function La(e,t){var n=e.type.contextTypes;if(!n)return Ta;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a,i={};for(a in n)i[a]=t[a];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function Aa(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Ra(){_a(ka),_a(Ia)}function Da(e,t,n){if(Ia.current!==Ta)throw Error(i(168));Ea(Ia,t),Ea(ka,n)}function Oa(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var a in r=r.getChildContext())if(!(a in t))throw Error(i(108,G(e)||"Unknown",a));return F({},n,r)}function Pa(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ta,Na=Ia.current,Ea(Ia,e),Ea(ka,ka.current),!0}function Fa(e,t,n){var r=e.stateNode;if(!r)throw Error(i(169));n?(e=Oa(e,t,Na),r.__reactInternalMemoizedMergedChildContext=e,_a(ka),_a(Ia),Ea(Ia,e)):_a(ka),Ea(ka,n)}var za=null,ja=!1,Ba=!1;function Ua(e){null===za?za=[e]:za.push(e)}function Wa(){if(!Ba&&null!==za){Ba=!0;var e=0,t=yt;try{var n=za;for(yt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}za=null,ja=!1}catch(a){throw null!==za&&(za=za.slice(e+1)),Xe($e,Wa),a}finally{yt=t,Ba=!1}}return null}var Ga=[],Va=0,Ha=null,Ya=0,Xa=[],qa=0,Ka=null,Qa=1,Ja="";function Za(e,t){Ga[Va++]=Ya,Ga[Va++]=Ha,Ha=e,Ya=t}function $a(e,t,n){Xa[qa++]=Qa,Xa[qa++]=Ja,Xa[qa++]=Ka,Ka=e;var r=Qa;e=Ja;var a=32-ot(r)-1;r&=~(1<<a),n+=1;var i=32-ot(t)+a;if(30<i){var o=a-a%5;i=(r&(1<<o)-1).toString(32),r>>=o,a-=o,Qa=1<<32-ot(t)+a|n<<a|r,Ja=i+e}else Qa=1<<i|n<<a|r,Ja=e}function ei(e){null!==e.return&&(Za(e,1),$a(e,1,0))}function ti(e){for(;e===Ha;)Ha=Ga[--Va],Ga[Va]=null,Ya=Ga[--Va],Ga[Va]=null;for(;e===Ka;)Ka=Xa[--qa],Xa[qa]=null,Ja=Xa[--qa],Xa[qa]=null,Qa=Xa[--qa],Xa[qa]=null}var ni=null,ri=null,ai=!1,ii=null;function oi(e,t){var n=Lu(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function si(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ni=e,ri=ua(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ni=e,ri=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Ka?{id:Qa,overflow:Ja}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Lu(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ni=e,ri=null,!0);default:return!1}}function ci(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ui(e){if(ai){var t=ri;if(t){var n=t;if(!si(e,t)){if(ci(e))throw Error(i(418));t=ua(n.nextSibling);var r=ni;t&&si(e,t)?oi(r,n):(e.flags=-4097&e.flags|2,ai=!1,ni=e)}}else{if(ci(e))throw Error(i(418));e.flags=-4097&e.flags|2,ai=!1,ni=e}}}function li(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ni=e}function fi(e){if(e!==ni)return!1;if(!ai)return li(e),ai=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!na(e.type,e.memoizedProps)),t&&(t=ri)){if(ci(e))throw di(),Error(i(418));for(;t;)oi(e,t),t=ua(t.nextSibling)}if(li(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(i(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ri=ua(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ri=null}}else ri=ni?ua(e.stateNode.nextSibling):null;return!0}function di(){for(var e=ri;e;)e=ua(e.nextSibling)}function hi(){ri=ni=null,ai=!1}function pi(e){null===ii?ii=[e]:ii.push(e)}var gi=x.ReactCurrentBatchConfig;function mi(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(i(309));var r=n.stateNode}if(!r)throw Error(i(147,e));var a=r,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=a.refs;null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(i(284));if(!n._owner)throw Error(i(290,e))}return e}function vi(e,t){throw e=Object.prototype.toString.call(t),Error(i(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function bi(e){return(0,e._init)(e._payload)}function yi(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function a(e,t){return(e=Ru(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function c(e,t,n,r){return null===t||6!==t.tag?((t=Fu(n,e.mode,r)).return=e,t):((t=a(t,n)).return=e,t)}function u(e,t,n,r){var i=n.type;return i===C?f(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===i||"object"===typeof i&&null!==i&&i.$$typeof===A&&bi(i)===t.type)?((r=a(t,n.props)).ref=mi(e,t,n),r.return=e,r):((r=Du(n.type,n.key,n.props,null,e.mode,r)).ref=mi(e,t,n),r.return=e,r)}function l(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=zu(n,e.mode,r)).return=e,t):((t=a(t,n.children||[])).return=e,t)}function f(e,t,n,r,i){return null===t||7!==t.tag?((t=Ou(n,e.mode,r,i)).return=e,t):((t=a(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Fu(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case w:return(n=Du(t.type,t.key,t.props,null,e.mode,n)).ref=mi(e,null,t),n.return=e,n;case S:return(t=zu(t,e.mode,n)).return=e,t;case A:return d(e,(0,t._init)(t._payload),n)}if(te(t)||O(t))return(t=Ou(t,e.mode,n,null)).return=e,t;vi(e,t)}return null}function h(e,t,n,r){var a=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==a?null:c(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case w:return n.key===a?u(e,t,n,r):null;case S:return n.key===a?l(e,t,n,r):null;case A:return h(e,t,(a=n._init)(n._payload),r)}if(te(n)||O(n))return null!==a?null:f(e,t,n,r,null);vi(e,n)}return null}function p(e,t,n,r,a){if("string"===typeof r&&""!==r||"number"===typeof r)return c(t,e=e.get(n)||null,""+r,a);if("object"===typeof r&&null!==r){switch(r.$$typeof){case w:return u(t,e=e.get(null===r.key?n:r.key)||null,r,a);case S:return l(t,e=e.get(null===r.key?n:r.key)||null,r,a);case A:return p(e,t,n,(0,r._init)(r._payload),a)}if(te(r)||O(r))return f(t,e=e.get(n)||null,r,a,null);vi(t,r)}return null}function g(a,i,s,c){for(var u=null,l=null,f=i,g=i=0,m=null;null!==f&&g<s.length;g++){f.index>g?(m=f,f=null):m=f.sibling;var v=h(a,f,s[g],c);if(null===v){null===f&&(f=m);break}e&&f&&null===v.alternate&&t(a,f),i=o(v,i,g),null===l?u=v:l.sibling=v,l=v,f=m}if(g===s.length)return n(a,f),ai&&Za(a,g),u;if(null===f){for(;g<s.length;g++)null!==(f=d(a,s[g],c))&&(i=o(f,i,g),null===l?u=f:l.sibling=f,l=f);return ai&&Za(a,g),u}for(f=r(a,f);g<s.length;g++)null!==(m=p(f,a,g,s[g],c))&&(e&&null!==m.alternate&&f.delete(null===m.key?g:m.key),i=o(m,i,g),null===l?u=m:l.sibling=m,l=m);return e&&f.forEach((function(e){return t(a,e)})),ai&&Za(a,g),u}function m(a,s,c,u){var l=O(c);if("function"!==typeof l)throw Error(i(150));if(null==(c=l.call(c)))throw Error(i(151));for(var f=l=null,g=s,m=s=0,v=null,b=c.next();null!==g&&!b.done;m++,b=c.next()){g.index>m?(v=g,g=null):v=g.sibling;var y=h(a,g,b.value,u);if(null===y){null===g&&(g=v);break}e&&g&&null===y.alternate&&t(a,g),s=o(y,s,m),null===f?l=y:f.sibling=y,f=y,g=v}if(b.done)return n(a,g),ai&&Za(a,m),l;if(null===g){for(;!b.done;m++,b=c.next())null!==(b=d(a,b.value,u))&&(s=o(b,s,m),null===f?l=b:f.sibling=b,f=b);return ai&&Za(a,m),l}for(g=r(a,g);!b.done;m++,b=c.next())null!==(b=p(g,a,m,b.value,u))&&(e&&null!==b.alternate&&g.delete(null===b.key?m:b.key),s=o(b,s,m),null===f?l=b:f.sibling=b,f=b);return e&&g.forEach((function(e){return t(a,e)})),ai&&Za(a,m),l}return function e(r,i,o,c){if("object"===typeof o&&null!==o&&o.type===C&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case w:e:{for(var u=o.key,l=i;null!==l;){if(l.key===u){if((u=o.type)===C){if(7===l.tag){n(r,l.sibling),(i=a(l,o.props.children)).return=r,r=i;break e}}else if(l.elementType===u||"object"===typeof u&&null!==u&&u.$$typeof===A&&bi(u)===l.type){n(r,l.sibling),(i=a(l,o.props)).ref=mi(r,l,o),i.return=r,r=i;break e}n(r,l);break}t(r,l),l=l.sibling}o.type===C?((i=Ou(o.props.children,r.mode,c,o.key)).return=r,r=i):((c=Du(o.type,o.key,o.props,null,r.mode,c)).ref=mi(r,i,o),c.return=r,r=c)}return s(r);case S:e:{for(l=o.key;null!==i;){if(i.key===l){if(4===i.tag&&i.stateNode.containerInfo===o.containerInfo&&i.stateNode.implementation===o.implementation){n(r,i.sibling),(i=a(i,o.children||[])).return=r,r=i;break e}n(r,i);break}t(r,i),i=i.sibling}(i=zu(o,r.mode,c)).return=r,r=i}return s(r);case A:return e(r,i,(l=o._init)(o._payload),c)}if(te(o))return g(r,i,o,c);if(O(o))return m(r,i,o,c);vi(r,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==i&&6===i.tag?(n(r,i.sibling),(i=a(i,o)).return=r,r=i):(n(r,i),(i=Fu(o,r.mode,c)).return=r,r=i),s(r)):n(r,i)}}var xi=yi(!0),wi=yi(!1),Si=Ma(null),Ci=null,Mi=null,_i=null;function Ei(){_i=Mi=Ci=null}function Ti(e){var t=Si.current;_a(Si),e._currentValue=t}function Ii(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function ki(e,t){Ci=e,_i=Mi=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(ys=!0),e.firstContext=null)}function Ni(e){var t=e._currentValue;if(_i!==e)if(e={context:e,memoizedValue:t,next:null},null===Mi){if(null===Ci)throw Error(i(308));Mi=e,Ci.dependencies={lanes:0,firstContext:e}}else Mi=Mi.next=e;return t}var Li=null;function Ai(e){null===Li?Li=[e]:Li.push(e)}function Ri(e,t,n,r){var a=t.interleaved;return null===a?(n.next=n,Ai(t)):(n.next=a.next,a.next=n),t.interleaved=n,Di(e,r)}function Di(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Oi=!1;function Pi(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Fi(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function zi(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function ji(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Ic)){var a=r.pending;return null===a?t.next=t:(t.next=a.next,a.next=t),r.pending=t,Di(e,n)}return null===(a=r.interleaved)?(t.next=t,Ai(r)):(t.next=a.next,a.next=t),r.interleaved=t,Di(e,n)}function Bi(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,bt(e,n)}}function Ui(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var a=null,i=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===i?a=i=o:i=i.next=o,n=n.next}while(null!==n);null===i?a=i=t:i=i.next=t}else a=i=t;return n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Wi(e,t,n,r){var a=e.updateQueue;Oi=!1;var i=a.firstBaseUpdate,o=a.lastBaseUpdate,s=a.shared.pending;if(null!==s){a.shared.pending=null;var c=s,u=c.next;c.next=null,null===o?i=u:o.next=u,o=c;var l=e.alternate;null!==l&&((s=(l=l.updateQueue).lastBaseUpdate)!==o&&(null===s?l.firstBaseUpdate=u:s.next=u,l.lastBaseUpdate=c))}if(null!==i){var f=a.baseState;for(o=0,l=u=c=null,s=i;;){var d=s.lane,h=s.eventTime;if((r&d)===d){null!==l&&(l=l.next={eventTime:h,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var p=e,g=s;switch(d=t,h=n,g.tag){case 1:if("function"===typeof(p=g.payload)){f=p.call(h,f,d);break e}f=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(d="function"===typeof(p=g.payload)?p.call(h,f,d):p)||void 0===d)break e;f=F({},f,d);break e;case 2:Oi=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(d=a.effects)?a.effects=[s]:d.push(s))}else h={eventTime:h,lane:d,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===l?(u=l=h,c=f):l=l.next=h,o|=d;if(null===(s=s.next)){if(null===(s=a.shared.pending))break;s=(d=s).next,d.next=null,a.lastBaseUpdate=d,a.shared.pending=null}}if(null===l&&(c=f),a.baseState=c,a.firstBaseUpdate=u,a.lastBaseUpdate=l,null!==(t=a.shared.interleaved)){a=t;do{o|=a.lane,a=a.next}while(a!==t)}else null===i&&(a.shared.lanes=0);Pc|=o,e.lanes=o,e.memoizedState=f}}function Gi(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(null!==a){if(r.callback=null,r=n,"function"!==typeof a)throw Error(i(191,a));a.call(r)}}}var Vi={},Hi=Ma(Vi),Yi=Ma(Vi),Xi=Ma(Vi);function qi(e){if(e===Vi)throw Error(i(174));return e}function Ki(e,t){switch(Ea(Xi,t),Ea(Yi,e),Ea(Hi,Vi),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ce(null,"");break;default:t=ce(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}_a(Hi),Ea(Hi,t)}function Qi(){_a(Hi),_a(Yi),_a(Xi)}function Ji(e){qi(Xi.current);var t=qi(Hi.current),n=ce(t,e.type);t!==n&&(Ea(Yi,e),Ea(Hi,n))}function Zi(e){Yi.current===e&&(_a(Hi),_a(Yi))}var $i=Ma(0);function eo(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var to=[];function no(){for(var e=0;e<to.length;e++)to[e]._workInProgressVersionPrimary=null;to.length=0}var ro=x.ReactCurrentDispatcher,ao=x.ReactCurrentBatchConfig,io=0,oo=null,so=null,co=null,uo=!1,lo=!1,fo=0,ho=0;function po(){throw Error(i(321))}function go(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!sr(e[n],t[n]))return!1;return!0}function mo(e,t,n,r,a,o){if(io=o,oo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ro.current=null===e||null===e.memoizedState?$o:es,e=n(r,a),lo){o=0;do{if(lo=!1,fo=0,25<=o)throw Error(i(301));o+=1,co=so=null,t.updateQueue=null,ro.current=ts,e=n(r,a)}while(lo)}if(ro.current=Zo,t=null!==so&&null!==so.next,io=0,co=so=oo=null,uo=!1,t)throw Error(i(300));return e}function vo(){var e=0!==fo;return fo=0,e}function bo(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===co?oo.memoizedState=co=e:co=co.next=e,co}function yo(){if(null===so){var e=oo.alternate;e=null!==e?e.memoizedState:null}else e=so.next;var t=null===co?oo.memoizedState:co.next;if(null!==t)co=t,so=e;else{if(null===e)throw Error(i(310));e={memoizedState:(so=e).memoizedState,baseState:so.baseState,baseQueue:so.baseQueue,queue:so.queue,next:null},null===co?oo.memoizedState=co=e:co=co.next=e}return co}function xo(e,t){return"function"===typeof t?t(e):t}function wo(e){var t=yo(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=so,a=r.baseQueue,o=n.pending;if(null!==o){if(null!==a){var s=a.next;a.next=o.next,o.next=s}r.baseQueue=a=o,n.pending=null}if(null!==a){o=a.next,r=r.baseState;var c=s=null,u=null,l=o;do{var f=l.lane;if((io&f)===f)null!==u&&(u=u.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:e(r,l.action);else{var d={lane:f,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};null===u?(c=u=d,s=r):u=u.next=d,oo.lanes|=f,Pc|=f}l=l.next}while(null!==l&&l!==o);null===u?s=r:u.next=c,sr(r,t.memoizedState)||(ys=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=u,n.lastRenderedState=r}if(null!==(e=n.interleaved)){a=e;do{o=a.lane,oo.lanes|=o,Pc|=o,a=a.next}while(a!==e)}else null===a&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function So(e){var t=yo(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,o=t.memoizedState;if(null!==a){n.pending=null;var s=a=a.next;do{o=e(o,s.action),s=s.next}while(s!==a);sr(o,t.memoizedState)||(ys=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function Co(){}function Mo(e,t){var n=oo,r=yo(),a=t(),o=!sr(r.memoizedState,a);if(o&&(r.memoizedState=a,ys=!0),r=r.queue,Po(To.bind(null,n,r,e),[e]),r.getSnapshot!==t||o||null!==co&&1&co.memoizedState.tag){if(n.flags|=2048,Lo(9,Eo.bind(null,n,r,a,t),void 0,null),null===kc)throw Error(i(349));0!==(30&io)||_o(n,t,a)}return a}function _o(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=oo.updateQueue)?(t={lastEffect:null,stores:null},oo.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Eo(e,t,n,r){t.value=n,t.getSnapshot=r,Io(t)&&ko(e)}function To(e,t,n){return n((function(){Io(t)&&ko(e)}))}function Io(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!sr(e,n)}catch(r){return!0}}function ko(e){var t=Di(e,1);null!==t&&nu(t,e,1,-1)}function No(e){var t=bo();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:xo,lastRenderedState:e},t.queue=e,e=e.dispatch=qo.bind(null,oo,e),[t.memoizedState,e]}function Lo(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=oo.updateQueue)?(t={lastEffect:null,stores:null},oo.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Ao(){return yo().memoizedState}function Ro(e,t,n,r){var a=bo();oo.flags|=e,a.memoizedState=Lo(1|t,n,void 0,void 0===r?null:r)}function Do(e,t,n,r){var a=yo();r=void 0===r?null:r;var i=void 0;if(null!==so){var o=so.memoizedState;if(i=o.destroy,null!==r&&go(r,o.deps))return void(a.memoizedState=Lo(t,n,i,r))}oo.flags|=e,a.memoizedState=Lo(1|t,n,i,r)}function Oo(e,t){return Ro(8390656,8,e,t)}function Po(e,t){return Do(2048,8,e,t)}function Fo(e,t){return Do(4,2,e,t)}function zo(e,t){return Do(4,4,e,t)}function jo(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Bo(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Do(4,4,jo.bind(null,t,e),n)}function Uo(){}function Wo(e,t){var n=yo();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&go(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Go(e,t){var n=yo();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&go(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Vo(e,t,n){return 0===(21&io)?(e.baseState&&(e.baseState=!1,ys=!0),e.memoizedState=n):(sr(n,t)||(n=gt(),oo.lanes|=n,Pc|=n,e.baseState=!0),t)}function Ho(e,t){var n=yt;yt=0!==n&&4>n?n:4,e(!0);var r=ao.transition;ao.transition={};try{e(!1),t()}finally{yt=n,ao.transition=r}}function Yo(){return yo().memoizedState}function Xo(e,t,n){var r=tu(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Ko(e))Qo(t,n);else if(null!==(n=Ri(e,t,n,r))){nu(n,e,r,eu()),Jo(n,t,r)}}function qo(e,t,n){var r=tu(e),a={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Ko(e))Qo(t,a);else{var i=e.alternate;if(0===e.lanes&&(null===i||0===i.lanes)&&null!==(i=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=i(o,n);if(a.hasEagerState=!0,a.eagerState=s,sr(s,o)){var c=t.interleaved;return null===c?(a.next=a,Ai(t)):(a.next=c.next,c.next=a),void(t.interleaved=a)}}catch(u){}null!==(n=Ri(e,t,a,r))&&(nu(n,e,r,a=eu()),Jo(n,t,r))}}function Ko(e){var t=e.alternate;return e===oo||null!==t&&t===oo}function Qo(e,t){lo=uo=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Jo(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,bt(e,n)}}var Zo={readContext:Ni,useCallback:po,useContext:po,useEffect:po,useImperativeHandle:po,useInsertionEffect:po,useLayoutEffect:po,useMemo:po,useReducer:po,useRef:po,useState:po,useDebugValue:po,useDeferredValue:po,useTransition:po,useMutableSource:po,useSyncExternalStore:po,useId:po,unstable_isNewReconciler:!1},$o={readContext:Ni,useCallback:function(e,t){return bo().memoizedState=[e,void 0===t?null:t],e},useContext:Ni,useEffect:Oo,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ro(4194308,4,jo.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Ro(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ro(4,2,e,t)},useMemo:function(e,t){var n=bo();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=bo();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Xo.bind(null,oo,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},bo().memoizedState=e},useState:No,useDebugValue:Uo,useDeferredValue:function(e){return bo().memoizedState=e},useTransition:function(){var e=No(!1),t=e[0];return e=Ho.bind(null,e[1]),bo().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=oo,a=bo();if(ai){if(void 0===n)throw Error(i(407));n=n()}else{if(n=t(),null===kc)throw Error(i(349));0!==(30&io)||_o(r,t,n)}a.memoizedState=n;var o={value:n,getSnapshot:t};return a.queue=o,Oo(To.bind(null,r,o,e),[e]),r.flags|=2048,Lo(9,Eo.bind(null,r,o,n,t),void 0,null),n},useId:function(){var e=bo(),t=kc.identifierPrefix;if(ai){var n=Ja;t=":"+t+"R"+(n=(Qa&~(1<<32-ot(Qa)-1)).toString(32)+n),0<(n=fo++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=ho++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},es={readContext:Ni,useCallback:Wo,useContext:Ni,useEffect:Po,useImperativeHandle:Bo,useInsertionEffect:Fo,useLayoutEffect:zo,useMemo:Go,useReducer:wo,useRef:Ao,useState:function(){return wo(xo)},useDebugValue:Uo,useDeferredValue:function(e){return Vo(yo(),so.memoizedState,e)},useTransition:function(){return[wo(xo)[0],yo().memoizedState]},useMutableSource:Co,useSyncExternalStore:Mo,useId:Yo,unstable_isNewReconciler:!1},ts={readContext:Ni,useCallback:Wo,useContext:Ni,useEffect:Po,useImperativeHandle:Bo,useInsertionEffect:Fo,useLayoutEffect:zo,useMemo:Go,useReducer:So,useRef:Ao,useState:function(){return So(xo)},useDebugValue:Uo,useDeferredValue:function(e){var t=yo();return null===so?t.memoizedState=e:Vo(t,so.memoizedState,e)},useTransition:function(){return[So(xo)[0],yo().memoizedState]},useMutableSource:Co,useSyncExternalStore:Mo,useId:Yo,unstable_isNewReconciler:!1};function ns(e,t){if(e&&e.defaultProps){for(var n in t=F({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function rs(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:F({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var as={isMounted:function(e){return!!(e=e._reactInternals)&&We(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=eu(),a=tu(e),i=zi(r,a);i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=ji(e,i,a))&&(nu(t,e,a,r),Bi(t,e,a))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=eu(),a=tu(e),i=zi(r,a);i.tag=1,i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=ji(e,i,a))&&(nu(t,e,a,r),Bi(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=eu(),r=tu(e),a=zi(n,r);a.tag=2,void 0!==t&&null!==t&&(a.callback=t),null!==(t=ji(e,a,r))&&(nu(t,e,r,n),Bi(t,e,r))}};function is(e,t,n,r,a,i,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,i,o):!t.prototype||!t.prototype.isPureReactComponent||(!cr(n,r)||!cr(a,i))}function os(e,t,n){var r=!1,a=Ta,i=t.contextType;return"object"===typeof i&&null!==i?i=Ni(i):(a=Aa(t)?Na:Ia.current,i=(r=null!==(r=t.contextTypes)&&void 0!==r)?La(e,a):Ta),t=new t(n,i),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=as,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function ss(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&as.enqueueReplaceState(t,t.state,null)}function cs(e,t,n,r){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs={},Pi(e);var i=t.contextType;"object"===typeof i&&null!==i?a.context=Ni(i):(i=Aa(t)?Na:Ia.current,a.context=La(e,i)),a.state=e.memoizedState,"function"===typeof(i=t.getDerivedStateFromProps)&&(rs(e,t,i,n),a.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof a.getSnapshotBeforeUpdate||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||(t=a.state,"function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),t!==a.state&&as.enqueueReplaceState(a,a.state,null),Wi(e,n,a,r),a.state=e.memoizedState),"function"===typeof a.componentDidMount&&(e.flags|=4194308)}function us(e,t){try{var n="",r=t;do{n+=U(r),r=r.return}while(r);var a=n}catch(i){a="\nError generating stack: "+i.message+"\n"+i.stack}return{value:e,source:t,stack:a,digest:null}}function ls(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function fs(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var ds="function"===typeof WeakMap?WeakMap:Map;function hs(e,t,n){(n=zi(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Vc||(Vc=!0,Hc=r),fs(0,t)},n}function ps(e,t,n){(n=zi(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var a=t.value;n.payload=function(){return r(a)},n.callback=function(){fs(0,t)}}var i=e.stateNode;return null!==i&&"function"===typeof i.componentDidCatch&&(n.callback=function(){fs(0,t),"function"!==typeof r&&(null===Yc?Yc=new Set([this]):Yc.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function gs(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new ds;var a=new Set;r.set(t,a)}else void 0===(a=r.get(t))&&(a=new Set,r.set(t,a));a.has(n)||(a.add(n),e=_u.bind(null,e,t,n),t.then(e,e))}function ms(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function vs(e,t,n,r,a){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=zi(-1,1)).tag=2,ji(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=a,e)}var bs=x.ReactCurrentOwner,ys=!1;function xs(e,t,n,r){t.child=null===e?wi(t,null,n,r):xi(t,e.child,n,r)}function ws(e,t,n,r,a){n=n.render;var i=t.ref;return ki(t,a),r=mo(e,t,n,r,i,a),n=vo(),null===e||ys?(ai&&n&&ei(t),t.flags|=1,xs(e,t,r,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Vs(e,t,a))}function Ss(e,t,n,r,a){if(null===e){var i=n.type;return"function"!==typeof i||Au(i)||void 0!==i.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Du(n.type,null,r,t,t.mode,a)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=i,Cs(e,t,i,r,a))}if(i=e.child,0===(e.lanes&a)){var o=i.memoizedProps;if((n=null!==(n=n.compare)?n:cr)(o,r)&&e.ref===t.ref)return Vs(e,t,a)}return t.flags|=1,(e=Ru(i,r)).ref=t.ref,e.return=t,t.child=e}function Cs(e,t,n,r,a){if(null!==e){var i=e.memoizedProps;if(cr(i,r)&&e.ref===t.ref){if(ys=!1,t.pendingProps=r=i,0===(e.lanes&a))return t.lanes=e.lanes,Vs(e,t,a);0!==(131072&e.flags)&&(ys=!0)}}return Es(e,t,n,r,a)}function Ms(e,t,n){var r=t.pendingProps,a=r.children,i=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ea(Rc,Ac),Ac|=n;else{if(0===(1073741824&n))return e=null!==i?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ea(Rc,Ac),Ac|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==i?i.baseLanes:n,Ea(Rc,Ac),Ac|=r}else null!==i?(r=i.baseLanes|n,t.memoizedState=null):r=n,Ea(Rc,Ac),Ac|=r;return xs(e,t,a,n),t.child}function _s(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Es(e,t,n,r,a){var i=Aa(n)?Na:Ia.current;return i=La(t,i),ki(t,a),n=mo(e,t,n,r,i,a),r=vo(),null===e||ys?(ai&&r&&ei(t),t.flags|=1,xs(e,t,n,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Vs(e,t,a))}function Ts(e,t,n,r,a){if(Aa(n)){var i=!0;Pa(t)}else i=!1;if(ki(t,a),null===t.stateNode)Gs(e,t),os(t,n,r),cs(t,n,r,a),r=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var c=o.context,u=n.contextType;"object"===typeof u&&null!==u?u=Ni(u):u=La(t,u=Aa(n)?Na:Ia.current);var l=n.getDerivedStateFromProps,f="function"===typeof l||"function"===typeof o.getSnapshotBeforeUpdate;f||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||c!==u)&&ss(t,o,r,u),Oi=!1;var d=t.memoizedState;o.state=d,Wi(t,r,o,a),c=t.memoizedState,s!==r||d!==c||ka.current||Oi?("function"===typeof l&&(rs(t,n,l,r),c=t.memoizedState),(s=Oi||is(t,n,s,r,d,c,u))?(f||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),o.props=r,o.state=c,o.context=u,r=s):("function"===typeof o.componentDidMount&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,Fi(e,t),s=t.memoizedProps,u=t.type===t.elementType?s:ns(t.type,s),o.props=u,f=t.pendingProps,d=o.context,"object"===typeof(c=n.contextType)&&null!==c?c=Ni(c):c=La(t,c=Aa(n)?Na:Ia.current);var h=n.getDerivedStateFromProps;(l="function"===typeof h||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==f||d!==c)&&ss(t,o,r,c),Oi=!1,d=t.memoizedState,o.state=d,Wi(t,r,o,a);var p=t.memoizedState;s!==f||d!==p||ka.current||Oi?("function"===typeof h&&(rs(t,n,h,r),p=t.memoizedState),(u=Oi||is(t,n,u,r,d,p,c)||!1)?(l||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,p,c),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,p,c)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),o.props=r,o.state=p,o.context=c,r=u):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return Is(e,t,n,r,i,a)}function Is(e,t,n,r,a,i){_s(e,t);var o=0!==(128&t.flags);if(!r&&!o)return a&&Fa(t,n,!1),Vs(e,t,i);r=t.stateNode,bs.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&o?(t.child=xi(t,e.child,null,i),t.child=xi(t,null,s,i)):xs(e,t,s,i),t.memoizedState=r.state,a&&Fa(t,n,!0),t.child}function ks(e){var t=e.stateNode;t.pendingContext?Da(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Da(0,t.context,!1),Ki(e,t.containerInfo)}function Ns(e,t,n,r,a){return hi(),pi(a),t.flags|=256,xs(e,t,n,r),t.child}var Ls,As,Rs,Ds,Os={dehydrated:null,treeContext:null,retryLane:0};function Ps(e){return{baseLanes:e,cachePool:null,transitions:null}}function Fs(e,t,n){var r,a=t.pendingProps,o=$i.current,s=!1,c=0!==(128&t.flags);if((r=c)||(r=(null===e||null!==e.memoizedState)&&0!==(2&o)),r?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Ea($i,1&o),null===e)return ui(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(c=a.children,e=a.fallback,s?(a=t.mode,s=t.child,c={mode:"hidden",children:c},0===(1&a)&&null!==s?(s.childLanes=0,s.pendingProps=c):s=Pu(c,a,0,null),e=Ou(e,a,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Ps(n),t.memoizedState=Os,e):zs(t,c));if(null!==(o=e.memoizedState)&&null!==(r=o.dehydrated))return function(e,t,n,r,a,o,s){if(n)return 256&t.flags?(t.flags&=-257,js(e,t,s,r=ls(Error(i(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=r.fallback,a=t.mode,r=Pu({mode:"visible",children:r.children},a,0,null),(o=Ou(o,a,s,null)).flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,0!==(1&t.mode)&&xi(t,e.child,null,s),t.child.memoizedState=Ps(s),t.memoizedState=Os,o);if(0===(1&t.mode))return js(e,t,s,null);if("$!"===a.data){if(r=a.nextSibling&&a.nextSibling.dataset)var c=r.dgst;return r=c,js(e,t,s,r=ls(o=Error(i(419)),r,void 0))}if(c=0!==(s&e.childLanes),ys||c){if(null!==(r=kc)){switch(s&-s){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}0!==(a=0!==(a&(r.suspendedLanes|s))?0:a)&&a!==o.retryLane&&(o.retryLane=a,Di(e,a),nu(r,e,a,-1))}return gu(),js(e,t,s,r=ls(Error(i(421))))}return"$?"===a.data?(t.flags|=128,t.child=e.child,t=Tu.bind(null,e),a._reactRetry=t,null):(e=o.treeContext,ri=ua(a.nextSibling),ni=t,ai=!0,ii=null,null!==e&&(Xa[qa++]=Qa,Xa[qa++]=Ja,Xa[qa++]=Ka,Qa=e.id,Ja=e.overflow,Ka=t),t=zs(t,r.children),t.flags|=4096,t)}(e,t,c,a,r,o,n);if(s){s=a.fallback,c=t.mode,r=(o=e.child).sibling;var u={mode:"hidden",children:a.children};return 0===(1&c)&&t.child!==o?((a=t.child).childLanes=0,a.pendingProps=u,t.deletions=null):(a=Ru(o,u)).subtreeFlags=14680064&o.subtreeFlags,null!==r?s=Ru(r,s):(s=Ou(s,c,n,null)).flags|=2,s.return=t,a.return=t,a.sibling=s,t.child=a,a=s,s=t.child,c=null===(c=e.child.memoizedState)?Ps(n):{baseLanes:c.baseLanes|n,cachePool:null,transitions:c.transitions},s.memoizedState=c,s.childLanes=e.childLanes&~n,t.memoizedState=Os,a}return e=(s=e.child).sibling,a=Ru(s,{mode:"visible",children:a.children}),0===(1&t.mode)&&(a.lanes=n),a.return=t,a.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=a,t.memoizedState=null,a}function zs(e,t){return(t=Pu({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function js(e,t,n,r){return null!==r&&pi(r),xi(t,e.child,null,n),(e=zs(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Bs(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Ii(e.return,t,n)}function Us(e,t,n,r,a){var i=e.memoizedState;null===i?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=a)}function Ws(e,t,n){var r=t.pendingProps,a=r.revealOrder,i=r.tail;if(xs(e,t,r.children,n),0!==(2&(r=$i.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Bs(e,n,t);else if(19===e.tag)Bs(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ea($i,r),0===(1&t.mode))t.memoizedState=null;else switch(a){case"forwards":for(n=t.child,a=null;null!==n;)null!==(e=n.alternate)&&null===eo(e)&&(a=n),n=n.sibling;null===(n=a)?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),Us(t,!1,a,n,i);break;case"backwards":for(n=null,a=t.child,t.child=null;null!==a;){if(null!==(e=a.alternate)&&null===eo(e)){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}Us(t,!0,n,null,i);break;case"together":Us(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Gs(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Vs(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Pc|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(i(153));if(null!==t.child){for(n=Ru(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Ru(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Hs(e,t){if(!ai)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Ys(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=14680064&a.subtreeFlags,r|=14680064&a.flags,a.return=e,a=a.sibling;else for(a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Xs(e,t,n){var r=t.pendingProps;switch(ti(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ys(t),null;case 1:case 17:return Aa(t.type)&&Ra(),Ys(t),null;case 3:return r=t.stateNode,Qi(),_a(ka),_a(Ia),no(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(fi(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ii&&(ou(ii),ii=null))),As(e,t),Ys(t),null;case 5:Zi(t);var a=qi(Xi.current);if(n=t.type,null!==e&&null!=t.stateNode)Rs(e,t,n,r,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(i(166));return Ys(t),null}if(e=qi(Hi.current),fi(t)){r=t.stateNode,n=t.type;var o=t.memoizedProps;switch(r[da]=t,r[ha]=o,e=0!==(1&t.mode),n){case"dialog":jr("cancel",r),jr("close",r);break;case"iframe":case"object":case"embed":jr("load",r);break;case"video":case"audio":for(a=0;a<Or.length;a++)jr(Or[a],r);break;case"source":jr("error",r);break;case"img":case"image":case"link":jr("error",r),jr("load",r);break;case"details":jr("toggle",r);break;case"input":Q(r,o),jr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},jr("invalid",r);break;case"textarea":ae(r,o),jr("invalid",r)}for(var c in be(n,o),a=null,o)if(o.hasOwnProperty(c)){var u=o[c];"children"===c?"string"===typeof u?r.textContent!==u&&(!0!==o.suppressHydrationWarning&&Zr(r.textContent,u,e),a=["children",u]):"number"===typeof u&&r.textContent!==""+u&&(!0!==o.suppressHydrationWarning&&Zr(r.textContent,u,e),a=["children",""+u]):s.hasOwnProperty(c)&&null!=u&&"onScroll"===c&&jr("scroll",r)}switch(n){case"input":Y(r),$(r,o,!0);break;case"textarea":Y(r),oe(r);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(r.onclick=$r)}r=a,t.updateQueue=r,null!==r&&(t.flags|=4)}else{c=9===a.nodeType?a:a.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=c.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=c.createElement(n,{is:r.is}):(e=c.createElement(n),"select"===n&&(c=e,r.multiple?c.multiple=!0:r.size&&(c.size=r.size))):e=c.createElementNS(e,n),e[da]=t,e[ha]=r,Ls(e,t,!1,!1),t.stateNode=e;e:{switch(c=ye(n,r),n){case"dialog":jr("cancel",e),jr("close",e),a=r;break;case"iframe":case"object":case"embed":jr("load",e),a=r;break;case"video":case"audio":for(a=0;a<Or.length;a++)jr(Or[a],e);a=r;break;case"source":jr("error",e),a=r;break;case"img":case"image":case"link":jr("error",e),jr("load",e),a=r;break;case"details":jr("toggle",e),a=r;break;case"input":Q(e,r),a=K(e,r),jr("invalid",e);break;case"option":default:a=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=F({},r,{value:void 0}),jr("invalid",e);break;case"textarea":ae(e,r),a=re(e,r),jr("invalid",e)}for(o in be(n,a),u=a)if(u.hasOwnProperty(o)){var l=u[o];"style"===o?me(e,l):"dangerouslySetInnerHTML"===o?null!=(l=l?l.__html:void 0)&&fe(e,l):"children"===o?"string"===typeof l?("textarea"!==n||""!==l)&&de(e,l):"number"===typeof l&&de(e,""+l):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(s.hasOwnProperty(o)?null!=l&&"onScroll"===o&&jr("scroll",e):null!=l&&y(e,o,l,c))}switch(n){case"input":Y(e),$(e,r,!1);break;case"textarea":Y(e),oe(e);break;case"option":null!=r.value&&e.setAttribute("value",""+V(r.value));break;case"select":e.multiple=!!r.multiple,null!=(o=r.value)?ne(e,!!r.multiple,o,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof a.onClick&&(e.onclick=$r)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Ys(t),null;case 6:if(e&&null!=t.stateNode)Ds(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(i(166));if(n=qi(Xi.current),qi(Hi.current),fi(t)){if(r=t.stateNode,n=t.memoizedProps,r[da]=t,(o=r.nodeValue!==n)&&null!==(e=ni))switch(e.tag){case 3:Zr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Zr(r.nodeValue,n,0!==(1&e.mode))}o&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[da]=t,t.stateNode=r}return Ys(t),null;case 13:if(_a($i),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ai&&null!==ri&&0!==(1&t.mode)&&0===(128&t.flags))di(),hi(),t.flags|=98560,o=!1;else if(o=fi(t),null!==r&&null!==r.dehydrated){if(null===e){if(!o)throw Error(i(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(i(317));o[da]=t}else hi(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Ys(t),o=!1}else null!==ii&&(ou(ii),ii=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&$i.current)?0===Dc&&(Dc=3):gu())),null!==t.updateQueue&&(t.flags|=4),Ys(t),null);case 4:return Qi(),As(e,t),null===e&&Wr(t.stateNode.containerInfo),Ys(t),null;case 10:return Ti(t.type._context),Ys(t),null;case 19:if(_a($i),null===(o=t.memoizedState))return Ys(t),null;if(r=0!==(128&t.flags),null===(c=o.rendering))if(r)Hs(o,!1);else{if(0!==Dc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(c=eo(e))){for(t.flags|=128,Hs(o,!1),null!==(r=c.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(o=n).flags&=14680066,null===(c=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=c.childLanes,o.lanes=c.lanes,o.child=c.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=c.memoizedProps,o.memoizedState=c.memoizedState,o.updateQueue=c.updateQueue,o.type=c.type,e=c.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ea($i,1&$i.current|2),t.child}e=e.sibling}null!==o.tail&&Je()>Wc&&(t.flags|=128,r=!0,Hs(o,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=eo(c))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Hs(o,!0),null===o.tail&&"hidden"===o.tailMode&&!c.alternate&&!ai)return Ys(t),null}else 2*Je()-o.renderingStartTime>Wc&&1073741824!==n&&(t.flags|=128,r=!0,Hs(o,!1),t.lanes=4194304);o.isBackwards?(c.sibling=t.child,t.child=c):(null!==(n=o.last)?n.sibling=c:t.child=c,o.last=c)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Je(),t.sibling=null,n=$i.current,Ea($i,r?1&n|2:1&n),t):(Ys(t),null);case 22:case 23:return fu(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Ac)&&(Ys(t),6&t.subtreeFlags&&(t.flags|=8192)):Ys(t),null;case 24:case 25:return null}throw Error(i(156,t.tag))}function qs(e,t){switch(ti(t),t.tag){case 1:return Aa(t.type)&&Ra(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Qi(),_a(ka),_a(Ia),no(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Zi(t),null;case 13:if(_a($i),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(i(340));hi()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return _a($i),null;case 4:return Qi(),null;case 10:return Ti(t.type._context),null;case 22:case 23:return fu(),null;default:return null}}Ls=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},As=function(){},Rs=function(e,t,n,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,qi(Hi.current);var i,o=null;switch(n){case"input":a=K(e,a),r=K(e,r),o=[];break;case"select":a=F({},a,{value:void 0}),r=F({},r,{value:void 0}),o=[];break;case"textarea":a=re(e,a),r=re(e,r),o=[];break;default:"function"!==typeof a.onClick&&"function"===typeof r.onClick&&(e.onclick=$r)}for(l in be(n,r),n=null,a)if(!r.hasOwnProperty(l)&&a.hasOwnProperty(l)&&null!=a[l])if("style"===l){var c=a[l];for(i in c)c.hasOwnProperty(i)&&(n||(n={}),n[i]="")}else"dangerouslySetInnerHTML"!==l&&"children"!==l&&"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&"autoFocus"!==l&&(s.hasOwnProperty(l)?o||(o=[]):(o=o||[]).push(l,null));for(l in r){var u=r[l];if(c=null!=a?a[l]:void 0,r.hasOwnProperty(l)&&u!==c&&(null!=u||null!=c))if("style"===l)if(c){for(i in c)!c.hasOwnProperty(i)||u&&u.hasOwnProperty(i)||(n||(n={}),n[i]="");for(i in u)u.hasOwnProperty(i)&&c[i]!==u[i]&&(n||(n={}),n[i]=u[i])}else n||(o||(o=[]),o.push(l,n)),n=u;else"dangerouslySetInnerHTML"===l?(u=u?u.__html:void 0,c=c?c.__html:void 0,null!=u&&c!==u&&(o=o||[]).push(l,u)):"children"===l?"string"!==typeof u&&"number"!==typeof u||(o=o||[]).push(l,""+u):"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&(s.hasOwnProperty(l)?(null!=u&&"onScroll"===l&&jr("scroll",e),o||c===u||(o=[])):(o=o||[]).push(l,u))}n&&(o=o||[]).push("style",n);var l=o;(t.updateQueue=l)&&(t.flags|=4)}},Ds=function(e,t,n,r){n!==r&&(t.flags|=4)};var Ks=!1,Qs=!1,Js="function"===typeof WeakSet?WeakSet:Set,Zs=null;function $s(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){Mu(e,t,r)}else n.current=null}function ec(e,t,n){try{n()}catch(r){Mu(e,t,r)}}var tc=!1;function nc(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var a=r=r.next;do{if((a.tag&e)===e){var i=a.destroy;a.destroy=void 0,void 0!==i&&ec(t,n,i)}a=a.next}while(a!==r)}}function rc(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function ac(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function ic(e){var t=e.alternate;null!==t&&(e.alternate=null,ic(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[da],delete t[ha],delete t[ga],delete t[ma],delete t[va])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function oc(e){return 5===e.tag||3===e.tag||4===e.tag}function sc(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||oc(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function cc(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=$r));else if(4!==r&&null!==(e=e.child))for(cc(e,t,n),e=e.sibling;null!==e;)cc(e,t,n),e=e.sibling}function uc(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(uc(e,t,n),e=e.sibling;null!==e;)uc(e,t,n),e=e.sibling}var lc=null,fc=!1;function dc(e,t,n){for(n=n.child;null!==n;)hc(e,t,n),n=n.sibling}function hc(e,t,n){if(it&&"function"===typeof it.onCommitFiberUnmount)try{it.onCommitFiberUnmount(at,n)}catch(s){}switch(n.tag){case 5:Qs||$s(n,t);case 6:var r=lc,a=fc;lc=null,dc(e,t,n),fc=a,null!==(lc=r)&&(fc?(e=lc,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):lc.removeChild(n.stateNode));break;case 18:null!==lc&&(fc?(e=lc,n=n.stateNode,8===e.nodeType?ca(e.parentNode,n):1===e.nodeType&&ca(e,n),Wt(e)):ca(lc,n.stateNode));break;case 4:r=lc,a=fc,lc=n.stateNode.containerInfo,fc=!0,dc(e,t,n),lc=r,fc=a;break;case 0:case 11:case 14:case 15:if(!Qs&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){a=r=r.next;do{var i=a,o=i.destroy;i=i.tag,void 0!==o&&(0!==(2&i)||0!==(4&i))&&ec(n,t,o),a=a.next}while(a!==r)}dc(e,t,n);break;case 1:if(!Qs&&($s(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){Mu(n,t,s)}dc(e,t,n);break;case 21:dc(e,t,n);break;case 22:1&n.mode?(Qs=(r=Qs)||null!==n.memoizedState,dc(e,t,n),Qs=r):dc(e,t,n);break;default:dc(e,t,n)}}function pc(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Js),t.forEach((function(t){var r=Iu.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function gc(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var a=n[r];try{var o=e,s=t,c=s;e:for(;null!==c;){switch(c.tag){case 5:lc=c.stateNode,fc=!1;break e;case 3:case 4:lc=c.stateNode.containerInfo,fc=!0;break e}c=c.return}if(null===lc)throw Error(i(160));hc(o,s,a),lc=null,fc=!1;var u=a.alternate;null!==u&&(u.return=null),a.return=null}catch(l){Mu(a,t,l)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)mc(t,e),t=t.sibling}function mc(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(gc(t,e),vc(e),4&r){try{nc(3,e,e.return),rc(3,e)}catch(m){Mu(e,e.return,m)}try{nc(5,e,e.return)}catch(m){Mu(e,e.return,m)}}break;case 1:gc(t,e),vc(e),512&r&&null!==n&&$s(n,n.return);break;case 5:if(gc(t,e),vc(e),512&r&&null!==n&&$s(n,n.return),32&e.flags){var a=e.stateNode;try{de(a,"")}catch(m){Mu(e,e.return,m)}}if(4&r&&null!=(a=e.stateNode)){var o=e.memoizedProps,s=null!==n?n.memoizedProps:o,c=e.type,u=e.updateQueue;if(e.updateQueue=null,null!==u)try{"input"===c&&"radio"===o.type&&null!=o.name&&J(a,o),ye(c,s);var l=ye(c,o);for(s=0;s<u.length;s+=2){var f=u[s],d=u[s+1];"style"===f?me(a,d):"dangerouslySetInnerHTML"===f?fe(a,d):"children"===f?de(a,d):y(a,f,d,l)}switch(c){case"input":Z(a,o);break;case"textarea":ie(a,o);break;case"select":var h=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!o.multiple;var p=o.value;null!=p?ne(a,!!o.multiple,p,!1):h!==!!o.multiple&&(null!=o.defaultValue?ne(a,!!o.multiple,o.defaultValue,!0):ne(a,!!o.multiple,o.multiple?[]:"",!1))}a[ha]=o}catch(m){Mu(e,e.return,m)}}break;case 6:if(gc(t,e),vc(e),4&r){if(null===e.stateNode)throw Error(i(162));a=e.stateNode,o=e.memoizedProps;try{a.nodeValue=o}catch(m){Mu(e,e.return,m)}}break;case 3:if(gc(t,e),vc(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Wt(t.containerInfo)}catch(m){Mu(e,e.return,m)}break;case 4:default:gc(t,e),vc(e);break;case 13:gc(t,e),vc(e),8192&(a=e.child).flags&&(o=null!==a.memoizedState,a.stateNode.isHidden=o,!o||null!==a.alternate&&null!==a.alternate.memoizedState||(Uc=Je())),4&r&&pc(e);break;case 22:if(f=null!==n&&null!==n.memoizedState,1&e.mode?(Qs=(l=Qs)||f,gc(t,e),Qs=l):gc(t,e),vc(e),8192&r){if(l=null!==e.memoizedState,(e.stateNode.isHidden=l)&&!f&&0!==(1&e.mode))for(Zs=e,f=e.child;null!==f;){for(d=Zs=f;null!==Zs;){switch(p=(h=Zs).child,h.tag){case 0:case 11:case 14:case 15:nc(4,h,h.return);break;case 1:$s(h,h.return);var g=h.stateNode;if("function"===typeof g.componentWillUnmount){r=h,n=h.return;try{t=r,g.props=t.memoizedProps,g.state=t.memoizedState,g.componentWillUnmount()}catch(m){Mu(r,n,m)}}break;case 5:$s(h,h.return);break;case 22:if(null!==h.memoizedState){wc(d);continue}}null!==p?(p.return=h,Zs=p):wc(d)}f=f.sibling}e:for(f=null,d=e;;){if(5===d.tag){if(null===f){f=d;try{a=d.stateNode,l?"function"===typeof(o=a.style).setProperty?o.setProperty("display","none","important"):o.display="none":(c=d.stateNode,s=void 0!==(u=d.memoizedProps.style)&&null!==u&&u.hasOwnProperty("display")?u.display:null,c.style.display=ge("display",s))}catch(m){Mu(e,e.return,m)}}}else if(6===d.tag){if(null===f)try{d.stateNode.nodeValue=l?"":d.memoizedProps}catch(m){Mu(e,e.return,m)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;f===d&&(f=null),d=d.return}f===d&&(f=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:gc(t,e),vc(e),4&r&&pc(e);case 21:}}function vc(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(oc(n)){var r=n;break e}n=n.return}throw Error(i(160))}switch(r.tag){case 5:var a=r.stateNode;32&r.flags&&(de(a,""),r.flags&=-33),uc(e,sc(e),a);break;case 3:case 4:var o=r.stateNode.containerInfo;cc(e,sc(e),o);break;default:throw Error(i(161))}}catch(s){Mu(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function bc(e,t,n){Zs=e,yc(e,t,n)}function yc(e,t,n){for(var r=0!==(1&e.mode);null!==Zs;){var a=Zs,i=a.child;if(22===a.tag&&r){var o=null!==a.memoizedState||Ks;if(!o){var s=a.alternate,c=null!==s&&null!==s.memoizedState||Qs;s=Ks;var u=Qs;if(Ks=o,(Qs=c)&&!u)for(Zs=a;null!==Zs;)c=(o=Zs).child,22===o.tag&&null!==o.memoizedState?Sc(a):null!==c?(c.return=o,Zs=c):Sc(a);for(;null!==i;)Zs=i,yc(i,t,n),i=i.sibling;Zs=a,Ks=s,Qs=u}xc(e)}else 0!==(8772&a.subtreeFlags)&&null!==i?(i.return=a,Zs=i):xc(e)}}function xc(e){for(;null!==Zs;){var t=Zs;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Qs||rc(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Qs)if(null===n)r.componentDidMount();else{var a=t.elementType===t.type?n.memoizedProps:ns(t.type,n.memoizedProps);r.componentDidUpdate(a,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&Gi(t,o,r);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Gi(t,s,n)}break;case 5:var c=t.stateNode;if(null===n&&4&t.flags){n=c;var u=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var l=t.alternate;if(null!==l){var f=l.memoizedState;if(null!==f){var d=f.dehydrated;null!==d&&Wt(d)}}}break;default:throw Error(i(163))}Qs||512&t.flags&&ac(t)}catch(h){Mu(t,t.return,h)}}if(t===e){Zs=null;break}if(null!==(n=t.sibling)){n.return=t.return,Zs=n;break}Zs=t.return}}function wc(e){for(;null!==Zs;){var t=Zs;if(t===e){Zs=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Zs=n;break}Zs=t.return}}function Sc(e){for(;null!==Zs;){var t=Zs;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{rc(4,t)}catch(c){Mu(t,n,c)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var a=t.return;try{r.componentDidMount()}catch(c){Mu(t,a,c)}}var i=t.return;try{ac(t)}catch(c){Mu(t,i,c)}break;case 5:var o=t.return;try{ac(t)}catch(c){Mu(t,o,c)}}}catch(c){Mu(t,t.return,c)}if(t===e){Zs=null;break}var s=t.sibling;if(null!==s){s.return=t.return,Zs=s;break}Zs=t.return}}var Cc,Mc=Math.ceil,_c=x.ReactCurrentDispatcher,Ec=x.ReactCurrentOwner,Tc=x.ReactCurrentBatchConfig,Ic=0,kc=null,Nc=null,Lc=0,Ac=0,Rc=Ma(0),Dc=0,Oc=null,Pc=0,Fc=0,zc=0,jc=null,Bc=null,Uc=0,Wc=1/0,Gc=null,Vc=!1,Hc=null,Yc=null,Xc=!1,qc=null,Kc=0,Qc=0,Jc=null,Zc=-1,$c=0;function eu(){return 0!==(6&Ic)?Je():-1!==Zc?Zc:Zc=Je()}function tu(e){return 0===(1&e.mode)?1:0!==(2&Ic)&&0!==Lc?Lc&-Lc:null!==gi.transition?(0===$c&&($c=gt()),$c):0!==(e=yt)?e:e=void 0===(e=window.event)?16:Qt(e.type)}function nu(e,t,n,r){if(50<Qc)throw Qc=0,Jc=null,Error(i(185));vt(e,n,r),0!==(2&Ic)&&e===kc||(e===kc&&(0===(2&Ic)&&(Fc|=n),4===Dc&&su(e,Lc)),ru(e,r),1===n&&0===Ic&&0===(1&t.mode)&&(Wc=Je()+500,ja&&Wa()))}function ru(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,i=e.pendingLanes;0<i;){var o=31-ot(i),s=1<<o,c=a[o];-1===c?0!==(s&n)&&0===(s&r)||(a[o]=ht(s,t)):c<=t&&(e.expiredLanes|=s),i&=~s}}(e,t);var r=dt(e,e===kc?Lc:0);if(0===r)null!==n&&qe(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&qe(n),1===t)0===e.tag?function(e){ja=!0,Ua(e)}(cu.bind(null,e)):Ua(cu.bind(null,e)),oa((function(){0===(6&Ic)&&Wa()})),n=null;else{switch(xt(r)){case 1:n=$e;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=ku(n,au.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function au(e,t){if(Zc=-1,$c=0,0!==(6&Ic))throw Error(i(327));var n=e.callbackNode;if(Su()&&e.callbackNode!==n)return null;var r=dt(e,e===kc?Lc:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=mu(e,r);else{t=r;var a=Ic;Ic|=2;var o=pu();for(kc===e&&Lc===t||(Gc=null,Wc=Je()+500,du(e,t));;)try{bu();break}catch(c){hu(e,c)}Ei(),_c.current=o,Ic=a,null!==Nc?t=0:(kc=null,Lc=0,t=Dc)}if(0!==t){if(2===t&&(0!==(a=pt(e))&&(r=a,t=iu(e,a))),1===t)throw n=Oc,du(e,0),su(e,r),ru(e,Je()),n;if(6===t)su(e,r);else{if(a=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var a=n[r],i=a.getSnapshot;a=a.value;try{if(!sr(i(),a))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(a)&&(2===(t=mu(e,r))&&(0!==(o=pt(e))&&(r=o,t=iu(e,o))),1===t))throw n=Oc,du(e,0),su(e,r),ru(e,Je()),n;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(i(345));case 2:case 5:wu(e,Bc,Gc);break;case 3:if(su(e,r),(130023424&r)===r&&10<(t=Uc+500-Je())){if(0!==dt(e,0))break;if(((a=e.suspendedLanes)&r)!==r){eu(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=ra(wu.bind(null,e,Bc,Gc),t);break}wu(e,Bc,Gc);break;case 4:if(su(e,r),(4194240&r)===r)break;for(t=e.eventTimes,a=-1;0<r;){var s=31-ot(r);o=1<<s,(s=t[s])>a&&(a=s),r&=~o}if(r=a,10<(r=(120>(r=Je()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Mc(r/1960))-r)){e.timeoutHandle=ra(wu.bind(null,e,Bc,Gc),r);break}wu(e,Bc,Gc);break;default:throw Error(i(329))}}}return ru(e,Je()),e.callbackNode===n?au.bind(null,e):null}function iu(e,t){var n=jc;return e.current.memoizedState.isDehydrated&&(du(e,t).flags|=256),2!==(e=mu(e,t))&&(t=Bc,Bc=n,null!==t&&ou(t)),e}function ou(e){null===Bc?Bc=e:Bc.push.apply(Bc,e)}function su(e,t){for(t&=~zc,t&=~Fc,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-ot(t),r=1<<n;e[n]=-1,t&=~r}}function cu(e){if(0!==(6&Ic))throw Error(i(327));Su();var t=dt(e,0);if(0===(1&t))return ru(e,Je()),null;var n=mu(e,t);if(0!==e.tag&&2===n){var r=pt(e);0!==r&&(t=r,n=iu(e,r))}if(1===n)throw n=Oc,du(e,0),su(e,t),ru(e,Je()),n;if(6===n)throw Error(i(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,wu(e,Bc,Gc),ru(e,Je()),null}function uu(e,t){var n=Ic;Ic|=1;try{return e(t)}finally{0===(Ic=n)&&(Wc=Je()+500,ja&&Wa())}}function lu(e){null!==qc&&0===qc.tag&&0===(6&Ic)&&Su();var t=Ic;Ic|=1;var n=Tc.transition,r=yt;try{if(Tc.transition=null,yt=1,e)return e()}finally{yt=r,Tc.transition=n,0===(6&(Ic=t))&&Wa()}}function fu(){Ac=Rc.current,_a(Rc)}function du(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,aa(n)),null!==Nc)for(n=Nc.return;null!==n;){var r=n;switch(ti(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Ra();break;case 3:Qi(),_a(ka),_a(Ia),no();break;case 5:Zi(r);break;case 4:Qi();break;case 13:case 19:_a($i);break;case 10:Ti(r.type._context);break;case 22:case 23:fu()}n=n.return}if(kc=e,Nc=e=Ru(e.current,null),Lc=Ac=t,Dc=0,Oc=null,zc=Fc=Pc=0,Bc=jc=null,null!==Li){for(t=0;t<Li.length;t++)if(null!==(r=(n=Li[t]).interleaved)){n.interleaved=null;var a=r.next,i=n.pending;if(null!==i){var o=i.next;i.next=a,r.next=o}n.pending=r}Li=null}return e}function hu(e,t){for(;;){var n=Nc;try{if(Ei(),ro.current=Zo,uo){for(var r=oo.memoizedState;null!==r;){var a=r.queue;null!==a&&(a.pending=null),r=r.next}uo=!1}if(io=0,co=so=oo=null,lo=!1,fo=0,Ec.current=null,null===n||null===n.return){Dc=1,Oc=t,Nc=null;break}e:{var o=e,s=n.return,c=n,u=t;if(t=Lc,c.flags|=32768,null!==u&&"object"===typeof u&&"function"===typeof u.then){var l=u,f=c,d=f.tag;if(0===(1&f.mode)&&(0===d||11===d||15===d)){var h=f.alternate;h?(f.updateQueue=h.updateQueue,f.memoizedState=h.memoizedState,f.lanes=h.lanes):(f.updateQueue=null,f.memoizedState=null)}var p=ms(s);if(null!==p){p.flags&=-257,vs(p,s,c,0,t),1&p.mode&&gs(o,l,t),u=l;var g=(t=p).updateQueue;if(null===g){var m=new Set;m.add(u),t.updateQueue=m}else g.add(u);break e}if(0===(1&t)){gs(o,l,t),gu();break e}u=Error(i(426))}else if(ai&&1&c.mode){var v=ms(s);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),vs(v,s,c,0,t),pi(us(u,c));break e}}o=u=us(u,c),4!==Dc&&(Dc=2),null===jc?jc=[o]:jc.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,Ui(o,hs(0,u,t));break e;case 1:c=u;var b=o.type,y=o.stateNode;if(0===(128&o.flags)&&("function"===typeof b.getDerivedStateFromError||null!==y&&"function"===typeof y.componentDidCatch&&(null===Yc||!Yc.has(y)))){o.flags|=65536,t&=-t,o.lanes|=t,Ui(o,ps(o,c,t));break e}}o=o.return}while(null!==o)}xu(n)}catch(x){t=x,Nc===n&&null!==n&&(Nc=n=n.return);continue}break}}function pu(){var e=_c.current;return _c.current=Zo,null===e?Zo:e}function gu(){0!==Dc&&3!==Dc&&2!==Dc||(Dc=4),null===kc||0===(268435455&Pc)&&0===(268435455&Fc)||su(kc,Lc)}function mu(e,t){var n=Ic;Ic|=2;var r=pu();for(kc===e&&Lc===t||(Gc=null,du(e,t));;)try{vu();break}catch(a){hu(e,a)}if(Ei(),Ic=n,_c.current=r,null!==Nc)throw Error(i(261));return kc=null,Lc=0,Dc}function vu(){for(;null!==Nc;)yu(Nc)}function bu(){for(;null!==Nc&&!Ke();)yu(Nc)}function yu(e){var t=Cc(e.alternate,e,Ac);e.memoizedProps=e.pendingProps,null===t?xu(e):Nc=t,Ec.current=null}function xu(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Xs(n,t,Ac)))return void(Nc=n)}else{if(null!==(n=qs(n,t)))return n.flags&=32767,void(Nc=n);if(null===e)return Dc=6,void(Nc=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Nc=t);Nc=t=e}while(null!==t);0===Dc&&(Dc=5)}function wu(e,t,n){var r=yt,a=Tc.transition;try{Tc.transition=null,yt=1,function(e,t,n,r){do{Su()}while(null!==qc);if(0!==(6&Ic))throw Error(i(327));n=e.finishedWork;var a=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(i(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var a=31-ot(n),i=1<<a;t[a]=0,r[a]=-1,e[a]=-1,n&=~i}}(e,o),e===kc&&(Nc=kc=null,Lc=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Xc||(Xc=!0,ku(tt,(function(){return Su(),null}))),o=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||o){o=Tc.transition,Tc.transition=null;var s=yt;yt=1;var c=Ic;Ic|=4,Ec.current=null,function(e,t){if(ea=Vt,hr(e=dr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var a=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch(w){n=null;break e}var s=0,c=-1,u=-1,l=0,f=0,d=e,h=null;t:for(;;){for(var p;d!==n||0!==a&&3!==d.nodeType||(c=s+a),d!==o||0!==r&&3!==d.nodeType||(u=s+r),3===d.nodeType&&(s+=d.nodeValue.length),null!==(p=d.firstChild);)h=d,d=p;for(;;){if(d===e)break t;if(h===n&&++l===a&&(c=s),h===o&&++f===r&&(u=s),null!==(p=d.nextSibling))break;h=(d=h).parentNode}d=p}n=-1===c||-1===u?null:{start:c,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(ta={focusedElem:e,selectionRange:n},Vt=!1,Zs=t;null!==Zs;)if(e=(t=Zs).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Zs=e;else for(;null!==Zs;){t=Zs;try{var g=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==g){var m=g.memoizedProps,v=g.memoizedState,b=t.stateNode,y=b.getSnapshotBeforeUpdate(t.elementType===t.type?m:ns(t.type,m),v);b.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var x=t.stateNode.containerInfo;1===x.nodeType?x.textContent="":9===x.nodeType&&x.documentElement&&x.removeChild(x.documentElement);break;default:throw Error(i(163))}}catch(w){Mu(t,t.return,w)}if(null!==(e=t.sibling)){e.return=t.return,Zs=e;break}Zs=t.return}g=tc,tc=!1}(e,n),mc(n,e),pr(ta),Vt=!!ea,ta=ea=null,e.current=n,bc(n,e,a),Qe(),Ic=c,yt=s,Tc.transition=o}else e.current=n;if(Xc&&(Xc=!1,qc=e,Kc=a),o=e.pendingLanes,0===o&&(Yc=null),function(e){if(it&&"function"===typeof it.onCommitFiberRoot)try{it.onCommitFiberRoot(at,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),ru(e,Je()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)a=t[n],r(a.value,{componentStack:a.stack,digest:a.digest});if(Vc)throw Vc=!1,e=Hc,Hc=null,e;0!==(1&Kc)&&0!==e.tag&&Su(),o=e.pendingLanes,0!==(1&o)?e===Jc?Qc++:(Qc=0,Jc=e):Qc=0,Wa()}(e,t,n,r)}finally{Tc.transition=a,yt=r}return null}function Su(){if(null!==qc){var e=xt(Kc),t=Tc.transition,n=yt;try{if(Tc.transition=null,yt=16>e?16:e,null===qc)var r=!1;else{if(e=qc,qc=null,Kc=0,0!==(6&Ic))throw Error(i(331));var a=Ic;for(Ic|=4,Zs=e.current;null!==Zs;){var o=Zs,s=o.child;if(0!==(16&Zs.flags)){var c=o.deletions;if(null!==c){for(var u=0;u<c.length;u++){var l=c[u];for(Zs=l;null!==Zs;){var f=Zs;switch(f.tag){case 0:case 11:case 15:nc(8,f,o)}var d=f.child;if(null!==d)d.return=f,Zs=d;else for(;null!==Zs;){var h=(f=Zs).sibling,p=f.return;if(ic(f),f===l){Zs=null;break}if(null!==h){h.return=p,Zs=h;break}Zs=p}}}var g=o.alternate;if(null!==g){var m=g.child;if(null!==m){g.child=null;do{var v=m.sibling;m.sibling=null,m=v}while(null!==m)}}Zs=o}}if(0!==(2064&o.subtreeFlags)&&null!==s)s.return=o,Zs=s;else e:for(;null!==Zs;){if(0!==(2048&(o=Zs).flags))switch(o.tag){case 0:case 11:case 15:nc(9,o,o.return)}var b=o.sibling;if(null!==b){b.return=o.return,Zs=b;break e}Zs=o.return}}var y=e.current;for(Zs=y;null!==Zs;){var x=(s=Zs).child;if(0!==(2064&s.subtreeFlags)&&null!==x)x.return=s,Zs=x;else e:for(s=y;null!==Zs;){if(0!==(2048&(c=Zs).flags))try{switch(c.tag){case 0:case 11:case 15:rc(9,c)}}catch(S){Mu(c,c.return,S)}if(c===s){Zs=null;break e}var w=c.sibling;if(null!==w){w.return=c.return,Zs=w;break e}Zs=c.return}}if(Ic=a,Wa(),it&&"function"===typeof it.onPostCommitFiberRoot)try{it.onPostCommitFiberRoot(at,e)}catch(S){}r=!0}return r}finally{yt=n,Tc.transition=t}}return!1}function Cu(e,t,n){e=ji(e,t=hs(0,t=us(n,t),1),1),t=eu(),null!==e&&(vt(e,1,t),ru(e,t))}function Mu(e,t,n){if(3===e.tag)Cu(e,e,n);else for(;null!==t;){if(3===t.tag){Cu(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Yc||!Yc.has(r))){t=ji(t,e=ps(t,e=us(n,e),1),1),e=eu(),null!==t&&(vt(t,1,e),ru(t,e));break}}t=t.return}}function _u(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=eu(),e.pingedLanes|=e.suspendedLanes&n,kc===e&&(Lc&n)===n&&(4===Dc||3===Dc&&(130023424&Lc)===Lc&&500>Je()-Uc?du(e,0):zc|=n),ru(e,t)}function Eu(e,t){0===t&&(0===(1&e.mode)?t=1:(t=lt,0===(130023424&(lt<<=1))&&(lt=4194304)));var n=eu();null!==(e=Di(e,t))&&(vt(e,t,n),ru(e,n))}function Tu(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Eu(e,n)}function Iu(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;null!==a&&(n=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(i(314))}null!==r&&r.delete(t),Eu(e,n)}function ku(e,t){return Xe(e,t)}function Nu(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Lu(e,t,n,r){return new Nu(e,t,n,r)}function Au(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Ru(e,t){var n=e.alternate;return null===n?((n=Lu(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Du(e,t,n,r,a,o){var s=2;if(r=e,"function"===typeof e)Au(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case C:return Ou(n.children,a,o,t);case M:s=8,a|=8;break;case _:return(e=Lu(12,n,t,2|a)).elementType=_,e.lanes=o,e;case k:return(e=Lu(13,n,t,a)).elementType=k,e.lanes=o,e;case N:return(e=Lu(19,n,t,a)).elementType=N,e.lanes=o,e;case R:return Pu(n,a,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case E:s=10;break e;case T:s=9;break e;case I:s=11;break e;case L:s=14;break e;case A:s=16,r=null;break e}throw Error(i(130,null==e?e:typeof e,""))}return(t=Lu(s,n,t,a)).elementType=e,t.type=r,t.lanes=o,t}function Ou(e,t,n,r){return(e=Lu(7,e,r,t)).lanes=n,e}function Pu(e,t,n,r){return(e=Lu(22,e,r,t)).elementType=R,e.lanes=n,e.stateNode={isHidden:!1},e}function Fu(e,t,n){return(e=Lu(6,e,null,t)).lanes=n,e}function zu(e,t,n){return(t=Lu(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function ju(e,t,n,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mt(0),this.expirationTimes=mt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mt(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function Bu(e,t,n,r,a,i,o,s,c){return e=new ju(e,t,n,s,c),1===t?(t=1,!0===i&&(t|=8)):t=0,i=Lu(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Pi(i),e}function Uu(e){if(!e)return Ta;e:{if(We(e=e._reactInternals)!==e||1!==e.tag)throw Error(i(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Aa(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(i(171))}if(1===e.tag){var n=e.type;if(Aa(n))return Oa(e,n,t)}return t}function Wu(e,t,n,r,a,i,o,s,c){return(e=Bu(n,r,!0,e,0,i,0,s,c)).context=Uu(null),n=e.current,(i=zi(r=eu(),a=tu(n))).callback=void 0!==t&&null!==t?t:null,ji(n,i,a),e.current.lanes=a,vt(e,a,r),ru(e,r),e}function Gu(e,t,n,r){var a=t.current,i=eu(),o=tu(a);return n=Uu(n),null===t.context?t.context=n:t.pendingContext=n,(t=zi(i,o)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=ji(a,t,o))&&(nu(e,a,o,i),Bi(e,a,o)),o}function Vu(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Hu(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Yu(e,t){Hu(e,t),(e=e.alternate)&&Hu(e,t)}Cc=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||ka.current)ys=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return ys=!1,function(e,t,n){switch(t.tag){case 3:ks(t),hi();break;case 5:Ji(t);break;case 1:Aa(t.type)&&Pa(t);break;case 4:Ki(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,a=t.memoizedProps.value;Ea(Si,r._currentValue),r._currentValue=a;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ea($i,1&$i.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Fs(e,t,n):(Ea($i,1&$i.current),null!==(e=Vs(e,t,n))?e.sibling:null);Ea($i,1&$i.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return Ws(e,t,n);t.flags|=128}if(null!==(a=t.memoizedState)&&(a.rendering=null,a.tail=null,a.lastEffect=null),Ea($i,$i.current),r)break;return null;case 22:case 23:return t.lanes=0,Ms(e,t,n)}return Vs(e,t,n)}(e,t,n);ys=0!==(131072&e.flags)}else ys=!1,ai&&0!==(1048576&t.flags)&&$a(t,Ya,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Gs(e,t),e=t.pendingProps;var a=La(t,Ia.current);ki(t,n),a=mo(null,t,r,e,a,n);var o=vo();return t.flags|=1,"object"===typeof a&&null!==a&&"function"===typeof a.render&&void 0===a.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Aa(r)?(o=!0,Pa(t)):o=!1,t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,Pi(t),a.updater=as,t.stateNode=a,a._reactInternals=t,cs(t,r,e,n),t=Is(null,t,r,!0,o,n)):(t.tag=0,ai&&o&&ei(t),xs(null,t,a,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Gs(e,t),e=t.pendingProps,r=(a=r._init)(r._payload),t.type=r,a=t.tag=function(e){if("function"===typeof e)return Au(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===I)return 11;if(e===L)return 14}return 2}(r),e=ns(r,e),a){case 0:t=Es(null,t,r,e,n);break e;case 1:t=Ts(null,t,r,e,n);break e;case 11:t=ws(null,t,r,e,n);break e;case 14:t=Ss(null,t,r,ns(r.type,e),n);break e}throw Error(i(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,Es(e,t,r,a=t.elementType===r?a:ns(r,a),n);case 1:return r=t.type,a=t.pendingProps,Ts(e,t,r,a=t.elementType===r?a:ns(r,a),n);case 3:e:{if(ks(t),null===e)throw Error(i(387));r=t.pendingProps,a=(o=t.memoizedState).element,Fi(e,t),Wi(t,r,null,n);var s=t.memoizedState;if(r=s.element,o.isDehydrated){if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Ns(e,t,r,n,a=us(Error(i(423)),t));break e}if(r!==a){t=Ns(e,t,r,n,a=us(Error(i(424)),t));break e}for(ri=ua(t.stateNode.containerInfo.firstChild),ni=t,ai=!0,ii=null,n=wi(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(hi(),r===a){t=Vs(e,t,n);break e}xs(e,t,r,n)}t=t.child}return t;case 5:return Ji(t),null===e&&ui(t),r=t.type,a=t.pendingProps,o=null!==e?e.memoizedProps:null,s=a.children,na(r,a)?s=null:null!==o&&na(r,o)&&(t.flags|=32),_s(e,t),xs(e,t,s,n),t.child;case 6:return null===e&&ui(t),null;case 13:return Fs(e,t,n);case 4:return Ki(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=xi(t,null,r,n):xs(e,t,r,n),t.child;case 11:return r=t.type,a=t.pendingProps,ws(e,t,r,a=t.elementType===r?a:ns(r,a),n);case 7:return xs(e,t,t.pendingProps,n),t.child;case 8:case 12:return xs(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,o=t.memoizedProps,s=a.value,Ea(Si,r._currentValue),r._currentValue=s,null!==o)if(sr(o.value,s)){if(o.children===a.children&&!ka.current){t=Vs(e,t,n);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var c=o.dependencies;if(null!==c){s=o.child;for(var u=c.firstContext;null!==u;){if(u.context===r){if(1===o.tag){(u=zi(-1,n&-n)).tag=2;var l=o.updateQueue;if(null!==l){var f=(l=l.shared).pending;null===f?u.next=u:(u.next=f.next,f.next=u),l.pending=u}}o.lanes|=n,null!==(u=o.alternate)&&(u.lanes|=n),Ii(o.return,n,t),c.lanes|=n;break}u=u.next}}else if(10===o.tag)s=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(s=o.return))throw Error(i(341));s.lanes|=n,null!==(c=s.alternate)&&(c.lanes|=n),Ii(s,n,t),s=o.sibling}else s=o.child;if(null!==s)s.return=o;else for(s=o;null!==s;){if(s===t){s=null;break}if(null!==(o=s.sibling)){o.return=s.return,s=o;break}s=s.return}o=s}xs(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,ki(t,n),r=r(a=Ni(a)),t.flags|=1,xs(e,t,r,n),t.child;case 14:return a=ns(r=t.type,t.pendingProps),Ss(e,t,r,a=ns(r.type,a),n);case 15:return Cs(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:ns(r,a),Gs(e,t),t.tag=1,Aa(r)?(e=!0,Pa(t)):e=!1,ki(t,n),os(t,r,a),cs(t,r,a,n),Is(null,t,r,!0,e,n);case 19:return Ws(e,t,n);case 22:return Ms(e,t,n)}throw Error(i(156,t.tag))};var Xu="function"===typeof reportError?reportError:function(e){console.error(e)};function qu(e){this._internalRoot=e}function Ku(e){this._internalRoot=e}function Qu(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Ju(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Zu(){}function $u(e,t,n,r,a){var i=n._reactRootContainer;if(i){var o=i;if("function"===typeof a){var s=a;a=function(){var e=Vu(o);s.call(e)}}Gu(t,o,e,a)}else o=function(e,t,n,r,a){if(a){if("function"===typeof r){var i=r;r=function(){var e=Vu(o);i.call(e)}}var o=Wu(t,r,e,0,null,!1,0,"",Zu);return e._reactRootContainer=o,e[pa]=o.current,Wr(8===e.nodeType?e.parentNode:e),lu(),o}for(;a=e.lastChild;)e.removeChild(a);if("function"===typeof r){var s=r;r=function(){var e=Vu(c);s.call(e)}}var c=Bu(e,0,!1,null,0,!1,0,"",Zu);return e._reactRootContainer=c,e[pa]=c.current,Wr(8===e.nodeType?e.parentNode:e),lu((function(){Gu(t,c,n,r)})),c}(n,t,e,a,r);return Vu(o)}Ku.prototype.render=qu.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(i(409));Gu(e,t,null,null)},Ku.prototype.unmount=qu.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;lu((function(){Gu(null,e,null,null)})),t[pa]=null}},Ku.prototype.unstable_scheduleHydration=function(e){if(e){var t=Mt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Rt.length&&0!==t&&t<Rt[n].priority;n++);Rt.splice(n,0,e),0===n&&Ft(e)}},wt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ft(t.pendingLanes);0!==n&&(bt(t,1|n),ru(t,Je()),0===(6&Ic)&&(Wc=Je()+500,Wa()))}break;case 13:lu((function(){var t=Di(e,1);if(null!==t){var n=eu();nu(t,e,1,n)}})),Yu(e,1)}},St=function(e){if(13===e.tag){var t=Di(e,134217728);if(null!==t)nu(t,e,134217728,eu());Yu(e,134217728)}},Ct=function(e){if(13===e.tag){var t=tu(e),n=Di(e,t);if(null!==n)nu(n,e,t,eu());Yu(e,t)}},Mt=function(){return yt},_t=function(e,t){var n=yt;try{return yt=e,t()}finally{yt=n}},Se=function(e,t,n){switch(t){case"input":if(Z(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var a=wa(r);if(!a)throw Error(i(90));X(r),Z(r,a)}}}break;case"textarea":ie(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ie=uu,ke=lu;var el={usingClientEntryPoint:!1,Events:[ya,xa,wa,Ee,Te,uu]},tl={findFiberByHostInstance:ba,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nl={bundleType:tl.bundleType,version:tl.version,rendererPackageName:tl.rendererPackageName,rendererConfig:tl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=He(e))?null:e.stateNode},findFiberByHostInstance:tl.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var rl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rl.isDisabled&&rl.supportsFiber)try{at=rl.inject(nl),it=rl}catch(le){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=el,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Qu(t))throw Error(i(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:S,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Qu(e))throw Error(i(299));var n=!1,r="",a=Xu;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(a=t.onRecoverableError)),t=Bu(e,1,!1,null,0,n,0,r,a),e[pa]=t.current,Wr(8===e.nodeType?e.parentNode:e),new qu(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(i(188));throw e=Object.keys(e).join(","),Error(i(268,e))}return e=null===(e=He(t))?null:e.stateNode},t.flushSync=function(e){return lu(e)},t.hydrate=function(e,t,n){if(!Ju(t))throw Error(i(200));return $u(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Qu(e))throw Error(i(405));var r=null!=n&&n.hydratedSources||null,a=!1,o="",s=Xu;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(a=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Wu(t,null,e,1,null!=n?n:null,a,0,o,s),e[pa]=t.current,Wr(e),r)for(e=0;e<r.length;e++)a=(a=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,a]:t.mutableSourceEagerHydrationData.push(n,a);return new Ku(t)},t.render=function(e,t,n){if(!Ju(t))throw Error(i(200));return $u(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Ju(e))throw Error(i(40));return!!e._reactRootContainer&&(lu((function(){$u(null,null,e,!1,(function(){e._reactRootContainer=null,e[pa]=null}))})),!0)},t.unstable_batchedUpdates=uu,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Ju(n))throw Error(i(200));if(null==e||void 0===e._reactInternals)throw Error(i(38));return $u(e,t,n,!1,r)},t.version="18.3.1-next-f1338f8080-20240426"},4391:(e,t,n)=>{"use strict";var r=n(7950);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},7950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(2730)},1153:(e,t,n)=>{"use strict";var r=n(5043),a=Symbol.for("react.element"),i=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function u(e,t,n){var r,i={},u=null,l=null;for(r in void 0!==n&&(u=""+n),void 0!==t.key&&(u=""+t.key),void 0!==t.ref&&(l=t.ref),t)o.call(t,r)&&!c.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:a,type:e,key:u,ref:l,props:i,_owner:s.current}}t.Fragment=i,t.jsx=u,t.jsxs=u},4202:(e,t)=>{"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),c=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),h=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,m={};function v(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}function b(){}function y(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=v.prototype;var x=y.prototype=new b;x.constructor=y,g(x,v.prototype),x.isPureReactComponent=!0;var w=Array.isArray,S=Object.prototype.hasOwnProperty,C={current:null},M={key:!0,ref:!0,__self:!0,__source:!0};function _(e,t,r){var a,i={},o=null,s=null;if(null!=t)for(a in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)S.call(t,a)&&!M.hasOwnProperty(a)&&(i[a]=t[a]);var c=arguments.length-2;if(1===c)i.children=r;else if(1<c){for(var u=Array(c),l=0;l<c;l++)u[l]=arguments[l+2];i.children=u}if(e&&e.defaultProps)for(a in c=e.defaultProps)void 0===i[a]&&(i[a]=c[a]);return{$$typeof:n,type:e,key:o,ref:s,props:i,_owner:C.current}}function E(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var T=/\/+/g;function I(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function k(e,t,a,i,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var c=!1;if(null===e)c=!0;else switch(s){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case n:case r:c=!0}}if(c)return o=o(c=e),e=""===i?"."+I(c,0):i,w(o)?(a="",null!=e&&(a=e.replace(T,"$&/")+"/"),k(o,t,a,"",(function(e){return e}))):null!=o&&(E(o)&&(o=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,a+(!o.key||c&&c.key===o.key?"":(""+o.key).replace(T,"$&/")+"/")+e)),t.push(o)),1;if(c=0,i=""===i?".":i+":",w(e))for(var u=0;u<e.length;u++){var l=i+I(s=e[u],u);c+=k(s,t,a,l,o)}else if(l=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=h&&e[h]||e["@@iterator"])?e:null}(e),"function"===typeof l)for(e=l.call(e),u=0;!(s=e.next()).done;)c+=k(s=s.value,t,a,l=i+I(s,u++),o);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return c}function N(e,t,n){if(null==e)return e;var r=[],a=0;return k(e,r,"","",(function(e){return t.call(n,e,a++)})),r}function L(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var A={current:null},R={transition:null},D={ReactCurrentDispatcher:A,ReactCurrentBatchConfig:R,ReactCurrentOwner:C};function O(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:N,forEach:function(e,t,n){N(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return N(e,(function(){t++})),t},toArray:function(e){return N(e,(function(e){return e}))||[]},only:function(e){if(!E(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=a,t.Profiler=o,t.PureComponent=y,t.StrictMode=i,t.Suspense=l,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=D,t.act=O,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var a=g({},e.props),i=e.key,o=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,s=C.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(u in t)S.call(t,u)&&!M.hasOwnProperty(u)&&(a[u]=void 0===t[u]&&void 0!==c?c[u]:t[u])}var u=arguments.length-2;if(1===u)a.children=r;else if(1<u){c=Array(u);for(var l=0;l<u;l++)c[l]=arguments[l+2];a.children=c}return{$$typeof:n,type:e.type,key:i,ref:o,props:a,_owner:s}},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=_,t.createFactory=function(e){var t=_.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:u,render:e}},t.isValidElement=E,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:L}},t.memo=function(e,t){return{$$typeof:f,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=R.transition;R.transition={};try{e()}finally{R.transition=t}},t.unstable_act=O,t.useCallback=function(e,t){return A.current.useCallback(e,t)},t.useContext=function(e){return A.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return A.current.useDeferredValue(e)},t.useEffect=function(e,t){return A.current.useEffect(e,t)},t.useId=function(){return A.current.useId()},t.useImperativeHandle=function(e,t,n){return A.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return A.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return A.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return A.current.useMemo(e,t)},t.useReducer=function(e,t,n){return A.current.useReducer(e,t,n)},t.useRef=function(e){return A.current.useRef(e)},t.useState=function(e){return A.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return A.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return A.current.useTransition()},t.version="18.3.1"},5043:(e,t,n)=>{"use strict";e.exports=n(4202)},579:(e,t,n)=>{"use strict";e.exports=n(1153)},9966:(e,t,n)=>{var r=n(6382),a=r.Buffer;function i(e,t){for(var n in e)t[n]=e[n]}function o(e,t,n){return a(e,t,n)}a.from&&a.alloc&&a.allocUnsafe&&a.allocUnsafeSlow?e.exports=r:(i(r,t),t.Buffer=o),o.prototype=Object.create(a.prototype),i(a,o),o.from=function(e,t,n){if("number"===typeof e)throw new TypeError("Argument must not be a number");return a(e,t,n)},o.alloc=function(e,t,n){if("number"!==typeof e)throw new TypeError("Argument must be a number");var r=a(e);return void 0!==t?"string"===typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},o.allocUnsafe=function(e){if("number"!==typeof e)throw new TypeError("Argument must be a number");return a(e)},o.allocUnsafeSlow=function(e){if("number"!==typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},7234:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,a=e[r];if(!(0<i(a,t)))break e;e[r]=t,e[n]=a,n=r}}function r(e){return 0===e.length?null:e[0]}function a(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,a=e.length,o=a>>>1;r<o;){var s=2*(r+1)-1,c=e[s],u=s+1,l=e[u];if(0>i(c,n))u<a&&0>i(l,c)?(e[r]=l,e[u]=n,r=u):(e[r]=c,e[s]=n,r=s);else{if(!(u<a&&0>i(l,n)))break e;e[r]=l,e[u]=n,r=u}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,c=s.now();t.unstable_now=function(){return s.now()-c}}var u=[],l=[],f=1,d=null,h=3,p=!1,g=!1,m=!1,v="function"===typeof setTimeout?setTimeout:null,b="function"===typeof clearTimeout?clearTimeout:null,y="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=r(l);null!==t;){if(null===t.callback)a(l);else{if(!(t.startTime<=e))break;a(l),t.sortIndex=t.expirationTime,n(u,t)}t=r(l)}}function w(e){if(m=!1,x(e),!g)if(null!==r(u))g=!0,R(S);else{var t=r(l);null!==t&&D(w,t.startTime-e)}}function S(e,n){g=!1,m&&(m=!1,b(E),E=-1),p=!0;var i=h;try{for(x(n),d=r(u);null!==d&&(!(d.expirationTime>n)||e&&!k());){var o=d.callback;if("function"===typeof o){d.callback=null,h=d.priorityLevel;var s=o(d.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?d.callback=s:d===r(u)&&a(u),x(n)}else a(u);d=r(u)}if(null!==d)var c=!0;else{var f=r(l);null!==f&&D(w,f.startTime-n),c=!1}return c}finally{d=null,h=i,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var C,M=!1,_=null,E=-1,T=5,I=-1;function k(){return!(t.unstable_now()-I<T)}function N(){if(null!==_){var e=t.unstable_now();I=e;var n=!0;try{n=_(!0,e)}finally{n?C():(M=!1,_=null)}}else M=!1}if("function"===typeof y)C=function(){y(N)};else if("undefined"!==typeof MessageChannel){var L=new MessageChannel,A=L.port2;L.port1.onmessage=N,C=function(){A.postMessage(null)}}else C=function(){v(N,0)};function R(e){_=e,M||(M=!0,C())}function D(e,n){E=v((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){g||p||(g=!0,R(S))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return r(u)},t.unstable_next=function(e){switch(h){case 1:case 2:case 3:var t=3;break;default:t=h}var n=h;h=t;try{return e()}finally{h=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=h;h=e;try{return t()}finally{h=n}},t.unstable_scheduleCallback=function(e,a,i){var o=t.unstable_now();switch("object"===typeof i&&null!==i?i="number"===typeof(i=i.delay)&&0<i?o+i:o:i=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:f++,callback:a,priorityLevel:e,startTime:i,expirationTime:s=i+s,sortIndex:-1},i>o?(e.sortIndex=i,n(l,e),null===r(u)&&e===r(l)&&(m?(b(E),E=-1):m=!0,D(w,i-o))):(e.sortIndex=s,n(u,e),g||p||(g=!0,R(S))),e},t.unstable_shouldYield=k,t.unstable_wrapCallback=function(e){var t=h;return function(){var n=h;h=t;try{return e.apply(this,arguments)}finally{h=n}}}},8853:(e,t,n)=>{"use strict";e.exports=n(7234)},4334:(e,t,n)=>{var r=n(7359),a=n(7066),i=n(9016),o=n(9538),s=n(6288),c=n(5262),u=n(2430);u.alea=r,u.xor128=a,u.xorwow=i,u.xorshift7=o,u.xor4096=s,u.tychei=c,e.exports=u},7359:function(e,t,n){var r;!function(e,a){function i(e){var t=this,n=function(){var e=4022871197,t=function(t){t=String(t);for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)};return t}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function o(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function s(e,t){var n=new i(e),r=t&&t.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,r&&("object"==typeof r&&o(r,n),a.state=function(){return o(n,{})}),a}a&&a.exports?a.exports=s:n.amdD&&n.amdO?void 0===(r=function(){return s}.call(t,n,t,a))||(a.exports=r):this.alea=s}(0,e=n.nmd(e),n.amdD)},5262:function(e,t,n){var r;!function(e,a){function i(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function o(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function s(e,t){var n=new i(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&o(r,n),a.state=function(){return o(n,{})}),a}a&&a.exports?a.exports=s:n.amdD&&n.amdO?void 0===(r=function(){return s}.call(t,n,t,a))||(a.exports=r):this.tychei=s}(0,e=n.nmd(e),n.amdD)},7066:function(e,t,n){var r;!function(e,a){function i(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function o(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function s(e,t){var n=new i(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&o(r,n),a.state=function(){return o(n,{})}),a}a&&a.exports?a.exports=s:n.amdD&&n.amdO?void 0===(r=function(){return s}.call(t,n,t,a))||(a.exports=r):this.xor128=s}(0,e=n.nmd(e),n.amdD)},6288:function(e,t,n){var r;!function(e,a){function i(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,i=t.i;return t.w=r=r+1640531527|0,n=a[i+34&127],e=a[i=i+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[i]=n^e,t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,a,i,o,s=[],c=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,c=Math.max(c,t.length)),a=0,i=-32;i<c;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(o=o+1640531527|0,a=0==(n=s[127&i]^=r+o)?a+1:0);for(a>=128&&(s[127&(t&&t.length||0)]=-1),a=127,i=512;i>0;--i)r=s[a+34&127],n=s[a=a+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[a]=r^n;e.w=o,e.X=s,e.i=a}(t,e)}function o(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function s(e,t){null==e&&(e=+new Date);var n=new i(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.X&&o(r,n),a.state=function(){return o(n,{})}),a}a&&a.exports?a.exports=s:n.amdD&&n.amdO?void 0===(r=function(){return s}.call(t,n,t,a))||(a.exports=r):this.xor4096=s}(0,e=n.nmd(e),n.amdD)},9538:function(e,t,n){var r;!function(e,a){function i(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],n^=(e^=e<<13)^e<<9,r[a]=n,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function o(e,t){return t.x=e.x.slice(),t.i=e.i,t}function s(e,t){null==e&&(e=+new Date);var n=new i(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.x&&o(r,n),a.state=function(){return o(n,{})}),a}a&&a.exports?a.exports=s:n.amdD&&n.amdO?void 0===(r=function(){return s}.call(t,n,t,a))||(a.exports=r):this.xorshift7=s}(0,e=n.nmd(e),n.amdD)},9016:function(e,t,n){var r;!function(e,a){function i(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function o(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function s(e,t){var n=new i(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&o(r,n),a.state=function(){return o(n,{})}),a}a&&a.exports?a.exports=s:n.amdD&&n.amdO?void 0===(r=function(){return s}.call(t,n,t,a))||(a.exports=r):this.xorwow=s}(0,e=n.nmd(e),n.amdD)},2430:function(e,t,n){var r;!function(a,i,o){var s,c=256,u=o.pow(c,6),l=o.pow(2,52),f=2*l,d=255;function h(e,t,n){var r=[],d=v(m((t=1==t?{entropy:!0}:t||{}).entropy?[e,b(i)]:null==e?function(){try{var e;return s&&(e=s.randomBytes)?e=e(c):(e=new Uint8Array(c),(a.crypto||a.msCrypto).getRandomValues(e)),b(e)}catch(r){var t=a.navigator,n=t&&t.plugins;return[+new Date,a,n,a.screen,b(i)]}}():e,3),r),h=new p(r),y=function(){for(var e=h.g(6),t=u,n=0;e<l;)e=(e+n)*c,t*=c,n=h.g(1);for(;e>=f;)e/=2,t/=2,n>>>=1;return(e+n)/t};return y.int32=function(){return 0|h.g(4)},y.quick=function(){return h.g(4)/4294967296},y.double=y,v(b(h.S),i),(t.pass||n||function(e,t,n,r){return r&&(r.S&&g(r,h),e.state=function(){return g(h,{})}),n?(o.random=e,t):e})(y,d,"global"in t?t.global:this==o,t.state)}function p(e){var t,n=e.length,r=this,a=0,i=r.i=r.j=0,o=r.S=[];for(n||(e=[n++]);a<c;)o[a]=a++;for(a=0;a<c;a++)o[a]=o[i=d&i+e[a%n]+(t=o[a])],o[i]=t;(r.g=function(e){for(var t,n=0,a=r.i,i=r.j,o=r.S;e--;)t=o[a=d&a+1],n=n*c+o[d&(o[a]=o[i=d&i+t])+(o[i]=t)];return r.i=a,r.j=i,n})(c)}function g(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function m(e,t){var n,r=[],a=typeof e;if(t&&"object"==a)for(n in e)try{r.push(m(e[n],t-1))}catch(i){}return r.length?r:"string"==a?e:e+"\0"}function v(e,t){for(var n,r=e+"",a=0;a<r.length;)t[d&a]=d&(n^=19*t[d&a])+r.charCodeAt(a++);return b(t)}function b(e){return String.fromCharCode.apply(0,e)}if(v(o.random(),i),e.exports){e.exports=h;try{s=n(1234)}catch(y){}}else void 0===(r=function(){return h}.call(t,n,t,e))||(e.exports=r)}("undefined"!==typeof self?self:this,[],Math)},7324:e=>{e.exports=function(e,t,n,r){var a=n?n.call(r,e,t):void 0;if(void 0!==a)return!!a;if(e===t)return!0;if("object"!==typeof e||!e||"object"!==typeof t||!t)return!1;var i=Object.keys(e),o=Object.keys(t);if(i.length!==o.length)return!1;for(var s=Object.prototype.hasOwnProperty.bind(t),c=0;c<i.length;c++){var u=i[c];if(!s(u))return!1;var l=e[u],f=t[u];if(!1===(a=n?n.call(r,l,f,u):void 0)||void 0===a&&l!==f)return!1}return!0}},6593:(e,t,n)=>{const r=n(6522)("simple-peer"),a=n(7919),i=n(5838),o=n(9531),s=n(4275),c=n(4823),{Buffer:u}=n(6382),l=65536;function f(e){return e.replace(/a=ice-options:trickle\s\n/g,"")}class d extends o.Duplex{constructor(e){if(super(e=Object.assign({allowHalfOpen:!1},e)),this._id=i(4).toString("hex").slice(0,7),this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||i(20).toString("hex"):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||d.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},d.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(e=>e),this.streams=e.streams||(e.stream?[e.stream]:[]),this.trickle=void 0===e.trickle||e.trickle,this.allowHalfTrickle=void 0!==e.allowHalfTrickle&&e.allowHalfTrickle,this.iceCompleteTimeout=e.iceCompleteTimeout||5e3,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=e.wrtc&&"object"===typeof e.wrtc?e.wrtc:a(),!this._wrtc)throw"undefined"===typeof window?c(new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"),"ERR_WEBRTC_SUPPORT"):c(new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(t){return void this.destroy(c(t,"ERR_PC_CONSTRUCTOR"))}this._isReactNativeWebrtc="number"===typeof this._pc._peerConnectionId,this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=e=>{this._onIceCandidate(e)},"object"===typeof this._pc.peerIdentity&&this._pc.peerIdentity.catch((e=>{this.destroy(c(e,"ERR_PC_PEER_IDENTITY"))})),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=e=>{this._setupData(e)},this.streams&&this.streams.forEach((e=>{this.addStream(e)})),this._pc.ontrack=e=>{this._onTrack(e)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&"open"===this._channel.readyState}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(!this.destroying){if(this.destroyed)throw c(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if("string"===typeof e)try{e=JSON.parse(e)}catch(t){e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(e)).then((()=>{this.destroyed||(this._pendingCandidates.forEach((e=>{this._addIceCandidate(e)})),this._pendingCandidates=[],"offer"===this._pc.remoteDescription.type&&this._createAnswer())})).catch((e=>{this.destroy(c(e,"ERR_SET_REMOTE_DESCRIPTION"))})),e.sdp||e.candidate||e.renegotiate||e.transceiverRequest||this.destroy(c(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(e){const t=new this._wrtc.RTCIceCandidate(e);this._pc.addIceCandidate(t).catch((e=>{var n;!t.address||t.address.endsWith(".local")?(n="Ignoring unsupported ICE candidate.",console.warn(n)):this.destroy(c(e,"ERR_ADD_ICE_CANDIDATE"))}))}send(e){if(!this.destroying){if(this.destroyed)throw c(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}addTransceiver(e,t){if(!this.destroying){if(this.destroyed)throw c(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,t),this._needsNegotiation()}catch(n){this.destroy(c(n,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:t}})}}addStream(e){if(!this.destroying){if(this.destroyed)throw c(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),e.getTracks().forEach((t=>{this.addTrack(t,e)}))}}addTrack(e,t){if(this.destroying)return;if(this.destroyed)throw c(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const n=this._senderMap.get(e)||new Map;let r=n.get(t);if(r)throw r.removed?c(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):c(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED");r=this._pc.addTrack(e,t),n.set(t,r),this._senderMap.set(e,n),this._needsNegotiation()}replaceTrack(e,t,n){if(this.destroying)return;if(this.destroyed)throw c(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const r=this._senderMap.get(e),a=r?r.get(n):null;if(!a)throw c(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");t&&this._senderMap.set(t,r),null!=a.replaceTrack?a.replaceTrack(t):this.destroy(c(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(e,t){if(this.destroying)return;if(this.destroyed)throw c(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const n=this._senderMap.get(e),r=n?n.get(t):null;if(!r)throw c(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{r.removed=!0,this._pc.removeTrack(r)}catch(a){"NS_ERROR_UNEXPECTED"===a.name?this._sendersAwaitingStable.push(r):this.destroy(c(a,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(e){if(!this.destroying){if(this.destroyed)throw c(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),e.getTracks().forEach((t=>{this.removeTrack(t,e)}))}}_needsNegotiation(){this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,s((()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1})))}negotiate(){if(!this.destroying){if(this.destroyed)throw c(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout((()=>{this._createOffer()}),0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(e){this._destroy(e,(()=>{}))}_destroy(e,t){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",e&&(e.message||e)),s((()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",e&&(e.message||e)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch(e){}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch(e){}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,e&&this.emit("error",e),this.emit("close"),t()})))}_setupData(e){if(!e.channel)return this.destroy(c(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer","number"===typeof this._channel.bufferedAmountLowThreshold&&(this._channel.bufferedAmountLowThreshold=l),this.channelName=this._channel.label,this._channel.onmessage=e=>{this._onChannelMessage(e)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=e=>{const t=e.error instanceof Error?e.error:new Error("Datachannel error: ".concat(e.message," ").concat(e.filename,":").concat(e.lineno,":").concat(e.colno));this.destroy(c(t,"ERR_DATA_CHANNEL"))};let t=!1;this._closingInterval=setInterval((()=>{this._channel&&"closing"===this._channel.readyState?(t&&this._onChannelClose(),t=!0):t=!1}),5e3)}_read(){}_write(e,t,n){if(this.destroyed)return n(c(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(r){return this.destroy(c(r,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>l?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=n):n(null)}else this._debug("write before connect"),this._chunk=e,this._cb=n}_onFinish(){if(this.destroyed)return;const e=()=>{setTimeout((()=>this.destroy()),1e3)};this._connected?e():this.once("connect",e)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout((()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))}),this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then((e=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(e.sdp=f(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{if(this.destroyed)return;const t=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:t.type,sdp:t.sdp})};this._pc.setLocalDescription(e).then((()=>{this._debug("createOffer success"),this.destroyed||(this.trickle||this._iceComplete?t():this.once("_iceComplete",t))})).catch((e=>{this.destroy(c(e,"ERR_SET_LOCAL_DESCRIPTION"))}))})).catch((e=>{this.destroy(c(e,"ERR_CREATE_OFFER"))}))}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach((e=>{e.mid||!e.sender.track||e.requested||(e.requested=!0,this.addTransceiver(e.sender.track.kind))}))}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then((e=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(e.sdp=f(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{if(this.destroyed)return;const t=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:t.type,sdp:t.sdp}),this.initiator||this._requestMissingTransceivers()};this._pc.setLocalDescription(e).then((()=>{this.destroyed||(this.trickle||this._iceComplete?t():this.once("_iceComplete",t))})).catch((e=>{this.destroy(c(e,"ERR_SET_LOCAL_DESCRIPTION"))}))})).catch((e=>{this.destroy(c(e,"ERR_CREATE_ANSWER"))}))}_onConnectionStateChange(){this.destroyed||"failed"===this._pc.connectionState&&this.destroy(c(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const e=this._pc.iceConnectionState,t=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,t),this.emit("iceStateChange",e,t),"connected"!==e&&"completed"!==e||(this._pcReady=!0,this._maybeReady()),"failed"===e&&this.destroy(c(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),"closed"===e&&this.destroy(c(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(e){const t=e=>("[object Array]"===Object.prototype.toString.call(e.values)&&e.values.forEach((t=>{Object.assign(e,t)})),e);0===this._pc.getStats.length||this._isReactNativeWebrtc?this._pc.getStats().then((n=>{const r=[];n.forEach((e=>{r.push(t(e))})),e(null,r)}),(t=>e(t))):this._pc.getStats.length>0?this._pc.getStats((n=>{if(this.destroyed)return;const r=[];n.result().forEach((e=>{const n={};e.names().forEach((t=>{n[t]=e.stat(t)})),n.id=e.id,n.type=e.type,n.timestamp=e.timestamp,r.push(t(n))})),e(null,r)}),(t=>e(t))):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const e=()=>{this.destroyed||this.getStats(((t,n)=>{if(this.destroyed)return;t&&(n=[]);const r={},a={},i={};let o=!1;n.forEach((e=>{"remotecandidate"!==e.type&&"remote-candidate"!==e.type||(r[e.id]=e),"localcandidate"!==e.type&&"local-candidate"!==e.type||(a[e.id]=e),"candidatepair"!==e.type&&"candidate-pair"!==e.type||(i[e.id]=e)}));const s=e=>{o=!0;let t=a[e.localCandidateId];t&&(t.ip||t.address)?(this.localAddress=t.ip||t.address,this.localPort=Number(t.port)):t&&t.ipAddress?(this.localAddress=t.ipAddress,this.localPort=Number(t.portNumber)):"string"===typeof e.googLocalAddress&&(t=e.googLocalAddress.split(":"),this.localAddress=t[0],this.localPort=Number(t[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let n=r[e.remoteCandidateId];n&&(n.ip||n.address)?(this.remoteAddress=n.ip||n.address,this.remotePort=Number(n.port)):n&&n.ipAddress?(this.remoteAddress=n.ipAddress,this.remotePort=Number(n.portNumber)):"string"===typeof e.googRemoteAddress&&(n=e.googRemoteAddress.split(":"),this.remoteAddress=n[0],this.remotePort=Number(n[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(n.forEach((e=>{"transport"===e.type&&e.selectedCandidatePairId&&s(i[e.selectedCandidatePairId]),("googCandidatePair"===e.type&&"true"===e.googActiveConnection||("candidatepair"===e.type||"candidate-pair"===e.type)&&e.selected)&&s(e)})),o||Object.keys(i).length&&!Object.keys(a).length){if(this._connecting=!1,this._connected=!0,this._chunk){try{this.send(this._chunk)}catch(t){return this.destroy(c(t,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const e=this._cb;this._cb=null,e(null)}"number"!==typeof this._channel.bufferedAmountLowThreshold&&(this._interval=setInterval((()=>this._onInterval()),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")}else setTimeout(e,100)}))};e()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>l||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||("stable"===this._pc.signalingState&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach((e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0})),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):e.candidate||this._iceComplete||(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(e){if(this.destroyed)return;let t=e.data;t instanceof ArrayBuffer&&(t=u.from(t)),this.push(t)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const e=this._cb;this._cb=null,e(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(e){this.destroyed||e.streams.forEach((t=>{this._debug("on track"),this.emit("track",e.track,t),this._remoteTracks.push({track:e.track,stream:t}),this._remoteStreams.some((e=>e.id===t.id))||(this._remoteStreams.push(t),s((()=>{this._debug("on stream"),this.emit("stream",t)})))}))}_debug(){const e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],r.apply(null,e)}}d.WEBRTC_SUPPORT=!!a(),d.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},d.channelConfig={},e.exports=d},6556:e=>{"use strict";var t={};function n(e,n,r){r||(r=Error);var a=function(e){var t,r;function a(t,r,a){return e.call(this,function(e,t,r){return"string"===typeof n?n:n(e,t,r)}(t,r,a))||this}return r=e,(t=a).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,a}(r);a.prototype.name=r.name,a.prototype.code=e,t[e]=a}function r(e,t){if(Array.isArray(e)){var n=e.length;return e=e.map((function(e){return String(e)})),n>2?"one of ".concat(t," ").concat(e.slice(0,n-1).join(", "),", or ")+e[n-1]:2===n?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}n("ERR_INVALID_OPT_VALUE",(function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'}),TypeError),n("ERR_INVALID_ARG_TYPE",(function(e,t,n){var a,i,o,s;if("string"===typeof t&&(i="not ",t.substr(!o||o<0?0:+o,i.length)===i)?(a="must not be",t=t.replace(/^not /,"")):a="must be",function(e,t,n){return(void 0===n||n>e.length)&&(n=e.length),e.substring(n-t.length,n)===t}(e," argument"))s="The ".concat(e," ").concat(a," ").concat(r(t,"type"));else{var c=function(e,t,n){return"number"!==typeof n&&(n=0),!(n+t.length>e.length)&&-1!==e.indexOf(t,n)}(e,".")?"property":"argument";s='The "'.concat(e,'" ').concat(c," ").concat(a," ").concat(r(t,"type"))}return s+=". Received type ".concat(typeof n)}),TypeError),n("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),n("ERR_METHOD_NOT_IMPLEMENTED",(function(e){return"The "+e+" method is not implemented"})),n("ERR_STREAM_PREMATURE_CLOSE","Premature close"),n("ERR_STREAM_DESTROYED",(function(e){return"Cannot call "+e+" after a stream was destroyed"})),n("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),n("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),n("ERR_STREAM_WRITE_AFTER_END","write after end"),n("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),n("ERR_UNKNOWN_ENCODING",(function(e){return"Unknown encoding: "+e}),TypeError),n("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),e.exports.F=t},7610:(e,t,n)=>{"use strict";var r=n(2285),a=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=l;var i=n(7944),o=n(8696);n(6329)(l,i);for(var s=a(o.prototype),c=0;c<s.length;c++){var u=s[c];l.prototype[u]||(l.prototype[u]=o.prototype[u])}function l(e){if(!(this instanceof l))return new l(e);i.call(this,e),o.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",f)))}function f(){this._writableState.ended||r.nextTick(d,this)}function d(e){e.end()}Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(l.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(l.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})},460:(e,t,n)=>{"use strict";e.exports=a;var r=n(438);function a(e){if(!(this instanceof a))return new a(e);r.call(this,e)}n(6329)(a,r),a.prototype._transform=function(e,t,n){n(null,e)}},7944:(e,t,n)=>{"use strict";var r,a=n(2285);e.exports=_,_.ReadableState=M;n(7284).EventEmitter;var i=function(e,t){return e.listeners(t).length},o=n(9365),s=n(6382).Buffer,c=("undefined"!==typeof n.g?n.g:"undefined"!==typeof window?window:"undefined"!==typeof self?self:{}).Uint8Array||function(){};var u,l=n(300);u=l&&l.debuglog?l.debuglog("stream"):function(){};var f,d,h,p=n(7245),g=n(2836),m=n(8607).getHighWaterMark,v=n(6556).F,b=v.ERR_INVALID_ARG_TYPE,y=v.ERR_STREAM_PUSH_AFTER_EOF,x=v.ERR_METHOD_NOT_IMPLEMENTED,w=v.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;n(6329)(_,o);var S=g.errorOrDestroy,C=["error","close","destroy","pause","resume"];function M(e,t,a){r=r||n(7610),e=e||{},"boolean"!==typeof a&&(a=t instanceof r),this.objectMode=!!e.objectMode,a&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=m(this,e,"readableHighWaterMark",a),this.buffer=new p,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(f||(f=n(8694).I),this.decoder=new f(e.encoding),this.encoding=e.encoding)}function _(e){if(r=r||n(7610),!(this instanceof _))return new _(e);var t=this instanceof r;this._readableState=new M(e,this,t),this.readable=!0,e&&("function"===typeof e.read&&(this._read=e.read),"function"===typeof e.destroy&&(this._destroy=e.destroy)),o.call(this)}function E(e,t,n,r,a){u("readableAddChunk",t);var i,o=e._readableState;if(null===t)o.reading=!1,function(e,t){if(u("onEofChunk"),t.ended)return;if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,t.sync?N(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,L(e)))}(e,o);else if(a||(i=function(e,t){var n;r=t,s.isBuffer(r)||r instanceof c||"string"===typeof t||void 0===t||e.objectMode||(n=new b("chunk",["string","Buffer","Uint8Array"],t));var r;return n}(o,t)),i)S(e,i);else if(o.objectMode||t&&t.length>0)if("string"===typeof t||o.objectMode||Object.getPrototypeOf(t)===s.prototype||(t=function(e){return s.from(e)}(t)),r)o.endEmitted?S(e,new w):T(e,o,t,!0);else if(o.ended)S(e,new y);else{if(o.destroyed)return!1;o.reading=!1,o.decoder&&!n?(t=o.decoder.write(t),o.objectMode||0!==t.length?T(e,o,t,!1):A(e,o)):T(e,o,t,!1)}else r||(o.reading=!1,A(e,o));return!o.ended&&(o.length<o.highWaterMark||0===o.length)}function T(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",n)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&N(e)),A(e,t)}Object.defineProperty(_.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),_.prototype.destroy=g.destroy,_.prototype._undestroy=g.undestroy,_.prototype._destroy=function(e,t){t(e)},_.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"===typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=s.from(e,t),t=""),n=!0),E(this,e,t,!1,n)},_.prototype.unshift=function(e){return E(this,e,null,!0,!1)},_.prototype.isPaused=function(){return!1===this._readableState.flowing},_.prototype.setEncoding=function(e){f||(f=n(8694).I);var t=new f(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,a="";null!==r;)a+=t.write(r.data),r=r.next;return this._readableState.buffer.clear(),""!==a&&this._readableState.buffer.push(a),this._readableState.length=a.length,this};var I=1073741824;function k(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!==e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=I?e=I:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function N(e){var t=e._readableState;u("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(u("emitReadable",t.flowing),t.emittedReadable=!0,a.nextTick(L,e))}function L(e){var t=e._readableState;u("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,F(e)}function A(e,t){t.readingMore||(t.readingMore=!0,a.nextTick(R,e,t))}function R(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var n=t.length;if(u("maybeReadMore read 0"),e.read(0),n===t.length)break}t.readingMore=!1}function D(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function O(e){u("readable nexttick read 0"),e.read(0)}function P(e,t){u("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),F(e),t.flowing&&!t.reading&&e.read(0)}function F(e){var t=e._readableState;for(u("flow",t.flowing);t.flowing&&null!==e.read(););}function z(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):n=t.buffer.consume(e,t.decoder),n);var n}function j(e){var t=e._readableState;u("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,a.nextTick(B,t,e))}function B(e,t){if(u("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var n=t._writableState;(!n||n.autoDestroy&&n.finished)&&t.destroy()}}function U(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}_.prototype.read=function(e){u("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return u("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?j(this):N(this),null;if(0===(e=k(e,t))&&t.ended)return 0===t.length&&j(this),null;var r,a=t.needReadable;return u("need readable",a),(0===t.length||t.length-e<t.highWaterMark)&&u("length less than watermark",a=!0),t.ended||t.reading?u("reading or ended",a=!1):a&&(u("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=k(n,t))),null===(r=e>0?z(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&j(this)),null!==r&&this.emit("data",r),r},_.prototype._read=function(e){S(this,new x("_read()"))},_.prototype.pipe=function(e,t){var n=this,r=this._readableState;switch(r.pipesCount){case 0:r.pipes=e;break;case 1:r.pipes=[r.pipes,e];break;default:r.pipes.push(e)}r.pipesCount+=1,u("pipe count=%d opts=%j",r.pipesCount,t);var o=(!t||!1!==t.end)&&e!==a.stdout&&e!==a.stderr?c:m;function s(t,a){u("onunpipe"),t===n&&a&&!1===a.hasUnpiped&&(a.hasUnpiped=!0,u("cleanup"),e.removeListener("close",p),e.removeListener("finish",g),e.removeListener("drain",l),e.removeListener("error",h),e.removeListener("unpipe",s),n.removeListener("end",c),n.removeListener("end",m),n.removeListener("data",d),f=!0,!r.awaitDrain||e._writableState&&!e._writableState.needDrain||l())}function c(){u("onend"),e.end()}r.endEmitted?a.nextTick(o):n.once("end",o),e.on("unpipe",s);var l=function(e){return function(){var t=e._readableState;u("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&i(e,"data")&&(t.flowing=!0,F(e))}}(n);e.on("drain",l);var f=!1;function d(t){u("ondata");var a=e.write(t);u("dest.write",a),!1===a&&((1===r.pipesCount&&r.pipes===e||r.pipesCount>1&&-1!==U(r.pipes,e))&&!f&&(u("false write response, pause",r.awaitDrain),r.awaitDrain++),n.pause())}function h(t){u("onerror",t),m(),e.removeListener("error",h),0===i(e,"error")&&S(e,t)}function p(){e.removeListener("finish",g),m()}function g(){u("onfinish"),e.removeListener("close",p),m()}function m(){u("unpipe"),n.unpipe(e)}return n.on("data",d),function(e,t,n){if("function"===typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",h),e.once("close",p),e.once("finish",g),e.emit("pipe",n),r.flowing||(u("pipe resume"),n.resume()),e},_.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var r=t.pipes,a=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<a;i++)r[i].emit("unpipe",this,{hasUnpiped:!1});return this}var o=U(t.pipes,e);return-1===o||(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},_.prototype.on=function(e,t){var n=o.prototype.on.call(this,e,t),r=this._readableState;return"data"===e?(r.readableListening=this.listenerCount("readable")>0,!1!==r.flowing&&this.resume()):"readable"===e&&(r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.flowing=!1,r.emittedReadable=!1,u("on readable",r.length,r.reading),r.length?N(this):r.reading||a.nextTick(O,this))),n},_.prototype.addListener=_.prototype.on,_.prototype.removeListener=function(e,t){var n=o.prototype.removeListener.call(this,e,t);return"readable"===e&&a.nextTick(D,this),n},_.prototype.removeAllListeners=function(e){var t=o.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||a.nextTick(D,this),t},_.prototype.resume=function(){var e=this._readableState;return e.flowing||(u("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,a.nextTick(P,e,t))}(this,e)),e.paused=!1,this},_.prototype.pause=function(){return u("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(u("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},_.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var a in e.on("end",(function(){if(u("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(a){(u("wrapped data"),n.decoder&&(a=n.decoder.write(a)),!n.objectMode||null!==a&&void 0!==a)&&((n.objectMode||a&&a.length)&&(t.push(a)||(r=!0,e.pause())))})),e)void 0===this[a]&&"function"===typeof e[a]&&(this[a]=function(t){return function(){return e[t].apply(e,arguments)}}(a));for(var i=0;i<C.length;i++)e.on(C[i],this.emit.bind(this,C[i]));return this._read=function(t){u("wrapped _read",t),r&&(r=!1,e.resume())},this},"function"===typeof Symbol&&(_.prototype[Symbol.asyncIterator]=function(){return void 0===d&&(d=n(4095)),d(this)}),Object.defineProperty(_.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(_.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(_.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),_._fromList=z,Object.defineProperty(_.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"===typeof Symbol&&(_.from=function(e,t){return void 0===h&&(h=n(5137)),h(_,e,t)})},438:(e,t,n)=>{"use strict";e.exports=l;var r=n(6556).F,a=r.ERR_METHOD_NOT_IMPLEMENTED,i=r.ERR_MULTIPLE_CALLBACK,o=r.ERR_TRANSFORM_ALREADY_TRANSFORMING,s=r.ERR_TRANSFORM_WITH_LENGTH_0,c=n(7610);function u(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(null===r)return this.emit("error",new i);n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var a=this._readableState;a.reading=!1,(a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}function l(e){if(!(this instanceof l))return new l(e);c.call(this,e),this._transformState={afterTransform:u.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"===typeof e.transform&&(this._transform=e.transform),"function"===typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",f)}function f(){var e=this;"function"!==typeof this._flush||this._readableState.destroyed?d(this,null,null):this._flush((function(t,n){d(e,t,n)}))}function d(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new s;if(e._transformState.transforming)throw new o;return e.push(null)}n(6329)(l,c),l.prototype.push=function(e,t){return this._transformState.needTransform=!1,c.prototype.push.call(this,e,t)},l.prototype._transform=function(e,t,n){n(new a("_transform()"))},l.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var a=this._readableState;(r.needTransform||a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}},l.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},l.prototype._destroy=function(e,t){c.prototype._destroy.call(this,e,(function(e){t(e)}))}},8696:(e,t,n)=>{"use strict";var r,a=n(2285);function i(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;e.entry=null;for(;r;){var a=r.callback;t.pendingcb--,a(n),r=r.next}t.corkedRequestsFree.next=e}(t,e)}}e.exports=_,_.WritableState=M;var o={deprecate:n(2390)},s=n(9365),c=n(6382).Buffer,u=("undefined"!==typeof n.g?n.g:"undefined"!==typeof window?window:"undefined"!==typeof self?self:{}).Uint8Array||function(){};var l,f=n(2836),d=n(8607).getHighWaterMark,h=n(6556).F,p=h.ERR_INVALID_ARG_TYPE,g=h.ERR_METHOD_NOT_IMPLEMENTED,m=h.ERR_MULTIPLE_CALLBACK,v=h.ERR_STREAM_CANNOT_PIPE,b=h.ERR_STREAM_DESTROYED,y=h.ERR_STREAM_NULL_VALUES,x=h.ERR_STREAM_WRITE_AFTER_END,w=h.ERR_UNKNOWN_ENCODING,S=f.errorOrDestroy;function C(){}function M(e,t,o){r=r||n(7610),e=e||{},"boolean"!==typeof o&&(o=t instanceof r),this.objectMode=!!e.objectMode,o&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=d(this,e,"writableHighWaterMark",o),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var s=!1===e.decodeStrings;this.decodeStrings=!s,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if("function"!==typeof i)throw new m;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,r,i){--t.pendingcb,n?(a.nextTick(i,r),a.nextTick(L,e,t),e._writableState.errorEmitted=!0,S(e,r)):(i(r),e._writableState.errorEmitted=!0,S(e,r),L(e,t))}(e,n,r,t,i);else{var o=k(n)||e.destroyed;o||n.corked||n.bufferProcessing||!n.bufferedRequest||I(e,n),r?a.nextTick(T,e,n,o,i):T(e,n,o,i)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new i(this)}function _(e){var t=this instanceof(r=r||n(7610));if(!t&&!l.call(_,this))return new _(e);this._writableState=new M(e,this,t),this.writable=!0,e&&("function"===typeof e.write&&(this._write=e.write),"function"===typeof e.writev&&(this._writev=e.writev),"function"===typeof e.destroy&&(this._destroy=e.destroy),"function"===typeof e.final&&(this._final=e.final)),s.call(this)}function E(e,t,n,r,a,i,o){t.writelen=r,t.writecb=o,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new b("write")):n?e._writev(a,t.onwrite):e._write(a,i,t.onwrite),t.sync=!1}function T(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),L(e,t)}function I(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,a=new Array(r),o=t.corkedRequestsFree;o.entry=n;for(var s=0,c=!0;n;)a[s]=n,n.isBuf||(c=!1),n=n.next,s+=1;a.allBuffers=c,E(e,t,!0,t.length,a,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new i(t),t.bufferedRequestCount=0}else{for(;n;){var u=n.chunk,l=n.encoding,f=n.callback;if(E(e,t,!1,t.objectMode?1:u.length,u,l,f),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function k(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function N(e,t){e._final((function(n){t.pendingcb--,n&&S(e,n),t.prefinished=!0,e.emit("prefinish"),L(e,t)}))}function L(e,t){var n=k(t);if(n&&(function(e,t){t.prefinished||t.finalCalled||("function"!==typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,a.nextTick(N,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var r=e._readableState;(!r||r.autoDestroy&&r.endEmitted)&&e.destroy()}return n}n(6329)(_,s),M.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(M.prototype,"buffer",{get:o.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"===typeof Symbol&&Symbol.hasInstance&&"function"===typeof Function.prototype[Symbol.hasInstance]?(l=Function.prototype[Symbol.hasInstance],Object.defineProperty(_,Symbol.hasInstance,{value:function(e){return!!l.call(this,e)||this===_&&(e&&e._writableState instanceof M)}})):l=function(e){return e instanceof this},_.prototype.pipe=function(){S(this,new v)},_.prototype.write=function(e,t,n){var r,i=this._writableState,o=!1,s=!i.objectMode&&(r=e,c.isBuffer(r)||r instanceof u);return s&&!c.isBuffer(e)&&(e=function(e){return c.from(e)}(e)),"function"===typeof t&&(n=t,t=null),s?t="buffer":t||(t=i.defaultEncoding),"function"!==typeof n&&(n=C),i.ending?function(e,t){var n=new x;S(e,n),a.nextTick(t,n)}(this,n):(s||function(e,t,n,r){var i;return null===n?i=new y:"string"===typeof n||t.objectMode||(i=new p("chunk",["string","Buffer"],n)),!i||(S(e,i),a.nextTick(r,i),!1)}(this,i,e,n))&&(i.pendingcb++,o=function(e,t,n,r,a,i){if(!n){var o=function(e,t,n){e.objectMode||!1===e.decodeStrings||"string"!==typeof t||(t=c.from(t,n));return t}(t,r,a);r!==o&&(n=!0,a="buffer",r=o)}var s=t.objectMode?1:r.length;t.length+=s;var u=t.length<t.highWaterMark;u||(t.needDrain=!0);if(t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:a,isBuf:n,callback:i,next:null},l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else E(e,t,!1,s,r,a,i);return u}(this,i,s,e,t,n)),o},_.prototype.cork=function(){this._writableState.corked++},_.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||I(this,e))},_.prototype.setDefaultEncoding=function(e){if("string"===typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new w(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(_.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(_.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),_.prototype._write=function(e,t,n){n(new g("_write()"))},_.prototype._writev=null,_.prototype.end=function(e,t,n){var r=this._writableState;return"function"===typeof e?(n=e,e=null,t=null):"function"===typeof t&&(n=t,t=null),null!==e&&void 0!==e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||function(e,t,n){t.ending=!0,L(e,t),n&&(t.finished?a.nextTick(n):e.once("finish",n));t.ended=!0,e.writable=!1}(this,r,n),this},Object.defineProperty(_.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(_.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),_.prototype.destroy=f.destroy,_.prototype._undestroy=f.undestroy,_.prototype._destroy=function(e,t){t(e)}},4095:(e,t,n)=>{"use strict";var r,a=n(2285);function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o=n(7530),s=Symbol("lastResolve"),c=Symbol("lastReject"),u=Symbol("error"),l=Symbol("ended"),f=Symbol("lastPromise"),d=Symbol("handlePromise"),h=Symbol("stream");function p(e,t){return{value:e,done:t}}function g(e){var t=e[s];if(null!==t){var n=e[h].read();null!==n&&(e[f]=null,e[s]=null,e[c]=null,t(p(n,!1)))}}function m(e){a.nextTick(g,e)}var v=Object.getPrototypeOf((function(){})),b=Object.setPrototypeOf((i(r={get stream(){return this[h]},next:function(){var e=this,t=this[u];if(null!==t)return Promise.reject(t);if(this[l])return Promise.resolve(p(void 0,!0));if(this[h].destroyed)return new Promise((function(t,n){a.nextTick((function(){e[u]?n(e[u]):t(p(void 0,!0))}))}));var n,r=this[f];if(r)n=new Promise(function(e,t){return function(n,r){e.then((function(){t[l]?n(p(void 0,!0)):t[d](n,r)}),r)}}(r,this));else{var i=this[h].read();if(null!==i)return Promise.resolve(p(i,!1));n=new Promise(this[d])}return this[f]=n,n}},Symbol.asyncIterator,(function(){return this})),i(r,"return",(function(){var e=this;return new Promise((function(t,n){e[h].destroy(null,(function(e){e?n(e):t(p(void 0,!0))}))}))})),r),v);e.exports=function(e){var t,n=Object.create(b,(i(t={},h,{value:e,writable:!0}),i(t,s,{value:null,writable:!0}),i(t,c,{value:null,writable:!0}),i(t,u,{value:null,writable:!0}),i(t,l,{value:e._readableState.endEmitted,writable:!0}),i(t,d,{value:function(e,t){var r=n[h].read();r?(n[f]=null,n[s]=null,n[c]=null,e(p(r,!1))):(n[s]=e,n[c]=t)},writable:!0}),t));return n[f]=null,o(e,(function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=n[c];return null!==t&&(n[f]=null,n[s]=null,n[c]=null,t(e)),void(n[u]=e)}var r=n[s];null!==r&&(n[f]=null,n[s]=null,n[c]=null,r(p(void 0,!0))),n[l]=!0})),e.on("readable",m.bind(null,n)),n}},7245:(e,t,n)=>{"use strict";function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t,n){return(t=s(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}function s(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}var c=n(6382).Buffer,u=n(5187).inspect,l=u&&u.custom||"inspect";e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var t,n,r;return t=e,(n=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n}},{key:"concat",value:function(e){if(0===this.length)return c.alloc(0);for(var t,n,r,a=c.allocUnsafe(e>>>0),i=this.head,o=0;i;)t=i.data,n=a,r=o,c.prototype.copy.call(t,n,r),o+=i.data.length,i=i.next;return a}},{key:"consume",value:function(e,t){var n;return e<this.head.data.length?(n=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):n=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),n}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,n=1,r=t.data;for(e-=r.length;t=t.next;){var a=t.data,i=e>a.length?a.length:e;if(i===a.length?r+=a:r+=a.slice(0,e),0===(e-=i)){i===a.length?(++n,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=a.slice(i));break}++n}return this.length-=n,r}},{key:"_getBuffer",value:function(e){var t=c.allocUnsafe(e),n=this.head,r=1;for(n.data.copy(t),e-=n.data.length;n=n.next;){var a=n.data,i=e>a.length?a.length:e;if(a.copy(t,t.length-e,0,i),0===(e-=i)){i===a.length?(++r,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=a.slice(i));break}++r}return this.length-=r,t}},{key:l,value:function(e,t){return u(this,a(a({},t),{},{depth:0,customInspect:!1}))}}])&&o(t.prototype,n),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}()},2836:(e,t,n)=>{"use strict";var r=n(2285);function a(e,t){o(e,t),i(e)}function i(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function o(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var n=this,s=this._readableState&&this._readableState.destroyed,c=this._writableState&&this._writableState.destroyed;return s||c?(t?t(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,r.nextTick(o,this,e)):r.nextTick(o,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?n._writableState?n._writableState.errorEmitted?r.nextTick(i,n):(n._writableState.errorEmitted=!0,r.nextTick(a,n,e)):r.nextTick(a,n,e):t?(r.nextTick(i,n),t(e)):r.nextTick(i,n)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var n=e._readableState,r=e._writableState;n&&n.autoDestroy||r&&r.autoDestroy?e.destroy(t):e.emit("error",t)}}},7530:(e,t,n)=>{"use strict";var r=n(6556).F.ERR_STREAM_PREMATURE_CLOSE;function a(){}e.exports=function e(t,n,i){if("function"===typeof n)return e(t,null,n);n||(n={}),i=function(e){var t=!1;return function(){if(!t){t=!0;for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];e.apply(this,r)}}}(i||a);var o=n.readable||!1!==n.readable&&t.readable,s=n.writable||!1!==n.writable&&t.writable,c=function(){t.writable||l()},u=t._writableState&&t._writableState.finished,l=function(){s=!1,u=!0,o||i.call(t)},f=t._readableState&&t._readableState.endEmitted,d=function(){o=!1,f=!0,s||i.call(t)},h=function(e){i.call(t,e)},p=function(){var e;return o&&!f?(t._readableState&&t._readableState.ended||(e=new r),i.call(t,e)):s&&!u?(t._writableState&&t._writableState.ended||(e=new r),i.call(t,e)):void 0},g=function(){t.req.on("finish",l)};return!function(e){return e.setHeader&&"function"===typeof e.abort}(t)?s&&!t._writableState&&(t.on("end",c),t.on("close",c)):(t.on("complete",l),t.on("abort",p),t.req?g():t.on("request",g)),t.on("end",d),t.on("finish",l),!1!==n.error&&t.on("error",h),t.on("close",p),function(){t.removeListener("complete",l),t.removeListener("abort",p),t.removeListener("request",g),t.req&&t.req.removeListener("finish",l),t.removeListener("end",c),t.removeListener("close",c),t.removeListener("finish",l),t.removeListener("end",d),t.removeListener("error",h),t.removeListener("close",p)}}},5137:e=>{e.exports=function(){throw new Error("Readable.from is not available in the browser")}},3074:(e,t,n)=>{"use strict";var r;var a=n(6556).F,i=a.ERR_MISSING_ARGS,o=a.ERR_STREAM_DESTROYED;function s(e){if(e)throw e}function c(e){e()}function u(e,t){return e.pipe(t)}e.exports=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];var l,f=function(e){return e.length?"function"!==typeof e[e.length-1]?s:e.pop():s}(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new i("streams");var d=t.map((function(e,a){var i=a<t.length-1;return function(e,t,a,i){i=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(i);var s=!1;e.on("close",(function(){s=!0})),void 0===r&&(r=n(7530)),r(e,{readable:t,writable:a},(function(e){if(e)return i(e);s=!0,i()}));var c=!1;return function(t){if(!s&&!c)return c=!0,function(e){return e.setHeader&&"function"===typeof e.abort}(e)?e.abort():"function"===typeof e.destroy?e.destroy():void i(t||new o("pipe"))}}(e,i,a>0,(function(e){l||(l=e),e&&d.forEach(c),i||(d.forEach(c),f(l))}))}));return t.reduce(u)}},8607:(e,t,n)=>{"use strict";var r=n(6556).F.ERR_INVALID_OPT_VALUE;e.exports={getHighWaterMark:function(e,t,n,a){var i=function(e,t,n){return null!=e.highWaterMark?e.highWaterMark:t?e[n]:null}(t,a,n);if(null!=i){if(!isFinite(i)||Math.floor(i)!==i||i<0)throw new r(a?n:"highWaterMark",i);return Math.floor(i)}return e.objectMode?16:16384}}},9365:(e,t,n)=>{e.exports=n(7284).EventEmitter},9531:(e,t,n)=>{(t=e.exports=n(7944)).Stream=t,t.Readable=t,t.Writable=n(8696),t.Duplex=n(7610),t.Transform=n(438),t.PassThrough=n(460),t.finished=n(7530),t.pipeline=n(3074)},8694:(e,t,n)=>{"use strict";var r=n(144).Buffer,a=r.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function i(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!==typeof t&&(r.isEncoding===a||!a(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=c,this.end=u,t=4;break;case"utf8":this.fillLast=s,t=4;break;case"base64":this.text=l,this.end=f,t=3;break;default:return this.write=d,void(this.end=h)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(t)}function o(e){return e<=127?0:e>>5===6?2:e>>4===14?3:e>>3===30?4:e>>6===2?-1:-2}function s(e){var t=this.lastTotal-this.lastNeed,n=function(e,t){if(128!==(192&t[0]))return e.lastNeed=0,"\ufffd";if(e.lastNeed>1&&t.length>1){if(128!==(192&t[1]))return e.lastNeed=1,"\ufffd";if(e.lastNeed>2&&t.length>2&&128!==(192&t[2]))return e.lastNeed=2,"\ufffd"}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function c(e,t){if((e.length-t)%2===0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function u(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function l(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function f(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function d(e){return e.toString(this.encoding)}function h(e){return e&&e.length?this.write(e):""}t.I=i,i.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},i.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"\ufffd":t},i.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var a=o(t[r]);if(a>=0)return a>0&&(e.lastNeed=a-1),a;if(--r<n||-2===a)return 0;if(a=o(t[r]),a>=0)return a>0&&(e.lastNeed=a-2),a;if(--r<n||-2===a)return 0;if(a=o(t[r]),a>=0)return a>0&&(2===a?a=0:e.lastNeed=a-3),a;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},i.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},144:(e,t,n)=>{var r=n(6382),a=r.Buffer;function i(e,t){for(var n in e)t[n]=e[n]}function o(e,t,n){return a(e,t,n)}a.from&&a.alloc&&a.allocUnsafe&&a.allocUnsafeSlow?e.exports=r:(i(r,t),t.Buffer=o),i(a,o),o.from=function(e,t,n){if("number"===typeof e)throw new TypeError("Argument must not be a number");return a(e,t,n)},o.alloc=function(e,t,n){if("number"!==typeof e)throw new TypeError("Argument must be a number");var r=a(e);return void 0!==t?"string"===typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},o.allocUnsafe=function(e){if("number"!==typeof e)throw new TypeError("Argument must be a number");return a(e)},o.allocUnsafeSlow=function(e){if("number"!==typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},2390:(e,t,n)=>{function r(e){try{if(!n.g.localStorage)return!1}catch(r){return!1}var t=n.g.localStorage[e];return null!=t&&"true"===String(t).toLowerCase()}e.exports=function(e,t){if(r("noDeprecation"))return e;var n=!1;return function(){if(!n){if(r("throwDeprecation"))throw new Error(t);r("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}}},5817:()=>{},8590:()=>{},4530:()=>{},8108:()=>{},551:()=>{},385:()=>{},1065:()=>{},3886:()=>{},1234:()=>{},5187:()=>{},300:()=>{}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var i=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}n.amdD=function(){throw new Error("define cannot be used indirect")},n.amdO={},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,a){if(1&a&&(r=this(r)),8&a)return r;if("object"===typeof r&&r){if(4&a&&r.__esModule)return r;if(16&a&&"function"===typeof r.then)return r}var i=Object.create(null);n.r(i);var o={};e=e||[null,t({}),t([]),t(t)];for(var s=2&a&&r;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach((e=>o[e]=()=>r[e]));return o.default=()=>r,n.d(i,o),i}})(),n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),n.nc=void 0,(()=>{"use strict";var e={};n.r(e),n.d(e,{Decoder:()=>As,Encoder:()=>Ns,PacketType:()=>ks,protocol:()=>Is});var t={};n.r(t),n.d(t,{assertParamsValid:()=>bx,computeFlatOffset:()=>Lx,computeOutShape:()=>xx,getNormalizedAxes:()=>Mx,isSliceContinous:()=>Nx,maskToAxes:()=>yx,parseSliceParams:()=>Ax,sliceInfo:()=>Rx,startForAxis:()=>Ix,startIndicesWithElidedDims:()=>_x,stopForAxis:()=>kx,stopIndicesWithElidedDims:()=>Ex,stridesForAxis:()=>Tx,stridesWithElidedDims:()=>wx});var r={};n.r(r),n.d(r,{collectGatherOpShapeInfo:()=>JM,computeOutShape:()=>QM,segOpComputeOptimalWindowSize:()=>KM});var a={};n.r(a),n.d(a,{ERF_A1:()=>hM,ERF_A2:()=>pM,ERF_A3:()=>gM,ERF_A4:()=>mM,ERF_A5:()=>vM,ERF_P:()=>dM,PARALLELIZE_THRESHOLD:()=>ZC,RowPartitionType:()=>XC,SELU_SCALE:()=>fM,SELU_SCALEALPHA:()=>lM,applyActivation:()=>QS,assertAndGetBroadcastShape:()=>tx,assertAxesAreInnerMostDims:()=>Gw,assertParamsConsistent:()=>HC,assignToTypedArray:()=>CM,axesAreInnerMostDims:()=>jw,calculateShapes:()=>uM,checkEinsumDimSizes:()=>AM,checkPadOnDimRoundingMode:()=>Zx,combineLocations:()=>Bw,combineRaggedTensorToTensorShapes:()=>qC,complexWithEvenIndex:()=>xM,complexWithOddIndex:()=>wM,computeConv2DInfo:()=>Ux,computeConv3DInfo:()=>Wx,computeDefaultPad:()=>Gx,computeDilation2DInfo:()=>zx,computeOptimalWindowSize:()=>$C,computeOutAndReduceShapes:()=>Uw,computeOutShape:()=>YC,computePool2DInfo:()=>jx,computePool3DInfo:()=>Bx,convertConv2DDataFormat:()=>Jx,decodeEinsumEquation:()=>NM,eitherStridesOrDilationsAreOne:()=>Kx,expandShapeToKeepDim:()=>Ww,exponent:()=>_M,exponents:()=>MM,fromStringArrayToUint8:()=>$M,fromUint8ToStringArray:()=>ZM,getAxesPermutation:()=>Vw,getBroadcastDims:()=>$y,getComplexWithIndex:()=>SM,getEinsumComputePath:()=>RM,getEinsumPermutation:()=>LM,getFusedBiasGradient:()=>KS,getFusedDyActivation:()=>qS,getImageCenter:()=>eM,getInnerMostAxes:()=>Yw,getPermuted:()=>nM,getRaggedRank:()=>QC,getReductionAxes:()=>ex,getReshaped:()=>tM,getReshapedPermuted:()=>rM,getRowPartitionTypesHelper:()=>KC,getSliceBeginCoords:()=>aM,getSliceSize:()=>iM,getSparseFillEmptyRowsIndicesDenseShapeMismatch:()=>FM,getSparseFillEmptyRowsNegativeIndexErrorMessage:()=>zM,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:()=>jM,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:()=>WM,getSparseReshapeInputOutputMismatchErrorMessage:()=>VM,getSparseReshapeInputOutputMultipleErrorMessage:()=>GM,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:()=>BM,getSparseReshapeNegativeOutputDimErrorMessage:()=>UM,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:()=>qM,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:()=>HM,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:()=>YM,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:()=>XM,getUndoAxesPermutation:()=>Hw,isIdentityPermutation:()=>DM,log:()=>uv,mergeRealAndImagArrays:()=>bM,prepareAndValidate:()=>oM,prepareSplitSize:()=>PM,segment_util:()=>r,shouldFuse:()=>JS,slice_util:()=>t,splitRealAndImagArrays:()=>yM,stridesOrDilationsArePositive:()=>Qx,tupleValuesAreOne:()=>qx,upcastType:()=>sb,validateDefaultValueShape:()=>JC,validateInput:()=>cM,validateUpdateShape:()=>sM,warn:()=>cv});var i={};n.r(i),n.d(i,{mx:()=>QD,XI:()=>WO,Nk:()=>GO,f6:()=>HO,ct:()=>HD,YG:()=>qO,hH:()=>eP,z3:()=>zP,sG:()=>KP,uM:()=>eF,vS:()=>vF,qB:()=>_F,GG:()=>TF,lg:()=>AF,rq:()=>kF,cu:()=>HF,WR:()=>WF,GE:()=>qF,px:()=>QF,jC:()=>fz,He:()=>pz,hE:()=>Mz,BF:()=>NP,Dk:()=>Dz,cl:()=>Wz,_B:()=>tj,ub:()=>oj,_f:()=>uj,Ku:()=>gj,qy:()=>vj,Zy:()=>kj,bu:()=>Aj,zv:()=>PD,dH:()=>iO,HS:()=>zO,yH:()=>Zj,l3:()=>eB,z9:()=>nB,x6:()=>sB,_m:()=>pB,eW:()=>yB,GK:()=>SB,SP:()=>_B,yr:()=>TB,dl:()=>oF,Dw:()=>RB,xT:()=>FB,_X:()=>dO,wz:()=>VB});var o=n(5043),s=n.t(o,2),c=n(4391);var u=function(){return u=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},u.apply(this,arguments)};Object.create;function l(e,t,n){if(n||2===arguments.length)for(var r,a=0,i=t.length;a<i;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))}Object.create;"function"===typeof SuppressedError&&SuppressedError;var f=n(7324),d=n.n(f),h="-ms-",p="-moz-",g="-webkit-",m="comm",v="rule",b="decl",y="@keyframes",x=Math.abs,w=String.fromCharCode,S=Object.assign;function C(e){return e.trim()}function M(e,t){return(e=t.exec(e))?e[0]:e}function _(e,t,n){return e.replace(t,n)}function E(e,t,n){return e.indexOf(t,n)}function T(e,t){return 0|e.charCodeAt(t)}function I(e,t,n){return e.slice(t,n)}function k(e){return e.length}function N(e){return e.length}function L(e,t){return t.push(e),e}function A(e,t){return e.filter((function(e){return!M(e,t)}))}var R=1,D=1,O=0,P=0,F=0,z="";function j(e,t,n,r,a,i,o,s){return{value:e,root:t,parent:n,type:r,props:a,children:i,line:R,column:D,length:o,return:"",siblings:s}}function B(e,t){return S(j("",null,null,"",null,null,0,e.siblings),e,{length:-e.length},t)}function U(e){for(;e.root;)e=B(e.root,{children:[e]});L(e,e.siblings)}function W(){return F=P>0?T(z,--P):0,D--,10===F&&(D=1,R--),F}function G(){return F=P<O?T(z,P++):0,D++,10===F&&(D=1,R++),F}function V(){return T(z,P)}function H(){return P}function Y(e,t){return I(z,e,t)}function X(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function q(e){return R=D=1,O=k(z=e),P=0,[]}function K(e){return z="",e}function Q(e){return C(Y(P-1,$(91===e?e+2:40===e?e+1:e)))}function J(e){for(;(F=V())&&F<33;)G();return X(e)>2||X(F)>3?"":" "}function Z(e,t){for(;--t&&G()&&!(F<48||F>102||F>57&&F<65||F>70&&F<97););return Y(e,H()+(t<6&&32==V()&&32==G()))}function $(e){for(;G();)switch(F){case e:return P;case 34:case 39:34!==e&&39!==e&&$(F);break;case 40:41===e&&$(e);break;case 92:G()}return P}function ee(e,t){for(;G()&&e+F!==57&&(e+F!==84||47!==V()););return"/*"+Y(t,P-1)+"*"+w(47===e?e:G())}function te(e){for(;!X(V());)G();return Y(e,P)}function ne(e,t){for(var n="",r=0;r<e.length;r++)n+=t(e[r],r,e,t)||"";return n}function re(e,t,n,r){switch(e.type){case"@layer":if(e.children.length)break;case"@import":case b:return e.return=e.return||e.value;case m:return"";case y:return e.return=e.value+"{"+ne(e.children,r)+"}";case v:if(!k(e.value=e.props.join(",")))return""}return k(n=ne(e.children,r))?e.return=e.value+"{"+n+"}":""}function ae(e,t,n){switch(function(e,t){return 45^T(e,0)?(((t<<2^T(e,0))<<2^T(e,1))<<2^T(e,2))<<2^T(e,3):0}(e,t)){case 5103:return g+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return g+e+e;case 4789:return p+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return g+e+p+e+h+e+e;case 5936:switch(T(e,t+11)){case 114:return g+e+h+_(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return g+e+h+_(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return g+e+h+_(e,/[svh]\w+-[tblr]{2}/,"lr")+e}case 6828:case 4268:case 2903:return g+e+h+e+e;case 6165:return g+e+h+"flex-"+e+e;case 5187:return g+e+_(e,/(\w+).+(:[^]+)/,g+"box-$1$2"+h+"flex-$1$2")+e;case 5443:return g+e+h+"flex-item-"+_(e,/flex-|-self/g,"")+(M(e,/flex-|baseline/)?"":h+"grid-row-"+_(e,/flex-|-self/g,""))+e;case 4675:return g+e+h+"flex-line-pack"+_(e,/align-content|flex-|-self/g,"")+e;case 5548:return g+e+h+_(e,"shrink","negative")+e;case 5292:return g+e+h+_(e,"basis","preferred-size")+e;case 6060:return g+"box-"+_(e,"-grow","")+g+e+h+_(e,"grow","positive")+e;case 4554:return g+_(e,/([^-])(transform)/g,"$1"+g+"$2")+e;case 6187:return _(_(_(e,/(zoom-|grab)/,g+"$1"),/(image-set)/,g+"$1"),e,"")+e;case 5495:case 3959:return _(e,/(image-set\([^]*)/,g+"$1$`$1");case 4968:return _(_(e,/(.+:)(flex-)?(.*)/,g+"box-pack:$3"+h+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+g+e+e;case 4200:if(!M(e,/flex-|baseline/))return h+"grid-column-align"+I(e,t)+e;break;case 2592:case 3360:return h+_(e,"template-","")+e;case 4384:case 3616:return n&&n.some((function(e,n){return t=n,M(e.props,/grid-\w+-end/)}))?~E(e+(n=n[t].value),"span",0)?e:h+_(e,"-start","")+e+h+"grid-row-span:"+(~E(n,"span",0)?M(n,/\d+/):+M(n,/\d+/)-+M(e,/\d+/))+";":h+_(e,"-start","")+e;case 4896:case 4128:return n&&n.some((function(e){return M(e.props,/grid-\w+-start/)}))?e:h+_(_(e,"-end","-span"),"span ","")+e;case 4095:case 3583:case 4068:case 2532:return _(e,/(.+)-inline(.+)/,g+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(k(e)-1-t>6)switch(T(e,t+1)){case 109:if(45!==T(e,t+4))break;case 102:return _(e,/(.+:)(.+)-([^]+)/,"$1"+g+"$2-$3$1"+p+(108==T(e,t+3)?"$3":"$2-$3"))+e;case 115:return~E(e,"stretch",0)?ae(_(e,"stretch","fill-available"),t,n)+e:e}break;case 5152:case 5920:return _(e,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,(function(t,n,r,a,i,o,s){return h+n+":"+r+s+(a?h+n+"-span:"+(i?o:+o-+r)+s:"")+e}));case 4949:if(121===T(e,t+6))return _(e,":",":"+g)+e;break;case 6444:switch(T(e,45===T(e,14)?18:11)){case 120:return _(e,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+g+(45===T(e,14)?"inline-":"")+"box$3$1"+g+"$2$3$1"+h+"$2box$3")+e;case 100:return _(e,":",":"+h)+e}break;case 5719:case 2647:case 2135:case 3927:case 2391:return _(e,"scroll-","scroll-snap-")+e}return e}function ie(e,t,n,r){if(e.length>-1&&!e.return)switch(e.type){case b:return void(e.return=ae(e.value,e.length,n));case y:return ne([B(e,{value:_(e.value,"@","@"+g)})],r);case v:if(e.length)return function(e,t){return e.map(t).join("")}(n=e.props,(function(t){switch(M(t,r=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":U(B(e,{props:[_(t,/:(read-\w+)/,":-moz-$1")]})),U(B(e,{props:[t]})),S(e,{props:A(n,r)});break;case"::placeholder":U(B(e,{props:[_(t,/:(plac\w+)/,":"+g+"input-$1")]})),U(B(e,{props:[_(t,/:(plac\w+)/,":-moz-$1")]})),U(B(e,{props:[_(t,/:(plac\w+)/,h+"input-$1")]})),U(B(e,{props:[t]})),S(e,{props:A(n,r)})}return""}))}}function oe(e){return K(se("",null,null,null,[""],e=q(e),0,[0],e))}function se(e,t,n,r,a,i,o,s,c){for(var u=0,l=0,f=o,d=0,h=0,p=0,g=1,m=1,v=1,b=0,y="",S=a,C=i,M=r,I=y;m;)switch(p=b,b=G()){case 40:if(108!=p&&58==T(I,f-1)){-1!=E(I+=_(Q(b),"&","&\f"),"&\f",x(u?s[u-1]:0))&&(v=-1);break}case 34:case 39:case 91:I+=Q(b);break;case 9:case 10:case 13:case 32:I+=J(p);break;case 92:I+=Z(H()-1,7);continue;case 47:switch(V()){case 42:case 47:L(ue(ee(G(),H()),t,n,c),c);break;default:I+="/"}break;case 123*g:s[u++]=k(I)*v;case 125*g:case 59:case 0:switch(b){case 0:case 125:m=0;case 59+l:-1==v&&(I=_(I,/\f/g,"")),h>0&&k(I)-f&&L(h>32?le(I+";",r,n,f-1,c):le(_(I," ","")+";",r,n,f-2,c),c);break;case 59:I+=";";default:if(L(M=ce(I,t,n,u,l,a,s,y,S=[],C=[],f,i),i),123===b)if(0===l)se(I,t,M,M,S,i,f,s,C);else switch(99===d&&110===T(I,3)?100:d){case 100:case 108:case 109:case 115:se(e,M,M,r&&L(ce(e,M,M,0,0,a,s,y,a,S=[],f,C),C),a,C,f,s,r?S:C);break;default:se(I,M,M,M,[""],C,0,s,C)}}u=l=h=0,g=v=1,y=I="",f=o;break;case 58:f=1+k(I),h=p;default:if(g<1)if(123==b)--g;else if(125==b&&0==g++&&125==W())continue;switch(I+=w(b),b*g){case 38:v=l>0?1:(I+="\f",-1);break;case 44:s[u++]=(k(I)-1)*v,v=1;break;case 64:45===V()&&(I+=Q(G())),d=V(),l=f=k(y=I+=te(H())),b++;break;case 45:45===p&&2==k(I)&&(g=0)}}return i}function ce(e,t,n,r,a,i,o,s,c,u,l,f){for(var d=a-1,h=0===a?i:[""],p=N(h),g=0,m=0,b=0;g<r;++g)for(var y=0,w=I(e,d+1,d=x(m=o[g])),S=e;y<p;++y)(S=C(m>0?h[y]+" "+w:_(w,/&\f/g,h[y])))&&(c[b++]=S);return j(e,t,n,0===a?v:s,c,u,l,f)}function ue(e,t,n,r){return j(e,t,n,m,w(F),I(e,2,-2),0,r)}function le(e,t,n,r,a){return j(e,t,n,b,I(e,0,r),I(e,r+1,-1),r,a)}var fe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},de=n(2285),he="undefined"!=typeof de&&void 0!=={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}&&({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_SC_ATTR||{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.SC_ATTR)||"data-styled",pe="active",ge="data-styled-version",me="6.1.14",ve="/*!sc*/\n",be="undefined"!=typeof window&&"HTMLElement"in window,ye=Boolean("boolean"==typeof SC_DISABLE_SPEEDY?SC_DISABLE_SPEEDY:"undefined"!=typeof de&&void 0!=={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}&&void 0!=={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_SC_DISABLE_SPEEDY&&""!=={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_SC_DISABLE_SPEEDY?"false"!=={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_SC_DISABLE_SPEEDY&&{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_SC_DISABLE_SPEEDY:"undefined"!=typeof de&&void 0!=={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}&&void 0!=={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.SC_DISABLE_SPEEDY&&""!=={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.SC_DISABLE_SPEEDY&&("false"!=={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.SC_DISABLE_SPEEDY&&{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.SC_DISABLE_SPEEDY)),xe={},we=(new Set,Object.freeze([])),Se=Object.freeze({});function Ce(e,t,n){return void 0===n&&(n=Se),e.theme!==n.theme&&e.theme||t||n.theme}var Me=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),_e=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,Ee=/(^-|-$)/g;function Te(e){return e.replace(_e,"-").replace(Ee,"")}var Ie=/(a)(d)/gi,ke=function(e){return String.fromCharCode(e+(e>25?39:97))};function Ne(e){var t,n="";for(t=Math.abs(e);t>52;t=t/52|0)n=ke(t%52)+n;return(ke(t%52)+n).replace(Ie,"$1-$2")}var Le,Ae=function(e,t){for(var n=t.length;n;)e=33*e^t.charCodeAt(--n);return e},Re=function(e){return Ae(5381,e)};function De(e){return Ne(Re(e)>>>0)}function Oe(e){return e.displayName||e.name||"Component"}function Pe(e){return"string"==typeof e&&!0}var Fe="function"==typeof Symbol&&Symbol.for,ze=Fe?Symbol.for("react.memo"):60115,je=Fe?Symbol.for("react.forward_ref"):60112,Be={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},Ue={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},We={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},Ge=((Le={})[je]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},Le[ze]=We,Le);function Ve(e){return("type"in(t=e)&&t.type.$$typeof)===ze?We:"$$typeof"in e?Ge[e.$$typeof]:Be;var t}var He=Object.defineProperty,Ye=Object.getOwnPropertyNames,Xe=Object.getOwnPropertySymbols,qe=Object.getOwnPropertyDescriptor,Ke=Object.getPrototypeOf,Qe=Object.prototype;function Je(e,t,n){if("string"!=typeof t){if(Qe){var r=Ke(t);r&&r!==Qe&&Je(e,r,n)}var a=Ye(t);Xe&&(a=a.concat(Xe(t)));for(var i=Ve(e),o=Ve(t),s=0;s<a.length;++s){var c=a[s];if(!(c in Ue||n&&n[c]||o&&c in o||i&&c in i)){var u=qe(t,c);try{He(e,c,u)}catch(e){}}}}return e}function Ze(e){return"function"==typeof e}function $e(e){return"object"==typeof e&&"styledComponentId"in e}function et(e,t){return e&&t?"".concat(e," ").concat(t):e||t||""}function tt(e,t){if(0===e.length)return"";for(var n=e[0],r=1;r<e.length;r++)n+=t?t+e[r]:e[r];return n}function nt(e){return null!==e&&"object"==typeof e&&e.constructor.name===Object.name&&!("props"in e&&e.$$typeof)}function rt(e,t,n){if(void 0===n&&(n=!1),!n&&!nt(e)&&!Array.isArray(e))return t;if(Array.isArray(t))for(var r=0;r<t.length;r++)e[r]=rt(e[r],t[r]);else if(nt(t))for(var r in t)e[r]=rt(e[r],t[r]);return e}function at(e,t){Object.defineProperty(e,"toString",{value:t})}function it(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(e," for more information.").concat(t.length>0?" Args: ".concat(t.join(", ")):""))}var ot=function(){function e(e){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=e}return e.prototype.indexOfGroup=function(e){for(var t=0,n=0;n<e;n++)t+=this.groupSizes[n];return t},e.prototype.insertRules=function(e,t){if(e>=this.groupSizes.length){for(var n=this.groupSizes,r=n.length,a=r;e>=a;)if((a<<=1)<0)throw it(16,"".concat(e));this.groupSizes=new Uint32Array(a),this.groupSizes.set(n),this.length=a;for(var i=r;i<a;i++)this.groupSizes[i]=0}for(var o=this.indexOfGroup(e+1),s=(i=0,t.length);i<s;i++)this.tag.insertRule(o,t[i])&&(this.groupSizes[e]++,o++)},e.prototype.clearGroup=function(e){if(e<this.length){var t=this.groupSizes[e],n=this.indexOfGroup(e),r=n+t;this.groupSizes[e]=0;for(var a=n;a<r;a++)this.tag.deleteRule(n)}},e.prototype.getGroup=function(e){var t="";if(e>=this.length||0===this.groupSizes[e])return t;for(var n=this.groupSizes[e],r=this.indexOfGroup(e),a=r+n,i=r;i<a;i++)t+="".concat(this.tag.getRule(i)).concat(ve);return t},e}(),st=new Map,ct=new Map,ut=1,lt=function(e){if(st.has(e))return st.get(e);for(;ct.has(ut);)ut++;var t=ut++;return st.set(e,t),ct.set(t,e),t},ft=function(e,t){ut=t+1,st.set(e,t),ct.set(t,e)},dt="style[".concat(he,"][").concat(ge,'="').concat(me,'"]'),ht=new RegExp("^".concat(he,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),pt=function(e,t,n){for(var r,a=n.split(","),i=0,o=a.length;i<o;i++)(r=a[i])&&e.registerName(t,r)},gt=function(e,t){for(var n,r=(null!==(n=t.textContent)&&void 0!==n?n:"").split(ve),a=[],i=0,o=r.length;i<o;i++){var s=r[i].trim();if(s){var c=s.match(ht);if(c){var u=0|parseInt(c[1],10),l=c[2];0!==u&&(ft(l,u),pt(e,l,c[3]),e.getTag().insertRules(u,a)),a.length=0}else a.push(s)}}},mt=function(e){for(var t=document.querySelectorAll(dt),n=0,r=t.length;n<r;n++){var a=t[n];a&&a.getAttribute(he)!==pe&&(gt(e,a),a.parentNode&&a.parentNode.removeChild(a))}};function vt(){return n.nc}var bt=function(e){var t=document.head,n=e||t,r=document.createElement("style"),a=function(e){var t=Array.from(e.querySelectorAll("style[".concat(he,"]")));return t[t.length-1]}(n),i=void 0!==a?a.nextSibling:null;r.setAttribute(he,pe),r.setAttribute(ge,me);var o=vt();return o&&r.setAttribute("nonce",o),n.insertBefore(r,i),r},yt=function(){function e(e){this.element=bt(e),this.element.appendChild(document.createTextNode("")),this.sheet=function(e){if(e.sheet)return e.sheet;for(var t=document.styleSheets,n=0,r=t.length;n<r;n++){var a=t[n];if(a.ownerNode===e)return a}throw it(17)}(this.element),this.length=0}return e.prototype.insertRule=function(e,t){try{return this.sheet.insertRule(t,e),this.length++,!0}catch(e){return!1}},e.prototype.deleteRule=function(e){this.sheet.deleteRule(e),this.length--},e.prototype.getRule=function(e){var t=this.sheet.cssRules[e];return t&&t.cssText?t.cssText:""},e}(),xt=function(){function e(e){this.element=bt(e),this.nodes=this.element.childNodes,this.length=0}return e.prototype.insertRule=function(e,t){if(e<=this.length&&e>=0){var n=document.createTextNode(t);return this.element.insertBefore(n,this.nodes[e]||null),this.length++,!0}return!1},e.prototype.deleteRule=function(e){this.element.removeChild(this.nodes[e]),this.length--},e.prototype.getRule=function(e){return e<this.length?this.nodes[e].textContent:""},e}(),wt=function(){function e(e){this.rules=[],this.length=0}return e.prototype.insertRule=function(e,t){return e<=this.length&&(this.rules.splice(e,0,t),this.length++,!0)},e.prototype.deleteRule=function(e){this.rules.splice(e,1),this.length--},e.prototype.getRule=function(e){return e<this.length?this.rules[e]:""},e}(),St=be,Ct={isServer:!be,useCSSOMInjection:!ye},Mt=function(){function e(e,t,n){void 0===e&&(e=Se),void 0===t&&(t={});var r=this;this.options=u(u({},Ct),e),this.gs=t,this.names=new Map(n),this.server=!!e.isServer,!this.server&&be&&St&&(St=!1,mt(this)),at(this,(function(){return function(e){for(var t=e.getTag(),n=t.length,r="",a=function(n){var a=function(e){return ct.get(e)}(n);if(void 0===a)return"continue";var i=e.names.get(a),o=t.getGroup(n);if(void 0===i||!i.size||0===o.length)return"continue";var s="".concat(he,".g").concat(n,'[id="').concat(a,'"]'),c="";void 0!==i&&i.forEach((function(e){e.length>0&&(c+="".concat(e,","))})),r+="".concat(o).concat(s,'{content:"').concat(c,'"}').concat(ve)},i=0;i<n;i++)a(i);return r}(r)}))}return e.registerId=function(e){return lt(e)},e.prototype.rehydrate=function(){!this.server&&be&&mt(this)},e.prototype.reconstructWithOptions=function(t,n){return void 0===n&&(n=!0),new e(u(u({},this.options),t),this.gs,n&&this.names||void 0)},e.prototype.allocateGSInstance=function(e){return this.gs[e]=(this.gs[e]||0)+1},e.prototype.getTag=function(){return this.tag||(this.tag=(e=function(e){var t=e.useCSSOMInjection,n=e.target;return e.isServer?new wt(n):t?new yt(n):new xt(n)}(this.options),new ot(e)));var e},e.prototype.hasNameForId=function(e,t){return this.names.has(e)&&this.names.get(e).has(t)},e.prototype.registerName=function(e,t){if(lt(e),this.names.has(e))this.names.get(e).add(t);else{var n=new Set;n.add(t),this.names.set(e,n)}},e.prototype.insertRules=function(e,t,n){this.registerName(e,t),this.getTag().insertRules(lt(e),n)},e.prototype.clearNames=function(e){this.names.has(e)&&this.names.get(e).clear()},e.prototype.clearRules=function(e){this.getTag().clearGroup(lt(e)),this.clearNames(e)},e.prototype.clearTag=function(){this.tag=void 0},e}(),_t=/&/g,Et=/^\s*\/\/.*$/gm;function Tt(e,t){return e.map((function(e){return"rule"===e.type&&(e.value="".concat(t," ").concat(e.value),e.value=e.value.replaceAll(",",",".concat(t," ")),e.props=e.props.map((function(e){return"".concat(t," ").concat(e)}))),Array.isArray(e.children)&&"@keyframes"!==e.type&&(e.children=Tt(e.children,t)),e}))}function It(e){var t,n,r,a=void 0===e?Se:e,i=a.options,o=void 0===i?Se:i,s=a.plugins,c=void 0===s?we:s,u=function(e,r,a){return a.startsWith(n)&&a.endsWith(n)&&a.replaceAll(n,"").length>0?".".concat(t):e},l=c.slice();l.push((function(e){e.type===v&&e.value.includes("&")&&(e.props[0]=e.props[0].replace(_t,n).replace(r,u))})),o.prefix&&l.push(ie),l.push(re);var f=function(e,a,i,s){void 0===a&&(a=""),void 0===i&&(i=""),void 0===s&&(s="&"),t=s,n=a,r=new RegExp("\\".concat(n,"\\b"),"g");var c=e.replace(Et,""),u=oe(i||a?"".concat(i," ").concat(a," { ").concat(c," }"):c);o.namespace&&(u=Tt(u,o.namespace));var f,d=[];return ne(u,function(e){var t=N(e);return function(n,r,a,i){for(var o="",s=0;s<t;s++)o+=e[s](n,r,a,i)||"";return o}}(l.concat((f=function(e){return d.push(e)},function(e){e.root||(e=e.return)&&f(e)})))),d};return f.hash=c.length?c.reduce((function(e,t){return t.name||it(15),Ae(e,t.name)}),5381).toString():"",f}var kt=new Mt,Nt=It(),Lt=o.createContext({shouldForwardProp:void 0,styleSheet:kt,stylis:Nt}),At=(Lt.Consumer,o.createContext(void 0));function Rt(){return(0,o.useContext)(Lt)}function Dt(e){var t=(0,o.useState)(e.stylisPlugins),n=t[0],r=t[1],a=Rt().styleSheet,i=(0,o.useMemo)((function(){var t=a;return e.sheet?t=e.sheet:e.target&&(t=t.reconstructWithOptions({target:e.target},!1)),e.disableCSSOMInjection&&(t=t.reconstructWithOptions({useCSSOMInjection:!1})),t}),[e.disableCSSOMInjection,e.sheet,e.target,a]),s=(0,o.useMemo)((function(){return It({options:{namespace:e.namespace,prefix:e.enableVendorPrefixes},plugins:n})}),[e.enableVendorPrefixes,e.namespace,n]);(0,o.useEffect)((function(){d()(n,e.stylisPlugins)||r(e.stylisPlugins)}),[e.stylisPlugins]);var c=(0,o.useMemo)((function(){return{shouldForwardProp:e.shouldForwardProp,styleSheet:i,stylis:s}}),[e.shouldForwardProp,i,s]);return o.createElement(Lt.Provider,{value:c},o.createElement(At.Provider,{value:s},e.children))}var Ot=function(){function e(e,t){var n=this;this.inject=function(e,t){void 0===t&&(t=Nt);var r=n.name+t.hash;e.hasNameForId(n.id,r)||e.insertRules(n.id,r,t(n.rules,r,"@keyframes"))},this.name=e,this.id="sc-keyframes-".concat(e),this.rules=t,at(this,(function(){throw it(12,String(n.name))}))}return e.prototype.getName=function(e){return void 0===e&&(e=Nt),this.name+e.hash},e}(),Pt=function(e){return e>="A"&&e<="Z"};function Ft(e){for(var t="",n=0;n<e.length;n++){var r=e[n];if(1===n&&"-"===r&&"-"===e[0])return e;Pt(r)?t+="-"+r.toLowerCase():t+=r}return t.startsWith("ms-")?"-"+t:t}var zt=function(e){return null==e||!1===e||""===e},jt=function(e){var t,n,r=[];for(var a in e){var i=e[a];e.hasOwnProperty(a)&&!zt(i)&&(Array.isArray(i)&&i.isCss||Ze(i)?r.push("".concat(Ft(a),":"),i,";"):nt(i)?r.push.apply(r,l(l(["".concat(a," {")],jt(i),!1),["}"],!1)):r.push("".concat(Ft(a),": ").concat((t=a,null==(n=i)||"boolean"==typeof n||""===n?"":"number"!=typeof n||0===n||t in fe||t.startsWith("--")?String(n).trim():"".concat(n,"px")),";")))}return r};function Bt(e,t,n,r){return zt(e)?[]:$e(e)?[".".concat(e.styledComponentId)]:Ze(e)?!Ze(a=e)||a.prototype&&a.prototype.isReactComponent||!t?[e]:Bt(e(t),t,n,r):e instanceof Ot?n?(e.inject(n,r),[e.getName(r)]):[e]:nt(e)?jt(e):Array.isArray(e)?Array.prototype.concat.apply(we,e.map((function(e){return Bt(e,t,n,r)}))):[e.toString()];var a}function Ut(e){for(var t=0;t<e.length;t+=1){var n=e[t];if(Ze(n)&&!$e(n))return!1}return!0}var Wt=Re(me),Gt=function(){function e(e,t,n){this.rules=e,this.staticRulesId="",this.isStatic=(void 0===n||n.isStatic)&&Ut(e),this.componentId=t,this.baseHash=Ae(Wt,t),this.baseStyle=n,Mt.registerId(t)}return e.prototype.generateAndInjectStyles=function(e,t,n){var r=this.baseStyle?this.baseStyle.generateAndInjectStyles(e,t,n):"";if(this.isStatic&&!n.hash)if(this.staticRulesId&&t.hasNameForId(this.componentId,this.staticRulesId))r=et(r,this.staticRulesId);else{var a=tt(Bt(this.rules,e,t,n)),i=Ne(Ae(this.baseHash,a)>>>0);if(!t.hasNameForId(this.componentId,i)){var o=n(a,".".concat(i),void 0,this.componentId);t.insertRules(this.componentId,i,o)}r=et(r,i),this.staticRulesId=i}else{for(var s=Ae(this.baseHash,n.hash),c="",u=0;u<this.rules.length;u++){var l=this.rules[u];if("string"==typeof l)c+=l;else if(l){var f=tt(Bt(l,e,t,n));s=Ae(s,f+u),c+=f}}if(c){var d=Ne(s>>>0);t.hasNameForId(this.componentId,d)||t.insertRules(this.componentId,d,n(c,".".concat(d),void 0,this.componentId)),r=et(r,d)}}return r},e}(),Vt=o.createContext(void 0);Vt.Consumer;function Ht(e){var t=o.useContext(Vt),n=(0,o.useMemo)((function(){return function(e,t){if(!e)throw it(14);if(Ze(e))return e(t);if(Array.isArray(e)||"object"!=typeof e)throw it(8);return t?u(u({},t),e):e}(e.theme,t)}),[e.theme,t]);return e.children?o.createElement(Vt.Provider,{value:n},e.children):null}var Yt={};new Set;function Xt(e,t,n){var r=$e(e),a=e,i=!Pe(e),s=t.attrs,c=void 0===s?we:s,l=t.componentId,f=void 0===l?function(e,t){var n="string"!=typeof e?"sc":Te(e);Yt[n]=(Yt[n]||0)+1;var r="".concat(n,"-").concat(De(me+n+Yt[n]));return t?"".concat(t,"-").concat(r):r}(t.displayName,t.parentComponentId):l,d=t.displayName,h=void 0===d?function(e){return Pe(e)?"styled.".concat(e):"Styled(".concat(Oe(e),")")}(e):d,p=t.displayName&&t.componentId?"".concat(Te(t.displayName),"-").concat(t.componentId):t.componentId||f,g=r&&a.attrs?a.attrs.concat(c).filter(Boolean):c,m=t.shouldForwardProp;if(r&&a.shouldForwardProp){var v=a.shouldForwardProp;if(t.shouldForwardProp){var b=t.shouldForwardProp;m=function(e,t){return v(e,t)&&b(e,t)}}else m=v}var y=new Gt(n,p,r?a.componentStyle:void 0);function x(e,t){return function(e,t,n){var r=e.attrs,a=e.componentStyle,i=e.defaultProps,s=e.foldedComponentIds,c=e.styledComponentId,l=e.target,f=o.useContext(Vt),d=Rt(),h=e.shouldForwardProp||d.shouldForwardProp,p=Ce(t,f,i)||Se,g=function(e,t,n){for(var r,a=u(u({},t),{className:void 0,theme:n}),i=0;i<e.length;i+=1){var o=Ze(r=e[i])?r(a):r;for(var s in o)a[s]="className"===s?et(a[s],o[s]):"style"===s?u(u({},a[s]),o[s]):o[s]}return t.className&&(a.className=et(a.className,t.className)),a}(r,t,p),m=g.as||l,v={};for(var b in g)void 0===g[b]||"$"===b[0]||"as"===b||"theme"===b&&g.theme===p||("forwardedAs"===b?v.as=g.forwardedAs:h&&!h(b,m)||(v[b]=g[b]));var y=function(e,t){var n=Rt();return e.generateAndInjectStyles(t,n.styleSheet,n.stylis)}(a,g),x=et(s,c);return y&&(x+=" "+y),g.className&&(x+=" "+g.className),v[Pe(m)&&!Me.has(m)?"class":"className"]=x,n&&(v.ref=n),(0,o.createElement)(m,v)}(w,e,t)}x.displayName=h;var w=o.forwardRef(x);return w.attrs=g,w.componentStyle=y,w.displayName=h,w.shouldForwardProp=m,w.foldedComponentIds=r?et(a.foldedComponentIds,a.styledComponentId):"",w.styledComponentId=p,w.target=r?a.target:e,Object.defineProperty(w,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(e){this._foldedDefaultProps=r?function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0,a=t;r<a.length;r++)rt(e,a[r],!0);return e}({},a.defaultProps,e):e}}),at(w,(function(){return".".concat(w.styledComponentId)})),i&&Je(w,e,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),w}function qt(e,t){for(var n=[e[0]],r=0,a=t.length;r<a;r+=1)n.push(t[r],e[r+1]);return n}var Kt=function(e){return Object.assign(e,{isCss:!0})};function Qt(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Ze(e)||nt(e))return Kt(Bt(qt(we,l([e],t,!0))));var r=e;return 0===t.length&&1===r.length&&"string"==typeof r[0]?Bt(r):Kt(Bt(qt(r,t)))}function Jt(e,t,n){if(void 0===n&&(n=Se),!t)throw it(1,t);var r=function(r){for(var a=[],i=1;i<arguments.length;i++)a[i-1]=arguments[i];return e(t,n,Qt.apply(void 0,l([r],a,!1)))};return r.attrs=function(r){return Jt(e,t,u(u({},n),{attrs:Array.prototype.concat(n.attrs,r).filter(Boolean)}))},r.withConfig=function(r){return Jt(e,t,u(u({},n),r))},r}var Zt=function(e){return Jt(Xt,e)},$t=Zt;Me.forEach((function(e){$t[e]=Zt(e)}));var en=function(){function e(e,t){this.rules=e,this.componentId=t,this.isStatic=Ut(e),Mt.registerId(this.componentId+1)}return e.prototype.createStyles=function(e,t,n,r){var a=r(tt(Bt(this.rules,t,n,r)),""),i=this.componentId+e;n.insertRules(i,i,a)},e.prototype.removeStyles=function(e,t){t.clearRules(this.componentId+e)},e.prototype.renderStyles=function(e,t,n,r){e>2&&Mt.registerId(this.componentId+e),this.removeStyles(e,n),this.createStyles(e,t,n,r)},e}();function tn(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=tt(Qt.apply(void 0,l([e],t,!1))),a=De(r);return new Ot(a,r)}(function(){function e(){var e=this;this._emitSheetCSS=function(){var t=e.instance.toString();if(!t)return"";var n=vt(),r=tt([n&&'nonce="'.concat(n,'"'),"".concat(he,'="true"'),"".concat(ge,'="').concat(me,'"')].filter(Boolean)," ");return"<style ".concat(r,">").concat(t,"</style>")},this.getStyleTags=function(){if(e.sealed)throw it(2);return e._emitSheetCSS()},this.getStyleElement=function(){var t;if(e.sealed)throw it(2);var n=e.instance.toString();if(!n)return[];var r=((t={})[he]="",t[ge]=me,t.dangerouslySetInnerHTML={__html:n},t),a=vt();return a&&(r.nonce=a),[o.createElement("style",u({},r,{key:"sc-0-0"}))]},this.seal=function(){e.sealed=!0},this.instance=new Mt({isServer:!0}),this.sealed=!1}e.prototype.collectStyles=function(e){if(this.sealed)throw it(2);return o.createElement(Dt,{sheet:this.instance},e)},e.prototype.interleaveWithNodeStream=function(e){throw it(3)}})(),"__sc-".concat(he,"__");function nn(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var rn;const an=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=Qt.apply(void 0,l([e],t,!1)),a="sc-global-".concat(De(JSON.stringify(r))),i=new en(r,a),s=function(e){var t=Rt(),n=o.useContext(Vt),r=o.useRef(t.styleSheet.allocateGSInstance(a)).current;return t.styleSheet.server&&c(r,e,t.styleSheet,n,t.stylis),o.useLayoutEffect((function(){if(!t.styleSheet.server)return c(r,e,t.styleSheet,n,t.stylis),function(){return i.removeStyles(r,t.styleSheet)}}),[r,e,t.styleSheet,n,t.stylis]),null};function c(e,t,n,r,a){if(i.isStatic)i.renderStyles(e,xe,n,a);else{var o=u(u({},t),{theme:Ce(t,r,s.defaultProps)});i.renderStyles(e,o,n,a)}}return o.memo(s)}(rn||(rn=nn(["\n  * {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n  }\n\n  body {\n    font-family: ",";\n    color: ",";\n    background-color: ",";\n    overflow-x: hidden;\n  }\n\n  a {\n    text-decoration: none;\n    color: inherit;\n  }\n\n  button {\n    cursor: pointer;\n    border: none;\n    outline: none;\n    background: none;\n    font-family: inherit;\n  }\n\n  @keyframes fadeIn {\n    from {\n      opacity: 0;\n    }\n    to {\n      opacity: 1;\n    }\n  }\n\n  .fade-enter {\n    opacity: 0;\n  }\n\n  .fade-enter-active {\n    opacity: 1;\n    transition: opacity 300ms ease-in;\n  }\n\n  .fade-exit {\n    opacity: 1;\n  }\n\n  .fade-exit-active {\n    opacity: 0;\n    transition: opacity 300ms ease-in;\n  }\n"])),(e=>e.theme.fonts.main),(e=>e.theme.colors.text),(e=>e.theme.colors.background)),on=an;var sn,cn=n(7950),un=n.t(cn,2);function ln(){return ln=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ln.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(sn||(sn={}));const fn="popstate";function dn(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function hn(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(IQ){}}}function pn(e,t){return{usr:e.state,key:e.key,idx:t}}function gn(e,t,n,r){return void 0===n&&(n=null),ln({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?vn(t):t,{state:n,key:t&&t.key||r||Math.random().toString(36).substr(2,8)})}function mn(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),r&&"#"!==r&&(t+="#"===r.charAt(0)?r:"#"+r),t}function vn(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function bn(e,t,n,r){void 0===r&&(r={});let{window:a=document.defaultView,v5Compat:i=!1}=r,o=a.history,s=sn.Pop,c=null,u=l();function l(){return(o.state||{idx:null}).idx}function f(){s=sn.Pop;let e=l(),t=null==e?null:e-u;u=e,c&&c({action:s,location:h.location,delta:t})}function d(e){let t="null"!==a.location.origin?a.location.origin:a.location.href,n="string"===typeof e?e:mn(e);return n=n.replace(/ $/,"%20"),dn(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}null==u&&(u=0,o.replaceState(ln({},o.state,{idx:u}),""));let h={get action(){return s},get location(){return e(a,o)},listen(e){if(c)throw new Error("A history only accepts one active listener");return a.addEventListener(fn,f),c=e,()=>{a.removeEventListener(fn,f),c=null}},createHref:e=>t(a,e),createURL:d,encodeLocation(e){let t=d(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){s=sn.Push;let r=gn(h.location,e,t);n&&n(r,e),u=l()+1;let f=pn(r,u),d=h.createHref(r);try{o.pushState(f,"",d)}catch(p){if(p instanceof DOMException&&"DataCloneError"===p.name)throw p;a.location.assign(d)}i&&c&&c({action:s,location:h.location,delta:1})},replace:function(e,t){s=sn.Replace;let r=gn(h.location,e,t);n&&n(r,e),u=l();let a=pn(r,u),f=h.createHref(r);o.replaceState(a,"",f),i&&c&&c({action:s,location:h.location,delta:0})},go:e=>o.go(e)};return h}var yn;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(yn||(yn={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function xn(e,t,n){return void 0===n&&(n="/"),wn(e,t,n,!1)}function wn(e,t,n,r){let a=On(("string"===typeof t?vn(t):t).pathname||"/",n);if(null==a)return null;let i=Sn(e);!function(e){e.sort(((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every(((e,n)=>e===t[n]));return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((e=>e.childrenIndex)),t.routesMeta.map((e=>e.childrenIndex)))))}(i);let o=null;for(let s=0;null==o&&s<i.length;++s){let e=Dn(a);o=An(i[s],e,r)}return o}function Sn(e,t,n,r){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===r&&(r="");let a=(e,a,i)=>{let o={relativePath:void 0===i?e.path||"":i,caseSensitive:!0===e.caseSensitive,childrenIndex:a,route:e};o.relativePath.startsWith("/")&&(dn(o.relativePath.startsWith(r),'Absolute route path "'+o.relativePath+'" nested under path "'+r+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),o.relativePath=o.relativePath.slice(r.length));let s=Bn([r,o.relativePath]),c=n.concat(o);e.children&&e.children.length>0&&(dn(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+s+'".'),Sn(e.children,t,c,s)),(null!=e.path||e.index)&&t.push({path:s,score:Ln(s,e.index),routesMeta:c})};return e.forEach(((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let r of Cn(e.path))a(e,t,r);else a(e,t)})),t}function Cn(e){let t=e.split("/");if(0===t.length)return[];let[n,...r]=t,a=n.endsWith("?"),i=n.replace(/\?$/,"");if(0===r.length)return a?[i,""]:[i];let o=Cn(r.join("/")),s=[];return s.push(...o.map((e=>""===e?i:[i,e].join("/")))),a&&s.push(...o),s.map((t=>e.startsWith("/")&&""===t?"/":t))}const Mn=/^:[\w-]+$/,_n=3,En=2,Tn=1,In=10,kn=-2,Nn=e=>"*"===e;function Ln(e,t){let n=e.split("/"),r=n.length;return n.some(Nn)&&(r+=kn),t&&(r+=En),n.filter((e=>!Nn(e))).reduce(((e,t)=>e+(Mn.test(t)?_n:""===t?Tn:In)),r)}function An(e,t,n){void 0===n&&(n=!1);let{routesMeta:r}=e,a={},i="/",o=[];for(let s=0;s<r.length;++s){let e=r[s],c=s===r.length-1,u="/"===i?t:t.slice(i.length)||"/",l=Rn({path:e.relativePath,caseSensitive:e.caseSensitive,end:c},u),f=e.route;if(!l&&c&&n&&!r[r.length-1].route.index&&(l=Rn({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},u)),!l)return null;Object.assign(a,l.params),o.push({params:a,pathname:Bn([i,l.pathname]),pathnameBase:Un(Bn([i,l.pathnameBase])),route:f}),"/"!==l.pathnameBase&&(i=Bn([i,l.pathnameBase]))}return o}function Rn(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);hn("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let r=[],a="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,((e,t,n)=>(r.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)")));e.endsWith("*")?(r.push({paramName:"*"}),a+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?a+="\\/*$":""!==e&&"/"!==e&&(a+="(?:(?=\\/|$))");let i=new RegExp(a,t?void 0:"i");return[i,r]}(e.path,e.caseSensitive,e.end),a=t.match(n);if(!a)return null;let i=a[0],o=i.replace(/(.)\/+$/,"$1"),s=a.slice(1),c=r.reduce(((e,t,n)=>{let{paramName:r,isOptional:a}=t;if("*"===r){let e=s[n]||"";o=i.slice(0,i.length-e.length).replace(/(.)\/+$/,"$1")}const c=s[n];return e[r]=a&&!c?void 0:(c||"").replace(/%2F/g,"/"),e}),{});return{params:c,pathname:i,pathnameBase:o,pattern:e}}function Dn(e){try{return e.split("/").map((e=>decodeURIComponent(e).replace(/\//g,"%2F"))).join("/")}catch(t){return hn(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function On(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?null:e.slice(n)||"/"}function Pn(e,t,n,r){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function Fn(e){return e.filter(((e,t)=>0===t||e.route.path&&e.route.path.length>0))}function zn(e,t){let n=Fn(e);return t?n.map(((e,t)=>t===n.length-1?e.pathname:e.pathnameBase)):n.map((e=>e.pathnameBase))}function jn(e,t,n,r){let a;void 0===r&&(r=!1),"string"===typeof e?a=vn(e):(a=ln({},e),dn(!a.pathname||!a.pathname.includes("?"),Pn("?","pathname","search",a)),dn(!a.pathname||!a.pathname.includes("#"),Pn("#","pathname","hash",a)),dn(!a.search||!a.search.includes("#"),Pn("#","search","hash",a)));let i,o=""===e||""===a.pathname,s=o?"/":a.pathname;if(null==s)i=n;else{let e=t.length-1;if(!r&&s.startsWith("..")){let t=s.split("/");for(;".."===t[0];)t.shift(),e-=1;a.pathname=t.join("/")}i=e>=0?t[e]:"/"}let c=function(e,t){void 0===t&&(t="/");let{pathname:n,search:r="",hash:a=""}="string"===typeof e?vn(e):e,i=n?n.startsWith("/")?n:function(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)})),n.length>1?n.join("/"):"/"}(n,t):t;return{pathname:i,search:Wn(r),hash:Gn(a)}}(a,i),u=s&&"/"!==s&&s.endsWith("/"),l=(o||"."===s)&&n.endsWith("/");return c.pathname.endsWith("/")||!u&&!l||(c.pathname+="/"),c}const Bn=e=>e.join("/").replace(/\/\/+/g,"/"),Un=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),Wn=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",Gn=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;function Vn(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const Hn=["post","put","patch","delete"],Yn=(new Set(Hn),["get",...Hn]);new Set(Yn),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function Xn(){return Xn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Xn.apply(this,arguments)}const qn=o.createContext(null);const Kn=o.createContext(null);const Qn=o.createContext(null);const Jn=o.createContext(null);const Zn=o.createContext({outlet:null,matches:[],isDataRoute:!1});const $n=o.createContext(null);function er(){return null!=o.useContext(Jn)}function tr(){return er()||dn(!1),o.useContext(Jn).location}function nr(e){o.useContext(Qn).static||o.useLayoutEffect(e)}function rr(){let{isDataRoute:e}=o.useContext(Zn);return e?function(){let{router:e}=hr(fr.UseNavigateStable),t=gr(dr.UseNavigateStable),n=o.useRef(!1);nr((()=>{n.current=!0}));let r=o.useCallback((function(r,a){void 0===a&&(a={}),n.current&&("number"===typeof r?e.navigate(r):e.navigate(r,Xn({fromRouteId:t},a)))}),[e,t]);return r}():function(){er()||dn(!1);let e=o.useContext(qn),{basename:t,future:n,navigator:r}=o.useContext(Qn),{matches:a}=o.useContext(Zn),{pathname:i}=tr(),s=JSON.stringify(zn(a,n.v7_relativeSplatPath)),c=o.useRef(!1);nr((()=>{c.current=!0}));let u=o.useCallback((function(n,a){if(void 0===a&&(a={}),!c.current)return;if("number"===typeof n)return void r.go(n);let o=jn(n,JSON.parse(s),i,"path"===a.relative);null==e&&"/"!==t&&(o.pathname="/"===o.pathname?t:Bn([t,o.pathname])),(a.replace?r.replace:r.push)(o,a.state,a)}),[t,r,s,i,e]);return u}()}function ar(e,t){let{relative:n}=void 0===t?{}:t,{future:r}=o.useContext(Qn),{matches:a}=o.useContext(Zn),{pathname:i}=tr(),s=JSON.stringify(zn(a,r.v7_relativeSplatPath));return o.useMemo((()=>jn(e,JSON.parse(s),i,"path"===n)),[e,s,i,n])}function ir(e,t,n,r){er()||dn(!1);let{navigator:a}=o.useContext(Qn),{matches:i}=o.useContext(Zn),s=i[i.length-1],c=s?s.params:{},u=(s&&s.pathname,s?s.pathnameBase:"/");s&&s.route;let l,f=tr();if(t){var d;let e="string"===typeof t?vn(t):t;"/"===u||(null==(d=e.pathname)?void 0:d.startsWith(u))||dn(!1),l=e}else l=f;let h=l.pathname||"/",p=h;if("/"!==u){let e=u.replace(/^\//,"").split("/");p="/"+h.replace(/^\//,"").split("/").slice(e.length).join("/")}let g=xn(e,{pathname:p});let m=lr(g&&g.map((e=>Object.assign({},e,{params:Object.assign({},c,e.params),pathname:Bn([u,a.encodeLocation?a.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?u:Bn([u,a.encodeLocation?a.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])}))),i,n,r);return t&&m?o.createElement(Jn.Provider,{value:{location:Xn({pathname:"/",search:"",hash:"",state:null,key:"default"},l),navigationType:sn.Pop}},m):m}function or(){let e=function(){var e;let t=o.useContext($n),n=pr(dr.UseRouteError),r=gr(dr.UseRouteError);if(void 0!==t)return t;return null==(e=n.errors)?void 0:e[r]}(),t=Vn(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,r="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:r};return o.createElement(o.Fragment,null,o.createElement("h2",null,"Unexpected Application Error!"),o.createElement("h3",{style:{fontStyle:"italic"}},t),n?o.createElement("pre",{style:a},n):null,null)}const sr=o.createElement(or,null);class cr extends o.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?o.createElement(Zn.Provider,{value:this.props.routeContext},o.createElement($n.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function ur(e){let{routeContext:t,match:n,children:r}=e,a=o.useContext(qn);return a&&a.static&&a.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=n.route.id),o.createElement(Zn.Provider,{value:t},r)}function lr(e,t,n,r){var a;if(void 0===t&&(t=[]),void 0===n&&(n=null),void 0===r&&(r=null),null==e){var i;if(!n)return null;if(n.errors)e=n.matches;else{if(!(null!=(i=r)&&i.v7_partialHydration&&0===t.length&&!n.initialized&&n.matches.length>0))return null;e=n.matches}}let s=e,c=null==(a=n)?void 0:a.errors;if(null!=c){let e=s.findIndex((e=>e.route.id&&void 0!==(null==c?void 0:c[e.route.id])));e>=0||dn(!1),s=s.slice(0,Math.min(s.length,e+1))}let u=!1,l=-1;if(n&&r&&r.v7_partialHydration)for(let o=0;o<s.length;o++){let e=s[o];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(l=o),e.route.id){let{loaderData:t,errors:r}=n,a=e.route.loader&&void 0===t[e.route.id]&&(!r||void 0===r[e.route.id]);if(e.route.lazy||a){u=!0,s=l>=0?s.slice(0,l+1):[s[0]];break}}}return s.reduceRight(((e,r,a)=>{let i,f=!1,d=null,h=null;var p;n&&(i=c&&r.route.id?c[r.route.id]:void 0,d=r.route.errorElement||sr,u&&(l<0&&0===a?(p="route-fallback",!1||mr[p]||(mr[p]=!0),f=!0,h=null):l===a&&(f=!0,h=r.route.hydrateFallbackElement||null)));let g=t.concat(s.slice(0,a+1)),m=()=>{let t;return t=i?d:f?h:r.route.Component?o.createElement(r.route.Component,null):r.route.element?r.route.element:e,o.createElement(ur,{match:r,routeContext:{outlet:e,matches:g,isDataRoute:null!=n},children:t})};return n&&(r.route.ErrorBoundary||r.route.errorElement||0===a)?o.createElement(cr,{location:n.location,revalidation:n.revalidation,component:d,error:i,children:m(),routeContext:{outlet:null,matches:g,isDataRoute:!0}}):m()}),null)}var fr=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(fr||{}),dr=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(dr||{});function hr(e){let t=o.useContext(qn);return t||dn(!1),t}function pr(e){let t=o.useContext(Kn);return t||dn(!1),t}function gr(e){let t=function(){let e=o.useContext(Zn);return e||dn(!1),e}(),n=t.matches[t.matches.length-1];return n.route.id||dn(!1),n.route.id}const mr={};const vr={};const br=(e,t,n)=>{var r;vr[r="\u26a0\ufe0f React Router Future Flag Warning: "+t+". You can use the `"+e+"` future flag to opt-in early. For more information, see "+n+"."]||(vr[r]=!0,console.warn(r))};function yr(e,t){void 0===(null==e?void 0:e.v7_startTransition)&&br("v7_startTransition","React Router will begin wrapping state updates in `React.startTransition` in v7","https://reactrouter.com/v6/upgrading/future#v7_starttransition"),void 0!==(null==e?void 0:e.v7_relativeSplatPath)||t&&t.v7_relativeSplatPath||br("v7_relativeSplatPath","Relative route resolution within Splat routes is changing in v7","https://reactrouter.com/v6/upgrading/future#v7_relativesplatpath"),t&&(void 0===t.v7_fetcherPersist&&br("v7_fetcherPersist","The persistence behavior of fetchers is changing in v7","https://reactrouter.com/v6/upgrading/future#v7_fetcherpersist"),void 0===t.v7_normalizeFormMethod&&br("v7_normalizeFormMethod","Casing of `formMethod` fields is being normalized to uppercase in v7","https://reactrouter.com/v6/upgrading/future#v7_normalizeformmethod"),void 0===t.v7_partialHydration&&br("v7_partialHydration","`RouterProvider` hydration behavior is changing in v7","https://reactrouter.com/v6/upgrading/future#v7_partialhydration"),void 0===t.v7_skipActionErrorRevalidation&&br("v7_skipActionErrorRevalidation","The revalidation behavior after 4xx/5xx `action` responses is changing in v7","https://reactrouter.com/v6/upgrading/future#v7_skipactionerrorrevalidation"))}s.startTransition;function xr(e){dn(!1)}function wr(e){let{basename:t="/",children:n=null,location:r,navigationType:a=sn.Pop,navigator:i,static:s=!1,future:c}=e;er()&&dn(!1);let u=t.replace(/^\/*/,"/"),l=o.useMemo((()=>({basename:u,navigator:i,static:s,future:Xn({v7_relativeSplatPath:!1},c)})),[u,c,i,s]);"string"===typeof r&&(r=vn(r));let{pathname:f="/",search:d="",hash:h="",state:p=null,key:g="default"}=r,m=o.useMemo((()=>{let e=On(f,u);return null==e?null:{location:{pathname:e,search:d,hash:h,state:p,key:g},navigationType:a}}),[u,f,d,h,p,g,a]);return null==m?null:o.createElement(Qn.Provider,{value:l},o.createElement(Jn.Provider,{children:n,value:m}))}function Sr(e){let{children:t,location:n}=e;return ir(Cr(t),n)}new Promise((()=>{}));o.Component;function Cr(e,t){void 0===t&&(t=[]);let n=[];return o.Children.forEach(e,((e,r)=>{if(!o.isValidElement(e))return;let a=[...t,r];if(e.type===o.Fragment)return void n.push.apply(n,Cr(e.props.children,a));e.type!==xr&&dn(!1),e.props.index&&e.props.children&&dn(!1);let i={id:e.props.id||a.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(i.children=Cr(e.props.children,a)),n.push(i)})),n}function Mr(){return Mr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Mr.apply(this,arguments)}function _r(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const Er=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"];try{window.__reactRouterVersion="6"}catch(IQ){}new Map;const Tr=s.startTransition;un.flushSync,s.useId;function Ir(e){let{basename:t,children:n,future:r,window:a}=e,i=o.useRef();var s;null==i.current&&(i.current=(void 0===(s={window:a,v5Compat:!0})&&(s={}),bn((function(e,t){let{pathname:n,search:r,hash:a}=e.location;return gn("",{pathname:n,search:r,hash:a},t.state&&t.state.usr||null,t.state&&t.state.key||"default")}),(function(e,t){return"string"===typeof t?t:mn(t)}),null,s)));let c=i.current,[u,l]=o.useState({action:c.action,location:c.location}),{v7_startTransition:f}=r||{},d=o.useCallback((e=>{f&&Tr?Tr((()=>l(e))):l(e)}),[l,f]);return o.useLayoutEffect((()=>c.listen(d)),[c,d]),o.useEffect((()=>yr(r)),[r]),o.createElement(wr,{basename:t,children:n,location:u.location,navigationType:u.action,navigator:c,future:r})}const kr="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,Nr=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Lr=o.forwardRef((function(e,t){let n,{onClick:r,relative:a,reloadDocument:i,replace:s,state:c,target:u,to:l,preventScrollReset:f,viewTransition:d}=e,h=_r(e,Er),{basename:p}=o.useContext(Qn),g=!1;if("string"===typeof l&&Nr.test(l)&&(n=l,kr))try{let e=new URL(window.location.href),t=l.startsWith("//")?new URL(e.protocol+l):new URL(l),n=On(t.pathname,p);t.origin===e.origin&&null!=n?l=n+t.search+t.hash:g=!0}catch(IQ){}let m=function(e,t){let{relative:n}=void 0===t?{}:t;er()||dn(!1);let{basename:r,navigator:a}=o.useContext(Qn),{hash:i,pathname:s,search:c}=ar(e,{relative:n}),u=s;return"/"!==r&&(u="/"===s?r:Bn([r,s])),a.createHref({pathname:u,search:c,hash:i})}(l,{relative:a}),v=function(e,t){let{target:n,replace:r,state:a,preventScrollReset:i,relative:s,viewTransition:c}=void 0===t?{}:t,u=rr(),l=tr(),f=ar(e,{relative:s});return o.useCallback((t=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(t,n)){t.preventDefault();let n=void 0!==r?r:mn(l)===mn(f);u(e,{replace:n,state:a,preventScrollReset:i,relative:s,viewTransition:c})}}),[l,u,f,r,a,n,e,i,s,c])}(l,{replace:s,state:c,target:u,preventScrollReset:f,relative:a,viewTransition:d});return o.createElement("a",Mr({},h,{href:n||m,onClick:g||i?r:function(e){r&&r(e),e.defaultPrevented||v(e)},ref:t,target:u}))}));var Ar,Rr;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Ar||(Ar={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(Rr||(Rr={}));var Dr={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Or=o.createContext&&o.createContext(Dr),Pr=function(){return Pr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},Pr.apply(this,arguments)},Fr=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n};function zr(e){return e&&e.map((function(e,t){return o.createElement(e.tag,Pr({key:t},e.attr),zr(e.child))}))}function jr(e){return function(t){return o.createElement(Br,Pr({attr:Pr({},e.attr)},t),zr(e.child))}}function Br(e){var t=function(t){var n,r=e.attr,a=e.size,i=e.title,s=Fr(e,["attr","size","title"]),c=a||t.size||"1em";return t.className&&(n=t.className),e.className&&(n=(n?n+" ":"")+e.className),o.createElement("svg",Pr({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,r,s,{className:n,style:Pr(Pr({color:e.color||t.color},t.style),e.style),height:c,width:c,xmlns:"http://www.w3.org/2000/svg"}),i&&o.createElement("title",null,i),e.children)};return void 0!==Or?o.createElement(Or.Consumer,null,(function(e){return t(e)})):t(Dr)}function Ur(e){return jr({tag:"svg",attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.8 169.9l-40.7 191.8c-3 13.6-11.1 16.9-22.4 10.5l-62-45.7-29.9 28.8c-3.3 3.3-6.1 6.1-12.5 6.1l4.4-63.1 114.9-103.8c5-4.4-1.1-6.9-7.7-2.5l-142 89.4-61.2-19.1c-13.3-4.2-13.6-13.3 2.8-19.7l239.1-92.2c11.1-4 20.8 2.7 17.2 19.5z"}}]})(e)}function Wr(e){return jr({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.034 8 8 119.033 8 256s111.034 248 248 248 248-111.034 248-248S392.967 8 256 8zm130.108 117.892c65.448 65.448 70 165.481 20.677 235.637L150.47 105.216c70.204-49.356 170.226-44.735 235.638 20.676zM125.892 386.108c-65.448-65.448-70-165.481-20.677-235.637L361.53 406.784c-70.203 49.356-170.226 44.736-235.638-20.676z"}}]})(e)}function Gr(e){return jr({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M416 192c0-88.4-93.1-160-208-160S0 103.6 0 192c0 34.3 14.1 65.9 38 92-13.4 30.2-35.5 54.2-35.8 54.5-2.2 2.3-2.8 5.7-1.5 8.7S4.8 352 8 352c36.6 0 66.9-12.3 88.7-25 32.2 15.7 70.3 25 111.3 25 114.9 0 208-71.6 208-160zm122 220c23.9-26 38-57.7 38-92 0-66.9-53.5-124.2-129.3-148.1.9 6.6 1.3 13.3 1.3 20.1 0 105.9-107.7 192-240 192-10.8 0-21.3-.8-31.7-1.9C207.8 439.6 281.8 480 368 480c41 0 79.1-9.2 111.3-25 21.8 12.7 52.1 25 88.7 25 3.2 0 6.1-1.9 7.3-4.8 1.3-2.9.7-6.3-1.5-8.7-.3-.3-22.4-24.2-35.8-54.5z"}}]})(e)}function Vr(e){return jr({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M384 352c-.35 0-.67.1-1.02.1l-39.2-65.32c5.07-9.17 8.22-19.56 8.22-30.78s-3.14-21.61-8.22-30.78l39.2-65.32c.35.01.67.1 1.02.1 35.35 0 64-28.65 64-64s-28.65-64-64-64c-23.63 0-44.04 12.95-55.12 32H119.12C108.04 44.95 87.63 32 64 32 28.65 32 0 60.65 0 96c0 23.63 12.95 44.04 32 55.12v209.75C12.95 371.96 0 392.37 0 416c0 35.35 28.65 64 64 64 23.63 0 44.04-12.95 55.12-32h209.75c11.09 19.05 31.49 32 55.12 32 35.35 0 64-28.65 64-64 .01-35.35-28.64-64-63.99-64zm-288 8.88V151.12A63.825 63.825 0 0 0 119.12 128h208.36l-38.46 64.1c-.35-.01-.67-.1-1.02-.1-35.35 0-64 28.65-64 64s28.65 64 64 64c.35 0 .67-.1 1.02-.1l38.46 64.1H119.12A63.748 63.748 0 0 0 96 360.88zM272 256c0-8.82 7.18-16 16-16s16 7.18 16 16-7.18 16-16 16-16-7.18-16-16zM400 96c0 8.82-7.18 16-16 16s-16-7.18-16-16 7.18-16 16-16 16 7.18 16 16zM64 80c8.82 0 16 7.18 16 16s-7.18 16-16 16-16-7.18-16-16 7.18-16 16-16zM48 416c0-8.82 7.18-16 16-16s16 7.18 16 16-7.18 16-16 16-16-7.18-16-16zm336 16c-8.82 0-16-7.18-16-16s7.18-16 16-16 16 7.18 16 16-7.18 16-16 16z"}}]})(e)}function Hr(e){return jr({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M480.07 96H160a160 160 0 1 0 114.24 272h91.52A160 160 0 1 0 480.07 96zM248 268a12 12 0 0 1-12 12h-52v52a12 12 0 0 1-12 12h-24a12 12 0 0 1-12-12v-52H84a12 12 0 0 1-12-12v-24a12 12 0 0 1 12-12h52v-52a12 12 0 0 1 12-12h24a12 12 0 0 1 12 12v52h52a12 12 0 0 1 12 12zm216 76a40 40 0 1 1 40-40 40 40 0 0 1-40 40zm64-96a40 40 0 1 1 40-40 40 40 0 0 1-40 40z"}}]})(e)}function Yr(e){return jr({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M32 448c0 17.7 14.3 32 32 32h160V320H32v128zm256 32h160c17.7 0 32-14.3 32-32V320H288v160zm192-320h-42.1c6.2-12.1 10.1-25.5 10.1-40 0-48.5-39.5-88-88-88-41.6 0-68.5 21.3-103 68.3-34.5-47-61.4-68.3-103-68.3-48.5 0-88 39.5-88 88 0 14.5 3.8 27.9 10.1 40H32c-17.7 0-32 14.3-32 32v80c0 8.8 7.2 16 16 16h480c8.8 0 16-7.2 16-16v-80c0-17.7-14.3-32-32-32zm-326.1 0c-22.1 0-40-17.9-40-40s17.9-40 40-40c19.9 0 34.6 3.3 86.1 80h-86.1zm206.1 0h-86.1c51.4-76.5 65.7-80 86.1-80 22.1 0 40 17.9 40 40s-17.9 40-40 40z"}}]})(e)}function Xr(e){return jr({tag:"svg",attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"}}]})(e)}function qr(e){return jr({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M408.781 128.007C386.356 127.578 368 146.36 368 168.79V256h-8V79.79c0-22.43-18.356-41.212-40.781-40.783C297.488 39.423 280 57.169 280 79v177h-8V40.79C272 18.36 253.644-.422 231.219.007 209.488.423 192 18.169 192 40v216h-8V80.79c0-22.43-18.356-41.212-40.781-40.783C121.488 40.423 104 58.169 104 80v235.992l-31.648-43.519c-12.993-17.866-38.009-21.817-55.877-8.823-17.865 12.994-21.815 38.01-8.822 55.877l125.601 172.705A48 48 0 0 0 172.073 512h197.59c22.274 0 41.622-15.324 46.724-37.006l26.508-112.66a192.011 192.011 0 0 0 5.104-43.975V168c.001-21.831-17.487-39.577-39.218-39.993z"}}]})(e)}function Kr(e){return jr({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"}}]})(e)}function Qr(e){return jr({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M223.75 130.75L154.62 15.54A31.997 31.997 0 0 0 127.18 0H16.03C3.08 0-4.5 14.57 2.92 25.18l111.27 158.96c29.72-27.77 67.52-46.83 109.56-53.39zM495.97 0H384.82c-11.24 0-21.66 5.9-27.44 15.54l-69.13 115.21c42.04 6.56 79.84 25.62 109.56 53.38L509.08 25.18C516.5 14.57 508.92 0 495.97 0zM256 160c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm92.52 157.26l-37.93 36.96 8.97 52.22c1.6 9.36-8.26 16.51-16.65 12.09L256 393.88l-46.9 24.65c-8.4 4.45-18.25-2.74-16.65-12.09l8.97-52.22-37.93-36.96c-6.82-6.64-3.05-18.23 6.35-19.59l52.43-7.64 23.43-47.52c2.11-4.28 6.19-6.39 10.28-6.39 4.11 0 8.22 2.14 10.33 6.39l23.43 47.52 52.43 7.64c9.4 1.36 13.17 12.95 6.35 19.59z"}}]})(e)}function Jr(e){return jr({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M283.211 512c78.962 0 151.079-35.925 198.857-94.792 7.068-8.708-.639-21.43-11.562-19.35-124.203 23.654-238.262-71.576-238.262-196.954 0-72.222 38.662-138.635 101.498-174.394 9.686-5.512 7.25-20.197-3.756-22.23A258.156 258.156 0 0 0 283.211 0c-141.309 0-256 114.511-256 256 0 141.309 114.511 256 256 256z"}}]})(e)}function Zr(e){return jr({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M505.12019,19.09375c-1.18945-5.53125-6.65819-11-12.207-12.1875C460.716,0,435.507,0,410.40747,0,307.17523,0,245.26909,55.20312,199.05238,128H94.83772c-16.34763.01562-35.55658,11.875-42.88664,26.48438L2.51562,253.29688A28.4,28.4,0,0,0,0,264a24.00867,24.00867,0,0,0,24.00582,24H127.81618l-22.47457,22.46875c-11.36521,11.36133-12.99607,32.25781,0,45.25L156.24582,406.625c11.15623,11.1875,32.15619,13.15625,45.27726,0l22.47457-22.46875V488a24.00867,24.00867,0,0,0,24.00581,24,28.55934,28.55934,0,0,0,10.707-2.51562l98.72834-49.39063c14.62888-7.29687,26.50776-26.5,26.50776-42.85937V312.79688c72.59753-46.3125,128.03493-108.40626,128.03493-211.09376C512.07526,76.5,512.07526,51.29688,505.12019,19.09375ZM384.04033,168A40,40,0,1,1,424.05,128,40.02322,40.02322,0,0,1,384.04033,168Z"}}]})(e)}function $r(e){return jr({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"}}]})(e)}function ea(e){return jr({tag:"svg",attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm80 168c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32zm-160 0c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32zm194.8 170.2C334.3 380.4 292.5 400 248 400s-86.3-19.6-114.8-53.8c-13.6-16.3 11-36.7 24.6-20.5 22.4 26.9 55.2 42.2 90.2 42.2s67.8-15.4 90.2-42.2c13.4-16.2 38.1 4.2 24.6 20.5z"}}]})(e)}function ta(e){return jr({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}}]})(e)}function na(e){return jr({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 160c-52.9 0-96 43.1-96 96s43.1 96 96 96 96-43.1 96-96-43.1-96-96-96zm246.4 80.5l-94.7-47.3 33.5-100.4c4.5-13.6-8.4-26.5-21.9-21.9l-100.4 33.5-47.4-94.8c-6.4-12.8-24.6-12.8-31 0l-47.3 94.7L92.7 70.8c-13.6-4.5-26.5 8.4-21.9 21.9l33.5 100.4-94.7 47.4c-12.8 6.4-12.8 24.6 0 31l94.7 47.3-33.5 100.5c-4.5 13.6 8.4 26.5 21.9 21.9l100.4-33.5 47.3 94.7c6.4 12.8 24.6 12.8 31 0l47.3-94.7 100.4 33.5c13.6 4.5 26.5-8.4 21.9-21.9l-33.5-100.4 94.7-47.3c13-6.5 13-24.7.2-31.1zm-155.9 106c-49.9 49.9-131.1 49.9-181 0-49.9-49.9-49.9-131.1 0-181 49.9-49.9 131.1-49.9 181 0 49.9 49.9 49.9 131.1 0 181z"}}]})(e)}function ra(e){return jr({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M64 224h13.5c24.7 56.5 80.9 96 146.5 96s121.8-39.5 146.5-96H384c8.8 0 16-7.2 16-16v-96c0-8.8-7.2-16-16-16h-13.5C345.8 39.5 289.6 0 224 0S102.2 39.5 77.5 96H64c-8.8 0-16 7.2-16 16v96c0 8.8 7.2 16 16 16zm40-88c0-22.1 21.5-40 48-40h144c26.5 0 48 17.9 48 40v24c0 53-43 96-96 96h-48c-53 0-96-43-96-96v-24zm72 72l12-36 36-12-36-12-12-36-12 36-36 12 36 12 12 36zm151.6 113.4C297.7 340.7 262.2 352 224 352s-73.7-11.3-103.6-30.6C52.9 328.5 0 385 0 454.4v9.6c0 26.5 21.5 48 48 48h80v-64c0-17.7 14.3-32 32-32h128c17.7 0 32 14.3 32 32v64h80c26.5 0 48-21.5 48-48v-9.6c0-69.4-52.9-125.9-120.4-133zM272 448c-8.8 0-16 7.2-16 16s7.2 16 16 16 16-7.2 16-16-7.2-16-16-16zm-96 0c-8.8 0-16 7.2-16 16v48h32v-48c0-8.8-7.2-16-16-16z"}}]})(e)}function aa(e){return jr({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"}}]})(e)}function ia(e){return jr({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M336.2 64H47.8C21.4 64 0 85.4 0 111.8v288.4C0 426.6 21.4 448 47.8 448h288.4c26.4 0 47.8-21.4 47.8-47.8V111.8c0-26.4-21.4-47.8-47.8-47.8zm189.4 37.7L416 177.3v157.4l109.6 75.5c21.2 14.6 50.4-.3 50.4-25.8V127.5c0-25.4-29.1-40.4-50.4-25.8z"}}]})(e)}var oa,sa,ca,ua,la,fa,da,ha,pa,ga=n(579);const ma=tn(oa||(oa=nn(["\n  0% { transform: rotate(0deg); }\n  100% { transform: rotate(360deg); }\n"]))),va=tn(sa||(sa=nn(["\n  0% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }\n  50% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5), 0 0 30px rgba(255, 69, 0, 0.3); }\n  100% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }\n"]))),ba=$t.div(ca||(ca=nn(["\n  display: flex;\n  gap: 15px;\n  background: rgba(0, 0, 0, 0.4);\n  padding: 8px 15px;\n  border-radius: 30px;\n  border: 1px solid rgba(255, 255, 255, 0.2);\n  backdrop-filter: blur(5px);\n  transition: all 0.3s ease;\n\n  &:hover {\n    background: rgba(0, 0, 0, 0.5);\n    border-color: rgba(255, 255, 255, 0.3);\n  }\n"]))),ya=$t.button(ua||(ua=nn(["\n  background: ",";\n  border: none;\n  width: 40px;\n  height: 40px;\n  border-radius: 20px;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  position: relative;\n  transition: all 0.3s ease;\n  \n  ","\n\n  svg {\n    color: ",";\n    font-size: 20px;\n    transition: all 0.3s ease;\n    ","\n  }\n\n  &:hover {\n    background: rgba(255, 255, 255, 0.15);\n    transform: translateY(-2px);\n\n    svg {\n      color: #FFD700;\n      transform: scale(1.2);\n    }\n  }\n\n  &::before {\n    content: '';\n    position: absolute;\n    top: -2px;\n    left: -2px;\n    right: -2px;\n    bottom: -2px;\n    border-radius: 22px;\n    background: linear-gradient(45deg, #FFD700, #FFA500);\n    opacity: 0;\n    transition: opacity 0.3s ease;\n    z-index: -1;\n  }\n\n  ","\n"])),(e=>e.active?"rgba(255, 255, 255, 0.1)":"transparent"),(e=>e.active&&Qt(la||(la=nn(["\n    animation: "," 2s infinite;\n  "])),va)),(e=>e.active?"#FFD700":"rgba(255, 255, 255, 0.6)"),(e=>e.active&&Qt(fa||(fa=nn(["\n      animation: "," 10s linear infinite;\n    "])),ma)),(e=>e.active&&Qt(da||(da=nn(["\n    &::before {\n      opacity: 0.3;\n    }\n  "]))))),xa=$t.div(ha||(ha=nn(["\n  position: absolute;\n  bottom: 100%;\n  left: 50%;\n  transform: translateX(-50%);\n  background: rgba(0, 0, 0, 0.8);\n  color: white;\n  padding: 5px 10px;\n  border-radius: 5px;\n  font-size: 12px;\n  white-space: nowrap;\n  opacity: 0;\n  visibility: hidden;\n  transition: all 0.3s ease;\n  margin-bottom: 5px;\n\n  &::after {\n    content: '';\n    position: absolute;\n    top: 100%;\n    left: 50%;\n    transform: translateX(-50%);\n    border-width: 5px;\n    border-style: solid;\n    border-color: rgba(0, 0, 0, 0.8) transparent transparent transparent;\n  }\n"]))),wa=$t.div(pa||(pa=nn(["\n  position: relative;\n\n  &:hover "," {\n    opacity: 1;\n    visibility: visible;\n    transform: translateX(-50%) translateY(-5px);\n  }\n"])),xa),Sa=e=>{let{currentTheme:t,onThemeChange:n}=e;return(0,ga.jsxs)(ba,{children:[(0,ga.jsxs)(wa,{children:[(0,ga.jsx)(ya,{onClick:()=>n("day"),active:"day"===t,children:(0,ga.jsx)(na,{})}),(0,ga.jsx)(xa,{children:"\u0414\u0435\u043d\u044c"})]}),(0,ga.jsxs)(wa,{children:[(0,ga.jsx)(ya,{onClick:()=>n("night"),active:"night"===t,children:(0,ga.jsx)(Jr,{})}),(0,ga.jsx)(xa,{children:"\u041d\u043e\u0447\u044c"})]})]})};var Ca,Ma,_a,Ea,Ta,Ia,ka,Na,La;const Aa=tn(Ca||(Ca=nn(["\n  0% { box-shadow: 0 0 20px rgba(255, 255, 255, 0.1); }\n  50% { box-shadow: 0 0 30px rgba(255, 255, 255, 0.2); }\n  100% { box-shadow: 0 0 20px rgba(255, 255, 255, 0.1); }\n"]))),Ra=tn(Ma||(Ma=nn(["\n  0% { transform: translateY(0) rotate(0deg); }\n  50% { transform: translateY(-5px) rotate(180deg); }\n  100% { transform: translateY(0) rotate(360deg); }\n"]))),Da=tn(_a||(_a=nn(["\n  0% { text-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }\n  50% { text-shadow: 0 0 20px rgba(255, 215, 0, 0.8), 0 0 30px rgba(255, 69, 0, 0.4); }\n  100% { text-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }\n"]))),Oa=$t.header(Ea||(Ea=nn(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 70px;\n  background: rgba(0, 0, 0, 0.4);\n  backdrop-filter: blur(15px);\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0 30px;\n  z-index: 1000;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n  animation: "," 4s ease-in-out infinite;\n\n  &::before {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: linear-gradient(90deg, \n      rgba(255, 255, 255, 0) 0%,\n      rgba(255, 255, 255, 0.05) 50%,\n      rgba(255, 255, 255, 0) 100%);\n    animation: shimmer 3s infinite linear;\n    pointer-events: none;\n  }\n\n  @keyframes shimmer {\n    0% { transform: translateX(-100%); }\n    100% { transform: translateX(100%); }\n  }\n"])),Aa),Pa=$t(Lr)(Ta||(Ta=nn(["\n  font-size: 28px;\n  font-weight: bold;\n  color: #fff;\n  text-decoration: none;\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  position: relative;\n  padding: 5px 15px;\n  border-radius: 20px;\n  transition: all 0.3s ease;\n\n  span {\n    background: linear-gradient(to right, #FFD700, #FFA500, #FF4500);\n    -webkit-background-clip: text;\n    -webkit-text-fill-color: transparent;\n    animation: "," 3s ease-in-out infinite;\n  }\n\n  &::before {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    border-radius: 20px;\n    background: linear-gradient(45deg, \n      rgba(255, 215, 0, 0.1),\n      rgba(255, 69, 0, 0.1));\n    opacity: 0;\n    transition: all 0.3s ease;\n  }\n\n  &:hover {\n    transform: scale(1.05);\n    \n    &::before {\n      opacity: 1;\n    }\n  }\n\n  svg {\n    font-size: 24px;\n    color: #FFD700;\n    animation: "," 3s ease-in-out infinite;\n  }\n"])),Da,Ra),Fa=$t.nav(Ia||(Ia=nn(["\n  display: flex;\n  align-items: center;\n  gap: 25px;\n"]))),za=$t(Lr)(ka||(ka=nn(["\n  color: #fff;\n  text-decoration: none;\n  padding: 8px 20px;\n  border-radius: 20px;\n  position: relative;\n  overflow: hidden;\n  transition: all 0.3s ease;\n  font-weight: 500;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n\n  &::before {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: linear-gradient(45deg,\n      rgba(255, 255, 255, 0.1),\n      rgba(255, 255, 255, 0.05));\n    transform: translateY(100%);\n    transition: transform 0.3s ease;\n  }\n\n  &::after {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: linear-gradient(45deg,\n      rgba(255, 69, 0, 0.2),\n      rgba(255, 215, 0, 0.2));\n    opacity: 0;\n    transition: opacity 0.3s ease;\n  }\n\n  svg {\n    font-size: 18px;\n    color: #FFD700;\n    transition: all 0.3s ease;\n  }\n\n  &:hover {\n    color: #FFD700;\n    transform: translateY(-2px);\n\n    &::before {\n      transform: translateY(0);\n    }\n\n    &::after {\n      opacity: 1;\n    }\n\n    svg {\n      transform: scale(1.2) rotate(15deg);\n      color: #FFA500;\n    }\n  }\n"]))),ja=$t.div(Na||(Na=nn(["\n  background: rgba(0, 0, 0, 0.3);\n  padding: 8px 16px;\n  border-radius: 20px;\n  font-size: 14px;\n  color: #fff;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  transition: all 0.3s ease;\n\n  &:hover {\n    transform: translateY(-2px);\n    border-color: rgba(255, 215, 0, 0.3);\n    box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);\n  }\n\n  svg {\n    color: #32CD32;\n    animation: pulse 2s ease-in-out infinite;\n  }\n\n  @keyframes pulse {\n    0% { transform: scale(1); }\n    50% { transform: scale(1.2); }\n    100% { transform: scale(1); }\n  }\n"]))),Ba=$t.div(La||(La=nn(["\n  margin-left: 15px;\n  position: relative;\n\n  &::before {\n    content: '';\n    position: absolute;\n    top: 50%;\n    left: -15px;\n    width: 1px;\n    height: 20px;\n    background: rgba(255, 255, 255, 0.1);\n    transform: translateY(-50%);\n  }\n"]))),Ua=e=>{let{currentTheme:t,onThemeChange:n,onlineUsers:r}=e;return(0,ga.jsxs)(Oa,{children:[(0,ga.jsxs)(Pa,{to:"/",children:[(0,ga.jsx)(ta,{}),(0,ga.jsx)("span",{children:"Ruletka"})]}),(0,ga.jsxs)(Fa,{children:[(0,ga.jsxs)(ja,{children:[(0,ga.jsx)(aa,{}),r," \u043e\u043d\u043b\u0430\u0439\u043d"]}),(0,ga.jsxs)(za,{to:"/chat",children:[(0,ga.jsx)(Zr,{}),"\u041d\u0430\u0447\u0430\u0442\u044c \u0447\u0430\u0442"]}),(0,ga.jsx)(Ba,{children:(0,ga.jsx)(Sa,{currentTheme:t,onThemeChange:n})})]})]})};function Wa(e){return Wa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Wa(e)}function Ga(e){var t=function(e,t){if("object"!=Wa(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Wa(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Wa(t)?t:t+""}function Va(e,t,n){return(t=Ga(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ha(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ya(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ha(Object(n),!0).forEach((function(t){Va(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ha(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const Xa={day:{background:"linear-gradient(to bottom, #0288d1, #29b6f6, #81d4fa, #b3e5fc)",stars:{count:50,color:"#ffd700",size:{min:2,max:4},twinkleSpeed:{min:3,max:5}},planets:[{size:180,color:"radial-gradient(circle at 30% 30%, #ffd700, #ffa000)",orbitRadius:300,orbitSpeed:35,glowColor:"rgba(255, 215, 0, 0.4)",rings:!0,ringsColor:"rgba(255, 215, 0, 0.2)",satellites:[{size:25,orbitRadius:200,orbitSpeed:8,color:"#ffd740"}]},{size:120,color:"radial-gradient(circle at 40% 40%, #64ffda, #00bfa5)",orbitRadius:500,orbitSpeed:30,glowColor:"rgba(0, 191, 165, 0.3)"}],comets:{count:3,tailLength:150,color:"#40c4ff",speed:{min:14,max:14}},ufos:{count:3,emoji:"\ud83d\udef8",size:30,speed:{min:.15,max:.3}},nebulas:[{size:400,color:"rgba(0, 191, 165, 0.1)",position:{x:"20%",y:"30%"}},{size:350,color:"rgba(255, 64, 129, 0.08)",position:{x:"70%",y:"60%"}}],shootingStars:{count:2,tailLength:150,color:"#ffd700",speed:{min:14,max:14}}},night:{background:"linear-gradient(to bottom, #000000, #1a237e, #311b92, #4a148c)",stars:{count:150,color:"#ffffff",size:{min:2,max:4},twinkleSpeed:{min:3,max:5}},planets:[{size:150,color:"radial-gradient(circle at 35% 35%, #9575cd, #7e57c2)",orbitRadius:350,orbitSpeed:40,rings:!0,ringsColor:"rgba(126, 87, 194, 0.3)",glowColor:"rgba(126, 87, 194, 0.4)",satellites:[{size:35,orbitRadius:190,orbitSpeed:8,color:"#b39ddb"}]},{size:110,color:"radial-gradient(circle at 40% 40%, #90caf9, #42a5f5)",orbitRadius:550,orbitSpeed:32,glowColor:"rgba(25, 118, 210, 0.4)"}],comets:{count:6,tailLength:180,color:"#18ffff",speed:{min:14,max:14}},nebulas:[{size:500,color:"rgba(103, 58, 183, 0.1)",position:{x:"30%",y:"40%"}},{size:450,color:"rgba(3, 169, 244, 0.08)",position:{x:"80%",y:"20%"}}],shootingStars:{count:4,tailLength:180,color:"#ffffff",speed:{min:14,max:14}},ufos:{count:3,emoji:"\ud83d\udef8",size:35,speed:{min:.15,max:.3}}}};var qa,Ka,Qa,Ja,Za,$a,ei,ti,ni;const ri=$t.div(qa||(qa=nn(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: ",";\n  transition: background 1s ease;\n  overflow: hidden;\n  z-index: -1;\n"])),(e=>e.theme.background)),ai=$t.div(Ka||(Ka=nn(["\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  overflow: hidden;\n"]))),ii=($t.div(Qa||(Qa=nn(["\n  position: absolute;\n  width: ","px;\n  height: ","px;\n  background: ",";\n  border-radius: 50%;\n  animation: starTwinkle ","s ease-in-out infinite;\n  box-shadow: 0 0 ","px ",",\n              0 0 ","px ",",\n              0 0 ","px ",";\n  will-change: transform, opacity, filter;\n  transform: translateZ(0);\n\n  @keyframes starTwinkle {\n    0% { \n      opacity: 0.3;\n      transform: scale(0.9);\n      filter: brightness(0.8);\n    }\n    50% { \n      opacity: 1;\n      transform: scale(1.1);\n      filter: brightness(1.3);\n    }\n    100% { \n      opacity: 0.3;\n      transform: scale(0.9);\n      filter: brightness(0.8);\n    }\n  }\n"])),(e=>e.size),(e=>e.size),(e=>e.color),(e=>e.twinkleSpeed),(e=>2*e.size),(e=>e.color),(e=>4*e.size),(e=>e.color),(e=>6*e.size),(e=>e.color)),$t.div.attrs((e=>({"data-orbit-radius":e.orbitRadius,"data-orbit-speed":e.orbitSpeed,"data-rings":e.rings,"data-rings-color":e.ringsColor,"data-glow-color":e.glowColor,"data-tail-length":e.tailLength})))(Ja||(Ja=nn(["\n  position: absolute;\n  width: ","px;\n  height: ","px;\n  background: ",";\n  border-radius: 50%;\n  box-shadow: 0 0 50px ",";\n  animation: orbit ","s linear infinite;\n  transform-origin: 50% 50%;\n  will-change: transform;\n  transform: translateZ(0);\n\n  &::before {\n    content: '';\n    position: absolute;\n    top: -10%;\n    left: -10%;\n    right: -10%;\n    bottom: -10%;\n    background: ",";\n    border-radius: 50%;\n    opacity: 0.3;\n    animation: pulse 8s ease-in-out infinite;\n    filter: blur(8px);\n  }\n\n  ","\n\n  @keyframes orbit {\n    from { transform: rotate(0deg) translateX(","px) rotate(0deg); }\n    to { transform: rotate(360deg) translateX(","px) rotate(-360deg); }\n  }\n\n  @keyframes pulse {\n    0% { transform: scale(1); opacity: 0.2; }\n    50% { transform: scale(1.2); opacity: 0.4; }\n    100% { transform: scale(1); opacity: 0.2; }\n  }\n"])),(e=>e.size),(e=>e.size),(e=>e.color),(e=>e.glowColor||e.color),(e=>e.orbitSpeed),(e=>e.atmosphereColor||"transparent"),(e=>e.rings?"\n    &::after {\n      content: '';\n      position: absolute;\n      width: 160%;\n      height: 20px;\n      background: ".concat(e.ringsColor||"rgba(255, 255, 255, 0.2)",";\n      left: -30%;\n      top: 50%;\n      transform: translateY(-50%) rotate(75deg);\n      border-radius: 50%;\n      box-shadow: 0 0 30px ").concat(e.ringsColor||"rgba(255, 255, 255, 0.2)",";\n      opacity: 0.7;\n    }\n  "):""),(e=>e.orbitRadius),(e=>e.orbitRadius))),oi=$t.div(Za||(Za=nn(["\n  position: absolute;\n  width: ","px;\n  height: ","px;\n  background: ",";\n  border-radius: 50%;\n  animation: orbit ","s linear infinite;\n  transform-origin: 50% 50%;\n\n  @keyframes orbit {\n    from { transform: rotate(0deg) translateX(","px) rotate(0deg); }\n    to { transform: rotate(360deg) translateX(","px) rotate(-360deg); }\n  }\n"])),(e=>e.size),(e=>e.size),(e=>e.color),(e=>e.orbitSpeed),(e=>e.orbitRadius),(e=>e.orbitRadius)),si=$t.div($a||($a=nn(["\n  position: absolute;\n  width: ","px;\n  height: ","px;\n  background: ",";\n  border-radius: 50%;\n  filter: blur(60px);\n  opacity: 0.6;\n  left: ",";\n  top: ",";\n  animation: nebulaPulse 20s ease-in-out infinite;\n\n  @keyframes nebulaPulse {\n    0% { transform: scale(1); opacity: 0.4; }\n    50% { transform: scale(1.1); opacity: 0.6; }\n    100% { transform: scale(1); opacity: 0.4; }\n  }\n"])),(e=>e.size),(e=>e.size),(e=>e.color),(e=>e.position.x),(e=>e.position.y)),ci=$t.div(ei||(ei=nn(["\n  position: fixed;\n  width: 3px;\n  height: 3px;\n  background: ",";\n  border-radius: 50%;\n  animation: cometMove ","s linear infinite;\n  animation-delay: ","s;\n  will-change: transform;\n  transform: translateZ(0);\n  opacity: 0;\n\n  &::after {\n    content: '';\n    position: absolute;\n    top: 50%;\n    right: 0;\n    width: ","px;\n    height: 2px;\n    background: linear-gradient(to left, \n      "," 0%,\n      ","80 30%,\n      ","40 60%,\n      ","00 100%\n    );\n    transform: translateY(-50%);\n    border-radius: 100px;\n  }\n\n  @keyframes cometMove {\n    0% {\n      transform: translate(-5vw, -5vh) rotate(35deg);\n      opacity: 0;\n    }\n    10% {\n      opacity: 1;\n    }\n    90% {\n      opacity: 1;\n    }\n    100% {\n      transform: translate(105vw, 105vh) rotate(35deg);\n      opacity: 0;\n    }\n  }\n"])),(e=>e.color),(e=>e.speed),(e=>e.delay),(e=>e.tailLength),(e=>e.color),(e=>e.color),(e=>e.color),(e=>e.color)),ui=$t.div(ti||(ti=nn(["\n  position: fixed;\n  font-size: ","px;\n  animation: ufoFloat"," ","s ease-in-out infinite;\n  user-select: none;\n  filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.5));\n  will-change: transform;\n  transform: translateZ(0);\n\n  @keyframes ufoFloat1 {\n    0% { transform: translate(0vw, 10vh) rotate(-5deg); }\n    25% { transform: translate(30vw, 40vh) rotate(5deg); }\n    50% { transform: translate(60vw, 20vh) rotate(-5deg); }\n    75% { transform: translate(90vw, 50vh) rotate(5deg); }\n    100% { transform: translate(0vw, 10vh) rotate(-5deg); }\n  }\n\n  @keyframes ufoFloat2 {\n    0% { transform: translate(90vw, 80vh) rotate(5deg); }\n    25% { transform: translate(60vw, 40vh) rotate(-5deg); }\n    50% { transform: translate(30vw, 60vh) rotate(5deg); }\n    75% { transform: translate(10vw, 20vh) rotate(-5deg); }\n    100% { transform: translate(90vw, 80vh) rotate(5deg); }\n  }\n\n  @keyframes ufoFloat3 {\n    0% { transform: translate(50vw, 0vh) rotate(-5deg); }\n    25% { transform: translate(80vw, 30vh) rotate(5deg); }\n    50% { transform: translate(40vw, 80vh) rotate(-5deg); }\n    75% { transform: translate(20vw, 40vh) rotate(5deg); }\n    100% { transform: translate(50vw, 0vh) rotate(-5deg); }\n  }\n\n  @keyframes ufoFloat4 {\n    0% { transform: translate(20vw, 90vh) rotate(5deg); }\n    25% { transform: translate(70vw, 60vh) rotate(-5deg); }\n    50% { transform: translate(10vw, 30vh) rotate(5deg); }\n    75% { transform: translate(90vw, 10vh) rotate(-5deg); }\n    100% { transform: translate(20vw, 90vh) rotate(5deg); }\n  }\n\n  @keyframes ufoFloat5 {\n    0% { transform: translate(40vw, 50vh) rotate(-5deg); }\n    25% { transform: translate(10vw, 80vh) rotate(5deg); }\n    50% { transform: translate(80vw, 40vh) rotate(-5deg); }\n    75% { transform: translate(30vw, 10vh) rotate(5deg); }\n    100% { transform: translate(40vw, 50vh) rotate(-5deg); }\n  }\n"])),(e=>e.size),(e=>e.index),(e=>12/e.speed)),li=$t.div(ni||(ni=nn(["\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 50%;\n  background: linear-gradient(\n    to bottom,\n    transparent,\n    ","\n  );\n  opacity: ",";\n  filter: blur(30px);\n  animation: auroraWave ","s ease-in-out infinite;\n\n  @keyframes auroraWave {\n    0% { transform: translateX(-25%) scale(1); }\n    50% { transform: translateX(25%) scale(1.2); }\n    100% { transform: translateX(-25%) scale(1); }\n  }\n"])),(e=>e.colors.map(((e,t)=>"".concat(e," ").concat(25*t,"%"))).join(", ")),(e=>e.intensity),(e=>e.speed)),fi=(0,o.memo)((e=>{var t,n;let{theme:r="night"}=e;const a=(0,o.useRef)(null),i=Xa[r],s=(0,o.useRef)([]);(0,o.useEffect)((()=>{if(!document.getElementById("star-animations")){const e=document.createElement("style");e.id="star-animations",e.textContent="\n        @keyframes twinkle {\n          0%, 100% { \n            opacity: 0.2;\n            transform: scale(0.85);\n            filter: brightness(0.5);\n          }\n          50% { \n            opacity: 1;\n            transform: scale(1.15);\n            filter: brightness(1.2);\n          }\n        }\n      ",document.head.appendChild(e)}if(a.current&&(!s.current.length||r!==s.current.theme)){a.current.innerHTML="";const e=(()=>{const e=[],{count:t,size:n,color:r,twinkleSpeed:a}=i.stars;for(let i=0;i<t;i++)e.push({left:"".concat(100*Math.random(),"%"),top:"".concat(100*Math.random(),"%"),size:Math.random()*(n.max-n.min)+n.min,twinkleSpeed:Math.random()*(a.max-a.min)+a.min,delay:2*Math.random()});return e})(),t=document.createDocumentFragment();e.forEach((e=>{const n=document.createElement("div");Object.assign(n.style,{position:"absolute",left:e.left,top:e.top,width:"".concat(e.size,"px"),height:"".concat(e.size,"px"),background:i.stars.color,borderRadius:"50%",boxShadow:"0 0 ".concat(2*e.size,"px ").concat(i.stars.color,",\n                      0 0 ").concat(4*e.size,"px ").concat(i.stars.color,",\n                      0 0 ").concat(6*e.size,"px ").concat(i.stars.color),animation:"twinkle ".concat(e.twinkleSpeed,"s ease-in-out infinite"),animationDelay:"".concat(e.delay,"s"),willChange:"transform, opacity, filter",transform:"translateZ(0)"}),t.appendChild(n)})),a.current.appendChild(t),s.current={stars:e,theme:r}}}),[r,i.stars]);const c=(0,o.memo)(ii),u=(0,o.memo)(oi),l=(0,o.memo)(si),f=(0,o.memo)(ci),d=(0,o.memo)(ui);return(0,ga.jsx)(ri,{theme:i,children:(0,ga.jsxs)(ai,{children:[(0,ga.jsx)("div",{ref:a,style:{position:"absolute",width:"100%",height:"100%"}}),null===(t=i.nebulas)||void 0===t?void 0:t.map(((e,t)=>(0,ga.jsx)(l,Ya({},e),t))),i.planets.map(((e,t)=>{var n;return(0,ga.jsxs)(o.Fragment,{children:[(0,ga.jsx)(c,Ya({},e)),null===(n=e.satellites)||void 0===n?void 0:n.map(((e,n)=>(0,ga.jsx)(u,Ya({},e),"".concat(t,"-").concat(n))))]},t)})),i.comets&&Array.from({length:i.comets.count}).map(((e,t)=>(0,ga.jsx)(f,{color:i.comets.color,tailLength:i.comets.tailLength,speed:Math.random()*(i.comets.speed.max-i.comets.speed.min)+i.comets.speed.min,delay:10*Math.random(),style:{left:"".concat(100*Math.random(),"%"),top:"".concat(100*Math.random(),"%")}},t))),i.ufos&&Array.from({length:i.ufos.count}).map(((e,t)=>(0,ga.jsx)(d,{index:t+1,size:i.ufos.size,speed:Math.random()*(i.ufos.speed.max-i.ufos.speed.min)+i.ufos.speed.min,children:i.ufos.emoji},t))),(null===(n=i.aurora)||void 0===n?void 0:n.active)&&(0,ga.jsx)(li,Ya({},i.aurora)),i.shootingStars&&Array.from({length:i.shootingStars.count}).map(((e,t)=>(0,ga.jsx)(f,{color:i.shootingStars.color,tailLength:i.shootingStars.tailLength,speed:Math.random()*(i.shootingStars.speed.max-i.shootingStars.speed.min)+i.shootingStars.speed.min,delay:15*Math.random()},"shooting-star-".concat(t))))]})})}));fi.displayName="SpaceBackground";const di=fi;function hi(e){return jr({tag:"svg",attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M3 248c0-38 26-53 58-55l149 1c9 0 17 6 20 15 34 110 76 178 126 255 3 6 8 9 13 9 4 0 8-2 11-7l3-11 1-173c0-25-12-29-40-33-11-2-18-12-18-22 0-2 0-4 1-6 14-43 58-65 120-65l56-1c46 0 88 20 88 79v227c4 3 8 5 13 5 8 0 18-5 26-18 52-73 111-160 119-206 0-2 1-3 2-5 11-22 39-37 51-41 2-1 5-2 9-2h155l10 1c15 0 26 10 31 19 9 14 7 29 8 35v7c-15 91-119 193-163 259-6 8-9 15-9 22 0 6 3 12 8 18l146 184c8 11 12 24 12 35 0 33-31 52-61 55l-17 1H779c-3 0-5 1-8 1-17 0-31-9-41-19-32-39-63-79-94-118-6-8-8-9-14-13-7 29-13 59-20 89l-3 17c-5 18-18 37-42 42l-14 1h-98C272 830 117 584 8 277c-3-8-5-19-5-29zm601 259c-26 0-55-15-55-43V234c0-27-12-37-45-37l-57 2c-32 0-50 5-65 15 23 11 44 26 44 68v176c-3 35-32 58-60 58-19 0-36-11-46-29-45-68-83-132-116-224l-9-26-133-1c-18 0-16 1-16 10 0 6 1 14 2 19l21 56c109 282 246 467 376 467h100c14 0 13-17 16-27l19-88c4-9 7-17 14-24 8-8 17-11 26-11 19 0 37 15 49 29l85 108c7 11 13 13 17 13h165c16 0 30-5 30-15 0-3-1-7-3-10L818 582c-12-15-17-30-17-45 0-16 6-32 16-46 42-63 132-153 153-227l3-13c-1-5-1-9-2-14H814c-10 4-18 10-24 18l-6 19c-23 64-86 152-131 213-15 14-32 20-49 20z"}}]})(e)}var pi,gi,mi,vi,bi,yi,xi,wi;const Si=$t.footer(pi||(pi=nn(["\n  width: 100%;\n  background: rgba(0, 0, 0, 0.7);\n  backdrop-filter: blur(10px);\n  color: white;\n  border-top: 1px solid rgba(255, 255, 255, 0.1);\n"]))),Ci=$t.div(gi||(gi=nn(["\n  width: min(1200px, 100%);\n  margin: 0 auto;\n  padding: 48px 24px;\n  display: grid;\n  grid-template-columns: repeat(3, 1fr);\n  column-gap: 64px;\n  row-gap: 48px;\n\n  @media (max-width: 968px) {\n    grid-template-columns: repeat(2, 1fr);\n  }\n\n  @media (max-width: 768px) {\n    grid-template-columns: 1fr;\n    padding: 32px 24px;\n  }\n"]))),Mi=$t.div(mi||(mi=nn(["\n  h3 {\n    font-size: 18px;\n    font-weight: 600;\n    color: #64ffda;\n    margin-bottom: 24px;\n    padding-bottom: 8px;\n    border-bottom: 2px solid rgba(100, 255, 218, 0.3);\n    margin-left: 24px;\n  }\n"]))),_i=$t(Lr)(vi||(vi=nn(["\n  display: block;\n  color: rgba(255, 255, 255, 0.8);\n  text-decoration: none;\n  font-size: 15px;\n  line-height: 1.6;\n  margin-bottom: 12px;\n  margin-left: 48px;\n  transition: color 0.2s ease, transform 0.2s ease;\n  \n  &:hover {\n    color: #64ffda;\n    transform: translateX(8px);\n  }\n"]))),Ei=$t.a(bi||(bi=nn(["\n  display: block;\n  color: rgba(255, 255, 255, 0.8);\n  text-decoration: none;\n  font-size: 15px;\n  line-height: 1.6;\n  margin-bottom: 12px;\n  margin-left: 48px;\n  transition: color 0.2s ease, transform 0.2s ease;\n  \n  &:hover {\n    color: #64ffda;\n    transform: translateX(8px);\n  }\n"]))),Ti=$t.div(yi||(yi=nn(["\n  display: flex;\n  gap: 16px;\n  margin-top: 24px;\n  margin-left: 48px;\n\n  a {\n    color: rgba(255, 255, 255, 0.8);\n    font-size: 24px;\n    transition: all 0.2s ease;\n    padding: 8px;\n    margin: -8px;\n    line-height: 1;\n    \n    &:hover {\n      color: #64ffda;\n      transform: translateY(-4px);\n    }\n  }\n"]))),Ii=$t.div(xi||(xi=nn(["\n  width: 100%;\n  text-align: center;\n  padding: 24px;\n  border-top: 1px solid rgba(255, 255, 255, 0.1);\n  background: rgba(0, 0, 0, 0.3);\n  font-size: 14px;\n  color: rgba(255, 255, 255, 0.6);\n\n  span {\n    display: block;\n    margin-top: 8px;\n    color: #64ffda;\n  }\n\n  svg {\n    vertical-align: middle;\n    margin: 0 4px;\n    color: #ff6b6b;\n  }\n"]))),ki=($t.div(wi||(wi=nn(["\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  margin-top: 24px;\n  color: rgba(255, 255, 255, 0.8);\n  font-size: 14px;\n\n  svg {\n    color: #64ffda;\n    font-size: 16px;\n  }\n"]))),()=>(0,ga.jsxs)(Si,{children:[(0,ga.jsxs)(Ci,{children:[(0,ga.jsxs)(Mi,{children:[(0,ga.jsx)("h3",{children:"\u041e \u043f\u0440\u043e\u0435\u043a\u0442\u0435"}),(0,ga.jsx)(_i,{to:"/about",children:"\u041e \u043d\u0430\u0441"}),(0,ga.jsx)(_i,{to:"/faq",children:"FAQ"}),(0,ga.jsx)(_i,{to:"/terms",children:"\u0423\u0441\u043b\u043e\u0432\u0438\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f"}),(0,ga.jsx)(_i,{to:"/privacy",children:"\u041f\u043e\u043b\u0438\u0442\u0438\u043a\u0430 \u043a\u043e\u043d\u0444\u0438\u0434\u0435\u043d\u0446\u0438\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u0438"})]}),(0,ga.jsxs)(Mi,{children:[(0,ga.jsx)("h3",{children:"\u041f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0430"}),(0,ga.jsx)(_i,{to:"/contact",children:"\u0421\u0432\u044f\u0437\u0430\u0442\u044c\u0441\u044f \u0441 \u043d\u0430\u043c\u0438"}),(0,ga.jsx)(_i,{to:"/report",children:"\u0421\u043e\u043e\u0431\u0449\u0438\u0442\u044c \u043e \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0435"}),(0,ga.jsx)(_i,{to:"/safety",children:"\u041f\u0440\u0430\u0432\u0438\u043b\u0430 \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u0438"})]}),(0,ga.jsxs)(Mi,{children:[(0,ga.jsx)("h3",{children:"\u0421\u043e\u043e\u0431\u0449\u0435\u0441\u0442\u0432\u043e"}),(0,ga.jsxs)(Ti,{children:[(0,ga.jsx)(Ei,{href:"https://vk.com/ruletka",title:"\u0412\u041a\u043e\u043d\u0442\u0430\u043a\u0442\u0435",children:(0,ga.jsx)(hi,{})}),(0,ga.jsx)(Ei,{href:"https://t.me/ruletka",title:"Telegram",children:(0,ga.jsx)(Ur,{})})]})]})]}),(0,ga.jsxs)(Ii,{children:["\xa9 2024-2025 Ruletka. \u0421\u043e\u0437\u0434\u0430\u043d\u043e \u0441 ",(0,ga.jsx)(Kr,{})," \u043a \u041a\u043e\u0441\u043c\u043e\u0441\u0443."]})]}));var Ni,Li,Ai,Ri,Di,Oi,Pi,Fi,zi,ji,Bi,Ui,Wi,Gi,Vi,Hi,Yi,Xi,qi,Ki,Qi;const Ji=$t.div(Ni||(Ni=nn(["\n  min-height: 100vh;\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: flex-start;\n  color: white;\n  text-align: center;\n  padding: 80px 0 0 0;\n  overflow: hidden;\n"]))),Zi=$t.div(Li||(Li=nn(["\n  position: relative;\n  z-index: 2;\n  max-width: 1200px;\n  width: 100%;\n  padding: 0 20px;\n  margin-bottom: 0;\n  color: ",";\n"])),(e=>"day"===e.theme?"#000":"white")),$i=$t.h1(Ai||(Ai=nn(["\n  font-size: 4rem;\n  margin-bottom: 1rem;\n  color: #FFD700;\n  text-shadow: 0 0 20px rgba(255, 215, 0, 0.3);\n"]))),eo=$t.p(Ri||(Ri=nn(["\n  font-size: 1.5rem;\n  margin-bottom: 2rem;\n  color: rgba(255, 255, 255, 0.9);\n  max-width: 800px;\n  margin: 0 auto 2rem;\n  font-weight: 400;\n"]))),to=$t(Lr)(Di||(Di=nn(["\n  display: inline-block;\n  padding: 1rem 2rem;\n  font-size: 1.5rem;\n  background: linear-gradient(45deg, #FF4500, #FF8C00);\n  color: white;\n  text-decoration: none;\n  border-radius: 50px;\n  transition: all 0.3s ease;\n  margin: 2rem 0;\n  border: 2px solid transparent;\n  box-shadow: 0 0 20px rgba(255, 69, 0, 0.4);\n\n  &:hover {\n    transform: scale(1.05);\n    box-shadow: 0 0 30px rgba(255, 69, 0, 0.6);\n    border-color: rgba(255, 255, 255, 0.2);\n  }\n"]))),no=$t.div(Oi||(Oi=nn(["\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n  gap: 2rem;\n  margin: 3rem 0;\n"]))),ro=$t.div.attrs((e=>({"data-icon-color":e.iconColor})))(Pi||(Pi=nn(["\n  background: rgba(0, 0, 0, 0.7);\n  backdrop-filter: blur(10px);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 12px;\n  padding: 24px;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  text-align: center;\n  transition: all 0.3s ease;\n\n  svg {\n    font-size: 32px;\n    margin-bottom: 16px;\n    color: ",";\n  }\n\n  &:hover {\n    transform: translateY(-5px);\n    border-color: #64ffda;\n  }\n"])),(e=>e["data-icon-color"])),ao=$t.div(Fi||(Fi=nn(["\n  font-size: 36px;\n  font-weight: 700;\n  margin-bottom: 8px;\n  color: #ffffff;\n"]))),io=$t.div(zi||(zi=nn(["\n  font-size: 16px;\n  color: rgba(255, 255, 255, 0.8);\n  line-height: 1.4;\n"]))),oo=$t.div(ji||(ji=nn(["\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n  gap: 2rem;\n  margin: 3rem 0;\n"]))),so=$t.div(Bi||(Bi=nn(["\n  background: ",";\n  backdrop-filter: blur(10px);\n  padding: 2rem;\n  border-radius: 20px;\n  border: 1px solid ",";\n  text-align: left;\n  transition: all 0.3s ease;\n\n  &:hover {\n    transform: translateY(-5px);\n    box-shadow: ",";\n  }\n\n  h3 {\n    font-size: 1.5rem;\n    margin-bottom: 1rem;\n    color: ",";\n    font-weight: 600;\n  }\n\n  p {\n    color: ",";\n    line-height: 1.6;\n    font-weight: ",";\n  }\n"])),(e=>"day"===e.theme?"rgba(255, 255, 255, 0.98)":"rgba(0, 0, 0, 0.3)"),(e=>"day"===e.theme?"rgba(0, 0, 0, 0.1)":"rgba(255, 255, 255, 0.1)"),(e=>"day"===e.theme?"0 5px 15px rgba(0, 0, 0, 0.1)":"0 5px 15px rgba(0, 0, 0, 0.3)"),(e=>"day"===e.theme?"#000":"#FFD700"),(e=>"day"===e.theme?"#000":"rgba(255, 255, 255, 0.8)"),(e=>"day"===e.theme?"500":"400")),co=$t.div(Ui||(Ui=nn(["\n  margin: 4rem 0;\n  width: 100%;\n  max-width: 1200px;\n"]))),uo=$t.h2(Wi||(Wi=nn(["\n  font-size: 2.5rem;\n  margin-bottom: 2rem;\n  color: ",";\n  font-weight: 600;\n  text-shadow: ",";\n"])),(e=>"day"===e.theme?"#000":"#fff"),(e=>"day"===e.theme?"2px 2px 4px rgba(0, 0, 0, 0.1)":"0 0 15px rgba(100, 255, 218, 0.3)")),lo=$t.div(Gi||(Gi=nn(["\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));\n  gap: 2rem;\n  margin: 2rem 0;\n"]))),fo=$t.div(Vi||(Vi=nn(["\n  background: ",";\n  backdrop-filter: blur(10px);\n  padding: 2rem;\n  border-radius: 20px;\n  border: 1px solid ",";\n  transition: all 0.3s ease;\n\n  &:hover {\n    transform: translateY(-5px);\n    box-shadow: ",";\n  }\n\n  svg {\n    font-size: 2.5rem;\n    color: ",";\n    margin-bottom: 1rem;\n  }\n"])),(e=>"day"===e.theme?"rgba(255, 255, 255, 0.98)":"rgba(0, 0, 0, 0.4)"),(e=>"day"===e.theme?"rgba(0, 0, 0, 0.1)":"rgba(255, 255, 255, 0.1)"),(e=>"day"===e.theme?"0 5px 15px rgba(0, 0, 0, 0.1)":"0 5px 15px rgba(0, 0, 0, 0.3)"),(e=>"day"===e.theme?"#000":"#64ffda")),ho=$t.h3(Hi||(Hi=nn(["\n  font-size: 1.5rem;\n  color: ",";\n  margin-bottom: 1rem;\n  font-weight: 600;\n"])),(e=>"day"===e.theme?"#000":"#fff")),po=$t.p(Yi||(Yi=nn(["\n  color: ",";\n  line-height: 1.6;\n  font-size: 1.1rem;\n  font-weight: ",";\n"])),(e=>"day"===e.theme?"#000":"rgba(255, 255, 255, 0.8)"),(e=>"day"===e.theme?"500":"400")),go=$t(co)(Xi||(Xi=nn(["\n  background: ",";\n  border-radius: 20px;\n  padding: 2rem;\n  margin: 4rem auto;\n  border: 1px solid ",";\n"])),(e=>"day"===e.theme?"rgba(255, 255, 255, 0.98)":"rgba(0, 0, 0, 0.3)"),(e=>"day"===e.theme?"rgba(0, 0, 0, 0.1)":"rgba(255, 255, 255, 0.1)")),mo=$t.div(qi||(qi=nn(["\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n  gap: 2rem;\n  margin-top: 2rem;\n"]))),vo=$t.div(Ki||(Ki=nn(["\n  text-align: center;\n  padding: 1.5rem;\n  background: ",";\n  border-radius: 15px;\n  transition: all 0.3s ease;\n  border: 1px solid ",";\n\n  &:hover {\n    transform: translateY(-5px);\n    background: ",";\n    box-shadow: ",";\n  }\n\n  svg {\n    font-size: 2rem;\n    color: ",";\n    margin-bottom: 1rem;\n  }\n\n  h4 {\n    color: ",";\n    margin-bottom: 0.5rem;\n    font-weight: 600;\n  }\n\n  p {\n    color: ",";\n    font-size: 0.9rem;\n    font-weight: ",";\n  }\n"])),(e=>"day"===e.theme?"rgba(255, 255, 255, 0.98)":"rgba(255, 255, 255, 0.05)"),(e=>"day"===e.theme?"rgba(0, 0, 0, 0.1)":"rgba(255, 255, 255, 0.1)"),(e=>"day"===e.theme?"#fff":"rgba(255, 255, 255, 0.1)"),(e=>"day"===e.theme?"0 5px 15px rgba(0, 0, 0, 0.1)":"0 5px 15px rgba(0, 0, 0, 0.3)"),(e=>"day"===e.theme?"#000":"#FFD700"),(e=>"day"===e.theme?"#000":"#fff"),(e=>"day"===e.theme?"#000":"rgba(255, 255, 255, 0.7)"),(e=>"day"===e.theme?"500":"400")),bo=$t(co)(Qi||(Qi=nn(["\n  text-align: center;\n"]))),yo=e=>{let{currentTheme:t,onlineUsers:n}=e;return(0,ga.jsxs)(Ji,{children:[(0,ga.jsx)(di,{theme:t}),(0,ga.jsxs)(Zi,{theme:t,children:[(0,ga.jsx)($i,{theme:t,children:"Ruletka"}),(0,ga.jsx)(eo,{theme:t,children:"\u0418\u0441\u0441\u043b\u0435\u0434\u0443\u0439\u0442\u0435 \u043a\u043e\u0441\u043c\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u043f\u0440\u043e\u0441\u0442\u043e\u0440\u044b \u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0432 \u043d\u0430\u0448\u0435\u043c \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u043e\u043c \u0432\u0438\u0434\u0435\u043e\u0447\u0430\u0442\u0435. \u0412\u0441\u0442\u0440\u0435\u0447\u0430\u0439\u0442\u0435 \u043d\u043e\u0432\u044b\u0445 \u043b\u044e\u0434\u0435\u0439 \u0441\u043e \u0432\u0441\u0435\u0439 \u0433\u0430\u043b\u0430\u043a\u0442\u0438\u043a\u0438 \u0432 \u0437\u0430\u0445\u0432\u0430\u0442\u044b\u0432\u0430\u044e\u0449\u0435\u043c \u043a\u043e\u0441\u043c\u0438\u0447\u0435\u0441\u043a\u043e\u043c \u043f\u0440\u0438\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0438!"}),(0,ga.jsxs)(no,{children:[(0,ga.jsxs)(ro,{theme:t,iconColor:"#64ffda",children:[(0,ga.jsx)(aa,{}),(0,ga.jsx)(ao,{theme:t,children:"789"}),(0,ga.jsx)(io,{theme:t,children:"\u041e\u043d\u043b\u0430\u0439\u043d \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439"})]}),(0,ga.jsxs)(ro,{theme:t,iconColor:"#64ffda",children:[(0,ga.jsx)(ia,{}),(0,ga.jsx)(ao,{theme:t,children:"1M+"}),(0,ga.jsx)(io,{theme:t,children:"\u0412\u0438\u0434\u0435\u043e\u0447\u0430\u0442\u043e\u0432 \u0432 \u0434\u0435\u043d\u044c"})]}),(0,ga.jsxs)(ro,{theme:t,iconColor:"#64ffda",children:[(0,ga.jsx)(Xr,{}),(0,ga.jsx)(ao,{theme:t,children:"150+"}),(0,ga.jsx)(io,{theme:t,children:"\u0421\u0442\u0440\u0430\u043d"})]}),(0,ga.jsxs)(ro,{theme:t,iconColor:"#64ffda",children:[(0,ga.jsx)(Kr,{}),(0,ga.jsx)(ao,{theme:t,children:"500K+"}),(0,ga.jsx)(io,{theme:t,children:"\u0421\u0447\u0430\u0441\u0442\u043b\u0438\u0432\u044b\u0445 \u0437\u043d\u0430\u043a\u043e\u043c\u0441\u0442\u0432"})]})]}),(0,ga.jsxs)(to,{to:"/chat",children:[(0,ga.jsx)(Zr,{style:{marginRight:"10px"}}),"\u041d\u0430\u0447\u0430\u0442\u044c \u043f\u0443\u0442\u0435\u0448\u0435\u0441\u0442\u0432\u0438\u0435"]}),(0,ga.jsxs)(co,{children:[(0,ga.jsx)(uo,{children:"\u041f\u043e\u0447\u0435\u043c\u0443 \u0432\u044b\u0431\u0438\u0440\u0430\u044e\u0442 Ruletka?"}),(0,ga.jsxs)(lo,{children:[(0,ga.jsxs)(fo,{children:[(0,ga.jsx)(ra,{}),(0,ga.jsx)(ho,{children:"\u0410\u043d\u043e\u043d\u0438\u043c\u043d\u043e\u0441\u0442\u044c"}),(0,ga.jsx)(po,{children:"\u041e\u0431\u0449\u0430\u0439\u0442\u0435\u0441\u044c \u0441\u0432\u043e\u0431\u043e\u0434\u043d\u043e \u0438 \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e. \u041c\u044b \u043d\u0435 \u0445\u0440\u0430\u043d\u0438\u043c \u0438\u0441\u0442\u043e\u0440\u0438\u044e \u0447\u0430\u0442\u043e\u0432 \u0438 \u043d\u0435 \u0442\u0440\u0435\u0431\u0443\u0435\u043c \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438. \u0412\u0430\u0448\u0430 \u043f\u0440\u0438\u0432\u0430\u0442\u043d\u043e\u0441\u0442\u044c - \u043d\u0430\u0448 \u0433\u043b\u0430\u0432\u043d\u044b\u0439 \u043f\u0440\u0438\u043e\u0440\u0438\u0442\u0435\u0442."})]}),(0,ga.jsxs)(fo,{children:[(0,ga.jsx)(ia,{}),(0,ga.jsx)(ho,{children:"HD \u041a\u0430\u0447\u0435\u0441\u0442\u0432\u043e"}),(0,ga.jsx)(po,{children:"\u041a\u0440\u0438\u0441\u0442\u0430\u043b\u044c\u043d\u043e \u0447\u0438\u0441\u0442\u043e\u0435 \u0432\u0438\u0434\u0435\u043e \u0438 \u0437\u0432\u0443\u043a. \u0421\u043e\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \u0442\u0435\u0445\u043d\u043e\u043b\u043e\u0433\u0438\u0438 WebRTC \u043e\u0431\u0435\u0441\u043f\u0435\u0447\u0438\u0432\u0430\u044e\u0442 \u0441\u0442\u0430\u0431\u0438\u043b\u044c\u043d\u043e\u0435 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0438 \u0432\u044b\u0441\u043e\u043a\u043e\u0435 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u043e \u0442\u0440\u0430\u043d\u0441\u043b\u044f\u0446\u0438\u0438."})]}),(0,ga.jsxs)(fo,{children:[(0,ga.jsx)(Gr,{}),(0,ga.jsx)(ho,{children:"\u0423\u043c\u043d\u044b\u0439 \u043f\u043e\u0434\u0431\u043e\u0440"}),(0,ga.jsx)(po,{children:"\u041d\u0430\u0448 \u0430\u043b\u0433\u043e\u0440\u0438\u0442\u043c \u043f\u043e\u0434\u0431\u0438\u0440\u0430\u0435\u0442 \u0441\u043e\u0431\u0435\u0441\u0435\u0434\u043d\u0438\u043a\u043e\u0432 \u0441 \u0443\u0447\u0435\u0442\u043e\u043c \u0432\u0430\u0448\u0438\u0445 \u0438\u043d\u0442\u0435\u0440\u0435\u0441\u043e\u0432 \u0438 \u043f\u0440\u0435\u0434\u043f\u043e\u0447\u0442\u0435\u043d\u0438\u0439, \u0434\u0435\u043b\u0430\u044f \u043a\u0430\u0436\u0434\u0443\u044e \u0432\u0441\u0442\u0440\u0435\u0447\u0443 \u043e\u0441\u043e\u0431\u0435\u043d\u043d\u043e\u0439."})]})]})]}),(0,ga.jsxs)(oo,{children:[(0,ga.jsxs)(so,{children:[(0,ga.jsx)("h3",{children:"\ud83c\udf0c \u041a\u043e\u0441\u043c\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0442\u0435\u043c\u044b"}),(0,ga.jsx)("p",{children:"\u041f\u043e\u0433\u0440\u0443\u0437\u0438\u0442\u0435\u0441\u044c \u0432 \u0430\u0442\u043c\u043e\u0441\u0444\u0435\u0440\u0443 \u043a\u043e\u0441\u043c\u043e\u0441\u0430 \u0441 \u043d\u0430\u0448\u0438\u043c\u0438 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u043c\u0438 \u0442\u0435\u043c\u0430\u043c\u0438 \u043e\u0444\u043e\u0440\u043c\u043b\u0435\u043d\u0438\u044f. \u0414\u0435\u043d\u044c \u0438 \u043d\u043e\u0447\u044c - \u043a\u0430\u0436\u0434\u0430\u044f \u0442\u0435\u043c\u0430 \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u043e\u0441\u043e\u0431\u043e\u0435 \u043d\u0430\u0441\u0442\u0440\u043e\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u043e\u0431\u0449\u0435\u043d\u0438\u044f. \u041d\u0430\u0431\u043b\u044e\u0434\u0430\u0439\u0442\u0435 \u0437\u0430 \u0434\u0432\u0438\u0436\u0435\u043d\u0438\u0435\u043c \u043f\u043b\u0430\u043d\u0435\u0442, \u043f\u043e\u043b\u0435\u0442\u043e\u043c \u043a\u043e\u043c\u0435\u0442 \u0438 \u043c\u0435\u0440\u0446\u0430\u043d\u0438\u0435\u043c \u0437\u0432\u0435\u0437\u0434."})]}),(0,ga.jsxs)(so,{children:[(0,ga.jsx)("h3",{children:"\ud83d\udef8 \u041c\u0433\u043d\u043e\u0432\u0435\u043d\u043d\u044b\u0435 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f"}),(0,ga.jsx)("p",{children:"\u041d\u0430\u0448\u0430 \u043f\u0435\u0440\u0435\u0434\u043e\u0432\u0430\u044f \u0442\u0435\u0445\u043d\u043e\u043b\u043e\u0433\u0438\u044f \u043e\u0431\u0435\u0441\u043f\u0435\u0447\u0438\u0432\u0430\u0435\u0442 \u043c\u0433\u043d\u043e\u0432\u0435\u043d\u043d\u043e\u0435 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0441 \u0441\u043e\u0431\u0435\u0441\u0435\u0434\u043d\u0438\u043a\u0430\u043c\u0438. \u041d\u0438\u043a\u0430\u043a\u0438\u0445 \u0437\u0430\u0434\u0435\u0440\u0436\u0435\u043a - \u0442\u043e\u043b\u044c\u043a\u043e \u0447\u0438\u0441\u0442\u043e\u0435 \u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0447\u0435\u0440\u0435\u0437 \u043a\u043e\u0441\u043c\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u043f\u0440\u043e\u0441\u0442\u043e\u0440\u044b. \u041f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0430 \u0432\u0441\u0435\u0445 \u0441\u043e\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0445 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u043e\u0432 \u0438 \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432."})]}),(0,ga.jsxs)(so,{children:[(0,ga.jsx)("h3",{children:"\ud83d\udc7e \u0423\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0435 \u0432\u0441\u0442\u0440\u0435\u0447\u0438"}),(0,ga.jsx)("p",{children:"\u041a\u0430\u0436\u0434\u044b\u0439 \u0440\u0430\u0437\u0433\u043e\u0432\u043e\u0440 - \u044d\u0442\u043e \u043d\u043e\u0432\u043e\u0435 \u043f\u0440\u0438\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435. \u0412\u0441\u0442\u0440\u0435\u0447\u0430\u0439\u0442\u0435 \u0438\u043d\u0442\u0435\u0440\u0435\u0441\u043d\u044b\u0445 \u0441\u043e\u0431\u0435\u0441\u0435\u0434\u043d\u0438\u043a\u043e\u0432 \u0441\u043e \u0432\u0441\u0435\u0433\u043e \u043c\u0438\u0440\u0430, \u0434\u0435\u043b\u0438\u0442\u0435\u0441\u044c \u0438\u0441\u0442\u043e\u0440\u0438\u044f\u043c\u0438 \u0438 \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0435 \u043d\u043e\u0432\u044b\u0445 \u0434\u0440\u0443\u0437\u0435\u0439. \u0424\u0438\u043b\u044c\u0442\u0440\u044b \u043f\u043e \u044f\u0437\u044b\u043a\u0443 \u0438 \u0440\u0435\u0433\u0438\u043e\u043d\u0443 \u043f\u043e\u043c\u043e\u0433\u0443\u0442 \u043d\u0430\u0439\u0442\u0438 \u0431\u043b\u0438\u0437\u043a\u0438\u0445 \u043f\u043e \u0434\u0443\u0445\u0443 \u043b\u044e\u0434\u0435\u0439."})]})]}),(0,ga.jsxs)(co,{children:[(0,ga.jsx)(uo,{children:"\u041f\u0440\u0430\u0432\u0438\u043b\u0430 \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u0438"}),(0,ga.jsxs)(lo,{children:[(0,ga.jsxs)(fo,{children:[(0,ga.jsx)(ta,{}),(0,ga.jsx)(ho,{children:"\u041c\u043e\u0434\u0435\u0440\u0430\u0446\u0438\u044f 24/7"}),(0,ga.jsx)(po,{children:"\u041d\u0430\u0448\u0430 \u043a\u043e\u043c\u0430\u043d\u0434\u0430 \u043c\u043e\u0434\u0435\u0440\u0430\u0442\u043e\u0440\u043e\u0432 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u043a\u0440\u0443\u0433\u043b\u043e\u0441\u0443\u0442\u043e\u0447\u043d\u043e, \u043e\u0431\u0435\u0441\u043f\u0435\u0447\u0438\u0432\u0430\u044f \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u0443\u044e \u0438 \u043a\u043e\u043c\u0444\u043e\u0440\u0442\u043d\u0443\u044e \u0430\u0442\u043c\u043e\u0441\u0444\u0435\u0440\u0443 \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439."})]}),(0,ga.jsxs)(fo,{children:[(0,ga.jsx)($r,{}),(0,ga.jsx)(ho,{children:"\u0417\u0430\u0449\u0438\u0442\u0430 \u0434\u0430\u043d\u043d\u044b\u0445"}),(0,ga.jsx)(po,{children:"\u0412\u0441\u0435 \u0432\u0438\u0434\u0435\u043e\u0437\u0432\u043e\u043d\u043a\u0438 \u0437\u0430\u0449\u0438\u0449\u0435\u043d\u044b \u0441\u043e\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u043c\u0438 \u043c\u0435\u0442\u043e\u0434\u0430\u043c\u0438 \u0448\u0438\u0444\u0440\u043e\u0432\u0430\u043d\u0438\u044f. \u0412\u0430\u0448\u0438 \u043b\u0438\u0447\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u0438."})]}),(0,ga.jsxs)(fo,{children:[(0,ga.jsx)(Wr,{}),(0,ga.jsx)(ho,{children:"\u0411\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u043a\u0430 \u043d\u0430\u0440\u0443\u0448\u0438\u0442\u0435\u043b\u0435\u0439"}),(0,ga.jsx)(po,{children:"\u0421\u0438\u0441\u0442\u0435\u043c\u0430 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0431\u043b\u043e\u043a\u0438\u0440\u0443\u0435\u0442 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439, \u043d\u0430\u0440\u0443\u0448\u0430\u044e\u0449\u0438\u0445 \u043f\u0440\u0430\u0432\u0438\u043b\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u0441\u0442\u0432\u0430, \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u044f \u0434\u0440\u0443\u0436\u0435\u043b\u044e\u0431\u043d\u0443\u044e \u0430\u0442\u043c\u043e\u0441\u0444\u0435\u0440\u0443."})]})]})]}),(0,ga.jsxs)(bo,{children:[(0,ga.jsx)(uo,{children:"\u041a\u043e\u0441\u043c\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0440\u0430\u0437\u0432\u043b\u0435\u0447\u0435\u043d\u0438\u044f"}),(0,ga.jsxs)(lo,{children:[(0,ga.jsxs)(fo,{children:[(0,ga.jsx)(Hr,{}),(0,ga.jsx)(ho,{children:"\u041c\u0438\u043d\u0438-\u0438\u0433\u0440\u044b"}),(0,ga.jsx)(po,{children:"\u0418\u0433\u0440\u0430\u0439\u0442\u0435 \u0432 \u043a\u043e\u0441\u043c\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u043c\u0438\u043d\u0438-\u0438\u0433\u0440\u044b \u0441 \u0441\u043e\u0431\u0435\u0441\u0435\u0434\u043d\u0438\u043a\u043e\u043c \u0432\u043e \u0432\u0440\u0435\u043c\u044f \u043e\u0431\u0449\u0435\u043d\u0438\u044f. \u0421\u043e\u0440\u0435\u0432\u043d\u0443\u0439\u0442\u0435\u0441\u044c \u0432 \u0433\u043e\u043b\u043e\u0432\u043e\u043b\u043e\u043c\u043a\u0430\u0445, \u0432\u0438\u043a\u0442\u043e\u0440\u0438\u043d\u0430\u0445 \u0438 \u0434\u0440\u0443\u0433\u0438\u0445 \u0443\u0432\u043b\u0435\u043a\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u0438\u0433\u0440\u0430\u0445."})]}),(0,ga.jsxs)(fo,{children:[(0,ga.jsx)(Yr,{}),(0,ga.jsx)(ho,{children:"\u041f\u043e\u0434\u0430\u0440\u043a\u0438"}),(0,ga.jsx)(po,{children:"\u041e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0439\u0442\u0435 \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u044b\u0435 \u043f\u043e\u0434\u0430\u0440\u043a\u0438 \u0441\u043e\u0431\u0435\u0441\u0435\u0434\u043d\u0438\u043a\u0430\u043c. \u0412\u044b\u0431\u0438\u0440\u0430\u0439\u0442\u0435 \u0438\u0437 \u043a\u043e\u043b\u043b\u0435\u043a\u0446\u0438\u0438 \u043a\u043e\u0441\u043c\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0441\u0443\u0432\u0435\u043d\u0438\u0440\u043e\u0432 \u0438 \u0434\u0435\u043b\u0438\u0442\u0435\u0441\u044c \u043f\u043e\u0437\u0438\u0442\u0438\u0432\u043d\u044b\u043c\u0438 \u044d\u043c\u043e\u0446\u0438\u044f\u043c\u0438."})]}),(0,ga.jsxs)(fo,{children:[(0,ga.jsx)(Qr,{}),(0,ga.jsx)(ho,{children:"\u0414\u043e\u0441\u0442\u0438\u0436\u0435\u043d\u0438\u044f"}),(0,ga.jsx)(po,{children:"\u041f\u043e\u043b\u0443\u0447\u0430\u0439\u0442\u0435 \u043a\u043e\u0441\u043c\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0437\u0432\u0430\u043d\u0438\u044f \u0438 \u043d\u0430\u0433\u0440\u0430\u0434\u044b \u0437\u0430 \u0430\u043a\u0442\u0438\u0432\u043d\u043e\u0435 \u043e\u0431\u0449\u0435\u043d\u0438\u0435. \u041e\u0442\u043a\u0440\u044b\u0432\u0430\u0439\u0442\u0435 \u043d\u043e\u0432\u044b\u0435 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438 \u0438 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u0438."})]})]})]}),(0,ga.jsxs)(go,{children:[(0,ga.jsx)(uo,{children:"\u0421\u0438\u0441\u0442\u0435\u043c\u0430 \u043d\u0430\u0433\u0440\u0430\u0434"}),(0,ga.jsxs)(mo,{children:[(0,ga.jsxs)(vo,{children:[(0,ga.jsx)(ta,{}),(0,ga.jsx)("h4",{children:"\u0417\u0432\u0435\u0437\u0434\u043d\u044b\u0439 \u0440\u0435\u0439\u0442\u0438\u043d\u0433"}),(0,ga.jsx)("p",{children:"\u041f\u043e\u043b\u0443\u0447\u0430\u0439\u0442\u0435 \u0437\u0432\u0435\u0437\u0434\u044b \u0437\u0430 \u043f\u043e\u0437\u0438\u0442\u0438\u0432\u043d\u043e\u0435 \u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0438 \u043f\u043e\u043c\u043e\u0449\u044c \u0434\u0440\u0443\u0433\u0438\u043c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f\u043c"})]}),(0,ga.jsxs)(vo,{children:[(0,ga.jsx)(Zr,{}),(0,ga.jsx)("h4",{children:"\u041a\u043e\u0441\u043c\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0431\u0443\u0441\u0442\u0435\u0440\u044b"}),(0,ga.jsx)("p",{children:"\u0423\u0441\u043a\u043e\u0440\u044f\u0439\u0442\u0435 \u043f\u043e\u0438\u0441\u043a \u0441\u043e\u0431\u0435\u0441\u0435\u0434\u043d\u0438\u043a\u043e\u0432 \u0438 \u043f\u043e\u043b\u0443\u0447\u0430\u0439\u0442\u0435 \u043f\u0440\u0438\u043e\u0440\u0438\u0442\u0435\u0442\u043d\u044b\u0439 \u0434\u043e\u0441\u0442\u0443\u043f"})]}),(0,ga.jsxs)(vo,{children:[(0,ga.jsx)(Kr,{}),(0,ga.jsx)("h4",{children:"\u0421\u0438\u043c\u043f\u0430\u0442\u0438\u0438"}),(0,ga.jsx)("p",{children:"\u041e\u0442\u043c\u0435\u0447\u0430\u0439\u0442\u0435 \u043f\u043e\u043d\u0440\u0430\u0432\u0438\u0432\u0448\u0438\u0445\u0441\u044f \u0441\u043e\u0431\u0435\u0441\u0435\u0434\u043d\u0438\u043a\u043e\u0432 \u0438 \u0441\u043e\u0437\u0434\u0430\u0432\u0430\u0439\u0442\u0435 \u0441\u043f\u0438\u0441\u043e\u043a \u0434\u0440\u0443\u0437\u0435\u0439"})]})]})]})]}),(0,ga.jsx)(ki,{})]})},xo=Object.create(null);xo.open="0",xo.close="1",xo.ping="2",xo.pong="3",xo.message="4",xo.upgrade="5",xo.noop="6";const wo=Object.create(null);Object.keys(xo).forEach((e=>{wo[xo[e]]=e}));const So={type:"error",data:"parser error"},Co="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),Mo="function"===typeof ArrayBuffer,_o=e=>"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,Eo=(e,t,n)=>{let{type:r,data:a}=e;return Co&&a instanceof Blob?t?n(a):To(a,n):Mo&&(a instanceof ArrayBuffer||_o(a))?t?n(a):To(new Blob([a]),n):n(xo[r]+(a||""))},To=(e,t)=>{const n=new FileReader;return n.onload=function(){const e=n.result.split(",")[1];t("b"+(e||""))},n.readAsDataURL(e)};function Io(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let ko;const No="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Lo="undefined"===typeof Uint8Array?[]:new Uint8Array(256);for(let n=0;n<64;n++)Lo[No.charCodeAt(n)]=n;const Ao="function"===typeof ArrayBuffer,Ro=(e,t)=>{if("string"!==typeof e)return{type:"message",data:Oo(e,t)};const n=e.charAt(0);if("b"===n)return{type:"message",data:Do(e.substring(1),t)};return wo[n]?e.length>1?{type:wo[n],data:e.substring(1)}:{type:wo[n]}:So},Do=(e,t)=>{if(Ao){const n=(e=>{let t,n,r,a,i,o=.75*e.length,s=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);const u=new ArrayBuffer(o),l=new Uint8Array(u);for(t=0;t<s;t+=4)n=Lo[e.charCodeAt(t)],r=Lo[e.charCodeAt(t+1)],a=Lo[e.charCodeAt(t+2)],i=Lo[e.charCodeAt(t+3)],l[c++]=n<<2|r>>4,l[c++]=(15&r)<<4|a>>2,l[c++]=(3&a)<<6|63&i;return u})(e);return Oo(n,t)}return{base64:!0,data:e}},Oo=(e,t)=>"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer,Po=String.fromCharCode(30);function Fo(){return new TransformStream({transform(e,t){!function(e,t){Co&&e.data instanceof Blob?e.data.arrayBuffer().then(Io).then(t):Mo&&(e.data instanceof ArrayBuffer||_o(e.data))?t(Io(e.data)):Eo(e,!1,(e=>{ko||(ko=new TextEncoder),t(ko.encode(e))}))}(e,(n=>{const r=n.length;let a;if(r<126)a=new Uint8Array(1),new DataView(a.buffer).setUint8(0,r);else if(r<65536){a=new Uint8Array(3);const e=new DataView(a.buffer);e.setUint8(0,126),e.setUint16(1,r)}else{a=new Uint8Array(9);const e=new DataView(a.buffer);e.setUint8(0,127),e.setBigUint64(1,BigInt(r))}e.data&&"string"!==typeof e.data&&(a[0]|=128),t.enqueue(a),t.enqueue(n)}))}})}let zo;function jo(e){return e.reduce(((e,t)=>e+t.length),0)}function Bo(e,t){if(e[0].length===t)return e.shift();const n=new Uint8Array(t);let r=0;for(let a=0;a<t;a++)n[a]=e[0][r++],r===e[0].length&&(e.shift(),r=0);return e.length&&r<e[0].length&&(e[0]=e[0].slice(r)),n}function Uo(e){if(e)return function(e){for(var t in Uo.prototype)e[t]=Uo.prototype[t];return e}(e)}Uo.prototype.on=Uo.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},Uo.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},Uo.prototype.off=Uo.prototype.removeListener=Uo.prototype.removeAllListeners=Uo.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var a=0;a<r.length;a++)if((n=r[a])===t||n.fn===t){r.splice(a,1);break}return 0===r.length&&delete this._callbacks["$"+e],this},Uo.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(n){r=0;for(var a=(n=n.slice(0)).length;r<a;++r)n[r].apply(this,t)}return this},Uo.prototype.emitReserved=Uo.prototype.emit,Uo.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},Uo.prototype.hasListeners=function(e){return!!this.listeners(e).length};const Wo="undefined"!==typeof self?self:"undefined"!==typeof window?window:Function("return this")();function Go(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reduce(((t,n)=>(e.hasOwnProperty(n)&&(t[n]=e[n]),t)),{})}const Vo=Wo.setTimeout,Ho=Wo.clearTimeout;function Yo(e,t){t.useNativeTimers?(e.setTimeoutFn=Vo.bind(Wo),e.clearTimeoutFn=Ho.bind(Wo)):(e.setTimeoutFn=Wo.setTimeout.bind(Wo),e.clearTimeoutFn=Wo.clearTimeout.bind(Wo))}class Xo extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class qo extends Uo{constructor(e){super(),this.writable=!1,Yo(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,n){return super.emitReserved("error",new Xo(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=Ro(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(e){const t=function(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}(e);return t.length?"?"+t:""}}const Ko="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Qo={};let Jo,Zo=0,$o=0;function es(e){let t="";do{t=Ko[e%64]+t,e=Math.floor(e/64)}while(e>0);return t}function ts(){const e=es(+new Date);return e!==Jo?(Zo=0,Jo=e):e+"."+es(Zo++)}for(;$o<64;$o++)Qo[Ko[$o]]=$o;let ns=!1;try{ns="undefined"!==typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(upe){}const rs=ns;function as(e){const t=e.xdomain;try{if("undefined"!==typeof XMLHttpRequest&&(!t||rs))return new XMLHttpRequest}catch(IQ){}if(!t)try{return new(Wo[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(IQ){}}function is(){}const os=null!=new as({xdomain:!1}).responseType;class ss extends Uo{constructor(e,t){super(),Yo(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.data=void 0!==t.data?t.data:null,this.create()}create(){var e;const t=Go(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd;const n=this.xhr=new as(t);try{n.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let e in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(e)&&n.setRequestHeader(e,this.opts.extraHeaders[e])}}catch(IQ){}if("POST"===this.method)try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(IQ){}try{n.setRequestHeader("Accept","*/*")}catch(IQ){}null===(e=this.opts.cookieJar)||void 0===e||e.addCookies(n),"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=()=>{var e;3===n.readyState&&(null===(e=this.opts.cookieJar)||void 0===e||e.parseCookies(n)),4===n.readyState&&(200===n.status||1223===n.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"===typeof n.status?n.status:0)}),0))},n.send(this.data)}catch(IQ){return void this.setTimeoutFn((()=>{this.onError(IQ)}),0)}"undefined"!==typeof document&&(this.index=ss.requestsCount++,ss.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if("undefined"!==typeof this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=is,e)try{this.xhr.abort()}catch(IQ){}"undefined"!==typeof document&&delete ss.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}if(ss.requestsCount=0,ss.requests={},"undefined"!==typeof document)if("function"===typeof attachEvent)attachEvent("onunload",cs);else if("function"===typeof addEventListener){addEventListener("onpagehide"in Wo?"pagehide":"unload",cs,!1)}function cs(){for(let e in ss.requests)ss.requests.hasOwnProperty(e)&&ss.requests[e].abort()}const us="function"===typeof Promise&&"function"===typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),ls=Wo.WebSocket||Wo.MozWebSocket;n(6382).Buffer;const fs="undefined"!==typeof navigator&&"string"===typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();const ds={websocket:class extends qo{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,n=fs?{}:Go(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=fs?new ls(e,t,n):t?new ls(e,t):new ls(e)}catch(upe){return this.emitReserved("error",upe)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],r=t===e.length-1;Eo(n,this.supportsBinary,(e=>{try{this.ws.send(e)}catch(IQ){}r&&us((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){"undefined"!==typeof this.ws&&(this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=ts()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}check(){return!!ls}},webtransport:class extends qo{get name(){return"webtransport"}doOpen(){"function"===typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then((()=>{this.onClose()})).catch((e=>{this.onError("webtransport error",e)})),this.transport.ready.then((()=>{this.transport.createBidirectionalStream().then((e=>{const t=function(e,t){zo||(zo=new TextDecoder);const n=[];let r=0,a=-1,i=!1;return new TransformStream({transform(o,s){for(n.push(o);;){if(0===r){if(jo(n)<1)break;const e=Bo(n,1);i=128===(128&e[0]),a=127&e[0],r=a<126?3:126===a?1:2}else if(1===r){if(jo(n)<2)break;const e=Bo(n,2);a=new DataView(e.buffer,e.byteOffset,e.length).getUint16(0),r=3}else if(2===r){if(jo(n)<8)break;const e=Bo(n,8),t=new DataView(e.buffer,e.byteOffset,e.length),i=t.getUint32(0);if(i>Math.pow(2,21)-1){s.enqueue(So);break}a=i*Math.pow(2,32)+t.getUint32(4),r=3}else{if(jo(n)<a)break;const e=Bo(n,a);s.enqueue(Ro(i?e:zo.decode(e),t)),r=0}if(0===a||a>e){s.enqueue(So);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=e.readable.pipeThrough(t).getReader(),r=Fo();r.readable.pipeTo(e.writable),this.writer=r.writable.getWriter();const a=()=>{n.read().then((e=>{let{done:t,value:n}=e;t||(this.onPacket(n),a())})).catch((e=>{}))};a();const i={type:"open"};this.query.sid&&(i.data='{"sid":"'.concat(this.query.sid,'"}')),this.writer.write(i).then((()=>this.onOpen()))}))})))}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],r=t===e.length-1;this.writer.write(n).then((()=>{r&&us((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){var e;null===(e=this.transport)||void 0===e||e.close()}},polling:class extends qo{constructor(e){if(super(e),this.polling=!1,"undefined"!==typeof location){const t="https:"===location.protocol;let n=location.port;n||(n=t?"443":"80"),this.xd="undefined"!==typeof location&&e.hostname!==location.hostname||n!==e.port}const t=e&&e.forceBase64;this.supportsBinary=os&&!t,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let e=0;this.polling&&(e++,this.once("pollComplete",(function(){--e||t()}))),this.writable||(e++,this.once("drain",(function(){--e||t()})))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{const n=e.split(Po),r=[];for(let a=0;a<n.length;a++){const e=Ro(n[a],t);if(r.push(e),"error"===e.type)break}return r})(e,this.socket.binaryType).forEach((e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,t)=>{const n=e.length,r=new Array(n);let a=0;e.forEach(((e,i)=>{Eo(e,!1,(e=>{r[i]=e,++a===n&&t(r.join(Po))}))}))})(e,(e=>{this.doWrite(e,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=ts()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}request(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new ss(this.uri(),e)}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",((e,t)=>{this.onError("xhr post error",e,t)}))}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",((e,t)=>{this.onError("xhr poll error",e,t)})),this.pollXhr=e}}},hs=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ps=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function gs(e){if(e.length>2e3)throw"URI too long";const t=e,n=e.indexOf("["),r=e.indexOf("]");-1!=n&&-1!=r&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));let a=hs.exec(e||""),i={},o=14;for(;o--;)i[ps[o]]=a[o]||"";return-1!=n&&-1!=r&&(i.source=t,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=function(e,t){const n=/\/{2,9}/g,r=t.replace(n,"/").split("/");"/"!=t.slice(0,1)&&0!==t.length||r.splice(0,1);"/"==t.slice(-1)&&r.splice(r.length-1,1);return r}(0,i.path),i.queryKey=function(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,r){t&&(n[t]=r)})),n}(0,i.query),i}class ms extends Uo{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.binaryType="arraybuffer",this.writeBuffer=[],e&&"object"===typeof e&&(t=e,e=null),e?(e=gs(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=gs(t.host).host),Yo(this,t),this.secure=null!=t.secure?t.secure:"undefined"!==typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!==typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!==typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"===typeof this.opts.query&&(this.opts.query=function(e){let t={},n=e.split("&");for(let r=0,a=n.length;r<a;r++){let e=n[r].split("=");t[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}return t}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"===typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new ds[e](n)}open(){let e;if(this.opts.rememberUpgrade&&ms.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(IQ){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(e=>this.onClose("transport close",e)))}probe(e){let t=this.createTransport(e),n=!1;ms.priorWebsocketSuccess=!1;const r=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",(e=>{if(!n)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;ms.priorWebsocketSuccess="websocket"===t.name,this.transport.pause((()=>{n||"closed"!==this.readyState&&(u(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())}))}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}})))};function a(){n||(n=!0,u(),t.close(),t=null)}const i=e=>{const n=new Error("probe error: "+e);n.transport=t.name,a(),this.emitReserved("upgradeError",n)};function o(){i("transport closed")}function s(){i("socket closed")}function c(e){t&&e.name!==t.name&&a()}const u=()=>{t.removeListener("open",r),t.removeListener("error",i),t.removeListener("close",o),this.off("close",s),this.off("upgrading",c)};t.once("open",r),t.once("error",i),t.once("close",o),this.once("close",s),this.once("upgrading",c),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn((()=>{n||t.open()}),200):t.open()}onOpen(){if(this.readyState="open",ms.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),this.resetPingTimeout(),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let n=0;n<this.writeBuffer.length;n++){const r=this.writeBuffer[n].data;if(r&&(e+="string"===typeof(t=r)?function(e){let t=0,n=0;for(let r=0,a=e.length;r<a;r++)t=e.charCodeAt(r),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n}(t):Math.ceil(1.33*(t.byteLength||t.size))),n>0&&e>this.maxPayload)return this.writeBuffer.slice(0,n);e+=2}var t;return this.writeBuffer}write(e,t,n){return this.sendPacket("message",e,t,n),this}send(e,t,n){return this.sendPacket("message",e,t,n),this}sendPacket(e,t,n,r){if("function"===typeof t&&(r=t,t=void 0),"function"===typeof n&&(r=n,n=null),"closing"===this.readyState||"closed"===this.readyState)return;(n=n||{}).compress=!1!==n.compress;const a={type:e,data:t,options:n};this.emitReserved("packetCreate",a),this.writeBuffer.push(a),r&&this.once("flush",r),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?n():e()})):this.upgrading?n():e()),this}onError(e){ms.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"===typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let n=0;const r=e.length;for(;n<r;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}ms.protocol=4;ms.protocol;const vs="function"===typeof ArrayBuffer,bs=Object.prototype.toString,ys="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===bs.call(Blob),xs="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===bs.call(File);function ws(e){return vs&&(e instanceof ArrayBuffer||(e=>"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer)(e))||ys&&e instanceof Blob||xs&&e instanceof File}function Ss(e,t){if(!e||"object"!==typeof e)return!1;if(Array.isArray(e)){for(let t=0,n=e.length;t<n;t++)if(Ss(e[t]))return!0;return!1}if(ws(e))return!0;if(e.toJSON&&"function"===typeof e.toJSON&&1===arguments.length)return Ss(e.toJSON(),!0);for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&Ss(e[n]))return!0;return!1}function Cs(e){const t=[],n=e.data,r=e;return r.data=Ms(n,t),r.attachments=t.length,{packet:r,buffers:t}}function Ms(e,t){if(!e)return e;if(ws(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}if(Array.isArray(e)){const n=new Array(e.length);for(let r=0;r<e.length;r++)n[r]=Ms(e[r],t);return n}if("object"===typeof e&&!(e instanceof Date)){const n={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=Ms(e[r],t));return n}return e}function _s(e,t){return e.data=Es(e.data,t),delete e.attachments,e}function Es(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"===typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=Es(e[n],t);else if("object"===typeof e)for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=Es(e[n],t));return e}const Ts=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Is=5;var ks;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(ks||(ks={}));class Ns{constructor(e){this.replacer=e}encode(e){return e.type!==ks.EVENT&&e.type!==ks.ACK||!Ss(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===ks.EVENT?ks.BINARY_EVENT:ks.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==ks.BINARY_EVENT&&e.type!==ks.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=Cs(e),n=this.encodeAsString(t.packet),r=t.buffers;return r.unshift(n),r}}function Ls(e){return"[object Object]"===Object.prototype.toString.call(e)}class As extends Uo{constructor(e){super(),this.reviver=e}add(e){let t;if("string"===typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const n=t.type===ks.BINARY_EVENT;n||t.type===ks.BINARY_ACK?(t.type=n?ks.EVENT:ks.ACK,this.reconstructor=new Rs(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!ws(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(void 0===ks[n.type])throw new Error("unknown packet type "+n.type);if(n.type===ks.BINARY_EVENT||n.type===ks.BINARY_ACK){const r=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const a=e.substring(r,t);if(a!=Number(a)||"-"!==e.charAt(t))throw new Error("Illegal attachments");n.attachments=Number(a)}if("/"===e.charAt(t+1)){const r=t+1;for(;++t;){if(","===e.charAt(t))break;if(t===e.length)break}n.nsp=e.substring(r,t)}else n.nsp="/";const r=e.charAt(t+1);if(""!==r&&Number(r)==r){const r=t+1;for(;++t;){const n=e.charAt(t);if(null==n||Number(n)!=n){--t;break}if(t===e.length)break}n.id=Number(e.substring(r,t+1))}if(e.charAt(++t)){const r=this.tryParse(e.substr(t));if(!As.isPayloadValid(n.type,r))throw new Error("invalid payload");n.data=r}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(IQ){return!1}}static isPayloadValid(e,t){switch(e){case ks.CONNECT:return Ls(t);case ks.DISCONNECT:return void 0===t;case ks.CONNECT_ERROR:return"string"===typeof t||Ls(t);case ks.EVENT:case ks.BINARY_EVENT:return Array.isArray(t)&&("number"===typeof t[0]||"string"===typeof t[0]&&-1===Ts.indexOf(t[0]));case ks.ACK:case ks.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Rs{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=_s(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function Ds(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const Os=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Ps extends Uo{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Ds(e,"open",this.onopen.bind(this)),Ds(e,"packet",this.onpacket.bind(this)),Ds(e,"error",this.onerror.bind(this)),Ds(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.unshift("message"),this.emit.apply(this,t),this}emit(e){if(Os.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(n.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const a={type:ks.EVENT,data:n,options:{}};if(a.options.compress=!1!==this.flags.compress,"function"===typeof n[n.length-1]){const e=this.ids++,t=n.pop();this._registerAckCallback(e,t),a.id=e}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(a),this.packet(a)):this.sendBuffer.push(a)),this.flags={},this}_registerAckCallback(e,t){var n,r=this;const a=null!==(n=this.flags.timeout)&&void 0!==n?n:this._opts.ackTimeout;if(void 0===a)return void(this.acks[e]=t);const i=this.io.setTimeoutFn((()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,new Error("operation has timed out"))}),a);this.acks[e]=function(){r.io.clearTimeoutFn(i);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];t.apply(r,[null,...n])}}emitWithAck(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const a=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise(((t,r)=>{n.push(((e,n)=>a?e?r(e):t(n):t(e))),this.emit(e,...n)}))}_addToQueue(e){var t=this;let n;"function"===typeof e[e.length-1]&&(n=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((function(e){if(r!==t._queue[0])return;if(null!==e)r.tryCount>t._opts.retries&&(t._queue.shift(),n&&n(e));else if(t._queue.shift(),n){for(var a=arguments.length,i=new Array(a>1?a-1:0),o=1;o<a;o++)i[o-1]=arguments[o];n(null,...i)}return r.pending=!1,t._drainQueue()})),this._queue.push(r),this._drainQueue()}_drainQueue(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.connected||0===this._queue.length)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth((e=>{this._sendConnectPacket(e)})):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:ks.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case ks.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case ks.EVENT:case ks.BINARY_EVENT:this.onevent(e);break;case ks.ACK:case ks.BINARY_ACK:this.onack(e);break;case ks.DISCONNECT:this.ondisconnect();break;case ks.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"===typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let n=!1;return function(){if(!n){n=!0;for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];t.packet({type:ks.ACK,id:e,data:a})}}}onack(e){const t=this.acks[e.id];"function"===typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach((e=>this.emitEvent(e))),this.receiveBuffer=[],this.sendBuffer.forEach((e=>{this.notifyOutgoingListeners(e),this.packet(e)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((e=>e())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:ks.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function Fs(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Fs.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},Fs.prototype.reset=function(){this.attempts=0},Fs.prototype.setMin=function(e){this.ms=e},Fs.prototype.setMax=function(e){this.max=e},Fs.prototype.setJitter=function(e){this.jitter=e};class zs extends Uo{constructor(t,n){var r;super(),this.nsps={},this.subs=[],t&&"object"===typeof t&&(n=t,t=void 0),(n=n||{}).path=n.path||"/socket.io",this.opts=n,Yo(this,n),this.reconnection(!1!==n.reconnection),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(r=n.randomizationFactor)&&void 0!==r?r:.5),this.backoff=new Fs({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==n.timeout?2e4:n.timeout),this._readyState="closed",this.uri=t;const a=n.parser||e;this.encoder=new a.Encoder,this.decoder=new a.Decoder,this._autoConnect=!1!==n.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new ms(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const r=Ds(t,"open",(function(){n.onopen(),e&&e()})),a=t=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",t),e?e(t):this.maybeReconnectOnOpen()},i=Ds(t,"error",a);if(!1!==this._timeout){const e=this._timeout,n=this.setTimeoutFn((()=>{r(),a(new Error("timeout")),t.close()}),e);this.opts.autoUnref&&n.unref(),this.subs.push((()=>{this.clearTimeoutFn(n)}))}return this.subs.push(r),this.subs.push(i),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Ds(e,"ping",this.onping.bind(this)),Ds(e,"data",this.ondata.bind(this)),Ds(e,"error",this.onerror.bind(this)),Ds(e,"close",this.onclose.bind(this)),Ds(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(IQ){this.onclose("parse error",IQ)}}ondecoded(e){us((()=>{this.emitReserved("packet",e)}),this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new Ps(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const n of t){if(this.nsps[n].active)return}this._close()}_packet(e){const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach((e=>e())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn((()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open((t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()})))}),t);this.opts.autoUnref&&n.unref(),this.subs.push((()=>{this.clearTimeoutFn(n)}))}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const js={};function Bs(e,t){"object"===typeof e&&(t=e,e=void 0);const n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,r=e;n=n||"undefined"!==typeof location&&location,null==e&&(e=n.protocol+"//"+n.host),"string"===typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(e="undefined"!==typeof n?n.protocol+"//"+e:"https://"+e),r=gs(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const a=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+a+":"+r.port+t,r.href=r.protocol+"://"+a+(n&&n.port===r.port?"":":"+r.port),r}(e,(t=t||{}).path||"/socket.io"),r=n.source,a=n.id,i=n.path,o=js[a]&&i in js[a].nsps;let s;return t.forceNew||t["force new connection"]||!1===t.multiplex||o?s=new zs(r,t):(js[a]||(js[a]=new zs(r,t)),s=js[a]),n.query&&!t.query&&(t.query=n.queryKey),s.socket(n.path,t)}Object.assign(Bs,{Manager:zs,Socket:Ps,io:Bs,connect:Bs});var Us=n(6593),Ws=n.n(Us);function Gs(e){return[].concat(e)}function Vs(e){return e.startsWith(":")}function Hs(e){return Ks(e)&&("*"===e||e.length>1&&":>~.+*".includes(e.slice(0,1))||Qs(e))}function Ys(e,t){return(Ks(t)||"number"===typeof t)&&!qs(e)&&!Vs(e)&&!Xs(e)}function Xs(e){return e.startsWith("@media")}function qs(e){return"--"===e}function Ks(e){return e+""===e}function Qs(e){return Ks(e)&&(e.startsWith("&")||Vs(e))}function Js(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.filter(Boolean).join(t)}function Zs(e,t){let n=0;if(0===t.length)return n.toString();for(let r=0;r<t.length;r++){n=(n<<5)-n+t.charCodeAt(r),n|=0}return"".concat(null!==e&&void 0!==e?e:"cl","_").concat(n.toString(36))}function $s(e,t){return"".concat(e,":").concat(t)}var ec=class e{constructor(e,t,n,r){this.sheet=e,this.property=t,this.value=n,this.selector=r,this.property=t,this.value=n,this.joined=$s(t,n);const a=this.selector.preconditions.concat(this.selector.postconditions);this.hash=this.selector.hasConditions?this.selector.scopeClassName:Zs(this.sheet.name,this.joined),this.key=Js([this.joined,a,this.hash])}toString(){let t=tc(this.selector.preconditions,{right:this.hash});return t=tc(this.selector.postconditions,{left:t}),"".concat(t," {").concat(e.genRule(this.property,this.value),"}")}static genRule(e,t){return $s(e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),function(e,t){return"content"===e?'"'.concat(t,'"'):t}(e,t))+";"}};function tc(e){let{left:t="",right:n=""}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=e.reduce(((e,t)=>Vs(t)?e+t:Qs(t)?e+t.slice(1):Js([e,t]," ")),t);return Js([r,(a=n,a?".".concat(a):"")]," ");var a}var nc,rc=class e{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,{preconditions:n,postconditions:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.sheet=e,this.preconditions=[],this.scopeClassName=null,this.scopeName=null,this.postconditions=[],this.preconditions=n?Gs(n):[],this.postconditions=r?Gs(r):[],this.setScope(t)}setScope(e){return e?(this.scopeClassName||(this.scopeName=e,this.scopeClassName=Zs(this.sheet.name,e+this.sheet.count)),this):this}get hasConditions(){return this.preconditions.length>0||this.postconditions.length>0}addScope(t){return new e(this.sheet,t,{preconditions:this.preconditions,postconditions:this.postconditions})}addPrecondition(t){return new e(this.sheet,this.scopeClassName,{postconditions:this.postconditions,preconditions:this.preconditions.concat(t)})}addPostcondition(t){return new e(this.sheet,this.scopeClassName,{preconditions:this.preconditions,postconditions:this.postconditions.concat(t)})}createRule(e,t){return new ec(this.sheet,e,t,this)}},ac=class{constructor(e,t){this.name=e,this.rootNode=t,this.storedStyles={},this.storedClasses={},this.style="",this.count=0,this.id="flairup-".concat(e),this.styleTag=this.createStyleTag()}getStyle(){return this.style}append(e){this.style=function(e,t){return e?"".concat(e,"\n").concat(t):t}(this.style,e)}apply(){this.count++,this.styleTag&&(this.styleTag.innerHTML=this.style)}isApplied(){return!!this.styleTag}createStyleTag(){var e;if("undefined"===typeof document||this.isApplied()||null===this.rootNode)return this.styleTag;const t=document.createElement("style");return t.type="text/css",t.id=this.id,(null!==(e=this.rootNode)&&void 0!==e?e:document.head).appendChild(t),t}addRule(e){const t=this.storedClasses[e.key];return Ks(t)?t:(this.storedClasses[e.key]=e.hash,this.storedStyles[e.hash]=[e.property,e.value],this.append(e.toString()),e.hash)}};function ic(e,t){for(const n in e)t(n.trim(),e[n])}function oc(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=t.reduce(((e,t)=>(t instanceof Set?e.push(...t):"string"===typeof t?e.push(t):Array.isArray(t)?e.push(oc(...t)):"object"===typeof t&&Object.entries(t).forEach((t=>{let[n,r]=t;r&&e.push(n)})),e)),[]);return Js(r," ").trim()}function sc(e,t){const n=new ac(e,t);return{create:function(e){const t={};return cc(n,e,new rc(n)).forEach((e=>{let[r,a,i]=e;uc(n,a,i).forEach((e=>{!function(e,n){var r;t[e]=null!==(r=t[e])&&void 0!==r?r:new Set,t[e].add(n)}(r,e)}))})),n.apply(),t},getStyle:n.getStyle.bind(n),isApplied:n.isApplied.bind(n)}}function cc(e,t,n){const r=[];return ic(t,((a,i)=>{if(Hs(a))return cc(e,i,n.addPrecondition(a)).forEach((e=>r.push(e)));r.push([a,t[a],n.addScope(a)])})),r}function uc(e,t,n){const r=new Set;return ic(t,((t,a)=>{let i=[];if(Hs(t))i=uc(e,a,n.addPostcondition(t));else if(function(e){return"."===e}(t))i=Gs(a);else if(Xs(t))i=function(e,t,n,r){e.append(n+" {");const a=uc(e,t,r);return e.append("}"),a}(e,a,t,n);else if(qs(t))i=function(e,t,n){const r=new Set,a=[];if(ic(t,((t,i)=>{if(Ys(t,i))return void a.push(ec.genRule(t,i));lc(uc(e,null!==i&&void 0!==i?i:{},n),r)})),!n.scopeClassName)return r;if(a.length){const t=a.join(" ");e.append("".concat(tc(n.preconditions,{right:n.scopeClassName})," {").concat(t,"}"))}return r.add(n.scopeClassName),r}(e,a,n);else if(Ys(t,a)){const i=n.createRule(t,a);e.addRule(i),r.add(i.hash)}return lc(i,r)})),r}function lc(e,t){return e.forEach((e=>t.add(e))),t}function fc(){return fc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},fc.apply(this,arguments)}function dc(e,t){return dc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},dc(e,t)}function hc(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}function pc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function gc(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"===typeof e)return pc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?pc(e,t):void 0}}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function mc(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.map((function(e){return"."+e})).join("")}!function(e){e.hiddenOnSearch="epr-hidden-on-search",e.searchActive="epr-search-active",e.hidden="epr-hidden",e.visible="epr-visible",e.active="epr-active",e.emoji="epr-emoji",e.category="epr-emoji-category",e.label="epr-emoji-category-label",e.categoryContent="epr-emoji-category-content",e.emojiHasVariations="epr-emoji-has-variations",e.scrollBody="epr-body",e.emojiList="epr-emoji-list",e.external="__EmojiPicker__",e.emojiPicker="EmojiPickerReact",e.open="epr-open",e.vertical="epr-vertical",e.horizontal="epr-horizontal",e.variationPicker="epr-emoji-variation-picker",e.darkTheme="epr-dark-theme",e.autoTheme="epr-auto-theme"}(nc||(nc={}));var vc=sc("epr",null),bc={display:"none",opacity:"0",pointerEvents:"none",visibility:"hidden",overflow:"hidden"},yc=vc.create({hidden:fc({".":nc.hidden},bc)}),xc=(0,o.memo)((function(){return(0,o.createElement)("style",{suppressHydrationWarning:!0,dangerouslySetInnerHTML:{__html:vc.getStyle()}})})),wc=vc.create({".epr-main":{":has(input:not(:placeholder-shown))":{categoryBtn:{":hover":{opacity:"1",backgroundPositionY:"var(--epr-category-navigation-button-size)"}},hiddenOnSearch:fc({".":nc.hiddenOnSearch},bc)},":has(input(:placeholder-shown))":{visibleOnSearchOnly:bc}},hiddenOnReactions:{transition:"all 0.5s ease-in-out"},".epr-reactions":{hiddenOnReactions:{height:"0px",width:"0px",opacity:"0",pointerEvents:"none",overflow:"hidden"}},".EmojiPickerReact:not(.epr-search-active)":{categoryBtn:{":hover":{opacity:"1",backgroundPositionY:"var(--epr-category-navigation-button-size)"},"&.epr-active":{opacity:"1",backgroundPositionY:"var(--epr-category-navigation-button-size)"}},visibleOnSearchOnly:fc({".":"epr-visible-on-search-only"},bc)}});function Sc(e,t){var n,r;return{".epr-dark-theme":(n={},n[e]=t,n),".epr-auto-theme":(r={},r[e]={"@media (prefers-color-scheme: dark)":t},r)}}function Cc(e,t){var n,r,a=null!=(n=e.customEmojis)?n:[],i=null!=(r=t.customEmojis)?r:[];return e.open===t.open&&e.emojiVersion===t.emojiVersion&&e.reactionsDefaultOpen===t.reactionsDefaultOpen&&e.searchPlaceHolder===t.searchPlaceHolder&&e.searchPlaceholder===t.searchPlaceholder&&e.defaultSkinTone===t.defaultSkinTone&&e.skinTonesDisabled===t.skinTonesDisabled&&e.autoFocusSearch===t.autoFocusSearch&&e.emojiStyle===t.emojiStyle&&e.theme===t.theme&&e.suggestedEmojisMode===t.suggestedEmojisMode&&e.lazyLoadEmojis===t.lazyLoadEmojis&&e.className===t.className&&e.height===t.height&&e.width===t.width&&e.style===t.style&&e.searchDisabled===t.searchDisabled&&e.skinTonePickerLocation===t.skinTonePickerLocation&&a.length===i.length}var Mc,_c,Ec,Tc,Ic,kc,Nc,Lc=["1f44d","2764-fe0f","1f603","1f622","1f64f","1f44e","1f621"];!function(e){e.RECENT="recent",e.FREQUENT="frequent"}(Mc||(Mc={})),function(e){e.NATIVE="native",e.APPLE="apple",e.TWITTER="twitter",e.GOOGLE="google",e.FACEBOOK="facebook"}(_c||(_c={})),function(e){e.DARK="dark",e.LIGHT="light",e.AUTO="auto"}(Ec||(Ec={})),function(e){e.NEUTRAL="neutral",e.LIGHT="1f3fb",e.MEDIUM_LIGHT="1f3fc",e.MEDIUM="1f3fd",e.MEDIUM_DARK="1f3fe",e.DARK="1f3ff"}(Tc||(Tc={})),function(e){e.SUGGESTED="suggested",e.CUSTOM="custom",e.SMILEYS_PEOPLE="smileys_people",e.ANIMALS_NATURE="animals_nature",e.FOOD_DRINK="food_drink",e.TRAVEL_PLACES="travel_places",e.ACTIVITIES="activities",e.OBJECTS="objects",e.SYMBOLS="symbols",e.FLAGS="flags"}(Ic||(Ic={})),function(e){e.SEARCH="SEARCH",e.PREVIEW="PREVIEW"}(kc||(kc={}));var Ac=[Ic.SUGGESTED,Ic.CUSTOM,Ic.SMILEYS_PEOPLE,Ic.ANIMALS_NATURE,Ic.FOOD_DRINK,Ic.TRAVEL_PLACES,Ic.ACTIVITIES,Ic.OBJECTS,Ic.SYMBOLS,Ic.FLAGS],Rc={name:"Recently Used",category:Ic.SUGGESTED},Dc=((Nc={})[Ic.SUGGESTED]={category:Ic.SUGGESTED,name:"Frequently Used"},Nc[Ic.CUSTOM]={category:Ic.CUSTOM,name:"Custom Emojis"},Nc[Ic.SMILEYS_PEOPLE]={category:Ic.SMILEYS_PEOPLE,name:"Smileys & People"},Nc[Ic.ANIMALS_NATURE]={category:Ic.ANIMALS_NATURE,name:"Animals & Nature"},Nc[Ic.FOOD_DRINK]={category:Ic.FOOD_DRINK,name:"Food & Drink"},Nc[Ic.TRAVEL_PLACES]={category:Ic.TRAVEL_PLACES,name:"Travel & Places"},Nc[Ic.ACTIVITIES]={category:Ic.ACTIVITIES,name:"Activities"},Nc[Ic.OBJECTS]={category:Ic.OBJECTS,name:"Objects"},Nc[Ic.SYMBOLS]={category:Ic.SYMBOLS,name:"Symbols"},Nc[Ic.FLAGS]={category:Ic.FLAGS,name:"Flags"},Nc);function Oc(e){return Ac.map((function(t){return fc({},Dc[t],e&&e[t]&&e[t])}))}function Pc(e){return e.category}function Fc(e){return e.name}function zc(e,t){return void 0===t&&(t={}),Object.assign(Dc[e],t)}var jc,Bc={custom:[],smileys_people:[{n:["grinning","grinning face"],u:"1f600",a:"1.0"},{n:["smiley","smiling face with open mouth"],u:"1f603",a:"0.6"},{n:["smile","smiling face with open mouth and smiling eyes"],u:"1f604",a:"0.6"},{n:["grin","grinning face with smiling eyes"],u:"1f601",a:"0.6"},{n:["laughing","satisfied","smiling face with open mouth and tightly-closed eyes"],u:"1f606",a:"0.6"},{n:["sweat smile","smiling face with open mouth and cold sweat"],u:"1f605",a:"0.6"},{n:["rolling on the floor laughing"],u:"1f923",a:"3.0"},{n:["joy","face with tears of joy"],u:"1f602",a:"0.6"},{n:["slightly smiling face"],u:"1f642",a:"1.0"},{n:["upside-down face","upside down face"],u:"1f643",a:"1.0"},{n:["melting face"],u:"1fae0",a:"14.0"},{n:["wink","winking face"],u:"1f609",a:"0.6"},{n:["blush","smiling face with smiling eyes"],u:"1f60a",a:"0.6"},{n:["innocent","smiling face with halo"],u:"1f607",a:"1.0"},{n:["smiling face with 3 hearts","smiling face with smiling eyes and three hearts"],u:"1f970",a:"11.0"},{n:["heart eyes","smiling face with heart-shaped eyes"],u:"1f60d",a:"0.6"},{n:["star-struck","grinning face with star eyes"],u:"1f929",a:"5.0"},{n:["kissing heart","face throwing a kiss"],u:"1f618",a:"0.6"},{n:["kissing","kissing face"],u:"1f617",a:"1.0"},{n:["relaxed","white smiling face"],u:"263a-fe0f",a:"0.6"},{n:["kissing closed eyes","kissing face with closed eyes"],u:"1f61a",a:"0.6"},{n:["kissing smiling eyes","kissing face with smiling eyes"],u:"1f619",a:"1.0"},{n:["smiling face with tear"],u:"1f972",a:"13.0"},{n:["yum","face savouring delicious food"],u:"1f60b",a:"0.6"},{n:["stuck out tongue","face with stuck-out tongue"],u:"1f61b",a:"1.0"},{n:["stuck out tongue winking eye","face with stuck-out tongue and winking eye"],u:"1f61c",a:"0.6"},{n:["zany face","grinning face with one large and one small eye"],u:"1f92a",a:"5.0"},{n:["stuck out tongue closed eyes","face with stuck-out tongue and tightly-closed eyes"],u:"1f61d",a:"0.6"},{n:["money-mouth face","money mouth face"],u:"1f911",a:"1.0"},{n:["hugging face"],u:"1f917",a:"1.0"},{n:["face with hand over mouth","smiling face with smiling eyes and hand covering mouth"],u:"1f92d",a:"5.0"},{n:["face with open eyes and hand over mouth"],u:"1fae2",a:"14.0"},{n:["face with peeking eye"],u:"1fae3",a:"14.0"},{n:["shushing face","face with finger covering closed lips"],u:"1f92b",a:"5.0"},{n:["thinking face"],u:"1f914",a:"1.0"},{n:["saluting face"],u:"1fae1",a:"14.0"},{n:["zipper-mouth face","zipper mouth face"],u:"1f910",a:"1.0"},{n:["face with raised eyebrow","face with one eyebrow raised"],u:"1f928",a:"5.0"},{n:["neutral face"],u:"1f610",a:"0.7"},{n:["expressionless","expressionless face"],u:"1f611",a:"1.0"},{n:["no mouth","face without mouth"],u:"1f636",a:"1.0"},{n:["dotted line face"],u:"1fae5",a:"14.0"},{n:["face in clouds"],u:"1f636-200d-1f32b-fe0f",a:"13.1"},{n:["smirk","smirking face"],u:"1f60f",a:"0.6"},{n:["unamused","unamused face"],u:"1f612",a:"0.6"},{n:["face with rolling eyes"],u:"1f644",a:"1.0"},{n:["grimacing","grimacing face"],u:"1f62c",a:"1.0"},{n:["face exhaling"],u:"1f62e-200d-1f4a8",a:"13.1"},{n:["lying face"],u:"1f925",a:"3.0"},{n:["relieved","relieved face"],u:"1f60c",a:"0.6"},{n:["pensive","pensive face"],u:"1f614",a:"0.6"},{n:["sleepy","sleepy face"],u:"1f62a",a:"0.6"},{n:["drooling face"],u:"1f924",a:"3.0"},{n:["sleeping","sleeping face"],u:"1f634",a:"1.0"},{n:["mask","face with medical mask"],u:"1f637",a:"0.6"},{n:["face with thermometer"],u:"1f912",a:"1.0"},{n:["face with head-bandage","face with head bandage"],u:"1f915",a:"1.0"},{n:["nauseated face"],u:"1f922",a:"3.0"},{n:["face vomiting","face with open mouth vomiting"],u:"1f92e",a:"5.0"},{n:["sneezing face"],u:"1f927",a:"3.0"},{n:["hot face","overheated face"],u:"1f975",a:"11.0"},{n:["cold face","freezing face"],u:"1f976",a:"11.0"},{n:["woozy face","face with uneven eyes and wavy mouth"],u:"1f974",a:"11.0"},{n:["dizzy face"],u:"1f635",a:"0.6"},{n:["face with spiral eyes"],u:"1f635-200d-1f4ab",a:"13.1"},{n:["exploding head","shocked face with exploding head"],u:"1f92f",a:"5.0"},{n:["face with cowboy hat"],u:"1f920",a:"3.0"},{n:["partying face","face with party horn and party hat"],u:"1f973",a:"11.0"},{n:["disguised face"],u:"1f978",a:"13.0"},{n:["sunglasses","smiling face with sunglasses"],u:"1f60e",a:"1.0"},{n:["nerd face"],u:"1f913",a:"1.0"},{n:["face with monocle"],u:"1f9d0",a:"5.0"},{n:["confused","confused face"],u:"1f615",a:"1.0"},{n:["face with diagonal mouth"],u:"1fae4",a:"14.0"},{n:["worried","worried face"],u:"1f61f",a:"1.0"},{n:["slightly frowning face"],u:"1f641",a:"1.0"},{n:["frowning face","white frowning face"],u:"2639-fe0f",a:"0.7"},{n:["open mouth","face with open mouth"],u:"1f62e",a:"1.0"},{n:["hushed","hushed face"],u:"1f62f",a:"1.0"},{n:["astonished","astonished face"],u:"1f632",a:"0.6"},{n:["flushed","flushed face"],u:"1f633",a:"0.6"},{n:["pleading face","face with pleading eyes"],u:"1f97a",a:"11.0"},{n:["face holding back tears"],u:"1f979",a:"14.0"},{n:["frowning","frowning face with open mouth"],u:"1f626",a:"1.0"},{n:["anguished","anguished face"],u:"1f627",a:"1.0"},{n:["fearful","fearful face"],u:"1f628",a:"0.6"},{n:["cold sweat","face with open mouth and cold sweat"],u:"1f630",a:"0.6"},{n:["disappointed relieved","disappointed but relieved face"],u:"1f625",a:"0.6"},{n:["cry","crying face"],u:"1f622",a:"0.6"},{n:["sob","loudly crying face"],u:"1f62d",a:"0.6"},{n:["scream","face screaming in fear"],u:"1f631",a:"0.6"},{n:["confounded","confounded face"],u:"1f616",a:"0.6"},{n:["persevere","persevering face"],u:"1f623",a:"0.6"},{n:["disappointed","disappointed face"],u:"1f61e",a:"0.6"},{n:["sweat","face with cold sweat"],u:"1f613",a:"0.6"},{n:["weary","weary face"],u:"1f629",a:"0.6"},{n:["tired face"],u:"1f62b",a:"0.6"},{n:["yawning face"],u:"1f971",a:"12.0"},{n:["triumph","face with look of triumph"],u:"1f624",a:"0.6"},{n:["rage","pouting face"],u:"1f621",a:"0.6"},{n:["angry","angry face"],u:"1f620",a:"0.6"},{n:["face with symbols on mouth","serious face with symbols covering mouth"],u:"1f92c",a:"5.0"},{n:["smiling imp","smiling face with horns"],u:"1f608",a:"1.0"},{n:["imp"],u:"1f47f",a:"0.6"},{n:["skull"],u:"1f480",a:"0.6"},{n:["skull and crossbones"],u:"2620-fe0f",a:"1.0"},{n:["poop","shit","hankey","pile of poo"],u:"1f4a9",a:"0.6"},{n:["clown face"],u:"1f921",a:"3.0"},{n:["japanese ogre"],u:"1f479",a:"0.6"},{n:["japanese goblin"],u:"1f47a",a:"0.6"},{n:["ghost"],u:"1f47b",a:"0.6"},{n:["alien","extraterrestrial alien"],u:"1f47d",a:"0.6"},{n:["alien monster","space invader"],u:"1f47e",a:"0.6"},{n:["robot face"],u:"1f916",a:"1.0"},{n:["smiley cat","smiling cat face with open mouth"],u:"1f63a",a:"0.6"},{n:["smile cat","grinning cat face with smiling eyes"],u:"1f638",a:"0.6"},{n:["joy cat","cat face with tears of joy"],u:"1f639",a:"0.6"},{n:["heart eyes cat","smiling cat face with heart-shaped eyes"],u:"1f63b",a:"0.6"},{n:["smirk cat","cat face with wry smile"],u:"1f63c",a:"0.6"},{n:["kissing cat","kissing cat face with closed eyes"],u:"1f63d",a:"0.6"},{n:["scream cat","weary cat face"],u:"1f640",a:"0.6"},{n:["crying cat face"],u:"1f63f",a:"0.6"},{n:["pouting cat","pouting cat face"],u:"1f63e",a:"0.6"},{n:["see no evil","see-no-evil monkey"],u:"1f648",a:"0.6"},{n:["hear no evil","hear-no-evil monkey"],u:"1f649",a:"0.6"},{n:["speak no evil","speak-no-evil monkey"],u:"1f64a",a:"0.6"},{n:["kiss","kiss mark"],u:"1f48b",a:"0.6"},{n:["love letter"],u:"1f48c",a:"0.6"},{n:["cupid","heart with arrow"],u:"1f498",a:"0.6"},{n:["gift heart","heart with ribbon"],u:"1f49d",a:"0.6"},{n:["sparkling heart"],u:"1f496",a:"0.6"},{n:["heartpulse","growing heart"],u:"1f497",a:"0.6"},{n:["heartbeat","beating heart"],u:"1f493",a:"0.6"},{n:["revolving hearts"],u:"1f49e",a:"0.6"},{n:["two hearts"],u:"1f495",a:"0.6"},{n:["heart decoration"],u:"1f49f",a:"0.6"},{n:["heart exclamation","heavy heart exclamation mark ornament"],u:"2763-fe0f",a:"1.0"},{n:["broken heart"],u:"1f494",a:"0.6"},{n:["heart on fire"],u:"2764-fe0f-200d-1f525",a:"13.1"},{n:["mending heart"],u:"2764-fe0f-200d-1fa79",a:"13.1"},{n:["heart","heavy black heart"],u:"2764-fe0f",a:"0.6"},{n:["orange heart"],u:"1f9e1",a:"5.0"},{n:["yellow heart"],u:"1f49b",a:"0.6"},{n:["green heart"],u:"1f49a",a:"0.6"},{n:["blue heart"],u:"1f499",a:"0.6"},{n:["purple heart"],u:"1f49c",a:"0.6"},{n:["brown heart"],u:"1f90e",a:"12.0"},{n:["black heart"],u:"1f5a4",a:"3.0"},{n:["white heart"],u:"1f90d",a:"12.0"},{n:["100","hundred points symbol"],u:"1f4af",a:"0.6"},{n:["anger","anger symbol"],u:"1f4a2",a:"0.6"},{n:["boom","collision","collision symbol"],u:"1f4a5",a:"0.6"},{n:["dizzy","dizzy symbol"],u:"1f4ab",a:"0.6"},{n:["sweat drops","splashing sweat symbol"],u:"1f4a6",a:"0.6"},{n:["dash","dash symbol"],u:"1f4a8",a:"0.6"},{n:["hole"],u:"1f573-fe0f",a:"0.7"},{n:["bomb"],u:"1f4a3",a:"0.6"},{n:["speech balloon"],u:"1f4ac",a:"0.6"},{n:["eye in speech bubble","eye-in-speech-bubble"],u:"1f441-fe0f-200d-1f5e8-fe0f",a:"2.0"},{n:["left speech bubble"],u:"1f5e8-fe0f",a:"2.0"},{n:["right anger bubble"],u:"1f5ef-fe0f",a:"0.7"},{n:["thought balloon"],u:"1f4ad",a:"1.0"},{n:["zzz","sleeping symbol"],u:"1f4a4",a:"0.6"},{n:["wave","waving hand sign"],u:"1f44b",v:["1f44b-1f3fb","1f44b-1f3fc","1f44b-1f3fd","1f44b-1f3fe","1f44b-1f3ff"],a:"0.6"},{n:["raised back of hand"],u:"1f91a",v:["1f91a-1f3fb","1f91a-1f3fc","1f91a-1f3fd","1f91a-1f3fe","1f91a-1f3ff"],a:"3.0"},{n:["hand with fingers splayed","raised hand with fingers splayed"],u:"1f590-fe0f",v:["1f590-1f3fb","1f590-1f3fc","1f590-1f3fd","1f590-1f3fe","1f590-1f3ff"],a:"0.7"},{n:["hand","raised hand"],u:"270b",v:["270b-1f3fb","270b-1f3fc","270b-1f3fd","270b-1f3fe","270b-1f3ff"],a:"0.6"},{n:["spock-hand","raised hand with part between middle and ring fingers"],u:"1f596",v:["1f596-1f3fb","1f596-1f3fc","1f596-1f3fd","1f596-1f3fe","1f596-1f3ff"],a:"1.0"},{n:["rightwards hand"],u:"1faf1",v:["1faf1-1f3fb","1faf1-1f3fc","1faf1-1f3fd","1faf1-1f3fe","1faf1-1f3ff"],a:"14.0"},{n:["leftwards hand"],u:"1faf2",v:["1faf2-1f3fb","1faf2-1f3fc","1faf2-1f3fd","1faf2-1f3fe","1faf2-1f3ff"],a:"14.0"},{n:["palm down hand"],u:"1faf3",v:["1faf3-1f3fb","1faf3-1f3fc","1faf3-1f3fd","1faf3-1f3fe","1faf3-1f3ff"],a:"14.0"},{n:["palm up hand"],u:"1faf4",v:["1faf4-1f3fb","1faf4-1f3fc","1faf4-1f3fd","1faf4-1f3fe","1faf4-1f3ff"],a:"14.0"},{n:["ok hand","ok hand sign"],u:"1f44c",v:["1f44c-1f3fb","1f44c-1f3fc","1f44c-1f3fd","1f44c-1f3fe","1f44c-1f3ff"],a:"0.6"},{n:["pinched fingers"],u:"1f90c",v:["1f90c-1f3fb","1f90c-1f3fc","1f90c-1f3fd","1f90c-1f3fe","1f90c-1f3ff"],a:"13.0"},{n:["pinching hand"],u:"1f90f",v:["1f90f-1f3fb","1f90f-1f3fc","1f90f-1f3fd","1f90f-1f3fe","1f90f-1f3ff"],a:"12.0"},{n:["v","victory hand"],u:"270c-fe0f",v:["270c-1f3fb","270c-1f3fc","270c-1f3fd","270c-1f3fe","270c-1f3ff"],a:"0.6"},{n:["crossed fingers","hand with index and middle fingers crossed"],u:"1f91e",v:["1f91e-1f3fb","1f91e-1f3fc","1f91e-1f3fd","1f91e-1f3fe","1f91e-1f3ff"],a:"3.0"},{n:["hand with index finger and thumb crossed"],u:"1faf0",v:["1faf0-1f3fb","1faf0-1f3fc","1faf0-1f3fd","1faf0-1f3fe","1faf0-1f3ff"],a:"14.0"},{n:["i love you hand sign"],u:"1f91f",v:["1f91f-1f3fb","1f91f-1f3fc","1f91f-1f3fd","1f91f-1f3fe","1f91f-1f3ff"],a:"5.0"},{n:["the horns","sign of the horns"],u:"1f918",v:["1f918-1f3fb","1f918-1f3fc","1f918-1f3fd","1f918-1f3fe","1f918-1f3ff"],a:"1.0"},{n:["call me hand"],u:"1f919",v:["1f919-1f3fb","1f919-1f3fc","1f919-1f3fd","1f919-1f3fe","1f919-1f3ff"],a:"3.0"},{n:["point left","white left pointing backhand index"],u:"1f448",v:["1f448-1f3fb","1f448-1f3fc","1f448-1f3fd","1f448-1f3fe","1f448-1f3ff"],a:"0.6"},{n:["point right","white right pointing backhand index"],u:"1f449",v:["1f449-1f3fb","1f449-1f3fc","1f449-1f3fd","1f449-1f3fe","1f449-1f3ff"],a:"0.6"},{n:["point up 2","white up pointing backhand index"],u:"1f446",v:["1f446-1f3fb","1f446-1f3fc","1f446-1f3fd","1f446-1f3fe","1f446-1f3ff"],a:"0.6"},{n:["middle finger","reversed hand with middle finger extended"],u:"1f595",v:["1f595-1f3fb","1f595-1f3fc","1f595-1f3fd","1f595-1f3fe","1f595-1f3ff"],a:"1.0"},{n:["point down","white down pointing backhand index"],u:"1f447",v:["1f447-1f3fb","1f447-1f3fc","1f447-1f3fd","1f447-1f3fe","1f447-1f3ff"],a:"0.6"},{n:["point up","white up pointing index"],u:"261d-fe0f",v:["261d-1f3fb","261d-1f3fc","261d-1f3fd","261d-1f3fe","261d-1f3ff"],a:"0.6"},{n:["index pointing at the viewer"],u:"1faf5",v:["1faf5-1f3fb","1faf5-1f3fc","1faf5-1f3fd","1faf5-1f3fe","1faf5-1f3ff"],a:"14.0"},{n:["+1","thumbsup","thumbs up sign"],u:"1f44d",v:["1f44d-1f3fb","1f44d-1f3fc","1f44d-1f3fd","1f44d-1f3fe","1f44d-1f3ff"],a:"0.6"},{n:["-1","thumbsdown","thumbs down sign"],u:"1f44e",v:["1f44e-1f3fb","1f44e-1f3fc","1f44e-1f3fd","1f44e-1f3fe","1f44e-1f3ff"],a:"0.6"},{n:["fist","raised fist"],u:"270a",v:["270a-1f3fb","270a-1f3fc","270a-1f3fd","270a-1f3fe","270a-1f3ff"],a:"0.6"},{n:["punch","facepunch","fisted hand sign"],u:"1f44a",v:["1f44a-1f3fb","1f44a-1f3fc","1f44a-1f3fd","1f44a-1f3fe","1f44a-1f3ff"],a:"0.6"},{n:["left-facing fist"],u:"1f91b",v:["1f91b-1f3fb","1f91b-1f3fc","1f91b-1f3fd","1f91b-1f3fe","1f91b-1f3ff"],a:"3.0"},{n:["right-facing fist"],u:"1f91c",v:["1f91c-1f3fb","1f91c-1f3fc","1f91c-1f3fd","1f91c-1f3fe","1f91c-1f3ff"],a:"3.0"},{n:["clap","clapping hands sign"],u:"1f44f",v:["1f44f-1f3fb","1f44f-1f3fc","1f44f-1f3fd","1f44f-1f3fe","1f44f-1f3ff"],a:"0.6"},{n:["raised hands","person raising both hands in celebration"],u:"1f64c",v:["1f64c-1f3fb","1f64c-1f3fc","1f64c-1f3fd","1f64c-1f3fe","1f64c-1f3ff"],a:"0.6"},{n:["heart hands"],u:"1faf6",v:["1faf6-1f3fb","1faf6-1f3fc","1faf6-1f3fd","1faf6-1f3fe","1faf6-1f3ff"],a:"14.0"},{n:["open hands","open hands sign"],u:"1f450",v:["1f450-1f3fb","1f450-1f3fc","1f450-1f3fd","1f450-1f3fe","1f450-1f3ff"],a:"0.6"},{n:["palms up together"],u:"1f932",v:["1f932-1f3fb","1f932-1f3fc","1f932-1f3fd","1f932-1f3fe","1f932-1f3ff"],a:"5.0"},{n:["handshake"],u:"1f91d",v:["1f91d-1f3fb","1f91d-1f3fc","1f91d-1f3fd","1f91d-1f3fe","1f91d-1f3ff","1faf1-1f3fb-200d-1faf2-1f3fc","1faf1-1f3fb-200d-1faf2-1f3fd","1faf1-1f3fb-200d-1faf2-1f3fe","1faf1-1f3fb-200d-1faf2-1f3ff","1faf1-1f3fc-200d-1faf2-1f3fb","1faf1-1f3fc-200d-1faf2-1f3fd","1faf1-1f3fc-200d-1faf2-1f3fe","1faf1-1f3fc-200d-1faf2-1f3ff","1faf1-1f3fd-200d-1faf2-1f3fb","1faf1-1f3fd-200d-1faf2-1f3fc","1faf1-1f3fd-200d-1faf2-1f3fe","1faf1-1f3fd-200d-1faf2-1f3ff","1faf1-1f3fe-200d-1faf2-1f3fb","1faf1-1f3fe-200d-1faf2-1f3fc","1faf1-1f3fe-200d-1faf2-1f3fd","1faf1-1f3fe-200d-1faf2-1f3ff","1faf1-1f3ff-200d-1faf2-1f3fb","1faf1-1f3ff-200d-1faf2-1f3fc","1faf1-1f3ff-200d-1faf2-1f3fd","1faf1-1f3ff-200d-1faf2-1f3fe"],a:"3.0"},{n:["pray","person with folded hands"],u:"1f64f",v:["1f64f-1f3fb","1f64f-1f3fc","1f64f-1f3fd","1f64f-1f3fe","1f64f-1f3ff"],a:"0.6"},{n:["writing hand"],u:"270d-fe0f",v:["270d-1f3fb","270d-1f3fc","270d-1f3fd","270d-1f3fe","270d-1f3ff"],a:"0.7"},{n:["nail care","nail polish"],u:"1f485",v:["1f485-1f3fb","1f485-1f3fc","1f485-1f3fd","1f485-1f3fe","1f485-1f3ff"],a:"0.6"},{n:["selfie"],u:"1f933",v:["1f933-1f3fb","1f933-1f3fc","1f933-1f3fd","1f933-1f3fe","1f933-1f3ff"],a:"3.0"},{n:["muscle","flexed biceps"],u:"1f4aa",v:["1f4aa-1f3fb","1f4aa-1f3fc","1f4aa-1f3fd","1f4aa-1f3fe","1f4aa-1f3ff"],a:"0.6"},{n:["mechanical arm"],u:"1f9be",a:"12.0"},{n:["mechanical leg"],u:"1f9bf",a:"12.0"},{n:["leg"],u:"1f9b5",v:["1f9b5-1f3fb","1f9b5-1f3fc","1f9b5-1f3fd","1f9b5-1f3fe","1f9b5-1f3ff"],a:"11.0"},{n:["foot"],u:"1f9b6",v:["1f9b6-1f3fb","1f9b6-1f3fc","1f9b6-1f3fd","1f9b6-1f3fe","1f9b6-1f3ff"],a:"11.0"},{n:["ear"],u:"1f442",v:["1f442-1f3fb","1f442-1f3fc","1f442-1f3fd","1f442-1f3fe","1f442-1f3ff"],a:"0.6"},{n:["ear with hearing aid"],u:"1f9bb",v:["1f9bb-1f3fb","1f9bb-1f3fc","1f9bb-1f3fd","1f9bb-1f3fe","1f9bb-1f3ff"],a:"12.0"},{n:["nose"],u:"1f443",v:["1f443-1f3fb","1f443-1f3fc","1f443-1f3fd","1f443-1f3fe","1f443-1f3ff"],a:"0.6"},{n:["brain"],u:"1f9e0",a:"5.0"},{n:["anatomical heart"],u:"1fac0",a:"13.0"},{n:["lungs"],u:"1fac1",a:"13.0"},{n:["tooth"],u:"1f9b7",a:"11.0"},{n:["bone"],u:"1f9b4",a:"11.0"},{n:["eyes"],u:"1f440",a:"0.6"},{n:["eye"],u:"1f441-fe0f",a:"0.7"},{n:["tongue"],u:"1f445",a:"0.6"},{n:["lips","mouth"],u:"1f444",a:"0.6"},{n:["biting lip"],u:"1fae6",a:"14.0"},{n:["baby"],u:"1f476",v:["1f476-1f3fb","1f476-1f3fc","1f476-1f3fd","1f476-1f3fe","1f476-1f3ff"],a:"0.6"},{n:["child"],u:"1f9d2",v:["1f9d2-1f3fb","1f9d2-1f3fc","1f9d2-1f3fd","1f9d2-1f3fe","1f9d2-1f3ff"],a:"5.0"},{n:["boy"],u:"1f466",v:["1f466-1f3fb","1f466-1f3fc","1f466-1f3fd","1f466-1f3fe","1f466-1f3ff"],a:"0.6"},{n:["girl"],u:"1f467",v:["1f467-1f3fb","1f467-1f3fc","1f467-1f3fd","1f467-1f3fe","1f467-1f3ff"],a:"0.6"},{n:["adult"],u:"1f9d1",v:["1f9d1-1f3fb","1f9d1-1f3fc","1f9d1-1f3fd","1f9d1-1f3fe","1f9d1-1f3ff"],a:"5.0"},{n:["person with blond hair"],u:"1f471",v:["1f471-1f3fb","1f471-1f3fc","1f471-1f3fd","1f471-1f3fe","1f471-1f3ff"],a:"0.6"},{n:["man"],u:"1f468",v:["1f468-1f3fb","1f468-1f3fc","1f468-1f3fd","1f468-1f3fe","1f468-1f3ff"],a:"0.6"},{n:["bearded person"],u:"1f9d4",v:["1f9d4-1f3fb","1f9d4-1f3fc","1f9d4-1f3fd","1f9d4-1f3fe","1f9d4-1f3ff"],a:"5.0"},{n:["man: beard","man with beard"],u:"1f9d4-200d-2642-fe0f",v:["1f9d4-1f3fb-200d-2642-fe0f","1f9d4-1f3fc-200d-2642-fe0f","1f9d4-1f3fd-200d-2642-fe0f","1f9d4-1f3fe-200d-2642-fe0f","1f9d4-1f3ff-200d-2642-fe0f"],a:"13.1"},{n:["woman: beard","woman with beard"],u:"1f9d4-200d-2640-fe0f",v:["1f9d4-1f3fb-200d-2640-fe0f","1f9d4-1f3fc-200d-2640-fe0f","1f9d4-1f3fd-200d-2640-fe0f","1f9d4-1f3fe-200d-2640-fe0f","1f9d4-1f3ff-200d-2640-fe0f"],a:"13.1"},{n:["man: red hair","red haired man"],u:"1f468-200d-1f9b0",v:["1f468-1f3fb-200d-1f9b0","1f468-1f3fc-200d-1f9b0","1f468-1f3fd-200d-1f9b0","1f468-1f3fe-200d-1f9b0","1f468-1f3ff-200d-1f9b0"],a:"11.0"},{n:["man: curly hair","curly haired man"],u:"1f468-200d-1f9b1",v:["1f468-1f3fb-200d-1f9b1","1f468-1f3fc-200d-1f9b1","1f468-1f3fd-200d-1f9b1","1f468-1f3fe-200d-1f9b1","1f468-1f3ff-200d-1f9b1"],a:"11.0"},{n:["man: white hair","white haired man"],u:"1f468-200d-1f9b3",v:["1f468-1f3fb-200d-1f9b3","1f468-1f3fc-200d-1f9b3","1f468-1f3fd-200d-1f9b3","1f468-1f3fe-200d-1f9b3","1f468-1f3ff-200d-1f9b3"],a:"11.0"},{n:["bald man","man: bald"],u:"1f468-200d-1f9b2",v:["1f468-1f3fb-200d-1f9b2","1f468-1f3fc-200d-1f9b2","1f468-1f3fd-200d-1f9b2","1f468-1f3fe-200d-1f9b2","1f468-1f3ff-200d-1f9b2"],a:"11.0"},{n:["woman"],u:"1f469",v:["1f469-1f3fb","1f469-1f3fc","1f469-1f3fd","1f469-1f3fe","1f469-1f3ff"],a:"0.6"},{n:["woman: red hair","red haired woman"],u:"1f469-200d-1f9b0",v:["1f469-1f3fb-200d-1f9b0","1f469-1f3fc-200d-1f9b0","1f469-1f3fd-200d-1f9b0","1f469-1f3fe-200d-1f9b0","1f469-1f3ff-200d-1f9b0"],a:"11.0"},{n:["person: red hair","red haired person"],u:"1f9d1-200d-1f9b0",v:["1f9d1-1f3fb-200d-1f9b0","1f9d1-1f3fc-200d-1f9b0","1f9d1-1f3fd-200d-1f9b0","1f9d1-1f3fe-200d-1f9b0","1f9d1-1f3ff-200d-1f9b0"],a:"12.1"},{n:["woman: curly hair","curly haired woman"],u:"1f469-200d-1f9b1",v:["1f469-1f3fb-200d-1f9b1","1f469-1f3fc-200d-1f9b1","1f469-1f3fd-200d-1f9b1","1f469-1f3fe-200d-1f9b1","1f469-1f3ff-200d-1f9b1"],a:"11.0"},{n:["person: curly hair","curly haired person"],u:"1f9d1-200d-1f9b1",v:["1f9d1-1f3fb-200d-1f9b1","1f9d1-1f3fc-200d-1f9b1","1f9d1-1f3fd-200d-1f9b1","1f9d1-1f3fe-200d-1f9b1","1f9d1-1f3ff-200d-1f9b1"],a:"12.1"},{n:["woman: white hair","white haired woman"],u:"1f469-200d-1f9b3",v:["1f469-1f3fb-200d-1f9b3","1f469-1f3fc-200d-1f9b3","1f469-1f3fd-200d-1f9b3","1f469-1f3fe-200d-1f9b3","1f469-1f3ff-200d-1f9b3"],a:"11.0"},{n:["person: white hair","white haired person"],u:"1f9d1-200d-1f9b3",v:["1f9d1-1f3fb-200d-1f9b3","1f9d1-1f3fc-200d-1f9b3","1f9d1-1f3fd-200d-1f9b3","1f9d1-1f3fe-200d-1f9b3","1f9d1-1f3ff-200d-1f9b3"],a:"12.1"},{n:["bald woman","woman: bald"],u:"1f469-200d-1f9b2",v:["1f469-1f3fb-200d-1f9b2","1f469-1f3fc-200d-1f9b2","1f469-1f3fd-200d-1f9b2","1f469-1f3fe-200d-1f9b2","1f469-1f3ff-200d-1f9b2"],a:"11.0"},{n:["bald person","person: bald"],u:"1f9d1-200d-1f9b2",v:["1f9d1-1f3fb-200d-1f9b2","1f9d1-1f3fc-200d-1f9b2","1f9d1-1f3fd-200d-1f9b2","1f9d1-1f3fe-200d-1f9b2","1f9d1-1f3ff-200d-1f9b2"],a:"12.1"},{n:["woman: blond hair","blond-haired-woman"],u:"1f471-200d-2640-fe0f",v:["1f471-1f3fb-200d-2640-fe0f","1f471-1f3fc-200d-2640-fe0f","1f471-1f3fd-200d-2640-fe0f","1f471-1f3fe-200d-2640-fe0f","1f471-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["man: blond hair","blond-haired-man"],u:"1f471-200d-2642-fe0f",v:["1f471-1f3fb-200d-2642-fe0f","1f471-1f3fc-200d-2642-fe0f","1f471-1f3fd-200d-2642-fe0f","1f471-1f3fe-200d-2642-fe0f","1f471-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["older adult"],u:"1f9d3",v:["1f9d3-1f3fb","1f9d3-1f3fc","1f9d3-1f3fd","1f9d3-1f3fe","1f9d3-1f3ff"],a:"5.0"},{n:["older man"],u:"1f474",v:["1f474-1f3fb","1f474-1f3fc","1f474-1f3fd","1f474-1f3fe","1f474-1f3ff"],a:"0.6"},{n:["older woman"],u:"1f475",v:["1f475-1f3fb","1f475-1f3fc","1f475-1f3fd","1f475-1f3fe","1f475-1f3ff"],a:"0.6"},{n:["person frowning"],u:"1f64d",v:["1f64d-1f3fb","1f64d-1f3fc","1f64d-1f3fd","1f64d-1f3fe","1f64d-1f3ff"],a:"0.6"},{n:["man frowning","man-frowning"],u:"1f64d-200d-2642-fe0f",v:["1f64d-1f3fb-200d-2642-fe0f","1f64d-1f3fc-200d-2642-fe0f","1f64d-1f3fd-200d-2642-fe0f","1f64d-1f3fe-200d-2642-fe0f","1f64d-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman frowning","woman-frowning"],u:"1f64d-200d-2640-fe0f",v:["1f64d-1f3fb-200d-2640-fe0f","1f64d-1f3fc-200d-2640-fe0f","1f64d-1f3fd-200d-2640-fe0f","1f64d-1f3fe-200d-2640-fe0f","1f64d-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["person with pouting face"],u:"1f64e",v:["1f64e-1f3fb","1f64e-1f3fc","1f64e-1f3fd","1f64e-1f3fe","1f64e-1f3ff"],a:"0.6"},{n:["man pouting","man-pouting"],u:"1f64e-200d-2642-fe0f",v:["1f64e-1f3fb-200d-2642-fe0f","1f64e-1f3fc-200d-2642-fe0f","1f64e-1f3fd-200d-2642-fe0f","1f64e-1f3fe-200d-2642-fe0f","1f64e-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman pouting","woman-pouting"],u:"1f64e-200d-2640-fe0f",v:["1f64e-1f3fb-200d-2640-fe0f","1f64e-1f3fc-200d-2640-fe0f","1f64e-1f3fd-200d-2640-fe0f","1f64e-1f3fe-200d-2640-fe0f","1f64e-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["no good","face with no good gesture"],u:"1f645",v:["1f645-1f3fb","1f645-1f3fc","1f645-1f3fd","1f645-1f3fe","1f645-1f3ff"],a:"0.6"},{n:["man gesturing no","man-gesturing-no"],u:"1f645-200d-2642-fe0f",v:["1f645-1f3fb-200d-2642-fe0f","1f645-1f3fc-200d-2642-fe0f","1f645-1f3fd-200d-2642-fe0f","1f645-1f3fe-200d-2642-fe0f","1f645-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman gesturing no","woman-gesturing-no"],u:"1f645-200d-2640-fe0f",v:["1f645-1f3fb-200d-2640-fe0f","1f645-1f3fc-200d-2640-fe0f","1f645-1f3fd-200d-2640-fe0f","1f645-1f3fe-200d-2640-fe0f","1f645-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["ok woman","face with ok gesture"],u:"1f646",v:["1f646-1f3fb","1f646-1f3fc","1f646-1f3fd","1f646-1f3fe","1f646-1f3ff"],a:"0.6"},{n:["man gesturing ok","man-gesturing-ok"],u:"1f646-200d-2642-fe0f",v:["1f646-1f3fb-200d-2642-fe0f","1f646-1f3fc-200d-2642-fe0f","1f646-1f3fd-200d-2642-fe0f","1f646-1f3fe-200d-2642-fe0f","1f646-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman gesturing ok","woman-gesturing-ok"],u:"1f646-200d-2640-fe0f",v:["1f646-1f3fb-200d-2640-fe0f","1f646-1f3fc-200d-2640-fe0f","1f646-1f3fd-200d-2640-fe0f","1f646-1f3fe-200d-2640-fe0f","1f646-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["information desk person"],u:"1f481",v:["1f481-1f3fb","1f481-1f3fc","1f481-1f3fd","1f481-1f3fe","1f481-1f3ff"],a:"0.6"},{n:["man tipping hand","man-tipping-hand"],u:"1f481-200d-2642-fe0f",v:["1f481-1f3fb-200d-2642-fe0f","1f481-1f3fc-200d-2642-fe0f","1f481-1f3fd-200d-2642-fe0f","1f481-1f3fe-200d-2642-fe0f","1f481-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman tipping hand","woman-tipping-hand"],u:"1f481-200d-2640-fe0f",v:["1f481-1f3fb-200d-2640-fe0f","1f481-1f3fc-200d-2640-fe0f","1f481-1f3fd-200d-2640-fe0f","1f481-1f3fe-200d-2640-fe0f","1f481-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["raising hand","happy person raising one hand"],u:"1f64b",v:["1f64b-1f3fb","1f64b-1f3fc","1f64b-1f3fd","1f64b-1f3fe","1f64b-1f3ff"],a:"0.6"},{n:["man raising hand","man-raising-hand"],u:"1f64b-200d-2642-fe0f",v:["1f64b-1f3fb-200d-2642-fe0f","1f64b-1f3fc-200d-2642-fe0f","1f64b-1f3fd-200d-2642-fe0f","1f64b-1f3fe-200d-2642-fe0f","1f64b-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman raising hand","woman-raising-hand"],u:"1f64b-200d-2640-fe0f",v:["1f64b-1f3fb-200d-2640-fe0f","1f64b-1f3fc-200d-2640-fe0f","1f64b-1f3fd-200d-2640-fe0f","1f64b-1f3fe-200d-2640-fe0f","1f64b-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["deaf person"],u:"1f9cf",v:["1f9cf-1f3fb","1f9cf-1f3fc","1f9cf-1f3fd","1f9cf-1f3fe","1f9cf-1f3ff"],a:"12.0"},{n:["deaf man"],u:"1f9cf-200d-2642-fe0f",v:["1f9cf-1f3fb-200d-2642-fe0f","1f9cf-1f3fc-200d-2642-fe0f","1f9cf-1f3fd-200d-2642-fe0f","1f9cf-1f3fe-200d-2642-fe0f","1f9cf-1f3ff-200d-2642-fe0f"],a:"12.0"},{n:["deaf woman"],u:"1f9cf-200d-2640-fe0f",v:["1f9cf-1f3fb-200d-2640-fe0f","1f9cf-1f3fc-200d-2640-fe0f","1f9cf-1f3fd-200d-2640-fe0f","1f9cf-1f3fe-200d-2640-fe0f","1f9cf-1f3ff-200d-2640-fe0f"],a:"12.0"},{n:["bow","person bowing deeply"],u:"1f647",v:["1f647-1f3fb","1f647-1f3fc","1f647-1f3fd","1f647-1f3fe","1f647-1f3ff"],a:"0.6"},{n:["man bowing","man-bowing"],u:"1f647-200d-2642-fe0f",v:["1f647-1f3fb-200d-2642-fe0f","1f647-1f3fc-200d-2642-fe0f","1f647-1f3fd-200d-2642-fe0f","1f647-1f3fe-200d-2642-fe0f","1f647-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman bowing","woman-bowing"],u:"1f647-200d-2640-fe0f",v:["1f647-1f3fb-200d-2640-fe0f","1f647-1f3fc-200d-2640-fe0f","1f647-1f3fd-200d-2640-fe0f","1f647-1f3fe-200d-2640-fe0f","1f647-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["face palm"],u:"1f926",v:["1f926-1f3fb","1f926-1f3fc","1f926-1f3fd","1f926-1f3fe","1f926-1f3ff"],a:"3.0"},{n:["man facepalming","man-facepalming"],u:"1f926-200d-2642-fe0f",v:["1f926-1f3fb-200d-2642-fe0f","1f926-1f3fc-200d-2642-fe0f","1f926-1f3fd-200d-2642-fe0f","1f926-1f3fe-200d-2642-fe0f","1f926-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman facepalming","woman-facepalming"],u:"1f926-200d-2640-fe0f",v:["1f926-1f3fb-200d-2640-fe0f","1f926-1f3fc-200d-2640-fe0f","1f926-1f3fd-200d-2640-fe0f","1f926-1f3fe-200d-2640-fe0f","1f926-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["shrug"],u:"1f937",v:["1f937-1f3fb","1f937-1f3fc","1f937-1f3fd","1f937-1f3fe","1f937-1f3ff"],a:"3.0"},{n:["man shrugging","man-shrugging"],u:"1f937-200d-2642-fe0f",v:["1f937-1f3fb-200d-2642-fe0f","1f937-1f3fc-200d-2642-fe0f","1f937-1f3fd-200d-2642-fe0f","1f937-1f3fe-200d-2642-fe0f","1f937-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman shrugging","woman-shrugging"],u:"1f937-200d-2640-fe0f",v:["1f937-1f3fb-200d-2640-fe0f","1f937-1f3fc-200d-2640-fe0f","1f937-1f3fd-200d-2640-fe0f","1f937-1f3fe-200d-2640-fe0f","1f937-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["health worker"],u:"1f9d1-200d-2695-fe0f",v:["1f9d1-1f3fb-200d-2695-fe0f","1f9d1-1f3fc-200d-2695-fe0f","1f9d1-1f3fd-200d-2695-fe0f","1f9d1-1f3fe-200d-2695-fe0f","1f9d1-1f3ff-200d-2695-fe0f"],a:"12.1"},{n:["male-doctor","man health worker"],u:"1f468-200d-2695-fe0f",v:["1f468-1f3fb-200d-2695-fe0f","1f468-1f3fc-200d-2695-fe0f","1f468-1f3fd-200d-2695-fe0f","1f468-1f3fe-200d-2695-fe0f","1f468-1f3ff-200d-2695-fe0f"],a:"4.0"},{n:["female-doctor","woman health worker"],u:"1f469-200d-2695-fe0f",v:["1f469-1f3fb-200d-2695-fe0f","1f469-1f3fc-200d-2695-fe0f","1f469-1f3fd-200d-2695-fe0f","1f469-1f3fe-200d-2695-fe0f","1f469-1f3ff-200d-2695-fe0f"],a:"4.0"},{n:["student"],u:"1f9d1-200d-1f393",v:["1f9d1-1f3fb-200d-1f393","1f9d1-1f3fc-200d-1f393","1f9d1-1f3fd-200d-1f393","1f9d1-1f3fe-200d-1f393","1f9d1-1f3ff-200d-1f393"],a:"12.1"},{n:["man student","male-student"],u:"1f468-200d-1f393",v:["1f468-1f3fb-200d-1f393","1f468-1f3fc-200d-1f393","1f468-1f3fd-200d-1f393","1f468-1f3fe-200d-1f393","1f468-1f3ff-200d-1f393"],a:"4.0"},{n:["woman student","female-student"],u:"1f469-200d-1f393",v:["1f469-1f3fb-200d-1f393","1f469-1f3fc-200d-1f393","1f469-1f3fd-200d-1f393","1f469-1f3fe-200d-1f393","1f469-1f3ff-200d-1f393"],a:"4.0"},{n:["teacher"],u:"1f9d1-200d-1f3eb",v:["1f9d1-1f3fb-200d-1f3eb","1f9d1-1f3fc-200d-1f3eb","1f9d1-1f3fd-200d-1f3eb","1f9d1-1f3fe-200d-1f3eb","1f9d1-1f3ff-200d-1f3eb"],a:"12.1"},{n:["man teacher","male-teacher"],u:"1f468-200d-1f3eb",v:["1f468-1f3fb-200d-1f3eb","1f468-1f3fc-200d-1f3eb","1f468-1f3fd-200d-1f3eb","1f468-1f3fe-200d-1f3eb","1f468-1f3ff-200d-1f3eb"],a:"4.0"},{n:["woman teacher","female-teacher"],u:"1f469-200d-1f3eb",v:["1f469-1f3fb-200d-1f3eb","1f469-1f3fc-200d-1f3eb","1f469-1f3fd-200d-1f3eb","1f469-1f3fe-200d-1f3eb","1f469-1f3ff-200d-1f3eb"],a:"4.0"},{n:["judge"],u:"1f9d1-200d-2696-fe0f",v:["1f9d1-1f3fb-200d-2696-fe0f","1f9d1-1f3fc-200d-2696-fe0f","1f9d1-1f3fd-200d-2696-fe0f","1f9d1-1f3fe-200d-2696-fe0f","1f9d1-1f3ff-200d-2696-fe0f"],a:"12.1"},{n:["man judge","male-judge"],u:"1f468-200d-2696-fe0f",v:["1f468-1f3fb-200d-2696-fe0f","1f468-1f3fc-200d-2696-fe0f","1f468-1f3fd-200d-2696-fe0f","1f468-1f3fe-200d-2696-fe0f","1f468-1f3ff-200d-2696-fe0f"],a:"4.0"},{n:["woman judge","female-judge"],u:"1f469-200d-2696-fe0f",v:["1f469-1f3fb-200d-2696-fe0f","1f469-1f3fc-200d-2696-fe0f","1f469-1f3fd-200d-2696-fe0f","1f469-1f3fe-200d-2696-fe0f","1f469-1f3ff-200d-2696-fe0f"],a:"4.0"},{n:["farmer"],u:"1f9d1-200d-1f33e",v:["1f9d1-1f3fb-200d-1f33e","1f9d1-1f3fc-200d-1f33e","1f9d1-1f3fd-200d-1f33e","1f9d1-1f3fe-200d-1f33e","1f9d1-1f3ff-200d-1f33e"],a:"12.1"},{n:["man farmer","male-farmer"],u:"1f468-200d-1f33e",v:["1f468-1f3fb-200d-1f33e","1f468-1f3fc-200d-1f33e","1f468-1f3fd-200d-1f33e","1f468-1f3fe-200d-1f33e","1f468-1f3ff-200d-1f33e"],a:"4.0"},{n:["woman farmer","female-farmer"],u:"1f469-200d-1f33e",v:["1f469-1f3fb-200d-1f33e","1f469-1f3fc-200d-1f33e","1f469-1f3fd-200d-1f33e","1f469-1f3fe-200d-1f33e","1f469-1f3ff-200d-1f33e"],a:"4.0"},{n:["cook"],u:"1f9d1-200d-1f373",v:["1f9d1-1f3fb-200d-1f373","1f9d1-1f3fc-200d-1f373","1f9d1-1f3fd-200d-1f373","1f9d1-1f3fe-200d-1f373","1f9d1-1f3ff-200d-1f373"],a:"12.1"},{n:["man cook","male-cook"],u:"1f468-200d-1f373",v:["1f468-1f3fb-200d-1f373","1f468-1f3fc-200d-1f373","1f468-1f3fd-200d-1f373","1f468-1f3fe-200d-1f373","1f468-1f3ff-200d-1f373"],a:"4.0"},{n:["woman cook","female-cook"],u:"1f469-200d-1f373",v:["1f469-1f3fb-200d-1f373","1f469-1f3fc-200d-1f373","1f469-1f3fd-200d-1f373","1f469-1f3fe-200d-1f373","1f469-1f3ff-200d-1f373"],a:"4.0"},{n:["mechanic"],u:"1f9d1-200d-1f527",v:["1f9d1-1f3fb-200d-1f527","1f9d1-1f3fc-200d-1f527","1f9d1-1f3fd-200d-1f527","1f9d1-1f3fe-200d-1f527","1f9d1-1f3ff-200d-1f527"],a:"12.1"},{n:["man mechanic","male-mechanic"],u:"1f468-200d-1f527",v:["1f468-1f3fb-200d-1f527","1f468-1f3fc-200d-1f527","1f468-1f3fd-200d-1f527","1f468-1f3fe-200d-1f527","1f468-1f3ff-200d-1f527"],a:"4.0"},{n:["woman mechanic","female-mechanic"],u:"1f469-200d-1f527",v:["1f469-1f3fb-200d-1f527","1f469-1f3fc-200d-1f527","1f469-1f3fd-200d-1f527","1f469-1f3fe-200d-1f527","1f469-1f3ff-200d-1f527"],a:"4.0"},{n:["factory worker"],u:"1f9d1-200d-1f3ed",v:["1f9d1-1f3fb-200d-1f3ed","1f9d1-1f3fc-200d-1f3ed","1f9d1-1f3fd-200d-1f3ed","1f9d1-1f3fe-200d-1f3ed","1f9d1-1f3ff-200d-1f3ed"],a:"12.1"},{n:["man factory worker","male-factory-worker"],u:"1f468-200d-1f3ed",v:["1f468-1f3fb-200d-1f3ed","1f468-1f3fc-200d-1f3ed","1f468-1f3fd-200d-1f3ed","1f468-1f3fe-200d-1f3ed","1f468-1f3ff-200d-1f3ed"],a:"4.0"},{n:["woman factory worker","female-factory-worker"],u:"1f469-200d-1f3ed",v:["1f469-1f3fb-200d-1f3ed","1f469-1f3fc-200d-1f3ed","1f469-1f3fd-200d-1f3ed","1f469-1f3fe-200d-1f3ed","1f469-1f3ff-200d-1f3ed"],a:"4.0"},{n:["office worker"],u:"1f9d1-200d-1f4bc",v:["1f9d1-1f3fb-200d-1f4bc","1f9d1-1f3fc-200d-1f4bc","1f9d1-1f3fd-200d-1f4bc","1f9d1-1f3fe-200d-1f4bc","1f9d1-1f3ff-200d-1f4bc"],a:"12.1"},{n:["man office worker","male-office-worker"],u:"1f468-200d-1f4bc",v:["1f468-1f3fb-200d-1f4bc","1f468-1f3fc-200d-1f4bc","1f468-1f3fd-200d-1f4bc","1f468-1f3fe-200d-1f4bc","1f468-1f3ff-200d-1f4bc"],a:"4.0"},{n:["woman office worker","female-office-worker"],u:"1f469-200d-1f4bc",v:["1f469-1f3fb-200d-1f4bc","1f469-1f3fc-200d-1f4bc","1f469-1f3fd-200d-1f4bc","1f469-1f3fe-200d-1f4bc","1f469-1f3ff-200d-1f4bc"],a:"4.0"},{n:["scientist"],u:"1f9d1-200d-1f52c",v:["1f9d1-1f3fb-200d-1f52c","1f9d1-1f3fc-200d-1f52c","1f9d1-1f3fd-200d-1f52c","1f9d1-1f3fe-200d-1f52c","1f9d1-1f3ff-200d-1f52c"],a:"12.1"},{n:["man scientist","male-scientist"],u:"1f468-200d-1f52c",v:["1f468-1f3fb-200d-1f52c","1f468-1f3fc-200d-1f52c","1f468-1f3fd-200d-1f52c","1f468-1f3fe-200d-1f52c","1f468-1f3ff-200d-1f52c"],a:"4.0"},{n:["woman scientist","female-scientist"],u:"1f469-200d-1f52c",v:["1f469-1f3fb-200d-1f52c","1f469-1f3fc-200d-1f52c","1f469-1f3fd-200d-1f52c","1f469-1f3fe-200d-1f52c","1f469-1f3ff-200d-1f52c"],a:"4.0"},{n:["technologist"],u:"1f9d1-200d-1f4bb",v:["1f9d1-1f3fb-200d-1f4bb","1f9d1-1f3fc-200d-1f4bb","1f9d1-1f3fd-200d-1f4bb","1f9d1-1f3fe-200d-1f4bb","1f9d1-1f3ff-200d-1f4bb"],a:"12.1"},{n:["man technologist","male-technologist"],u:"1f468-200d-1f4bb",v:["1f468-1f3fb-200d-1f4bb","1f468-1f3fc-200d-1f4bb","1f468-1f3fd-200d-1f4bb","1f468-1f3fe-200d-1f4bb","1f468-1f3ff-200d-1f4bb"],a:"4.0"},{n:["woman technologist","female-technologist"],u:"1f469-200d-1f4bb",v:["1f469-1f3fb-200d-1f4bb","1f469-1f3fc-200d-1f4bb","1f469-1f3fd-200d-1f4bb","1f469-1f3fe-200d-1f4bb","1f469-1f3ff-200d-1f4bb"],a:"4.0"},{n:["singer"],u:"1f9d1-200d-1f3a4",v:["1f9d1-1f3fb-200d-1f3a4","1f9d1-1f3fc-200d-1f3a4","1f9d1-1f3fd-200d-1f3a4","1f9d1-1f3fe-200d-1f3a4","1f9d1-1f3ff-200d-1f3a4"],a:"12.1"},{n:["man singer","male-singer"],u:"1f468-200d-1f3a4",v:["1f468-1f3fb-200d-1f3a4","1f468-1f3fc-200d-1f3a4","1f468-1f3fd-200d-1f3a4","1f468-1f3fe-200d-1f3a4","1f468-1f3ff-200d-1f3a4"],a:"4.0"},{n:["woman singer","female-singer"],u:"1f469-200d-1f3a4",v:["1f469-1f3fb-200d-1f3a4","1f469-1f3fc-200d-1f3a4","1f469-1f3fd-200d-1f3a4","1f469-1f3fe-200d-1f3a4","1f469-1f3ff-200d-1f3a4"],a:"4.0"},{n:["artist"],u:"1f9d1-200d-1f3a8",v:["1f9d1-1f3fb-200d-1f3a8","1f9d1-1f3fc-200d-1f3a8","1f9d1-1f3fd-200d-1f3a8","1f9d1-1f3fe-200d-1f3a8","1f9d1-1f3ff-200d-1f3a8"],a:"12.1"},{n:["man artist","male-artist"],u:"1f468-200d-1f3a8",v:["1f468-1f3fb-200d-1f3a8","1f468-1f3fc-200d-1f3a8","1f468-1f3fd-200d-1f3a8","1f468-1f3fe-200d-1f3a8","1f468-1f3ff-200d-1f3a8"],a:"4.0"},{n:["woman artist","female-artist"],u:"1f469-200d-1f3a8",v:["1f469-1f3fb-200d-1f3a8","1f469-1f3fc-200d-1f3a8","1f469-1f3fd-200d-1f3a8","1f469-1f3fe-200d-1f3a8","1f469-1f3ff-200d-1f3a8"],a:"4.0"},{n:["pilot"],u:"1f9d1-200d-2708-fe0f",v:["1f9d1-1f3fb-200d-2708-fe0f","1f9d1-1f3fc-200d-2708-fe0f","1f9d1-1f3fd-200d-2708-fe0f","1f9d1-1f3fe-200d-2708-fe0f","1f9d1-1f3ff-200d-2708-fe0f"],a:"12.1"},{n:["man pilot","male-pilot"],u:"1f468-200d-2708-fe0f",v:["1f468-1f3fb-200d-2708-fe0f","1f468-1f3fc-200d-2708-fe0f","1f468-1f3fd-200d-2708-fe0f","1f468-1f3fe-200d-2708-fe0f","1f468-1f3ff-200d-2708-fe0f"],a:"4.0"},{n:["woman pilot","female-pilot"],u:"1f469-200d-2708-fe0f",v:["1f469-1f3fb-200d-2708-fe0f","1f469-1f3fc-200d-2708-fe0f","1f469-1f3fd-200d-2708-fe0f","1f469-1f3fe-200d-2708-fe0f","1f469-1f3ff-200d-2708-fe0f"],a:"4.0"},{n:["astronaut"],u:"1f9d1-200d-1f680",v:["1f9d1-1f3fb-200d-1f680","1f9d1-1f3fc-200d-1f680","1f9d1-1f3fd-200d-1f680","1f9d1-1f3fe-200d-1f680","1f9d1-1f3ff-200d-1f680"],a:"12.1"},{n:["man astronaut","male-astronaut"],u:"1f468-200d-1f680",v:["1f468-1f3fb-200d-1f680","1f468-1f3fc-200d-1f680","1f468-1f3fd-200d-1f680","1f468-1f3fe-200d-1f680","1f468-1f3ff-200d-1f680"],a:"4.0"},{n:["woman astronaut","female-astronaut"],u:"1f469-200d-1f680",v:["1f469-1f3fb-200d-1f680","1f469-1f3fc-200d-1f680","1f469-1f3fd-200d-1f680","1f469-1f3fe-200d-1f680","1f469-1f3ff-200d-1f680"],a:"4.0"},{n:["firefighter"],u:"1f9d1-200d-1f692",v:["1f9d1-1f3fb-200d-1f692","1f9d1-1f3fc-200d-1f692","1f9d1-1f3fd-200d-1f692","1f9d1-1f3fe-200d-1f692","1f9d1-1f3ff-200d-1f692"],a:"12.1"},{n:["man firefighter","male-firefighter"],u:"1f468-200d-1f692",v:["1f468-1f3fb-200d-1f692","1f468-1f3fc-200d-1f692","1f468-1f3fd-200d-1f692","1f468-1f3fe-200d-1f692","1f468-1f3ff-200d-1f692"],a:"4.0"},{n:["woman firefighter","female-firefighter"],u:"1f469-200d-1f692",v:["1f469-1f3fb-200d-1f692","1f469-1f3fc-200d-1f692","1f469-1f3fd-200d-1f692","1f469-1f3fe-200d-1f692","1f469-1f3ff-200d-1f692"],a:"4.0"},{n:["cop","police officer"],u:"1f46e",v:["1f46e-1f3fb","1f46e-1f3fc","1f46e-1f3fd","1f46e-1f3fe","1f46e-1f3ff"],a:"0.6"},{n:["man police officer","male-police-officer"],u:"1f46e-200d-2642-fe0f",v:["1f46e-1f3fb-200d-2642-fe0f","1f46e-1f3fc-200d-2642-fe0f","1f46e-1f3fd-200d-2642-fe0f","1f46e-1f3fe-200d-2642-fe0f","1f46e-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman police officer","female-police-officer"],u:"1f46e-200d-2640-fe0f",v:["1f46e-1f3fb-200d-2640-fe0f","1f46e-1f3fc-200d-2640-fe0f","1f46e-1f3fd-200d-2640-fe0f","1f46e-1f3fe-200d-2640-fe0f","1f46e-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["detective","sleuth or spy"],u:"1f575-fe0f",v:["1f575-1f3fb","1f575-1f3fc","1f575-1f3fd","1f575-1f3fe","1f575-1f3ff"],a:"0.7"},{n:["man detective","male-detective"],u:"1f575-fe0f-200d-2642-fe0f",v:["1f575-1f3fb-200d-2642-fe0f","1f575-1f3fc-200d-2642-fe0f","1f575-1f3fd-200d-2642-fe0f","1f575-1f3fe-200d-2642-fe0f","1f575-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman detective","female-detective"],u:"1f575-fe0f-200d-2640-fe0f",v:["1f575-1f3fb-200d-2640-fe0f","1f575-1f3fc-200d-2640-fe0f","1f575-1f3fd-200d-2640-fe0f","1f575-1f3fe-200d-2640-fe0f","1f575-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["guardsman"],u:"1f482",v:["1f482-1f3fb","1f482-1f3fc","1f482-1f3fd","1f482-1f3fe","1f482-1f3ff"],a:"0.6"},{n:["man guard","male-guard"],u:"1f482-200d-2642-fe0f",v:["1f482-1f3fb-200d-2642-fe0f","1f482-1f3fc-200d-2642-fe0f","1f482-1f3fd-200d-2642-fe0f","1f482-1f3fe-200d-2642-fe0f","1f482-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman guard","female-guard"],u:"1f482-200d-2640-fe0f",v:["1f482-1f3fb-200d-2640-fe0f","1f482-1f3fc-200d-2640-fe0f","1f482-1f3fd-200d-2640-fe0f","1f482-1f3fe-200d-2640-fe0f","1f482-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["ninja"],u:"1f977",v:["1f977-1f3fb","1f977-1f3fc","1f977-1f3fd","1f977-1f3fe","1f977-1f3ff"],a:"13.0"},{n:["construction worker"],u:"1f477",v:["1f477-1f3fb","1f477-1f3fc","1f477-1f3fd","1f477-1f3fe","1f477-1f3ff"],a:"0.6"},{n:["man construction worker","male-construction-worker"],u:"1f477-200d-2642-fe0f",v:["1f477-1f3fb-200d-2642-fe0f","1f477-1f3fc-200d-2642-fe0f","1f477-1f3fd-200d-2642-fe0f","1f477-1f3fe-200d-2642-fe0f","1f477-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman construction worker","female-construction-worker"],u:"1f477-200d-2640-fe0f",v:["1f477-1f3fb-200d-2640-fe0f","1f477-1f3fc-200d-2640-fe0f","1f477-1f3fd-200d-2640-fe0f","1f477-1f3fe-200d-2640-fe0f","1f477-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["person with crown"],u:"1fac5",v:["1fac5-1f3fb","1fac5-1f3fc","1fac5-1f3fd","1fac5-1f3fe","1fac5-1f3ff"],a:"14.0"},{n:["prince"],u:"1f934",v:["1f934-1f3fb","1f934-1f3fc","1f934-1f3fd","1f934-1f3fe","1f934-1f3ff"],a:"3.0"},{n:["princess"],u:"1f478",v:["1f478-1f3fb","1f478-1f3fc","1f478-1f3fd","1f478-1f3fe","1f478-1f3ff"],a:"0.6"},{n:["man with turban"],u:"1f473",v:["1f473-1f3fb","1f473-1f3fc","1f473-1f3fd","1f473-1f3fe","1f473-1f3ff"],a:"0.6"},{n:["man wearing turban","man-wearing-turban"],u:"1f473-200d-2642-fe0f",v:["1f473-1f3fb-200d-2642-fe0f","1f473-1f3fc-200d-2642-fe0f","1f473-1f3fd-200d-2642-fe0f","1f473-1f3fe-200d-2642-fe0f","1f473-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman wearing turban","woman-wearing-turban"],u:"1f473-200d-2640-fe0f",v:["1f473-1f3fb-200d-2640-fe0f","1f473-1f3fc-200d-2640-fe0f","1f473-1f3fd-200d-2640-fe0f","1f473-1f3fe-200d-2640-fe0f","1f473-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["man with gua pi mao"],u:"1f472",v:["1f472-1f3fb","1f472-1f3fc","1f472-1f3fd","1f472-1f3fe","1f472-1f3ff"],a:"0.6"},{n:["person with headscarf"],u:"1f9d5",v:["1f9d5-1f3fb","1f9d5-1f3fc","1f9d5-1f3fd","1f9d5-1f3fe","1f9d5-1f3ff"],a:"5.0"},{n:["man in tuxedo","person in tuxedo"],u:"1f935",v:["1f935-1f3fb","1f935-1f3fc","1f935-1f3fd","1f935-1f3fe","1f935-1f3ff"],a:"3.0"},{n:["man in tuxedo"],u:"1f935-200d-2642-fe0f",v:["1f935-1f3fb-200d-2642-fe0f","1f935-1f3fc-200d-2642-fe0f","1f935-1f3fd-200d-2642-fe0f","1f935-1f3fe-200d-2642-fe0f","1f935-1f3ff-200d-2642-fe0f"],a:"13.0"},{n:["woman in tuxedo"],u:"1f935-200d-2640-fe0f",v:["1f935-1f3fb-200d-2640-fe0f","1f935-1f3fc-200d-2640-fe0f","1f935-1f3fd-200d-2640-fe0f","1f935-1f3fe-200d-2640-fe0f","1f935-1f3ff-200d-2640-fe0f"],a:"13.0"},{n:["bride with veil"],u:"1f470",v:["1f470-1f3fb","1f470-1f3fc","1f470-1f3fd","1f470-1f3fe","1f470-1f3ff"],a:"0.6"},{n:["man with veil"],u:"1f470-200d-2642-fe0f",v:["1f470-1f3fb-200d-2642-fe0f","1f470-1f3fc-200d-2642-fe0f","1f470-1f3fd-200d-2642-fe0f","1f470-1f3fe-200d-2642-fe0f","1f470-1f3ff-200d-2642-fe0f"],a:"13.0"},{n:["woman with veil"],u:"1f470-200d-2640-fe0f",v:["1f470-1f3fb-200d-2640-fe0f","1f470-1f3fc-200d-2640-fe0f","1f470-1f3fd-200d-2640-fe0f","1f470-1f3fe-200d-2640-fe0f","1f470-1f3ff-200d-2640-fe0f"],a:"13.0"},{n:["pregnant woman"],u:"1f930",v:["1f930-1f3fb","1f930-1f3fc","1f930-1f3fd","1f930-1f3fe","1f930-1f3ff"],a:"3.0"},{n:["pregnant man"],u:"1fac3",v:["1fac3-1f3fb","1fac3-1f3fc","1fac3-1f3fd","1fac3-1f3fe","1fac3-1f3ff"],a:"14.0"},{n:["pregnant person"],u:"1fac4",v:["1fac4-1f3fb","1fac4-1f3fc","1fac4-1f3fd","1fac4-1f3fe","1fac4-1f3ff"],a:"14.0"},{n:["breast-feeding"],u:"1f931",v:["1f931-1f3fb","1f931-1f3fc","1f931-1f3fd","1f931-1f3fe","1f931-1f3ff"],a:"5.0"},{n:["woman feeding baby"],u:"1f469-200d-1f37c",v:["1f469-1f3fb-200d-1f37c","1f469-1f3fc-200d-1f37c","1f469-1f3fd-200d-1f37c","1f469-1f3fe-200d-1f37c","1f469-1f3ff-200d-1f37c"],a:"13.0"},{n:["man feeding baby"],u:"1f468-200d-1f37c",v:["1f468-1f3fb-200d-1f37c","1f468-1f3fc-200d-1f37c","1f468-1f3fd-200d-1f37c","1f468-1f3fe-200d-1f37c","1f468-1f3ff-200d-1f37c"],a:"13.0"},{n:["person feeding baby"],u:"1f9d1-200d-1f37c",v:["1f9d1-1f3fb-200d-1f37c","1f9d1-1f3fc-200d-1f37c","1f9d1-1f3fd-200d-1f37c","1f9d1-1f3fe-200d-1f37c","1f9d1-1f3ff-200d-1f37c"],a:"13.0"},{n:["angel","baby angel"],u:"1f47c",v:["1f47c-1f3fb","1f47c-1f3fc","1f47c-1f3fd","1f47c-1f3fe","1f47c-1f3ff"],a:"0.6"},{n:["santa","father christmas"],u:"1f385",v:["1f385-1f3fb","1f385-1f3fc","1f385-1f3fd","1f385-1f3fe","1f385-1f3ff"],a:"0.6"},{n:["mrs claus","mother christmas"],u:"1f936",v:["1f936-1f3fb","1f936-1f3fc","1f936-1f3fd","1f936-1f3fe","1f936-1f3ff"],a:"3.0"},{n:["mx claus"],u:"1f9d1-200d-1f384",v:["1f9d1-1f3fb-200d-1f384","1f9d1-1f3fc-200d-1f384","1f9d1-1f3fd-200d-1f384","1f9d1-1f3fe-200d-1f384","1f9d1-1f3ff-200d-1f384"],a:"13.0"},{n:["superhero"],u:"1f9b8",v:["1f9b8-1f3fb","1f9b8-1f3fc","1f9b8-1f3fd","1f9b8-1f3fe","1f9b8-1f3ff"],a:"11.0"},{n:["man superhero","male superhero"],u:"1f9b8-200d-2642-fe0f",v:["1f9b8-1f3fb-200d-2642-fe0f","1f9b8-1f3fc-200d-2642-fe0f","1f9b8-1f3fd-200d-2642-fe0f","1f9b8-1f3fe-200d-2642-fe0f","1f9b8-1f3ff-200d-2642-fe0f"],a:"11.0"},{n:["woman superhero","female superhero"],u:"1f9b8-200d-2640-fe0f",v:["1f9b8-1f3fb-200d-2640-fe0f","1f9b8-1f3fc-200d-2640-fe0f","1f9b8-1f3fd-200d-2640-fe0f","1f9b8-1f3fe-200d-2640-fe0f","1f9b8-1f3ff-200d-2640-fe0f"],a:"11.0"},{n:["supervillain"],u:"1f9b9",v:["1f9b9-1f3fb","1f9b9-1f3fc","1f9b9-1f3fd","1f9b9-1f3fe","1f9b9-1f3ff"],a:"11.0"},{n:["man supervillain","male supervillain"],u:"1f9b9-200d-2642-fe0f",v:["1f9b9-1f3fb-200d-2642-fe0f","1f9b9-1f3fc-200d-2642-fe0f","1f9b9-1f3fd-200d-2642-fe0f","1f9b9-1f3fe-200d-2642-fe0f","1f9b9-1f3ff-200d-2642-fe0f"],a:"11.0"},{n:["woman supervillain","female supervillain"],u:"1f9b9-200d-2640-fe0f",v:["1f9b9-1f3fb-200d-2640-fe0f","1f9b9-1f3fc-200d-2640-fe0f","1f9b9-1f3fd-200d-2640-fe0f","1f9b9-1f3fe-200d-2640-fe0f","1f9b9-1f3ff-200d-2640-fe0f"],a:"11.0"},{n:["mage"],u:"1f9d9",v:["1f9d9-1f3fb","1f9d9-1f3fc","1f9d9-1f3fd","1f9d9-1f3fe","1f9d9-1f3ff"],a:"5.0"},{n:["man mage","male mage"],u:"1f9d9-200d-2642-fe0f",v:["1f9d9-1f3fb-200d-2642-fe0f","1f9d9-1f3fc-200d-2642-fe0f","1f9d9-1f3fd-200d-2642-fe0f","1f9d9-1f3fe-200d-2642-fe0f","1f9d9-1f3ff-200d-2642-fe0f"],a:"5.0"},{n:["woman mage","female mage"],u:"1f9d9-200d-2640-fe0f",v:["1f9d9-1f3fb-200d-2640-fe0f","1f9d9-1f3fc-200d-2640-fe0f","1f9d9-1f3fd-200d-2640-fe0f","1f9d9-1f3fe-200d-2640-fe0f","1f9d9-1f3ff-200d-2640-fe0f"],a:"5.0"},{n:["fairy"],u:"1f9da",v:["1f9da-1f3fb","1f9da-1f3fc","1f9da-1f3fd","1f9da-1f3fe","1f9da-1f3ff"],a:"5.0"},{n:["man fairy","male fairy"],u:"1f9da-200d-2642-fe0f",v:["1f9da-1f3fb-200d-2642-fe0f","1f9da-1f3fc-200d-2642-fe0f","1f9da-1f3fd-200d-2642-fe0f","1f9da-1f3fe-200d-2642-fe0f","1f9da-1f3ff-200d-2642-fe0f"],a:"5.0"},{n:["woman fairy","female fairy"],u:"1f9da-200d-2640-fe0f",v:["1f9da-1f3fb-200d-2640-fe0f","1f9da-1f3fc-200d-2640-fe0f","1f9da-1f3fd-200d-2640-fe0f","1f9da-1f3fe-200d-2640-fe0f","1f9da-1f3ff-200d-2640-fe0f"],a:"5.0"},{n:["vampire"],u:"1f9db",v:["1f9db-1f3fb","1f9db-1f3fc","1f9db-1f3fd","1f9db-1f3fe","1f9db-1f3ff"],a:"5.0"},{n:["man vampire","male vampire"],u:"1f9db-200d-2642-fe0f",v:["1f9db-1f3fb-200d-2642-fe0f","1f9db-1f3fc-200d-2642-fe0f","1f9db-1f3fd-200d-2642-fe0f","1f9db-1f3fe-200d-2642-fe0f","1f9db-1f3ff-200d-2642-fe0f"],a:"5.0"},{n:["woman vampire","female vampire"],u:"1f9db-200d-2640-fe0f",v:["1f9db-1f3fb-200d-2640-fe0f","1f9db-1f3fc-200d-2640-fe0f","1f9db-1f3fd-200d-2640-fe0f","1f9db-1f3fe-200d-2640-fe0f","1f9db-1f3ff-200d-2640-fe0f"],a:"5.0"},{n:["merperson"],u:"1f9dc",v:["1f9dc-1f3fb","1f9dc-1f3fc","1f9dc-1f3fd","1f9dc-1f3fe","1f9dc-1f3ff"],a:"5.0"},{n:["merman"],u:"1f9dc-200d-2642-fe0f",v:["1f9dc-1f3fb-200d-2642-fe0f","1f9dc-1f3fc-200d-2642-fe0f","1f9dc-1f3fd-200d-2642-fe0f","1f9dc-1f3fe-200d-2642-fe0f","1f9dc-1f3ff-200d-2642-fe0f"],a:"5.0"},{n:["mermaid"],u:"1f9dc-200d-2640-fe0f",v:["1f9dc-1f3fb-200d-2640-fe0f","1f9dc-1f3fc-200d-2640-fe0f","1f9dc-1f3fd-200d-2640-fe0f","1f9dc-1f3fe-200d-2640-fe0f","1f9dc-1f3ff-200d-2640-fe0f"],a:"5.0"},{n:["elf"],u:"1f9dd",v:["1f9dd-1f3fb","1f9dd-1f3fc","1f9dd-1f3fd","1f9dd-1f3fe","1f9dd-1f3ff"],a:"5.0"},{n:["man elf","male elf"],u:"1f9dd-200d-2642-fe0f",v:["1f9dd-1f3fb-200d-2642-fe0f","1f9dd-1f3fc-200d-2642-fe0f","1f9dd-1f3fd-200d-2642-fe0f","1f9dd-1f3fe-200d-2642-fe0f","1f9dd-1f3ff-200d-2642-fe0f"],a:"5.0"},{n:["woman elf","female elf"],u:"1f9dd-200d-2640-fe0f",v:["1f9dd-1f3fb-200d-2640-fe0f","1f9dd-1f3fc-200d-2640-fe0f","1f9dd-1f3fd-200d-2640-fe0f","1f9dd-1f3fe-200d-2640-fe0f","1f9dd-1f3ff-200d-2640-fe0f"],a:"5.0"},{n:["genie"],u:"1f9de",a:"5.0"},{n:["man genie","male genie"],u:"1f9de-200d-2642-fe0f",a:"5.0"},{n:["woman genie","female genie"],u:"1f9de-200d-2640-fe0f",a:"5.0"},{n:["zombie"],u:"1f9df",a:"5.0"},{n:["man zombie","male zombie"],u:"1f9df-200d-2642-fe0f",a:"5.0"},{n:["woman zombie","female zombie"],u:"1f9df-200d-2640-fe0f",a:"5.0"},{n:["troll"],u:"1f9cc",a:"14.0"},{n:["massage","face massage"],u:"1f486",v:["1f486-1f3fb","1f486-1f3fc","1f486-1f3fd","1f486-1f3fe","1f486-1f3ff"],a:"0.6"},{n:["man getting massage","man-getting-massage"],u:"1f486-200d-2642-fe0f",v:["1f486-1f3fb-200d-2642-fe0f","1f486-1f3fc-200d-2642-fe0f","1f486-1f3fd-200d-2642-fe0f","1f486-1f3fe-200d-2642-fe0f","1f486-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman getting massage","woman-getting-massage"],u:"1f486-200d-2640-fe0f",v:["1f486-1f3fb-200d-2640-fe0f","1f486-1f3fc-200d-2640-fe0f","1f486-1f3fd-200d-2640-fe0f","1f486-1f3fe-200d-2640-fe0f","1f486-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["haircut"],u:"1f487",v:["1f487-1f3fb","1f487-1f3fc","1f487-1f3fd","1f487-1f3fe","1f487-1f3ff"],a:"0.6"},{n:["man getting haircut","man-getting-haircut"],u:"1f487-200d-2642-fe0f",v:["1f487-1f3fb-200d-2642-fe0f","1f487-1f3fc-200d-2642-fe0f","1f487-1f3fd-200d-2642-fe0f","1f487-1f3fe-200d-2642-fe0f","1f487-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman getting haircut","woman-getting-haircut"],u:"1f487-200d-2640-fe0f",v:["1f487-1f3fb-200d-2640-fe0f","1f487-1f3fc-200d-2640-fe0f","1f487-1f3fd-200d-2640-fe0f","1f487-1f3fe-200d-2640-fe0f","1f487-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["walking","pedestrian"],u:"1f6b6",v:["1f6b6-1f3fb","1f6b6-1f3fc","1f6b6-1f3fd","1f6b6-1f3fe","1f6b6-1f3ff"],a:"0.6"},{n:["man walking","man-walking"],u:"1f6b6-200d-2642-fe0f",v:["1f6b6-1f3fb-200d-2642-fe0f","1f6b6-1f3fc-200d-2642-fe0f","1f6b6-1f3fd-200d-2642-fe0f","1f6b6-1f3fe-200d-2642-fe0f","1f6b6-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman walking","woman-walking"],u:"1f6b6-200d-2640-fe0f",v:["1f6b6-1f3fb-200d-2640-fe0f","1f6b6-1f3fc-200d-2640-fe0f","1f6b6-1f3fd-200d-2640-fe0f","1f6b6-1f3fe-200d-2640-fe0f","1f6b6-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["standing person"],u:"1f9cd",v:["1f9cd-1f3fb","1f9cd-1f3fc","1f9cd-1f3fd","1f9cd-1f3fe","1f9cd-1f3ff"],a:"12.0"},{n:["man standing"],u:"1f9cd-200d-2642-fe0f",v:["1f9cd-1f3fb-200d-2642-fe0f","1f9cd-1f3fc-200d-2642-fe0f","1f9cd-1f3fd-200d-2642-fe0f","1f9cd-1f3fe-200d-2642-fe0f","1f9cd-1f3ff-200d-2642-fe0f"],a:"12.0"},{n:["woman standing"],u:"1f9cd-200d-2640-fe0f",v:["1f9cd-1f3fb-200d-2640-fe0f","1f9cd-1f3fc-200d-2640-fe0f","1f9cd-1f3fd-200d-2640-fe0f","1f9cd-1f3fe-200d-2640-fe0f","1f9cd-1f3ff-200d-2640-fe0f"],a:"12.0"},{n:["kneeling person"],u:"1f9ce",v:["1f9ce-1f3fb","1f9ce-1f3fc","1f9ce-1f3fd","1f9ce-1f3fe","1f9ce-1f3ff"],a:"12.0"},{n:["man kneeling"],u:"1f9ce-200d-2642-fe0f",v:["1f9ce-1f3fb-200d-2642-fe0f","1f9ce-1f3fc-200d-2642-fe0f","1f9ce-1f3fd-200d-2642-fe0f","1f9ce-1f3fe-200d-2642-fe0f","1f9ce-1f3ff-200d-2642-fe0f"],a:"12.0"},{n:["woman kneeling"],u:"1f9ce-200d-2640-fe0f",v:["1f9ce-1f3fb-200d-2640-fe0f","1f9ce-1f3fc-200d-2640-fe0f","1f9ce-1f3fd-200d-2640-fe0f","1f9ce-1f3fe-200d-2640-fe0f","1f9ce-1f3ff-200d-2640-fe0f"],a:"12.0"},{n:["person with white cane","person with probing cane"],u:"1f9d1-200d-1f9af",v:["1f9d1-1f3fb-200d-1f9af","1f9d1-1f3fc-200d-1f9af","1f9d1-1f3fd-200d-1f9af","1f9d1-1f3fe-200d-1f9af","1f9d1-1f3ff-200d-1f9af"],a:"12.1"},{n:["man with white cane","man with probing cane"],u:"1f468-200d-1f9af",v:["1f468-1f3fb-200d-1f9af","1f468-1f3fc-200d-1f9af","1f468-1f3fd-200d-1f9af","1f468-1f3fe-200d-1f9af","1f468-1f3ff-200d-1f9af"],a:"12.0"},{n:["woman with white cane","woman with probing cane"],u:"1f469-200d-1f9af",v:["1f469-1f3fb-200d-1f9af","1f469-1f3fc-200d-1f9af","1f469-1f3fd-200d-1f9af","1f469-1f3fe-200d-1f9af","1f469-1f3ff-200d-1f9af"],a:"12.0"},{n:["person in motorized wheelchair"],u:"1f9d1-200d-1f9bc",v:["1f9d1-1f3fb-200d-1f9bc","1f9d1-1f3fc-200d-1f9bc","1f9d1-1f3fd-200d-1f9bc","1f9d1-1f3fe-200d-1f9bc","1f9d1-1f3ff-200d-1f9bc"],a:"12.1"},{n:["man in motorized wheelchair"],u:"1f468-200d-1f9bc",v:["1f468-1f3fb-200d-1f9bc","1f468-1f3fc-200d-1f9bc","1f468-1f3fd-200d-1f9bc","1f468-1f3fe-200d-1f9bc","1f468-1f3ff-200d-1f9bc"],a:"12.0"},{n:["woman in motorized wheelchair"],u:"1f469-200d-1f9bc",v:["1f469-1f3fb-200d-1f9bc","1f469-1f3fc-200d-1f9bc","1f469-1f3fd-200d-1f9bc","1f469-1f3fe-200d-1f9bc","1f469-1f3ff-200d-1f9bc"],a:"12.0"},{n:["person in manual wheelchair"],u:"1f9d1-200d-1f9bd",v:["1f9d1-1f3fb-200d-1f9bd","1f9d1-1f3fc-200d-1f9bd","1f9d1-1f3fd-200d-1f9bd","1f9d1-1f3fe-200d-1f9bd","1f9d1-1f3ff-200d-1f9bd"],a:"12.1"},{n:["man in manual wheelchair"],u:"1f468-200d-1f9bd",v:["1f468-1f3fb-200d-1f9bd","1f468-1f3fc-200d-1f9bd","1f468-1f3fd-200d-1f9bd","1f468-1f3fe-200d-1f9bd","1f468-1f3ff-200d-1f9bd"],a:"12.0"},{n:["woman in manual wheelchair"],u:"1f469-200d-1f9bd",v:["1f469-1f3fb-200d-1f9bd","1f469-1f3fc-200d-1f9bd","1f469-1f3fd-200d-1f9bd","1f469-1f3fe-200d-1f9bd","1f469-1f3ff-200d-1f9bd"],a:"12.0"},{n:["runner","running"],u:"1f3c3",v:["1f3c3-1f3fb","1f3c3-1f3fc","1f3c3-1f3fd","1f3c3-1f3fe","1f3c3-1f3ff"],a:"0.6"},{n:["man running","man-running"],u:"1f3c3-200d-2642-fe0f",v:["1f3c3-1f3fb-200d-2642-fe0f","1f3c3-1f3fc-200d-2642-fe0f","1f3c3-1f3fd-200d-2642-fe0f","1f3c3-1f3fe-200d-2642-fe0f","1f3c3-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman running","woman-running"],u:"1f3c3-200d-2640-fe0f",v:["1f3c3-1f3fb-200d-2640-fe0f","1f3c3-1f3fc-200d-2640-fe0f","1f3c3-1f3fd-200d-2640-fe0f","1f3c3-1f3fe-200d-2640-fe0f","1f3c3-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["dancer"],u:"1f483",v:["1f483-1f3fb","1f483-1f3fc","1f483-1f3fd","1f483-1f3fe","1f483-1f3ff"],a:"0.6"},{n:["man dancing"],u:"1f57a",v:["1f57a-1f3fb","1f57a-1f3fc","1f57a-1f3fd","1f57a-1f3fe","1f57a-1f3ff"],a:"3.0"},{n:["person in suit levitating","man in business suit levitating"],u:"1f574-fe0f",v:["1f574-1f3fb","1f574-1f3fc","1f574-1f3fd","1f574-1f3fe","1f574-1f3ff"],a:"0.7"},{n:["dancers","woman with bunny ears"],u:"1f46f",a:"0.6"},{n:["men with bunny ears","men-with-bunny-ears-partying","man-with-bunny-ears-partying"],u:"1f46f-200d-2642-fe0f",a:"4.0"},{n:["women with bunny ears","women-with-bunny-ears-partying","woman-with-bunny-ears-partying"],u:"1f46f-200d-2640-fe0f",a:"4.0"},{n:["person in steamy room"],u:"1f9d6",v:["1f9d6-1f3fb","1f9d6-1f3fc","1f9d6-1f3fd","1f9d6-1f3fe","1f9d6-1f3ff"],a:"5.0"},{n:["man in steamy room"],u:"1f9d6-200d-2642-fe0f",v:["1f9d6-1f3fb-200d-2642-fe0f","1f9d6-1f3fc-200d-2642-fe0f","1f9d6-1f3fd-200d-2642-fe0f","1f9d6-1f3fe-200d-2642-fe0f","1f9d6-1f3ff-200d-2642-fe0f"],a:"5.0"},{n:["woman in steamy room"],u:"1f9d6-200d-2640-fe0f",v:["1f9d6-1f3fb-200d-2640-fe0f","1f9d6-1f3fc-200d-2640-fe0f","1f9d6-1f3fd-200d-2640-fe0f","1f9d6-1f3fe-200d-2640-fe0f","1f9d6-1f3ff-200d-2640-fe0f"],a:"5.0"},{n:["person climbing"],u:"1f9d7",v:["1f9d7-1f3fb","1f9d7-1f3fc","1f9d7-1f3fd","1f9d7-1f3fe","1f9d7-1f3ff"],a:"5.0"},{n:["man climbing"],u:"1f9d7-200d-2642-fe0f",v:["1f9d7-1f3fb-200d-2642-fe0f","1f9d7-1f3fc-200d-2642-fe0f","1f9d7-1f3fd-200d-2642-fe0f","1f9d7-1f3fe-200d-2642-fe0f","1f9d7-1f3ff-200d-2642-fe0f"],a:"5.0"},{n:["woman climbing"],u:"1f9d7-200d-2640-fe0f",v:["1f9d7-1f3fb-200d-2640-fe0f","1f9d7-1f3fc-200d-2640-fe0f","1f9d7-1f3fd-200d-2640-fe0f","1f9d7-1f3fe-200d-2640-fe0f","1f9d7-1f3ff-200d-2640-fe0f"],a:"5.0"},{n:["fencer"],u:"1f93a",a:"3.0"},{n:["horse racing"],u:"1f3c7",v:["1f3c7-1f3fb","1f3c7-1f3fc","1f3c7-1f3fd","1f3c7-1f3fe","1f3c7-1f3ff"],a:"1.0"},{n:["skier"],u:"26f7-fe0f",a:"0.7"},{n:["snowboarder"],u:"1f3c2",v:["1f3c2-1f3fb","1f3c2-1f3fc","1f3c2-1f3fd","1f3c2-1f3fe","1f3c2-1f3ff"],a:"0.6"},{n:["golfer","person golfing"],u:"1f3cc-fe0f",v:["1f3cc-1f3fb","1f3cc-1f3fc","1f3cc-1f3fd","1f3cc-1f3fe","1f3cc-1f3ff"],a:"0.7"},{n:["man golfing","man-golfing"],u:"1f3cc-fe0f-200d-2642-fe0f",v:["1f3cc-1f3fb-200d-2642-fe0f","1f3cc-1f3fc-200d-2642-fe0f","1f3cc-1f3fd-200d-2642-fe0f","1f3cc-1f3fe-200d-2642-fe0f","1f3cc-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman golfing","woman-golfing"],u:"1f3cc-fe0f-200d-2640-fe0f",v:["1f3cc-1f3fb-200d-2640-fe0f","1f3cc-1f3fc-200d-2640-fe0f","1f3cc-1f3fd-200d-2640-fe0f","1f3cc-1f3fe-200d-2640-fe0f","1f3cc-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["surfer"],u:"1f3c4",v:["1f3c4-1f3fb","1f3c4-1f3fc","1f3c4-1f3fd","1f3c4-1f3fe","1f3c4-1f3ff"],a:"0.6"},{n:["man surfing","man-surfing"],u:"1f3c4-200d-2642-fe0f",v:["1f3c4-1f3fb-200d-2642-fe0f","1f3c4-1f3fc-200d-2642-fe0f","1f3c4-1f3fd-200d-2642-fe0f","1f3c4-1f3fe-200d-2642-fe0f","1f3c4-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman surfing","woman-surfing"],u:"1f3c4-200d-2640-fe0f",v:["1f3c4-1f3fb-200d-2640-fe0f","1f3c4-1f3fc-200d-2640-fe0f","1f3c4-1f3fd-200d-2640-fe0f","1f3c4-1f3fe-200d-2640-fe0f","1f3c4-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["rowboat"],u:"1f6a3",v:["1f6a3-1f3fb","1f6a3-1f3fc","1f6a3-1f3fd","1f6a3-1f3fe","1f6a3-1f3ff"],a:"1.0"},{n:["man rowing boat","man-rowing-boat"],u:"1f6a3-200d-2642-fe0f",v:["1f6a3-1f3fb-200d-2642-fe0f","1f6a3-1f3fc-200d-2642-fe0f","1f6a3-1f3fd-200d-2642-fe0f","1f6a3-1f3fe-200d-2642-fe0f","1f6a3-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman rowing boat","woman-rowing-boat"],u:"1f6a3-200d-2640-fe0f",v:["1f6a3-1f3fb-200d-2640-fe0f","1f6a3-1f3fc-200d-2640-fe0f","1f6a3-1f3fd-200d-2640-fe0f","1f6a3-1f3fe-200d-2640-fe0f","1f6a3-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["swimmer"],u:"1f3ca",v:["1f3ca-1f3fb","1f3ca-1f3fc","1f3ca-1f3fd","1f3ca-1f3fe","1f3ca-1f3ff"],a:"0.6"},{n:["man swimming","man-swimming"],u:"1f3ca-200d-2642-fe0f",v:["1f3ca-1f3fb-200d-2642-fe0f","1f3ca-1f3fc-200d-2642-fe0f","1f3ca-1f3fd-200d-2642-fe0f","1f3ca-1f3fe-200d-2642-fe0f","1f3ca-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman swimming","woman-swimming"],u:"1f3ca-200d-2640-fe0f",v:["1f3ca-1f3fb-200d-2640-fe0f","1f3ca-1f3fc-200d-2640-fe0f","1f3ca-1f3fd-200d-2640-fe0f","1f3ca-1f3fe-200d-2640-fe0f","1f3ca-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["person with ball","person bouncing ball"],u:"26f9-fe0f",v:["26f9-1f3fb","26f9-1f3fc","26f9-1f3fd","26f9-1f3fe","26f9-1f3ff"],a:"0.7"},{n:["man bouncing ball","man-bouncing-ball"],u:"26f9-fe0f-200d-2642-fe0f",v:["26f9-1f3fb-200d-2642-fe0f","26f9-1f3fc-200d-2642-fe0f","26f9-1f3fd-200d-2642-fe0f","26f9-1f3fe-200d-2642-fe0f","26f9-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman bouncing ball","woman-bouncing-ball"],u:"26f9-fe0f-200d-2640-fe0f",v:["26f9-1f3fb-200d-2640-fe0f","26f9-1f3fc-200d-2640-fe0f","26f9-1f3fd-200d-2640-fe0f","26f9-1f3fe-200d-2640-fe0f","26f9-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["weight lifter","person lifting weights"],u:"1f3cb-fe0f",v:["1f3cb-1f3fb","1f3cb-1f3fc","1f3cb-1f3fd","1f3cb-1f3fe","1f3cb-1f3ff"],a:"0.7"},{n:["man lifting weights","man-lifting-weights"],u:"1f3cb-fe0f-200d-2642-fe0f",v:["1f3cb-1f3fb-200d-2642-fe0f","1f3cb-1f3fc-200d-2642-fe0f","1f3cb-1f3fd-200d-2642-fe0f","1f3cb-1f3fe-200d-2642-fe0f","1f3cb-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman lifting weights","woman-lifting-weights"],u:"1f3cb-fe0f-200d-2640-fe0f",v:["1f3cb-1f3fb-200d-2640-fe0f","1f3cb-1f3fc-200d-2640-fe0f","1f3cb-1f3fd-200d-2640-fe0f","1f3cb-1f3fe-200d-2640-fe0f","1f3cb-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["bicyclist"],u:"1f6b4",v:["1f6b4-1f3fb","1f6b4-1f3fc","1f6b4-1f3fd","1f6b4-1f3fe","1f6b4-1f3ff"],a:"1.0"},{n:["man biking","man-biking"],u:"1f6b4-200d-2642-fe0f",v:["1f6b4-1f3fb-200d-2642-fe0f","1f6b4-1f3fc-200d-2642-fe0f","1f6b4-1f3fd-200d-2642-fe0f","1f6b4-1f3fe-200d-2642-fe0f","1f6b4-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman biking","woman-biking"],u:"1f6b4-200d-2640-fe0f",v:["1f6b4-1f3fb-200d-2640-fe0f","1f6b4-1f3fc-200d-2640-fe0f","1f6b4-1f3fd-200d-2640-fe0f","1f6b4-1f3fe-200d-2640-fe0f","1f6b4-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["mountain bicyclist"],u:"1f6b5",v:["1f6b5-1f3fb","1f6b5-1f3fc","1f6b5-1f3fd","1f6b5-1f3fe","1f6b5-1f3ff"],a:"1.0"},{n:["man mountain biking","man-mountain-biking"],u:"1f6b5-200d-2642-fe0f",v:["1f6b5-1f3fb-200d-2642-fe0f","1f6b5-1f3fc-200d-2642-fe0f","1f6b5-1f3fd-200d-2642-fe0f","1f6b5-1f3fe-200d-2642-fe0f","1f6b5-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman mountain biking","woman-mountain-biking"],u:"1f6b5-200d-2640-fe0f",v:["1f6b5-1f3fb-200d-2640-fe0f","1f6b5-1f3fc-200d-2640-fe0f","1f6b5-1f3fd-200d-2640-fe0f","1f6b5-1f3fe-200d-2640-fe0f","1f6b5-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["person doing cartwheel"],u:"1f938",v:["1f938-1f3fb","1f938-1f3fc","1f938-1f3fd","1f938-1f3fe","1f938-1f3ff"],a:"3.0"},{n:["man cartwheeling","man-cartwheeling"],u:"1f938-200d-2642-fe0f",v:["1f938-1f3fb-200d-2642-fe0f","1f938-1f3fc-200d-2642-fe0f","1f938-1f3fd-200d-2642-fe0f","1f938-1f3fe-200d-2642-fe0f","1f938-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman cartwheeling","woman-cartwheeling"],u:"1f938-200d-2640-fe0f",v:["1f938-1f3fb-200d-2640-fe0f","1f938-1f3fc-200d-2640-fe0f","1f938-1f3fd-200d-2640-fe0f","1f938-1f3fe-200d-2640-fe0f","1f938-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["wrestlers"],u:"1f93c",a:"3.0"},{n:["men wrestling","man-wrestling"],u:"1f93c-200d-2642-fe0f",a:"4.0"},{n:["women wrestling","woman-wrestling"],u:"1f93c-200d-2640-fe0f",a:"4.0"},{n:["water polo"],u:"1f93d",v:["1f93d-1f3fb","1f93d-1f3fc","1f93d-1f3fd","1f93d-1f3fe","1f93d-1f3ff"],a:"3.0"},{n:["man playing water polo","man-playing-water-polo"],u:"1f93d-200d-2642-fe0f",v:["1f93d-1f3fb-200d-2642-fe0f","1f93d-1f3fc-200d-2642-fe0f","1f93d-1f3fd-200d-2642-fe0f","1f93d-1f3fe-200d-2642-fe0f","1f93d-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman playing water polo","woman-playing-water-polo"],u:"1f93d-200d-2640-fe0f",v:["1f93d-1f3fb-200d-2640-fe0f","1f93d-1f3fc-200d-2640-fe0f","1f93d-1f3fd-200d-2640-fe0f","1f93d-1f3fe-200d-2640-fe0f","1f93d-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["handball"],u:"1f93e",v:["1f93e-1f3fb","1f93e-1f3fc","1f93e-1f3fd","1f93e-1f3fe","1f93e-1f3ff"],a:"3.0"},{n:["man playing handball","man-playing-handball"],u:"1f93e-200d-2642-fe0f",v:["1f93e-1f3fb-200d-2642-fe0f","1f93e-1f3fc-200d-2642-fe0f","1f93e-1f3fd-200d-2642-fe0f","1f93e-1f3fe-200d-2642-fe0f","1f93e-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman playing handball","woman-playing-handball"],u:"1f93e-200d-2640-fe0f",v:["1f93e-1f3fb-200d-2640-fe0f","1f93e-1f3fc-200d-2640-fe0f","1f93e-1f3fd-200d-2640-fe0f","1f93e-1f3fe-200d-2640-fe0f","1f93e-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["juggling"],u:"1f939",v:["1f939-1f3fb","1f939-1f3fc","1f939-1f3fd","1f939-1f3fe","1f939-1f3ff"],a:"3.0"},{n:["man juggling","man-juggling"],u:"1f939-200d-2642-fe0f",v:["1f939-1f3fb-200d-2642-fe0f","1f939-1f3fc-200d-2642-fe0f","1f939-1f3fd-200d-2642-fe0f","1f939-1f3fe-200d-2642-fe0f","1f939-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman juggling","woman-juggling"],u:"1f939-200d-2640-fe0f",v:["1f939-1f3fb-200d-2640-fe0f","1f939-1f3fc-200d-2640-fe0f","1f939-1f3fd-200d-2640-fe0f","1f939-1f3fe-200d-2640-fe0f","1f939-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["person in lotus position"],u:"1f9d8",v:["1f9d8-1f3fb","1f9d8-1f3fc","1f9d8-1f3fd","1f9d8-1f3fe","1f9d8-1f3ff"],a:"5.0"},{n:["man in lotus position"],u:"1f9d8-200d-2642-fe0f",v:["1f9d8-1f3fb-200d-2642-fe0f","1f9d8-1f3fc-200d-2642-fe0f","1f9d8-1f3fd-200d-2642-fe0f","1f9d8-1f3fe-200d-2642-fe0f","1f9d8-1f3ff-200d-2642-fe0f"],a:"5.0"},{n:["woman in lotus position"],u:"1f9d8-200d-2640-fe0f",v:["1f9d8-1f3fb-200d-2640-fe0f","1f9d8-1f3fc-200d-2640-fe0f","1f9d8-1f3fd-200d-2640-fe0f","1f9d8-1f3fe-200d-2640-fe0f","1f9d8-1f3ff-200d-2640-fe0f"],a:"5.0"},{n:["bath"],u:"1f6c0",v:["1f6c0-1f3fb","1f6c0-1f3fc","1f6c0-1f3fd","1f6c0-1f3fe","1f6c0-1f3ff"],a:"0.6"},{n:["sleeping accommodation"],u:"1f6cc",v:["1f6cc-1f3fb","1f6cc-1f3fc","1f6cc-1f3fd","1f6cc-1f3fe","1f6cc-1f3ff"],a:"1.0"},{n:["people holding hands"],u:"1f9d1-200d-1f91d-200d-1f9d1",v:["1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3fb","1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3fc","1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3fd","1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3fe","1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3ff","1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3fb","1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3fc","1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3fd","1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3fe","1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3ff","1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3fb","1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3fc","1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3fd","1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3fe","1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3ff","1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3fb","1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3fc","1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3fd","1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3fe","1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3ff","1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3fb","1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3fc","1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3fd","1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3fe","1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3ff"],a:"12.0"},{n:["women holding hands","two women holding hands"],u:"1f46d",v:["1f46d-1f3fb","1f46d-1f3fc","1f46d-1f3fd","1f46d-1f3fe","1f46d-1f3ff","1f469-1f3fb-200d-1f91d-200d-1f469-1f3fc","1f469-1f3fb-200d-1f91d-200d-1f469-1f3fd","1f469-1f3fb-200d-1f91d-200d-1f469-1f3fe","1f469-1f3fb-200d-1f91d-200d-1f469-1f3ff","1f469-1f3fc-200d-1f91d-200d-1f469-1f3fb","1f469-1f3fc-200d-1f91d-200d-1f469-1f3fd","1f469-1f3fc-200d-1f91d-200d-1f469-1f3fe","1f469-1f3fc-200d-1f91d-200d-1f469-1f3ff","1f469-1f3fd-200d-1f91d-200d-1f469-1f3fb","1f469-1f3fd-200d-1f91d-200d-1f469-1f3fc","1f469-1f3fd-200d-1f91d-200d-1f469-1f3fe","1f469-1f3fd-200d-1f91d-200d-1f469-1f3ff","1f469-1f3fe-200d-1f91d-200d-1f469-1f3fb","1f469-1f3fe-200d-1f91d-200d-1f469-1f3fc","1f469-1f3fe-200d-1f91d-200d-1f469-1f3fd","1f469-1f3fe-200d-1f91d-200d-1f469-1f3ff","1f469-1f3ff-200d-1f91d-200d-1f469-1f3fb","1f469-1f3ff-200d-1f91d-200d-1f469-1f3fc","1f469-1f3ff-200d-1f91d-200d-1f469-1f3fd","1f469-1f3ff-200d-1f91d-200d-1f469-1f3fe"],a:"1.0"},{n:["couple","man and woman holding hands","woman and man holding hands"],u:"1f46b",v:["1f46b-1f3fb","1f46b-1f3fc","1f46b-1f3fd","1f46b-1f3fe","1f46b-1f3ff","1f469-1f3fb-200d-1f91d-200d-1f468-1f3fc","1f469-1f3fb-200d-1f91d-200d-1f468-1f3fd","1f469-1f3fb-200d-1f91d-200d-1f468-1f3fe","1f469-1f3fb-200d-1f91d-200d-1f468-1f3ff","1f469-1f3fc-200d-1f91d-200d-1f468-1f3fb","1f469-1f3fc-200d-1f91d-200d-1f468-1f3fd","1f469-1f3fc-200d-1f91d-200d-1f468-1f3fe","1f469-1f3fc-200d-1f91d-200d-1f468-1f3ff","1f469-1f3fd-200d-1f91d-200d-1f468-1f3fb","1f469-1f3fd-200d-1f91d-200d-1f468-1f3fc","1f469-1f3fd-200d-1f91d-200d-1f468-1f3fe","1f469-1f3fd-200d-1f91d-200d-1f468-1f3ff","1f469-1f3fe-200d-1f91d-200d-1f468-1f3fb","1f469-1f3fe-200d-1f91d-200d-1f468-1f3fc","1f469-1f3fe-200d-1f91d-200d-1f468-1f3fd","1f469-1f3fe-200d-1f91d-200d-1f468-1f3ff","1f469-1f3ff-200d-1f91d-200d-1f468-1f3fb","1f469-1f3ff-200d-1f91d-200d-1f468-1f3fc","1f469-1f3ff-200d-1f91d-200d-1f468-1f3fd","1f469-1f3ff-200d-1f91d-200d-1f468-1f3fe"],a:"0.6"},{n:["men holding hands","two men holding hands"],u:"1f46c",v:["1f46c-1f3fb","1f46c-1f3fc","1f46c-1f3fd","1f46c-1f3fe","1f46c-1f3ff","1f468-1f3fb-200d-1f91d-200d-1f468-1f3fc","1f468-1f3fb-200d-1f91d-200d-1f468-1f3fd","1f468-1f3fb-200d-1f91d-200d-1f468-1f3fe","1f468-1f3fb-200d-1f91d-200d-1f468-1f3ff","1f468-1f3fc-200d-1f91d-200d-1f468-1f3fb","1f468-1f3fc-200d-1f91d-200d-1f468-1f3fd","1f468-1f3fc-200d-1f91d-200d-1f468-1f3fe","1f468-1f3fc-200d-1f91d-200d-1f468-1f3ff","1f468-1f3fd-200d-1f91d-200d-1f468-1f3fb","1f468-1f3fd-200d-1f91d-200d-1f468-1f3fc","1f468-1f3fd-200d-1f91d-200d-1f468-1f3fe","1f468-1f3fd-200d-1f91d-200d-1f468-1f3ff","1f468-1f3fe-200d-1f91d-200d-1f468-1f3fb","1f468-1f3fe-200d-1f91d-200d-1f468-1f3fc","1f468-1f3fe-200d-1f91d-200d-1f468-1f3fd","1f468-1f3fe-200d-1f91d-200d-1f468-1f3ff","1f468-1f3ff-200d-1f91d-200d-1f468-1f3fb","1f468-1f3ff-200d-1f91d-200d-1f468-1f3fc","1f468-1f3ff-200d-1f91d-200d-1f468-1f3fd","1f468-1f3ff-200d-1f91d-200d-1f468-1f3fe"],a:"1.0"},{n:["kiss","couplekiss"],u:"1f48f",v:["1f48f-1f3fb","1f48f-1f3fc","1f48f-1f3fd","1f48f-1f3fe","1f48f-1f3ff","1f9d1-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fc","1f9d1-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fd","1f9d1-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fe","1f9d1-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3ff","1f9d1-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fb","1f9d1-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fd","1f9d1-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fe","1f9d1-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3ff","1f9d1-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fb","1f9d1-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fc","1f9d1-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fe","1f9d1-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3ff","1f9d1-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fb","1f9d1-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fc","1f9d1-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fd","1f9d1-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3ff","1f9d1-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fb","1f9d1-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fc","1f9d1-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fd","1f9d1-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fe"],a:"0.6"},{n:["woman-kiss-man","kiss: woman, man"],u:"1f469-200d-2764-fe0f-200d-1f48b-200d-1f468",v:["1f469-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fb","1f469-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fc","1f469-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fd","1f469-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fe","1f469-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3ff","1f469-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fb","1f469-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fc","1f469-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fd","1f469-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fe","1f469-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3ff","1f469-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fb","1f469-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fc","1f469-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fd","1f469-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fe","1f469-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3ff","1f469-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fb","1f469-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fc","1f469-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fd","1f469-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fe","1f469-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3ff","1f469-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fb","1f469-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fc","1f469-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fd","1f469-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fe","1f469-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3ff"],a:"2.0"},{n:["man-kiss-man","kiss: man, man"],u:"1f468-200d-2764-fe0f-200d-1f48b-200d-1f468",v:["1f468-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fb","1f468-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fc","1f468-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fd","1f468-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fe","1f468-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3ff","1f468-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fb","1f468-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fc","1f468-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fd","1f468-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fe","1f468-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3ff","1f468-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fb","1f468-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fc","1f468-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fd","1f468-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fe","1f468-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3ff","1f468-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fb","1f468-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fc","1f468-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fd","1f468-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fe","1f468-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3ff","1f468-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fb","1f468-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fc","1f468-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fd","1f468-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fe","1f468-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3ff"],a:"2.0"},{n:["woman-kiss-woman","kiss: woman, woman"],u:"1f469-200d-2764-fe0f-200d-1f48b-200d-1f469",v:["1f469-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fb","1f469-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fc","1f469-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fd","1f469-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fe","1f469-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3ff","1f469-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fb","1f469-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fc","1f469-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fd","1f469-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fe","1f469-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3ff","1f469-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fb","1f469-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fc","1f469-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fd","1f469-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fe","1f469-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3ff","1f469-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fb","1f469-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fc","1f469-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fd","1f469-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fe","1f469-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3ff","1f469-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fb","1f469-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fc","1f469-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fd","1f469-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fe","1f469-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3ff"],a:"2.0"},{n:["couple with heart"],u:"1f491",v:["1f491-1f3fb","1f491-1f3fc","1f491-1f3fd","1f491-1f3fe","1f491-1f3ff","1f9d1-1f3fb-200d-2764-fe0f-200d-1f9d1-1f3fc","1f9d1-1f3fb-200d-2764-fe0f-200d-1f9d1-1f3fd","1f9d1-1f3fb-200d-2764-fe0f-200d-1f9d1-1f3fe","1f9d1-1f3fb-200d-2764-fe0f-200d-1f9d1-1f3ff","1f9d1-1f3fc-200d-2764-fe0f-200d-1f9d1-1f3fb","1f9d1-1f3fc-200d-2764-fe0f-200d-1f9d1-1f3fd","1f9d1-1f3fc-200d-2764-fe0f-200d-1f9d1-1f3fe","1f9d1-1f3fc-200d-2764-fe0f-200d-1f9d1-1f3ff","1f9d1-1f3fd-200d-2764-fe0f-200d-1f9d1-1f3fb","1f9d1-1f3fd-200d-2764-fe0f-200d-1f9d1-1f3fc","1f9d1-1f3fd-200d-2764-fe0f-200d-1f9d1-1f3fe","1f9d1-1f3fd-200d-2764-fe0f-200d-1f9d1-1f3ff","1f9d1-1f3fe-200d-2764-fe0f-200d-1f9d1-1f3fb","1f9d1-1f3fe-200d-2764-fe0f-200d-1f9d1-1f3fc","1f9d1-1f3fe-200d-2764-fe0f-200d-1f9d1-1f3fd","1f9d1-1f3fe-200d-2764-fe0f-200d-1f9d1-1f3ff","1f9d1-1f3ff-200d-2764-fe0f-200d-1f9d1-1f3fb","1f9d1-1f3ff-200d-2764-fe0f-200d-1f9d1-1f3fc","1f9d1-1f3ff-200d-2764-fe0f-200d-1f9d1-1f3fd","1f9d1-1f3ff-200d-2764-fe0f-200d-1f9d1-1f3fe"],a:"0.6"},{n:["woman-heart-man","couple with heart: woman, man"],u:"1f469-200d-2764-fe0f-200d-1f468",v:["1f469-1f3fb-200d-2764-fe0f-200d-1f468-1f3fb","1f469-1f3fb-200d-2764-fe0f-200d-1f468-1f3fc","1f469-1f3fb-200d-2764-fe0f-200d-1f468-1f3fd","1f469-1f3fb-200d-2764-fe0f-200d-1f468-1f3fe","1f469-1f3fb-200d-2764-fe0f-200d-1f468-1f3ff","1f469-1f3fc-200d-2764-fe0f-200d-1f468-1f3fb","1f469-1f3fc-200d-2764-fe0f-200d-1f468-1f3fc","1f469-1f3fc-200d-2764-fe0f-200d-1f468-1f3fd","1f469-1f3fc-200d-2764-fe0f-200d-1f468-1f3fe","1f469-1f3fc-200d-2764-fe0f-200d-1f468-1f3ff","1f469-1f3fd-200d-2764-fe0f-200d-1f468-1f3fb","1f469-1f3fd-200d-2764-fe0f-200d-1f468-1f3fc","1f469-1f3fd-200d-2764-fe0f-200d-1f468-1f3fd","1f469-1f3fd-200d-2764-fe0f-200d-1f468-1f3fe","1f469-1f3fd-200d-2764-fe0f-200d-1f468-1f3ff","1f469-1f3fe-200d-2764-fe0f-200d-1f468-1f3fb","1f469-1f3fe-200d-2764-fe0f-200d-1f468-1f3fc","1f469-1f3fe-200d-2764-fe0f-200d-1f468-1f3fd","1f469-1f3fe-200d-2764-fe0f-200d-1f468-1f3fe","1f469-1f3fe-200d-2764-fe0f-200d-1f468-1f3ff","1f469-1f3ff-200d-2764-fe0f-200d-1f468-1f3fb","1f469-1f3ff-200d-2764-fe0f-200d-1f468-1f3fc","1f469-1f3ff-200d-2764-fe0f-200d-1f468-1f3fd","1f469-1f3ff-200d-2764-fe0f-200d-1f468-1f3fe","1f469-1f3ff-200d-2764-fe0f-200d-1f468-1f3ff"],a:"2.0"},{n:["man-heart-man","couple with heart: man, man"],u:"1f468-200d-2764-fe0f-200d-1f468",v:["1f468-1f3fb-200d-2764-fe0f-200d-1f468-1f3fb","1f468-1f3fb-200d-2764-fe0f-200d-1f468-1f3fc","1f468-1f3fb-200d-2764-fe0f-200d-1f468-1f3fd","1f468-1f3fb-200d-2764-fe0f-200d-1f468-1f3fe","1f468-1f3fb-200d-2764-fe0f-200d-1f468-1f3ff","1f468-1f3fc-200d-2764-fe0f-200d-1f468-1f3fb","1f468-1f3fc-200d-2764-fe0f-200d-1f468-1f3fc","1f468-1f3fc-200d-2764-fe0f-200d-1f468-1f3fd","1f468-1f3fc-200d-2764-fe0f-200d-1f468-1f3fe","1f468-1f3fc-200d-2764-fe0f-200d-1f468-1f3ff","1f468-1f3fd-200d-2764-fe0f-200d-1f468-1f3fb","1f468-1f3fd-200d-2764-fe0f-200d-1f468-1f3fc","1f468-1f3fd-200d-2764-fe0f-200d-1f468-1f3fd","1f468-1f3fd-200d-2764-fe0f-200d-1f468-1f3fe","1f468-1f3fd-200d-2764-fe0f-200d-1f468-1f3ff","1f468-1f3fe-200d-2764-fe0f-200d-1f468-1f3fb","1f468-1f3fe-200d-2764-fe0f-200d-1f468-1f3fc","1f468-1f3fe-200d-2764-fe0f-200d-1f468-1f3fd","1f468-1f3fe-200d-2764-fe0f-200d-1f468-1f3fe","1f468-1f3fe-200d-2764-fe0f-200d-1f468-1f3ff","1f468-1f3ff-200d-2764-fe0f-200d-1f468-1f3fb","1f468-1f3ff-200d-2764-fe0f-200d-1f468-1f3fc","1f468-1f3ff-200d-2764-fe0f-200d-1f468-1f3fd","1f468-1f3ff-200d-2764-fe0f-200d-1f468-1f3fe","1f468-1f3ff-200d-2764-fe0f-200d-1f468-1f3ff"],a:"2.0"},{n:["woman-heart-woman","couple with heart: woman, woman"],u:"1f469-200d-2764-fe0f-200d-1f469",v:["1f469-1f3fb-200d-2764-fe0f-200d-1f469-1f3fb","1f469-1f3fb-200d-2764-fe0f-200d-1f469-1f3fc","1f469-1f3fb-200d-2764-fe0f-200d-1f469-1f3fd","1f469-1f3fb-200d-2764-fe0f-200d-1f469-1f3fe","1f469-1f3fb-200d-2764-fe0f-200d-1f469-1f3ff","1f469-1f3fc-200d-2764-fe0f-200d-1f469-1f3fb","1f469-1f3fc-200d-2764-fe0f-200d-1f469-1f3fc","1f469-1f3fc-200d-2764-fe0f-200d-1f469-1f3fd","1f469-1f3fc-200d-2764-fe0f-200d-1f469-1f3fe","1f469-1f3fc-200d-2764-fe0f-200d-1f469-1f3ff","1f469-1f3fd-200d-2764-fe0f-200d-1f469-1f3fb","1f469-1f3fd-200d-2764-fe0f-200d-1f469-1f3fc","1f469-1f3fd-200d-2764-fe0f-200d-1f469-1f3fd","1f469-1f3fd-200d-2764-fe0f-200d-1f469-1f3fe","1f469-1f3fd-200d-2764-fe0f-200d-1f469-1f3ff","1f469-1f3fe-200d-2764-fe0f-200d-1f469-1f3fb","1f469-1f3fe-200d-2764-fe0f-200d-1f469-1f3fc","1f469-1f3fe-200d-2764-fe0f-200d-1f469-1f3fd","1f469-1f3fe-200d-2764-fe0f-200d-1f469-1f3fe","1f469-1f3fe-200d-2764-fe0f-200d-1f469-1f3ff","1f469-1f3ff-200d-2764-fe0f-200d-1f469-1f3fb","1f469-1f3ff-200d-2764-fe0f-200d-1f469-1f3fc","1f469-1f3ff-200d-2764-fe0f-200d-1f469-1f3fd","1f469-1f3ff-200d-2764-fe0f-200d-1f469-1f3fe","1f469-1f3ff-200d-2764-fe0f-200d-1f469-1f3ff"],a:"2.0"},{n:["family"],u:"1f46a",a:"0.6"},{n:["man-woman-boy","family: man, woman, boy"],u:"1f468-200d-1f469-200d-1f466",a:"2.0"},{n:["man-woman-girl","family: man, woman, girl"],u:"1f468-200d-1f469-200d-1f467",a:"2.0"},{n:["man-woman-girl-boy","family: man, woman, girl, boy"],u:"1f468-200d-1f469-200d-1f467-200d-1f466",a:"2.0"},{n:["man-woman-boy-boy","family: man, woman, boy, boy"],u:"1f468-200d-1f469-200d-1f466-200d-1f466",a:"2.0"},{n:["man-woman-girl-girl","family: man, woman, girl, girl"],u:"1f468-200d-1f469-200d-1f467-200d-1f467",a:"2.0"},{n:["man-man-boy","family: man, man, boy"],u:"1f468-200d-1f468-200d-1f466",a:"2.0"},{n:["man-man-girl","family: man, man, girl"],u:"1f468-200d-1f468-200d-1f467",a:"2.0"},{n:["man-man-girl-boy","family: man, man, girl, boy"],u:"1f468-200d-1f468-200d-1f467-200d-1f466",a:"2.0"},{n:["man-man-boy-boy","family: man, man, boy, boy"],u:"1f468-200d-1f468-200d-1f466-200d-1f466",a:"2.0"},{n:["man-man-girl-girl","family: man, man, girl, girl"],u:"1f468-200d-1f468-200d-1f467-200d-1f467",a:"2.0"},{n:["woman-woman-boy","family: woman, woman, boy"],u:"1f469-200d-1f469-200d-1f466",a:"2.0"},{n:["woman-woman-girl","family: woman, woman, girl"],u:"1f469-200d-1f469-200d-1f467",a:"2.0"},{n:["woman-woman-girl-boy","family: woman, woman, girl, boy"],u:"1f469-200d-1f469-200d-1f467-200d-1f466",a:"2.0"},{n:["woman-woman-boy-boy","family: woman, woman, boy, boy"],u:"1f469-200d-1f469-200d-1f466-200d-1f466",a:"2.0"},{n:["woman-woman-girl-girl","family: woman, woman, girl, girl"],u:"1f469-200d-1f469-200d-1f467-200d-1f467",a:"2.0"},{n:["man-boy","family: man, boy"],u:"1f468-200d-1f466",a:"4.0"},{n:["man-boy-boy","family: man, boy, boy"],u:"1f468-200d-1f466-200d-1f466",a:"4.0"},{n:["man-girl","family: man, girl"],u:"1f468-200d-1f467",a:"4.0"},{n:["man-girl-boy","family: man, girl, boy"],u:"1f468-200d-1f467-200d-1f466",a:"4.0"},{n:["man-girl-girl","family: man, girl, girl"],u:"1f468-200d-1f467-200d-1f467",a:"4.0"},{n:["woman-boy","family: woman, boy"],u:"1f469-200d-1f466",a:"4.0"},{n:["woman-boy-boy","family: woman, boy, boy"],u:"1f469-200d-1f466-200d-1f466",a:"4.0"},{n:["woman-girl","family: woman, girl"],u:"1f469-200d-1f467",a:"4.0"},{n:["woman-girl-boy","family: woman, girl, boy"],u:"1f469-200d-1f467-200d-1f466",a:"4.0"},{n:["woman-girl-girl","family: woman, girl, girl"],u:"1f469-200d-1f467-200d-1f467",a:"4.0"},{n:["speaking head","speaking head in silhouette"],u:"1f5e3-fe0f",a:"0.7"},{n:["bust in silhouette"],u:"1f464",a:"0.6"},{n:["busts in silhouette"],u:"1f465",a:"1.0"},{n:["people hugging"],u:"1fac2",a:"13.0"},{n:["footprints"],u:"1f463",a:"0.6"}],animals_nature:[{n:["monkey face"],u:"1f435",a:"0.6"},{n:["monkey"],u:"1f412",a:"0.6"},{n:["gorilla"],u:"1f98d",a:"3.0"},{n:["orangutan"],u:"1f9a7",a:"12.0"},{n:["dog","dog face"],u:"1f436",a:"0.6"},{n:["dog","dog2"],u:"1f415",a:"0.7"},{n:["guide dog"],u:"1f9ae",a:"12.0"},{n:["service dog"],u:"1f415-200d-1f9ba",a:"12.0"},{n:["poodle"],u:"1f429",a:"0.6"},{n:["wolf","wolf face"],u:"1f43a",a:"0.6"},{n:["fox face"],u:"1f98a",a:"3.0"},{n:["raccoon"],u:"1f99d",a:"11.0"},{n:["cat","cat face"],u:"1f431",a:"0.6"},{n:["cat","cat2"],u:"1f408",a:"0.7"},{n:["black cat"],u:"1f408-200d-2b1b",a:"13.0"},{n:["lion face"],u:"1f981",a:"1.0"},{n:["tiger","tiger face"],u:"1f42f",a:"0.6"},{n:["tiger","tiger2"],u:"1f405",a:"1.0"},{n:["leopard"],u:"1f406",a:"1.0"},{n:["horse","horse face"],u:"1f434",a:"0.6"},{n:["horse","racehorse"],u:"1f40e",a:"0.6"},{n:["unicorn face"],u:"1f984",a:"1.0"},{n:["zebra face"],u:"1f993",a:"5.0"},{n:["deer"],u:"1f98c",a:"3.0"},{n:["bison"],u:"1f9ac",a:"13.0"},{n:["cow","cow face"],u:"1f42e",a:"0.6"},{n:["ox"],u:"1f402",a:"1.0"},{n:["water buffalo"],u:"1f403",a:"1.0"},{n:["cow","cow2"],u:"1f404",a:"1.0"},{n:["pig","pig face"],u:"1f437",a:"0.6"},{n:["pig","pig2"],u:"1f416",a:"1.0"},{n:["boar"],u:"1f417",a:"0.6"},{n:["pig nose"],u:"1f43d",a:"0.6"},{n:["ram"],u:"1f40f",a:"1.0"},{n:["sheep"],u:"1f411",a:"0.6"},{n:["goat"],u:"1f410",a:"1.0"},{n:["dromedary camel"],u:"1f42a",a:"1.0"},{n:["camel","bactrian camel"],u:"1f42b",a:"0.6"},{n:["llama"],u:"1f999",a:"11.0"},{n:["giraffe face"],u:"1f992",a:"5.0"},{n:["elephant"],u:"1f418",a:"0.6"},{n:["mammoth"],u:"1f9a3",a:"13.0"},{n:["rhinoceros"],u:"1f98f",a:"3.0"},{n:["hippopotamus"],u:"1f99b",a:"11.0"},{n:["mouse","mouse face"],u:"1f42d",a:"0.6"},{n:["mouse","mouse2"],u:"1f401",a:"1.0"},{n:["rat"],u:"1f400",a:"1.0"},{n:["hamster","hamster face"],u:"1f439",a:"0.6"},{n:["rabbit","rabbit face"],u:"1f430",a:"0.6"},{n:["rabbit","rabbit2"],u:"1f407",a:"1.0"},{n:["chipmunk"],u:"1f43f-fe0f",a:"0.7"},{n:["beaver"],u:"1f9ab",a:"13.0"},{n:["hedgehog"],u:"1f994",a:"5.0"},{n:["bat"],u:"1f987",a:"3.0"},{n:["bear","bear face"],u:"1f43b",a:"0.6"},{n:["polar bear"],u:"1f43b-200d-2744-fe0f",a:"13.0"},{n:["koala"],u:"1f428",a:"0.6"},{n:["panda face"],u:"1f43c",a:"0.6"},{n:["sloth"],u:"1f9a5",a:"12.0"},{n:["otter"],u:"1f9a6",a:"12.0"},{n:["skunk"],u:"1f9a8",a:"12.0"},{n:["kangaroo"],u:"1f998",a:"11.0"},{n:["badger"],u:"1f9a1",a:"11.0"},{n:["feet","paw prints"],u:"1f43e",a:"0.6"},{n:["turkey"],u:"1f983",a:"1.0"},{n:["chicken"],u:"1f414",a:"0.6"},{n:["rooster"],u:"1f413",a:"1.0"},{n:["hatching chick"],u:"1f423",a:"0.6"},{n:["baby chick"],u:"1f424",a:"0.6"},{n:["hatched chick","front-facing baby chick"],u:"1f425",a:"0.6"},{n:["bird"],u:"1f426",a:"0.6"},{n:["penguin"],u:"1f427",a:"0.6"},{n:["dove","dove of peace"],u:"1f54a-fe0f",a:"0.7"},{n:["eagle"],u:"1f985",a:"3.0"},{n:["duck"],u:"1f986",a:"3.0"},{n:["swan"],u:"1f9a2",a:"11.0"},{n:["owl"],u:"1f989",a:"3.0"},{n:["dodo"],u:"1f9a4",a:"13.0"},{n:["feather"],u:"1fab6",a:"13.0"},{n:["flamingo"],u:"1f9a9",a:"12.0"},{n:["peacock"],u:"1f99a",a:"11.0"},{n:["parrot"],u:"1f99c",a:"11.0"},{n:["frog","frog face"],u:"1f438",a:"0.6"},{n:["crocodile"],u:"1f40a",a:"1.0"},{n:["turtle"],u:"1f422",a:"0.6"},{n:["lizard"],u:"1f98e",a:"3.0"},{n:["snake"],u:"1f40d",a:"0.6"},{n:["dragon face"],u:"1f432",a:"0.6"},{n:["dragon"],u:"1f409",a:"1.0"},{n:["sauropod"],u:"1f995",a:"5.0"},{n:["t-rex"],u:"1f996",a:"5.0"},{n:["whale","spouting whale"],u:"1f433",a:"0.6"},{n:["whale","whale2"],u:"1f40b",a:"1.0"},{n:["dolphin","flipper"],u:"1f42c",a:"0.6"},{n:["seal"],u:"1f9ad",a:"13.0"},{n:["fish"],u:"1f41f",a:"0.6"},{n:["tropical fish"],u:"1f420",a:"0.6"},{n:["blowfish"],u:"1f421",a:"0.6"},{n:["shark"],u:"1f988",a:"3.0"},{n:["octopus"],u:"1f419",a:"0.6"},{n:["shell","spiral shell"],u:"1f41a",a:"0.6"},{n:["coral"],u:"1fab8",a:"14.0"},{n:["snail"],u:"1f40c",a:"0.6"},{n:["butterfly"],u:"1f98b",a:"3.0"},{n:["bug"],u:"1f41b",a:"0.6"},{n:["ant"],u:"1f41c",a:"0.6"},{n:["bee","honeybee"],u:"1f41d",a:"0.6"},{n:["beetle"],u:"1fab2",a:"13.0"},{n:["ladybug","lady beetle"],u:"1f41e",a:"0.6"},{n:["cricket"],u:"1f997",a:"5.0"},{n:["cockroach"],u:"1fab3",a:"13.0"},{n:["spider"],u:"1f577-fe0f",a:"0.7"},{n:["spider web"],u:"1f578-fe0f",a:"0.7"},{n:["scorpion"],u:"1f982",a:"1.0"},{n:["mosquito"],u:"1f99f",a:"11.0"},{n:["fly"],u:"1fab0",a:"13.0"},{n:["worm"],u:"1fab1",a:"13.0"},{n:["microbe"],u:"1f9a0",a:"11.0"},{n:["bouquet"],u:"1f490",a:"0.6"},{n:["cherry blossom"],u:"1f338",a:"0.6"},{n:["white flower"],u:"1f4ae",a:"0.6"},{n:["lotus"],u:"1fab7",a:"14.0"},{n:["rosette"],u:"1f3f5-fe0f",a:"0.7"},{n:["rose"],u:"1f339",a:"0.6"},{n:["wilted flower"],u:"1f940",a:"3.0"},{n:["hibiscus"],u:"1f33a",a:"0.6"},{n:["sunflower"],u:"1f33b",a:"0.6"},{n:["blossom"],u:"1f33c",a:"0.6"},{n:["tulip"],u:"1f337",a:"0.6"},{n:["seedling"],u:"1f331",a:"0.6"},{n:["potted plant"],u:"1fab4",a:"13.0"},{n:["evergreen tree"],u:"1f332",a:"1.0"},{n:["deciduous tree"],u:"1f333",a:"1.0"},{n:["palm tree"],u:"1f334",a:"0.6"},{n:["cactus"],u:"1f335",a:"0.6"},{n:["ear of rice"],u:"1f33e",a:"0.6"},{n:["herb"],u:"1f33f",a:"0.6"},{n:["shamrock"],u:"2618-fe0f",a:"1.0"},{n:["four leaf clover"],u:"1f340",a:"0.6"},{n:["maple leaf"],u:"1f341",a:"0.6"},{n:["fallen leaf"],u:"1f342",a:"0.6"},{n:["leaves","leaf fluttering in wind"],u:"1f343",a:"0.6"},{n:["empty nest"],u:"1fab9",a:"14.0"},{n:["nest with eggs"],u:"1faba",a:"14.0"}],food_drink:[{n:["grapes"],u:"1f347",a:"0.6"},{n:["melon"],u:"1f348",a:"0.6"},{n:["watermelon"],u:"1f349",a:"0.6"},{n:["tangerine"],u:"1f34a",a:"0.6"},{n:["lemon"],u:"1f34b",a:"1.0"},{n:["banana"],u:"1f34c",a:"0.6"},{n:["pineapple"],u:"1f34d",a:"0.6"},{n:["mango"],u:"1f96d",a:"11.0"},{n:["apple","red apple"],u:"1f34e",a:"0.6"},{n:["green apple"],u:"1f34f",a:"0.6"},{n:["pear"],u:"1f350",a:"1.0"},{n:["peach"],u:"1f351",a:"0.6"},{n:["cherries"],u:"1f352",a:"0.6"},{n:["strawberry"],u:"1f353",a:"0.6"},{n:["blueberries"],u:"1fad0",a:"13.0"},{n:["kiwifruit"],u:"1f95d",a:"3.0"},{n:["tomato"],u:"1f345",a:"0.6"},{n:["olive"],u:"1fad2",a:"13.0"},{n:["coconut"],u:"1f965",a:"5.0"},{n:["avocado"],u:"1f951",a:"3.0"},{n:["eggplant","aubergine"],u:"1f346",a:"0.6"},{n:["potato"],u:"1f954",a:"3.0"},{n:["carrot"],u:"1f955",a:"3.0"},{n:["corn","ear of maize"],u:"1f33d",a:"0.6"},{n:["hot pepper"],u:"1f336-fe0f",a:"0.7"},{n:["bell pepper"],u:"1fad1",a:"13.0"},{n:["cucumber"],u:"1f952",a:"3.0"},{n:["leafy green"],u:"1f96c",a:"11.0"},{n:["broccoli"],u:"1f966",a:"5.0"},{n:["garlic"],u:"1f9c4",a:"12.0"},{n:["onion"],u:"1f9c5",a:"12.0"},{n:["mushroom"],u:"1f344",a:"0.6"},{n:["peanuts"],u:"1f95c",a:"3.0"},{n:["beans"],u:"1fad8",a:"14.0"},{n:["chestnut"],u:"1f330",a:"0.6"},{n:["bread"],u:"1f35e",a:"0.6"},{n:["croissant"],u:"1f950",a:"3.0"},{n:["baguette bread"],u:"1f956",a:"3.0"},{n:["flatbread"],u:"1fad3",a:"13.0"},{n:["pretzel"],u:"1f968",a:"5.0"},{n:["bagel"],u:"1f96f",a:"11.0"},{n:["pancakes"],u:"1f95e",a:"3.0"},{n:["waffle"],u:"1f9c7",a:"12.0"},{n:["cheese wedge"],u:"1f9c0",a:"1.0"},{n:["meat on bone"],u:"1f356",a:"0.6"},{n:["poultry leg"],u:"1f357",a:"0.6"},{n:["cut of meat"],u:"1f969",a:"5.0"},{n:["bacon"],u:"1f953",a:"3.0"},{n:["hamburger"],u:"1f354",a:"0.6"},{n:["fries","french fries"],u:"1f35f",a:"0.6"},{n:["pizza","slice of pizza"],u:"1f355",a:"0.6"},{n:["hotdog","hot dog"],u:"1f32d",a:"1.0"},{n:["sandwich"],u:"1f96a",a:"5.0"},{n:["taco"],u:"1f32e",a:"1.0"},{n:["burrito"],u:"1f32f",a:"1.0"},{n:["tamale"],u:"1fad4",a:"13.0"},{n:["stuffed flatbread"],u:"1f959",a:"3.0"},{n:["falafel"],u:"1f9c6",a:"12.0"},{n:["egg"],u:"1f95a",a:"3.0"},{n:["cooking","fried egg"],u:"1f373",a:"0.6"},{n:["shallow pan of food"],u:"1f958",a:"3.0"},{n:["stew","pot of food"],u:"1f372",a:"0.6"},{n:["fondue"],u:"1fad5",a:"13.0"},{n:["bowl with spoon"],u:"1f963",a:"5.0"},{n:["green salad"],u:"1f957",a:"3.0"},{n:["popcorn"],u:"1f37f",a:"1.0"},{n:["butter"],u:"1f9c8",a:"12.0"},{n:["salt","salt shaker"],u:"1f9c2",a:"11.0"},{n:["canned food"],u:"1f96b",a:"5.0"},{n:["bento","bento box"],u:"1f371",a:"0.6"},{n:["rice cracker"],u:"1f358",a:"0.6"},{n:["rice ball"],u:"1f359",a:"0.6"},{n:["rice","cooked rice"],u:"1f35a",a:"0.6"},{n:["curry","curry and rice"],u:"1f35b",a:"0.6"},{n:["ramen","steaming bowl"],u:"1f35c",a:"0.6"},{n:["spaghetti"],u:"1f35d",a:"0.6"},{n:["sweet potato","roasted sweet potato"],u:"1f360",a:"0.6"},{n:["oden"],u:"1f362",a:"0.6"},{n:["sushi"],u:"1f363",a:"0.6"},{n:["fried shrimp"],u:"1f364",a:"0.6"},{n:["fish cake","fish cake with swirl design"],u:"1f365",a:"0.6"},{n:["moon cake"],u:"1f96e",a:"11.0"},{n:["dango"],u:"1f361",a:"0.6"},{n:["dumpling"],u:"1f95f",a:"5.0"},{n:["fortune cookie"],u:"1f960",a:"5.0"},{n:["takeout box"],u:"1f961",a:"5.0"},{n:["crab"],u:"1f980",a:"1.0"},{n:["lobster"],u:"1f99e",a:"11.0"},{n:["shrimp"],u:"1f990",a:"3.0"},{n:["squid"],u:"1f991",a:"3.0"},{n:["oyster"],u:"1f9aa",a:"12.0"},{n:["icecream","soft ice cream"],u:"1f366",a:"0.6"},{n:["shaved ice"],u:"1f367",a:"0.6"},{n:["ice cream"],u:"1f368",a:"0.6"},{n:["doughnut"],u:"1f369",a:"0.6"},{n:["cookie"],u:"1f36a",a:"0.6"},{n:["birthday","birthday cake"],u:"1f382",a:"0.6"},{n:["cake","shortcake"],u:"1f370",a:"0.6"},{n:["cupcake"],u:"1f9c1",a:"11.0"},{n:["pie"],u:"1f967",a:"5.0"},{n:["chocolate bar"],u:"1f36b",a:"0.6"},{n:["candy"],u:"1f36c",a:"0.6"},{n:["lollipop"],u:"1f36d",a:"0.6"},{n:["custard"],u:"1f36e",a:"0.6"},{n:["honey pot"],u:"1f36f",a:"0.6"},{n:["baby bottle"],u:"1f37c",a:"1.0"},{n:["glass of milk"],u:"1f95b",a:"3.0"},{n:["coffee","hot beverage"],u:"2615",a:"0.6"},{n:["teapot"],u:"1fad6",a:"13.0"},{n:["tea","teacup without handle"],u:"1f375",a:"0.6"},{n:["sake","sake bottle and cup"],u:"1f376",a:"0.6"},{n:["champagne","bottle with popping cork"],u:"1f37e",a:"1.0"},{n:["wine glass"],u:"1f377",a:"0.6"},{n:["cocktail","cocktail glass"],u:"1f378",a:"0.6"},{n:["tropical drink"],u:"1f379",a:"0.6"},{n:["beer","beer mug"],u:"1f37a",a:"0.6"},{n:["beers","clinking beer mugs"],u:"1f37b",a:"0.6"},{n:["clinking glasses"],u:"1f942",a:"3.0"},{n:["tumbler glass"],u:"1f943",a:"3.0"},{n:["pouring liquid"],u:"1fad7",a:"14.0"},{n:["cup with straw"],u:"1f964",a:"5.0"},{n:["bubble tea"],u:"1f9cb",a:"13.0"},{n:["beverage box"],u:"1f9c3",a:"12.0"},{n:["mate drink"],u:"1f9c9",a:"12.0"},{n:["ice cube"],u:"1f9ca",a:"12.0"},{n:["chopsticks"],u:"1f962",a:"5.0"},{n:["knife fork plate","fork and knife with plate"],u:"1f37d-fe0f",a:"0.7"},{n:["fork and knife"],u:"1f374",a:"0.6"},{n:["spoon"],u:"1f944",a:"3.0"},{n:["hocho","knife"],u:"1f52a",a:"0.6"},{n:["jar"],u:"1fad9",a:"14.0"},{n:["amphora"],u:"1f3fa",a:"1.0"}],travel_places:[{n:["earth africa","earth globe europe-africa"],u:"1f30d",a:"0.7"},{n:["earth americas","earth globe americas"],u:"1f30e",a:"0.7"},{n:["earth asia","earth globe asia-australia"],u:"1f30f",a:"0.6"},{n:["globe with meridians"],u:"1f310",a:"1.0"},{n:["world map"],u:"1f5fa-fe0f",a:"0.7"},{n:["japan","silhouette of japan"],u:"1f5fe",a:"0.6"},{n:["compass"],u:"1f9ed",a:"11.0"},{n:["snow-capped mountain","snow capped mountain"],u:"1f3d4-fe0f",a:"0.7"},{n:["mountain"],u:"26f0-fe0f",a:"0.7"},{n:["volcano"],u:"1f30b",a:"0.6"},{n:["mount fuji"],u:"1f5fb",a:"0.6"},{n:["camping"],u:"1f3d5-fe0f",a:"0.7"},{n:["beach with umbrella"],u:"1f3d6-fe0f",a:"0.7"},{n:["desert"],u:"1f3dc-fe0f",a:"0.7"},{n:["desert island"],u:"1f3dd-fe0f",a:"0.7"},{n:["national park"],u:"1f3de-fe0f",a:"0.7"},{n:["stadium"],u:"1f3df-fe0f",a:"0.7"},{n:["classical building"],u:"1f3db-fe0f",a:"0.7"},{n:["building construction"],u:"1f3d7-fe0f",a:"0.7"},{n:["brick","bricks"],u:"1f9f1",a:"11.0"},{n:["rock"],u:"1faa8",a:"13.0"},{n:["wood"],u:"1fab5",a:"13.0"},{n:["hut"],u:"1f6d6",a:"13.0"},{n:["houses","house buildings"],u:"1f3d8-fe0f",a:"0.7"},{n:["derelict house","derelict house building"],u:"1f3da-fe0f",a:"0.7"},{n:["house","house building"],u:"1f3e0",a:"0.6"},{n:["house with garden"],u:"1f3e1",a:"0.6"},{n:["office","office building"],u:"1f3e2",a:"0.6"},{n:["post office","japanese post office"],u:"1f3e3",a:"0.6"},{n:["european post office"],u:"1f3e4",a:"1.0"},{n:["hospital"],u:"1f3e5",a:"0.6"},{n:["bank"],u:"1f3e6",a:"0.6"},{n:["hotel"],u:"1f3e8",a:"0.6"},{n:["love hotel"],u:"1f3e9",a:"0.6"},{n:["convenience store"],u:"1f3ea",a:"0.6"},{n:["school"],u:"1f3eb",a:"0.6"},{n:["department store"],u:"1f3ec",a:"0.6"},{n:["factory"],u:"1f3ed",a:"0.6"},{n:["japanese castle"],u:"1f3ef",a:"0.6"},{n:["european castle"],u:"1f3f0",a:"0.6"},{n:["wedding"],u:"1f492",a:"0.6"},{n:["tokyo tower"],u:"1f5fc",a:"0.6"},{n:["statue of liberty"],u:"1f5fd",a:"0.6"},{n:["church"],u:"26ea",a:"0.6"},{n:["mosque"],u:"1f54c",a:"1.0"},{n:["hindu temple"],u:"1f6d5",a:"12.0"},{n:["synagogue"],u:"1f54d",a:"1.0"},{n:["shinto shrine"],u:"26e9-fe0f",a:"0.7"},{n:["kaaba"],u:"1f54b",a:"1.0"},{n:["fountain"],u:"26f2",a:"0.6"},{n:["tent"],u:"26fa",a:"0.6"},{n:["foggy"],u:"1f301",a:"0.6"},{n:["night with stars"],u:"1f303",a:"0.6"},{n:["cityscape"],u:"1f3d9-fe0f",a:"0.7"},{n:["sunrise over mountains"],u:"1f304",a:"0.6"},{n:["sunrise"],u:"1f305",a:"0.6"},{n:["city sunset","cityscape at dusk"],u:"1f306",a:"0.6"},{n:["city sunrise","sunset over buildings"],u:"1f307",a:"0.6"},{n:["bridge at night"],u:"1f309",a:"0.6"},{n:["hotsprings","hot springs"],u:"2668-fe0f",a:"0.6"},{n:["carousel horse"],u:"1f3a0",a:"0.6"},{n:["playground slide"],u:"1f6dd",a:"14.0"},{n:["ferris wheel"],u:"1f3a1",a:"0.6"},{n:["roller coaster"],u:"1f3a2",a:"0.6"},{n:["barber","barber pole"],u:"1f488",a:"0.6"},{n:["circus tent"],u:"1f3aa",a:"0.6"},{n:["steam locomotive"],u:"1f682",a:"1.0"},{n:["railway car"],u:"1f683",a:"0.6"},{n:["high-speed train","bullettrain side"],u:"1f684",a:"0.6"},{n:["bullettrain front","high-speed train with bullet nose"],u:"1f685",a:"0.6"},{n:["train","train2"],u:"1f686",a:"1.0"},{n:["metro"],u:"1f687",a:"0.6"},{n:["light rail"],u:"1f688",a:"1.0"},{n:["station"],u:"1f689",a:"0.6"},{n:["tram"],u:"1f68a",a:"1.0"},{n:["monorail"],u:"1f69d",a:"1.0"},{n:["mountain railway"],u:"1f69e",a:"1.0"},{n:["train","tram car"],u:"1f68b",a:"1.0"},{n:["bus"],u:"1f68c",a:"0.6"},{n:["oncoming bus"],u:"1f68d",a:"0.7"},{n:["trolleybus"],u:"1f68e",a:"1.0"},{n:["minibus"],u:"1f690",a:"1.0"},{n:["ambulance"],u:"1f691",a:"0.6"},{n:["fire engine"],u:"1f692",a:"0.6"},{n:["police car"],u:"1f693",a:"0.6"},{n:["oncoming police car"],u:"1f694",a:"0.7"},{n:["taxi"],u:"1f695",a:"0.6"},{n:["oncoming taxi"],u:"1f696",a:"1.0"},{n:["car","red car","automobile"],u:"1f697",a:"0.6"},{n:["oncoming automobile"],u:"1f698",a:"0.7"},{n:["blue car","recreational vehicle"],u:"1f699",a:"0.6"},{n:["pickup truck"],u:"1f6fb",a:"13.0"},{n:["truck","delivery truck"],u:"1f69a",a:"0.6"},{n:["articulated lorry"],u:"1f69b",a:"1.0"},{n:["tractor"],u:"1f69c",a:"1.0"},{n:["racing car"],u:"1f3ce-fe0f",a:"0.7"},{n:["motorcycle","racing motorcycle"],u:"1f3cd-fe0f",a:"0.7"},{n:["motor scooter"],u:"1f6f5",a:"3.0"},{n:["manual wheelchair"],u:"1f9bd",a:"12.0"},{n:["motorized wheelchair"],u:"1f9bc",a:"12.0"},{n:["auto rickshaw"],u:"1f6fa",a:"12.0"},{n:["bike","bicycle"],u:"1f6b2",a:"0.6"},{n:["scooter"],u:"1f6f4",a:"3.0"},{n:["skateboard"],u:"1f6f9",a:"11.0"},{n:["roller skate"],u:"1f6fc",a:"13.0"},{n:["busstop","bus stop"],u:"1f68f",a:"0.6"},{n:["motorway"],u:"1f6e3-fe0f",a:"0.7"},{n:["railway track"],u:"1f6e4-fe0f",a:"0.7"},{n:["oil drum"],u:"1f6e2-fe0f",a:"0.7"},{n:["fuelpump","fuel pump"],u:"26fd",a:"0.6"},{n:["wheel"],u:"1f6de",a:"14.0"},{n:["rotating light","police cars revolving light"],u:"1f6a8",a:"0.6"},{n:["traffic light","horizontal traffic light"],u:"1f6a5",a:"0.6"},{n:["vertical traffic light"],u:"1f6a6",a:"1.0"},{n:["octagonal sign"],u:"1f6d1",a:"3.0"},{n:["construction","construction sign"],u:"1f6a7",a:"0.6"},{n:["anchor"],u:"2693",a:"0.6"},{n:["ring buoy"],u:"1f6df",a:"14.0"},{n:["boat","sailboat"],u:"26f5",a:"0.6"},{n:["canoe"],u:"1f6f6",a:"3.0"},{n:["speedboat"],u:"1f6a4",a:"0.6"},{n:["passenger ship"],u:"1f6f3-fe0f",a:"0.7"},{n:["ferry"],u:"26f4-fe0f",a:"0.7"},{n:["motor boat"],u:"1f6e5-fe0f",a:"0.7"},{n:["ship"],u:"1f6a2",a:"0.6"},{n:["airplane"],u:"2708-fe0f",a:"0.6"},{n:["small airplane"],u:"1f6e9-fe0f",a:"0.7"},{n:["airplane departure"],u:"1f6eb",a:"1.0"},{n:["airplane arriving"],u:"1f6ec",a:"1.0"},{n:["parachute"],u:"1fa82",a:"12.0"},{n:["seat"],u:"1f4ba",a:"0.6"},{n:["helicopter"],u:"1f681",a:"1.0"},{n:["suspension railway"],u:"1f69f",a:"1.0"},{n:["mountain cableway"],u:"1f6a0",a:"1.0"},{n:["aerial tramway"],u:"1f6a1",a:"1.0"},{n:["satellite"],u:"1f6f0-fe0f",a:"0.7"},{n:["rocket"],u:"1f680",a:"0.6"},{n:["flying saucer"],u:"1f6f8",a:"5.0"},{n:["bellhop bell"],u:"1f6ce-fe0f",a:"0.7"},{n:["luggage"],u:"1f9f3",a:"11.0"},{n:["hourglass"],u:"231b",a:"0.6"},{n:["hourglass flowing sand","hourglass with flowing sand"],u:"23f3",a:"0.6"},{n:["watch"],u:"231a",a:"0.6"},{n:["alarm clock"],u:"23f0",a:"0.6"},{n:["stopwatch"],u:"23f1-fe0f",a:"1.0"},{n:["timer clock"],u:"23f2-fe0f",a:"1.0"},{n:["mantelpiece clock"],u:"1f570-fe0f",a:"0.7"},{n:["clock12","clock face twelve oclock"],u:"1f55b",a:"0.6"},{n:["clock1230","clock face twelve-thirty"],u:"1f567",a:"0.7"},{n:["clock1","clock face one oclock"],u:"1f550",a:"0.6"},{n:["clock130","clock face one-thirty"],u:"1f55c",a:"0.7"},{n:["clock2","clock face two oclock"],u:"1f551",a:"0.6"},{n:["clock230","clock face two-thirty"],u:"1f55d",a:"0.7"},{n:["clock3","clock face three oclock"],u:"1f552",a:"0.6"},{n:["clock330","clock face three-thirty"],u:"1f55e",a:"0.7"},{n:["clock4","clock face four oclock"],u:"1f553",a:"0.6"},{n:["clock430","clock face four-thirty"],u:"1f55f",a:"0.7"},{n:["clock5","clock face five oclock"],u:"1f554",a:"0.6"},{n:["clock530","clock face five-thirty"],u:"1f560",a:"0.7"},{n:["clock6","clock face six oclock"],u:"1f555",a:"0.6"},{n:["clock630","clock face six-thirty"],u:"1f561",a:"0.7"},{n:["clock7","clock face seven oclock"],u:"1f556",a:"0.6"},{n:["clock730","clock face seven-thirty"],u:"1f562",a:"0.7"},{n:["clock8","clock face eight oclock"],u:"1f557",a:"0.6"},{n:["clock830","clock face eight-thirty"],u:"1f563",a:"0.7"},{n:["clock9","clock face nine oclock"],u:"1f558",a:"0.6"},{n:["clock930","clock face nine-thirty"],u:"1f564",a:"0.7"},{n:["clock10","clock face ten oclock"],u:"1f559",a:"0.6"},{n:["clock1030","clock face ten-thirty"],u:"1f565",a:"0.7"},{n:["clock11","clock face eleven oclock"],u:"1f55a",a:"0.6"},{n:["clock1130","clock face eleven-thirty"],u:"1f566",a:"0.7"},{n:["new moon","new moon symbol"],u:"1f311",a:"0.6"},{n:["waxing crescent moon","waxing crescent moon symbol"],u:"1f312",a:"1.0"},{n:["first quarter moon","first quarter moon symbol"],u:"1f313",a:"0.6"},{n:["moon","waxing gibbous moon","waxing gibbous moon symbol"],u:"1f314",a:"0.6"},{n:["full moon","full moon symbol"],u:"1f315",a:"0.6"},{n:["waning gibbous moon","waning gibbous moon symbol"],u:"1f316",a:"1.0"},{n:["last quarter moon","last quarter moon symbol"],u:"1f317",a:"1.0"},{n:["waning crescent moon","waning crescent moon symbol"],u:"1f318",a:"1.0"},{n:["crescent moon"],u:"1f319",a:"0.6"},{n:["new moon with face"],u:"1f31a",a:"1.0"},{n:["first quarter moon with face"],u:"1f31b",a:"0.6"},{n:["last quarter moon with face"],u:"1f31c",a:"0.7"},{n:["thermometer"],u:"1f321-fe0f",a:"0.7"},{n:["sunny","black sun with rays"],u:"2600-fe0f",a:"0.6"},{n:["full moon with face"],u:"1f31d",a:"1.0"},{n:["sun with face"],u:"1f31e",a:"1.0"},{n:["ringed planet"],u:"1fa90",a:"12.0"},{n:["star","white medium star"],u:"2b50",a:"0.6"},{n:["star2","glowing star"],u:"1f31f",a:"0.6"},{n:["stars","shooting star"],u:"1f320",a:"0.6"},{n:["milky way"],u:"1f30c",a:"0.6"},{n:["cloud"],u:"2601-fe0f",a:"0.6"},{n:["partly sunny","sun behind cloud"],u:"26c5",a:"0.6"},{n:["thunder cloud and rain","cloud with lightning and rain"],u:"26c8-fe0f",a:"0.7"},{n:["mostly sunny","sun small cloud","sun behind small cloud"],u:"1f324-fe0f",a:"0.7"},{n:["barely sunny","sun behind cloud","sun behind large cloud"],u:"1f325-fe0f",a:"0.7"},{n:["partly sunny rain","sun behind rain cloud"],u:"1f326-fe0f",a:"0.7"},{n:["rain cloud","cloud with rain"],u:"1f327-fe0f",a:"0.7"},{n:["snow cloud","cloud with snow"],u:"1f328-fe0f",a:"0.7"},{n:["lightning","lightning cloud","cloud with lightning"],u:"1f329-fe0f",a:"0.7"},{n:["tornado","tornado cloud"],u:"1f32a-fe0f",a:"0.7"},{n:["fog"],u:"1f32b-fe0f",a:"0.7"},{n:["wind face","wind blowing face"],u:"1f32c-fe0f",a:"0.7"},{n:["cyclone"],u:"1f300",a:"0.6"},{n:["rainbow"],u:"1f308",a:"0.6"},{n:["closed umbrella"],u:"1f302",a:"0.6"},{n:["umbrella"],u:"2602-fe0f",a:"0.7"},{n:["umbrella with rain drops"],u:"2614",a:"0.6"},{n:["umbrella on ground"],u:"26f1-fe0f",a:"0.7"},{n:["zap","high voltage sign"],u:"26a1",a:"0.6"},{n:["snowflake"],u:"2744-fe0f",a:"0.6"},{n:["snowman"],u:"2603-fe0f",a:"0.7"},{n:["snowman without snow"],u:"26c4",a:"0.6"},{n:["comet"],u:"2604-fe0f",a:"1.0"},{n:["fire"],u:"1f525",a:"0.6"},{n:["droplet"],u:"1f4a7",a:"0.6"},{n:["ocean","water wave"],u:"1f30a",a:"0.6"}],activities:[{n:["jack-o-lantern","jack o lantern"],u:"1f383",a:"0.6"},{n:["christmas tree"],u:"1f384",a:"0.6"},{n:["fireworks"],u:"1f386",a:"0.6"},{n:["sparkler","firework sparkler"],u:"1f387",a:"0.6"},{n:["firecracker"],u:"1f9e8",a:"11.0"},{n:["sparkles"],u:"2728",a:"0.6"},{n:["balloon"],u:"1f388",a:"0.6"},{n:["tada","party popper"],u:"1f389",a:"0.6"},{n:["confetti ball"],u:"1f38a",a:"0.6"},{n:["tanabata tree"],u:"1f38b",a:"0.6"},{n:["bamboo","pine decoration"],u:"1f38d",a:"0.6"},{n:["dolls","japanese dolls"],u:"1f38e",a:"0.6"},{n:["flags","carp streamer"],u:"1f38f",a:"0.6"},{n:["wind chime"],u:"1f390",a:"0.6"},{n:["rice scene","moon viewing ceremony"],u:"1f391",a:"0.6"},{n:["red envelope","red gift envelope"],u:"1f9e7",a:"11.0"},{n:["ribbon"],u:"1f380",a:"0.6"},{n:["gift","wrapped present"],u:"1f381",a:"0.6"},{n:["reminder ribbon"],u:"1f397-fe0f",a:"0.7"},{n:["admission tickets"],u:"1f39f-fe0f",a:"0.7"},{n:["ticket"],u:"1f3ab",a:"0.6"},{n:["medal","military medal"],u:"1f396-fe0f",a:"0.7"},{n:["trophy"],u:"1f3c6",a:"0.6"},{n:["sports medal"],u:"1f3c5",a:"1.0"},{n:["first place medal"],u:"1f947",a:"3.0"},{n:["second place medal"],u:"1f948",a:"3.0"},{n:["third place medal"],u:"1f949",a:"3.0"},{n:["soccer","soccer ball"],u:"26bd",a:"0.6"},{n:["baseball"],u:"26be",a:"0.6"},{n:["softball"],u:"1f94e",a:"11.0"},{n:["basketball","basketball and hoop"],u:"1f3c0",a:"0.6"},{n:["volleyball"],u:"1f3d0",a:"1.0"},{n:["football","american football"],u:"1f3c8",a:"0.6"},{n:["rugby football"],u:"1f3c9",a:"1.0"},{n:["tennis","tennis racquet and ball"],u:"1f3be",a:"0.6"},{n:["flying disc"],u:"1f94f",a:"11.0"},{n:["bowling"],u:"1f3b3",a:"0.6"},{n:["cricket bat and ball"],u:"1f3cf",a:"1.0"},{n:["field hockey stick and ball"],u:"1f3d1",a:"1.0"},{n:["ice hockey stick and puck"],u:"1f3d2",a:"1.0"},{n:["lacrosse","lacrosse stick and ball"],u:"1f94d",a:"11.0"},{n:["table tennis paddle and ball"],u:"1f3d3",a:"1.0"},{n:["badminton racquet and shuttlecock"],u:"1f3f8",a:"1.0"},{n:["boxing glove"],u:"1f94a",a:"3.0"},{n:["martial arts uniform"],u:"1f94b",a:"3.0"},{n:["goal net"],u:"1f945",a:"3.0"},{n:["golf","flag in hole"],u:"26f3",a:"0.6"},{n:["ice skate"],u:"26f8-fe0f",a:"0.7"},{n:["fishing pole and fish"],u:"1f3a3",a:"0.6"},{n:["diving mask"],u:"1f93f",a:"12.0"},{n:["running shirt with sash"],u:"1f3bd",a:"0.6"},{n:["ski","ski and ski boot"],u:"1f3bf",a:"0.6"},{n:["sled"],u:"1f6f7",a:"5.0"},{n:["curling stone"],u:"1f94c",a:"5.0"},{n:["dart","direct hit"],u:"1f3af",a:"0.6"},{n:["yo-yo"],u:"1fa80",a:"12.0"},{n:["kite"],u:"1fa81",a:"12.0"},{n:["8ball","billiards"],u:"1f3b1",a:"0.6"},{n:["crystal ball"],u:"1f52e",a:"0.6"},{n:["magic wand"],u:"1fa84",a:"13.0"},{n:["nazar amulet"],u:"1f9ff",a:"11.0"},{n:["hamsa"],u:"1faac",a:"14.0"},{n:["video game"],u:"1f3ae",a:"0.6"},{n:["joystick"],u:"1f579-fe0f",a:"0.7"},{n:["slot machine"],u:"1f3b0",a:"0.6"},{n:["game die"],u:"1f3b2",a:"0.6"},{n:["jigsaw","jigsaw puzzle piece"],u:"1f9e9",a:"11.0"},{n:["teddy bear"],u:"1f9f8",a:"11.0"},{n:["pinata"],u:"1fa85",a:"13.0"},{n:["mirror ball"],u:"1faa9",a:"14.0"},{n:["nesting dolls"],u:"1fa86",a:"13.0"},{n:["spades","black spade suit"],u:"2660-fe0f",a:"0.6"},{n:["hearts","black heart suit"],u:"2665-fe0f",a:"0.6"},{n:["diamonds","black diamond suit"],u:"2666-fe0f",a:"0.6"},{n:["clubs","black club suit"],u:"2663-fe0f",a:"0.6"},{n:["chess pawn"],u:"265f-fe0f",a:"11.0"},{n:["black joker","playing card black joker"],u:"1f0cf",a:"0.6"},{n:["mahjong","mahjong tile red dragon"],u:"1f004",a:"0.6"},{n:["flower playing cards"],u:"1f3b4",a:"0.6"},{n:["performing arts"],u:"1f3ad",a:"0.6"},{n:["framed picture","frame with picture"],u:"1f5bc-fe0f",a:"0.7"},{n:["art","artist palette"],u:"1f3a8",a:"0.6"},{n:["thread","spool of thread"],u:"1f9f5",a:"11.0"},{n:["sewing needle"],u:"1faa1",a:"13.0"},{n:["yarn","ball of yarn"],u:"1f9f6",a:"11.0"},{n:["knot"],u:"1faa2",a:"13.0"}],objects:[{n:["eyeglasses"],u:"1f453",a:"0.6"},{n:["sunglasses","dark sunglasses"],u:"1f576-fe0f",a:"0.7"},{n:["goggles"],u:"1f97d",a:"11.0"},{n:["lab coat"],u:"1f97c",a:"11.0"},{n:["safety vest"],u:"1f9ba",a:"12.0"},{n:["necktie"],u:"1f454",a:"0.6"},{n:["shirt","tshirt","t-shirt"],u:"1f455",a:"0.6"},{n:["jeans"],u:"1f456",a:"0.6"},{n:["scarf"],u:"1f9e3",a:"5.0"},{n:["gloves"],u:"1f9e4",a:"5.0"},{n:["coat"],u:"1f9e5",a:"5.0"},{n:["socks"],u:"1f9e6",a:"5.0"},{n:["dress"],u:"1f457",a:"0.6"},{n:["kimono"],u:"1f458",a:"0.6"},{n:["sari"],u:"1f97b",a:"12.0"},{n:["one-piece swimsuit"],u:"1fa71",a:"12.0"},{n:["briefs"],u:"1fa72",a:"12.0"},{n:["shorts"],u:"1fa73",a:"12.0"},{n:["bikini"],u:"1f459",a:"0.6"},{n:["womans clothes"],u:"1f45a",a:"0.6"},{n:["purse"],u:"1f45b",a:"0.6"},{n:["handbag"],u:"1f45c",a:"0.6"},{n:["pouch"],u:"1f45d",a:"0.6"},{n:["shopping bags"],u:"1f6cd-fe0f",a:"0.7"},{n:["school satchel"],u:"1f392",a:"0.6"},{n:["thong sandal"],u:"1fa74",a:"13.0"},{n:["shoe","mans shoe"],u:"1f45e",a:"0.6"},{n:["athletic shoe"],u:"1f45f",a:"0.6"},{n:["hiking boot"],u:"1f97e",a:"11.0"},{n:["flat shoe","womans flat shoe"],u:"1f97f",a:"11.0"},{n:["high heel","high-heeled shoe"],u:"1f460",a:"0.6"},{n:["sandal","womans sandal"],u:"1f461",a:"0.6"},{n:["ballet shoes"],u:"1fa70",a:"12.0"},{n:["boot","womans boots"],u:"1f462",a:"0.6"},{n:["crown"],u:"1f451",a:"0.6"},{n:["womans hat"],u:"1f452",a:"0.6"},{n:["tophat","top hat"],u:"1f3a9",a:"0.6"},{n:["mortar board","graduation cap"],u:"1f393",a:"0.6"},{n:["billed cap"],u:"1f9e2",a:"5.0"},{n:["military helmet"],u:"1fa96",a:"13.0"},{n:["rescue worker\u2019s helmet","helmet with white cross"],u:"26d1-fe0f",a:"0.7"},{n:["prayer beads"],u:"1f4ff",a:"1.0"},{n:["lipstick"],u:"1f484",a:"0.6"},{n:["ring"],u:"1f48d",a:"0.6"},{n:["gem","gem stone"],u:"1f48e",a:"0.6"},{n:["mute","speaker with cancellation stroke"],u:"1f507",a:"1.0"},{n:["speaker"],u:"1f508",a:"0.7"},{n:["sound","speaker with one sound wave"],u:"1f509",a:"1.0"},{n:["loud sound","speaker with three sound waves"],u:"1f50a",a:"0.6"},{n:["loudspeaker","public address loudspeaker"],u:"1f4e2",a:"0.6"},{n:["mega","cheering megaphone"],u:"1f4e3",a:"0.6"},{n:["postal horn"],u:"1f4ef",a:"1.0"},{n:["bell"],u:"1f514",a:"0.6"},{n:["no bell","bell with cancellation stroke"],u:"1f515",a:"1.0"},{n:["musical score"],u:"1f3bc",a:"0.6"},{n:["musical note"],u:"1f3b5",a:"0.6"},{n:["notes","multiple musical notes"],u:"1f3b6",a:"0.6"},{n:["studio microphone"],u:"1f399-fe0f",a:"0.7"},{n:["level slider"],u:"1f39a-fe0f",a:"0.7"},{n:["control knobs"],u:"1f39b-fe0f",a:"0.7"},{n:["microphone"],u:"1f3a4",a:"0.6"},{n:["headphone","headphones"],u:"1f3a7",a:"0.6"},{n:["radio"],u:"1f4fb",a:"0.6"},{n:["saxophone"],u:"1f3b7",a:"0.6"},{n:["accordion"],u:"1fa97",a:"13.0"},{n:["guitar"],u:"1f3b8",a:"0.6"},{n:["musical keyboard"],u:"1f3b9",a:"0.6"},{n:["trumpet"],u:"1f3ba",a:"0.6"},{n:["violin"],u:"1f3bb",a:"0.6"},{n:["banjo"],u:"1fa95",a:"12.0"},{n:["drum with drumsticks"],u:"1f941",a:"3.0"},{n:["long drum"],u:"1fa98",a:"13.0"},{n:["iphone","mobile phone"],u:"1f4f1",a:"0.6"},{n:["calling","mobile phone with rightwards arrow at left"],u:"1f4f2",a:"0.6"},{n:["phone","telephone","black telephone"],u:"260e-fe0f",a:"0.6"},{n:["telephone receiver"],u:"1f4de",a:"0.6"},{n:["pager"],u:"1f4df",a:"0.6"},{n:["fax","fax machine"],u:"1f4e0",a:"0.6"},{n:["battery"],u:"1f50b",a:"0.6"},{n:["low battery"],u:"1faab",a:"14.0"},{n:["electric plug"],u:"1f50c",a:"0.6"},{n:["computer","personal computer"],u:"1f4bb",a:"0.6"},{n:["desktop computer"],u:"1f5a5-fe0f",a:"0.7"},{n:["printer"],u:"1f5a8-fe0f",a:"0.7"},{n:["keyboard"],u:"2328-fe0f",a:"1.0"},{n:["computer mouse","three button mouse"],u:"1f5b1-fe0f",a:"0.7"},{n:["trackball"],u:"1f5b2-fe0f",a:"0.7"},{n:["minidisc"],u:"1f4bd",a:"0.6"},{n:["floppy disk"],u:"1f4be",a:"0.6"},{n:["cd","optical disc"],u:"1f4bf",a:"0.6"},{n:["dvd"],u:"1f4c0",a:"0.6"},{n:["abacus"],u:"1f9ee",a:"11.0"},{n:["movie camera"],u:"1f3a5",a:"0.6"},{n:["film frames"],u:"1f39e-fe0f",a:"0.7"},{n:["film projector"],u:"1f4fd-fe0f",a:"0.7"},{n:["clapper","clapper board"],u:"1f3ac",a:"0.6"},{n:["tv","television"],u:"1f4fa",a:"0.6"},{n:["camera"],u:"1f4f7",a:"0.6"},{n:["camera with flash"],u:"1f4f8",a:"1.0"},{n:["video camera"],u:"1f4f9",a:"0.6"},{n:["vhs","videocassette"],u:"1f4fc",a:"0.6"},{n:["mag","left-pointing magnifying glass"],u:"1f50d",a:"0.6"},{n:["mag right","right-pointing magnifying glass"],u:"1f50e",a:"0.6"},{n:["candle"],u:"1f56f-fe0f",a:"0.7"},{n:["bulb","electric light bulb"],u:"1f4a1",a:"0.6"},{n:["flashlight","electric torch"],u:"1f526",a:"0.6"},{n:["lantern","izakaya lantern"],u:"1f3ee",a:"0.6"},{n:["diya lamp"],u:"1fa94",a:"12.0"},{n:["notebook with decorative cover"],u:"1f4d4",a:"0.6"},{n:["closed book"],u:"1f4d5",a:"0.6"},{n:["book","open book"],u:"1f4d6",a:"0.6"},{n:["green book"],u:"1f4d7",a:"0.6"},{n:["blue book"],u:"1f4d8",a:"0.6"},{n:["orange book"],u:"1f4d9",a:"0.6"},{n:["books"],u:"1f4da",a:"0.6"},{n:["notebook"],u:"1f4d3",a:"0.6"},{n:["ledger"],u:"1f4d2",a:"0.6"},{n:["page with curl"],u:"1f4c3",a:"0.6"},{n:["scroll"],u:"1f4dc",a:"0.6"},{n:["page facing up"],u:"1f4c4",a:"0.6"},{n:["newspaper"],u:"1f4f0",a:"0.6"},{n:["rolled-up newspaper","rolled up newspaper"],u:"1f5de-fe0f",a:"0.7"},{n:["bookmark tabs"],u:"1f4d1",a:"0.6"},{n:["bookmark"],u:"1f516",a:"0.6"},{n:["label"],u:"1f3f7-fe0f",a:"0.7"},{n:["moneybag","money bag"],u:"1f4b0",a:"0.6"},{n:["coin"],u:"1fa99",a:"13.0"},{n:["yen","banknote with yen sign"],u:"1f4b4",a:"0.6"},{n:["dollar","banknote with dollar sign"],u:"1f4b5",a:"0.6"},{n:["euro","banknote with euro sign"],u:"1f4b6",a:"1.0"},{n:["pound","banknote with pound sign"],u:"1f4b7",a:"1.0"},{n:["money with wings"],u:"1f4b8",a:"0.6"},{n:["credit card"],u:"1f4b3",a:"0.6"},{n:["receipt"],u:"1f9fe",a:"11.0"},{n:["chart","chart with upwards trend and yen sign"],u:"1f4b9",a:"0.6"},{n:["email","envelope"],u:"2709-fe0f",a:"0.6"},{n:["e-mail","e-mail symbol"],u:"1f4e7",a:"0.6"},{n:["incoming envelope"],u:"1f4e8",a:"0.6"},{n:["envelope with arrow","envelope with downwards arrow above"],u:"1f4e9",a:"0.6"},{n:["outbox tray"],u:"1f4e4",a:"0.6"},{n:["inbox tray"],u:"1f4e5",a:"0.6"},{n:["package"],u:"1f4e6",a:"0.6"},{n:["mailbox","closed mailbox with raised flag"],u:"1f4eb",a:"0.6"},{n:["mailbox closed","closed mailbox with lowered flag"],u:"1f4ea",a:"0.6"},{n:["mailbox with mail","open mailbox with raised flag"],u:"1f4ec",a:"0.7"},{n:["mailbox with no mail","open mailbox with lowered flag"],u:"1f4ed",a:"0.7"},{n:["postbox"],u:"1f4ee",a:"0.6"},{n:["ballot box with ballot"],u:"1f5f3-fe0f",a:"0.7"},{n:["pencil","pencil2"],u:"270f-fe0f",a:"0.6"},{n:["black nib"],u:"2712-fe0f",a:"0.6"},{n:["fountain pen","lower left fountain pen"],u:"1f58b-fe0f",a:"0.7"},{n:["pen","lower left ballpoint pen"],u:"1f58a-fe0f",a:"0.7"},{n:["paintbrush","lower left paintbrush"],u:"1f58c-fe0f",a:"0.7"},{n:["crayon","lower left crayon"],u:"1f58d-fe0f",a:"0.7"},{n:["memo","pencil"],u:"1f4dd",a:"0.6"},{n:["briefcase"],u:"1f4bc",a:"0.6"},{n:["file folder"],u:"1f4c1",a:"0.6"},{n:["open file folder"],u:"1f4c2",a:"0.6"},{n:["card index dividers"],u:"1f5c2-fe0f",a:"0.7"},{n:["date","calendar"],u:"1f4c5",a:"0.6"},{n:["calendar","tear-off calendar"],u:"1f4c6",a:"0.6"},{n:["spiral notepad","spiral note pad"],u:"1f5d2-fe0f",a:"0.7"},{n:["spiral calendar","spiral calendar pad"],u:"1f5d3-fe0f",a:"0.7"},{n:["card index"],u:"1f4c7",a:"0.6"},{n:["chart with upwards trend"],u:"1f4c8",a:"0.6"},{n:["chart with downwards trend"],u:"1f4c9",a:"0.6"},{n:["bar chart"],u:"1f4ca",a:"0.6"},{n:["clipboard"],u:"1f4cb",a:"0.6"},{n:["pushpin"],u:"1f4cc",a:"0.6"},{n:["round pushpin"],u:"1f4cd",a:"0.6"},{n:["paperclip"],u:"1f4ce",a:"0.6"},{n:["linked paperclips"],u:"1f587-fe0f",a:"0.7"},{n:["straight ruler"],u:"1f4cf",a:"0.6"},{n:["triangular ruler"],u:"1f4d0",a:"0.6"},{n:["scissors","black scissors"],u:"2702-fe0f",a:"0.6"},{n:["card file box"],u:"1f5c3-fe0f",a:"0.7"},{n:["file cabinet"],u:"1f5c4-fe0f",a:"0.7"},{n:["wastebasket"],u:"1f5d1-fe0f",a:"0.7"},{n:["lock"],u:"1f512",a:"0.6"},{n:["unlock","open lock"],u:"1f513",a:"0.6"},{n:["lock with ink pen"],u:"1f50f",a:"0.6"},{n:["closed lock with key"],u:"1f510",a:"0.6"},{n:["key"],u:"1f511",a:"0.6"},{n:["old key"],u:"1f5dd-fe0f",a:"0.7"},{n:["hammer"],u:"1f528",a:"0.6"},{n:["axe"],u:"1fa93",a:"12.0"},{n:["pick"],u:"26cf-fe0f",a:"0.7"},{n:["hammer and pick"],u:"2692-fe0f",a:"1.0"},{n:["hammer and wrench"],u:"1f6e0-fe0f",a:"0.7"},{n:["dagger","dagger knife"],u:"1f5e1-fe0f",a:"0.7"},{n:["crossed swords"],u:"2694-fe0f",a:"1.0"},{n:["gun","pistol"],u:"1f52b",a:"0.6"},{n:["boomerang"],u:"1fa83",a:"13.0"},{n:["bow and arrow"],u:"1f3f9",a:"1.0"},{n:["shield"],u:"1f6e1-fe0f",a:"0.7"},{n:["carpentry saw"],u:"1fa9a",a:"13.0"},{n:["wrench"],u:"1f527",a:"0.6"},{n:["screwdriver"],u:"1fa9b",a:"13.0"},{n:["nut and bolt"],u:"1f529",a:"0.6"},{n:["gear"],u:"2699-fe0f",a:"1.0"},{n:["clamp","compression"],u:"1f5dc-fe0f",a:"0.7"},{n:["scales","balance scale"],u:"2696-fe0f",a:"1.0"},{n:["probing cane"],u:"1f9af",a:"12.0"},{n:["link","link symbol"],u:"1f517",a:"0.6"},{n:["chains"],u:"26d3-fe0f",a:"0.7"},{n:["hook"],u:"1fa9d",a:"13.0"},{n:["toolbox"],u:"1f9f0",a:"11.0"},{n:["magnet"],u:"1f9f2",a:"11.0"},{n:["ladder"],u:"1fa9c",a:"13.0"},{n:["alembic"],u:"2697-fe0f",a:"1.0"},{n:["test tube"],u:"1f9ea",a:"11.0"},{n:["petri dish"],u:"1f9eb",a:"11.0"},{n:["dna","dna double helix"],u:"1f9ec",a:"11.0"},{n:["microscope"],u:"1f52c",a:"1.0"},{n:["telescope"],u:"1f52d",a:"1.0"},{n:["satellite antenna"],u:"1f4e1",a:"0.6"},{n:["syringe"],u:"1f489",a:"0.6"},{n:["drop of blood"],u:"1fa78",a:"12.0"},{n:["pill"],u:"1f48a",a:"0.6"},{n:["adhesive bandage"],u:"1fa79",a:"12.0"},{n:["crutch"],u:"1fa7c",a:"14.0"},{n:["stethoscope"],u:"1fa7a",a:"12.0"},{n:["x-ray"],u:"1fa7b",a:"14.0"},{n:["door"],u:"1f6aa",a:"0.6"},{n:["elevator"],u:"1f6d7",a:"13.0"},{n:["mirror"],u:"1fa9e",a:"13.0"},{n:["window"],u:"1fa9f",a:"13.0"},{n:["bed"],u:"1f6cf-fe0f",a:"0.7"},{n:["couch and lamp"],u:"1f6cb-fe0f",a:"0.7"},{n:["chair"],u:"1fa91",a:"12.0"},{n:["toilet"],u:"1f6bd",a:"0.6"},{n:["plunger"],u:"1faa0",a:"13.0"},{n:["shower"],u:"1f6bf",a:"1.0"},{n:["bathtub"],u:"1f6c1",a:"1.0"},{n:["mouse trap"],u:"1faa4",a:"13.0"},{n:["razor"],u:"1fa92",a:"12.0"},{n:["lotion bottle"],u:"1f9f4",a:"11.0"},{n:["safety pin"],u:"1f9f7",a:"11.0"},{n:["broom"],u:"1f9f9",a:"11.0"},{n:["basket"],u:"1f9fa",a:"11.0"},{n:["roll of paper"],u:"1f9fb",a:"11.0"},{n:["bucket"],u:"1faa3",a:"13.0"},{n:["soap","bar of soap"],u:"1f9fc",a:"11.0"},{n:["bubbles"],u:"1fae7",a:"14.0"},{n:["toothbrush"],u:"1faa5",a:"13.0"},{n:["sponge"],u:"1f9fd",a:"11.0"},{n:["fire extinguisher"],u:"1f9ef",a:"11.0"},{n:["shopping trolley"],u:"1f6d2",a:"3.0"},{n:["smoking","smoking symbol"],u:"1f6ac",a:"0.6"},{n:["coffin"],u:"26b0-fe0f",a:"1.0"},{n:["headstone"],u:"1faa6",a:"13.0"},{n:["funeral urn"],u:"26b1-fe0f",a:"1.0"},{n:["moyai"],u:"1f5ff",a:"0.6"},{n:["placard"],u:"1faa7",a:"13.0"},{n:["identification card"],u:"1faaa",a:"14.0"}],symbols:[{n:["atm","automated teller machine"],u:"1f3e7",a:"0.6"},{n:["put litter in its place","put litter in its place symbol"],u:"1f6ae",a:"1.0"},{n:["potable water","potable water symbol"],u:"1f6b0",a:"1.0"},{n:["wheelchair","wheelchair symbol"],u:"267f",a:"0.6"},{n:["mens","mens symbol"],u:"1f6b9",a:"0.6"},{n:["womens","womens symbol"],u:"1f6ba",a:"0.6"},{n:["restroom"],u:"1f6bb",a:"0.6"},{n:["baby symbol"],u:"1f6bc",a:"0.6"},{n:["wc","water closet"],u:"1f6be",a:"0.6"},{n:["passport control"],u:"1f6c2",a:"1.0"},{n:["customs"],u:"1f6c3",a:"1.0"},{n:["baggage claim"],u:"1f6c4",a:"1.0"},{n:["left luggage"],u:"1f6c5",a:"1.0"},{n:["warning","warning sign"],u:"26a0-fe0f",a:"0.6"},{n:["children crossing"],u:"1f6b8",a:"1.0"},{n:["no entry"],u:"26d4",a:"0.6"},{n:["no entry sign"],u:"1f6ab",a:"0.6"},{n:["no bicycles"],u:"1f6b3",a:"1.0"},{n:["no smoking","no smoking symbol"],u:"1f6ad",a:"0.6"},{n:["do not litter","do not litter symbol"],u:"1f6af",a:"1.0"},{n:["non-potable water","non-potable water symbol"],u:"1f6b1",a:"1.0"},{n:["no pedestrians"],u:"1f6b7",a:"1.0"},{n:["no mobile phones"],u:"1f4f5",a:"1.0"},{n:["underage","no one under eighteen symbol"],u:"1f51e",a:"0.6"},{n:["radioactive","radioactive sign"],u:"2622-fe0f",a:"1.0"},{n:["biohazard","biohazard sign"],u:"2623-fe0f",a:"1.0"},{n:["arrow up","upwards black arrow"],u:"2b06-fe0f",a:"0.6"},{n:["north east arrow","arrow upper right"],u:"2197-fe0f",a:"0.6"},{n:["arrow right","black rightwards arrow"],u:"27a1-fe0f",a:"0.6"},{n:["south east arrow","arrow lower right"],u:"2198-fe0f",a:"0.6"},{n:["arrow down","downwards black arrow"],u:"2b07-fe0f",a:"0.6"},{n:["south west arrow","arrow lower left"],u:"2199-fe0f",a:"0.6"},{n:["arrow left","leftwards black arrow"],u:"2b05-fe0f",a:"0.6"},{n:["north west arrow","arrow upper left"],u:"2196-fe0f",a:"0.6"},{n:["up down arrow","arrow up down"],u:"2195-fe0f",a:"0.6"},{n:["left right arrow"],u:"2194-fe0f",a:"0.6"},{n:["leftwards arrow with hook"],u:"21a9-fe0f",a:"0.6"},{n:["arrow right hook","rightwards arrow with hook"],u:"21aa-fe0f",a:"0.6"},{n:["arrow heading up","arrow pointing rightwards then curving upwards"],u:"2934-fe0f",a:"0.6"},{n:["arrow heading down","arrow pointing rightwards then curving downwards"],u:"2935-fe0f",a:"0.6"},{n:["arrows clockwise","clockwise downwards and upwards open circle arrows"],u:"1f503",a:"0.6"},{n:["arrows counterclockwise","anticlockwise downwards and upwards open circle arrows"],u:"1f504",a:"1.0"},{n:["back","back with leftwards arrow above"],u:"1f519",a:"0.6"},{n:["end","end with leftwards arrow above"],u:"1f51a",a:"0.6"},{n:["on","on with exclamation mark with left right arrow above"],u:"1f51b",a:"0.6"},{n:["soon","soon with rightwards arrow above"],u:"1f51c",a:"0.6"},{n:["top","top with upwards arrow above"],u:"1f51d",a:"0.6"},{n:["place of worship"],u:"1f6d0",a:"1.0"},{n:["atom symbol"],u:"269b-fe0f",a:"1.0"},{n:["om","om symbol"],u:"1f549-fe0f",a:"0.7"},{n:["star of david"],u:"2721-fe0f",a:"0.7"},{n:["wheel of dharma"],u:"2638-fe0f",a:"0.7"},{n:["yin yang"],u:"262f-fe0f",a:"0.7"},{n:["latin cross"],u:"271d-fe0f",a:"0.7"},{n:["orthodox cross"],u:"2626-fe0f",a:"1.0"},{n:["star and crescent"],u:"262a-fe0f",a:"0.7"},{n:["peace symbol"],u:"262e-fe0f",a:"1.0"},{n:["menorah with nine branches"],u:"1f54e",a:"1.0"},{n:["six pointed star","six pointed star with middle dot"],u:"1f52f",a:"0.6"},{n:["aries"],u:"2648",a:"0.6"},{n:["taurus"],u:"2649",a:"0.6"},{n:["gemini"],u:"264a",a:"0.6"},{n:["cancer"],u:"264b",a:"0.6"},{n:["leo"],u:"264c",a:"0.6"},{n:["virgo"],u:"264d",a:"0.6"},{n:["libra"],u:"264e",a:"0.6"},{n:["scorpius"],u:"264f",a:"0.6"},{n:["sagittarius"],u:"2650",a:"0.6"},{n:["capricorn"],u:"2651",a:"0.6"},{n:["aquarius"],u:"2652",a:"0.6"},{n:["pisces"],u:"2653",a:"0.6"},{n:["ophiuchus"],u:"26ce",a:"0.6"},{n:["twisted rightwards arrows"],u:"1f500",a:"1.0"},{n:["repeat","clockwise rightwards and leftwards open circle arrows"],u:"1f501",a:"1.0"},{n:["repeat one","clockwise rightwards and leftwards open circle arrows with circled one overlay"],u:"1f502",a:"1.0"},{n:["arrow forward","black right-pointing triangle"],u:"25b6-fe0f",a:"0.6"},{n:["fast forward","black right-pointing double triangle"],u:"23e9",a:"0.6"},{n:["next track button","black right pointing double triangle with vertical bar"],u:"23ed-fe0f",a:"0.7"},{n:["play or pause button","black right pointing triangle with double vertical bar"],u:"23ef-fe0f",a:"1.0"},{n:["arrow backward","black left-pointing triangle"],u:"25c0-fe0f",a:"0.6"},{n:["rewind","black left-pointing double triangle"],u:"23ea",a:"0.6"},{n:["last track button","black left pointing double triangle with vertical bar"],u:"23ee-fe0f",a:"0.7"},{n:["arrow up small","up-pointing small red triangle"],u:"1f53c",a:"0.6"},{n:["arrow double up","black up-pointing double triangle"],u:"23eb",a:"0.6"},{n:["arrow down small","down-pointing small red triangle"],u:"1f53d",a:"0.6"},{n:["arrow double down","black down-pointing double triangle"],u:"23ec",a:"0.6"},{n:["pause button","double vertical bar"],u:"23f8-fe0f",a:"0.7"},{n:["stop button","black square for stop"],u:"23f9-fe0f",a:"0.7"},{n:["record button","black circle for record"],u:"23fa-fe0f",a:"0.7"},{n:["eject","eject button"],u:"23cf-fe0f",a:"1.0"},{n:["cinema"],u:"1f3a6",a:"0.6"},{n:["low brightness","low brightness symbol"],u:"1f505",a:"1.0"},{n:["high brightness","high brightness symbol"],u:"1f506",a:"1.0"},{n:["signal strength","antenna with bars"],u:"1f4f6",a:"0.6"},{n:["vibration mode"],u:"1f4f3",a:"0.6"},{n:["mobile phone off"],u:"1f4f4",a:"0.6"},{n:["female sign"],u:"2640-fe0f",a:"4.0"},{n:["male sign"],u:"2642-fe0f",a:"4.0"},{n:["transgender symbol"],u:"26a7-fe0f",a:"13.0"},{n:["heavy multiplication x"],u:"2716-fe0f",a:"0.6"},{n:["heavy plus sign"],u:"2795",a:"0.6"},{n:["heavy minus sign"],u:"2796",a:"0.6"},{n:["heavy division sign"],u:"2797",a:"0.6"},{n:["heavy equals sign"],u:"1f7f0",a:"14.0"},{n:["infinity"],u:"267e-fe0f",a:"11.0"},{n:["bangbang","double exclamation mark"],u:"203c-fe0f",a:"0.6"},{n:["interrobang","exclamation question mark"],u:"2049-fe0f",a:"0.6"},{n:["question","black question mark ornament"],u:"2753",a:"0.6"},{n:["grey question","white question mark ornament"],u:"2754",a:"0.6"},{n:["grey exclamation","white exclamation mark ornament"],u:"2755",a:"0.6"},{n:["exclamation","heavy exclamation mark","heavy exclamation mark symbol"],u:"2757",a:"0.6"},{n:["wavy dash"],u:"3030-fe0f",a:"0.6"},{n:["currency exchange"],u:"1f4b1",a:"0.6"},{n:["heavy dollar sign"],u:"1f4b2",a:"0.6"},{n:["medical symbol","staff of aesculapius"],u:"2695-fe0f",a:"4.0"},{n:["recycle","black universal recycling symbol"],u:"267b-fe0f",a:"0.6"},{n:["fleur-de-lis","fleur de lis"],u:"269c-fe0f",a:"1.0"},{n:["trident","trident emblem"],u:"1f531",a:"0.6"},{n:["name badge"],u:"1f4db",a:"0.6"},{n:["beginner","japanese symbol for beginner"],u:"1f530",a:"0.6"},{n:["o","heavy large circle"],u:"2b55",a:"0.6"},{n:["white check mark","white heavy check mark"],u:"2705",a:"0.6"},{n:["ballot box with check"],u:"2611-fe0f",a:"0.6"},{n:["heavy check mark"],u:"2714-fe0f",a:"0.6"},{n:["x","cross mark"],u:"274c",a:"0.6"},{n:["negative squared cross mark"],u:"274e",a:"0.6"},{n:["curly loop"],u:"27b0",a:"0.6"},{n:["loop","double curly loop"],u:"27bf",a:"1.0"},{n:["part alternation mark"],u:"303d-fe0f",a:"0.6"},{n:["eight spoked asterisk"],u:"2733-fe0f",a:"0.6"},{n:["eight pointed black star"],u:"2734-fe0f",a:"0.6"},{n:["sparkle"],u:"2747-fe0f",a:"0.6"},{n:["copyright","copyright sign"],u:"00a9-fe0f",a:"0.6"},{n:["registered","registered sign"],u:"00ae-fe0f",a:"0.6"},{n:["tm","trade mark sign"],u:"2122-fe0f",a:"0.6"},{n:["hash","hash key"],u:"0023-fe0f-20e3",a:"0.6"},{n:["keycap: *","keycap star"],u:"002a-fe0f-20e3",a:"2.0"},{n:["zero","keycap 0"],u:"0030-fe0f-20e3",a:"0.6"},{n:["one","keycap 1"],u:"0031-fe0f-20e3",a:"0.6"},{n:["two","keycap 2"],u:"0032-fe0f-20e3",a:"0.6"},{n:["three","keycap 3"],u:"0033-fe0f-20e3",a:"0.6"},{n:["four","keycap 4"],u:"0034-fe0f-20e3",a:"0.6"},{n:["five","keycap 5"],u:"0035-fe0f-20e3",a:"0.6"},{n:["six","keycap 6"],u:"0036-fe0f-20e3",a:"0.6"},{n:["seven","keycap 7"],u:"0037-fe0f-20e3",a:"0.6"},{n:["eight","keycap 8"],u:"0038-fe0f-20e3",a:"0.6"},{n:["nine","keycap 9"],u:"0039-fe0f-20e3",a:"0.6"},{n:["keycap ten"],u:"1f51f",a:"0.6"},{n:["capital abcd","input symbol for latin capital letters"],u:"1f520",a:"0.6"},{n:["abcd","input symbol for latin small letters"],u:"1f521",a:"0.6"},{n:["1234","input symbol for numbers"],u:"1f522",a:"0.6"},{n:["symbols","input symbol for symbols"],u:"1f523",a:"0.6"},{n:["abc","input symbol for latin letters"],u:"1f524",a:"0.6"},{n:["a","negative squared latin capital letter a"],u:"1f170-fe0f",a:"0.6"},{n:["ab","negative squared ab"],u:"1f18e",a:"0.6"},{n:["b","negative squared latin capital letter b"],u:"1f171-fe0f",a:"0.6"},{n:["cl","squared cl"],u:"1f191",a:"0.6"},{n:["cool","squared cool"],u:"1f192",a:"0.6"},{n:["free","squared free"],u:"1f193",a:"0.6"},{n:["information source"],u:"2139-fe0f",a:"0.6"},{n:["id","squared id"],u:"1f194",a:"0.6"},{n:["m","circled latin capital letter m"],u:"24c2-fe0f",a:"0.6"},{n:["new","squared new"],u:"1f195",a:"0.6"},{n:["ng","squared ng"],u:"1f196",a:"0.6"},{n:["o2","negative squared latin capital letter o"],u:"1f17e-fe0f",a:"0.6"},{n:["ok","squared ok"],u:"1f197",a:"0.6"},{n:["parking","negative squared latin capital letter p"],u:"1f17f-fe0f",a:"0.6"},{n:["sos","squared sos"],u:"1f198",a:"0.6"},{n:["up","squared up with exclamation mark"],u:"1f199",a:"0.6"},{n:["vs","squared vs"],u:"1f19a",a:"0.6"},{n:["koko","squared katakana koko"],u:"1f201",a:"0.6"},{n:["sa","squared katakana sa"],u:"1f202-fe0f",a:"0.6"},{n:["u6708","squared cjk unified ideograph-6708"],u:"1f237-fe0f",a:"0.6"},{n:["u6709","squared cjk unified ideograph-6709"],u:"1f236",a:"0.6"},{n:["u6307","squared cjk unified ideograph-6307"],u:"1f22f",a:"0.6"},{n:["ideograph advantage","circled ideograph advantage"],u:"1f250",a:"0.6"},{n:["u5272","squared cjk unified ideograph-5272"],u:"1f239",a:"0.6"},{n:["u7121","squared cjk unified ideograph-7121"],u:"1f21a",a:"0.6"},{n:["u7981","squared cjk unified ideograph-7981"],u:"1f232",a:"0.6"},{n:["accept","circled ideograph accept"],u:"1f251",a:"0.6"},{n:["u7533","squared cjk unified ideograph-7533"],u:"1f238",a:"0.6"},{n:["u5408","squared cjk unified ideograph-5408"],u:"1f234",a:"0.6"},{n:["u7a7a","squared cjk unified ideograph-7a7a"],u:"1f233",a:"0.6"},{n:["congratulations","circled ideograph congratulation"],u:"3297-fe0f",a:"0.6"},{n:["secret","circled ideograph secret"],u:"3299-fe0f",a:"0.6"},{n:["u55b6","squared cjk unified ideograph-55b6"],u:"1f23a",a:"0.6"},{n:["u6e80","squared cjk unified ideograph-6e80"],u:"1f235",a:"0.6"},{n:["red circle","large red circle"],u:"1f534",a:"0.6"},{n:["large orange circle"],u:"1f7e0",a:"12.0"},{n:["large yellow circle"],u:"1f7e1",a:"12.0"},{n:["large green circle"],u:"1f7e2",a:"12.0"},{n:["large blue circle"],u:"1f535",a:"0.6"},{n:["large purple circle"],u:"1f7e3",a:"12.0"},{n:["large brown circle"],u:"1f7e4",a:"12.0"},{n:["black circle","medium black circle"],u:"26ab",a:"0.6"},{n:["white circle","medium white circle"],u:"26aa",a:"0.6"},{n:["large red square"],u:"1f7e5",a:"12.0"},{n:["large orange square"],u:"1f7e7",a:"12.0"},{n:["large yellow square"],u:"1f7e8",a:"12.0"},{n:["large green square"],u:"1f7e9",a:"12.0"},{n:["large blue square"],u:"1f7e6",a:"12.0"},{n:["large purple square"],u:"1f7ea",a:"12.0"},{n:["large brown square"],u:"1f7eb",a:"12.0"},{n:["black large square"],u:"2b1b",a:"0.6"},{n:["white large square"],u:"2b1c",a:"0.6"},{n:["black medium square"],u:"25fc-fe0f",a:"0.6"},{n:["white medium square"],u:"25fb-fe0f",a:"0.6"},{n:["black medium small square"],u:"25fe",a:"0.6"},{n:["white medium small square"],u:"25fd",a:"0.6"},{n:["black small square"],u:"25aa-fe0f",a:"0.6"},{n:["white small square"],u:"25ab-fe0f",a:"0.6"},{n:["large orange diamond"],u:"1f536",a:"0.6"},{n:["large blue diamond"],u:"1f537",a:"0.6"},{n:["small orange diamond"],u:"1f538",a:"0.6"},{n:["small blue diamond"],u:"1f539",a:"0.6"},{n:["small red triangle","up-pointing red triangle"],u:"1f53a",a:"0.6"},{n:["small red triangle down","down-pointing red triangle"],u:"1f53b",a:"0.6"},{n:["diamond shape with a dot inside"],u:"1f4a0",a:"0.6"},{n:["radio button"],u:"1f518",a:"0.6"},{n:["white square button"],u:"1f533",a:"0.6"},{n:["black square button"],u:"1f532",a:"0.6"}],flags:[{n:["chequered flag","checkered flag"],u:"1f3c1",a:"0.6"},{n:["triangular flag on post"],u:"1f6a9",a:"0.6"},{n:["crossed flags"],u:"1f38c",a:"0.6"},{n:["waving black flag"],u:"1f3f4",a:"1.0"},{n:["white flag","waving white flag"],u:"1f3f3-fe0f",a:"0.7"},{n:["rainbow flag","rainbow-flag"],u:"1f3f3-fe0f-200d-1f308",a:"4.0"},{n:["transgender flag"],u:"1f3f3-fe0f-200d-26a7-fe0f",a:"13.0"},{n:["pirate flag"],u:"1f3f4-200d-2620-fe0f",a:"11.0"},{n:["flag-ac","ascension island flag"],u:"1f1e6-1f1e8",a:"2.0"},{n:["flag-ad","andorra flag"],u:"1f1e6-1f1e9",a:"2.0"},{n:["flag-ae","united arab emirates flag"],u:"1f1e6-1f1ea",a:"2.0"},{n:["flag-af","afghanistan flag"],u:"1f1e6-1f1eb",a:"2.0"},{n:["flag-ag","antigua & barbuda flag"],u:"1f1e6-1f1ec",a:"2.0"},{n:["flag-ai","anguilla flag"],u:"1f1e6-1f1ee",a:"2.0"},{n:["flag-al","albania flag"],u:"1f1e6-1f1f1",a:"2.0"},{n:["flag-am","armenia flag"],u:"1f1e6-1f1f2",a:"2.0"},{n:["flag-ao","angola flag"],u:"1f1e6-1f1f4",a:"2.0"},{n:["flag-aq","antarctica flag"],u:"1f1e6-1f1f6",a:"2.0"},{n:["flag-ar","argentina flag"],u:"1f1e6-1f1f7",a:"2.0"},{n:["flag-as","american samoa flag"],u:"1f1e6-1f1f8",a:"2.0"},{n:["flag-at","austria flag"],u:"1f1e6-1f1f9",a:"2.0"},{n:["flag-au","australia flag"],u:"1f1e6-1f1fa",a:"2.0"},{n:["flag-aw","aruba flag"],u:"1f1e6-1f1fc",a:"2.0"},{n:["flag-ax","\xe5land islands flag"],u:"1f1e6-1f1fd",a:"2.0"},{n:["flag-az","azerbaijan flag"],u:"1f1e6-1f1ff",a:"2.0"},{n:["flag-ba","bosnia & herzegovina flag"],u:"1f1e7-1f1e6",a:"2.0"},{n:["flag-bb","barbados flag"],u:"1f1e7-1f1e7",a:"2.0"},{n:["flag-bd","bangladesh flag"],u:"1f1e7-1f1e9",a:"2.0"},{n:["flag-be","belgium flag"],u:"1f1e7-1f1ea",a:"2.0"},{n:["flag-bf","burkina faso flag"],u:"1f1e7-1f1eb",a:"2.0"},{n:["flag-bg","bulgaria flag"],u:"1f1e7-1f1ec",a:"2.0"},{n:["flag-bh","bahrain flag"],u:"1f1e7-1f1ed",a:"2.0"},{n:["flag-bi","burundi flag"],u:"1f1e7-1f1ee",a:"2.0"},{n:["flag-bj","benin flag"],u:"1f1e7-1f1ef",a:"2.0"},{n:["flag-bl","st. barth\xe9lemy flag"],u:"1f1e7-1f1f1",a:"2.0"},{n:["flag-bm","bermuda flag"],u:"1f1e7-1f1f2",a:"2.0"},{n:["flag-bn","brunei flag"],u:"1f1e7-1f1f3",a:"2.0"},{n:["flag-bo","bolivia flag"],u:"1f1e7-1f1f4",a:"2.0"},{n:["flag-bq","caribbean netherlands flag"],u:"1f1e7-1f1f6",a:"2.0"},{n:["flag-br","brazil flag"],u:"1f1e7-1f1f7",a:"2.0"},{n:["flag-bs","bahamas flag"],u:"1f1e7-1f1f8",a:"2.0"},{n:["flag-bt","bhutan flag"],u:"1f1e7-1f1f9",a:"2.0"},{n:["flag-bv","bouvet island flag"],u:"1f1e7-1f1fb",a:"2.0"},{n:["flag-bw","botswana flag"],u:"1f1e7-1f1fc",a:"2.0"},{n:["flag-by","belarus flag"],u:"1f1e7-1f1fe",a:"2.0"},{n:["flag-bz","belize flag"],u:"1f1e7-1f1ff",a:"2.0"},{n:["flag-ca","canada flag"],u:"1f1e8-1f1e6",a:"2.0"},{n:["flag-cc","cocos (keeling) islands flag"],u:"1f1e8-1f1e8",a:"2.0"},{n:["flag-cd","congo - kinshasa flag"],u:"1f1e8-1f1e9",a:"2.0"},{n:["flag-cf","central african republic flag"],u:"1f1e8-1f1eb",a:"2.0"},{n:["flag-cg","congo - brazzaville flag"],u:"1f1e8-1f1ec",a:"2.0"},{n:["flag-ch","switzerland flag"],u:"1f1e8-1f1ed",a:"2.0"},{n:["flag-ci","c\xf4te d\u2019ivoire flag"],u:"1f1e8-1f1ee",a:"2.0"},{n:["flag-ck","cook islands flag"],u:"1f1e8-1f1f0",a:"2.0"},{n:["flag-cl","chile flag"],u:"1f1e8-1f1f1",a:"2.0"},{n:["flag-cm","cameroon flag"],u:"1f1e8-1f1f2",a:"2.0"},{n:["cn","flag-cn","china flag"],u:"1f1e8-1f1f3",a:"0.6"},{n:["flag-co","colombia flag"],u:"1f1e8-1f1f4",a:"2.0"},{n:["flag-cp","clipperton island flag"],u:"1f1e8-1f1f5",a:"2.0"},{n:["flag-cr","costa rica flag"],u:"1f1e8-1f1f7",a:"2.0"},{n:["flag-cu","cuba flag"],u:"1f1e8-1f1fa",a:"2.0"},{n:["flag-cv","cape verde flag"],u:"1f1e8-1f1fb",a:"2.0"},{n:["flag-cw","cura\xe7ao flag"],u:"1f1e8-1f1fc",a:"2.0"},{n:["flag-cx","christmas island flag"],u:"1f1e8-1f1fd",a:"2.0"},{n:["flag-cy","cyprus flag"],u:"1f1e8-1f1fe",a:"2.0"},{n:["flag-cz","czechia flag"],u:"1f1e8-1f1ff",a:"2.0"},{n:["de","flag-de","germany flag"],u:"1f1e9-1f1ea",a:"0.6"},{n:["flag-dg","diego garcia flag"],u:"1f1e9-1f1ec",a:"2.0"},{n:["flag-dj","djibouti flag"],u:"1f1e9-1f1ef",a:"2.0"},{n:["flag-dk","denmark flag"],u:"1f1e9-1f1f0",a:"2.0"},{n:["flag-dm","dominica flag"],u:"1f1e9-1f1f2",a:"2.0"},{n:["flag-do","dominican republic flag"],u:"1f1e9-1f1f4",a:"2.0"},{n:["flag-dz","algeria flag"],u:"1f1e9-1f1ff",a:"2.0"},{n:["flag-ea","ceuta & melilla flag"],u:"1f1ea-1f1e6",a:"2.0"},{n:["flag-ec","ecuador flag"],u:"1f1ea-1f1e8",a:"2.0"},{n:["flag-ee","estonia flag"],u:"1f1ea-1f1ea",a:"2.0"},{n:["flag-eg","egypt flag"],u:"1f1ea-1f1ec",a:"2.0"},{n:["flag-eh","western sahara flag"],u:"1f1ea-1f1ed",a:"2.0"},{n:["flag-er","eritrea flag"],u:"1f1ea-1f1f7",a:"2.0"},{n:["es","flag-es","spain flag"],u:"1f1ea-1f1f8",a:"0.6"},{n:["flag-et","ethiopia flag"],u:"1f1ea-1f1f9",a:"2.0"},{n:["flag-eu","european union flag"],u:"1f1ea-1f1fa",a:"2.0"},{n:["flag-fi","finland flag"],u:"1f1eb-1f1ee",a:"2.0"},{n:["flag-fj","fiji flag"],u:"1f1eb-1f1ef",a:"2.0"},{n:["flag-fk","falkland islands flag"],u:"1f1eb-1f1f0",a:"2.0"},{n:["flag-fm","micronesia flag"],u:"1f1eb-1f1f2",a:"2.0"},{n:["flag-fo","faroe islands flag"],u:"1f1eb-1f1f4",a:"2.0"},{n:["fr","flag-fr","france flag"],u:"1f1eb-1f1f7",a:"0.6"},{n:["flag-ga","gabon flag"],u:"1f1ec-1f1e6",a:"2.0"},{n:["gb","uk","flag-gb","united kingdom flag"],u:"1f1ec-1f1e7",a:"0.6"},{n:["flag-gd","grenada flag"],u:"1f1ec-1f1e9",a:"2.0"},{n:["flag-ge","georgia flag"],u:"1f1ec-1f1ea",a:"2.0"},{n:["flag-gf","french guiana flag"],u:"1f1ec-1f1eb",a:"2.0"},{n:["flag-gg","guernsey flag"],u:"1f1ec-1f1ec",a:"2.0"},{n:["flag-gh","ghana flag"],u:"1f1ec-1f1ed",a:"2.0"},{n:["flag-gi","gibraltar flag"],u:"1f1ec-1f1ee",a:"2.0"},{n:["flag-gl","greenland flag"],u:"1f1ec-1f1f1",a:"2.0"},{n:["flag-gm","gambia flag"],u:"1f1ec-1f1f2",a:"2.0"},{n:["flag-gn","guinea flag"],u:"1f1ec-1f1f3",a:"2.0"},{n:["flag-gp","guadeloupe flag"],u:"1f1ec-1f1f5",a:"2.0"},{n:["flag-gq","equatorial guinea flag"],u:"1f1ec-1f1f6",a:"2.0"},{n:["flag-gr","greece flag"],u:"1f1ec-1f1f7",a:"2.0"},{n:["flag-gs","south georgia & south sandwich islands flag"],u:"1f1ec-1f1f8",a:"2.0"},{n:["flag-gt","guatemala flag"],u:"1f1ec-1f1f9",a:"2.0"},{n:["flag-gu","guam flag"],u:"1f1ec-1f1fa",a:"2.0"},{n:["flag-gw","guinea-bissau flag"],u:"1f1ec-1f1fc",a:"2.0"},{n:["flag-gy","guyana flag"],u:"1f1ec-1f1fe",a:"2.0"},{n:["flag-hk","hong kong sar china flag"],u:"1f1ed-1f1f0",a:"2.0"},{n:["flag-hm","heard & mcdonald islands flag"],u:"1f1ed-1f1f2",a:"2.0"},{n:["flag-hn","honduras flag"],u:"1f1ed-1f1f3",a:"2.0"},{n:["flag-hr","croatia flag"],u:"1f1ed-1f1f7",a:"2.0"},{n:["flag-ht","haiti flag"],u:"1f1ed-1f1f9",a:"2.0"},{n:["flag-hu","hungary flag"],u:"1f1ed-1f1fa",a:"2.0"},{n:["flag-ic","canary islands flag"],u:"1f1ee-1f1e8",a:"2.0"},{n:["flag-id","indonesia flag"],u:"1f1ee-1f1e9",a:"2.0"},{n:["flag-ie","ireland flag"],u:"1f1ee-1f1ea",a:"2.0"},{n:["flag-il","israel flag"],u:"1f1ee-1f1f1",a:"2.0"},{n:["flag-im","isle of man flag"],u:"1f1ee-1f1f2",a:"2.0"},{n:["flag-in","india flag"],u:"1f1ee-1f1f3",a:"2.0"},{n:["flag-io","british indian ocean territory flag"],u:"1f1ee-1f1f4",a:"2.0"},{n:["flag-iq","iraq flag"],u:"1f1ee-1f1f6",a:"2.0"},{n:["flag-ir","iran flag"],u:"1f1ee-1f1f7",a:"2.0"},{n:["flag-is","iceland flag"],u:"1f1ee-1f1f8",a:"2.0"},{n:["it","flag-it","italy flag"],u:"1f1ee-1f1f9",a:"0.6"},{n:["flag-je","jersey flag"],u:"1f1ef-1f1ea",a:"2.0"},{n:["flag-jm","jamaica flag"],u:"1f1ef-1f1f2",a:"2.0"},{n:["flag-jo","jordan flag"],u:"1f1ef-1f1f4",a:"2.0"},{n:["jp","flag-jp","japan flag"],u:"1f1ef-1f1f5",a:"0.6"},{n:["flag-ke","kenya flag"],u:"1f1f0-1f1ea",a:"2.0"},{n:["flag-kg","kyrgyzstan flag"],u:"1f1f0-1f1ec",a:"2.0"},{n:["flag-kh","cambodia flag"],u:"1f1f0-1f1ed",a:"2.0"},{n:["flag-ki","kiribati flag"],u:"1f1f0-1f1ee",a:"2.0"},{n:["flag-km","comoros flag"],u:"1f1f0-1f1f2",a:"2.0"},{n:["flag-kn","st. kitts & nevis flag"],u:"1f1f0-1f1f3",a:"2.0"},{n:["flag-kp","north korea flag"],u:"1f1f0-1f1f5",a:"2.0"},{n:["kr","flag-kr","south korea flag"],u:"1f1f0-1f1f7",a:"0.6"},{n:["flag-kw","kuwait flag"],u:"1f1f0-1f1fc",a:"2.0"},{n:["flag-ky","cayman islands flag"],u:"1f1f0-1f1fe",a:"2.0"},{n:["flag-kz","kazakhstan flag"],u:"1f1f0-1f1ff",a:"2.0"},{n:["flag-la","laos flag"],u:"1f1f1-1f1e6",a:"2.0"},{n:["flag-lb","lebanon flag"],u:"1f1f1-1f1e7",a:"2.0"},{n:["flag-lc","st. lucia flag"],u:"1f1f1-1f1e8",a:"2.0"},{n:["flag-li","liechtenstein flag"],u:"1f1f1-1f1ee",a:"2.0"},{n:["flag-lk","sri lanka flag"],u:"1f1f1-1f1f0",a:"2.0"},{n:["flag-lr","liberia flag"],u:"1f1f1-1f1f7",a:"2.0"},{n:["flag-ls","lesotho flag"],u:"1f1f1-1f1f8",a:"2.0"},{n:["flag-lt","lithuania flag"],u:"1f1f1-1f1f9",a:"2.0"},{n:["flag-lu","luxembourg flag"],u:"1f1f1-1f1fa",a:"2.0"},{n:["flag-lv","latvia flag"],u:"1f1f1-1f1fb",a:"2.0"},{n:["flag-ly","libya flag"],u:"1f1f1-1f1fe",a:"2.0"},{n:["flag-ma","morocco flag"],u:"1f1f2-1f1e6",a:"2.0"},{n:["flag-mc","monaco flag"],u:"1f1f2-1f1e8",a:"2.0"},{n:["flag-md","moldova flag"],u:"1f1f2-1f1e9",a:"2.0"},{n:["flag-me","montenegro flag"],u:"1f1f2-1f1ea",a:"2.0"},{n:["flag-mf","st. martin flag"],u:"1f1f2-1f1eb",a:"2.0"},{n:["flag-mg","madagascar flag"],u:"1f1f2-1f1ec",a:"2.0"},{n:["flag-mh","marshall islands flag"],u:"1f1f2-1f1ed",a:"2.0"},{n:["flag-mk","north macedonia flag"],u:"1f1f2-1f1f0",a:"2.0"},{n:["flag-ml","mali flag"],u:"1f1f2-1f1f1",a:"2.0"},{n:["flag-mm","myanmar (burma) flag"],u:"1f1f2-1f1f2",a:"2.0"},{n:["flag-mn","mongolia flag"],u:"1f1f2-1f1f3",a:"2.0"},{n:["flag-mo","macao sar china flag"],u:"1f1f2-1f1f4",a:"2.0"},{n:["flag-mp","northern mariana islands flag"],u:"1f1f2-1f1f5",a:"2.0"},{n:["flag-mq","martinique flag"],u:"1f1f2-1f1f6",a:"2.0"},{n:["flag-mr","mauritania flag"],u:"1f1f2-1f1f7",a:"2.0"},{n:["flag-ms","montserrat flag"],u:"1f1f2-1f1f8",a:"2.0"},{n:["flag-mt","malta flag"],u:"1f1f2-1f1f9",a:"2.0"},{n:["flag-mu","mauritius flag"],u:"1f1f2-1f1fa",a:"2.0"},{n:["flag-mv","maldives flag"],u:"1f1f2-1f1fb",a:"2.0"},{n:["flag-mw","malawi flag"],u:"1f1f2-1f1fc",a:"2.0"},{n:["flag-mx","mexico flag"],u:"1f1f2-1f1fd",a:"2.0"},{n:["flag-my","malaysia flag"],u:"1f1f2-1f1fe",a:"2.0"},{n:["flag-mz","mozambique flag"],u:"1f1f2-1f1ff",a:"2.0"},{n:["flag-na","namibia flag"],u:"1f1f3-1f1e6",a:"2.0"},{n:["flag-nc","new caledonia flag"],u:"1f1f3-1f1e8",a:"2.0"},{n:["flag-ne","niger flag"],u:"1f1f3-1f1ea",a:"2.0"},{n:["flag-nf","norfolk island flag"],u:"1f1f3-1f1eb",a:"2.0"},{n:["flag-ng","nigeria flag"],u:"1f1f3-1f1ec",a:"2.0"},{n:["flag-ni","nicaragua flag"],u:"1f1f3-1f1ee",a:"2.0"},{n:["flag-nl","netherlands flag"],u:"1f1f3-1f1f1",a:"2.0"},{n:["flag-no","norway flag"],u:"1f1f3-1f1f4",a:"2.0"},{n:["flag-np","nepal flag"],u:"1f1f3-1f1f5",a:"2.0"},{n:["flag-nr","nauru flag"],u:"1f1f3-1f1f7",a:"2.0"},{n:["flag-nu","niue flag"],u:"1f1f3-1f1fa",a:"2.0"},{n:["flag-nz","new zealand flag"],u:"1f1f3-1f1ff",a:"2.0"},{n:["flag-om","oman flag"],u:"1f1f4-1f1f2",a:"2.0"},{n:["flag-pa","panama flag"],u:"1f1f5-1f1e6",a:"2.0"},{n:["flag-pe","peru flag"],u:"1f1f5-1f1ea",a:"2.0"},{n:["flag-pf","french polynesia flag"],u:"1f1f5-1f1eb",a:"2.0"},{n:["flag-pg","papua new guinea flag"],u:"1f1f5-1f1ec",a:"2.0"},{n:["flag-ph","philippines flag"],u:"1f1f5-1f1ed",a:"2.0"},{n:["flag-pk","pakistan flag"],u:"1f1f5-1f1f0",a:"2.0"},{n:["flag-pl","poland flag"],u:"1f1f5-1f1f1",a:"2.0"},{n:["flag-pm","st. pierre & miquelon flag"],u:"1f1f5-1f1f2",a:"2.0"},{n:["flag-pn","pitcairn islands flag"],u:"1f1f5-1f1f3",a:"2.0"},{n:["flag-pr","puerto rico flag"],u:"1f1f5-1f1f7",a:"2.0"},{n:["flag-ps","palestinian territories flag"],u:"1f1f5-1f1f8",a:"2.0"},{n:["flag-pt","portugal flag"],u:"1f1f5-1f1f9",a:"2.0"},{n:["flag-pw","palau flag"],u:"1f1f5-1f1fc",a:"2.0"},{n:["flag-py","paraguay flag"],u:"1f1f5-1f1fe",a:"2.0"},{n:["flag-qa","qatar flag"],u:"1f1f6-1f1e6",a:"2.0"},{n:["flag-re","r\xe9union flag"],u:"1f1f7-1f1ea",a:"2.0"},{n:["flag-ro","romania flag"],u:"1f1f7-1f1f4",a:"2.0"},{n:["flag-rs","serbia flag"],u:"1f1f7-1f1f8",a:"2.0"},{n:["ru","flag-ru","russia flag"],u:"1f1f7-1f1fa",a:"0.6"},{n:["flag-rw","rwanda flag"],u:"1f1f7-1f1fc",a:"2.0"},{n:["flag-sa","saudi arabia flag"],u:"1f1f8-1f1e6",a:"2.0"},{n:["flag-sb","solomon islands flag"],u:"1f1f8-1f1e7",a:"2.0"},{n:["flag-sc","seychelles flag"],u:"1f1f8-1f1e8",a:"2.0"},{n:["flag-sd","sudan flag"],u:"1f1f8-1f1e9",a:"2.0"},{n:["flag-se","sweden flag"],u:"1f1f8-1f1ea",a:"2.0"},{n:["flag-sg","singapore flag"],u:"1f1f8-1f1ec",a:"2.0"},{n:["flag-sh","st. helena flag"],u:"1f1f8-1f1ed",a:"2.0"},{n:["flag-si","slovenia flag"],u:"1f1f8-1f1ee",a:"2.0"},{n:["flag-sj","svalbard & jan mayen flag"],u:"1f1f8-1f1ef",a:"2.0"},{n:["flag-sk","slovakia flag"],u:"1f1f8-1f1f0",a:"2.0"},{n:["flag-sl","sierra leone flag"],u:"1f1f8-1f1f1",a:"2.0"},{n:["flag-sm","san marino flag"],u:"1f1f8-1f1f2",a:"2.0"},{n:["flag-sn","senegal flag"],u:"1f1f8-1f1f3",a:"2.0"},{n:["flag-so","somalia flag"],u:"1f1f8-1f1f4",a:"2.0"},{n:["flag-sr","suriname flag"],u:"1f1f8-1f1f7",a:"2.0"},{n:["flag-ss","south sudan flag"],u:"1f1f8-1f1f8",a:"2.0"},{n:["flag-st","s\xe3o tom\xe9 & pr\xedncipe flag"],u:"1f1f8-1f1f9",a:"2.0"},{n:["flag-sv","el salvador flag"],u:"1f1f8-1f1fb",a:"2.0"},{n:["flag-sx","sint maarten flag"],u:"1f1f8-1f1fd",a:"2.0"},{n:["flag-sy","syria flag"],u:"1f1f8-1f1fe",a:"2.0"},{n:["flag-sz","eswatini flag"],u:"1f1f8-1f1ff",a:"2.0"},{n:["flag-ta","tristan da cunha flag"],u:"1f1f9-1f1e6",a:"2.0"},{n:["flag-tc","turks & caicos islands flag"],u:"1f1f9-1f1e8",a:"2.0"},{n:["flag-td","chad flag"],u:"1f1f9-1f1e9",a:"2.0"},{n:["flag-tf","french southern territories flag"],u:"1f1f9-1f1eb",a:"2.0"},{n:["flag-tg","togo flag"],u:"1f1f9-1f1ec",a:"2.0"},{n:["flag-th","thailand flag"],u:"1f1f9-1f1ed",a:"2.0"},{n:["flag-tj","tajikistan flag"],u:"1f1f9-1f1ef",a:"2.0"},{n:["flag-tk","tokelau flag"],u:"1f1f9-1f1f0",a:"2.0"},{n:["flag-tl","timor-leste flag"],u:"1f1f9-1f1f1",a:"2.0"},{n:["flag-tm","turkmenistan flag"],u:"1f1f9-1f1f2",a:"2.0"},{n:["flag-tn","tunisia flag"],u:"1f1f9-1f1f3",a:"2.0"},{n:["flag-to","tonga flag"],u:"1f1f9-1f1f4",a:"2.0"},{n:["flag-tr","turkey flag"],u:"1f1f9-1f1f7",a:"2.0"},{n:["flag-tt","trinidad & tobago flag"],u:"1f1f9-1f1f9",a:"2.0"},{n:["flag-tv","tuvalu flag"],u:"1f1f9-1f1fb",a:"2.0"},{n:["flag-tw","taiwan flag"],u:"1f1f9-1f1fc",a:"2.0"},{n:["flag-tz","tanzania flag"],u:"1f1f9-1f1ff",a:"2.0"},{n:["flag-ua","ukraine flag"],u:"1f1fa-1f1e6",a:"2.0"},{n:["flag-ug","uganda flag"],u:"1f1fa-1f1ec",a:"2.0"},{n:["flag-um","u.s. outlying islands flag"],u:"1f1fa-1f1f2",a:"2.0"},{n:["flag-un","united nations flag"],u:"1f1fa-1f1f3",a:"4.0"},{n:["us","flag-us","united states flag"],u:"1f1fa-1f1f8",a:"0.6"},{n:["flag-uy","uruguay flag"],u:"1f1fa-1f1fe",a:"2.0"},{n:["flag-uz","uzbekistan flag"],u:"1f1fa-1f1ff",a:"2.0"},{n:["flag-va","vatican city flag"],u:"1f1fb-1f1e6",a:"2.0"},{n:["flag-vc","st. vincent & grenadines flag"],u:"1f1fb-1f1e8",a:"2.0"},{n:["flag-ve","venezuela flag"],u:"1f1fb-1f1ea",a:"2.0"},{n:["flag-vg","british virgin islands flag"],u:"1f1fb-1f1ec",a:"2.0"},{n:["flag-vi","u.s. virgin islands flag"],u:"1f1fb-1f1ee",a:"2.0"},{n:["flag-vn","vietnam flag"],u:"1f1fb-1f1f3",a:"2.0"},{n:["flag-vu","vanuatu flag"],u:"1f1fb-1f1fa",a:"2.0"},{n:["flag-wf","wallis & futuna flag"],u:"1f1fc-1f1eb",a:"2.0"},{n:["flag-ws","samoa flag"],u:"1f1fc-1f1f8",a:"2.0"},{n:["flag-xk","kosovo flag"],u:"1f1fd-1f1f0",a:"2.0"},{n:["flag-ye","yemen flag"],u:"1f1fe-1f1ea",a:"2.0"},{n:["flag-yt","mayotte flag"],u:"1f1fe-1f1f9",a:"2.0"},{n:["flag-za","south africa flag"],u:"1f1ff-1f1e6",a:"2.0"},{n:["flag-zm","zambia flag"],u:"1f1ff-1f1f2",a:"2.0"},{n:["flag-zw","zimbabwe flag"],u:"1f1ff-1f1fc",a:"2.0"},{n:["england flag","flag-england"],u:"1f3f4-e0067-e0062-e0065-e006e-e0067-e007f",a:"5.0"},{n:["scotland flag","flag-scotland"],u:"1f3f4-e0067-e0062-e0073-e0063-e0074-e007f",a:"5.0"},{n:["wales flag","flag-wales"],u:"1f3f4-e0067-e0062-e0077-e006c-e0073-e007f",a:"5.0"}]},Uc=[Tc.NEUTRAL,Tc.LIGHT,Tc.MEDIUM_LIGHT,Tc.MEDIUM,Tc.MEDIUM_DARK,Tc.DARK],Wc=Object.entries(Tc).reduce((function(e,t){var n=t[0];return e[t[1]]=n,e}),{}),Gc=Uc.reduce((function(e,t){var n;return Object.assign(e,((n={})[t]=t,n))}),{});!function(e){e.name="n",e.unified="u",e.variations="v",e.added_in="a",e.imgUrl="imgUrl"}(jc||(jc={}));var Vc={};function Hc(e){Yc(e).flat().join("").toLowerCase().replace(/[^a-zA-Z\d]/g,"").split("").forEach((function(t){var n;Vc[t]=null!=(n=Vc[t])?n:{},Vc[t][Kc(e)]=e}))}function Yc(e){var t;return null!=(t=e[jc.name])?t:[]}function Xc(e){return e?Yc(e)[0]:""}function qc(e){var t=e.split("-"),n=t.splice(1,1)[0];return Gc[n]?t.join("-"):e}function Kc(e,t){var n,r=e[jc.unified];return t&&$c(e)&&null!=(n=function(e,t){return t?Zc(e).find((function(e){return e.includes(t)})):Kc(e)}(e,t))?n:r}function Qc(e){var t;return null!=(t=null==Bc?void 0:Bc[e])?t:[]}function Jc(e,t){return""+function(e){switch(e){case _c.TWITTER:return"https://cdn.jsdelivr.net/npm/emoji-datasource-twitter/img/twitter/64/";case _c.GOOGLE:return"https://cdn.jsdelivr.net/npm/emoji-datasource-google/img/google/64/";case _c.FACEBOOK:return"https://cdn.jsdelivr.net/npm/emoji-datasource-facebook/img/facebook/64/";case _c.APPLE:default:return"https://cdn.jsdelivr.net/npm/emoji-datasource-apple/img/apple/64/"}}(t)+e+".png"}function Zc(e){var t;return null!=(t=e[jc.variations])?t:[]}function $c(e){return Zc(e).length>0}function eu(e){if(e){if(ru[e])return ru[e];var t=qc(e);return ru[t]}}setTimeout((function(){tu.reduce((function(e,t){return Hc(t),e}),Vc)}));var tu=Object.values(Bc).flat();function nu(e){Bc[Ic.CUSTOM].length=0,e.forEach((function(e){var t=function(e){var t;return(t={})[jc.name]=e.names.map((function(e){return e.toLowerCase()})),t[jc.unified]=e.id.toLowerCase(),t[jc.added_in]="0",t[jc.imgUrl]=e.imgUrl,t}(e);Bc[Ic.CUSTOM].push(t),ru[t[jc.unified]]||(tu.push(t),ru[t[jc.unified]]=t,Hc(t))}))}var ru={};setTimeout((function(){tu.reduce((function(e,t){return e[Kc(t)]=t,$c(t)&&Zc(t).forEach((function(n){e[n]=t})),e}),ru)}));var au=["2640-fe0f","2642-fe0f","2695-fe0f"],iu="Search",ou=" found. Use up and down arrow keys to navigate.",su="1 result"+ou,cu="%n results"+ou;function uu(e){var t,n;void 0===e&&(e={});var r=lu(),a=Object.assign(r.previewConfig,null!=(t=e.previewConfig)?t:{}),i=Object.assign(r,e),o=function(e,t){var n;void 0===e&&(e=[]),void 0===t&&(t={});var r={};t.suggestionMode===Mc.RECENT&&(r[Ic.SUGGESTED]=Rc);var a=Oc(r);return null!=(n=e)&&n.length?e.map((function(e){return"string"===typeof e?zc(e,r[e]):fc({},zc(e.category,r[e.category]),e)})):a}(e.categories,{suggestionMode:i.suggestedEmojisMode});i.hiddenEmojis.forEach((function(e){i.unicodeToHide.add(e)})),nu(null!=(n=i.customEmojis)?n:[]);var s=i.searchDisabled?kc.PREVIEW:i.skinTonePickerLocation;return fc({},i,{categories:o,previewConfig:a,skinTonePickerLocation:s})}function lu(){return{autoFocusSearch:!0,categories:Oc(),className:"",customEmojis:[],defaultSkinTone:Tc.NEUTRAL,emojiStyle:_c.APPLE,emojiVersion:null,getEmojiUrl:Jc,height:450,lazyLoadEmojis:!1,previewConfig:fc({},fu),searchDisabled:!1,searchPlaceHolder:iu,searchPlaceholder:iu,skinTonePickerLocation:kc.SEARCH,skinTonesDisabled:!1,style:{},suggestedEmojisMode:Mc.FREQUENT,theme:Ec.LIGHT,unicodeToHide:new Set(au),width:350,reactionsDefaultOpen:!1,reactions:Lc,open:!0,allowExpandReactions:!0,hiddenEmojis:[]}}var fu={defaultEmoji:"1f60a",defaultCaption:"What's your mood?",showPreview:!0},du=["children"],hu=(0,o.createContext)(lu());function pu(e){var t=e.children,n=function(e){var t,n=(0,o.useState)((function(){return uu(e)})),r=n[0],a=n[1];return(0,o.useEffect)((function(){Cc(r,e)||a(uu(e))}),[null==(t=e.customEmojis)?void 0:t.length,e.open,e.emojiVersion,e.reactionsDefaultOpen,e.searchPlaceHolder,e.searchPlaceholder,e.defaultSkinTone,e.skinTonesDisabled,e.autoFocusSearch,e.emojiStyle,e.theme,e.suggestedEmojisMode,e.lazyLoadEmojis,e.className,e.height,e.width,e.searchDisabled,e.skinTonePickerLocation,e.allowExpandReactions]),r}(hc(e,du));return(0,o.createElement)(hu.Provider,{value:n},t)}function gu(){return(0,o.useContext)(hu)}var mu,vu=o.createContext({});function bu(){return o.useContext(vu)}function yu(){}function xu(){return gu().allowExpandReactions}function wu(){return gu().skinTonesDisabled}function Su(){return gu().emojiStyle}function Cu(){return gu().categories}function Mu(){return gu().previewConfig}function _u(){return gu().searchDisabled}function Eu(){return gu().skinTonePickerLocation}function Tu(){return gu().getEmojiUrl}function Iu(e){return"number"===typeof e?e+"px":e}function ku(e,t){void 0===t&&(t=0);var n=(0,o.useState)(e),r=n[0],a=n[1],i=(0,o.useRef)(null);return[r,function(e){return new Promise((function(n){var r;i.current&&clearTimeout(i.current),i.current=null==(r=window)?void 0:r.setTimeout((function(){a(e),n(e)}),t)}))}]}function Nu(){var e=gu().unicodeToHide;return function(t){return e.has(t)}}function Lu(){var e=(0,o.useRef)({}),t=gu().emojiVersion;return(0,o.useMemo)((function(){var n=parseFloat(""+t);return!t||Number.isNaN(n)?e.current:tu.reduce((function(e,t){return function(e,t){return function(e){return parseFloat(e[jc.added_in])}(e)>t}(t,n)&&(e[Kc(t)]=!0),e}),e.current)}),[t])}function Au(e){var t,n=e.children,r=Lu(),a=gu().defaultSkinTone,i=gu().reactionsDefaultOpen,s=(0,o.useRef)(Vc),c=(0,o.useRef)(!1),u=(0,o.useRef)(!1),l=(0,o.useRef)(r),f=ku(Date.now(),200),d=ku("",100),h=(0,o.useState)(!1),p=(0,o.useState)(a),g=(0,o.useState)(null),m=(0,o.useState)(new Set),v=(0,o.useState)(null),b=(0,o.useState)(i),y=(0,o.useState)(!1),x=y[0],w=y[1];return t=w,(0,o.useEffect)((function(){t(!0)}),[t]),(0,o.createElement)(Ru.Provider,{value:{activeCategoryState:g,activeSkinTone:p,disallowClickRef:c,disallowMouseRef:u,disallowedEmojisRef:l,emojiVariationPickerState:v,emojisThatFailedToLoadState:m,filterRef:s,isPastInitialLoad:x,searchTerm:d,skinToneFanOpenState:h,suggestedUpdateState:f,reactionsModeState:b}},n)}!function(e){e.REACTIONS="reactions",e.PICKER="picker"}(mu||(mu={}));var Ru=(0,o.createContext)({activeCategoryState:[null,function(){}],activeSkinTone:[Tc.NEUTRAL,function(){}],disallowClickRef:{current:!1},disallowMouseRef:{current:!1},disallowedEmojisRef:{current:{}},emojiVariationPickerState:[null,function(){}],emojisThatFailedToLoadState:[new Set,function(){}],filterRef:{current:{}},isPastInitialLoad:!0,searchTerm:["",function(){return new Promise((function(){}))}],skinToneFanOpenState:[!1,function(){}],suggestedUpdateState:[Date.now(),function(){}],reactionsModeState:[!1,function(){}]});function Du(){return(0,o.useContext)(Ru).filterRef}function Ou(){return(0,o.useContext)(Ru).disallowMouseRef}function Pu(){return(0,o.useContext)(Ru).reactionsModeState}function Fu(){return(0,o.useContext)(Ru).searchTerm}function zu(){return(0,o.useContext)(Ru).activeSkinTone}function ju(){return(0,o.useContext)(Ru).emojisThatFailedToLoadState}function Bu(){return(0,o.useContext)(Ru).emojiVariationPickerState}function Uu(){return(0,o.useContext)(Ru).skinToneFanOpenState}function Wu(){var e=(0,o.useContext)(Ru).suggestedUpdateState,t=e[0],n=e[1];return[t,function(){n(Date.now())}]}function Gu(){return!!Fu()[0]}function Vu(e){e&&requestAnimationFrame((function(){e.focus()}))}function Hu(e){e&&Vu(e.previousElementSibling)}function Yu(e){e&&Vu(e.nextElementSibling)}function Xu(e){e&&Vu(e.firstElementChild)}function qu(){return document.activeElement}function Ku(e){var t=e.children,n=(0,o.useRef)(null),r=(0,o.useRef)(null),a=(0,o.useRef)(null),i=(0,o.useRef)(null),s=(0,o.useRef)(null),c=(0,o.useRef)(null),u=(0,o.useRef)(null),l=(0,o.useRef)(null);return(0,o.createElement)(Ju.Provider,{value:{AnchoredEmojiRef:r,BodyRef:a,CategoryNavigationRef:c,PickerMainRef:n,SearchInputRef:i,SkinTonePickerRef:s,VariationPickerRef:u,ReactionsRef:l}},t)}var Qu,Ju=(0,o.createContext)({AnchoredEmojiRef:(0,o.createRef)(),BodyRef:(0,o.createRef)(),CategoryNavigationRef:(0,o.createRef)(),PickerMainRef:(0,o.createRef)(),SearchInputRef:(0,o.createRef)(),SkinTonePickerRef:(0,o.createRef)(),VariationPickerRef:(0,o.createRef)(),ReactionsRef:(0,o.createRef)()});function Zu(){return(0,o.useContext)(Ju)}function $u(){return Zu().PickerMainRef}function el(){return Zu().AnchoredEmojiRef}function tl(){var e=el();return function(t){null===t&&null!==e.current&&Vu(e.current),e.current=t}}function nl(){return Zu().BodyRef}function rl(){return Zu().SearchInputRef}function al(){return Zu().SkinTonePickerRef}function il(){return Zu().CategoryNavigationRef}function ol(e,t){void 0===t&&(t=0);var n=$l(e);n&&requestAnimationFrame((function(){n.scrollTop=t}))}function sl(e){if(e&&function(e){if(!e)return!1;return ef(e)<Zl(vf(e))}(e)&&!e.closest(mc(nc.variationPicker))){var t=tf(e),n=ef(e);!function(e,t){var n=$l(e);n&&requestAnimationFrame((function(){n.scrollTop=n.scrollTop+t}))}(t,-(Zl(vf(e))-n))}}function cl(e){var t=pf(e);Vu(t),sl(t)}function ul(e){if(e){var t=df(e);if(!t)return cl(mf(e));Vu(t),sl(t)}}function ll(e){if(e){var t=hf(e);if(t)Vu(t),sl(t);else Vu(ff(gf(e)))}}function fl(e,t){if(e){var n=function(e){if(!e)return null;var t=bf(e),n=vf(t),r=Ul(t,e),a=Wl(t,e),i=Bl(t,e);if(0===a){var o=gf(n);return o?Vl(lf(o),-1,i,r):null}return function(e,t,n,r){var a=Gl(e,t-1,n);return a[r]||a[a.length-1]||null}(lf(t),a,i,r)}(e);if(!n)return t();Vu(n),sl(n)}}function dl(e){if(e){var t=function(e){if(!e)return null;var t=bf(e),n=vf(t),r=Ul(t,e),a=Wl(t,e),i=Bl(t,e);if(!function(e,t){if(!e||!t)return!1;var n=t.getBoundingClientRect().height,r=t.getBoundingClientRect().top,a=e.getBoundingClientRect().top,i=e.getBoundingClientRect().height;return Math.round(r-a+n)<i}(t,e)){var o=mf(n);return o?Vl(lf(o),0,i,r):null}return function(e,t,n,r){var a=function(e,t,n){var r=t+1;if(r*n>e.length)return[];return Gl(e,r,n)}(e,t,n);return a[r]||a[a.length-1]||null}(lf(t),a,i,r)}(e);return Vu(t)}}function hl(){var e=Bu(),t=e[0],n=e[1],r=Uu(),a=r[0],i=r[1];return(0,o.useCallback)((function(){t&&n(null),a&&i(!1)}),[t,a,n,i])}function pl(){var e=Bu()[0],t=Uu()[0];return function(){return!!e||t}}function gl(){var e=Ou();return function(){e.current=!1}}function ml(){var e=Ou();return function(){return e.current}}function vl(){var e=rl();return(0,o.useCallback)((function(){Vu(e.current)}),[e])}function bl(){var e=il();return(0,o.useCallback)((function(){e.current&&Xu(e.current)}),[e])}function yl(){var e=wl(),t=rl(),n=vl();return function(){t.current&&(t.current.value=""),e(""),n()}}function xl(){var e=rl(),t=Du(),n=function(){var e=Du();return function t(n){if("function"===typeof n)return t(n(e.current));e.current=n}}(),r=wl(),a=Fu()[0],i=function(e,t){var n;if(null==e||!e[t])return"";var r=(null==(n=Object.entries(null==e?void 0:e[t]))?void 0:n.length)||0;return function(e){return e>0?e>1?cu.replace("%n",e.toString()):su:"No results found"}(r)}(t.current,a);return{onChange:function(e){var a=t.current,i=e.toLowerCase();if(null!=a&&a[i]||i.length<=1)return r(i);var o=function(e,t){if(!t)return null;if(t[e])return t[e];var n=Object.keys(t).sort((function(e,t){return t.length-e.length})).find((function(t){return e.includes(t)}));if(n)return t[n];return null}(i,a);if(!o)return r(i);n((function(e){var t;return Object.assign(e,((t={})[i]=function(e,t){var n={};for(var r in e){var a=e[r];Sl(a,t)&&(n[r]=a)}return n}(o,i),t))})),r(i)},searchTerm:a,SearchInputRef:e,statusSearchResults:i}}function wl(){var e=Fu()[1],t=$u();return function(n){requestAnimationFrame((function(){e(n?null==n?void 0:n.toLowerCase():n).then((function(){ol(t.current,0)}))}))}}function Sl(e,t){return Yc(e).some((function(e){return e.includes(t)}))}function Cl(e){return e&&"string"===typeof e?e.trim().toLowerCase():""}function Ml(){var e=tl(),t=Bu()[1];return function(n){var r=Kl(n)[0];r&&(e(n),t(r))}}function _l(){return Eu()===kc.SEARCH}function El(){return Eu()===kc.PREVIEW}function Tl(){!function(){var e=$u(),t=yl(),n=function(){var e=nl();return(0,o.useCallback)((function(t){requestAnimationFrame((function(){e.current&&(e.current.scrollTop=t)}))}),[e])}(),r=rl(),a=vl(),i=pl(),s=function(){var e=Ou();return function(){e.current=!0}}(),c=hl(),u=(0,o.useMemo)((function(){return function(e){var r=e.key;if(s(),r===Qu.Escape){if(e.preventDefault(),i())return void c();t(),n(0),a()}}}),[n,t,c,a,i,s]);(0,o.useEffect)((function(){var t=e.current;if(t)return t.addEventListener("keydown",u),function(){t.removeEventListener("keydown",u)}}),[e,r,n,u])}(),function(){var e=function(){var e=al();return(0,o.useCallback)((function(){e.current&&Xu(e.current)}),[e])}(),t=$u(),n=nl(),r=rl(),a=Uu()[1],i=Il(),s=_l(),c=(0,o.useMemo)((function(){return function(t){switch(t.key){case Qu.ArrowRight:if(!s)return;t.preventDefault(),a(!0),e();break;case Qu.ArrowDown:t.preventDefault(),i();break;case Qu.Enter:t.preventDefault(),function(e){var t=pf(e);Vu(t),null==t||t.click()}(n.current)}}}),[e,i,a,n,s]);(0,o.useEffect)((function(){var e=r.current;if(e)return e.addEventListener("keydown",c),function(){e.removeEventListener("keydown",c)}}),[t,r,c])}(),function(){var e=al(),t=vl(),n=rl(),r=Il(),a=Uu(),i=a[0],s=a[1],c=El(),u=_l(),l=Ll(),f=(0,o.useMemo)((function(){return function(e){var n=e.key;if(u)switch(n){case Qu.ArrowLeft:if(e.preventDefault(),!i)return t();kl(t);break;case Qu.ArrowRight:if(e.preventDefault(),!i)return t();Nl();break;case Qu.ArrowDown:e.preventDefault(),i&&s(!1),r();break;default:l(e)}if(c)switch(n){case Qu.ArrowUp:if(e.preventDefault(),!i)return t();kl(t);break;case Qu.ArrowDown:if(e.preventDefault(),!i)return t();Nl();break;default:l(e)}}}),[i,t,s,r,l,c,u]);(0,o.useEffect)((function(){var t=e.current;if(t)return t.addEventListener("keydown",f),function(){t.removeEventListener("keydown",f)}}),[e,n,i,f])}(),function(){var e=vl(),t=il(),n=nl(),r=Ll(),a=(0,o.useMemo)((function(){return function(t){switch(t.key){case Qu.ArrowUp:t.preventDefault(),e();break;case Qu.ArrowRight:t.preventDefault(),Yu(qu());break;case Qu.ArrowLeft:t.preventDefault(),Hu(qu());break;case Qu.ArrowDown:t.preventDefault(),cl(n.current);break;default:r(t)}}}),[n,e,r]);(0,o.useEffect)((function(){var e=t.current;if(e)return e.addEventListener("keydown",a),function(){e.removeEventListener("keydown",a)}}),[t,n,a])}(),function(){var e=nl(),t=function(){var e=vl(),t=bl(),n=Gu();return(0,o.useCallback)((function(){return n?e():t()}),[e,n,t])}(),n=Ml(),r=pl(),a=hl(),i=Ll(),s=(0,o.useMemo)((function(){return function(e){var o=e.key,s=ql(qu());switch(o){case Qu.ArrowRight:e.preventDefault(),ul(s);break;case Qu.ArrowLeft:e.preventDefault(),ll(s);break;case Qu.ArrowDown:if(e.preventDefault(),r()){a();break}dl(s);break;case Qu.ArrowUp:if(e.preventDefault(),r()){a();break}fl(s,t);break;case Qu.Space:e.preventDefault(),n(e.target);break;default:i(e)}}}),[t,i,n,r,a]);(0,o.useEffect)((function(){var t=e.current;if(t)return t.addEventListener("keydown",s),function(){t.removeEventListener("keydown",s)}}),[e,s])}()}function Il(){var e=bl(),t=Gu(),n=nl();return(0,o.useCallback)((function(){return t?cl(n.current):e()}),[n,e,t])}function kl(e){var t=qu();t&&(t.nextElementSibling||e(),Yu(t))}function Nl(){var e=qu();e&&Hu(e)}function Ll(){var e=function(){var e=rl(),t=wl();return function(n){e.current?(e.current.value=""+e.current.value+n,t(Cl(e.current.value))):t(Cl(n))}}(),t=vl(),n=_u(),r=hl();return function(a){var i=a.key;(function(e){var t=e.metaKey,n=e.ctrlKey,r=e.altKey;return t||n||r})(a)||n||i.match(/(^[a-zA-Z0-9]$){1}/)&&(a.preventDefault(),r(),t(),e(i))}}function Al(e,t,n){if(t&&n!==_c.NATIVE){var r=Kc(t);Rl.has(r)||(Zc(t).forEach((function(t){!function(e){(new Image).src=e}(e(t,n))})),Rl.add(r))}}!function(e){e.ArrowDown="ArrowDown",e.ArrowUp="ArrowUp",e.ArrowLeft="ArrowLeft",e.ArrowRight="ArrowRight",e.Escape="Escape",e.Enter="Enter",e.Space=" "}(Qu||(Qu={}));var Rl=new Set;var Dl=["width","height"],Ol=40;function Pl(e){var t=e.children;return(0,o.createElement)(Au,null,(0,o.createElement)(Fl,null,t))}function Fl(e){var t,n=e.children,r=Pu()[0],a=gu().theme,i=Gu(),s=$u(),c=gu().className,u=function(){var e=gu(),t=e.height,n=e.width,r=e.style;return fc({height:Iu(t),width:Iu(n)},r)}();Tl(),function(){var e=nl(),t=Su(),n=Tu();(0,o.useEffect)((function(){if(t!==_c.NATIVE){var r=e.current;return null==r||r.addEventListener("focusin",a),function(){null==r||r.removeEventListener("focusin",a)}}function a(e){var r=ql(e.target);if(r){var a=Kl(r)[0];a&&$c(a)&&Al(n,a,t)}}}),[e,t,n])}();var l=u||{},f=l.width,d=l.height,h=hc(l,Dl);return(0,o.createElement)("aside",{className:oc(jl.main,jl.baseVariables,a===Ec.DARK&&jl.darkTheme,a===Ec.AUTO&&jl.autoThemeDark,(t={},t[nc.searchActive]=i,t),r&&jl.reactionsMenu,c),ref:s,style:fc({},h,!r&&{height:d,width:f})},n)}var zl={"--epr-emoji-variation-picker-bg-color":"var(--epr-dark-emoji-variation-picker-bg-color)","--epr-hover-bg-color-reduced-opacity":"var(--epr-dark-hover-bg-color-reduced-opacity)","--epr-highlight-color":"var(--epr-dark-highlight-color)","--epr-text-color":"var(--epr-dark-text-color)","--epr-hover-bg-color":"var(--epr-dark-hover-bg-color)","--epr-focus-bg-color":"var(--epr-dark-focus-bg-color)","--epr-search-input-bg-color":"var(--epr-dark-search-input-bg-color)","--epr-category-label-bg-color":"var(--epr-dark-category-label-bg-color)","--epr-picker-border-color":"var(--epr-dark-picker-border-color)","--epr-bg-color":"var(--epr-dark-bg-color)","--epr-reactions-bg-color":"var(--epr-dark-reactions-bg-color)","--epr-search-input-bg-color-active":"var(--epr-dark-search-input-bg-color-active)","--epr-emoji-variation-indicator-color":"var(--epr-dark-emoji-variation-indicator-color)","--epr-category-icon-active-color":"var(--epr-dark-category-icon-active-color)","--epr-skin-tone-picker-menu-color":"var(--epr-dark-skin-tone-picker-menu-color)"},jl=vc.create({main:{".":["epr-main",nc.emojiPicker],position:"relative",display:"flex",flexDirection:"column",borderWidth:"1px",borderStyle:"solid",borderRadius:"var(--epr-picker-border-radius)",borderColor:"var(--epr-picker-border-color)",backgroundColor:"var(--epr-bg-color)",overflow:"hidden",transition:"all 0.3s ease-in-out, background-color 0.1s ease-in-out","*":{boxSizing:"border-box",fontFamily:"sans-serif"}},baseVariables:{"--":{"--epr-highlight-color":"#007aeb","--epr-hover-bg-color":"#f1f8ff","--epr-hover-bg-color-reduced-opacity":"#f1f8ff80","--epr-focus-bg-color":"#e0f0ff","--epr-text-color":"#858585","--epr-search-input-bg-color":"#f6f6f6","--epr-picker-border-color":"#e7e7e7","--epr-bg-color":"#fff","--epr-reactions-bg-color":"#ffffff90","--epr-category-icon-active-color":"#6aa8de","--epr-skin-tone-picker-menu-color":"#ffffff95","--epr-horizontal-padding":"10px","--epr-picker-border-radius":"8px","--epr-search-border-color":"var(--epr-highlight-color)","--epr-header-padding":"15px var(--epr-horizontal-padding)","--epr-active-skin-tone-indicator-border-color":"var(--epr-highlight-color)","--epr-active-skin-hover-color":"var(--epr-hover-bg-color)","--epr-search-input-bg-color-active":"var(--epr-search-input-bg-color)","--epr-search-input-padding":"0 30px","--epr-search-input-border-radius":"8px","--epr-search-input-height":"40px","--epr-search-input-text-color":"var(--epr-text-color)","--epr-search-input-placeholder-color":"var(--epr-text-color)","--epr-search-bar-inner-padding":"var(--epr-horizontal-padding)","--epr-category-navigation-button-size":"30px","--epr-emoji-variation-picker-height":"45px","--epr-emoji-variation-picker-bg-color":"var(--epr-bg-color)","--epr-preview-height":"70px","--epr-preview-text-size":"14px","--epr-preview-text-padding":"0 var(--epr-horizontal-padding)","--epr-preview-border-color":"var(--epr-picker-border-color)","--epr-preview-text-color":"var(--epr-text-color)","--epr-category-padding":"0 var(--epr-horizontal-padding)","--epr-category-label-bg-color":"#ffffffe6","--epr-category-label-text-color":"var(--epr-text-color)","--epr-category-label-padding":"0 var(--epr-horizontal-padding)","--epr-category-label-height":Ol+"px","--epr-emoji-size":"30px","--epr-emoji-padding":"5px","--epr-emoji-fullsize":"calc(var(--epr-emoji-size) + var(--epr-emoji-padding) * 2)","--epr-emoji-hover-color":"var(--epr-hover-bg-color)","--epr-emoji-variation-indicator-color":"var(--epr-picker-border-color)","--epr-emoji-variation-indicator-color-hover":"var(--epr-text-color)","--epr-header-overlay-z-index":"3","--epr-emoji-variations-indictator-z-index":"1","--epr-category-label-z-index":"2","--epr-skin-variation-picker-z-index":"5","--epr-preview-z-index":"6","--epr-dark":"#000","--epr-dark-emoji-variation-picker-bg-color":"var(--epr-dark)","--epr-dark-highlight-color":"#c0c0c0","--epr-dark-text-color":"var(--epr-highlight-color)","--epr-dark-hover-bg-color":"#363636f6","--epr-dark-hover-bg-color-reduced-opacity":"#36363680","--epr-dark-focus-bg-color":"#474747","--epr-dark-search-input-bg-color":"#333333","--epr-dark-category-label-bg-color":"#222222e6","--epr-dark-picker-border-color":"#151617","--epr-dark-bg-color":"#222222","--epr-dark-reactions-bg-color":"#22222290","--epr-dark-search-input-bg-color-active":"var(--epr-dark)","--epr-dark-emoji-variation-indicator-color":"#444","--epr-dark-category-icon-active-color":"#3271b7","--epr-dark-skin-tone-picker-menu-color":"#22222295"}},autoThemeDark:{".":nc.autoTheme,"@media (prefers-color-scheme: dark)":{"--":zl}},darkTheme:{".":nc.darkTheme,"--":zl},reactionsMenu:{".":"epr-reactions",height:"50px",display:"inline-flex",backgroundColor:"var(--epr-reactions-bg-color)",backdropFilter:"blur(8px)","--":{"--epr-picker-border-radius":"50px"}}});function Bl(e,t){if(!e||!t)return 0;var n=e.getBoundingClientRect().width,r=t.getBoundingClientRect().width;return Math.floor(n/r)}function Ul(e,t){if(!e||!t)return 0;var n=t.getBoundingClientRect().width,r=t.getBoundingClientRect().left,a=e.getBoundingClientRect().left;return Math.floor((r-a)/n)}function Wl(e,t){if(!e||!t)return 0;var n=t.getBoundingClientRect().height,r=t.getBoundingClientRect().top,a=e.getBoundingClientRect().top;return Math.round((r-a)/n)}function Gl(e,t,n){if(-1===t){var r=Math.floor((e.length-1)/n)*n,a=e.length-1;return e.slice(r,a+1)}return e.slice(t*n,(t+1)*n)}function Vl(e,t,n,r){var a=Gl(e,t,n);return a[r]||a[a.length-1]||null}function Hl(e,t,n){if(void 0===n&&(n=0),!e||!t.length)return null;var r=e.getBoundingClientRect().top,a=e.getBoundingClientRect().bottom,i=r+function(e){for(var t=Array.from(e.querySelectorAll(mc(nc.label))),n=0,r=t;n<r.length;n++){var a=r[n].getBoundingClientRect().height;if(a>0)return a}return Ol}(e);return t.find((function(e){var t=e.getBoundingClientRect().top,o=e.getBoundingClientRect().bottom,s=e.clientHeight*n,c=t+s,u=o-s;return!(c<i)&&(c>=r&&c<=a||u>=r&&u<=a)}))||null}var Yl="button"+mc(nc.emoji),Xl=[Yl,mc(nc.visible),":not("+mc(nc.hidden)+")"].join("");function ql(e){var t;return null!=(t=null==e?void 0:e.closest(Yl))?t:null}function Kl(e){var t=of(e),n=af(e);if(!t)return[];var r=eu(null!=n?n:t);return r?[r,n]:[]}function Ql(e){var t;return null!=(t=null==e?void 0:e.clientHeight)?t:0}function Jl(e){if(!e)return 0;var t=ql(e),n=vf(t),r=Zl(n);return nf(t)+nf(n)+r}function Zl(e){var t,n;if(!e)return 0;var r=e.querySelector(mc(nc.categoryContent));return(null!=(t=null==e?void 0:e.clientHeight)?t:0)-(null!=(n=null==r?void 0:r.clientHeight)?n:0)}function $l(e){return e?e.matches(mc(nc.scrollBody))?e:e.querySelector(mc(nc.scrollBody)):null}function ef(e){var t,n;return e?Jl(e)-(null!=(t=null==(n=tf(e))?void 0:n.scrollTop)?t:0):0}function tf(e){var t;return e&&null!=(t=e.closest(mc(nc.scrollBody)))?t:null}function nf(e){var t;return null!=(t=null==e?void 0:e.offsetTop)?t:0}function rf(e){var t;return null!=(t=null==e?void 0:e.offsetLeft)?t:0}function af(e){var t;return null!=(t=function(e,t){var n;return null!=(n=function(e){var t;return null!=(t=null==e?void 0:e.dataset)?t:{}}(e)[t])?n:null}(ql(e),"unified"))?t:null}function of(e){var t=af(e);return t?qc(t):null}function sf(e){return e?{unified:af(e),originalUnified:of(e)}:{unified:null,originalUnified:null}}function cf(e){return e.classList.contains(nc.visible)}function uf(e){return!e||e.classList.contains(nc.hidden)}function lf(e){return e?Array.from(e.querySelectorAll(Xl)):[]}function ff(e){if(!e)return null;var t=lf(e).slice(-1)[0];return t?cf(t)?t:hf(t):null}function df(e){var t=e.nextElementSibling;return t?cf(t)?t:df(t):pf(mf(e))}function hf(e){var t=e.previousElementSibling;return t?cf(t)?t:hf(t):ff(gf(e))}function pf(e){return e?Hl(e,lf(e),.1):null}function gf(e){var t=vf(e);if(!t)return null;var n=t.previousElementSibling;return n?uf(n)?gf(n):n:null}function mf(e){var t=vf(e);if(!t)return null;var n=t.nextElementSibling;return n?uf(n)?mf(n):n:null}function vf(e){return e?e.closest(mc(nc.category)):null}function bf(e){return e?e.closest(mc(nc.categoryContent)):null}function yf(e){return e.split("-").map((function(e){return String.fromCodePoint(parseInt(e,16))})).join("")}var xf="epr_suggested";function wf(e){try{var t,n,r;if(null==(t=window)||!t.localStorage)return[];var a=JSON.parse(null!=(n=null==(r=window)?void 0:r.localStorage.getItem(xf))?n:"[]");return e===Mc.FREQUENT?a.sort((function(e,t){return t.count-e.count})):a}catch(i){return[]}}function Sf(e){return void 0!==e.imgUrl}function Cf(e,t){var n=(0,o.useRef)(),r=Ml(),a=(0,o.useContext)(Ru).disallowClickRef,i=Bu()[1],s=hl(),c=zu()[0],u=function(e){var t,n=bu().current;return(null!=(t=e===mu.REACTIONS?n.onReactionClick:n.onEmojiClick)?t:n.onEmojiClick)||function(){}}(t),l=Wu()[1],f=Tu(),d=Su(),h=(0,o.useCallback)((function(e){if(!a.current){s();var t=Mf(e),n=t[0],r=t[1];if(n&&r){var i=function(e){var t=e.split("-")[1];return Uc.includes(t)?t:null}(r)||c;l(),function(e,t){var n,r=wf(),a=Kc(e,t),i=Kc(e),o=r.find((function(e){return e.unified===a}));n=o?[o].concat(r.filter((function(e){return e!==o}))):[o={unified:a,original:i,count:0}].concat(r),o.count++,n.length=Math.min(n.length,14);try{var s;null==(s=window)||s.localStorage.setItem(xf,JSON.stringify(n))}catch(c){}}(n,i),u(function(e,t,n,r){var a=Yc(e);if(Sf(e)){var i=Kc(e);return{activeSkinTone:t,emoji:i,getImageUrl:function(){return e.imgUrl},imageUrl:e.imgUrl,isCustom:!0,names:a,unified:i,unifiedWithoutSkinTone:i}}var o=Kc(e,t);return{activeSkinTone:t,emoji:yf(o),getImageUrl:function(e){return void 0===e&&(e=null!=n?n:_c.APPLE),r(o,e)},imageUrl:r(o,null!=n?n:_c.APPLE),isCustom:!1,names:a,unified:o,unifiedWithoutSkinTone:Kc(e)}}(n,i,d,f),e)}}}),[c,s,a,u,l,f,d]),p=(0,o.useCallback)((function(e){var t;n.current&&clearTimeout(n.current);var o=Mf(e)[0];o&&$c(o)&&(n.current=null==(t=window)?void 0:t.setTimeout((function(){a.current=!0,n.current=void 0,s(),r(e.target),i(o)}),500))}),[a,s,r,i]),g=(0,o.useCallback)((function(){n.current?(clearTimeout(n.current),n.current=void 0):a.current&&requestAnimationFrame((function(){a.current=!1}))}),[a]);(0,o.useEffect)((function(){if(e.current){var t=e.current;return t.addEventListener("click",h,{passive:!0}),t.addEventListener("mousedown",p,{passive:!0}),t.addEventListener("mouseup",g,{passive:!0}),function(){null==t||t.removeEventListener("click",h),null==t||t.removeEventListener("mousedown",p),null==t||t.removeEventListener("mouseup",g)}}}),[e,h,p,g])}function Mf(e){var t=null==e?void 0:e.target;return function(e){var t;return Boolean((null==e?void 0:e.matches(Yl))||(null==e||null==(t=e.parentElement)?void 0:t.matches(Yl)))}(t)?Kl(t):[]}function _f(e){return(0,o.createElement)("button",Object.assign({type:"button"},e,{className:oc(Ef.button,e.className)}),e.children)}var Ef=vc.create({button:{".":"epr-btn",cursor:"pointer",border:"0",background:"none",outline:"none"}});function Tf(e){var t,n=e.emojiNames,r=e.unified,a=e.hidden,i=e.hiddenOnSearch,s=e.showVariations,c=void 0===s||s,u=e.hasVariations,l=e.children,f=e.className,d=e.noBackground,h=void 0!==d&&d;return(0,o.createElement)(_f,{className:oc(kf.emoji,a&&yc.hidden,i&&wc.hiddenOnSearch,(t={},t[nc.visible]=!a&&!i,t),!(!u||!c)&&kf.hasVariations,h&&kf.noBackground,f),"data-unified":r,"aria-label":If(n),"data-full-name":n},l)}function If(e){var t;return e[0].match("flag-")&&null!=(t=e[1])?t:e[0]}var kf=vc.create({emoji:{".":nc.emoji,position:"relative",width:"var(--epr-emoji-fullsize)",height:"var(--epr-emoji-fullsize)",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"center",maxWidth:"var(--epr-emoji-fullsize)",maxHeight:"var(--epr-emoji-fullsize)",borderRadius:"8px",overflow:"hidden",transition:"background-color 0.2s",":hover":{backgroundColor:"var(--epr-emoji-hover-color)"},":focus":{backgroundColor:"var(--epr-focus-bg-color)"}},noBackground:{background:"none",":hover":{backgroundColor:"transparent",background:"none"},":focus":{backgroundColor:"transparent",background:"none"}},hasVariations:{".":nc.emojiHasVariations,":after":{content:"",display:"block",width:"0",height:"0",right:"0px",bottom:"1px",position:"absolute",borderLeft:"4px solid transparent",borderRight:"4px solid transparent",transform:"rotate(135deg)",borderBottom:"4px solid var(--epr-emoji-variation-indicator-color)",zIndex:"var(--epr-emoji-variations-indictator-z-index)"},":hover:after":{borderBottom:"4px solid var(--epr-emoji-variation-indicator-color-hover)"}}}),Nf=vc.create({external:{".":nc.external,fontSize:"0"},common:{alignSelf:"center",justifySelf:"center",display:"block"}});function Lf(e){var t=e.emojiName,n=e.style,r=e.lazyLoad,a=void 0!==r&&r,i=e.imgUrl,s=e.onError,c=e.className;return(0,o.createElement)("img",{src:i,alt:t,className:oc(Af.emojiImag,Nf.external,Nf.common,c),loading:a?"lazy":"eager",onError:s,style:n})}var Af=vc.create({emojiImag:{".":"epr-emoji-img",maxWidth:"var(--epr-emoji-fullsize)",maxHeight:"var(--epr-emoji-fullsize)",minWidth:"var(--epr-emoji-fullsize)",minHeight:"var(--epr-emoji-fullsize)",padding:"var(--epr-emoji-padding)"}});function Rf(e){var t=e.unified,n=e.style,r=e.className;return(0,o.createElement)("span",{className:oc(Df.nativeEmoji,Nf.common,Nf.external,r),"data-unified":t,style:n},yf(t))}var Df=vc.create({nativeEmoji:{".":"epr-emoji-native",fontFamily:'"Segoe UI Emoji", "Segoe UI Symbol", "Segoe UI", "Apple Color Emoji", "Twemoji Mozilla", "Noto Color Emoji", "EmojiOne Color", "Android Emoji"!important',position:"relative",lineHeight:"100%",fontSize:"var(--epr-emoji-size)",textAlign:"center",alignSelf:"center",justifySelf:"center",letterSpacing:"0",padding:"var(--epr-emoji-padding)"}});function Of(e){var t=e.emoji,n=e.unified,r=e.emojiStyle,a=e.size,i=e.lazyLoad,s=e.getEmojiUrl,c=void 0===s?Jc:s,u=e.className,l=ju()[1],f={};a&&(f.width=f.height=f.fontSize=a+"px");var d=t||eu(n);return d?Sf(d)?(0,o.createElement)(Lf,{style:f,emojiName:n,emojiStyle:_c.NATIVE,lazyLoad:i,imgUrl:d.imgUrl,onError:h,className:u}):(0,o.createElement)(o.Fragment,null,r===_c.NATIVE?(0,o.createElement)(Rf,{unified:n,style:f,className:u}):(0,o.createElement)(Lf,{style:f,emojiName:Xc(d),emojiStyle:r,lazyLoad:i,imgUrl:c(n,r),onError:h,className:u})):null;function h(){l((function(e){return new Set(e).add(n)}))}}function Pf(e){var t=e.emoji,n=e.unified,r=e.hidden,a=e.hiddenOnSearch,i=e.emojiStyle,s=e.showVariations,c=void 0===s||s,u=e.size,l=e.lazyLoad,f=e.getEmojiUrl,d=e.className,h=e.noBackground,p=void 0!==h&&h,g=$c(t);return(0,o.createElement)(Tf,{hasVariations:g,showVariations:c,hidden:r,hiddenOnSearch:a,emojiNames:Yc(t),unified:n,noBackground:p},(0,o.createElement)(Of,{unified:n,emoji:t,size:u,emojiStyle:i,lazyLoad:l,getEmojiUrl:f,className:d}))}function Ff(){var e=Pu()[1];return(0,o.createElement)(_f,{"aria-label":"Show all Emojis",title:"Show all Emojis",tabIndex:0,className:oc(zf.plusSign),onClick:function(){return e(!1)}})}var zf=vc.create(fc({plusSign:{fontSize:"20px",padding:"17px",color:"var(--epr-text-color)",borderRadius:"50%",textAlign:"center",lineHeight:"100%",width:"20px",height:"20px",display:"flex",justifyContent:"center",alignItems:"center",transition:"background-color 0.2s ease-in-out",":after":{content:"",minWidth:"20px",minHeight:"20px",backgroundImage:"url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDI4LjEuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHdpZHRoPSIyMHB4IiBoZWlnaHQ9IjgwcHgiIHZpZXdCb3g9IjAgMCAyMCA4MCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMjAgODAiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8cGF0aCBmaWxsPSIjODY4Njg2IiBkPSJNNS43LDEwLjRjMCwwLjEsMC4xLDAuMywwLjIsMC40QzYsMTAuOSw2LjEsMTEsNi4zLDExaDMuNHYzLjRjMCwwLjEsMC4xLDAuMywwLjIsMC40CgljMC4xLDAuMSwwLjIsMC4yLDAuNCwwLjJjMC4zLDAsMC41LTAuMiwwLjUtMC41di0zLjRoMy40YzAuMywwLDAuNS0wLjIsMC41LTAuNXMtMC4yLTAuNS0wLjUtMC41aC0zLjRWNi43YzAtMC4zLTAuMi0wLjUtMC41LTAuNQoJQzkuOCw2LDkuNiw2LjIsOS42LDYuNXYzLjRINi4yQzUuOSw5LjksNS43LDEwLjEsNS43LDEwLjRMNS43LDEwLjR6Ii8+CjxwYXRoIGZpbGw9IiMzMzcxQjciIGQ9Ik01LjcsMzAuNGMwLDAuMSwwLjEsMC4zLDAuMiwwLjRTNi4xLDMxLDYuMywzMWgzLjR2My40YzAsMC4xLDAuMSwwLjMsMC4yLDAuNGMwLjEsMC4xLDAuMiwwLjIsMC40LDAuMgoJYzAuMywwLDAuNS0wLjIsMC41LTAuNXYtMy40aDMuNGMwLjMsMCwwLjUtMC4yLDAuNS0wLjVzLTAuMi0wLjUtMC41LTAuNWgtMy40di0zLjRjMC0wLjMtMC4yLTAuNS0wLjUtMC41cy0wLjUsMC4yLTAuNSwwLjV2My40SDYuMgoJQzUuOSwyOS45LDUuNywzMC4xLDUuNywzMC40TDUuNywzMC40eiIvPgo8cGF0aCBmaWxsPSIjQzBDMEJGIiBkPSJNNS43LDUwLjRjMCwwLjEsMC4xLDAuMywwLjIsMC40QzYsNTAuOSw2LjEsNTEsNi4zLDUxaDMuNHYzLjRjMCwwLjEsMC4xLDAuMywwLjIsMC40CgljMC4xLDAuMSwwLjIsMC4yLDAuNCwwLjJjMC4zLDAsMC41LTAuMiwwLjUtMC41di0zLjRoMy40YzAuMywwLDAuNS0wLjIsMC41LTAuNXMtMC4yLTAuNS0wLjUtMC41aC0zLjR2LTMuNGMwLTAuMy0wLjItMC41LTAuNS0wLjUKCXMtMC41LDAuMi0wLjUsMC41djMuNEg2LjJDNS45LDQ5LjksNS43LDUwLjEsNS43LDUwLjRMNS43LDUwLjR6Ii8+CjxwYXRoIGZpbGw9IiM2QUE5REQiIGQ9Ik01LjcsNzAuNGMwLDAuMSwwLjEsMC4zLDAuMiwwLjRTNi4xLDcxLDYuMyw3MWgzLjR2My40YzAsMC4xLDAuMSwwLjMsMC4yLDAuNGMwLjEsMC4xLDAuMiwwLjIsMC40LDAuMgoJYzAuMywwLDAuNS0wLjIsMC41LTAuNXYtMy40aDMuNGMwLjMsMCwwLjUtMC4yLDAuNS0wLjVzLTAuMi0wLjUtMC41LTAuNWgtMy40di0zLjRjMC0wLjMtMC4yLTAuNS0wLjUtMC41cy0wLjUsMC4yLTAuNSwwLjV2My40SDYuNAoJQzUuOSw2OS45LDUuNyw3MC4xLDUuNyw3MC40TDUuNyw3MC40eiIvPgo8L3N2Zz4=)",backgroundColor:"transparent",backgroundRepeat:"no-repeat",backgroundSize:"20px",backgroundPositionY:"0"},":hover":{color:"var(--epr-highlight-color)",backgroundColor:"var(--epr-hover-bg-color-reduced-opacity)",":after":{backgroundPositionY:"-20px"}},":focus":{color:"var(--epr-highlight-color)",backgroundColor:"var(--epr-hover-bg-color-reduced-opacity)",":after":{backgroundPositionY:"-40px"}}}},Sc("plusSign",{":after":{backgroundPositionY:"-40px"},":hover:after":{backgroundPositionY:"-60px"}})));function jf(){var e=Pu()[0],t=Zu().ReactionsRef,n=gu().reactions;Cf(t,mu.REACTIONS);var r=Su(),a=xu(),i=Tu();return e?(0,o.createElement)("ul",{className:oc(Bf.list,!e&&yc.hidden),ref:t},n.map((function(e){return(0,o.createElement)("li",{key:e},(0,o.createElement)(Pf,{emoji:eu(e),emojiStyle:r,unified:e,showVariations:!1,className:oc(Bf.emojiButton),noBackground:!0,getEmojiUrl:i}))})),a?(0,o.createElement)("li",null,(0,o.createElement)(Ff,null)):null):null}var Bf=vc.create({list:{listStyle:"none",margin:"0",padding:"0 5px",display:"flex",justifyContent:"space-between",alignItems:"center",height:"100%"},emojiButton:{":hover":{transform:"scale(1.2)"},":focus":{transform:"scale(1.2)"},":active":{transform:"scale(1.1)"},transition:"transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.5)"}});function Uf(){var e=ju()[0],t=function(){var e=Du().current,t=Fu()[0];return function(n){return function(e,t,n){var r;return!(!t||!n)&&!(null!=(r=t[n])&&r[e])}(n,e,t)}}();return function(n){var r=Kc(n),a=e.has(r),i=t(r);return{failedToLoad:a,filteredOut:i,hidden:a||i}}}function Wf(e){var t=e.categoryConfig,n=e.children,r=e.hidden,a=e.hiddenOnSearch,i=Pc(t),s=Fc(t);return(0,o.createElement)("li",{className:oc(Gf.category,r&&yc.hidden,a&&wc.hiddenOnSearch),"data-name":i,"aria-label":s},(0,o.createElement)("h2",{className:oc(Gf.label)},s),(0,o.createElement)("div",{className:oc(Gf.categoryContent)},n))}var Gf=vc.create({category:{".":nc.category,":not(:has(.epr-visible))":{display:"none"}},categoryContent:{".":nc.categoryContent,display:"grid",gridGap:"0",gridTemplateColumns:"repeat(auto-fill, var(--epr-emoji-fullsize))",justifyContent:"space-between",margin:"var(--epr-category-padding)",position:"relative"},label:{".":nc.label,alignItems:"center",backdropFilter:"blur(3px)",backgroundColor:"var(--epr-category-label-bg-color)",color:"var(--epr-category-label-text-color)",display:"flex",fontSize:"16px",fontWeight:"bold",height:"var(--epr-category-label-height)",margin:"0",padding:"var(--epr-category-label-padding)",position:"sticky",textTransform:"capitalize",top:"0",width:"100%",zIndex:"var(--epr-category-label-z-index)"}}),Vf=!1;function Hf(e){var t=e.categoryConfig,n=Wu()[0],r=function(){var e=(0,o.useState)(Vf),t=e[0],n=e[1];return(0,o.useEffect)((function(){n(!0),Vf=!0}),[]),t||Vf}(),a=gu().suggestedEmojisMode,i=Tu(),s=(0,o.useMemo)((function(){var e;return null!=(e=wf(a))?e:[]}),[n,a]),c=Su();return r?(0,o.createElement)(Wf,{categoryConfig:t,hiddenOnSearch:!0,hidden:0===s.length},s.map((function(e){var t=eu(e.original);return t?(0,o.createElement)(Pf,{showVariations:!1,unified:e.unified,emojiStyle:c,emoji:t,key:e.unified,getEmojiUrl:i}):null}))):null}function Yf(){var e=Cu(),t=(0,o.useRef)(0);return(0,o.createElement)("ul",{className:oc(Kf.emojiList)},e.map((function(e){var n=Pc(e);return n===Ic.SUGGESTED?(0,o.createElement)(Hf,{key:n,categoryConfig:e}):(0,o.createElement)(o.Suspense,{key:n},(0,o.createElement)(Xf,{category:n,categoryConfig:e,renderdCategoriesCountRef:t}))})))}function Xf(e){var t=e.category,n=e.categoryConfig,r=e.renderdCategoriesCountRef,a=Uf(),i=gu().lazyLoadEmojis,s=Su(),c=(0,o.useContext)(Ru).isPastInitialLoad,u=zu()[0],l=function(){var e=Lu(),t=Nu();return function(n){var r=qc(Kc(n));return Boolean(e[r]||t(r))}}(),f=Tu(),d=!wu(),h=!c&&r.current>0?[]:Qc(t);h.length>0&&r.current++;var p=0,g=h.map((function(e){var t=Kc(e,u),n=a(e),r=n.failedToLoad,c=n.filteredOut,h=n.hidden,g=l(e);return(h||g)&&p++,g?null:(0,o.createElement)(Pf,{showVariations:d,key:t,emoji:e,unified:t,hidden:r,hiddenOnSearch:c,emojiStyle:s,lazyLoad:i,getEmojiUrl:f})}));return(0,o.createElement)(Wf,{categoryConfig:n,hidden:p===g.length},g)}var qf,Kf=vc.create({emojiList:{".":nc.emojiList,listStyle:"none",margin:"0",padding:"0"}});function Qf(){var e,t,n=el(),r=Zu().VariationPickerRef,a=Bu()[0],i=Su(),s=function(e){var t=el(),n=nl(),r=qf.Up;return{getMenuDirection:a,getTop:i};function a(){return r}function i(){r=qf.Up;var a=0;if(!e.current)return 0;var i=Ql(e.current);if(t.current){var o,s=n.current,c=ql(t.current),u=Ql(c);a=Jl(c),(null!=(o=null==s?void 0:s.scrollTop)?o:0)>a-i&&(r=qf.Down,a+=u+i)}return a-i}}(r),c=s.getTop,u=s.getMenuDirection,l=tl(),f=function(e){var t=el();return function(){var n={};if(!e.current)return n;if(t.current){var r=ql(t.current),a=function(e){var t=ql(e),n=vf(t);return rf(t)+rf(n)}(r);if(!r)return n;n.left=a+(null==r?void 0:r.clientWidth)/2}return n}}(r),d=Tu(),h=ql(n.current),p=Boolean(a&&h&&$c(a)&&h.classList.contains(nc.emojiHasVariations));return(0,o.useEffect)((function(){p&&cl(r.current)}),[r,p,n]),!p&&n.current?l(null):(e=c(),t=f()),(0,o.createElement)("div",{ref:r,className:oc(Jf.variationPicker,u()===qf.Down&&Jf.pointingUp,p&&Jf.visible),style:{top:e}},p&&a?[Kc(a)].concat(Zc(a)).slice(0,6).map((function(e){return(0,o.createElement)(Pf,{key:e,emoji:a,unified:e,emojiStyle:i,showVariations:!1,getEmojiUrl:d})})):null,(0,o.createElement)("div",{className:oc(Jf.pointer),style:t}))}!function(e){e[e.Up=0]="Up",e[e.Down=1]="Down"}(qf||(qf={}));var Jf=vc.create(fc({variationPicker:{".":nc.variationPicker,position:"absolute",right:"15px",left:"15px",padding:"5px",boxShadow:"0px 2px 5px rgba(0, 0, 0, 0.2)",borderRadius:"3px",display:"flex",alignItems:"center",justifyContent:"space-around",opacity:"0",visibility:"hidden",pointerEvents:"none",top:"-100%",border:"1px solid var(--epr-picker-border-color)",height:"var(--epr-emoji-variation-picker-height)",zIndex:"var(--epr-skin-variation-picker-z-index)",background:"var(--epr-emoji-variation-picker-bg-color)",transform:"scale(0.9)",transition:"transform 0.1s ease-out, opacity 0.2s ease-out"},visible:{opacity:"1",visibility:"visible",pointerEvents:"all",transform:"scale(1)"},pointingUp:{".":"pointing-up",transformOrigin:"center 0%",transform:"scale(0.9)"},".pointing-up":{pointer:{top:"0",transform:"rotate(180deg) translateY(100%) translateX(18px)"}},pointer:{".":"epr-emoji-pointer",content:"",position:"absolute",width:"25px",height:"15px",backgroundRepeat:"no-repeat",backgroundPosition:"0 0",backgroundSize:"50px 15px",top:"100%",transform:"translateX(-18px)",backgroundImage:"url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDI2LjMuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSI1MHB4IgoJIGhlaWdodD0iMTVweCIgdmlld0JveD0iMCAwIDUwIDE1IiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCA1MCAxNSIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxnIGlkPSJMYXllcl8xIj4KPC9nPgo8ZyBpZD0iTGF5ZXJfMiI+Cgk8cGF0aCBmaWxsPSIjRkZGRkZGIiBzdHJva2U9IiNFOEU3RTciIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTTEuODYtMC40M2w5LjgzLDExLjUzYzAuNTksMC42OSwxLjU2LDAuNjksMi4xNCwwbDkuODMtMTEuNTMiLz4KCTxwYXRoIGZpbGw9IiMwMTAyMDIiIHN0cm9rZT0iIzE1MTYxNyIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNMjYuODYtMC40M2w5LjgzLDExLjUzYzAuNTksMC42OSwxLjU2LDAuNjksMi4xNCwwbDkuODMtMTEuNTMiLz4KPC9nPgo8L3N2Zz4=)"}},Sc("pointer",{backgroundPosition:"-25px 0"})));function Zf(){var e=nl();return function(e){var t=hl();(0,o.useEffect)((function(){var n=e.current;if(n)return n.addEventListener("scroll",r,{passive:!0}),function(){null==n||n.removeEventListener("scroll",r)};function r(){t()}}),[e,t])}(e),Cf(e,mu.PICKER),function(){var e=nl(),t=gl(),n=ml();(0,o.useEffect)((function(){var r=e.current;function a(){n()&&t()}return null==r||r.addEventListener("mousemove",a,{passive:!0}),function(){null==r||r.removeEventListener("mousemove",a)}}),[e,t,n])}(),(0,o.createElement)("div",{className:oc(td.body,wc.hiddenOnReactions),ref:e},(0,o.createElement)(Qf,null),(0,o.createElement)(Yf,null))}var $f,ed,td=vc.create({body:{".":nc.scrollBody,flex:"1",overflowY:"scroll",overflowX:"hidden",position:"relative"}});function nd(e,t){var n=nl(),r=ml(),a=gl();(0,o.useEffect)((function(){if(e){var a=n.current;return null==a||a.addEventListener("keydown",s,{passive:!0}),null==a||a.addEventListener("mouseover",c,!0),null==a||a.addEventListener("focus",i,!0),null==a||a.addEventListener("mouseout",o,{passive:!0}),null==a||a.addEventListener("blur",o,!0),function(){null==a||a.removeEventListener("mouseover",c),null==a||a.removeEventListener("mouseout",o),null==a||a.removeEventListener("focus",i,!0),null==a||a.removeEventListener("blur",o,!0),null==a||a.removeEventListener("keydown",s)}}function i(e){var n=ql(e.target);if(!n)return o();var r=sf(n),a=r.unified,i=r.originalUnified;if(!a||!i)return o();t({unified:a,originalUnified:i})}function o(e){if(e&&!ql(e.relatedTarget))return t(null);t(null)}function s(e){"Escape"===e.key&&t(null)}function c(e){if(!r()){var n=ql(e.target);if(n){var i=function(e,t){if(!e||!t)return 0;var n=e.getBoundingClientRect(),r=t.getBoundingClientRect();return r.height-(n.y-r.y)}(n,a);if(i<n.getBoundingClientRect().height)return function(e,t){var n,r=sf(e),a=r.unified,i=r.originalUnified;if(!a||!i)return;null==(n=document.activeElement)||null==n.blur||n.blur(),t({unified:a,originalUnified:i})}(n,t);Vu(n)}}}}),[n,e,t,r,a])}function rd(e){var t=e.children,n=e.className,r=e.style,a=void 0===r?{}:r,i=e.direction,s=void 0===i?ed.ROW:i;return(0,o.createElement)("div",{style:fc({},a),className:oc(ad.flex,n,ad[s])},t)}!function(e){e.ROW="FlexRow",e.COLUMN="FlexColumn"}(ed||(ed={}));var ad=vc.create((($f={flex:{display:"flex"}})[ed.ROW]={flexDirection:"row"},$f[ed.COLUMN]={flexDirection:"column"},$f));function id(e){var t=e.className,n=e.style,r=void 0===n?{}:n;return(0,o.createElement)("div",{style:fc({flex:1},r),className:oc(t)})}function od(e){var t=e.children,n=e.className,r=e.style;return(0,o.createElement)("div",{style:fc({},r,{position:"absolute"}),className:n},t)}function sd(e){var t=e.children,n=e.className,r=e.style;return(0,o.createElement)("div",{style:fc({},r,{position:"relative"}),className:n},t)}function cd(e){var t=e.isOpen,n=e.onClick,r=e.isActive,a=e.skinToneVariation,i=e.style;return(0,o.createElement)(_f,{style:i,onClick:n,className:oc("epr-tone-"+a,ld.tone,!t&&ld.closedTone,r&&ld.active),tabIndex:t?0:-1,"aria-pressed":r,"aria-label":"Skin tone "+Wc[a]})}var ud,ld=vc.create({closedTone:{opacity:"0",zIndex:"0"},active:{".":"epr-active",zIndex:"1",opacity:"1"},tone:{".":"epr-tone",":hover":{boxShadow:"0 0 0 3px var(--epr-active-skin-hover-color)"},":focus":{boxShadow:"0 0 0 3px var(--epr-focus-bg-color)"},"&.epr-tone-neutral":{backgroundColor:"#ffd225"},"&.epr-tone-1f3fb":{backgroundColor:"#ffdfbd"},"&.epr-tone-1f3fc":{backgroundColor:"#e9c197"},"&.epr-tone-1f3fd":{backgroundColor:"#c88e62"},"&.epr-tone-1f3fe":{backgroundColor:"#a86637"},"&.epr-tone-1f3ff":{backgroundColor:"#60463a"}}});function fd(){return(0,o.createElement)(sd,{style:{height:28}},(0,o.createElement)(od,{style:{bottom:0,right:0}},(0,o.createElement)(dd,{direction:ud.VERTICAL})))}function dd(e){var t=e.direction,n=void 0===t?ud.HORIZONTAL:t,r=al(),a=wu(),i=Uu(),s=i[0],c=i[1],u=zu(),l=u[0],f=u[1],d=bu().current.onSkinToneChange||function(){},h=hl(),p=vl();if(a)return null;var g=28*Uc.length+"px",m=s?g:"28px",v=n===ud.VERTICAL;return(0,o.createElement)(sd,{className:oc(hd.skinTones,v&&hd.vertical,s&&hd.open,v&&s&&hd.verticalShadow),style:v?{flexBasis:m,height:m}:{flexBasis:m}},(0,o.createElement)("div",{className:oc(hd.select),ref:r},Uc.map((function(e,t){var n=e===l;return(0,o.createElement)(cd,{key:e,skinToneVariation:e,isOpen:s,style:{transform:oc(v?"translateY(-"+t*(s?28:0)+"px)":"translateX(-"+t*(s?28:0)+"px)",s&&n&&"scale(1.3)")},isActive:n,onClick:function(){s?(f(e),d(e),p()):c(!0),h()}})}))))}!function(e){e.VERTICAL="epr-vertical",e.HORIZONTAL="epr-horizontal"}(ud||(ud={}));var hd=vc.create({skinTones:{".":"epr-skin-tones","--":{"--epr-skin-tone-size":"15px"},display:"flex",alignItems:"center",justifyContent:"flex-end",transition:"all 0.3s ease-in-out",padding:"10px 0"},vertical:{padding:"9px",alignItems:"flex-end",flexDirection:"column",borderRadius:"6px",border:"1px solid var(--epr-bg-color)"},verticalShadow:{boxShadow:"0px 0 7px var(--epr-picker-border-color)"},open:{backdropFilter:"blur(5px)",background:"var(--epr-skin-tone-picker-menu-color)",".epr-active:after":{content:"",position:"absolute",top:"-2px",left:"-2px",right:"-2px",bottom:"-2px",borderRadius:"5px",border:"1px solid var(--epr-active-skin-tone-indicator-border-color)"}},select:{".":"epr-skin-tone-select",position:"relative",width:"var(--epr-skin-tone-size)",height:"var(--epr-skin-tone-size)","> button":{width:"var(--epr-skin-tone-size)",display:"block",cursor:"pointer",borderRadius:"4px",height:"var(--epr-skin-tone-size)",position:"absolute",right:"0",transition:"transform 0.3s ease-in-out, opacity 0.35s ease-in-out",zIndex:"0",boxShadow:"0 0 0 0px var(--epr-active-skin-hover-color)"}}});function pd(){var e=Mu(),t=El();return e.showPreview?(0,o.createElement)(rd,{className:oc(md.preview,wc.hiddenOnReactions)},(0,o.createElement)(gd,null),(0,o.createElement)(id,null),t?(0,o.createElement)(fd,null):null):null}function gd(){var e,t=Mu(),n=(0,o.useState)(null),r=n[0],a=n[1],i=Su(),s=Bu()[0],c=Tu();nd(t.showPreview,a);var u=eu(null!=(e=null==r?void 0:r.unified)?e:null==r?void 0:r.originalUnified),l=null!=u&&null!=r;return(0,o.createElement)((function(){var e=null!=s?s:eu(t.defaultEmoji);if(!e)return null;var n=s?Xc(s):t.defaultCaption;return(0,o.createElement)(o.Fragment,null,(0,o.createElement)("div",null,l?(0,o.createElement)(Of,{unified:null==r?void 0:r.unified,emoji:u,emojiStyle:i,size:45,getEmojiUrl:c,className:oc(md.emoji)}):e?(0,o.createElement)(Of,{unified:Kc(e),emoji:e,emojiStyle:i,size:45,getEmojiUrl:c,className:oc(md.emoji)}):null),(0,o.createElement)("div",{className:oc(md.label)},l?Xc(u):n))}),null)}var md=vc.create({preview:{alignItems:"center",borderTop:"1px solid var(--epr-preview-border-color)",height:"var(--epr-preview-height)",padding:"0 var(--epr-horizontal-padding)",position:"relative",zIndex:"var(--epr-preview-z-index)"},label:{color:"var(--epr-preview-text-color)",fontSize:"var(--epr-preview-text-size)",padding:"var(--epr-preview-text-padding)",textTransform:"capitalize"},emoji:{padding:"0"}});function vd(e){var t;return null!=(t=null==e?void 0:e.getAttribute("data-name"))?t:null}function bd(){var e=gu().customEmojis;return!!e&&0===e.length}function yd(e){var t,n=e.isActiveCategory,r=e.category,a=e.allowNavigation,i=e.categoryConfig,s=e.onClick;return(0,o.createElement)(_f,{tabIndex:a?0:-1,className:oc(Cd.catBtn,wc.categoryBtn,"epr-icn-"+r,(t={},t[nc.active]=n,t)),onClick:s,"aria-label":Fc(i),"aria-selected":n,role:"tab","aria-controls":"epr-category-nav-id"})}var xd={backgroundPositionY:"calc(var(--epr-category-navigation-button-size) * 3)"},wd={backgroundPositionY:"calc(var(--epr-category-navigation-button-size) * 2)"},Sd={":not(.epr-search-active)":{catBtn:{":hover":xd,"&.epr-active":xd}}},Cd=vc.create(fc({catBtn:{".":"epr-cat-btn",display:"inline-block",transition:"opacity 0.2s ease-in-out",position:"relative",height:"var(--epr-category-navigation-button-size)",width:"var(--epr-category-navigation-button-size)",backgroundSize:"calc(var(--epr-category-navigation-button-size) * 10)",outline:"none",backgroundPosition:"0 0",backgroundImage:"url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDI2LjMuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHdpZHRoPSIyMDBweCIgaGVpZ2h0PSI4MHB4IiB2aWV3Qm94PSIwIDAgMjAwIDgwIiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAyMDAgODAiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8ZyBpZD0iTGF5ZXJfMTEiPgoJPGc+CgkJPHBhdGggZmlsbD0iIzMzNzFCNyIgc3Ryb2tlPSIjMzM3MUI3IiBzdHJva2Utd2lkdGg9IjAuMSIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNMTIuOCwyOS41YzAuNiwwLDEuMS0wLjUsMS4xLTEuMQoJCQljMC0wLjYtMC41LTEuMi0xLjEtMS4yYy0wLjYsMC0xLjIsMC41LTEuMiwxLjJDMTEuNiwyOSwxMi4yLDI5LjUsMTIuOCwyOS41eiBNMTIuOCwyOGMwLjIsMCwwLjQsMC4yLDAuNCwwLjQKCQkJYzAsMC4yLTAuMiwwLjQtMC40LDAuNGMtMC4yLDAtMC40LTAuMi0wLjQtMC40QzEyLjQsMjguMSwxMi42LDI4LDEyLjgsMjh6Ii8+CgkJPHBhdGggZmlsbD0iIzMzNzFCNyIgc3Ryb2tlPSIjMzM3MUI3IiBzdHJva2Utd2lkdGg9IjAuMSIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNMTAsMjNjLTMuOCwwLTcsMy4xLTcsN2MwLDMuOCwzLjEsNyw3LDcKCQkJczctMy4xLDctN0MxNywyNi4yLDEzLjgsMjMsMTAsMjN6IE0xMCwzNi4yYy0zLjQsMC02LjItMi44LTYuMi02LjJjMC0zLjQsMi44LTYuMiw2LjItNi4yczYuMiwyLjgsNi4yLDYuMgoJCQlDMTYuMiwzMy40LDEzLjQsMzYuMiwxMCwzNi4yeiIvPgoJCTxwYXRoIGZpbGw9IiMzMzcxQjciIHN0cm9rZT0iIzMzNzFCNyIgc3Ryb2tlLXdpZHRoPSIwLjEiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTTE0LjYsMzEuMmMtMC4xLTAuMS0wLjItMC4yLTAuMy0wLjJINS43CgkJCWMtMC4xLDAtMC4yLDAuMS0wLjMsMC4yYy0wLjEsMC4xLTAuMSwwLjIsMCwwLjRjMC43LDIsMi41LDMuMyw0LjYsMy4zczMuOS0xLjMsNC42LTMuM0MxNC43LDMxLjUsMTQuNywzMS4zLDE0LjYsMzEuMnogTTEwLDM0LjEKCQkJYy0xLjYsMC0zLTAuOS0zLjctMi4yaDcuM0MxMywzMy4yLDExLjYsMzQuMSwxMCwzNC4xeiIvPgoJCTxwYXRoIGZpbGw9IiMzMzcxQjciIHN0cm9rZT0iIzMzNzFCNyIgc3Ryb2tlLXdpZHRoPSIwLjEiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTTcuMiwyOS41YzAuNiwwLDEuMi0wLjUsMS4yLTEuMQoJCQljMC0wLjYtMC41LTEuMi0xLjItMS4yYy0wLjYsMC0xLjEsMC41LTEuMSwxLjJDNi4xLDI5LDYuNiwyOS41LDcuMiwyOS41eiBNNy4yLDI4YzAuMiwwLDAuNCwwLjIsMC40LDAuNGMwLDAuMi0wLjIsMC40LTAuNCwwLjQKCQkJYy0wLjIsMC0wLjQtMC4yLTAuNC0wLjRDNi44LDI4LjEsNywyOCw3LjIsMjh6Ii8+Cgk8L2c+Cgk8Zz4KCQk8Zz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMzM3MUI3IiBkPSJNNjQuMSwzMy40bDIuMywwYzAuMiwwLDAuNCwwLjIsMC40LDAuNHYyLjFjMCwwLjItMC4yLDAuNC0wLjQsMC40aC0yLjMKCQkJCWMtMC4yLDAtMC40LTAuMi0wLjQtMC40di0yLjFDNjMuNywzMy42LDYzLjgsMzMuNCw2NC4xLDMzLjR6Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzMzNzFCNyIgZD0iTTczLjUsMzMuNWgyLjRjMC4yLDAsMC40LDAuMiwwLjQsMC40djJjMCwwLjItMC4yLDAuNC0wLjQsMC40aC0yLjQKCQkJCWMtMC4yLDAtMC40LTAuMi0wLjQtMC40bDAtMkM3My4xLDMzLjYsNzMuMywzMy41LDczLjUsMzMuNXoiLz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMzM3MUI3IiBkPSJNNjMuNywyOC40aDEyLjZ2NUg2My43VjI4LjR6Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzMzNzFCNyIgZD0iTTY1LjUsMjMuNmg4LjljMSwwLDEuOSwwLjgsMS45LDEuOXYzLjFINjMuN3YtMy4xQzYzLjcsMjQuNSw2NC41LDIzLjYsNjUuNSwyMy42eiIvPgoJCQk8ZWxsaXBzZSBmaWxsPSIjMzM3MUI3IiBjeD0iNjYuMiIgY3k9IjMwLjkiIHJ4PSIwLjkiIHJ5PSIxIi8+CgkJCTxlbGxpcHNlIGZpbGw9IiMzMzcxQjciIGN4PSI3My44IiBjeT0iMzAuOSIgcng9IjAuOSIgcnk9IjEiLz4KCQk8L2c+Cgk8L2c+Cgk8Zz4KCQk8Zz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMzM3MUI3IiBkPSJNOTYuNCwzMGMwLDMuNi0yLjksNi41LTYuNCw2LjVzLTYuNC0yLjktNi40LTYuNXMyLjktNi41LDYuNC02LjVTOTYuNCwyNi40LDk2LjQsMzB6Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzMzNzFCNyIgZD0iTTk2LjMsMjguNmMwLDAsMCwwLjEsMCwwLjFjLTAuOSwwLjEtMi45LDAuMS00LjYtMS4xYy0xLjEtMC44LTItMS43LTIuNi0yLjUKCQkJCWMtMC4zLTAuNC0wLjYtMC44LTAuNy0xYy0wLjEtMC4xLTAuMS0wLjEtMC4xLTAuMmMwLjUtMC4xLDEuMi0wLjIsMi0wLjFjMS4yLDAsMi41LDAuMywzLjUsMS4xYzEsMC44LDEuNywxLjgsMi4xLDIuOAoJCQkJQzk2LjEsMjcuOSw5Ni4yLDI4LjMsOTYuMywyOC42eiIvPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMzMzcxQjciIGQ9Ik04NCwzMi4yYzAsMCwwLTAuMSwwLTAuMWMwLjktMC4yLDIuOS0wLjQsNC43LDAuNmMxLjEsMC43LDEuOSwxLjUsMi40LDIuMwoJCQkJYzAuNCwwLjUsMC42LDEsMC43LDEuM2MtMC40LDAuMS0xLDAuMi0xLjcsMC4zYy0xLDAtMi4xLTAuMS0zLjItMC44cy0xLjktMS42LTIuNC0yLjVDODQuMiwzMi44LDg0LjEsMzIuNSw4NCwzMi4yeiIvPgoJCTwvZz4KCTwvZz4KCTxnPgoJCTxnPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMzMzcxQjciIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZD0iTTExNi4zLDI2LjhsLTEuNCwybC0wLjgtMC44bC0wLjYtMC42bDAsMC45bC0wLjEsOC4yaC02LjgKCQkJCWwtMC4xLTguMmwwLTAuOWwtMC42LDAuNmwtMC44LDAuOGwtMS40LTJsMi42LTIuOWMwLjEtMC4xLDAuMi0wLjEsMC4zLTAuMWgxLjNsMC40LDAuN2MwLjcsMS4zLDIuNiwxLjMsMy4zLTAuMWwwLjMtMC42aDEuMgoJCQkJYzAuMSwwLDAuMiwwLDAuMywwLjFsMC4zLTAuM2wtMC4zLDAuM0wxMTYuMywyNi44eiIvPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMzMzcxQjciIGQ9Ik0xMTAuMSwyNy43aDJ2MC45YzAsMC40LTAuNCwwLjctMSwwLjdjLTAuNiwwLTEtMC4zLTEtMC43TDExMC4xLDI3LjdMMTEwLjEsMjcuN3oiLz4KCQk8L2c+Cgk8L2c+Cgk8Zz4KCQk8Zz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMzM3MUI3IiBkPSJNMTI2LjgsMzQuM2MwLDEuMi0xLDIuMi0yLjIsMi4ycy0yLjItMS0yLjItMi4yczEtMi4yLDIuMi0yLjJTMTI2LjgsMzMuMSwxMjYuOCwzNC4zeiIvPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMzMzcxQjciIGQ9Ik0xMzcuNiwzNC4zYzAsMS4yLTEsMi4yLTIuMiwyLjJjLTEuMiwwLTIuMi0xLTIuMi0yLjJzMS0yLjIsMi4yLTIuMgoJCQkJQzEzNi42LDMyLjEsMTM3LjYsMzMuMSwxMzcuNiwzNC4zeiIvPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMzMzcxQjciIGQ9Ik0xMjYuOCwyNC40djkuOSIvPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMzMzcxQjciIGQ9Ik0xMzcuNywyNC40djkuOSIvPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMzMzcxQjciIGQ9Ik0xMjYuOCwyMy41aDEwLjh2Mi43aC0xMC44QzEyNi44LDI2LjIsMTI2LjgsMjMuNSwxMjYuOCwyMy41eiIvPgoJCTwvZz4KCTwvZz4KCTxnPgoJCTxnPgoJCQk8cGF0aCBmaWxsPSIjMzM3MUI3IiBkPSJNMTcwLjgsMjMuMUwxNzAuOCwyMy4xYy0wLjMsMC0wLjUsMC0wLjgsMGMtMi4xLDAtNCwxLTUuMywyLjVsLTAuMSwwbC0wLjEtMC4xbC0xLTEuMmwtMC4zLDMuNGwzLjQsMC4zCgkJCQlsLTEuMS0xLjNsLTAuMS0wLjFsMC4xLTAuMWMxLjEtMS41LDMtMi4zLDUtMi4xbDAsMGMzLjIsMC4zLDUuNSwzLjEsNS4yLDYuM2MtMC4zLDMtMy4xLDUuMy02LjEsNS4xYy0zLjEtMC4yLTUuNC0yLjktNS4zLTYKCQkJCWwtMS4zLTAuMWMtMC4yLDMuOCwyLjYsNy4xLDYuMyw3LjRjMy45LDAuMyw3LjMtMi42LDcuNi02LjVDMTc3LjIsMjYuOCwxNzQuNCwyMy41LDE3MC44LDIzLjF6Ii8+CgkJCTxwYXRoIGZpbGw9IiMzMzcxQjciIGQ9Ik0xNzAuMywyNy40YzAtMC4zLTAuMy0wLjYtMC42LTAuNnMtMC42LDAuMy0wLjYsMC42djMuMmMwLDAuMiwwLjEsMC4zLDAuMiwwLjRjMC4xLDAuMSwwLjMsMC4yLDAuNCwwLjIKCQkJCWgyLjRjMC40LDAsMC42LTAuMywwLjYtMC42YzAtMC40LTAuMy0wLjYtMC42LTAuNmgtMS42aC0wLjJ2LTAuMkwxNzAuMywyNy40TDE3MC4zLDI3LjR6Ii8+CgkJPC9nPgoJPC9nPgoJPGc+CgkJPGc+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzMzNzFCNyIgZD0iTTE4Ni4yLDIzLjRoNy43YzEuNSwwLDIuNywxLjIsMi43LDIuN3Y3LjdjMCwxLjUtMS4yLDIuNy0yLjcsMi43aC03LjcKCQkJCWMtMS41LDAtMi43LTEuMi0yLjctMi43di03LjdDMTgzLjQsMjQuNiwxODQuNywyMy40LDE4Ni4yLDIzLjR6Ii8+CgkJCTxlbGxpcHNlIGZpbGw9IiMzMzcxQjciIGN4PSIxODYiIGN5PSIyOC45IiByeD0iMC43IiByeT0iMC43Ii8+CgkJCTxlbGxpcHNlIGZpbGw9IiMzMzcxQjciIGN4PSIxOTQiIGN5PSIyNi43IiByeD0iMC43IiByeT0iMC43Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzMzNzFCNyIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNMTg2LDMzLjNsMC40LTAuM2MwLjQtMC4zLDEtMC4zLDEuNS0wLjFsMSwwLjQKCQkJCWMwLjUsMC4yLDEsMC4yLDEuNS0wLjFsMC44LTAuNWMwLjQtMC4zLDEtMC4zLDEuNS0wLjFsMS44LDAuOCIvPgoJCTwvZz4KCTwvZz4KCTxwYXRoIGZpbGw9IiMzMzcxQjciIHN0cm9rZT0iIzMzNzFCNyIgc3Ryb2tlLXdpZHRoPSIwLjI1IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGQ9Ik0xNTYsMjQuM2MtMC4yLTAuMS0wLjQtMC4xLTAuNSwwCgkJYzAsMC0wLjIsMC4xLTAuOSwwLjJjLTAuNywwLTIuNC0wLjEtMy44LTAuNmMtMC44LTAuMy0xLjctMC41LTIuNS0wLjVjLTAuMiwwLTAuNCwwLTAuNSwwYy0xLjMsMC0yLjUsMC4zLTMuNiwxCgkJYy0wLjIsMC4xLTAuMiwwLjItMC4yLDAuNHYxMS42YzAsMC4zLDAuMSwwLjUsMC4zLDAuNWMwLjYsMCwwLjUtMC40LDAuNS0wLjZ2LTUuN2MwLjctMC4zLDMuMi0xLjEsNS44LTAuMQoJCWMxLjYsMC42LDMuNSwwLjcsNC4zLDAuN2MwLjgsMCwxLjMtMC4zLDEuMy0wLjNjMC4yLTAuMSwwLjMtMC4yLDAuMy0wLjR2LTUuN0MxNTYuMiwyNC42LDE1Ni4xLDI0LjQsMTU2LDI0LjN6IE0xNTUuNiwzMC4yCgkJYy0wLjEsMC0wLjcsMC4xLTEsMC4xYy0wLjcsMC0yLjQtMC4xLTMuOC0wLjZjLTIuNS0xLTUtMC41LTYuMi0wLjF2LTQuOWMwLjktMC41LDIuMi0wLjcsMy4yLTAuN2MwLjEsMCwwLjMsMCwwLjQsMAoJCWMwLjcsMCwxLjUsMC4yLDIuMiwwLjRjMS42LDAuNiwzLjUsMC43LDQuMywwLjdjMC4yLDAsMC44LDAsMS0wLjFWMzAuMnoiLz4KCTxnPgoJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzMzNzFCNyIgZD0iTTQ4LjEsMjMuNWgzLjdjMi41LDAsNC41LDIsNC41LDQuNWMwLDAuNS0wLjQsMC45LTAuOSwwLjlINDQuNWMtMC41LDAtMC45LTAuNC0wLjktMC45CgkJCUM0My42LDI1LjUsNDUuNiwyMy41LDQ4LjEsMjMuNXoiLz4KCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMzMzcxQjciIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZD0iTTQzLjUsMjguOGMtMC4yLDAuMS0wLjUsMS4yLDAsMS41YzEuNCwxLDguNSwwLjgsMTEuMywwLjYKCQkJYzAuOC0wLjEsMS42LTAuNCwxLjctMS4yYzAtMC4zLTAuMS0wLjYtMC42LTAuOSIvPgoJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzMzNzFCNyIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNNDMuNSwzMC42TDQzLjMsMzFjLTAuMiwwLjUsMC4yLDEsMC43LDAuOWMwLjMtMC4xLDAuNSwwLDAuNywwLjMKCQkJbDAuMSwwLjJjMC4zLDAuNSwxLDAuNiwxLjUsMC4ybDAsMGMwLjMtMC4yLDAuNy0wLjMsMS0wLjJsMC44LDAuM2MwLjQsMC4yLDAuOCwwLjEsMS4yLDBsMC41LTAuMmMwLjQtMC4yLDAuOS0wLjIsMS4zLDBsMC41LDAuMgoJCQljMC40LDAuMiwwLjgsMC4yLDEuMiwwbDAuMi0wLjFjMC4zLTAuMiwwLjgtMC4yLDEuMSwwLjFsMC4yLDAuMmMwLjMsMC4zLDAuOCwwLjIsMS0wLjJsMC4xLTAuMmMwLjEtMC4yLDAtMC4zLDAuMi0wLjMKCQkJYzAuNSwwLDEuMi0wLjMsMS4xLTAuN2wtMC40LTEuMSIvPgoJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzMzNzFCNyIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNNDMuNSwzMi4yYy0wLjEsMC4yLTAuMywwLjgsMCwxLjFjMC4zLDAuNCwzLDEuMSw2LjQsMS4xCgkJCWMyLjIsMCw0LjYtMC4zLDYtMC42YzAuNS0wLjEsMC45LTAuNSwwLjgtMC45YzAtMC4yLTAuMi0wLjUtMC40LTAuNyIvPgoJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzMzNzFCNyIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNNDMuNSwzMy4zYzAsMC41LDAuNiwyLjMsMS4zLDIuN2MxLjgsMC44LDUuNywwLjcsOC4xLDAuNQoJCQljMS4zLTAuMSwyLjUtMC43LDMuMi0xLjhjMC4zLTAuNSwwLjUtMSwwLjUtMS40Ii8+CgkJPGVsbGlwc2UgZmlsbD0iIzMzNzFCNyIgY3g9IjUxLjYiIGN5PSIyNi41IiByeD0iMC4zIiByeT0iMC40Ii8+CgkJPGVsbGlwc2UgZmlsbD0iIzMzNzFCNyIgY3g9IjUzIiBjeT0iMjUiIHJ4PSIwLjMiIHJ5PSIwLjQiLz4KCQk8ZWxsaXBzZSBmaWxsPSIjMzM3MUI3IiBjeD0iNTMiIGN5PSIyNy4yIiByeD0iMC4zIiByeT0iMC40Ii8+CgkJPGVsbGlwc2UgZmlsbD0iIzMzNzFCNyIgY3g9IjU0LjMiIGN5PSIyNi41IiByeD0iMC4zIiByeT0iMC40Ii8+CgkJPGVsbGlwc2UgZmlsbD0iIzMzNzFCNyIgY3g9IjUwLjkiIGN5PSIyNSIgcng9IjAuMyIgcnk9IjAuNCIvPgoJPC9nPgoJPGc+CgkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMzM3MUI3IiBkPSJNMjQuMiwzMXYtNy42YzAuMSwwLjEsMC44LDAuOSwyLjgsMy4xYzIuNS0xLjYsNS42LTAuNyw2LjksMGwyLjQtMy4xdjcuMQoJCQljMCwxLjItMC4xLDIuNS0wLjksMy40Yy0xLDEuMi0yLjcsMi41LTUuMywyLjVjLTIuOSwwLTQuNS0xLjUtNS4zLTIuOUMyNC4yLDMyLjksMjQuMiwzMiwyNC4yLDMxeiIvPgoJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzMzNzFCNyIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNMjEuMiwzMGw1LjQsMS4yIi8+CgkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMzM3MUI3IiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik0yMS4yLDM0LjFsNS40LTEuMiIvPgoJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzMzNzFCNyIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNMzguOCwzMGwtNS40LDEuMiIvPgoJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzMzNzFCNyIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNMzguOCwzNC4xbC01LjQtMS4yIi8+CgkJPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGZpbGw9IiMzMzcxQjciIGQ9Ik0yOS41LDMyLjRMMjksMzEuN2MtMC4yLTAuMywwLTAuNiwwLjMtMC42aDEuNAoJCQljMC4zLDAsMC41LDAuNCwwLjMsMC42bC0wLjcsMWwwLDBjLTAuNywxLjItMi42LDEuMS0zLjEtMC4zbC0wLjEtMC4yYy0wLjEtMC4yLDAtMC40LDAuMi0wLjVzMC40LDAsMC41LDAuMmwwLjEsMC4yCgkJCUMyOC4zLDMyLjgsMjkuMSwzMi45LDI5LjUsMzIuNHoiLz4KCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMzMzcxQjciIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZD0iTTMyLjQsMzIuMWwtMC4xLDAuMmMtMC40LDEtMS44LDEuMS0yLjMsMC4yIi8+CgkJPGVsbGlwc2UgZmlsbD0iIzMzNzFCNyIgY3g9IjI3LjYiIGN5PSIyOS43IiByeD0iMC43IiByeT0iMC43Ii8+CgkJPGVsbGlwc2UgZmlsbD0iIzMzNzFCNyIgY3g9IjMyLjQiIGN5PSIyOS43IiByeD0iMC43IiByeT0iMC43Ii8+Cgk8L2c+Cgk8Zz4KCQk8cGF0aCBmaWxsPSIjQzBDMEJGIiBzdHJva2U9IiNDMEMwQkYiIHN0cm9rZS13aWR0aD0iMC4xIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGQ9Ik0xMi44LDQ5LjVjMC42LDAsMS4xLTAuNSwxLjEtMS4xCgkJCWMwLTAuNi0wLjUtMS4yLTEuMS0xLjJjLTAuNiwwLTEuMiwwLjUtMS4yLDEuMkMxMS42LDQ5LDEyLjIsNDkuNSwxMi44LDQ5LjV6IE0xMi44LDQ4YzAuMiwwLDAuNCwwLjIsMC40LDAuNAoJCQljMCwwLjItMC4yLDAuNC0wLjQsMC40Yy0wLjIsMC0wLjQtMC4yLTAuNC0wLjRDMTIuNCw0OC4xLDEyLjYsNDgsMTIuOCw0OHoiLz4KCQk8cGF0aCBmaWxsPSIjQzBDMEJGIiBzdHJva2U9IiNDMEMwQkYiIHN0cm9rZS13aWR0aD0iMC4xIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGQ9Ik0xNC42LDUxLjJjLTAuMS0wLjEtMC4yLTAuMi0wLjMtMC4ySDUuNwoJCQljLTAuMSwwLTAuMiwwLjEtMC4zLDAuMmMtMC4xLDAuMS0wLjEsMC4yLDAsMC40YzAuNywyLDIuNSwzLjMsNC42LDMuM3MzLjktMS4zLDQuNi0zLjNDMTQuNyw1MS41LDE0LjcsNTEuMywxNC42LDUxLjJ6IE0xMCw1NC4xCgkJCWMtMS42LDAtMy0wLjktMy43LTIuMmg3LjNDMTMsNTMuMiwxMS42LDU0LjEsMTAsNTQuMXoiLz4KCQk8cGF0aCBmaWxsPSIjQzBDMEJGIiBzdHJva2U9IiNDMEMwQkYiIHN0cm9rZS13aWR0aD0iMC4xIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGQ9Ik03LjIsNDkuNWMwLjYsMCwxLjItMC41LDEuMi0xLjEKCQkJYzAtMC42LTAuNS0xLjItMS4yLTEuMmMtMC42LDAtMS4xLDAuNS0xLjEsMS4yQzYuMSw0OSw2LjYsNDkuNSw3LjIsNDkuNXogTTcuMiw0OGMwLjIsMCwwLjQsMC4yLDAuNCwwLjRjMCwwLjItMC4yLDAuNC0wLjQsMC40CgkJCWMtMC4yLDAtMC40LTAuMi0wLjQtMC40QzYuOCw0OC4xLDcsNDgsNy4yLDQ4eiIvPgoJCTxwYXRoIGZpbGw9IiNDMEMwQkYiIHN0cm9rZT0iI0MwQzBCRiIgc3Ryb2tlLXdpZHRoPSIwLjEiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTTEwLDQzYy0zLjgsMC03LDMuMS03LDdjMCwzLjgsMy4xLDcsNyw3CgkJCXM3LTMuMSw3LTdDMTcsNDYuMiwxMy44LDQzLDEwLDQzeiBNMTAsNTYuMmMtMy40LDAtNi4yLTIuOC02LjItNi4yYzAtMy40LDIuOC02LjIsNi4yLTYuMnM2LjIsMi44LDYuMiw2LjIKCQkJQzE2LjIsNTMuNCwxMy40LDU2LjIsMTAsNTYuMnoiLz4KCTwvZz4KCTxnPgoJCTxnPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNDMEMwQkYiIGQ9Ik02NC4xLDUzLjRsMi4zLDBjMC4yLDAsMC40LDAuMiwwLjQsMC40djIuMWMwLDAuMi0wLjIsMC40LTAuNCwwLjRoLTIuMwoJCQkJYy0wLjIsMC0wLjQtMC4yLTAuNC0wLjR2LTIuMUM2My43LDUzLjYsNjMuOCw1My40LDY0LjEsNTMuNHoiLz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjQzBDMEJGIiBkPSJNNzMuNSw1My41aDIuNGMwLjIsMCwwLjQsMC4yLDAuNCwwLjR2MmMwLDAuMi0wLjIsMC40LTAuNCwwLjRoLTIuNAoJCQkJYy0wLjIsMC0wLjQtMC4yLTAuNC0wLjRsMC0yQzczLjEsNTMuNiw3My4zLDUzLjUsNzMuNSw1My41eiIvPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNDMEMwQkYiIGQ9Ik02My43LDQ4LjRoMTIuNnY1SDYzLjdWNDguNHoiLz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjQzBDMEJGIiBkPSJNNjUuNSw0My42aDguOWMxLDAsMS45LDAuOCwxLjksMS45djMuMUg2My43di0zLjFDNjMuNyw0NC41LDY0LjUsNDMuNiw2NS41LDQzLjZ6Ii8+CgkJCTxlbGxpcHNlIGZpbGw9IiNDMEMwQkYiIGN4PSI2Ni4yIiBjeT0iNTAuOSIgcng9IjAuOSIgcnk9IjEiLz4KCQkJPGVsbGlwc2UgZmlsbD0iI0MwQzBCRiIgY3g9IjczLjgiIGN5PSI1MC45IiByeD0iMC45IiByeT0iMSIvPgoJCTwvZz4KCTwvZz4KCTxnPgoJCTxnPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNDMEMwQkYiIGQ9Ik05Ni40LDUwYzAsMy42LTIuOSw2LjUtNi40LDYuNXMtNi40LTIuOS02LjQtNi41czIuOS02LjUsNi40LTYuNVM5Ni40LDQ2LjQsOTYuNCw1MHoiLz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjQzBDMEJGIiBkPSJNOTYuMyw0OC42YzAsMCwwLDAuMSwwLDAuMWMtMC45LDAuMS0yLjksMC4xLTQuNi0xLjJjLTEuMS0wLjgtMi0xLjctMi42LTIuNQoJCQkJYy0wLjMtMC40LTAuNi0wLjgtMC43LTFjLTAuMS0wLjEtMC4xLTAuMi0wLjEtMC4yYzAuNS0wLjEsMS4yLTAuMiwyLTAuMmMxLjIsMCwyLjUsMC4zLDMuNSwxLjFjMSwwLjgsMS43LDEuOCwyLjEsMi44CgkJCQlDOTYuMSw0Ny45LDk2LjIsNDguMyw5Ni4zLDQ4LjZ6Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0MwQzBCRiIgZD0iTTg0LDUyLjJjMCwwLDAtMC4xLDAtMC4xYzAuOS0wLjIsMi45LTAuNCw0LjcsMC42YzEuMSwwLjcsMS45LDEuNSwyLjQsMi4zCgkJCQljMC40LDAuNSwwLjYsMSwwLjcsMS4zYy0wLjQsMC4xLTEsMC4yLTEuNywwLjNjLTEsMC0yLjEtMC4xLTMuMi0wLjhzLTEuOS0xLjYtMi40LTIuNUM4NC4yLDUyLjgsODQuMSw1Mi41LDg0LDUyLjJ6Ii8+CgkJPC9nPgoJPC9nPgoJPGc+CgkJPGc+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0MwQzBCRiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNMTE2LjMsNDYuOGwtMS40LDJsLTAuOC0wLjhsLTAuNi0wLjdsMCwwLjlsLTAuMSw4LjJoLTYuOAoJCQkJbC0wLjEtOC4ybDAtMC45bC0wLjYsMC43bC0wLjgsMC44bC0xLjQtMmwyLjYtMi45YzAuMS0wLjEsMC4yLTAuMSwwLjMtMC4xaDEuM2wwLjQsMC43YzAuNywxLjMsMi42LDEuMywzLjMtMC4xbDAuMy0wLjZoMS4yCgkJCQljMC4xLDAsMC4yLDAsMC4zLDAuMWwwLjMtMC4zbC0wLjMsMC4zTDExNi4zLDQ2Ljh6Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0MwQzBCRiIgZD0iTTExMC4xLDQ3LjdoMnYwLjljMCwwLjQtMC40LDAuNy0xLDAuN2MtMC42LDAtMS0wLjMtMS0wLjdMMTEwLjEsNDcuN0wxMTAuMSw0Ny43eiIvPgoJCTwvZz4KCTwvZz4KCTxnPgoJCTxnPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNDMEMwQkYiIGQ9Ik0xMjYuOCw1NC4zYzAsMS4yLTEsMi4yLTIuMiwyLjJzLTIuMi0xLTIuMi0yLjJzMS0yLjIsMi4yLTIuMlMxMjYuOCw1My4xLDEyNi44LDU0LjN6Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0MwQzBCRiIgZD0iTTEzNy42LDU0LjNjMCwxLjItMSwyLjItMi4yLDIuMmMtMS4yLDAtMi4yLTEtMi4yLTIuMnMxLTIuMiwyLjItMi4yCgkJCQlDMTM2LjYsNTIuMSwxMzcuNiw1My4xLDEzNy42LDU0LjN6Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0MwQzBCRiIgZD0iTTEyNi44LDQ0LjR2OS45Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0MwQzBCRiIgZD0iTTEzNy43LDQ0LjR2OS45Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0MwQzBCRiIgZD0iTTEyNi44LDQzLjVoMTAuOHYyLjdoLTEwLjhDMTI2LjgsNDYuMiwxMjYuOCw0My41LDEyNi44LDQzLjV6Ii8+CgkJPC9nPgoJPC9nPgoJPGc+CgkJPGc+CgkJCTxwYXRoIGZpbGw9IiNDMEMwQkYiIGQ9Ik0xNzAuOCw0My4xTDE3MC44LDQzLjFjLTAuMywwLTAuNSwwLTAuOCwwYy0yLjEsMC00LDEtNS4zLDIuNWwtMC4xLDBsLTAuMS0wLjFsLTEtMS4ybC0wLjMsMy40bDMuNCwwLjMKCQkJCWwtMS4xLTEuM2wtMC4xLTAuMWwwLjEtMC4xYzEuMS0xLjUsMy0yLjMsNS0yLjFsMCwwYzMuMiwwLjMsNS41LDMuMSw1LjIsNi4zYy0wLjMsMy0zLjEsNS4zLTYuMSw1LjFjLTMuMS0wLjItNS40LTIuOS01LjMtNgoJCQkJbC0xLjMtMC4xYy0wLjIsMy44LDIuNiw3LjEsNi4zLDcuNGMzLjksMC4zLDcuMy0yLjYsNy42LTYuNUMxNzcuMiw0Ni44LDE3NC40LDQzLjUsMTcwLjgsNDMuMXoiLz4KCQkJPHBhdGggZmlsbD0iI0MwQzBCRiIgZD0iTTE3MC4zLDQ3LjRjMC0wLjMtMC4zLTAuNi0wLjYtMC42cy0wLjYsMC4zLTAuNiwwLjZ2My4yYzAsMC4yLDAuMSwwLjMsMC4yLDAuNGMwLjEsMC4xLDAuMywwLjIsMC40LDAuMgoJCQkJaDIuNGMwLjQsMCwwLjYtMC4zLDAuNi0wLjZjMC0wLjMtMC4zLTAuNi0wLjYtMC42aC0xLjZoLTAuMnYtMC4yTDE3MC4zLDQ3LjRMMTcwLjMsNDcuNHoiLz4KCQk8L2c+Cgk8L2c+Cgk8Zz4KCQk8Zz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjQzBDMEJGIiBkPSJNMTg2LjIsNDMuNGg3LjdjMS41LDAsMi43LDEuMiwyLjcsMi43djcuN2MwLDEuNS0xLjIsMi43LTIuNywyLjdoLTcuNwoJCQkJYy0xLjUsMC0yLjctMS4yLTIuNy0yLjd2LTcuN0MxODMuNCw0NC43LDE4NC43LDQzLjQsMTg2LjIsNDMuNHoiLz4KCQkJPGVsbGlwc2UgZmlsbD0iI0MwQzBCRiIgY3g9IjE4NiIgY3k9IjQ4LjkiIHJ4PSIwLjciIHJ5PSIwLjciLz4KCQkJPGVsbGlwc2UgZmlsbD0iI0MwQzBCRiIgY3g9IjE5NCIgY3k9IjQ2LjciIHJ4PSIwLjciIHJ5PSIwLjciLz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjQzBDMEJGIiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik0xODYsNTMuM2wwLjQtMC4zYzAuNC0wLjMsMS0wLjMsMS41LTAuMWwxLDAuNAoJCQkJYzAuNSwwLjIsMSwwLjIsMS41LTAuMWwwLjgtMC41YzAuNC0wLjMsMS0wLjMsMS41LTAuMWwxLjgsMC44Ii8+CgkJPC9nPgoJPC9nPgoJPHBhdGggZmlsbD0iI0MwQzBCRiIgc3Ryb2tlPSIjQzBDMEJGIiBzdHJva2Utd2lkdGg9IjAuMjUiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTTE1Niw0NC4zYy0wLjItMC4xLTAuNC0wLjEtMC41LDAKCQljMCwwLTAuMiwwLjEtMC45LDAuMmMtMC43LDAtMi40LTAuMS0zLjgtMC42Yy0wLjgtMC4zLTEuNy0wLjUtMi41LTAuNWMtMC4yLDAtMC40LDAtMC41LDBjLTEuMywwLTIuNSwwLjMtMy42LDEKCQljLTAuMiwwLjEtMC4yLDAuMi0wLjIsMC40djExLjZjMCwwLjMsMC4xLDAuNSwwLjMsMC41YzAuNiwwLDAuNS0wLjQsMC41LTAuNnYtNS43YzAuNy0wLjMsMy4yLTEuMSw1LjgtMC4xCgkJYzEuNiwwLjYsMy41LDAuNyw0LjMsMC43YzAuOCwwLDEuMy0wLjMsMS4zLTAuM2MwLjItMC4xLDAuMy0wLjIsMC4zLTAuNHYtNS43QzE1Ni4yLDQ0LjYsMTU2LjEsNDQuNCwxNTYsNDQuM3ogTTE1NS42LDUwLjIKCQljLTAuMSwwLTAuNywwLjEtMSwwLjFjLTAuNywwLTIuNC0wLjEtMy44LTAuNmMtMi41LTEtNS0wLjUtNi4yLTAuMXYtNC45YzAuOS0wLjUsMi4yLTAuNywzLjItMC43YzAuMSwwLDAuMywwLDAuNCwwCgkJYzAuNywwLDEuNSwwLjIsMi4yLDAuNGMxLjYsMC42LDMuNSwwLjcsNC4zLDAuN2MwLjIsMCwwLjgsMCwxLTAuMVY1MC4yeiIvPgoJPGc+CgkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjQzBDMEJGIiBkPSJNNDguMSw0My41aDMuN2MyLjUsMCw0LjUsMiw0LjUsNC41YzAsMC41LTAuNCwwLjktMC45LDAuOUg0NC41Yy0wLjUsMC0wLjktMC40LTAuOS0wLjkKCQkJQzQzLjYsNDUuNSw0NS42LDQzLjUsNDguMSw0My41eiIvPgoJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0MwQzBCRiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNNDMuNSw0OC44Yy0wLjIsMC4xLTAuNSwxLjIsMCwxLjVjMS40LDEsOC41LDAuOCwxMS4zLDAuNgoJCQljMC44LTAuMSwxLjYtMC40LDEuNy0xLjJjMC0wLjMtMC4xLTAuNi0wLjYtMC45Ii8+CgkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjQzBDMEJGIiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik00My41LDUwLjZMNDMuMyw1MWMtMC4yLDAuNSwwLjIsMSwwLjcsMC45YzAuMy0wLjEsMC41LDAsMC43LDAuMwoJCQlsMC4xLDAuMmMwLjMsMC41LDEsMC42LDEuNSwwLjJsMCwwYzAuMy0wLjIsMC43LTAuMywxLTAuMmwwLjgsMC4zYzAuNCwwLjIsMC44LDAuMSwxLjIsMGwwLjUtMC4yYzAuNC0wLjIsMC45LTAuMiwxLjMsMGwwLjUsMC4yCgkJCWMwLjQsMC4yLDAuOCwwLjIsMS4yLDBsMC4yLTAuMWMwLjMtMC4yLDAuOC0wLjIsMS4xLDAuMWwwLjIsMC4yYzAuMywwLjMsMC44LDAuMiwxLTAuMmwwLjEtMC4yYzAuMS0wLjIsMC0wLjMsMC4yLTAuMwoJCQljMC41LDAsMS4yLTAuMywxLjEtMC43bC0wLjQtMS4xIi8+CgkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjQzBDMEJGIiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik00My41LDUyLjJjLTAuMSwwLjItMC4zLDAuOCwwLDEuMWMwLjMsMC40LDMsMS4xLDYuNCwxLjEKCQkJYzIuMiwwLDQuNi0wLjMsNi0wLjZjMC41LTAuMSwwLjktMC41LDAuOC0wLjljMC0wLjItMC4yLTAuNS0wLjQtMC43Ii8+CgkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjQzBDMEJGIiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik00My41LDUzLjNjMCwwLjUsMC42LDIuMywxLjMsMi43YzEuOCwwLjgsNS43LDAuNyw4LjEsMC41CgkJCWMxLjMtMC4xLDIuNS0wLjcsMy4yLTEuOGMwLjMtMC41LDAuNS0xLDAuNS0xLjQiLz4KCQk8ZWxsaXBzZSBmaWxsPSIjQzBDMEJGIiBjeD0iNTEuNiIgY3k9IjQ2LjUiIHJ4PSIwLjMiIHJ5PSIwLjQiLz4KCQk8ZWxsaXBzZSBmaWxsPSIjQzBDMEJGIiBjeD0iNTMiIGN5PSI0NSIgcng9IjAuMyIgcnk9IjAuNCIvPgoJCTxlbGxpcHNlIGZpbGw9IiNDMEMwQkYiIGN4PSI1MyIgY3k9IjQ3LjIiIHJ4PSIwLjMiIHJ5PSIwLjQiLz4KCQk8ZWxsaXBzZSBmaWxsPSIjQzBDMEJGIiBjeD0iNTQuMyIgY3k9IjQ2LjUiIHJ4PSIwLjMiIHJ5PSIwLjQiLz4KCQk8ZWxsaXBzZSBmaWxsPSIjQzBDMEJGIiBjeD0iNTAuOSIgY3k9IjQ1IiByeD0iMC4zIiByeT0iMC40Ii8+Cgk8L2c+Cgk8Zz4KCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNDMEMwQkYiIGQ9Ik0yNC4yLDUxdi03LjZjMC4xLDAuMSwwLjgsMC45LDIuOCwzLjFjMi41LTEuNyw1LjYtMC43LDYuOSwwbDIuNC0zLjF2Ny4xCgkJCWMwLDEuMi0wLjEsMi41LTAuOSwzLjRjLTEsMS4yLTIuNywyLjUtNS4zLDIuNWMtMi45LDAtNC41LTEuNS01LjMtMi45QzI0LjIsNTIuOSwyNC4yLDUyLDI0LjIsNTF6Ii8+CgkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjQzBDMEJGIiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik0yMS4yLDUwbDUuNCwxLjIiLz4KCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNDMEMwQkYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZD0iTTIxLjIsNTQuMWw1LjQtMS4yIi8+CgkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjQzBDMEJGIiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik0zOC44LDUwbC01LjQsMS4yIi8+CgkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjQzBDMEJGIiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik0zOC44LDU0LjFsLTUuNC0xLjIiLz4KCQk8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iI0MwQzBCRiIgZD0iTTI5LjUsNTIuNEwyOSw1MS43Yy0wLjItMC4zLDAtMC42LDAuMy0wLjZoMS40CgkJCWMwLjMsMCwwLjUsMC40LDAuMywwLjZsLTAuNywxbDAsMGMtMC43LDEuMi0yLjYsMS4xLTMuMS0wLjNsLTAuMS0wLjJjLTAuMS0wLjIsMC0wLjQsMC4yLTAuNXMwLjQsMCwwLjUsMC4ybDAuMSwwLjIKCQkJQzI4LjMsNTIuOCwyOS4xLDUyLjksMjkuNSw1Mi40eiIvPgoJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0MwQzBCRiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNMzIuNCw1Mi4xbC0wLjEsMC4yYy0wLjQsMS0xLjgsMS4xLTIuMywwLjIiLz4KCQk8ZWxsaXBzZSBmaWxsPSIjQzBDMEJGIiBjeD0iMjcuNiIgY3k9IjQ5LjciIHJ4PSIwLjciIHJ5PSIwLjciLz4KCQk8ZWxsaXBzZSBmaWxsPSIjQzBDMEJGIiBjeD0iMzIuNCIgY3k9IjQ5LjciIHJ4PSIwLjciIHJ5PSIwLjciLz4KCTwvZz4KCTxnPgoJCTxwYXRoIGZpbGw9IiM2QUE5REQiIHN0cm9rZT0iIzZBQTlERCIgc3Ryb2tlLXdpZHRoPSIwLjEiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTTE0LjYsNzEuMmMtMC4xLTAuMS0wLjItMC4yLTAuMy0wLjJINS43CgkJCWMtMC4xLDAtMC4yLDAuMS0wLjMsMC4yYy0wLjEsMC4xLTAuMSwwLjIsMCwwLjRjMC43LDIsMi41LDMuMyw0LjYsMy4zczMuOS0xLjMsNC42LTMuM0MxNC43LDcxLjUsMTQuNyw3MS4zLDE0LjYsNzEuMnogTTEwLDc0LjEKCQkJYy0xLjYsMC0zLTAuOS0zLjctMi4yaDcuM0MxMyw3My4yLDExLjYsNzQuMSwxMCw3NC4xeiIvPgoJCTxwYXRoIGZpbGw9IiM2QUE5REQiIHN0cm9rZT0iIzZBQTlERCIgc3Ryb2tlLXdpZHRoPSIwLjEiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTTEyLjgsNjkuNWMwLjYsMCwxLjEtMC41LDEuMS0xLjEKCQkJYzAtMC42LTAuNS0xLjItMS4xLTEuMmMtMC42LDAtMS4yLDAuNS0xLjIsMS4yQzExLjYsNjksMTIuMiw2OS41LDEyLjgsNjkuNXogTTEyLjgsNjhjMC4yLDAsMC40LDAuMiwwLjQsMC40CgkJCWMwLDAuMi0wLjIsMC40LTAuNCwwLjRjLTAuMiwwLTAuNC0wLjItMC40LTAuNEMxMi40LDY4LjEsMTIuNiw2OCwxMi44LDY4eiIvPgoJCTxwYXRoIGZpbGw9IiM2QUE5REQiIHN0cm9rZT0iIzZBQTlERCIgc3Ryb2tlLXdpZHRoPSIwLjEiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTTcuMiw2OS41YzAuNiwwLDEuMi0wLjUsMS4yLTEuMQoJCQljMC0wLjYtMC41LTEuMi0xLjItMS4yYy0wLjYsMC0xLjEsMC41LTEuMSwxLjJDNi4xLDY5LDYuNiw2OS41LDcuMiw2OS41eiBNNy4yLDY4YzAuMiwwLDAuNCwwLjIsMC40LDAuNGMwLDAuMi0wLjIsMC40LTAuNCwwLjQKCQkJYy0wLjIsMC0wLjQtMC4yLTAuNC0wLjRDNi44LDY4LjEsNyw2OCw3LjIsNjh6Ii8+CgkJPHBhdGggZmlsbD0iIzZBQTlERCIgc3Ryb2tlPSIjNkFBOUREIiBzdHJva2Utd2lkdGg9IjAuMSIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNMTAsNjNjLTMuOCwwLTcsMy4xLTcsN2MwLDMuOCwzLjEsNyw3LDcKCQkJczctMy4xLDctN0MxNyw2Ni4yLDEzLjgsNjMsMTAsNjN6IE0xMCw3Ni4yYy0zLjQsMC02LjItMi44LTYuMi02LjJjMC0zLjQsMi44LTYuMiw2LjItNi4yczYuMiwyLjgsNi4yLDYuMgoJCQlDMTYuMiw3My40LDEzLjQsNzYuMiwxMCw3Ni4yeiIvPgoJPC9nPgoJPGc+CgkJPGc+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzZBQTlERCIgZD0iTTY0LjEsNzMuNGwyLjMsMGMwLjIsMCwwLjQsMC4yLDAuNCwwLjR2Mi4xYzAsMC4yLTAuMiwwLjQtMC40LDAuNGgtMi4zCgkJCQljLTAuMiwwLTAuNC0wLjItMC40LTAuNHYtMi4xQzYzLjcsNzMuNiw2My44LDczLjQsNjQuMSw3My40eiIvPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiM2QUE5REQiIGQ9Ik03My41LDczLjVoMi40YzAuMiwwLDAuNCwwLjIsMC40LDAuNHYyLjFjMCwwLjItMC4yLDAuNC0wLjQsMC40aC0yLjQKCQkJCWMtMC4yLDAtMC40LTAuMi0wLjQtMC40bDAtMi4xQzczLjEsNzMuNiw3My4zLDczLjUsNzMuNSw3My41eiIvPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiM2QUE5REQiIGQ9Ik02My43LDY4LjRoMTIuNnY1SDYzLjdWNjguNHoiLz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNkFBOUREIiBkPSJNNjUuNSw2My42aDguOWMxLDAsMS45LDAuOCwxLjksMS45djMuMUg2My43di0zLjFDNjMuNyw2NC41LDY0LjUsNjMuNiw2NS41LDYzLjZ6Ii8+CgkJCTxlbGxpcHNlIGZpbGw9IiM2QUE5REQiIGN4PSI2Ni4yIiBjeT0iNzAuOSIgcng9IjAuOSIgcnk9IjAuOSIvPgoJCQk8ZWxsaXBzZSBmaWxsPSIjNkFBOUREIiBjeD0iNzMuOCIgY3k9IjcwLjkiIHJ4PSIwLjkiIHJ5PSIwLjkiLz4KCQk8L2c+Cgk8L2c+Cgk8Zz4KCQk8Zz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNkFBOUREIiBkPSJNOTYuNCw3MGMwLDMuNi0yLjksNi41LTYuNCw2LjVzLTYuNC0yLjktNi40LTYuNXMyLjktNi41LDYuNC02LjVTOTYuNCw2Ni40LDk2LjQsNzB6Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzZBQTlERCIgZD0iTTk2LjMsNjguNmMwLDAsMCwwLjEsMCwwLjFjLTAuOSwwLjEtMi45LDAuMS00LjYtMS4yYy0xLjEtMC44LTItMS43LTIuNi0yLjUKCQkJCWMtMC4zLTAuNC0wLjYtMC44LTAuNy0xLjFjLTAuMS0wLjEtMC4xLTAuMi0wLjEtMC4yYzAuNS0wLjEsMS4yLTAuMiwyLTAuMmMxLjIsMCwyLjUsMC4zLDMuNSwxLjFjMSwwLjgsMS43LDEuOCwyLjEsMi44CgkJCQlDOTYuMSw2Ny45LDk2LjIsNjguMyw5Ni4zLDY4LjZ6Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzZBQTlERCIgZD0iTTg0LDcyLjJjMCwwLDAtMC4xLDAtMC4xYzAuOS0wLjIsMi45LTAuNCw0LjcsMC42YzEuMSwwLjcsMS45LDEuNSwyLjQsMi4zCgkJCQljMC40LDAuNSwwLjYsMSwwLjcsMS4zYy0wLjQsMC4xLTEsMC4yLTEuNywwLjNjLTEsMC0yLjEtMC4xLTMuMi0wLjhzLTEuOS0xLjYtMi40LTIuNUM4NC4yLDcyLjgsODQuMSw3Mi40LDg0LDcyLjJ6Ii8+CgkJPC9nPgoJPC9nPgoJPGc+CgkJPGc+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzZBQTlERCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNMTE2LjMsNjYuOGwtMS40LDJsLTAuOC0wLjhsLTAuNi0wLjdsMCwwLjlsLTAuMSw4LjJoLTYuOAoJCQkJbC0wLjEtOC4ybDAtMC45bC0wLjYsMC43bC0wLjgsMC44bC0xLjQtMmwyLjYtMi45YzAuMS0wLjEsMC4yLTAuMSwwLjMtMC4xaDEuM2wwLjQsMC43YzAuNywxLjMsMi42LDEuMywzLjMtMC4xbDAuMy0wLjZoMS4yCgkJCQljMC4xLDAsMC4yLDAsMC4zLDAuMWwwLjMtMC4zbC0wLjMsMC4zTDExNi4zLDY2Ljh6Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzZBQTlERCIgZD0iTTExMC4xLDY3LjdoMnYwLjljMCwwLjQtMC40LDAuNy0xLDAuN2MtMC42LDAtMS0wLjMtMS0wLjdMMTEwLjEsNjcuN0wxMTAuMSw2Ny43eiIvPgoJCTwvZz4KCTwvZz4KCTxnPgoJCTxnPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiM2QUE5REQiIGQ9Ik0xMjYuOCw3NC4zYzAsMS4yLTEsMi4yLTIuMiwyLjJzLTIuMi0xLTIuMi0yLjJzMS0yLjIsMi4yLTIuMlMxMjYuOCw3My4xLDEyNi44LDc0LjN6Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzZBQTlERCIgZD0iTTEzNy42LDc0LjNjMCwxLjItMSwyLjItMi4yLDIuMmMtMS4yLDAtMi4yLTEtMi4yLTIuMnMxLTIuMiwyLjItMi4yCgkJCQlDMTM2LjYsNzIuMSwxMzcuNiw3My4xLDEzNy42LDc0LjN6Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzZBQTlERCIgZD0iTTEyNi44LDY0LjR2OS45Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzZBQTlERCIgZD0iTTEzNy43LDY0LjR2OS45Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzZBQTlERCIgZD0iTTEyNi44LDYzLjVoMTAuOHYyLjdoLTEwLjhDMTI2LjgsNjYuMiwxMjYuOCw2My41LDEyNi44LDYzLjV6Ii8+CgkJPC9nPgoJPC9nPgoJPGc+CgkJPGc+CgkJCTxwYXRoIGZpbGw9IiM2QUE5REQiIGQ9Ik0xNzAuOCw2My4xTDE3MC44LDYzLjFjLTAuMywwLTAuNSwwLTAuOCwwYy0yLjEsMC00LDEtNS4zLDIuNWwtMC4xLDBsLTAuMS0wLjFsLTEtMS4ybC0wLjMsMy40bDMuNCwwLjMKCQkJCWwtMS4xLTEuM2wtMC4xLTAuMWwwLjEtMC4xYzEuMS0xLjQsMy0yLjMsNS0yLjFsMCwwYzMuMiwwLjMsNS41LDMuMSw1LjIsNi4zYy0wLjMsMy0zLjEsNS4zLTYuMSw1LjFjLTMuMS0wLjItNS40LTIuOS01LjMtNgoJCQkJbC0xLjMtMC4xYy0wLjIsMy44LDIuNiw3LjEsNi4zLDcuNGMzLjksMC4zLDcuMy0yLjYsNy42LTYuNUMxNzcuMiw2Ni44LDE3NC40LDYzLjUsMTcwLjgsNjMuMXoiLz4KCQkJPHBhdGggZmlsbD0iIzZBQTlERCIgZD0iTTE3MC4zLDY3LjRjMC0wLjMtMC4zLTAuNi0wLjYtMC42cy0wLjYsMC4zLTAuNiwwLjZ2My4yYzAsMC4yLDAuMSwwLjMsMC4yLDAuNGMwLjEsMC4xLDAuMywwLjIsMC40LDAuMgoJCQkJaDIuNGMwLjQsMCwwLjYtMC4zLDAuNi0wLjZTMTcyLjQsNzAsMTcyLDcwaC0xLjZoLTAuMnYtMC4yTDE3MC4zLDY3LjRMMTcwLjMsNjcuNHoiLz4KCQk8L2c+Cgk8L2c+Cgk8Zz4KCQk8Zz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNkFBOUREIiBkPSJNMTg2LjIsNjMuNGg3LjdjMS41LDAsMi43LDEuMiwyLjcsMi43djcuN2MwLDEuNS0xLjIsMi43LTIuNywyLjdoLTcuNwoJCQkJYy0xLjUsMC0yLjctMS4yLTIuNy0yLjd2LTcuN0MxODMuNCw2NC43LDE4NC43LDYzLjQsMTg2LjIsNjMuNHoiLz4KCQkJPGVsbGlwc2UgZmlsbD0iIzZBQTlERCIgY3g9IjE4NiIgY3k9IjY4LjkiIHJ4PSIwLjciIHJ5PSIwLjciLz4KCQkJPGVsbGlwc2UgZmlsbD0iIzZBQTlERCIgY3g9IjE5NCIgY3k9IjY2LjciIHJ4PSIwLjciIHJ5PSIwLjciLz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNkFBOUREIiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik0xODYsNzMuM2wwLjQtMC4zYzAuNC0wLjMsMS0wLjMsMS41LTAuMWwxLDAuNAoJCQkJYzAuNSwwLjIsMSwwLjIsMS41LTAuMWwwLjgtMC41YzAuNC0wLjMsMS0wLjMsMS41LTAuMWwxLjgsMC44Ii8+CgkJPC9nPgoJPC9nPgoJPHBhdGggZmlsbD0iIzZBQTlERCIgc3Ryb2tlPSIjNkFBOUREIiBzdHJva2Utd2lkdGg9IjAuMjUiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTTE1Niw2NC4zYy0wLjItMC4xLTAuNC0wLjEtMC41LDAKCQljMCwwLTAuMiwwLjEtMC45LDAuMmMtMC43LDAtMi40LTAuMS0zLjgtMC42Yy0wLjgtMC4zLTEuNy0wLjUtMi41LTAuNWMtMC4yLDAtMC40LDAtMC41LDBjLTEuMywwLTIuNSwwLjMtMy42LDEKCQljLTAuMiwwLjEtMC4yLDAuMi0wLjIsMC40djExLjZjMCwwLjMsMC4xLDAuNSwwLjMsMC41YzAuNiwwLDAuNS0wLjQsMC41LTAuNnYtNS43YzAuNy0wLjMsMy4yLTEuMSw1LjgtMC4xCgkJYzEuNiwwLjYsMy41LDAuNyw0LjMsMC43YzAuOCwwLDEuMy0wLjMsMS4zLTAuM2MwLjItMC4xLDAuMy0wLjIsMC4zLTAuNHYtNS43QzE1Ni4yLDY0LjYsMTU2LjEsNjQuNCwxNTYsNjQuM3ogTTE1NS42LDcwLjIKCQljLTAuMSwwLTAuNywwLjEtMSwwLjFjLTAuNywwLTIuNC0wLjEtMy44LTAuNmMtMi41LTEtNS0wLjUtNi4yLTAuMXYtNC45YzAuOS0wLjUsMi4yLTAuNywzLjItMC43YzAuMSwwLDAuMywwLDAuNCwwCgkJYzAuNywwLDEuNSwwLjIsMi4yLDAuNGMxLjYsMC42LDMuNSwwLjcsNC4zLDAuN2MwLjIsMCwwLjgsMCwxLTAuMVY3MC4yeiIvPgoJPGc+CgkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNkFBOUREIiBkPSJNNDguMSw2My41aDMuN2MyLjUsMCw0LjUsMiw0LjUsNC41YzAsMC41LTAuNCwwLjktMC45LDAuOUg0NC41Yy0wLjUsMC0wLjktMC40LTAuOS0wLjkKCQkJQzQzLjYsNjUuNSw0NS42LDYzLjUsNDguMSw2My41eiIvPgoJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzZBQTlERCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNNDMuNSw2OC44Yy0wLjIsMC4xLTAuNSwxLjIsMCwxLjVjMS40LDAuOSw4LjUsMC44LDExLjMsMC42CgkJCWMwLjgtMC4xLDEuNi0wLjQsMS43LTEuMmMwLTAuMy0wLjEtMC42LTAuNi0wLjkiLz4KCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiM2QUE5REQiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZD0iTTQzLjUsNzAuNkw0My4zLDcxYy0wLjIsMC41LDAuMiwxLDAuNywwLjljMC4zLTAuMSwwLjUsMC4xLDAuNywwLjMKCQkJbDAuMSwwLjJjMC4zLDAuNSwxLDAuNiwxLjUsMC4ybDAsMGMwLjMtMC4yLDAuNy0wLjMsMS0wLjJsMC44LDAuM2MwLjQsMC4yLDAuOCwwLjEsMS4yLDBsMC41LTAuMmMwLjQtMC4yLDAuOS0wLjIsMS4zLDBsMC41LDAuMgoJCQljMC40LDAuMiwwLjgsMC4yLDEuMi0wLjFsMC4yLTAuMWMwLjMtMC4yLDAuOC0wLjIsMS4xLDAuMWwwLjIsMC4yYzAuMywwLjMsMC44LDAuMiwxLTAuMmwwLjEtMC4yYzAuMS0wLjIsMC0wLjMsMC4yLTAuMwoJCQljMC41LDAsMS4yLTAuMywxLjEtMC43bC0wLjQtMS4xIi8+CgkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNkFBOUREIiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik00My41LDcyLjJjLTAuMSwwLjItMC4zLDAuOCwwLDEuMWMwLjMsMC40LDMsMS4xLDYuNCwxLjEKCQkJYzIuMiwwLDQuNi0wLjMsNi0wLjZjMC41LTAuMSwwLjktMC40LDAuOC0wLjljMC0wLjItMC4yLTAuNS0wLjQtMC43Ii8+CgkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNkFBOUREIiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik00My41LDczLjNjMCwwLjUsMC42LDIuMywxLjMsMi43YzEuOCwwLjgsNS43LDAuNyw4LjEsMC41CgkJCWMxLjMtMC4xLDIuNS0wLjcsMy4yLTEuOGMwLjMtMC41LDAuNS0xLDAuNS0xLjQiLz4KCQk8ZWxsaXBzZSBmaWxsPSIjNkFBOUREIiBjeD0iNTEuNiIgY3k9IjY2LjUiIHJ4PSIwLjMiIHJ5PSIwLjQiLz4KCQk8ZWxsaXBzZSBmaWxsPSIjNkFBOUREIiBjeD0iNTMiIGN5PSI2NSIgcng9IjAuMyIgcnk9IjAuNCIvPgoJCTxlbGxpcHNlIGZpbGw9IiM2QUE5REQiIGN4PSI1MyIgY3k9IjY3LjIiIHJ4PSIwLjMiIHJ5PSIwLjQiLz4KCQk8ZWxsaXBzZSBmaWxsPSIjNkFBOUREIiBjeD0iNTQuMyIgY3k9IjY2LjUiIHJ4PSIwLjMiIHJ5PSIwLjQiLz4KCQk8ZWxsaXBzZSBmaWxsPSIjNkFBOUREIiBjeD0iNTAuOSIgY3k9IjY1IiByeD0iMC4zIiByeT0iMC40Ii8+Cgk8L2c+Cgk8Zz4KCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiM2QUE5REQiIGQ9Ik0yNC4yLDcxdi03LjZjMC4xLDAuMSwwLjgsMC45LDIuOCwzLjFjMi41LTEuNyw1LjYtMC43LDYuOSwwbDIuNC0zLjF2Ny4xCgkJCWMwLDEuMi0wLjEsMi41LTAuOSwzLjRjLTEsMS4yLTIuNywyLjUtNS4zLDIuNWMtMi45LDAtNC41LTEuNS01LjMtMi45QzI0LjIsNzIuOSwyNC4yLDcyLDI0LjIsNzF6Ii8+CgkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNkFBOUREIiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik0yMS4yLDcwLjFsNS40LDEuMiIvPgoJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzZBQTlERCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNMjEuMiw3NC4xbDUuNC0xLjIiLz4KCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiM2QUE5REQiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZD0iTTM4LjgsNzAuMWwtNS40LDEuMiIvPgoJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzZBQTlERCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNMzguOCw3NC4xbC01LjQtMS4yIi8+CgkJPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGZpbGw9IiM2QUE5REQiIGQ9Ik0yOS41LDcyLjRMMjksNzEuN2MtMC4yLTAuMywwLTAuNiwwLjMtMC42aDEuNAoJCQljMC4zLDAsMC41LDAuNCwwLjMsMC42bC0wLjcsMWwwLDBjLTAuNywxLjItMi42LDEuMS0zLjEtMC4zbC0wLjEtMC4yYy0wLjEtMC4yLDAtMC40LDAuMi0wLjVjMC4yLTAuMSwwLjQsMCwwLjUsMC4ybDAuMSwwLjIKCQkJQzI4LjMsNzIuOCwyOS4xLDcyLjksMjkuNSw3Mi40eiIvPgoJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzZBQTlERCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNMzIuNCw3Mi4xbC0wLjEsMC4yYy0wLjQsMS0xLjgsMS4xLTIuMywwLjIiLz4KCQk8ZWxsaXBzZSBmaWxsPSIjNkFBOUREIiBjeD0iMjcuNiIgY3k9IjY5LjciIHJ4PSIwLjciIHJ5PSIwLjciLz4KCQk8ZWxsaXBzZSBmaWxsPSIjNkFBOUREIiBjeD0iMzIuNCIgY3k9IjY5LjciIHJ4PSIwLjciIHJ5PSIwLjciLz4KCTwvZz4KPC9nPgo8Zz4KCTxwYXRoIGZpbGw9IiM4Njg2ODYiIHN0cm9rZT0iIzg2ODY4NiIgc3Ryb2tlLXdpZHRoPSIwLjEiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTTEyLjgsOS41YzAuNiwwLDEuMS0wLjUsMS4xLTEuMgoJCWMwLTAuNi0wLjUtMS4xLTEuMS0xLjFjLTAuNiwwLTEuMiwwLjUtMS4yLDEuMVMxMi4yLDkuNSwxMi44LDkuNXogTTEyLjgsNy45YzAuMiwwLDAuNCwwLjIsMC40LDAuNGMwLDAuMi0wLjIsMC40LTAuNCwwLjQKCQljLTAuMiwwLTAuNC0wLjItMC40LTAuNEMxMi40LDguMSwxMi42LDcuOSwxMi44LDcuOXoiLz4KCTxwYXRoIGZpbGw9IiM4Njg2ODYiIHN0cm9rZT0iIzg2ODY4NiIgc3Ryb2tlLXdpZHRoPSIwLjEiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTTcuMiw5LjVjMC42LDAsMS4yLTAuNSwxLjItMS4yCgkJYzAtMC42LTAuNS0xLjEtMS4yLTEuMWMtMC42LDAtMS4xLDAuNS0xLjEsMS4xUzYuNiw5LjUsNy4yLDkuNXogTTcuMiw3LjljMC4yLDAsMC40LDAuMiwwLjQsMC40YzAsMC4yLTAuMiwwLjQtMC40LDAuNAoJCUM3LDguNyw2LjgsOC41LDYuOCw4LjNDNi44LDguMSw3LDcuOSw3LjIsNy45eiIvPgoJPHBhdGggZmlsbD0iIzg2ODY4NiIgc3Ryb2tlPSIjODY4Njg2IiBzdHJva2Utd2lkdGg9IjAuMSIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNMTQuNiwxMS4yYy0wLjEtMC4xLTAuMi0wLjItMC4zLTAuMkg1LjcKCQljLTAuMSwwLTAuMiwwLjEtMC4zLDAuMmMtMC4xLDAuMS0wLjEsMC4yLDAsMC40YzAuNywyLDIuNSwzLjMsNC42LDMuM3MzLjktMS4zLDQuNi0zLjNDMTQuNywxMS40LDE0LjcsMTEuMywxNC42LDExLjJ6IE0xMCwxNC4xCgkJYy0xLjYsMC0zLTAuOS0zLjctMi4yaDcuM0MxMywxMy4yLDExLjYsMTQuMSwxMCwxNC4xeiIvPgoJPHBhdGggZmlsbD0iIzg2ODY4NiIgc3Ryb2tlPSIjODY4Njg2IiBzdHJva2Utd2lkdGg9IjAuMSIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNMTAsM2MtMy44LDAtNywzLjEtNyw3czMuMSw3LDcsN3M3LTMuMSw3LTcKCQlTMTMuOCwzLDEwLDN6IE0xMCwxNi4yYy0zLjQsMC02LjItMi44LTYuMi02LjJTNi42LDMuOCwxMCwzLjhzNi4yLDIuOCw2LjIsNi4yUzEzLjQsMTYuMiwxMCwxNi4yeiIvPgo8L2c+CjxnIGlkPSJDYXJfMDAwMDAwMTg5MzUzOTUwODU0MTM0MTM3NTAwMDAwMDA4MjUyNzM4Nzc4NDI3NzU3MTVfIj4KCTxnPgoJCTxnPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiM4Njg2ODYiIGQ9Ik02NC4xLDEzLjRsMi4zLDBjMC4yLDAsMC40LDAuMiwwLjQsMC40djIuMWMwLDAuMi0wLjIsMC40LTAuNCwwLjRoLTIuMwoJCQkJYy0wLjIsMC0wLjQtMC4yLTAuNC0wLjR2LTIuMUM2My43LDEzLjYsNjMuOCwxMy40LDY0LjEsMTMuNHoiLz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjODY4Njg2IiBkPSJNNzMuNSwxMy40aDIuNGMwLjIsMCwwLjQsMC4yLDAuNCwwLjR2Mi4xYzAsMC4yLTAuMiwwLjQtMC40LDAuNGgtMi40CgkJCQljLTAuMiwwLTAuNC0wLjItMC40LTAuNGwwLTIuMUM3My4xLDEzLjYsNzMuMywxMy40LDczLjUsMTMuNHoiLz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjODY4Njg2IiBkPSJNNjMuNyw4LjRoMTIuNnY1SDYzLjdWOC40eiIvPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiM4Njg2ODYiIGQ9Ik02NS41LDMuNmg4LjljMSwwLDEuOSwwLjgsMS45LDEuOXYzLjFINjMuN1Y1LjVDNjMuNyw0LjQsNjQuNSwzLjYsNjUuNSwzLjZ6Ii8+CgkJCTxlbGxpcHNlIGZpbGw9IiM4Njg2ODYiIGN4PSI2Ni4yIiBjeT0iMTAuOSIgcng9IjAuOSIgcnk9IjAuOSIvPgoJCQk8ZWxsaXBzZSBmaWxsPSIjODY4Njg2IiBjeD0iNzMuOCIgY3k9IjEwLjkiIHJ4PSIwLjkiIHJ5PSIwLjkiLz4KCQk8L2c+Cgk8L2c+CjwvZz4KPGcgaWQ9IkFjdGl2aXRpZXMiPgoJPGc+CgkJPGc+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzg2ODY4NiIgZD0iTTk2LjQsMTBjMCwzLjYtMi45LDYuNS02LjQsNi41cy02LjQtMi45LTYuNC02LjVzMi45LTYuNSw2LjQtNi41Uzk2LjQsNi40LDk2LjQsMTB6Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzg2ODY4NiIgZD0iTTk2LjMsOC42YzAsMCwwLDAuMSwwLDAuMWMtMC45LDAuMS0yLjksMC4xLTQuNi0xLjJjLTEuMS0wLjgtMi0xLjctMi42LTIuNQoJCQkJYy0wLjMtMC40LTAuNi0wLjgtMC43LTEuMWMtMC4xLTAuMS0wLjEtMC4yLTAuMS0wLjJjMC41LTAuMSwxLjItMC4yLDItMC4yYzEuMiwwLDIuNSwwLjMsMy41LDEuMWMxLDAuOCwxLjcsMS44LDIuMSwyLjgKCQkJCUM5Ni4xLDcuOSw5Ni4yLDguMyw5Ni4zLDguNnoiLz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjODY4Njg2IiBkPSJNODQsMTIuMWMwLDAsMC0wLjEsMC0wLjFjMC45LTAuMiwyLjktMC40LDQuNywwLjZjMS4xLDAuNiwxLjksMS41LDIuNCwyLjMKCQkJCWMwLjQsMC41LDAuNiwxLDAuNywxLjNjLTAuNCwwLjEtMSwwLjItMS43LDAuM2MtMSwwLTIuMS0wLjEtMy4yLTAuOGMtMS4xLTAuNi0xLjktMS42LTIuNC0yLjVDODQuMiwxMi44LDg0LjEsMTIuNCw4NCwxMi4xeiIvPgoJCTwvZz4KCTwvZz4KPC9nPgo8ZyBpZD0iT2JqZWN0c18wMDAwMDA2NDMxMjM3MTczOTEzMDMxNTI1MDAwMDAxMDIyNTg4OTAzMjIyODYzMjk3NV8iPgoJPGc+CgkJPGc+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzg2ODY4NiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNMTE2LjMsNi44bC0xLjQsMkwxMTQuMSw4bC0wLjYtMC43bDAsMC45bC0wLjEsOC4yaC02LjhsLTAuMS04LjIKCQkJCWwwLTAuOUwxMDUuOSw4bC0wLjgsMC44bC0xLjQtMmwyLjYtMi45YzAuMS0wLjEsMC4yLTAuMSwwLjMtMC4xaDEuM2wwLjQsMC43YzAuNywxLjMsMi42LDEuMywzLjMtMC4xbDAuMy0wLjZoMS4yCgkJCQljMC4xLDAsMC4yLDAsMC4zLDAuMWwwLjMtMC4zbC0wLjMsMC4zTDExNi4zLDYuOHoiLz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjODY4Njg2IiBkPSJNMTEwLjEsNy43aDJ2MC45YzAsMC40LTAuNCwwLjctMSwwLjdjLTAuNiwwLTEtMC4zLTEtMC43TDExMC4xLDcuN0wxMTAuMSw3Ljd6Ii8+CgkJPC9nPgoJPC9nPgo8L2c+CjxnIGlkPSJTeW1ib2xzXzAwMDAwMDk2NzQ2OTA3ODY5OTI5OTIxMTgwMDAwMDA2NDg0ODEyODMwMjgyNTgyNDE2XyI+Cgk8Zz4KCQk8Zz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjODY4Njg2IiBkPSJNMTI2LjgsMTQuM2MwLDEuMi0xLDIuMi0yLjIsMi4ycy0yLjItMS0yLjItMi4yczEtMi4yLDIuMi0yLjJTMTI2LjgsMTMuMSwxMjYuOCwxNC4zeiIvPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiM4Njg2ODYiIGQ9Ik0xMzcuNiwxNC4zYzAsMS4yLTEsMi4yLTIuMiwyLjJjLTEuMiwwLTIuMi0xLTIuMi0yLjJzMS0yLjIsMi4yLTIuMgoJCQkJQzEzNi42LDEyLjEsMTM3LjYsMTMuMSwxMzcuNiwxNC4zeiIvPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiM4Njg2ODYiIGQ9Ik0xMjYuOCw0LjR2OS45Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzg2ODY4NiIgZD0iTTEzNy43LDQuNHY5LjkiLz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjODY4Njg2IiBkPSJNMTI2LjgsMy41aDEwLjh2Mi43aC0xMC44QzEyNi44LDYuMiwxMjYuOCwzLjUsMTI2LjgsMy41eiIvPgoJCTwvZz4KCTwvZz4KPC9nPgo8ZyBpZD0iUmVjZW50cyI+Cgk8Zz4KCQk8Zz4KCQkJPHBhdGggZmlsbD0iIzg2ODY4NiIgZD0iTTE3MC44LDMuMUwxNzAuOCwzLjFjLTAuMywwLTAuNSwwLTAuOCwwYy0yLjEsMC00LDEtNS4zLDIuNWwtMC4xLDBsLTAuMS0wLjFsLTEtMS4ybC0wLjMsMy40bDMuNCwwLjMKCQkJCWwtMS4xLTEuM2wtMC4xLTAuMWwwLjEtMC4xYzEuMS0xLjQsMy0yLjMsNS0yLjFsMCwwYzMuMiwwLjMsNS41LDMuMSw1LjIsNi4zYy0wLjMsMy0zLjEsNS4zLTYuMSw1LjFjLTMuMS0wLjItNS40LTIuOS01LjMtNgoJCQkJTDE2Myw5LjVjLTAuMiwzLjgsMi42LDcuMSw2LjMsNy40YzMuOSwwLjQsNy4zLTIuNiw3LjYtNi41QzE3Ny4yLDYuOCwxNzQuNCwzLjUsMTcwLjgsMy4xeiIvPgoJCQk8cGF0aCBmaWxsPSIjODY4Njg2IiBkPSJNMTcwLjMsNy40YzAtMC4zLTAuMy0wLjYtMC42LTAuNlMxNjksNy4xLDE2OSw3LjR2My4yYzAsMC4yLDAuMSwwLjMsMC4yLDAuNGMwLjEsMC4xLDAuMywwLjIsMC40LDAuMgoJCQkJaDIuNGMwLjQsMCwwLjYtMC4zLDAuNi0wLjZzLTAuMy0wLjYtMC42LTAuNmgtMS42aC0wLjJWOS44TDE3MC4zLDcuNEwxNzAuMyw3LjR6Ii8+CgkJPC9nPgoJPC9nPgo8L2c+CjxnIGlkPSJDdXN0b21fMDAwMDAxODEwODcyMjk0MzQzMDIzMzY3ODAwMDAwMDUxNTIyNzc5NDU5NDA2NzQ0ODhfIj4KCTxnPgoJCTxnPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiM4Njg2ODYiIGQ9Ik0xODYuMiwzLjRoNy43YzEuNSwwLDIuNywxLjIsMi43LDIuN3Y3LjdjMCwxLjUtMS4yLDIuNy0yLjcsMi43aC03LjcKCQkJCWMtMS41LDAtMi43LTEuMi0yLjctMi43VjYuMUMxODMuNCw0LjYsMTg0LjcsMy40LDE4Ni4yLDMuNHoiLz4KCQkJPGVsbGlwc2UgZmlsbD0iIzg2ODY4NiIgY3g9IjE4NiIgY3k9IjguOSIgcng9IjAuNyIgcnk9IjAuNyIvPgoJCQk8ZWxsaXBzZSBmaWxsPSIjODY4Njg2IiBjeD0iMTk0IiBjeT0iNi43IiByeD0iMC43IiByeT0iMC43Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzg2ODY4NiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNMTg2LDEzLjNsMC40LTAuM2MwLjQtMC4zLDEtMC4zLDEuNS0wLjFsMSwwLjQKCQkJCWMwLjUsMC4yLDEsMC4yLDEuNS0wLjFsMC44LTAuNWMwLjQtMC4zLDEtMC4zLDEuNS0wLjFsMS44LDAuOCIvPgoJCTwvZz4KCTwvZz4KPC9nPgo8cGF0aCBmaWxsPSIjODY4Njg2IiBzdHJva2U9IiM4Njg2ODYiIHN0cm9rZS13aWR0aD0iMC4yNSIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNMTU2LDQuM2MtMC4yLTAuMS0wLjQtMC4xLTAuNSwwCgljMCwwLTAuMiwwLjEtMC45LDAuMWMtMC43LDAtMi40LTAuMS0zLjgtMC42Yy0wLjgtMC4zLTEuNy0wLjUtMi41LTAuNWMtMC4yLDAtMC40LDAtMC41LDBjLTEuMywwLTIuNSwwLjMtMy42LDEKCWMtMC4yLDAuMS0wLjIsMC4yLTAuMiwwLjR2MTEuNmMwLDAuMywwLjEsMC41LDAuMywwLjVjMC42LDAsMC41LTAuNCwwLjUtMC42di01LjdjMC43LTAuMywzLjItMS4xLDUuOC0wLjFjMS42LDAuNiwzLjUsMC43LDQuMywwLjcKCWMwLjgsMCwxLjMtMC4zLDEuMy0wLjNjMC4yLTAuMSwwLjMtMC4yLDAuMy0wLjRWNC43QzE1Ni4yLDQuNSwxNTYuMSw0LjQsMTU2LDQuM3ogTTE1NS42LDEwLjJjLTAuMSwwLTAuNywwLjEtMSwwLjEKCWMtMC43LDAtMi40LTAuMS0zLjgtMC42Yy0yLjUtMS01LTAuNS02LjItMC4xVjQuN2MwLjktMC41LDIuMi0wLjcsMy4yLTAuN2MwLjEsMCwwLjMsMCwwLjQsMGMwLjcsMCwxLjUsMC4yLDIuMiwwLjQKCWMxLjYsMC42LDMuNSwwLjcsNC4zLDAuN2MwLjIsMCwwLjgsMCwxLTAuMVYxMC4yeiIvPgo8ZyBpZD0iRm9vZCI+Cgk8ZyBpZD0iTGF5ZXJfMTIiPgoJCTxnPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiM4Njg2ODYiIGQ9Ik00OC4xLDMuNWgzLjdjMi41LDAsNC41LDIsNC41LDQuNWMwLDAuNS0wLjQsMC45LTAuOSwwLjlINDQuNWMtMC41LDAtMC45LTAuNC0wLjktMC45CgkJCQlDNDMuNiw1LjUsNDUuNiwzLjUsNDguMSwzLjV6Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzg2ODY4NiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNNDMuNSw4LjdjLTAuMiwwLjEtMC41LDEuMiwwLDEuNWMxLjQsMC45LDguNSwwLjgsMTEuMywwLjYKCQkJCWMwLjgtMC4xLDEuNi0wLjQsMS43LTEuMmMwLTAuMy0wLjEtMC42LTAuNi0wLjkiLz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjODY4Njg2IiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik00My41LDEwLjZMNDMuMywxMWMtMC4yLDAuNSwwLjIsMSwwLjcsMC45CgkJCQljMC4zLTAuMSwwLjUsMC4xLDAuNywwLjNsMC4xLDAuMmMwLjMsMC41LDEsMC42LDEuNSwwLjJsMCwwYzAuMy0wLjIsMC43LTAuMywxLTAuMmwwLjgsMC4zYzAuNCwwLjEsMC44LDAuMSwxLjIsMGwwLjUtMC4yCgkJCQljMC40LTAuMiwwLjktMC4yLDEuMywwbDAuNSwwLjJjMC40LDAuMiwwLjgsMC4xLDEuMi0wLjFsMC4yLTAuMWMwLjMtMC4yLDAuOC0wLjEsMS4xLDAuMWwwLjIsMC4yYzAuMywwLjMsMC44LDAuMiwxLTAuMmwwLjEtMC4yCgkJCQljMC4xLTAuMiwwLTAuMywwLjItMC40YzAuNSwwLDEuMi0wLjMsMS4xLTAuN2wtMC40LTEuMSIvPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiM4Njg2ODYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZD0iTTQzLjUsMTIuMWMtMC4xLDAuMi0wLjMsMC44LDAsMS4xYzAuMywwLjQsMywxLjEsNi40LDEuMQoJCQkJYzIuMiwwLDQuNi0wLjMsNi0wLjZjMC41LTAuMSwwLjktMC40LDAuOC0wLjljMC0wLjItMC4yLTAuNS0wLjQtMC43Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzg2ODY4NiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNNDMuNSwxMy4zYzAsMC41LDAuNiwyLjQsMS4zLDIuNmMxLjgsMC44LDUuNywwLjcsOC4xLDAuNQoJCQkJYzEuMy0wLjEsMi41LTAuNywzLjItMS44YzAuMy0wLjUsMC41LTEsMC41LTEuNCIvPgoJCQk8ZWxsaXBzZSBmaWxsPSIjODY4Njg2IiBjeD0iNTEuNiIgY3k9IjYuNSIgcng9IjAuMyIgcnk9IjAuNCIvPgoJCQk8ZWxsaXBzZSBmaWxsPSIjODY4Njg2IiBjeD0iNTMiIGN5PSI0LjkiIHJ4PSIwLjMiIHJ5PSIwLjQiLz4KCQkJPGVsbGlwc2UgZmlsbD0iIzg2ODY4NiIgY3g9IjUzIiBjeT0iNy4yIiByeD0iMC4zIiByeT0iMC40Ii8+CgkJCTxlbGxpcHNlIGZpbGw9IiM4Njg2ODYiIGN4PSI1NC4zIiBjeT0iNi41IiByeD0iMC4zIiByeT0iMC40Ii8+CgkJCTxlbGxpcHNlIGZpbGw9IiM4Njg2ODYiIGN4PSI1MC45IiBjeT0iNC45IiByeD0iMC4zIiByeT0iMC40Ii8+CgkJPC9nPgoJPC9nPgo8L2c+CjxnIGlkPSJBbmltYWxzIj4KCTxnPgoJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzg2ODY4NiIgZD0iTTI0LjIsMTFWMy41YzAuMSwwLjEsMC44LDAuOSwyLjgsMy4xYzIuNS0xLjcsNS42LTAuNyw2LjksMGwyLjQtMy4xdjcuMQoJCQljMCwxLjItMC4xLDIuNS0wLjksMy40Yy0xLDEuMi0yLjcsMi41LTUuMywyLjVjLTIuOSwwLTQuNS0xLjUtNS4zLTIuOUMyNC4yLDEyLjksMjQuMiwxMS45LDI0LjIsMTF6Ii8+CgkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjODY4Njg2IiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik0yMS4yLDEwbDUuNCwxLjIiLz4KCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiM4Njg2ODYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZD0iTTIxLjIsMTQuMWw1LjQtMS4yIi8+CgkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjODY4Njg2IiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik0zOC44LDEwbC01LjQsMS4yIi8+CgkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjODY4Njg2IiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik0zOC44LDE0LjFsLTUuNC0xLjIiLz4KCQk8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iIzg2ODY4NiIgZD0iTTI5LjUsMTIuNEwyOSwxMS43Yy0wLjItMC4zLDAtMC42LDAuMy0wLjZoMS40CgkJCWMwLjMsMCwwLjUsMC40LDAuMywwLjZsLTAuNywxbDAsMGMtMC43LDEuMi0yLjYsMS4xLTMuMS0wLjNsLTAuMS0wLjJjLTAuMS0wLjIsMC0wLjQsMC4yLTAuNXMwLjQsMCwwLjUsMC4ybDAuMSwwLjIKCQkJQzI4LjMsMTIuNywyOS4xLDEyLjksMjkuNSwxMi40eiIvPgoJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzg2ODY4NiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNMzIuNCwxMi4xbC0wLjEsMC4yYy0wLjQsMS0xLjgsMS4xLTIuMywwLjIiLz4KCQk8ZWxsaXBzZSBmaWxsPSIjODY4Njg2IiBjeD0iMjcuNiIgY3k9IjkuNyIgcng9IjAuNyIgcnk9IjAuNyIvPgoJCTxlbGxpcHNlIGZpbGw9IiM4Njg2ODYiIGN4PSIzMi40IiBjeT0iOS43IiByeD0iMC43IiByeT0iMC43Ii8+Cgk8L2c+CjwvZz4KPC9zdmc+)",":focus:before":{content:"",position:"absolute",top:"-2px",left:"-2px",right:"-2px",bottom:"-2px",border:"2px solid var(--epr-category-icon-active-color)",borderRadius:"50%"},"&.epr-icn-suggested":{backgroundPositionX:"calc(var(--epr-category-navigation-button-size) * -8)"},"&.epr-icn-custom":{backgroundPositionX:"calc(var(--epr-category-navigation-button-size) * -9)"},"&.epr-icn-activities":{backgroundPositionX:"calc(var(--epr-category-navigation-button-size) * -4)"},"&.epr-icn-animals_nature":{backgroundPositionX:"calc(var(--epr-category-navigation-button-size) * -1)"},"&.epr-icn-flags":{backgroundPositionX:"calc(var(--epr-category-navigation-button-size) * -7)"},"&.epr-icn-food_drink":{backgroundPositionX:"calc(var(--epr-category-navigation-button-size) * -2)"},"&.epr-icn-objects":{backgroundPositionX:"calc(var(--epr-category-navigation-button-size) * -5)"},"&.epr-icn-smileys_people":{backgroundPositionX:"0px"},"&.epr-icn-symbols":{backgroundPositionX:"calc(var(--epr-category-navigation-button-size) * -6)"},"&.epr-icn-travel_places":{backgroundPositionX:"calc(var(--epr-category-navigation-button-size) * -3)"}}},Sc("catBtn",wd),{".epr-dark-theme":fc({},Sd),".epr-auto-theme":fc({},Sd)}));function Md(){var e=(0,o.useState)(null),t=e[0],n=e[1],r=function(){var e=nl(),t=$u();return function(n){var r;if(e.current){var a=null==(r=e.current)?void 0:r.querySelector('[data-name="'+n+'"]');if(a){var i=a.offsetTop||0;ol(t.current,i)}}}}();!function(e){var t=nl();(0,o.useEffect)((function(){var n=new Map,r=t.current,a=new IntersectionObserver((function(t){if(r){for(var a,i=gc(t);!(a=i()).done;){var o=a.value,s=vd(o.target);n.set(s,o.intersectionRatio)}var c=Array.from(n),u=c[c.length-1];if(1==u[1])return e(u[0]);for(var l=0,f=c;l<f.length;l++){var d=f[l],h=d[0];if(d[1]){e(h);break}}}}),{threshold:[0,1]});null==r||r.querySelectorAll(mc(nc.category)).forEach((function(e){a.observe(e)}))}),[t,e])}(n);var a=Gu(),i=Cu(),s=il(),c=bd();return(0,o.createElement)("div",{className:oc(_d.nav),role:"tablist","aria-label":"Category navigation",id:"epr-category-nav-id",ref:s},i.map((function(e){var i=Pc(e),s=i===t;if(function(e){return e.category===Ic.CUSTOM}(e)&&c)return null;var u=!a&&!s;return(0,o.createElement)(yd,{key:i,category:i,isActiveCategory:s,allowNavigation:u,categoryConfig:e,onClick:function(){n(i),r(i)}})})))}var _d=vc.create({nav:{".":"epr-category-nav",display:"flex",flexDirection:"row",justifyContent:"space-around",padding:"var(--epr-header-padding)"},".epr-search-active":{nav:{opacity:"0.3",cursor:"default",pointerEvents:"none"}},".epr-main:has(input:not(:placeholder-shown))":{nav:{opacity:"0.3",cursor:"default",pointerEvents:"none"}}}),Ed="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDI2LjMuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHdpZHRoPSIyMHB4IiBoZWlnaHQ9IjgwcHgiIHZpZXdCb3g9IjAgMCAyMCA4MCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMjAgODAiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8cGF0aCBmaWxsPSIjODY4Njg2IiBkPSJNNi45OCwxMy41OWMwLjEsMC4xLDAuMjQsMC4xNSwwLjM3LDAuMTVzMC4yNy0wLjA1LDAuMzctMC4xNWwyLjQyLTIuNDJsMi40MywyLjQzCgljMC4xLDAuMSwwLjI0LDAuMTUsMC4zNywwLjE1YzAuMTQsMCwwLjI3LTAuMDUsMC4zNy0wLjE1YzAuMjEtMC4yMSwwLjIxLTAuNTQsMC0wLjc1bC0yLjQzLTIuNDNMMTMuMzIsOAoJYzAuMjEtMC4yMSwwLjIxLTAuNTQsMC0wLjc1Yy0wLjIxLTAuMjEtMC41NC0wLjIxLTAuNzUsMGwtMi40MiwyLjQyTDcuNzQsNy4yN2MtMC4yMS0wLjIxLTAuNTQtMC4yMS0wLjc1LDAKCWMtMC4yMSwwLjIxLTAuMjEsMC41NCwwLDAuNzVsMi40MSwyLjQxbC0yLjQyLDIuNDJDNi43NywxMy4wNSw2Ljc3LDEzLjM5LDYuOTgsMTMuNTlMNi45OCwxMy41OXoiLz4KPHBhdGggZmlsbD0iIzg2ODY4NiIgZD0iTTEwLjE1LDE4LjQzYzQuNDEsMCw4LTMuNTksOC04YzAtNC40MS0zLjU5LTgtOC04Yy00LjQxLDAtOCwzLjU5LTgsOEMyLjE1LDE0Ljg0LDUuNzQsMTguNDMsMTAuMTUsMTguNDN6CgkgTTEwLjE1LDMuNDljMy44MywwLDYuOTQsMy4xMSw2Ljk0LDYuOTRjMCwzLjgzLTMuMTEsNi45NC02Ljk0LDYuOTRjLTMuODMsMC02Ljk0LTMuMTEtNi45NC02Ljk0QzMuMjEsNi42LDYuMzMsMy40OSwxMC4xNSwzLjQ5CglMMTAuMTUsMy40OXoiLz4KPHBhdGggZmlsbD0iIzMzNzFCNyIgZD0iTTYuOTgsMzMuNTljMC4xLDAuMSwwLjI0LDAuMTUsMC4zNywwLjE1czAuMjctMC4wNSwwLjM3LTAuMTVsMi40Mi0yLjQybDIuNDMsMi40MwoJYzAuMSwwLjEsMC4yNCwwLjE1LDAuMzcsMC4xNWMwLjE0LDAsMC4yNy0wLjA1LDAuMzctMC4xNWMwLjIxLTAuMjEsMC4yMS0wLjU0LDAtMC43NWwtMi40My0yLjQzTDEzLjMyLDI4CgljMC4yMS0wLjIxLDAuMjEtMC41NCwwLTAuNzVjLTAuMjEtMC4yMS0wLjU0LTAuMjEtMC43NSwwbC0yLjQyLDIuNDJsLTIuNDEtMi40MWMtMC4yMS0wLjIxLTAuNTQtMC4yMS0wLjc1LDAKCWMtMC4yMSwwLjIxLTAuMjEsMC41NCwwLDAuNzVsMi40MSwyLjQxbC0yLjQyLDIuNDJDNi43NywzMy4wNSw2Ljc3LDMzLjM5LDYuOTgsMzMuNTlMNi45OCwzMy41OXoiLz4KPHBhdGggZmlsbD0iIzMzNzFCNyIgZD0iTTEwLjE1LDM4LjQzYzQuNDEsMCw4LTMuNTksOC04YzAtNC40MS0zLjU5LTgtOC04Yy00LjQxLDAtOCwzLjU5LTgsOEMyLjE1LDM0Ljg0LDUuNzQsMzguNDMsMTAuMTUsMzguNDN6CgkgTTEwLjE1LDIzLjQ5YzMuODMsMCw2Ljk0LDMuMTEsNi45NCw2Ljk0YzAsMy44My0zLjExLDYuOTQtNi45NCw2Ljk0Yy0zLjgzLDAtNi45NC0zLjExLTYuOTQtNi45NAoJQzMuMjEsMjYuNiw2LjMzLDIzLjQ5LDEwLjE1LDIzLjQ5TDEwLjE1LDIzLjQ5eiIvPgo8cGF0aCBmaWxsPSIjQzBDMEJGIiBkPSJNNi45OCw1My41OWMwLjEsMC4xLDAuMjQsMC4xNSwwLjM3LDAuMTVzMC4yNy0wLjA1LDAuMzctMC4xNWwyLjQyLTIuNDJsMi40MywyLjQzCgljMC4xLDAuMSwwLjI0LDAuMTUsMC4zNywwLjE1YzAuMTQsMCwwLjI3LTAuMDUsMC4zNy0wLjE1YzAuMjEtMC4yMSwwLjIxLTAuNTQsMC0wLjc1bC0yLjQzLTIuNDNMMTMuMzIsNDgKCWMwLjIxLTAuMjEsMC4yMS0wLjU0LDAtMC43NWMtMC4yMS0wLjIxLTAuNTQtMC4yMS0wLjc1LDBsLTIuNDIsMi40MmwtMi40MS0yLjQxYy0wLjIxLTAuMjEtMC41NC0wLjIxLTAuNzUsMAoJYy0wLjIxLDAuMjEtMC4yMSwwLjU0LDAsMC43NWwyLjQxLDIuNDFsLTIuNDIsMi40MkM2Ljc3LDUzLjA1LDYuNzcsNTMuMzksNi45OCw1My41OUw2Ljk4LDUzLjU5eiIvPgo8cGF0aCBmaWxsPSIjQzBDMEJGIiBkPSJNMTAuMTUsNTguNDNjNC40MSwwLDgtMy41OSw4LThjMC00LjQxLTMuNTktOC04LThjLTQuNDEsMC04LDMuNTktOCw4QzIuMTUsNTQuODQsNS43NCw1OC40MywxMC4xNSw1OC40M3oKCSBNMTAuMTUsNDMuNDljMy44MywwLDYuOTQsMy4xMSw2Ljk0LDYuOTRjMCwzLjgzLTMuMTEsNi45NC02Ljk0LDYuOTRjLTMuODMsMC02Ljk0LTMuMTEtNi45NC02Ljk0CglDMy4yMSw0Ni42LDYuMzMsNDMuNDksMTAuMTUsNDMuNDlMMTAuMTUsNDMuNDl6Ii8+CjxwYXRoIGZpbGw9IiM2QUE5REQiIGQ9Ik02Ljk4LDczLjU5YzAuMSwwLjEsMC4yNCwwLjE1LDAuMzcsMC4xNXMwLjI3LTAuMDUsMC4zNy0wLjE1bDIuNDItMi40MmwyLjQzLDIuNDMKCWMwLjEsMC4xLDAuMjQsMC4xNSwwLjM3LDAuMTVjMC4xNCwwLDAuMjctMC4wNSwwLjM3LTAuMTVjMC4yMS0wLjIxLDAuMjEtMC41NCwwLTAuNzVsLTIuNDMtMi40M0wxMy4zMiw2OAoJYzAuMjEtMC4yMSwwLjIxLTAuNTQsMC0wLjc1Yy0wLjIxLTAuMjEtMC41NC0wLjIxLTAuNzUsMGwtMi40MiwyLjQybC0yLjQxLTIuNDFjLTAuMjEtMC4yMS0wLjU0LTAuMjEtMC43NSwwCgljLTAuMjEsMC4yMS0wLjIxLDAuNTQsMCwwLjc1bDIuNDEsMi40MWwtMi40MiwyLjQyQzYuNzcsNzMuMDUsNi43Nyw3My4zOSw2Ljk4LDczLjU5TDYuOTgsNzMuNTl6Ii8+CjxwYXRoIGZpbGw9IiM2QUE5REQiIGQ9Ik0xMC4xNSw3OC40M2M0LjQxLDAsOC0zLjU5LDgtOGMwLTQuNDEtMy41OS04LTgtOGMtNC40MSwwLTgsMy41OS04LDhDMi4xNSw3NC44NCw1Ljc0LDc4LjQzLDEwLjE1LDc4LjQzegoJIE0xMC4xNSw2My40OWMzLjgzLDAsNi45NCwzLjExLDYuOTQsNi45NGMwLDMuODMtMy4xMSw2Ljk0LTYuOTQsNi45NGMtMy44MywwLTYuOTQtMy4xMS02Ljk0LTYuOTQKCUMzLjIxLDY2LjYsNi4zMyw2My40OSwxMC4xNSw2My40OUwxMC4xNSw2My40OXoiLz4KPC9zdmc+";function Td(){var e=yl();return(0,o.createElement)(_f,{className:oc(kd.btnClearSearch,wc.visibleOnSearchOnly),onClick:e,"aria-label":"Clear",title:"Clear"},(0,o.createElement)("div",{className:oc(kd.icnClearnSearch)}))}var Id={":hover":{"> .epr-icn-clear-search":{backgroundPositionY:"-60px"}}},kd=vc.create(fc({btnClearSearch:{".":"epr-btn-clear-search",position:"absolute",right:"var(--epr-search-bar-inner-padding)",height:"30px",width:"30px",display:"flex",alignItems:"center",justifyContent:"center",top:"50%",transform:"translateY(-50%)",padding:"0",borderRadius:"50%",":hover":{background:"var(--epr-hover-bg-color)"},":focus":{background:"var(--epr-hover-bg-color)"}},icnClearnSearch:{".":"epr-icn-clear-search",backgroundColor:"transparent",backgroundRepeat:"no-repeat",backgroundSize:"20px",height:"20px",width:"20px",backgroundImage:"url("+Ed+")",":hover":{backgroundPositionY:"-20px"},":focus":{backgroundPositionY:"-20px"}}},Sc("icnClearnSearch",{backgroundPositionY:"-40px"}),Sc("btnClearSearch",Id))),Nd=mc(nc.emojiPicker)+" "+mc(nc.emojiList),Ld=["button",mc(nc.emoji)].join(""),Ad=mc(nc.category);function Rd(e){var t=e.value;if(!t)return null;var n=function(e){return[Ld,'[data-full-name*="',Cl(e),'"]'].join("")}(t);return(0,o.createElement)("style",null,"\n    "+Nd+" "+Ld+" {\n      display: none;\n    }\n\n\n    "+Nd+" "+n+" {\n      display: flex;\n    }\n\n    "+Nd+" "+Ad+":not(:has("+n+")) {\n      display: none;\n    }\n  ")}function Dd(){return(0,o.createElement)("div",{className:oc(Od.icnSearch)})}var Od=vc.create(fc({icnSearch:{".":"epr-icn-search",content:"",position:"absolute",top:"50%",left:"var(--epr-search-bar-inner-padding)",transform:"translateY(-50%)",width:"20px",height:"20px",backgroundRepeat:"no-repeat",backgroundPosition:"0 0",backgroundSize:"20px",backgroundImage:"url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDI2LjMuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHdpZHRoPSIyMHB4IiBoZWlnaHQ9IjQwcHgiIHZpZXdCb3g9IjAgMCAyMCA0MCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMjAgNDAiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iIzg2ODY4NiIgZD0iTTEyLDguODFjMCwyLjA4LTEuNjgsMy43Ni0zLjc2LDMuNzZjLTIuMDgsMC0zLjc2LTEuNjgtMy43Ni0zLjc2CgljMC0yLjA4LDEuNjgtMy43NiwzLjc2LTMuNzZDMTAuMzIsNS4wNSwxMiw2LjczLDEyLDguODF6IE0xMS4yMywxMi43MmMtMC44MywwLjY0LTEuODcsMS4wMS0yLjk5LDEuMDFjLTIuNzIsMC00LjkyLTIuMi00LjkyLTQuOTIKCWMwLTIuNzIsMi4yLTQuOTIsNC45Mi00LjkyYzIuNzIsMCw0LjkyLDIuMiw0LjkyLDQuOTJjMCwxLjEzLTAuMzgsMi4xNi0xLjAxLDIuOTlsMy45NCwzLjkzYzAuMjUsMC4yNSwwLjI1LDAuNjYsMCwwLjkyCgljLTAuMjUsMC4yNS0wLjY2LDAuMjUtMC45MiwwTDExLjIzLDEyLjcyeiIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iI0MwQzBCRiIgZD0iTTEyLDI4LjgxYzAsMi4wOC0xLjY4LDMuNzYtMy43NiwzLjc2Yy0yLjA4LDAtMy43Ni0xLjY4LTMuNzYtMy43NgoJYzAtMi4wOCwxLjY4LTMuNzYsMy43Ni0zLjc2QzEwLjMyLDI1LjA1LDEyLDI2LjczLDEyLDI4LjgxeiBNMTEuMjMsMzIuNzJjLTAuODMsMC42NC0xLjg3LDEuMDEtMi45OSwxLjAxCgljLTIuNzIsMC00LjkyLTIuMi00LjkyLTQuOTJjMC0yLjcyLDIuMi00LjkyLDQuOTItNC45MmMyLjcyLDAsNC45MiwyLjIsNC45Miw0LjkyYzAsMS4xMy0wLjM4LDIuMTYtMS4wMSwyLjk5bDMuOTQsMy45MwoJYzAuMjUsMC4yNSwwLjI1LDAuNjYsMCwwLjkyYy0wLjI1LDAuMjUtMC42NiwwLjI1LTAuOTIsMEwxMS4yMywzMi43MnoiLz4KPC9zdmc+)"}},Sc("icnSearch",{backgroundPositionY:"-20px"})));function Pd(){var e=_u(),t=_l();return e?null:(0,o.createElement)(rd,{className:oc(zd.overlay)},(0,o.createElement)(Fd,null),t?(0,o.createElement)(dd,null):null)}function Fd(){var e=(0,o.useState)(0),t=e[0],n=e[1],r=hl(),a=rl(),i=function(){var e,t=gu();return null!=(e=[t.searchPlaceHolder,t.searchPlaceholder].find((function(e){return e!==iu})))?e:iu}(),s=gu().autoFocusSearch,c=xl(),u=c.statusSearchResults,l=c.searchTerm,f=c.onChange,d=null==a?void 0:a.current,h=null==d?void 0:d.value;return(0,o.createElement)(sd,{className:oc(zd.searchContainer)},(0,o.createElement)(Rd,{value:h}),(0,o.createElement)("input",{autoFocus:s,"aria-label":"Type to search for an emoji",onFocus:r,className:oc(zd.search),type:"text","aria-controls":"epr-search-id",placeholder:i,onChange:function(e){n(t+1),setTimeout((function(){var t,n;f(null!=(t=null==e||null==(n=e.target)?void 0:n.value)?t:h)}))},ref:a}),l?(0,o.createElement)("div",{role:"status",className:oc("epr-status-search-results",zd.visuallyHidden),"aria-live":"polite",id:"epr-search-id","aria-atomic":"true"},u):null,(0,o.createElement)(Dd,null),(0,o.createElement)(Td,null))}var zd=vc.create(fc({overlay:{padding:"var(--epr-header-padding)",zIndex:"var(--epr-header-overlay-z-index)"},searchContainer:{".":"epr-search-container",flex:"1",display:"block",minWidth:"0"},visuallyHidden:{clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",width:"1px"},search:{outline:"none",transition:"all 0.2s ease-in-out",color:"var(--epr-search-input-text-color)",borderRadius:"var(--epr-search-input-border-radius)",padding:"var(--epr-search-input-padding)",height:"var(--epr-search-input-height)",backgroundColor:"var(--epr-search-input-bg-color)",border:"1px solid var(--epr-search-input-bg-color)",width:"100%",":focus":{backgroundColor:"var(--epr-search-input-bg-color-active)",border:"1px solid var(--epr-search-border-color)"},"::placeholder":{color:"var(--epr-search-input-placeholder-color)"}},btnClearSearch:{".":"epr-btn-clear-search",position:"absolute",right:"var(--epr-search-bar-inner-padding)",height:"30px",width:"30px",display:"flex",alignItems:"center",justifyContent:"center",top:"50%",transform:"translateY(-50%)",padding:"0",borderRadius:"50%",":hover":{background:"var(--epr-hover-bg-color)"},":focus":{background:"var(--epr-hover-bg-color)"}},icnClearnSearch:{".":"epr-icn-clear-search",backgroundColor:"transparent",backgroundRepeat:"no-repeat",backgroundSize:"20px",height:"20px",width:"20px",backgroundImage:"url("+Ed+")",":hover":{backgroundPositionY:"-20px"},":focus":{backgroundPositionY:"-20px"}}},Sc("icnClearnSearch",{backgroundPositionY:"-40px"}),Sc("btnClearSearch",{":hover > .epr-icn-clear-search":{backgroundPositionY:"-60px"}})));function jd(){return(0,o.createElement)(sd,{className:oc("epr-header",wc.hiddenOnReactions)},(0,o.createElement)(Pd,null),(0,o.createElement)(Md,null))}function Bd(e){return(0,o.createElement)(Ku,null,(0,o.createElement)(xc,null),(0,o.createElement)(pu,Object.assign({},e),(0,o.createElement)(Ud,null)))}function Ud(){var e=Pu()[0],t=xu(),n=(0,o.useState)(!e),r=n[0],a=n[1],i=gu().open;return(0,o.useEffect)((function(){e&&!t||r||a(!0)}),[r,t,e]),i?(0,o.createElement)(Pl,null,(0,o.createElement)(jf,null),(0,o.createElement)(Wd,{renderAll:r})):null}function Wd(e){return e.renderAll?(0,o.createElement)(o.Fragment,null,(0,o.createElement)(jd,null),(0,o.createElement)(Zf,null),(0,o.createElement)(pd,null)):null}var Gd=(0,o.memo)(Bd,Cc),Vd=function(e){var t,n;function r(t){var n;return(n=e.call(this,t)||this).state={hasError:!1},n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,dc(t,n),r.getDerivedStateFromError=function(){return{hasError:!0}};var a=r.prototype;return a.componentDidCatch=function(e,t){console.error("Emoji Picker React failed to render:",e,t)},a.render=function(){return this.state.hasError?null:this.props.children},r}(o.Component);const Hd=function(e){var t=function(e){var t=o.useRef({onEmojiClick:e.onEmojiClick||yu,onReactionClick:e.onReactionClick||e.onEmojiClick,onSkinToneChange:e.onSkinToneChange||yu});return o.useEffect((function(){t.current.onEmojiClick=e.onEmojiClick||yu,t.current.onReactionClick=e.onReactionClick||e.onEmojiClick}),[e.onEmojiClick,e.onReactionClick]),o.useEffect((function(){t.current.onSkinToneChange=e.onSkinToneChange||yu}),[e.onSkinToneChange]),t}({onEmojiClick:e.onEmojiClick,onReactionClick:e.onReactionClick,onSkinToneChange:e.onSkinToneChange});return(0,o.createElement)(Vd,null,(0,o.createElement)(vu.Provider,{value:t},(0,o.createElement)(Gd,Object.assign({},e))))};function Yd(e){return jr({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M448 405.333V106.667C448 83.198 428.802 64 405.333 64H106.667C83.198 64 64 83.198 64 106.667v298.666C64 428.802 83.198 448 106.667 448h298.666C428.802 448 448 428.802 448 405.333zM181.333 288l53.334 64 74.666-96 96 128H106.667l74.666-96z"}}]})(e)}function Xd(e){return jr({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M48 448l416-192L48 64v149.333L346 256 48 298.667z"}}]})(e)}function qd(e){return jr({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M0 5a2 2 0 0 1 2-2h7.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 4.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 13H2a2 2 0 0 1-2-2V5z"}}]})(e)}function Kd(e){return jr({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M10.961 12.365a1.99 1.99 0 0 0 .522-1.103l3.11 1.382A1 1 0 0 0 16 11.731V4.269a1 1 0 0 0-1.406-.913l-3.111 1.382A2 2 0 0 0 9.5 3H4.272l6.69 9.365zm-10.114-9A2.001 2.001 0 0 0 0 5v6a2 2 0 0 0 2 2h5.728L.847 3.366zm9.746 11.925-10-14 .814-.58 10 14-.814.58z"}}]})(e)}function Qd(e){return jr({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"}},{tag:"path",attr:{d:"M7 11.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5zm-2-3a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm-2-3a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5z"}}]})(e)}function Jd(e){return jr({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M5 3a3 3 0 0 1 6 0v5a3 3 0 0 1-6 0V3z"}},{tag:"path",attr:{d:"M3.5 6.5A.5.5 0 0 1 4 7v1a4 4 0 0 0 8 0V7a.5.5 0 0 1 1 0v1a5 5 0 0 1-4.5 4.975V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 .5-.5z"}}]})(e)}function Zd(e){return jr({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M13 8c0 .564-.094 1.107-.266 1.613l-.814-.814A4.02 4.02 0 0 0 12 8V7a.5.5 0 0 1 1 0v1zm-5 4c.818 0 1.578-.245 2.212-.667l.718.719a4.973 4.973 0 0 1-2.43.923V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 1 0v1a4 4 0 0 0 4 4zm3-9v4.879L5.158 2.037A3.001 3.001 0 0 1 11 3z"}},{tag:"path",attr:{d:"M9.486 10.607 5 6.12V8a3 3 0 0 0 4.486 2.607zm-7.84-9.253 12 12 .708-.708-12-12-.708.708z"}}]})(e)}function $d(e){return jr({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M12.87 15.07l-2.54-2.51.03-.03A17.52 17.52 0 0014.07 6H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"}}]})(e)}function eh(e){return jr({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"}},{tag:"path",attr:{d:"M20 18c1.1 0 1.99-.9 1.99-2L22 6a2 2 0 00-2-2H4c-1.11 0-2 .89-2 2v10a2 2 0 002 2H0v2h24v-2h-4zm-7-3.53v-2.19c-2.78 0-4.61.85-6 2.72.56-2.67 2.11-5.33 6-5.87V7l4 3.73-4 3.74z"}}]})(e)}function th(e){return jr({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"}},{tag:"path",attr:{d:"M21.22 18.02l2 2H24v-2h-2.78zm.77-2l.01-10a2 2 0 00-2-2H7.22l5.23 5.23c.18-.04.36-.07.55-.1V7.02l4 3.73-1.58 1.47 5.54 5.54c.61-.33 1.03-.99 1.03-1.74zM2.39 1.73L1.11 3l1.54 1.54c-.4.36-.65.89-.65 1.48v10a2 2 0 002 2H0v2h18.13l2.71 2.71 1.27-1.27L2.39 1.73zM7 15.02c.31-1.48.92-2.95 2.07-4.06l1.59 1.59c-1.54.38-2.7 1.18-3.66 2.47z"}}]})(e)}function nh(e){return jr({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M11.001 10h2v5h-2zM11 16h2v2h-2z"}},{tag:"path",attr:{d:"M13.768 4.2C13.42 3.545 12.742 3.138 12 3.138s-1.42.407-1.768 1.063L2.894 18.064a1.986 1.986 0 0 0 .054 1.968A1.984 1.984 0 0 0 4.661 21h14.678c.708 0 1.349-.362 1.714-.968a1.989 1.989 0 0 0 .054-1.968L13.768 4.2zM4.661 19 12 5.137 19.344 19H4.661z"}}]})(e)}function rh(e){return jr({tag:"svg",attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M512 1024c-69.1 0-136.2-13.5-199.3-40.2C251.7 958 197 921 150 874c-47-47-84-101.7-109.8-162.7C13.5 648.2 0 581.1 0 512c0-19.9 16.1-36 36-36s36 16.1 36 36c0 59.4 11.6 117 34.6 171.3 22.2 52.4 53.9 99.5 94.3 139.9 40.4 40.4 87.5 72.2 139.9 94.3C395 940.4 452.6 952 512 952c59.4 0 117-11.6 171.3-34.6 52.4-22.2 99.5-53.9 139.9-94.3 40.4-40.4 72.2-87.5 94.3-139.9C940.4 629 952 571.4 952 512c0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 0 0-94.3-139.9 437.71 437.71 0 0 0-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.2C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3s-13.5 136.2-40.2 199.3C958 772.3 921 827 874 874c-47 47-101.8 83.9-162.7 109.7-63.1 26.8-130.2 40.3-199.3 40.3z"}}]})(e)}class ah{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class ih{refCount(e){return oh("refCount")}incRef(e){return oh("incRef")}timerAvailable(){return!0}time(e){return oh("time")}read(e){return oh("read")}readSync(e){return oh("readSync")}readToGPU(e,t){return oh("readToGPU")}numDataIds(){return oh("numDataIds")}disposeData(e,t){return oh("disposeData")}write(e,t,n){return oh("write")}move(e,t,n,r,a){return oh("move")}createTensorFromGPUData(e,t,n){return oh("createTensorFromGPUData")}memory(){return oh("memory")}floatPrecision(){return oh("floatPrecision")}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}dispose(){return oh("dispose")}}function oh(e){throw new Error("'".concat(e,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function sh(e){let t=e.length,n=0;for(;t>0;)n=Math.random()*t|0,t--,lh(e,t,n)}function ch(e,t,n){return Math.max(e,Math.min(t,n))}function uh(e){return e%2===0?e:e+1}function lh(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function fh(e,t){if(!e)throw new Error("string"===typeof t?t:t())}function dh(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";fh(gh(e,t),(()=>n+" Shapes ".concat(e," and ").concat(t," must match")))}function hh(e){fh(null!=e,(()=>"The input to the tensor constructor must be a non-null value."))}function ph(e){if(0===e.length)return 1;let t=e[0];for(let n=1;n<e.length;n++)t*=e[n];return t}function gh(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function mh(e){return e%1===0}function vh(e){const t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function bh(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function yh(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return new Promise(((a,i)=>{let o=0;const s=()=>{if(e())return void a();o++;const c=t(o);null!=n&&o>=n?i():null!=r?r(s,c):setTimeout(s,c)};s()}))}function xh(e,t){let n=1,r=-1;for(let i=0;i<e.length;++i)if(e[i]>=0)n*=e[i];else if(-1===e[i]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. "+"Found -1 at dim ".concat(r," and dim ").concat(i));r=i}else if(e[i]<0)throw Error("Shapes can not be < 0. Found ".concat(e[i]," at dim ").concat(i));if(-1===r){if(t>0&&t!==n)throw Error("Size(".concat(t,") must match the product of shape ").concat(e));return e}if(0===n)throw Error("Cannot infer the missing size in [".concat(e,"] when ")+"there are 0 elements");if(t%n!==0)throw Error("The implicit shape can't be a fractional number. "+"Got ".concat(t," / ").concat(n));const a=e.slice();return a[r]=t/n,a}function wh(e,t){const n=t.length;return e=null==e?t.map(((e,t)=>t)):[].concat(e),fh(e.every((e=>e>=-n&&e<n)),(()=>"All values in axis param must be in range [-".concat(n,", ").concat(n,") but ")+"got axis ".concat(e))),fh(e.every((e=>mh(e))),(()=>"All values in axis param must be integers but "+"got axis ".concat(e))),e.map((e=>e<0?n+e:e))}function Sh(e,t){const n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||a?null:wh(t,e).sort();let o=0;for(let s=0;s<e.length;++s){if(null!=i){if(i[o]===s&&1!==e[s])throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(e[s],"' is not 1"));(null==i[o]||i[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),i[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function Ch(e,t){return Mh(e,t)}function Mh(e,t){let n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type ".concat(e));n=new Array(t)}return n}function _h(e,t){return"complex64"!==t&&(("float32"!==t||"complex64"===e)&&(("int32"!==t||"float32"===e||"complex64"===e)&&("bool"!==t||"bool"!==e)))}function Eh(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype ".concat(e))}function Th(e){return"string"===typeof e||e instanceof String}function Ih(e){return"number"===typeof e}function kh(e){return Array.isArray(e)?kh(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":Ih(e)?"float32":Th(e)?"string":function(e){return"boolean"===typeof e}(e)?"bool":"float32"}function Nh(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Lh(e,t){for(let n=t;n<e;++n)if(e%n===0)return n;return e}function Ah(e){const t=e.length;if(t<2)return[];const n=new Array(t-1);n[t-2]=e[t-1];for(let r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function Rh(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=new Array;if(1===t.length){const i=t[0]*(r?2:1);for(let t=0;t<i;t++)a[t]=n[e+t]}else{const i=t[0],o=t.slice(1),s=o.reduce(((e,t)=>e*t))*(r?2:1);for(let t=0;t<i;t++)a[t]=Rh(e+t*s,o,n,r)}return a}function Dh(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0===e.length)return t[0];const r=e.reduce(((e,t)=>e*t))*(n?2:1);if(0===r)return[];if(r!==t.length)throw new Error("[".concat(e,"] does not match the input size ").concat(t.length).concat(n?" for a complex tensor":"","."));return Rh(0,e,t,n)}function Oh(e,t){const n=Ph(e,t);for(let r=0;r<n.length;r++)n[r]=1;return n}function Ph(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type ".concat(t))}function Fh(e,t){const n=e.reduce(((e,t)=>e*t),1);if(null==t||"float32"===t)return Dh(e,new Float32Array(n));if("int32"===t)return Dh(e,new Int32Array(n));if("bool"===t)return Dh(e,new Uint8Array(n));throw new Error("Unknown data type ".concat(t))}function zh(e){e.forEach((t=>{fh(Number.isInteger(t)&&t>=0,(()=>"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(e,"].")))}))}function jh(e,t,n){if(0===t)return 0;if(1===t)return e[0];let r=e[e.length-1];for(let a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}function Bh(e,t,n){if(0===t)return[];if(1===t)return[e];const r=new Array(t);for(let a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}function Uh(e){return e&&e.then&&"function"===typeof e.then}const Wh="tfjsflags";class Gh{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Vh,this.populateURLFlags()}setPlatform(e,t){null!=this.platform&&(Hh().getBool("IS_TEST")||Hh().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t}registerFlag(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){const t=this.urlFlags[e];Hh().getBool("IS_TEST")||Hh().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(t,".")),this.set(e,t)}}async getAsync(e){return e in this.flags||(this.flags[e]=await this.evaluateFlag(e)),this.flags[e]}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(Uh(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if("undefined"===typeof this.global||"undefined"===typeof this.global.location||"undefined"===typeof this.global.location.search)return;const e=this.getQueryParams(this.global.location.search);if(Wh in e){e[Wh].split(",").forEach((e=>{const[t,n]=e.split(":");this.urlFlags[t]=function(e,t){const n=t.toLowerCase();return"true"===n||"false"===n?"true"===n:"".concat(+n)===n?+n:t}(0,n)}))}}}function Vh(e){const t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,r[0],r[1]),r.join("=")})),t}function Hh(){return Yh}let Yh=null;var Xh=n(2285);let qh;function Kh(){if(null==qh){let e;if("undefined"!==typeof window)e=window;else if("undefined"!==typeof n.g)e=n.g;else if("undefined"!==typeof Xh)e=Xh;else{if("undefined"===typeof self)throw new Error("Could not find a global object");e=self}qh=e}return qh}function Qh(e,t){const n=function(){const e=Kh();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);{const r=t();return n.set(e,r),n.get(e)}}const Jh="Abs",Zh="Acos",$h="Acosh",ep="Add",tp="AddN",np="All",rp="Any",ap="ArgMax",ip="ArgMin",op="Asin",sp="Asinh",cp="Atan",up="Atanh",lp="Atan2",fp="AvgPool",dp="AvgPoolGrad",hp="AvgPool3D",pp="AvgPool3DGrad",gp="BatchMatMul",mp="BatchToSpaceND",vp="Bincount",bp="BitwiseAnd",yp="BroadcastArgs",xp="Cast",wp="Ceil",Sp="ClipByValue",Cp="Complex",Mp="ComplexAbs",_p="Concat",Ep="Conv2D",Tp="Conv2DBackpropFilter",Ip="Conv2DBackpropInput",kp="Conv3D",Np="Conv3DBackpropFilterV2",Lp="Conv3DBackpropInputV2",Ap="Cos",Rp="Cosh",Dp="Cumprod",Op="Cumsum",Pp="CropAndResize",Fp="DenseBincount",zp="DepthToSpace",jp="DepthwiseConv2dNative",Bp="DepthwiseConv2dNativeBackpropFilter",Up="DepthwiseConv2dNativeBackpropInput",Wp="Diag",Gp="Dilation2D",Vp="Dilation2DBackpropInput",Hp="Dilation2DBackpropFilter",Yp="Draw",Xp="RealDiv",qp="Einsum",Kp="Elu",Qp="EluGrad",Jp="Erf",Zp="Equal",$p="Exp",eg="ExpandDims",tg="Expm1",ng="FFT",rg="Fill",ag="FlipLeftRight",ig="Floor",og="FloorDiv",sg="FusedBatchNorm",cg="GatherV2",ug="GatherNd",lg="Greater",fg="GreaterEqual",dg="Identity",hg="IFFT",pg="Imag",gg="IsFinite",mg="IsInf",vg="IsNan",bg="LeakyRelu",yg="Less",xg="LessEqual",wg="LinSpace",Sg="Log",Cg="Log1p",Mg="LogicalAnd",_g="LogicalNot",Eg="LogicalOr",Tg="LRN",Ig="LRNGrad",kg="Max",Ng="Maximum",Lg="MaxPool",Ag="MaxPoolGrad",Rg="MaxPool3D",Dg="MaxPool3DGrad",Og="MaxPoolWithArgmax",Pg="Mean",Fg="Min",zg="Minimum",jg="MirrorPad",Bg="Mod",Ug="Multinomial",Wg="Multiply",Gg="Neg",Vg="NotEqual",Hg="NonMaxSuppressionV3",Yg="NonMaxSuppressionV4",Xg="NonMaxSuppressionV5",qg="OnesLike",Kg="OneHot",Qg="Pack",Jg="PadV2",Zg="Pow",$g="Prelu",em="Prod",tm="RaggedGather",nm="RaggedRange",rm="RaggedTensorToTensor",am="Range",im="Real",om="Reciprocal",sm="Relu",cm="Reshape",um="ResizeNearestNeighbor",lm="ResizeNearestNeighborGrad",fm="ResizeBilinear",dm="ResizeBilinearGrad",hm="Relu6",pm="Reverse",gm="Round",mm="Rsqrt",vm="ScatterNd",bm="TensorScatterUpdate",ym="SearchSorted",xm="Select",wm="Selu",Sm="Slice",Cm="Sin",Mm="Sinh",_m="Sign",Em="Sigmoid",Tm="Softplus",Im="Sqrt",km="Sum",Nm="SpaceToBatchND",Lm="SplitV",Am="Softmax",Rm="SparseFillEmptyRows",Dm="SparseReshape",Om="SparseSegmentMean",Pm="SparseSegmentSum",Fm="SparseToDense",zm="SquaredDifference",jm="Square",Bm="StaticRegexReplace",Um="StridedSlice",Wm="StringNGrams",Gm="StringSplit",Vm="StringToHashBucketFast",Hm="Sub",Ym="Tan",Xm="Tanh",qm="Tile",Km="TopK",Qm="Transform",Jm="Transpose",Zm="Unique",$m="Unpack",ev="UnsortedSegmentSum",tv="ZerosLike",nv="Step",rv="FromPixels",av="RotateWithOffset",iv="_FusedMatMul",ov="FusedConv2D",sv="FusedDepthwiseConv2D";function cv(){Hh().getBool("IS_TEST")||Hh().getBool("PROD")||console.warn(...arguments)}function uv(){Hh().getBool("IS_TEST")||Hh().getBool("PROD")||console.log(...arguments)}const lv=Qh("kernelRegistry",(()=>new Map)),fv=Qh("gradRegistry",(()=>new Map));function dv(e,t){const n=vv(e,t);return lv.get(n)}function hv(e){return fv.get(e)}function pv(e){const t=lv.entries(),n=[];for(;;){const{done:r,value:a}=t.next();if(r)break;const[i,o]=a,[s]=i.split("_");s===e&&n.push(o)}return n}function gv(e){const{kernelName:t,backendName:n}=e,r=vv(t,n);lv.has(r)&&cv("The kernel '".concat(t,"' for backend ")+"'".concat(n,"' is already registered")),lv.set(r,e)}function mv(e){const{kernelName:t}=e;fv.has(t)&&Hh().getBool("DEBUG")&&cv("Overriding the gradient for '".concat(t,"'")),fv.set(t,e)}function vv(e,t){return"".concat(t,"_").concat(e)}function bv(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}var yv=n(7353);const xv=n.n(yv)()||yv;function wv(e){return xv.fromString(e,!0,16)}const Sv=wv("c3a5c85c97cb3127"),Cv=wv("b492b66fbe98f273"),Mv=wv("9ae16a3b2f90404f");function _v(e){return e.xor(e.shru(47))}function Ev(e,t,n){const r=e.slice(t,t+n);return xv.fromBytes(Array.from(r),!0,!0)}function Tv(e,t){return Ev(e,t,8)}function Iv(e,t){return Ev(e,t,4)}function kv(e,t){return 0===t?e:e.shru(t).or(e.shl(64-t))}function Nv(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:wv("9ddfea08eb382d69"),r=e.xor(t).mul(n);r=r.xor(r.shru(47));let a=t.xor(r).mul(n);return a=a.xor(a.shru(47)),a=a.mul(n),a}function Lv(e,t,n,r){return function(e,t,n,r,a,i){a=a.add(e),i=kv(i.add(a).add(r),21);const o=a;return a=(a=a.add(t)).add(n),i=i.add(kv(a,44)),[a.add(r),i.add(o)]}(Tv(e,t),Tv(e,t+8),Tv(e,t+16),Tv(e,t+24),n,r)}function Av(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;const n=xv.fromNumber(81,!0);if(t<=32)return t<=16?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;if(t>=8){const n=Mv.add(2*t),r=Tv(e,0).add(Mv),a=Tv(e,t-8);return Nv(kv(a,37).mul(n).add(r),kv(r,25).add(a).mul(n),n)}if(t>=4){const n=Mv.add(2*t);return Nv(Iv(e,0).shl(3).add(t),Iv(e,t-4),n)}if(t>0){const n=e[0]+(e[t>>1]<<8),r=t+(e[t-1]<<2);return _v(Mv.mul(n).xor(Sv.mul(r))).mul(Mv)}return Mv}(e,t):function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;const n=Mv.add(2*t),r=Tv(e,0).mul(Cv),a=Tv(e,8),i=Tv(e,t-8).mul(n),o=Tv(e,t-16).mul(Mv);return Nv(kv(r.add(a),43).add(kv(i,30)).add(o),r.add(kv(a.add(Mv),18)).add(i),n)}(e,t);if(t<=64)return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;const n=Mv.add(2*t),r=Tv(e,0).mul(Mv),a=Tv(e,8),i=Tv(e,t-8).mul(n),o=Tv(e,t-16).mul(Mv),s=kv(r.add(a),43).add(kv(i,30)).add(o),c=Nv(s,r.add(kv(a.add(Mv),18)).add(i),n),u=Tv(e,16).mul(n),l=Tv(e,24),f=s.add(Tv(e,t-32)).mul(n),d=c.add(Tv(e,t-24)).mul(n);return Nv(kv(u.add(l),43).add(kv(f,30)).add(d),u.add(kv(l.add(r),18)).add(f),n)}(e,t);let r=n,a=n.mul(Cv).add(113),i=_v(a.mul(Mv).add(113)).mul(Mv),o=[xv.UZERO,xv.UZERO],s=[xv.UZERO,xv.UZERO];r=r.mul(Mv).add(Tv(e,0));let c=0;const u=64*(t-1>>6),l=u+(t-1&63)-63;do{r=kv(r.add(a).add(o[0]).add(Tv(e,c+8)),37).mul(Cv),a=kv(a.add(o[1]).add(Tv(e,c+48)),42).mul(Cv),r=r.xor(s[1]),a=a.add(o[0]).add(Tv(e,c+40)),i=kv(i.add(s[0]),33).mul(Cv),o=Lv(e,c,o[1].mul(Cv),r.add(s[0])),s=Lv(e,c+32,i.add(s[1]),a.add(Tv(e,c+16))),[i,r]=[r,i],c+=64}while(c!==u);const f=Cv.add(i.and(255).shl(1));return c=l,s[0]=s[0].add(t-1&63),o[0]=o[0].add(s[0]),s[0]=s[0].add(o[0]),r=kv(r.add(a).add(o[0]).add(Tv(e,c+8)),37).mul(f),a=kv(a.add(o[1]).add(Tv(e,c+48)),42).mul(f),r=r.xor(s[1].mul(9)),a=a.add(o[0].mul(9).add(Tv(e,c+40))),i=kv(i.add(s[0]),33).mul(f),o=Lv(e,c,o[1].mul(f),r.add(s[0])),s=Lv(e,c+32,i.add(s[1]),a.add(Tv(e,c+16))),[i,r]=[r,i],Nv(Nv(o[0],s[0],f).add(_v(a).mul(Sv)).add(i),Nv(o[1],s[1],f).add(r),f)}function Rv(e,t){return"string"===t?Pv(e):Dv([e],t)}function Dv(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=jv(e)),Hh().getBool("DEBUG")&&function(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(t," being uploaded contains ").concat(r,"."))}}(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){const t=new Uint8Array(e.length);for(let n=0;n<t.length;++n)0!==Math.round(e[n])&&(t[n]=1);return t}throw new Error("Unknown data type ".concat(t))}function Ov(){return Hh().platform.now()}function Pv(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",Hh().platform.encode(e,t)}function Fv(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",Hh().platform.decode(e,t)}function zv(e){return null!=Hh().platform.isTypedArray?Hh().platform.isTypedArray(e):bv(e)}function jv(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t&&(t=[]),"boolean"===typeof e||"number"===typeof e||"string"===typeof e||Uh(e)||null==e||zv(e)&&n)t.push(e);else if(Array.isArray(e)||zv(e))for(let r=0;r<e.length;++r)jv(e[r],t,n);else{let r=-1;for(const t of Object.keys(e))/^([1-9]+[0-9]*|0)$/.test(t)&&(r=Math.max(r,Number(t)));for(let a=0;a<=r;a++)jv(e[a],t,n)}return t}class Bv{constructor(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new Wv)}profileKernel(e,t,n){let r;const a=()=>{r=n()};let i;const o=Ov();if(this.backendTimer.timerAvailable())i=this.backendTimer.time(a);else{a();for(const e of r)e.dataSync();i=Promise.resolve({kernelMs:Ov()-o})}if(Hh().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let s=0;s<r.length;s++){const t=r[s];t.data().then((n=>{Uv(n,t.dtype,e)}))}return{kernelName:e,outputs:r,inputs:t,timeMs:i.then((e=>e.kernelMs)),extraInfo:i.then((e=>null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""))}}logKernelProfile(e){const{kernelName:t,outputs:n,timeMs:r,inputs:a,extraInfo:i}=e;n.forEach((e=>{Promise.all([e.data(),r,i]).then((n=>{this.logger.logKernelProfile(t,e,n[0],n[1],a,n[2])}))}))}}function Uv(e,t,n){if("float32"!==t)return!1;for(let r=0;r<e.length;r++){const t=e[r];if(isNaN(t)||!isFinite(t))return console.warn("Found ".concat(t," in the result of '").concat(n,"'")),!0}return!1}class Wv{logKernelProfile(e,t,n,r,a,i){const o="number"===typeof r?bh("".concat(r,"ms"),9):r.error,s=bh(e,25),c=t.rank,u=t.size,l=bh(t.shape.toString(),14);let f="";for(const d in a){const e=a[d];if(null!=e){const n=e.shape||t.shape,r=n.length;f+="".concat(d,": ").concat(r,"D ").concat(r>0?n:""," ")}}console.log("%c".concat(s,"\t%c").concat(o,"\t%c").concat(c,"D ").concat(l,"\t%c").concat(u,"\t%c").concat(f,"\t%c").concat(i),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}function Gv(e,t,n,r){const a=Ah(t),i=function(e,t,n,r){const a=ph(t),i=r[r.length-1],o=new Array(i).fill(0),s=t.length,c="complex64"===n?Xv(e):e;if(s>1)for(let u=0;u<a/i;u++){const e=u*i;for(let t=0;t<i;t++)o[t]=Math.max(o[t],Vv(c[e+t],0,n).length)}return o}(e,t,n,a),o=t.length,s=Yv(e,t,n,a,i),c=["Tensor"];return r&&(c.push("  dtype: ".concat(n)),c.push("  rank: ".concat(o)),c.push("  shape: [".concat(t,"]")),c.push("  values:")),c.push(s.map((e=>"    "+e)).join("\n")),c.join("\n")}function Vv(e,t,n){let r;return r=Array.isArray(e)?"".concat(parseFloat(e[0].toFixed(7))," + ")+"".concat(parseFloat(e[1].toFixed(7)),"j"):Th(e)?"'".concat(e,"'"):"bool"===n?Hv(e):parseFloat(e.toFixed(7)).toString(),bh(r,t)}function Hv(e){return 0===e?"false":"true"}function Yv(e,t,n,r,a){let i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const o="complex64"===n?2:1,s=t[0],c=t.length;if(0===c){if("complex64"===n){return[Vv(Xv(e)[0],0,n)]}return"bool"===n?[Hv(e[0])]:[e[0].toString()]}if(1===c){if(s>20){const t=3*o;let r=Array.from(e.slice(0,t)),i=Array.from(e.slice((s-3)*o,s*o));return"complex64"===n&&(r=Xv(r),i=Xv(i)),["["+r.map(((e,t)=>Vv(e,a[t],n))).join(", ")+", ..., "+i.map(((e,t)=>Vv(e,a[s-3+t],n))).join(", ")+"]"]}return["["+("complex64"===n?Xv(e):Array.from(e)).map(((e,t)=>Vv(e,a[t],n))).join(", ")+"]"]}const u=t.slice(1),l=r.slice(1),f=r[0]*o,d=[];if(s>20){for(let t=0;t<3;t++){const r=t*f,i=r+f;d.push(...Yv(e.slice(r,i),u,n,l,a,!1))}d.push("...");for(let t=s-3;t<s;t++){const r=t*f,i=r+f;d.push(...Yv(e.slice(r,i),u,n,l,a,t===s-1))}}else for(let g=0;g<s;g++){const t=g*f,r=t+f;d.push(...Yv(e.slice(t,r),u,n,l,a,g===s-1))}const h=2===c?",":"";d[0]="["+(s>0?d[0]+h:"");for(let g=1;g<d.length-1;g++)d[g]=" "+d[g]+h;let p=",\n";for(let g=2;g<c;g++)p+="\n";return d[d.length-1]=" "+d[d.length-1]+"]"+(i?"":p),d}function Xv(e){const t=[];for(let n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}class qv{constructor(e,t,n){if(this.dtype=t,this.shape=e.slice(),this.size=ph(e),null!=n){const e=n.length;fh(e===this.size,(()=>"Length of values '".concat(e,"' does not match the size ")+"inferred by the shape '".concat(this.size,"'.")))}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||Mh(t,this.size),this.strides=Ah(e)}set(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),fh(n.length===this.rank,(()=>"The number of provided coordinates (".concat(n.length,") must ")+"match the rank (".concat(this.rank,")")));const a=this.locToIndex(n);this.values[a]=e}get(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];0===t.length&&(t=[0]);let r=0;for(const i of t){if(i<0||i>=this.shape[r]){const e="Requested out of range element at ".concat(t,". ")+"  Buffer shape=".concat(this.shape);throw new Error(e)}r++}let a=t[t.length-1];for(let i=0;i<t.length-1;++i)a+=this.strides[i]*t[i];return this.values[a]}locToIndex(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];let t=e[e.length-1];for(let n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}indexToLoc(e){if(0===this.rank)return[];if(1===this.rank)return[e];const t=new Array(this.shape.length);for(let n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return Kv().makeTensor(this.values,this.shape,this.dtype)}}let Kv=null,Qv=null,Jv=null;class Zv{constructor(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=ph(e),this.strides=Ah(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Qv.buffer(this.shape,this.dtype,e)}bufferSync(){return Qv.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return Dh(this.shape,e,"complex64"===this.dtype)}arraySync(){return Dh(this.shape,this.dataSync(),"complex64"===this.dtype)}async data(){this.throwIfDisposed();const e=Kv().read(this.dataId);if("string"===this.dtype){const t=await e;try{return t.map((e=>Fv(e)))}catch(u2){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),Kv().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=Kv().readSync(this.dataId);if("string"===this.dtype)try{return e.map((e=>Fv(e)))}catch(u2){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await Kv().read(this.dataId);return"string"===this.dtype?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),Kv().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Qv.print(this,e)}clone(){return this.throwIfDisposed(),Qv.clone(this)}toString(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Gv(this.dataSync(),this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Qv.cast(this,e)}variable(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return this.throwIfDisposed(),Kv().makeVariable(this,e,t,n)}}function $v(){return Qh("Tensor",(()=>Zv))}Object.defineProperty(Zv,Symbol.hasInstance,{value:e=>!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}),$v();class eb extends Zv{constructor(e,t,n,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=n}assign(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(e.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!gh(e.shape,this.shape))throw new Error("shape of the new value (".concat(e.shape,") and ")+"previous value (".concat(this.shape,") must match"));Kv().disposeTensor(this),this.dataId=e.dataId,Kv().incRef(this,null)}dispose(){Kv().disposeVariable(this),this.isDisposedInternal=!0}}var tb,nb,rb,ab,ib;Object.defineProperty(eb,Symbol.hasInstance,{value:e=>e instanceof Zv&&null!=e.assign&&e.assign instanceof Function}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(tb||(tb={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(nb||(nb={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(rb||(rb={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(ab||(ab={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(ib||(ib={}));const ob={float32:ab,int32:nb,bool:rb,complex64:ib};function sb(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast ".concat(e," with ").concat(t))}return ob[e][t]}function cb(e){return sb(e,"int32")}function ub(e){return null!=e&&"object"===typeof e&&"texture"in e&&e.texture instanceof WebGLTexture}function lb(e){return"undefined"!==typeof GPUBuffer&&null!=e&&"object"===typeof e&&"buffer"in e&&e.buffer instanceof GPUBuffer}function fb(e,t){if(e.dtype===t.dtype)return[e,t];const n=sb(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function db(e,t){return t.some((t=>t.id===e.id))}function hb(e){const t=[];return pb(e,t,new Set),t}function pb(e,t,n){if(null==e)return;if(e instanceof Zv)return void t.push(e);if(r=e,!Array.isArray(r)&&"object"!==typeof r)return;var r;const a=e;for(const i in a){const e=a[i];n.has(e)||(n.add(e),pb(e,t,n))}}function gb(e){return null!=e.kernelName}class mb{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((e=>e.name))))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class vb{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new mb}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then((()=>{}));if(null!=this.backendInstance)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const n=e[t];if(await this.initializeBackend(n).success)return void await this.setBackend(n)}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error("The highest priority backend '".concat(e,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;{const{asyncInit:t}=this.initializeBackend(e);if(t)return null}}return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e in this.registryFactory?(cv("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}async setBackend(e){if(null==this.registryFactory[e])throw new Error("Backend name '".concat(e,"' not found in registry"));if(this.backendName=e,null==this.registry[e]){this.backendInstance=null;const{success:t,asyncInit:n}=this.initializeBackend(e);if(!(n?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Bv(this.backendInstance),!0}setupRegisteredKernels(){pv(this.backendName).forEach((e=>{null!=e.setupFunc&&e.setupFunc(this.backendInstance)}))}disposeRegisteredKernels(e){pv(e).forEach((t=>{null!=t.disposeFunc&&t.disposeFunc(this.registry[e])}))}initializeBackend(e){const t=this.registryFactory[e];if(null==t)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{const n=t.factory();if(!n||n instanceof ih||"function"!==typeof n.then)return this.registry[e]=n,{success:!0,asyncInit:!1};{const t=++this.pendingBackendInitId,r=n.then((n=>!(t<this.pendingBackendInitId)&&(this.registry[e]=n,this.pendingBackendInit=null,!0))).catch((n=>(t<this.pendingBackendInitId||(this.pendingBackendInit=null,cv("Initialization of backend ".concat(e," failed")),cv(n.stack||n.message)),!1)));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}}catch(upe){return cv("Initialization of backend ".concat(e," failed")),cv(upe.stack||upe.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority))}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const n=e[t],{success:r,asyncInit:a}=this.initializeBackend(n);if(a||r)return{name:n,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t),i=r.refCount(t);r.disposeData(t,!0),n.backend=e,e.move(t,a,n.shape,n.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let n,r=null;if(null==t){if("function"!==typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!==typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!==typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=e}return this.scopedRun((()=>this.startScope(r)),(()=>this.endScope(n)),(()=>(n=t(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n)))}scopedRun(e,t,n){e();try{const e=n();return t(),e}catch(r){throw t(),r}}nextTensorId(){return vb.nextTensorId++}nextVariableId(){return vb.nextVariableId++}clone(e){const t=yb.runKernel(dg,{x:e}),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(e=>({x:()=>{const t={x:e},n={dtype:"float32"};return yb.runKernel(xp,t,n)}})),[],{}),t}runKernel(e,t,n){null==this.backendName&&this.backend;if(!(null!=dv(e,this.backendName)))throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,n){const r=this.backend.numDataIds();let a=0;n.forEach((e=>{a+="complex64"===e.dtype?3:1}));const i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-a-i;if(o>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(o," data ids) after running '").concat(e,"'"))}runKernelFunc(e){let t,n=[];const r=this.isTapeOn(),a=this.state.numBytes,i=this.state.numTensors;let o,s;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;const c=gb(e)?e.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(gb(e)){const{kernelName:t,inputs:a,attrs:i}=e;null==this.backendName&&this.backend;const c=dv(t,this.backendName);fh(null!=c,(()=>"Cannot find registered kernel '".concat(t,"' for backend '").concat(this.backendName,"'"))),o=()=>{const e=this.backend.numDataIds();s=c.kernelFunc({inputs:a,attrs:i,backend:this.backend});const o=Array.isArray(s)?s:[s];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(t,e,o);const u=o.map((e=>null!=e.rank?e:this.makeTensorFromTensorInfo(e)));if(r){const e=this.getTensorsForGradient(t,a,u);n=this.saveTensorsForBackwardMode(e)}return u}}else{const{forwardFunc:t}=e,a=e=>{r&&(n=e.map((e=>this.keep(this.clone(e)))))};o=()=>{const e=this.backend.numDataIds();s=this.tidy((()=>t(this.backend,a)));const n=Array.isArray(s)?s:[s];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(c,e,n),n}}const{inputs:u,attrs:l}=e,f=gb(e)?null:e.backwardsFunc;let d;return this.scopedRun((()=>this.state.kernelDepth++),(()=>this.state.kernelDepth--),(()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(d=this.profiler.profileKernel(c,u,(()=>o())),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(d),t=d.outputs):t=o()})),r&&this.addTapeNode(c,u,t,f,n,l),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-a,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-i,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(u).map((e=>null!=u[e]?u[e].shape:null)),outputShapes:t.map((e=>e.shape)),kernelTimeMs:d.timeMs,extraInfo:d.extraInfo}),Array.isArray(s)?t:t[0]}saveTensorsForBackwardMode(e){return e.map((e=>this.keep(this.clone(e))))}getTensorsForGradient(e,t,n){const r=hv(e);if(null!=r){const e=r.inputsToSave||[],a=r.outputsToSave||[];let i;r.saveAllInputs?(fh(Array.isArray(t),(()=>"saveAllInputs is true, expected inputs to be an array.")),i=Object.keys(t).map((e=>t[e]))):i=e.map((e=>t[e]));const o=n.filter(((e,t)=>a[t]));return i.concat(o)}return[]}makeTensor(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;let a=e;"string"===n&&Th(e[0])&&(a=e.map((e=>Pv(e))));const i=r.write(a,t,n),o=new Zv(t,n,i,this.nextTensorId());if(this.trackTensor(o,r),"string"===n){const e=this.state.tensorInfo.get(i),t=function(e){if(null==e)return 0;let t=0;return e.forEach((e=>t+=e.length)),t}(a);this.state.numBytes+=t-e.bytes,e.bytes=t}return o}makeTensorFromDataId(e,t,n,r){const a={dataId:e,shape:t,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(a,r)}makeTensorFromTensorInfo(e,t){const{dataId:n,shape:r,dtype:a}=e,i=new Zv(r,a,n,this.nextTensorId());return this.trackTensor(i,t),i}makeVariable(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));const a=new eb(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name ".concat(a.name," was already registered"));return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}trackTensor(e,t){this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++;let n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*Eh(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof eb||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,"string"===e.dtype&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),"complex64"!==e.dtype&&"string"!==e.dtype){const t=e.size*Eh(e.dtype);this.state.numBytes-=t}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map((e=>e.totalBytesSnapshot))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(e,t,n,r,a,i){const o={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},s=hv(e);null!=s&&(r=s.gradFunc),null!=r&&(o.gradient=e=>(e=e.map(((e,t)=>{if(null==e){const e=n[t],r=Ph(e.size,e.dtype);return this.makeTensor(r,e.shape,e.dtype)}return e})),r(e.length>1?e:e[0],a,i))),this.state.activeTape.push(o)}keep(e){return e.kept=!0,e}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=hb(e),n=new Set(t.map((e=>e.id)));for(let a=0;a<this.state.activeScope.track.length;a++){const e=this.state.activeScope.track[a];e.kept||n.has(e.id)||e.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach((e=>{e.kept||e.scopeId!==r.id||this.track(e)}))}gradients(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(fh(t.length>0,(()=>"gradients() received an empty list of xs.")),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));const a=this.scopedRun((()=>this.startTape()),(()=>this.endTape()),(()=>this.tidy("forward",e)));fh(a instanceof Zv,(()=>"The result y returned by f() must be a tensor."));const i=function(e,t,n){const r={},a={};for(let c=0;c<t.length;c++)r[t[c].id]=!0;for(let c=0;c<e.length;c++){const n=e[c],i=n.inputs;for(const e in i){const o=i[e];let s=!1;for(let e=0;e<t.length;e++)if(r[o.id]){n.outputs.forEach((e=>r[e.id]=!0)),s=!0,a[n.id]=!0;break}if(s)break}}const i={};i[n.id]=!0;const o={};for(let c=e.length-1;c>=0;c--){const t=e[c],n=t.inputs;for(let e=0;e<t.outputs.length;e++)if(i[t.outputs[e].id]){for(const e in n)i[n[e].id]=!0,o[t.id]=!0;break}}const s=[];for(let c=0;c<e.length;c++){const t=e[c];if(a[t.id]&&o[t.id]){const e={};for(const a in t.inputs){const n=t.inputs[a];r[n.id]&&(e[a]=n)}const n=Object.assign({},t);n.inputs=e,n.outputs=t.outputs,s.push(n)}}return s}(this.state.activeTape,t,a);if(!r&&0===i.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(()=>{const e={};e[a.id]=null==n?function(e){const t=Oh(ph(e),"float32");return yb.makeTensor(t,e,"float32")}(a.shape):n,function(e,t,n,r){for(let a=t.length-1;a>=0;a--){const i=t[a],o=[];if(i.outputs.forEach((t=>{const n=e[t.id];null!=n?o.push(n):o.push(null)})),null==i.gradient)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(i.kernelName,"."));const s=i.gradient(o);for(const t in i.inputs){if(!(t in s))throw new Error("Cannot backprop through input ".concat(t,". ")+"Available gradients found: ".concat(Object.keys(s),"."));const a=n((()=>s[t]()));if("float32"!==a.dtype)throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input ")+"".concat(t," must have 'float32' dtype, but has '").concat(a.dtype,"'"));const o=i.inputs[t];if(!gh(a.shape,o.shape))throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input ")+"'".concat(t,"' has shape '").concat(a.shape,"', which does not match ")+"the shape of the input '".concat(o.shape,"'"));if(null==e[o.id])e[o.id]=a;else{const t=e[o.id];e[o.id]=r(t,a),t.dispose()}}}}(e,i,(e=>this.tidy(e)),xb);const r=t.map((t=>e[t.id]));return 0===this.state.gradientDepth&&(this.state.activeTape.forEach((e=>{for(const t of e.saved)t.dispose()})),this.state.activeTape=null),{value:a,grads:r}}))}customGrad(e){var t=this;return fh(Nh(e),(()=>"The f passed in customGrad(f) must be a function.")),function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];let i;fh(r.every((e=>e instanceof Zv)),(()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors"));const o={};r.forEach(((e,t)=>{o[t]=e}));return t.runKernelFunc({forwardFunc:(t,n)=>(i=e(...r,n),fh(i.value instanceof Zv,(()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor")),fh(Nh(i.gradFunc),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function.")),i.value),backwardsFunc:(e,t)=>{const n=i.gradFunc(e,t),a=Array.isArray(n)?n:[n];fh(a.length===r.length,(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...).")),fh(a.every((e=>e instanceof Zv)),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."));const o={};return a.forEach(((e,t)=>{o[t]=()=>e})),o},inputs:o})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=Ov(),n=await this.backend.time(e);return n.wallMs=Ov()-t,n}track(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new mb;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function bb(){const e=Kh();if(null==e._tfengine){const t=new Gh(e);e._tfengine=new vb(t)}return function(e){Yh=e}(e._tfengine.ENV),function(e){Kv=e}((()=>e._tfengine)),e._tfengine}vb.nextTensorId=0,vb.nextVariableId=0;const yb=bb();function xb(e,t){const n={a:e,b:t};return yb.runKernel(ep,n)}let wb;function Sb(e){if(void 0!==wb)return wb;if(e||"undefined"!==typeof navigator&&null!=navigator){if(e||(e=navigator),"ReactNative"===e.product)return!0;const t=e.userAgent||e.vendor||("undefined"!==typeof window?window.opera:"");if(!t){const t=e;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function Cb(){return"undefined"!==typeof window&&null!=window.document||"undefined"!==typeof WorkerGlobalScope}var Mb=n(2285);const _b=Hh();function Eb(e,t){let n=e;if(zv(e))return"string"===t?[]:[e.length];if(ub(e)){const t=e.channels||"RGBA";return[e.height,e.width*t.length]}if(lb(e))return[e.buffer.size/(null==t?4:Eh(t))];if(!Array.isArray(e))return[];const r=[];for(;Array.isArray(n)||zv(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&Hh().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&Tb(e,r,[]),r}function Tb(e,t,n){if(n=n||[],!Array.isArray(e)&&!zv(e))return void fh(0===t.length,(()=>"Element arr[".concat(n.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(t[0]," elements")));fh(t.length>0,(()=>"Element arr[".concat(n.join("]["),"] should be a primitive, ")+"but is an array of ".concat(e.length," elements"))),fh(e.length===t[0],(()=>"Element arr[".concat(n.join("]["),"] should have ").concat(t[0]," ")+"elements, but has ".concat(e.length," elements")));const r=t.slice(1);for(let a=0;a<e.length;++a)Tb(e[a],r,n.concat(a))}function Ib(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error("Argument '".concat(n,"' passed to '").concat(r,"' must ")+"be ".concat(e," tensor, but got ").concat(t," tensor"))}}function kb(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(e instanceof $v())return Ib(r,e.dtype,t,n),e;let a=kh(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),Ib(r,a,t,n),null==e||!zv(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e){const r=null==e?"null":e.constructor.name;throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must be a ")+"Tensor or TensorLike, but got '".concat(r,"'"))}const i=Eb(e,a);zv(e)||Array.isArray(e)||(e=[e]);const o="string"!==a?Dv(e,a):jv(e,[],!0);return yb.makeTensor(o,i,a)}function Nb(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(!Array.isArray(e))throw new Error("Argument ".concat(t," passed to ").concat(n," must be a ")+"`Tensor[]` or `TensorLike[]`");return e.map(((e,a)=>kb(e,"".concat(t,"[").concat(a,"]"),n,r)))}_b.registerFlag("DEBUG",(()=>!1),(e=>{e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),_b.registerFlag("IS_BROWSER",(()=>Cb())),_b.registerFlag("IS_NODE",(()=>"undefined"!==typeof Mb&&"undefined"!==typeof Mb.versions&&"undefined"!==typeof Mb.versions.node)),_b.registerFlag("IS_CHROME",(()=>"undefined"!==typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))),_b.registerFlag("IS_SAFARI",(()=>"undefined"!==typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor))),_b.registerFlag("PROD",(()=>!1)),_b.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(()=>_b.getBool("DEBUG"))),_b.registerFlag("DEPRECATION_WARNINGS_ENABLED",(()=>!0)),_b.registerFlag("IS_TEST",(()=>!1)),_b.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(()=>_b.getBool("DEBUG"))),_b.registerFlag("WRAP_TO_IMAGEBITMAP",(()=>!1)),_b.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",(()=>!1)),_b.registerFlag("USE_SETTIMEOUTCUSTOM",(()=>!1));function Lb(e){const t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(t.length," keys."));let n=t[0];const r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";const a=function(){yb.startScope(n);try{const e=r(...arguments);return Uh(e)&&console.error("Cannot return a Promise inside of tidy."),yb.endScope(e),e}catch(e){throw yb.endScope(null),e}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}const Ab=Lb({complex_:function(e,t){const n=kb(e,"real","complex"),r=kb(t,"imag","complex");dh(n.shape,r.shape,"real and imag shapes, ".concat(n.shape," and ").concat(r.shape,", ")+"must match in call to tf.complex().");const a={real:n,imag:r};return yb.runKernel(Cp,a)}});function Rb(e,t,n,r){if(null==r)r=kh(e);else if("complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(lb(e)||ub(e)){if("float32"!==r&&"int32"!==r)throw new Error("Creating tensor from GPU data only supports "+"'float32'|'int32' dtype, while the dtype is ".concat(r,"."));return yb.backend.createTensorFromGPUData(e,t||n,r)}if(!zv(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){zh(t);const e=ph(t),r=ph(n);fh(e===r,(()=>"Based on the provided shape, [".concat(t,"], the tensor should have ")+"".concat(e," values but has ").concat(r)));for(let a=0;a<n.length;++a){const e=n[a],r=a!==n.length-1||e!==ph(t.slice(a));fh(n[a]===t[a]||!r,(()=>"Error creating a new Tensor. Inferred shape "+"(".concat(n,") does not match the provided ")+"shape (".concat(t,"). ")))}}return zv(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?Dv(e,r):jv(e,[],!0),yb.makeTensor(e,t,r)}function Db(e,t,n){return Rb(e,t,Eb(e,n),n)}class Ob{static join(e){return new Ob(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,null==e)return;if(e instanceof Array||(e=[e]),0===(e=e.map((e=>zv(e)?e.buffer:e))).length)return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let n=0;n<e.length;n++){const r=e[n];n!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const a=t+r.byteLength;this.shards.push({buffer:r,start:t,end:a}),t=a}0===this.shards.length&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.byteLength;if(0===this.shards.length)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const n=this.findShardForByte(e);if(-1===n)throw new Error("Could not find start shard for byte ".concat(e));const r=new ArrayBuffer(t-e),a=new Uint8Array(r);let i=0;for(let o=n;o<this.shards.length;o++){const n=this.shards[o],r=e+i-n.start,s=i,c=Math.min(t,n.end)-n.start,u=new Uint8Array(n.buffer,r,c-r);if(a.set(u,s),i+=u.length,t<n.end)break}return r}findShardForByte(e){if(0===this.shards.length||e<0||e>=this.byteLength)return-1;if(null!=this.bufferUniformSize)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(t){return e<t.start?-1:e>=t.end?1:0}if(0===t(this.shards[this.previousShardIndex]))return this.previousShardIndex;const n=function(e,t){let n=0,r=e.length;for(;n<=r;){const a=Math.floor((r-n)/2)+n,i=t(e[a]);if(0===i)return a;i<0?r=a:n=a+1}return-1}(this.shards,t);return-1===n?-1:(this.previousShardIndex=n,this.previousShardIndex)}}function Pb(){return yb}function Fb(){return yb.memory()}function zb(e,t){return yb.tidy(e,t)}function jb(e){hb(e).forEach((e=>e.dispose()))}function Bb(e){return yb.keep(e)}function Ub(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return yb.registerBackend(e,t,n)}function Wb(){return yb.backend}!function(e){Jv=e}((function(e){Hh().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}));var Gb=n(6382).Buffer;async function Vb(e,t){const n=[],r=[],a=Array.isArray(e)?e.map((e=>e.name)):Object.keys(e);for(let i=0;i<a.length;++i){const o=a[i],s=Array.isArray(e)?e[i].tensor:e[o];if("float32"!==s.dtype&&"int32"!==s.dtype&&"bool"!==s.dtype&&"string"!==s.dtype&&"complex64"!==s.dtype)throw new Error("Unsupported dtype in weight '".concat(o,"': ").concat(s.dtype));const c={name:o,shape:s.shape,dtype:s.dtype};if("string"===s.dtype){const e=new Promise((async e=>{const t=await s.bytes(),n=t.reduce(((e,t)=>e+t.length),0)+4*t.length,r=new Uint8Array(n);let a=0;for(let i=0;i<t.length;i++){const e=t[i],n=new Uint8Array(new Uint32Array([e.length]).buffer);r.set(n,a),a+=4,r.set(e,a),a+=e.length}e(r)}));r.push(e)}else r.push(s.data());null!=t&&(c.group=t),n.push(c)}return{data:Hb(await Promise.all(r)),specs:n}}function Hb(e){if(null===e)throw new Error("Invalid input value: ".concat(JSON.stringify(e)));let t=0;const n=[];e.forEach((e=>{if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: ".concat(e.constructor.name))}));const r=new Uint8Array(t);let a=0;return n.forEach((e=>{r.set(new Uint8Array(e.buffer),a),a+=e.byteLength})),r.buffer}const Yb="undefined"!==typeof Gb&&("undefined"===typeof Blob||"undefined"===typeof atob||"undefined"===typeof btoa);function Xb(e){return Yb?Gb.byteLength(e,"utf8"):new Blob([e]).size}function qb(e,t){const n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(n.initializerSignature=e.initializerSignature),null!=e.trainingConfig&&(n.trainingConfig=e.trainingConfig),n}async function Kb(e,t){let n,r;return null!=e.weightsManifest&&([n,r]=await t(e.weightsManifest)),function(e,t,n){const r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};if(null!=e.trainingConfig&&(r.trainingConfig=e.trainingConfig),null!=e.weightsManifest){if(!t)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=t,r.weightData=n}return null!=e.signature&&(r.signature=e.signature),null!=e.userDefinedMetadata&&(r.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(r.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(r.initializerSignature=e.initializerSignature),r}(e,n,r)}function Qb(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:Xb(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:Xb(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:new Ob(e.weightData).byteLength}}function Jb(e){const t=[];for(const n of e)t.push(...n.weights);return t}class Zb{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==Zb.instance&&(Zb.instance=new Zb),Zb.instance}static registerSaveRouter(e){Zb.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Zb.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Zb.getHandlers(e,"save")}static getLoadHandlers(e,t){return Zb.getHandlers(e,"load",t)}static getHandlers(e,t,n){const r=[];return("load"===t?Zb.getInstance().loadRouters:Zb.getInstance().saveRouters).forEach((t=>{const a=t(e,n);null!==a&&r.push(a)})),r}}const $b="tensorflowjs",ey="models_store",ty="model_info_store";function ny(){if(!Hh().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const e="undefined"===typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function ry(e){const t=e.result;t.createObjectStore(ey,{keyPath:"modelPath"}),t.createObjectStore(ty,{keyPath:"modelPath"})}class ay{constructor(e){if(this.indexedDB=ny(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise(((e,n)=>{const r=this.indexedDB.open($b,1);r.onupgradeneeded=()=>ry(r),r.onsuccess=()=>{const a=r.result;if(null==t){const t=a.transaction(ey,"readonly"),r=t.objectStore(ey).get(this.modelPath);r.onsuccess=()=>{if(null==r.result)return a.close(),n(new Error("Cannot find model with path '".concat(this.modelPath,"' ")+"in IndexedDB."));e(r.result.modelArtifacts)},r.onerror=e=>(a.close(),n(r.error)),t.oncomplete=()=>a.close()}else{t.weightData=Ob.join(t.weightData);const r=Qb(t),o=a.transaction(ty,"readwrite");let s,c,u=o.objectStore(ty);try{s=u.put({modelPath:this.modelPath,modelArtifactsInfo:r})}catch(i){return n(i)}s.onsuccess=()=>{c=a.transaction(ey,"readwrite");const s=c.objectStore(ey);let l;try{l=s.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:r})}catch(i){return n(i)}l.onsuccess=()=>e({modelArtifactsInfo:r}),l.onerror=e=>{u=o.objectStore(ty);const t=u.delete(this.modelPath);t.onsuccess=()=>(a.close(),n(l.error)),t.onerror=e=>(a.close(),n(l.error))}},s.onerror=e=>(a.close(),n(s.error)),o.oncomplete=()=>{null==c?a.close():c.oncomplete=()=>a.close()}}},r.onerror=e=>n(r.error)}))}}ay.URL_SCHEME="indexeddb://";const iy=e=>{return Hh().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(ay.URL_SCHEME)?(t=e.slice(ay.URL_SCHEME.length),new ay(t)):null;var t};Zb.registerSaveRouter(iy),Zb.registerLoadRouter(iy);class oy{constructor(){this.indexedDB=ny()}async listModels(){return new Promise(((e,t)=>{const n=this.indexedDB.open($b,1);n.onupgradeneeded=()=>ry(n),n.onsuccess=()=>{const r=n.result,a=r.transaction(ty,"readonly"),i=a.objectStore(ty).getAll();i.onsuccess=()=>{const t={};for(const e of i.result)t[e.modelPath]=e.modelArtifactsInfo;e(t)},i.onerror=e=>(r.close(),t(i.error)),a.oncomplete=()=>r.close()},n.onerror=e=>t(n.error)}))}async removeModel(e){var t;return e=(t=e).startsWith(ay.URL_SCHEME)?t.slice(ay.URL_SCHEME.length):t,new Promise(((t,n)=>{const r=this.indexedDB.open($b,1);r.onupgradeneeded=()=>ry(r),r.onsuccess=()=>{const a=r.result,i=a.transaction(ty,"readwrite"),o=i.objectStore(ty),s=o.get(e);let c;s.onsuccess=()=>{if(null==s.result)return a.close(),n(new Error("Cannot find model with path '".concat(e,"' ")+"in IndexedDB."));{const r=o.delete(e),i=()=>{c=a.transaction(ey,"readwrite");const r=c.objectStore(ey).delete(e);r.onsuccess=()=>t(s.result.modelArtifactsInfo),r.onerror=e=>n(s.error)};r.onsuccess=i,r.onerror=e=>(i(),a.close(),n(s.error))}},s.onerror=e=>(a.close(),n(s.error)),i.oncomplete=()=>{null==c?a.close():c.oncomplete=()=>a.close()}},r.onerror=e=>n(r.error)}))}}const sy="/",cy="tensorflowjs_models",uy="info",ly="model_topology",fy="weight_specs",dy="weight_data",hy="model_metadata";function py(e){return{info:[cy,e,uy].join(sy),topology:[cy,e,ly].join(sy),weightSpecs:[cy,e,fy].join(sy),weightData:[cy,e,dy].join(sy),modelMetadata:[cy,e,hy].join(sy)}}function gy(e){for(const t of Object.values(e))window.localStorage.removeItem(t)}function my(e){const t=e.split(sy);if(t.length<3)throw new Error("Invalid key format: ".concat(e));return t.slice(1,t.length-1).join(sy)}class vy{constructor(e){if(!Hh().getBool("IS_BROWSER")||"undefined"===typeof window||"undefined"===typeof window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=py(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),r=Qb(e),a=Ob.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(e){if(Yb)return Gb.from(e).toString("base64");const t=new Uint8Array(e);let n="";for(let r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}(a));const i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:null!=e.signature?e.signature:void 0,userDefinedMetadata:null!=e.userDefinedMetadata?e.userDefinedMetadata:void 0,modelInitializer:null!=e.modelInitializer?e.modelInitializer:void 0,initializerSignature:null!=e.initializerSignature?e.initializerSignature:void 0,trainingConfig:null!=e.trainingConfig?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:r}}catch(upe){throw gy(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: ")+"size quota being exceeded is a possible cause of this failure: "+"modelTopologyBytes=".concat(r.modelTopologyBytes,", ")+"weightSpecsBytes=".concat(r.weightSpecsBytes,", ")+"weightDataBytes=".concat(r.weightDataBytes,"."))}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(null==e)throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' ")+"is missing.");t.modelTopology=n;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==r)throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' ")+"are missing.");t.weightSpecs=r;const a=this.LS.getItem(this.keys.modelMetadata);if(null!=a){const e=JSON.parse(a);t.format=e.format,t.generatedBy=e.generatedBy,t.convertedBy=e.convertedBy,null!=e.signature&&(t.signature=e.signature),null!=e.userDefinedMetadata&&(t.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(t.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(t.initializerSignature=e.initializerSignature),null!=e.trainingConfig&&(t.trainingConfig=e.trainingConfig)}const i=this.LS.getItem(this.keys.weightData);if(null==i)throw new Error("In local storage, the binary weight values of model "+"'".concat(this.modelPath,"' are missing."));return t.weightData=function(e){if(Yb){const t=Gb.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}const t=atob(e),n=new Uint8Array(t.length);for(let r=0;r<t.length;++r)n.set([t.charCodeAt(r)],r);return n.buffer}(i),t}}vy.URL_SCHEME="localstorage://";const by=e=>{return Hh().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(vy.URL_SCHEME)?(t=e.slice(vy.URL_SCHEME.length),new vy(t)):null;var t};Zb.registerSaveRouter(by),Zb.registerLoadRouter(by);class yy{constructor(){fh(Hh().getBool("IS_BROWSER"),(()=>"Current environment is not a web browser")),fh("undefined"===typeof window||"undefined"!==typeof window.localStorage,(()=>"Current browser does not appear to support localStorage")),this.LS=window.localStorage}async listModels(){const e={},t=cy+sy,n=sy+uy;for(let r=0;r<this.LS.length;++r){const a=this.LS.key(r);if(a.startsWith(t)&&a.endsWith(n)){e[my(a)]=JSON.parse(this.LS.getItem(a))}}return e}async removeModel(e){var t;const n=py(e=(t=e).startsWith(vy.URL_SCHEME)?t.slice(vy.URL_SCHEME.length):t);if(null==this.LS.getItem(n.info))throw new Error("Cannot find model at path '".concat(e,"'"));const r=JSON.parse(this.LS.getItem(n.info));return gy(n),r}}const xy="://";class wy{constructor(){this.managers={}}static getInstance(){return null==wy.instance&&(wy.instance=new wy),wy.instance}static registerManager(e,t){fh(null!=e,(()=>"scheme must not be undefined or null.")),e.endsWith(xy)&&(e=e.slice(0,e.indexOf(xy))),fh(e.length>0,(()=>"scheme must not be an empty string."));const n=wy.getInstance();fh(null==n.managers[e],(()=>"A model store manager is already registered for scheme '".concat(e,"'."))),n.managers[e]=t}static getManager(e){const t=wy.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '".concat(e,"'"));return t}static getSchemes(){return Object.keys(wy.getInstance().managers)}}class Sy{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){"undefined"!==typeof window&&Hh().getBool("USE_SETTIMEOUTCUSTOM")?(this.functionRefs.push(e),setTimeout((()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")}),t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",(e=>{if(e.source===window&&e.data.name===this.messageName){e.stopPropagation();(0,this.functionRefs[e.data.index])(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}}),!0))):setTimeout(e,t)}isTypedArray(e){return bv(e)}}if(Hh().get("IS_BROWSER")){Hh().setPlatform("browser",new Sy);try{wy.registerManager(vy.URL_SCHEME,new yy)}catch(upe){}try{wy.registerManager(ay.URL_SCHEME,new oy)}catch(upe){}}var Cy=n(2285);const My=()=>n(5817);let _y;class Ey{constructor(){this.util=n(8590),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return null!=Hh().global.fetch?Hh().global.fetch(e,t):(null==_y&&(_y=My()),_y(e,t))}now(){const e=Cy.hrtime();return 1e3*e[0]+e[1]/1e6}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)}decode(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}function Ty(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2?arguments[2]:void 0;return t=t||"float32",zh(e),new qv(e,t,n)}Hh().get("IS_NODE")&&!Hh().get("IS_BROWSER")&&Hh().setPlatform("node",new Ey);const Iy=Lb({cast_:function(e,t){const n=kb(e,"x","cast");if(!function(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}(t))throw new Error("Failed to cast to unknown dtype ".concat(t));if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");const r={x:n},a={dtype:t};return yb.runKernel(xp,r,a)}});const ky=Lb({clone_:function(e){const t={x:kb(e,"x","clone","string_or_numeric")};return yb.runKernel(dg,t)}});bb();const Ny={buffer:Ty,cast:Iy,clone:ky,print:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e.toString(t))}};Qv=Ny;const Ly=Lb({add_:function(e,t){let n=kb(e,"a","add"),r=kb(t,"b","add");[n,r]=fb(n,r);const a={a:n,b:r};return yb.runKernel(ep,a)}});const Ay=Lb({floorDiv_:function(e,t){let n=kb(e,"a","floorDiv"),r=kb(t,"b","floorDiv");[n,r]=fb(n,r);const a={a:n,b:r};return yb.runKernel(og,a)}});const Ry=Lb({div_:function(e,t){let n=kb(e,"a","div"),r=kb(t,"b","div");if([n,r]=fb(n,r),"int32"===n.dtype&&"int32"===r.dtype)return Ay(n,r);const a={a:n,b:r};return yb.runKernel(Xp,a,{})}});const Dy=Lb({mul_:function(e,t){let n=kb(e,"a","mul"),r=kb(t,"b","mul");[n,r]=fb(n,r);const a={a:n,b:r};return yb.runKernel(Wg,a)}});const Oy=Lb({sqrt_:function(e){const t={x:kb(e,"x","sqrt","float32")};return yb.runKernel(Im,t)}});const Py=Lb({square_:function(e){const t=kb(e,"x","square");return yb.runKernel("Square",{x:t},{})}});const Fy=Lb({zerosLike_:function(e){const t={x:kb(e,"x","zerosLike")};return yb.runKernel(tv,t)}});function zy(e){return yb.customGrad(e)}function jy(e,t){if((zv(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&zv(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Rb(e,[],[],t)}const By=new Map,Uy=new Map;class Wy{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class Gy{constructor(){this.classNameMap={}}static getMap(){return null==Gy.instance&&(Gy.instance=new Gy),Gy.instance}static register(e){Gy.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function Vy(e,t,n){fh(null!=e.className,(()=>"Class being registered does not have the static className property defined.")),fh("string"===typeof e.className,(()=>"className is required to be a string, but got type "+typeof e.className)),fh(e.className.length>0,(()=>"Class being registered has an empty-string as its className, which is disallowed.")),"undefined"===typeof t&&(t="Custom"),"undefined"===typeof n&&(n=e.className);const r=t+">"+n;return Gy.register(e),By.set(r,e),Uy.set(e,r),e}class Hy extends Wy{minimize(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;const{value:r,grads:a}=this.computeGradients(e,n);if(null!=n){const e=n.map((e=>({name:e.name,tensor:a[e.name]})));this.applyGradients(e)}else this.applyGradients(a);return jb(a),t?r:(r.dispose(),null)}get iterations(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return function(e,t){fh(Nh(e),(()=>"The f passed in variableGrads(f) must be a function")),fh(null==t||Array.isArray(t)&&t.every((e=>e instanceof eb)),(()=>"The varList passed in variableGrads(f, varList) must be an array of variables"));const n=null!=t;if(!n){t=[];for(const e in yb.registeredVariables)t.push(yb.registeredVariables[e])}const r=n?t.filter((e=>!e.trainable)):null,a=t.length;t=t.filter((e=>e.trainable)),fh(t.length>0,(()=>"variableGrads() expects at least one of the input variables to "+"be trainable, but none of the ".concat(a," variables is ")+"trainable."));const{value:i,grads:o}=yb.gradients(e,t,null,!0);fh(o.some((e=>null!=e)),(()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize().")),fh(0===i.rank,(()=>"The f passed in variableGrads(f) must return a scalar, but it "+"returned a rank-".concat(i.rank," tensor")));const s={};return t.forEach(((e,t)=>{null!=o[t]&&(s[e.name]=o[t])})),null!=r&&r.forEach((e=>s[e.name]=null)),{value:i,grads:s}}(e,t)}dispose(){null!=this.iterations_&&jb(this.iterations_)}async saveIterations(){return null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:jy(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for this optimizer class "+"".concat(this.getClassName()))}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(Hy,Symbol.hasInstance,{value:e=>null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients});class Yy extends Hy{static get className(){return"Adadelta"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super(),this.learningRate=e,this.rho=t,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],null==n&&(this.epsilon=yb.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map((e=>e.name)):Object.keys(e)).forEach(((t,n)=>{const r=yb.registeredVariables[t],a=!1;null==this.accumulatedGrads[n]&&(this.accumulatedGrads[n]={originalName:"".concat(t,"/accum_grad"),variable:zb((()=>Fy(r).variable(a)))}),null==this.accumulatedUpdates[n]&&(this.accumulatedUpdates[n]={originalName:"".concat(t,"/accum_var"),variable:zb((()=>Fy(r).variable(a)))});const i=Array.isArray(e)?e[n].tensor:e[t];if(null==i)return;const o=this.accumulatedGrads[n].variable,s=this.accumulatedUpdates[n].variable;zb((()=>{const e=Ly(Dy(o,this.rho),Dy(Py(i),1-this.rho)),t=Dy(Ry(Oy(Ly(s,this.epsilon)),Oy(Ly(o,this.epsilon))),i),n=Ly(Dy(s,this.rho),Dy(Py(t),1-this.rho));o.assign(e),s.assign(n);const a=Ly(Dy(t,-this.learningRate),r);r.assign(a)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedUpdates&&(jb(this.accumulatedGrads.map((e=>e.variable))),jb(this.accumulatedUpdates.map((e=>e.variable))))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map((e=>({name:e.originalName,tensor:e.variable}))))}async setWeights(e){const t=(e=await this.extractIterations(e)).length/2,n=!1;this.accumulatedGrads=e.slice(0,t).map((e=>({originalName:e.name,variable:e.tensor.variable(n)}))),this.accumulatedUpdates=e.slice(t,2*t).map((e=>({originalName:e.name,variable:e.tensor.variable(n)})))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}function Xy(e,t,n){zh(e);const r={shape:e,value:t,dtype:n=n||kh(t)};return yb.runKernel(rg,{},r)}class qy extends Hy{static get className(){return"Adagrad"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map((e=>e.name)):Object.keys(e)).forEach(((t,n)=>{const r=yb.registeredVariables[t];if(null==this.accumulatedGrads[n]){const e=!1;this.accumulatedGrads[n]={originalName:"".concat(t,"/accumulator"),variable:zb((()=>Xy(r.shape,this.initialAccumulatorValue).variable(e)))}}const a=Array.isArray(e)?e[n].tensor:e[t];if(null==a)return;const i=this.accumulatedGrads[n].variable;zb((()=>{const e=Ly(i,Py(a));i.assign(e);const t=Ly(Dy(Ry(a,Oy(Ly(e,yb.backend.epsilon()))),-this.learningRate),r);r.assign(t)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedGrads&&jb(this.accumulatedGrads.map((e=>e.variable)))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map((e=>({name:e.originalName,tensor:e.variable}))))}async setWeights(e){e=await this.extractIterations(e);this.accumulatedGrads=e.map((e=>({originalName:e.name,variable:e.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}const Ky=Lb({pow_:function(e,t){let n=kb(e,"base","pow"),r=kb(t,"exp","pow");[n,r]=fb(n,r);const a={a:n,b:r};return yb.runKernel(Zg,a)}});const Qy=Lb({sub_:function(e,t){let n=kb(e,"a","sub"),r=kb(t,"b","sub");[n,r]=fb(n,r);const a={a:n,b:r};return yb.runKernel(Hm,a)}});class Jy extends Hy{static get className(){return"Adam"}constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],zb((()=>{this.accBeta1=jy(t).variable(),this.accBeta2=jy(n).variable()})),null==r&&(this.epsilon=yb.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map((e=>e.name)):Object.keys(e);zb((()=>{const n=Qy(1,this.accBeta1),r=Qy(1,this.accBeta2);t.forEach(((t,a)=>{const i=yb.registeredVariables[t],o=!1;null==this.accumulatedFirstMoment[a]&&(this.accumulatedFirstMoment[a]={originalName:"".concat(t,"/m"),variable:zb((()=>Fy(i).variable(o)))}),null==this.accumulatedSecondMoment[a]&&(this.accumulatedSecondMoment[a]={originalName:"".concat(t,"/v"),variable:zb((()=>Fy(i).variable(o)))});const s=Array.isArray(e)?e[a].tensor:e[t];if(null==s)return;const c=this.accumulatedFirstMoment[a].variable,u=this.accumulatedSecondMoment[a].variable,l=Ly(Dy(c,this.beta1),Dy(s,1-this.beta1)),f=Ly(Dy(u,this.beta2),Dy(Py(s),1-this.beta2)),d=Ry(l,n),h=Ry(f,r);c.assign(l),u.assign(f);const p=Ly(Dy(Ry(d,Ly(Oy(h),this.epsilon)),-this.learningRate),i);i.assign(p)})),this.accBeta1.assign(Dy(this.accBeta1,this.beta1)),this.accBeta2.assign(Dy(this.accBeta2,this.beta2))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&jb(this.accumulatedFirstMoment.map((e=>e.variable))),null!=this.accumulatedSecondMoment&&jb(this.accumulatedSecondMoment.map((e=>e.variable)))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map((e=>({name:e.originalName,tensor:e.variable}))))}async setWeights(e){e=await this.extractIterations(e),zb((()=>{this.accBeta1.assign(Ky(this.beta1,this.iterations_+1)),this.accBeta2.assign(Ky(this.beta2,this.iterations_+1))}));const t=e.length/2,n=!1;this.accumulatedFirstMoment=e.slice(0,t).map((e=>({originalName:e.name,variable:e.tensor.variable(n)}))),this.accumulatedSecondMoment=e.slice(t,2*t).map((e=>({originalName:e.name,variable:e.tensor.variable(n)})))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}const Zy=Lb({abs_:function(e){const t=kb(e,"x","abs");if("complex64"===t.dtype){const e={x:t};return yb.runKernel(Mp,e)}{const e={x:t};return yb.runKernel(Jh,e)}}});function $y(e,t){const n=e.length,r=[];for(let a=0;a<n;a++){const i=n-1-a,o=e[i]||1;(t[t.length-1-a]||1)>1&&1===o&&r.unshift(i)}return r}function ex(e,t){const n=[];for(let r=0;r<t.length;r++){const a=e[e.length-r-1],i=t.length-r-1,o=t[i];(null==a||1===a&&o>1)&&n.unshift(i)}return n}function tx(e,t){const n=Math.max(e.length,t.length),r=new Array(n);for(let a=0;a<n;a++){let i=e[e.length-a-1];null==i&&(i=1);let o=t[t.length-a-1];if(null==o&&(o=1),1===i)r[n-a-1]=o;else if(1===o)r[n-a-1]=i;else{if(i!==o){const n="Operands could not be broadcast together with shapes "+"".concat(e," and ").concat(t,".");throw Error(n)}r[n-a-1]=i}}return r}const nx=Lb({maximum_:function(e,t){let n=kb(e,"a","maximum"),r=kb(t,"b","maximum");[n,r]=fb(n,r),"bool"===n.dtype&&(n=Iy(n,"int32"),r=Iy(r,"int32")),tx(n.shape,r.shape);const a={a:n,b:r};return yb.runKernel(Ng,a)}});class rx extends Hy{static get className(){return"Adamax"}constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=r,this.decay=a,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],zb((()=>{this.iteration=jy(0).variable(),this.accBeta1=jy(t).variable()})),null==r&&(this.epsilon=yb.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map((e=>e.name)):Object.keys(e);zb((()=>{const n=Qy(1,this.accBeta1),r=Ry(-this.learningRate,Ly(Dy(this.iteration,this.decay),1));t.forEach(((t,a)=>{const i=yb.registeredVariables[t],o=!1;null==this.accumulatedFirstMoment[a]&&(this.accumulatedFirstMoment[a]={originalName:"".concat(t,"/m"),variable:Fy(i).variable(o)}),null==this.accumulatedWeightedInfNorm[a]&&(this.accumulatedWeightedInfNorm[a]={originalName:"".concat(t,"/v"),variable:Fy(i).variable(o)});const s=Array.isArray(e)?e[a].tensor:e[t];if(null==s)return;const c=this.accumulatedFirstMoment[a].variable,u=this.accumulatedWeightedInfNorm[a].variable,l=Ly(Dy(c,this.beta1),Dy(s,1-this.beta1)),f=Dy(u,this.beta2),d=Zy(s),h=nx(f,d);c.assign(l),u.assign(h);const p=Ly(Dy(Ry(r,n),Ry(l,Ly(h,this.epsilon))),i);i.assign(p)})),this.iteration.assign(Ly(this.iteration,1)),this.accBeta1.assign(Dy(this.accBeta1,this.beta1))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&jb(this.accumulatedFirstMoment.map((e=>e.variable))),null!=this.accumulatedWeightedInfNorm&&jb(this.accumulatedWeightedInfNorm.map((e=>e.variable)))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}class ax extends Hy{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){const t=Array.isArray(e)?e.map((e=>e.name)):Object.keys(e);t.forEach(((t,n)=>{const r=Array.isArray(e)?e[n].tensor:e[t];if(null==r)return;const a=yb.registeredVariables[t];zb((()=>{const e=Ly(Dy(this.c,r),a);a.assign(e)}))})),this.incrementIterations()}setLearningRate(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=Bb(jy(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(0!==(e=await this.extractIterations(e)).length)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}class ix extends ax{static get className(){return"Momentum"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(e),this.learningRate=e,this.momentum=t,this.useNesterov=n,this.accumulations=[],this.m=jy(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map((e=>e.name)):Object.keys(e)).forEach(((t,n)=>{const r=yb.registeredVariables[t];if(null==this.accumulations[n]){const e=!1;this.accumulations[n]={originalName:"".concat(t,"/momentum"),variable:zb((()=>Fy(r).variable(e)))}}const a=this.accumulations[n].variable,i=Array.isArray(e)?e[n].tensor:e[t];null!=i&&zb((()=>{let e;const t=Ly(Dy(this.m,a),i);e=this.useNesterov?Ly(Dy(this.c,Ly(i,Dy(t,this.m))),r):Ly(Dy(this.c,t),r),a.assign(t),r.assign(e)}))})),this.incrementIterations()}dispose(){this.m.dispose(),null!=this.accumulations&&jb(this.accumulations.map((e=>e.variable)))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map((e=>({name:e.originalName,tensor:e.variable}))))}async setWeights(e){e=await this.extractIterations(e);this.accumulations=e.map((e=>({originalName:e.name,variable:e.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}class ox extends Hy{static get className(){return"RMSProp"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(),this.learningRate=e,this.decay=t,this.momentum=n,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=a,null==r&&(this.epsilon=yb.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map((e=>e.name)):Object.keys(e)).forEach(((t,n)=>{const r=yb.registeredVariables[t],a=!1;null==this.accumulatedMeanSquares[n]&&(this.accumulatedMeanSquares[n]={originalName:"".concat(t,"/rms"),variable:zb((()=>Fy(r).variable(a)))}),null==this.accumulatedMoments[n]&&(this.accumulatedMoments[n]={originalName:"".concat(t,"/momentum"),variable:zb((()=>Fy(r).variable(a)))}),null==this.accumulatedMeanGrads[n]&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:"".concat(t,"/mg"),variable:zb((()=>Fy(r).variable(a)))});const i=Array.isArray(e)?e[n].tensor:e[t];if(null==i)return;const o=this.accumulatedMeanSquares[n].variable,s=this.accumulatedMoments[n].variable;zb((()=>{const e=Ly(Dy(o,this.decay),Dy(Py(i),1-this.decay));if(this.centered){const t=this.accumulatedMeanGrads[n].variable,a=Ly(Dy(t,this.decay),Dy(i,1-this.decay)),c=Ry(Dy(i,this.learningRate),Oy(Qy(e,Ly(Py(a),this.epsilon)))),u=Ly(Dy(s,this.momentum),c);o.assign(e),t.assign(a),s.assign(u);const l=Qy(r,u);r.assign(l)}else{const e=Ly(Dy(o,this.decay),Dy(Py(i),1-this.decay)),t=Ly(Dy(s,this.momentum),Ry(Dy(i,this.learningRate),Oy(Ly(e,this.epsilon))));o.assign(e),s.assign(t);const n=Qy(r,t);r.assign(n)}}))})),this.incrementIterations()}dispose(){null!=this.accumulatedMeanSquares&&jb(this.accumulatedMeanSquares.map((e=>e.variable))),null!=this.accumulatedMeanGrads&&this.centered&&jb(this.accumulatedMeanGrads.map((e=>e.variable))),null!=this.accumulatedMoments&&jb(this.accumulatedMoments.map((e=>e.variable)))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map((e=>({name:e.originalName,tensor:e.variable}))))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,n=!1;this.accumulatedMeanSquares=e.slice(0,t).map((e=>({originalName:e.name,variable:e.tensor.variable(n)}))),this.accumulatedMoments=e.slice(t,2*t).map((e=>({originalName:e.name,variable:e.tensor.variable(n)}))),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map((e=>({originalName:e.name,variable:e.tensor.variable(n)}))))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}const sx=[Yy,qy,Jy,rx,ix,ox,ax];function cx(e){return new Promise((e=>setTimeout(e))).then(e)}class ux{constructor(e){if(!Hh().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(ux.URL_SCHEME)&&(e=e.slice(ux.URL_SCHEME.length)),null!=e&&0!==e.length||(e="model"),this.modelJsonFileName=e+".json",this.weightDataFileName=e+".weights.bin"}async save(e){if("undefined"===typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");const t=Ob.join(e.weightData),n=window.URL.createObjectURL(new Blob([t],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const t=qb(e,[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}]),r=window.URL.createObjectURL(new Blob([JSON.stringify(t)],{type:"application/json"})),a=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor;if(a.download=this.modelJsonFileName,a.href=r,await cx((()=>a.dispatchEvent(new MouseEvent("click")))),null!=e.weightData){const e=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor;e.download=this.weightDataFileName,e.href=n,await cx((()=>e.dispatchEvent(new MouseEvent("click"))))}return{modelArtifactsInfo:Qb(e)}}}}ux.URL_SCHEME="downloads://";function lx(e,t,n,r){!function(e){fh(null!=e&&Array.isArray(e)&&e.length>0,(()=>"promises must be a none empty array"))}(e),function(e,t){fh(e>=0&&e<=1,(()=>"Progress fraction must be in range [0, 1], but "+"got startFraction ".concat(e))),fh(t>=0&&t<=1,(()=>"Progress fraction must be in range [0, 1], but "+"got endFraction ".concat(t))),fh(t>=e,(()=>"startFraction must be no more than endFraction, but "+"got startFraction ".concat(e," and endFraction ")+"".concat(t)))}(n=null==n?0:n,r=null==r?1:r);let a=0;return Promise.all(e.map((i=>(i.then((i=>{const o=n+ ++a/e.length*(r-n);return t(o),i})),i))))}async function fx(e,t){null==t&&(t={});const n=null==t.fetchFunc?Hh().platform.fetch:t.fetchFunc,r=e.map((e=>n(e,t.requestInit,{isBinary:!0}))),a=(null==t.onProgress?await Promise.all(r):await lx(r,t.onProgress,0,.5)).map((e=>e.arrayBuffer()));return null==t.onProgress?await Promise.all(a):await lx(a,t.onProgress,.5,1)}Zb.registerSaveRouter((e=>Hh().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(ux.URL_SCHEME)?function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"model";return new ux(e)}(e.slice(ux.URL_SCHEME.length)):null));class dx{constructor(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,null!=t.fetchFunc?(fh("function"===typeof t.fetchFunc,(()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)")),this.fetch=t.fetchFunc):this.fetch=Hh().platform.fetch,fh(null!=e&&e.length>0,(()=>"URL path for http must not be null, undefined or empty.")),Array.isArray(e)&&fh(2===e.length,(()=>"URL paths for http must have a length of 2, "+"(actual length is ".concat(e.length,")."))),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const n=qb(e,[{paths:["./model.weights.bin"],weights:e.weightSpecs}]);if(t.body.append("model.json",new Blob([JSON.stringify(n)],{type:"application/json"}),"model.json"),null!=e.weightData){const n=Ob.join(e.weightData);t.body.append("model.weights.bin",new Blob([n],{type:"application/octet-stream"}),"model.weights.bin")}const r=await this.fetch(this.path,t);if(r.ok)return{modelArtifactsInfo:Qb(e),responses:[r]};throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+"".concat(r.status,"."))}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error("Request to ".concat(this.path," failed with status code ")+"".concat(e.status,". Please verify this URL points to ")+"the model JSON of the model to load.");let t;try{t=await e.json()}catch(IQ){let t="Failed to parse model JSON of response from ".concat(this.path,".");throw this.path.endsWith(".pb")?t+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":t+=" Please make sure the server is serving valid JSON for this request.",new Error(t)}const n=t.modelTopology,r=t.weightsManifest;if(null==n&&null==r)throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model ")+"topology or manifest for weights.");return t}async load(){if(this.loadOptions.streamWeights)return this.loadStream();return Kb(await this.loadModelJSON(),(e=>this.loadWeights(e)))}async loadStream(){const e=await this.loadModelJSON(),t=await this.getWeightUrls(e.weightsManifest),n=Jb(e.weightsManifest);return Object.assign(Object.assign({},e),{weightSpecs:n,getWeightStream:()=>function(e,t){var n;const r=null==t.fetchFunc?Hh().platform.fetch:t.fetchFunc;let a,i=0;return null===(n=t.onProgress)||void 0===n||n.call(t,0),new ReadableStream({pull:async n=>{for(var o;i<e.length;){if(!a){const n=(await r(e[i],t.requestInit,{isBinary:!0})).body;a=n.getReader()}const{done:s,value:c}=await a.read();if(!s)return void n.enqueue(c);i++,a=void 0,null===(o=t.onProgress)||void 0===o||o.call(t,i/e.length)}n.close()}})}(t,this.loadOptions)})}async getWeightUrls(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[n,r]=function(e){const t=e.lastIndexOf("/"),n=e.lastIndexOf("?"),r=e.substring(0,t),a=n>t?e.substring(n):"";return[r+"/",a]}(t),a=this.weightPathPrefix||n,i=[],o=[];for(const s of e)for(const e of s.paths)null!=this.weightUrlConverter?o.push(this.weightUrlConverter(e)):i.push(a+e+r);return this.weightUrlConverter&&i.push(...await Promise.all(o)),i}async loadWeights(e){const t=await this.getWeightUrls(e);return[Jb(e),await fx(t,this.loadOptions)]}}function hx(e){return null!=e.match(dx.URL_SCHEME_REGEX)}dx.URL_SCHEME_REGEX=/^https?:\/\//;const px=(e,t)=>{if("undefined"===typeof fetch&&(null==t||null==t.fetchFunc))return null;{let n=!0;if(n=Array.isArray(e)?e.every((e=>hx(e))):hx(e),n)return gx(e,t)}return null};function gx(e,t){return new dx(e,t)}Zb.registerSaveRouter(px),Zb.registerLoadRouter(px);const mx=-2,vx=-1;function bx(e,t,n){const r=e.shape.length;fh(r===t.length,(()=>"Error in slice".concat(r,"D: Length of begin ").concat(t," must ")+"match the rank of the array (".concat(r,")."))),fh(r===n.length,(()=>"Error in slice".concat(r,"D: Length of size ").concat(n," must ")+"match the rank of the array (".concat(r,").")));for(let a=0;a<r;++a)fh(t[a]+n[a]<=e.shape[a],(()=>"Error in slice".concat(r,"D: begin[").concat(a,"] + size[").concat(a,"] ")+"(".concat(t[a]+n[a],") would overflow input.shape[").concat(a,"] (").concat(e.shape[a],")")))}function yx(e){const t=[];let n=0;for(;e>0;)1&e&&t.push(n),e/=2,n++;return t}function xx(e,t,n){const r=[];for(let a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function wx(e,t,n,r){const a=[...e];for(let i=a.length;i<r.length;i++)a.push(1);for(let i=0;i<n;i++)0===i?a[t]=1:(a.splice(t,0,1),a.pop());return a}function Sx(e,t,n){return n<=e?n:n-(t-1)}function Cx(e,t){const n=[];for(let r=0;r<e;r++)n.push(t+r);return n}function Mx(e,t,n,r,a,i,o,s,c){const u=e.length;let l=new Array(u),f=new Array(u),d=new Array(u);if(t.length&&n>0){const c=t[0],u=n+1;l=_x(o,c,u,r,e),f=Ex(s,c,u,a,e),d=wx(i,c,u,e)}else for(let h=0;h<u;h++)l[h]=Ix(o,r,i,e,h,c),f[h]=kx(s,a,i,e,h,c),d[h]=Tx(i,h,c);return{begin:l,end:f,strides:d}}function _x(e,t,n,r,a){const i=[...a],o=Cx(n,t);for(let s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=0;else{const a=Sx(t,n,s);let o=r[a];e&1<<a&&(o=0),i[s]=o}return i}function Ex(e,t,n,r,a){const i=[...a],o=Cx(n,t);for(let s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=Number.MAX_SAFE_INTEGER;else{const a=Sx(t,n,s);let o=r[a];e&1<<a&&(o=Number.MAX_SAFE_INTEGER),i[s]=o}for(let s=0;s<i.length;s++){const e=a[s];i[s]<0&&(i[s]+=e),i[s]=ch(0,i[s],a[s])}return i}function Tx(e,t,n){let r=e[t];return(n&1<<t||null==r)&&(r=1),r}function Ix(e,t,n,r,a,i){let o=t[a];const s=n[a]||1;(e&1<<a||i&1<<a||null==o)&&(o=s>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);const c=r[a];return o<0&&(o+=c),o=ch(0,o,c-1),o}function kx(e,t,n,r,a,i){let o=t[a];const s=n[a]||1;(e&1<<a||i&1<<a||null==o)&&(o=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);const c=r[a];return o<0&&(o+=c),o=s>0?ch(0,o,c):ch(-1,o,c-1),o}function Nx(e,t,n){let r=n.length;for(let a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(let a=r+1;a<n.length;a++)if(t[a]>0||n[a]!==e[a])return!1;return!0}function Lx(e,t){let n=e.length>0?e[e.length-1]:1;for(let r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function Ax(e,t,n){let r;const a=e.shape.length;let i;return r="number"===typeof t?[t,...new Array(a-1).fill(0)]:t.length<a?t.concat(new Array(a-t.length).fill(0)):t.slice(),r.forEach((e=>{fh(-1!==e,(()=>"slice() does not support negative begin indexing."))})),i=null==n?new Array(a).fill(-1):"number"===typeof n?[n,...new Array(a-1).fill(-1)]:n.length<a?n.concat(new Array(a-n.length).fill(-1)):n,i=i.map(((t,n)=>t>=0?t:(fh(-1===t,(()=>"Negative size values should be exactly -1 but got "+"".concat(t," for the slice() size at index ").concat(n,"."))),e.shape[n]-r[n]))),[r,i]}function Rx(e,t,n,r,a,i,o,s,c){let u;if(null==r?(u=new Array(t.length),u.fill(1)):u=r,null!=o&&0!==(o&o-1))throw new Error("Multiple ellipses in slice is not allowed.");let l=!1;const f={dims:u.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:u.slice(),beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:c};for(let y=0;y<f.dims;y++)l&&0!==(1<<y&s)&&f.numAddAxisAfterEllipsis++,1<<y&o&&(l=!0);l||(f.ellipsisMask|=1<<f.dims,f.dims++);const d={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;let n=0;t.beginValid=null!=e.begin,t.endValid=null!=e.end,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(let r=0;r<e.dims;r++)if(1<<r&e.ellipsisMask){const a=Math.min(t.dims-(e.dims-r)+1+e.numAddAxisAfterEllipsis,t.dims);for(;n<a;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=r}else if(1<<r&e.newAxisMask)t.finalShapeGatherIndices.push(mx),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error("Index out of range using input dim ".concat(n,"; input ")+"has only ".concat(t.dims," dims, ").concat(t.begin.length,"."));null!=e.begin&&(t.begin[n]=e.begin[r]),null!=e.end&&(t.end[n]=e.end[r]),t.strides[n]=e.strides[r],e.beginMask&1<<r&&(t.beginMask|=1<<n),e.endMask&1<<r&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(vx),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[n]=r,n++}}(f,d);let h=!0,p=!0,g=!0;const m=[],v=[];for(let y=0;y<e.length;++y){if(0===d.strides[y])throw Error("strides[".concat(y,"] must be non-zero"));const t=!!(d.shrinkAxisMask&1<<y),n=e[y];if(-1===n){m.push(t?1:-1);continue}const r=[d.beginMask&1<<y,d.endMask&1<<y],a=[d.strides[y]>0?0:-1,d.strides[y]>0?n:n-1];if(t&&d.strides[y]<=0)throw Error("only stride 1 allowed on non-range indexing.");g=g&&1===d.strides[y];const i=!!(d.beginMask&1<<y&&d.endMask&1<<y);if(d.beginValid&&d.endValid){if(t){const e=d.begin[y]<0?n+d.begin[y]:d.begin[y];if(d.begin[y]=e,d.end[y]=d.begin[y]+1,e<0||e>=n)throw Error("slice index ".concat(d.begin[y]," of dimension ").concat(y," out of bounds."))}else d.begin[y]=Dx(d.begin[y],0,d.strides[y],n,r,a),d.end[y]=Dx(d.end[y],1,d.strides[y],n,r,a);const e=1===d.strides[y]&&0===d.begin[y]&&d.end[y]===n;h=h&&e,p=p&&(0===y&&1===d.strides[y]||e)}else h=h&&1===d.strides[y]&&i,p=p&&(0===y&&1===d.strides[y]||i);let o,s=!1;if(d.beginValid&&d.endValid?(o=d.end[y]-d.begin[y],s=!0):t?(o=1,s=!0):i&&n>=0&&(o=d.strides[y]<0?-n:n,s=!0),s){let e;e=0===o||o<0!==d.strides[y]<0?0:Math.trunc(o/d.strides[y])+(o%d.strides[y]!==0?1:0),m.push(e)}else m.push(-1)}for(let y=0;y<d.finalShapeGatherIndices.length;++y){const e=d.finalShapeGatherIndices[y];e>=0?v.push(m[e]):e===mx&&v.push(1)}const b=v.filter(((e,t)=>d.finalShapeGatherIndices[t]!==mx));return{finalShapeSparse:b,finalShape:v,isIdentity:h,sliceDim0:p,isSimpleSlice:g,begin:d.begin,end:d.end,strides:d.strides}}function Dx(e,t,n,r,a,i){if(a[t])return n>0?i[t]:i[t+1&1];{const t=e<0?r+e:e;return t<i[0]?i[0]:t>i[1]?i[1]:t}}const Ox=Lb({all_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r={x:kb(e,"x","all","bool")},a={axis:t,keepDims:n};return yb.runKernel(np,r,a)}});const Px=Lb({any_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r={x:kb(e,"x","any","bool")},a={axis:t,keepDims:n};return yb.runKernel(rp,r,a)}});const Fx=Lb({argMax_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n={x:kb(e,"x","argMax")},r={axis:t};return yb.runKernel(ap,n,r)}});function zx(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5?arguments[5]:void 0;return Ux(e,[...t,e[3]],n,i,r,null,null,Jx(a))}function jx(e,t,n,r,a,i){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast";const[s,c]=Vx(t);let u;if("channelsLast"===o)u=[s,c,e[3],e[3]];else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat ".concat(o));u=[s,c,e[1],e[1]]}return Ux(e,u,n,r,a,i,!1,o)}function Bx(e,t,n,r,a,i){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NDHWC";const[s,c,u]=Hx(t);let l,f;if("NDHWC"===o)f="channelsLast",l=[s,c,u,e[4],e[4]];else{if("NCDHW"!==o)throw new Error("Unknown dataFormat ".concat(o));f="channelsFirst",l=[s,c,u,e[1],e[1]]}return Wx(e,l,n,r,a,!1,f,i)}function Ux(e,t,n,r,a,i){let o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"channelsLast",[c,u,l,f]=[-1,-1,-1,-1];if("channelsLast"===s)[c,u,l,f]=e;else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));[c,f,u,l]=e}const[d,h,,p]=t,[g,m]=Vx(n),[v,b]=Vx(r),y=Yx(d,v),x=Yx(h,b),{padInfo:w,outHeight:S,outWidth:C}=function(e,t,n,r,a,i,o,s,c){let u,l,f;if("number"===typeof e){u={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};const a=function(e,t,n,r,a){null==r&&(r=Gx(e,t,n));const i=e[0],o=e[1],s=Xx((i-t+2*r)/n+1,a),c=Xx((o-t+2*r)/n+1,a);return[s,c]}([t,n],i,r,e,s);l=a[0],f=a[1]}else if("same"===e){l=Math.ceil(t/r),f=Math.ceil(n/a);const e=Math.max(0,(l-1)*r+i-t),s=Math.max(0,(f-1)*a+o-n),c=Math.floor(e/2),d=e-c,h=Math.floor(s/2);u={top:c,bottom:d,left:h,right:s-h,type:"SAME"}}else if("valid"===e)u={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-i+1)/r),f=Math.ceil((n-o+1)/a);else{if("object"!==typeof e)throw Error("Unknown padding parameter: ".concat(e));{const d="channelsLast"===c?e[1][0]:e[2][0],h="channelsLast"===c?e[1][1]:e[2][1],p="channelsLast"===c?e[2][0]:e[3][0],g="channelsLast"===c?e[2][1]:e[3][1];u={top:d,bottom:h,left:p,right:g,type:0===d&&0===h&&0===p&&0===g?"VALID":"EXPLICIT"},l=Xx((t-i+d+h)/r+1,s),f=Xx((n-o+p+g)/a+1,s)}}return{padInfo:u,outHeight:l,outWidth:f}}(a,u,l,g,m,y,x,i,s),M=o?p*f:p;let _;return"channelsFirst"===s?_=[c,M,S,C]:"channelsLast"===s&&(_=[c,S,C,M]),{batchSize:c,dataFormat:s,inHeight:u,inWidth:l,inChannels:f,outHeight:S,outWidth:C,outChannels:M,padInfo:w,strideHeight:g,strideWidth:m,filterHeight:d,filterWidth:h,effectiveFilterHeight:y,effectiveFilterWidth:x,dilationHeight:v,dilationWidth:b,inShape:e,outShape:_,filterShape:t}}function Wx(e,t,n,r,a){let i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",s=arguments.length>7?arguments[7]:void 0,[c,u,l,f,d]=[-1,-1,-1,-1,-1];if("channelsLast"===o)[c,u,l,f,d]=e;else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat ".concat(o));[c,d,u,l,f]=e}const[h,p,g,,m]=t,[v,b,y]=Hx(n),[x,w,S]=Hx(r),C=Yx(h,x),M=Yx(p,w),_=Yx(g,S),{padInfo:E,outDepth:T,outHeight:I,outWidth:k}=function(e,t,n,r,a,i,o,s,c,u,l){let f,d,h,p;"valid"===e&&(e=0);if("number"===typeof e){f={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};const g=function(e,t,n,r,a,i){null==a&&(a=Gx(e,t[0],r[0]));const o=[0,0,0,n];for(let s=0;s<3;s++)e[s]+2*a>=t[s]&&(o[s]=Xx((e[s]-t[s]+2*a)/r[s]+1,i));return o}([t,n,r,1],[s,c,u],1,[a,i,o],e,l);d=g[0],h=g[1],p=g[2]}else{if("same"!==e)throw Error("Unknown padding parameter: ".concat(e));{d=Math.ceil(t/a),h=Math.ceil(n/i),p=Math.ceil(r/o);const e=(d-1)*a+s-t,l=(h-1)*i+c-n,g=(p-1)*o+u-r,m=Math.floor(e/2),v=e-m,b=Math.floor(l/2),y=l-b,x=Math.floor(g/2);f={top:b,bottom:y,left:x,right:g-x,front:m,back:v,type:"SAME"}}}return{padInfo:f,outDepth:d,outHeight:h,outWidth:p}}(a,u,l,f,v,b,y,C,M,_,s),N=i?m*d:m;let L;return"channelsFirst"===o?L=[c,N,T,I,k]:"channelsLast"===o&&(L=[c,T,I,k,N]),{batchSize:c,dataFormat:o,inDepth:u,inHeight:l,inWidth:f,inChannels:d,outDepth:T,outHeight:I,outWidth:k,outChannels:N,padInfo:E,strideDepth:v,strideHeight:b,strideWidth:y,filterDepth:h,filterHeight:p,filterWidth:g,effectiveFilterDepth:C,effectiveFilterHeight:M,effectiveFilterWidth:_,dilationDepth:x,dilationHeight:w,dilationWidth:S,inShape:e,outShape:L,filterShape:t}}function Gx(e,t,n){const r=Yx(t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1);return Math.floor((e[0]*(n-1)-n+r)/2)}function Vx(e){return"number"===typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function Hx(e){return"number"===typeof e?[e,e,e]:e}function Yx(e,t){return t<=1?e:e+(e-1)*(t-1)}function Xx(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode ".concat(t))}}function qx(e){const[t,n,r]=Vx(e);return 1===t&&1===n&&1===r}function Kx(e,t){return qx(e)||qx(t)}function Qx(e){return Vx(e).every((e=>e>0))}function Jx(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat ".concat(e))}function Zx(e,t,n){if(null!=n){if("string"===typeof t)throw Error("Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,"."));if("number"===typeof t)fh(mh(t),(()=>"Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,".")));else{if("object"!==typeof t)throw Error("Error in ".concat(e,": Unknown padding parameter: ").concat(t));t.forEach((t=>{t.forEach((t=>{fh(mh(t),(()=>"Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,".")))}))}))}}}const $x=Lb({reshape_:function(e,t){const n={x:kb(e,"x","reshape","string_or_numeric")},r={shape:t};return yb.runKernel(cm,n,r)}});const ew=Lb({avgPool_:function(e,t,n,r,a){const i=kb(e,"x","avgPool","float32");fh(Kx(n,1),(()=>"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(1,"'")));let o=i,s=!1;3===i.rank&&(s=!0,o=$x(i,[1,i.shape[0],i.shape[1],i.shape[2]])),fh(4===o.rank,(()=>"Error in avgPool: x must be rank 4 but got rank ".concat(o.rank,"."))),Zx("avgPool",r,a);const c={x:o},u={filterSize:t,strides:n,pad:r,dimRoundingMode:a};let l=yb.runKernel(fp,c,u);return l=Iy(l,i.dtype),s?$x(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});const tw=Lb({avgPool3d_:function(e,t,n,r,a){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC";const o=kb(e,"x","avgPool3d","float32");let s=o,c=!1;4===o.rank&&(c=!0,s=$x(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),fh(5===s.rank,(()=>"Error in avgPool3d: x must be rank 5 but got rank ".concat(s.rank,"."))),fh("NDHWC"===i,(()=>"Error in avgPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i))),fh("number"===typeof n&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,(()=>"Error in avgPool3d: Stride must be > 0, but got '".concat(n,"'"))),Zx("avgPool3d",r,a);const u={x:s},l={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i};let f=yb.runKernel(hp,u,l);return f=Iy(f,s.dtype),c?$x(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}});const nw=Lb({batchNorm_:function(e,t,n,r,a,i){null==i&&(i=.001);const o=kb(e,"x","batchNorm"),s=kb(t,"mean","batchNorm"),c=kb(n,"variance","batchNorm");let u,l;null!=a&&(u=kb(a,"scale","batchNorm")),null!=r&&(l=kb(r,"offset","batchNorm")),fh(s.rank===c.rank,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),fh(null==l||s.rank===l.rank,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),fh(null==u||s.rank===u.rank,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));const f=function(e){let t;return t=0===e.rank||1===e.rank?$x(e,[1,1,1,e.size]):2===e.rank?$x(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?$x(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e,t}(o),d={x:f,scale:u,offset:l,mean:s,variance:c},h={varianceEpsilon:i},p=yb.runKernel(sg,d,h);return $x(p,o.shape)}});const rw=Lb({batchNorm2d_:function(e,t,n,r,a,i){const o=kb(e,"x","batchNorm"),s=kb(t,"mean","batchNorm"),c=kb(n,"variance","batchNorm");let u,l;return null!=a&&(u=kb(a,"scale","batchNorm")),null!=r&&(l=kb(r,"offset","batchNorm")),fh(2===o.rank,(()=>"Error in batchNorm2D: x must be rank 2 but got rank "+"".concat(o.rank,"."))),fh(2===s.rank||1===s.rank,(()=>"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+"got rank ".concat(s.rank,"."))),fh(2===c.rank||1===c.rank,(()=>"Error in batchNorm2D: variance must be rank 2 or rank 1 "+"but got rank ".concat(c.rank,"."))),null!=u&&fh(2===u.rank||1===u.rank,(()=>"Error in batchNorm2D: scale must be rank 2 or rank 1 "+"but got rank ".concat(u.rank,"."))),null!=l&&fh(2===l.rank||1===l.rank,(()=>"Error in batchNorm2D: offset must be rank 2 or rank 1 "+"but got rank ".concat(l.rank,"."))),nw(o,s,c,l,u,i)}});const aw=Lb({batchNorm3d_:function(e,t,n,r,a,i){const o=kb(e,"x","batchNorm"),s=kb(t,"mean","batchNorm"),c=kb(n,"variance","batchNorm");let u,l;return null!=a&&(u=kb(a,"scale","batchNorm")),null!=r&&(l=kb(r,"offset","batchNorm")),fh(3===o.rank,(()=>"Error in batchNorm3D: x must be rank 3 but got rank "+"".concat(o.rank,"."))),fh(3===s.rank||1===s.rank,(()=>"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+"got rank ".concat(s.rank,"."))),fh(3===c.rank||1===c.rank,(()=>"Error in batchNorm3D: variance must be rank 3 or rank 1 "+"but got rank ".concat(c.rank,"."))),null!=u&&fh(3===u.rank||1===u.rank,(()=>"Error in batchNorm3D: scale must be rank 3 or rank 1 "+"but got rank ".concat(u.rank,"."))),null!=l&&fh(3===l.rank||1===l.rank,(()=>"Error in batchNorm3D: offset must be rank 3 or rank 1 "+"but got rank ".concat(l.rank,"."))),nw(o,s,c,l,u,i)}});const iw=Lb({batchNorm4d_:function(e,t,n,r,a,i){const o=kb(e,"x","batchNorm"),s=kb(t,"mean","batchNorm"),c=kb(n,"variance","batchNorm");let u,l;return null!=a&&(u=kb(a,"scale","batchNorm")),null!=r&&(l=kb(r,"offset","batchNorm")),fh(4===o.rank,(()=>"Error in batchNorm4D: x must be rank 4 but got rank "+"".concat(o.rank,"."))),fh(4===s.rank||1===s.rank,(()=>"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+"got rank ".concat(s.rank,"."))),fh(4===c.rank||1===c.rank,(()=>"Error in batchNorm4D: variance must be rank 4 or rank 1 "+"but got rank ".concat(c.rank,"."))),null!=u&&fh(4===u.rank||1===u.rank,(()=>"Error in batchNorm4D: scale must be rank 4 or rank 1 "+"but got rank ".concat(u.rank,"."))),null!=l&&fh(4===l.rank||1===l.rank,(()=>"Error in batchNorm4D: offset must be rank 4 or rank 1 "+"but got rank ".concat(l.rank,"."))),nw(o,s,c,l,u,i)}});const ow=Lb({broadcastTo_:function(e,t){let n=kb(e,"broadcastTo","x");const r=n.shape;if(zh(t),t.length<n.rank)throw new Error("broadcastTo(): shape.length=".concat(t.length," < input.rank=").concat(n.rank,"."));if(t.length>n.rank){const e=n.shape.slice();for(;e.length<t.length;)e.unshift(1);n=$x(n,e)}const a=n.shape,i=Array.from(t);for(let u=t.length-1;u>=0;u--)if(a[u]===t[u])i[u]=1;else if(1!==n.shape[u])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(t,"]."));const o=i.map(((e,t)=>e>1?t:-1)).filter((e=>e>=0));if(0===o.length)return ky(n);const s={x:n},c={reps:i};return yb.runKernel(qm,s,c)}});const sw=Lb({clipByValue_:function(e,t,n){const r=kb(e,"x","clipByValue");if(fh(t<=n,(()=>"Error in clip: min (".concat(t,") must be ")+"less than or equal to max (".concat(n,")."))),t===n)return Xy(r.shape,t,r.dtype);const a={x:r},i={clipValueMin:t,clipValueMax:n};return yb.runKernel(Sp,a,i)}});const cw=Lb({concat_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;fh(e.length>=1,(()=>"Pass at least one tensor to concat"));const n=Nb(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((e=>{if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype ".concat(e.dtype,". "))})),1===n.length)return ky(n[0]);const r=n,a={axis:t};return yb.runKernel(_p,r,a)}});const uw=Lb({concat1d_:function(e){return cw(e,0)}});const lw=Lb({concat2d_:function(e,t){return cw(e,t)}});const fw=Lb({concat3d_:function(e,t){return cw(e,t)}});const dw=Lb({concat4d_:function(e,t){return cw(e,t)}});const hw=Lb({conv2d_:function(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0;const s=kb(e,"x","conv2d","float32"),c=kb(t,"filter","conv2d","float32");let u=s,l=!1;3===s.rank&&(l=!0,u=$x(s,[1,s.shape[0],s.shape[1],s.shape[2]])),fh(4===u.rank,(()=>"Error in conv2d: input must be rank 4, but got rank ".concat(u.rank,"."))),fh(4===c.rank,(()=>"Error in conv2d: filter must be rank 4, but got rank "+"".concat(c.rank,"."))),Zx("conv2d",r,o);const f="NHWC"===a?u.shape[3]:u.shape[1];fh(f===c.shape[2],(()=>"Error in conv2d: depth of input (".concat(f,") must match ")+"input depth for filter ".concat(c.shape[2],"."))),fh(Kx(n,i),(()=>"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(i,"'"))),fh(Qx(i),(()=>"Error in conv2D: Dilated rates should be larger than 0.")),fh(Qx(n),(()=>"Error in conv2D: Strides should be larger than 0."));const d={x:u,filter:c},h={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},p=yb.runKernel(Ep,d,h);return l?$x(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});const pw=Lb({conv1d_:function(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6?arguments[6]:void 0;const s=kb(e,"x","conv1d"),c=kb(t,"filter","conv1d");let u=s,l=!1;2===s.rank&&(l=!0,u=$x(s,[1,s.shape[0],s.shape[1]])),fh(3===u.rank,(()=>"Error in conv1d: input must be rank 3, but got rank ".concat(u.rank,"."))),fh(3===c.rank,(()=>"Error in conv1d: filter must be rank 3, but got rank "+"".concat(c.rank,"."))),Zx("conv1d",r,o),fh(u.shape[2]===c.shape[1],(()=>"Error in conv1d: depth of input (".concat(u.shape[2],") must match ")+"input depth for filter ".concat(c.shape[1],"."))),fh(Kx(n,i),(()=>"Error in conv1D: Either stride or dilation must be 1. "+"Got stride ".concat(n," and dilation '").concat(i,"'"))),fh(Qx(i),(()=>"Error in conv1D: Dilated rates should be larger than 0.")),fh(Qx(n),(()=>"Error in conv1D: Stride should be larger than 0.")),fh("NWC"===a,(()=>"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")));const f=$x(c,[1,c.shape[0],c.shape[1],c.shape[2]]),d=$x(u,[u.shape[0],1,u.shape[1],u.shape[2]]),h=hw(d,f,[1,n],r,"NHWC",[1,i],o);return $x(h,l?[h.shape[2],h.shape[3]]:[h.shape[0],h.shape[2],h.shape[3]])}});const gw=Lb({conv2DBackpropInput_:function(e,t,n,r,a){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0;fh(e.length===t.rank,(()=>"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match")));let s=e,c=t,u=!1;3===t.rank&&(u=!0,c=$x(t,[1,t.shape[0],t.shape[1],t.shape[2]]),s=[1,e[0],e[1],e[2]]),fh(4===s.length,(()=>"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(s.length,"."))),fh(4===c.rank,(()=>"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(c.rank))),fh(4===n.rank,(()=>"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(n.rank)));const l="NHWC"===i?s[3]:s[1],f="NHWC"===i?c.shape[3]:c.shape[1];fh(l===n.shape[2],(()=>"Error in conv2dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(n.shape[2],"."))),fh(f===n.shape[3],(()=>"Error in conv2dDerInput: depth of output (".concat(f,") must ")+"match output depth for filter ".concat(n.shape[3],"."))),Zx("conv2dDerInput",a,o);const d={dy:c,filter:n},h={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},p=yb.runKernel(Ip,d,h);return u?$x(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});const mw=Lb({conv2dTranspose_:function(e,t,n,r,a,i){const o=kb(e,"x","conv2dTranspose"),s=kb(t,"filter","conv2dTranspose");return gw(n,o,s,r,a,"NHWC",i)}});const vw=Lb({conv3d_:function(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NDHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1];const o=kb(e,"x","conv3d"),s=kb(t,"filter","conv3d");let c=o,u=!1;4===o.rank&&(u=!0,c=$x(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),fh(5===c.rank,(()=>"Error in conv3d: input must be rank 5, but got rank ".concat(c.rank,"."))),fh(5===s.rank,(()=>"Error in conv3d: filter must be rank 5, but got rank "+"".concat(s.rank,"."))),fh(c.shape[4]===s.shape[3],(()=>"Error in conv3d: depth of input (".concat(c.shape[4],") must match ")+"input depth for filter ".concat(s.shape[3],"."))),fh(Kx(n,i),(()=>"Error in conv3D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(i,"'"))),fh("NDHWC"===a,(()=>"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported."))),fh(Qx(i),(()=>"Error in conv3D: Dilated rates should be larger than 0.")),fh(Qx(n),(()=>"Error in conv3D: Strides should be larger than 0."));const l={x:c,filter:s},f={strides:n,pad:r,dataFormat:a,dilations:i},d=yb.runKernel(kp,l,f);return u?$x(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});const bw=Lb({conv3DBackpropInput_:function(e,t,n,r,a){fh(e.length===t.rank,(()=>"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match")));let i=e,o=t,s=!1;4===t.rank&&(s=!0,o=$x(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),i=[1,e[0],e[1],e[2],e[3]]);const c=i[4],u=o.shape[4];fh(5===i.length,(()=>"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,"."))),fh(5===o.rank,(()=>"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(o.rank))),fh(5===n.rank,(()=>"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(n.rank))),fh(c===n.shape[3],(()=>"Error in conv3dDerInput: depth of input (".concat(c,") must ")+"match input depth for filter ".concat(n.shape[3],"."))),fh(u===n.shape[4],(()=>"Error in conv3dDerInput: depth of output (".concat(u,") must ")+"match output depth for filter ".concat(n.shape[4],".")));const l={dy:o,filter:n},f={pad:a,strides:r,inputShape:i},d=yb.runKernel(Lp,l,f);return s?$x(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});const yw=Lb({conv3dTranspose_:function(e,t,n,r,a){const i=kb(e,"x","conv3dTranspose"),o=kb(t,"filter","conv3dTranspose");return bw(n,i,o,r,a)}});const xw=Lb({denseBincount_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=kb(e,"x","denseBincount"),i=kb(t,"weights","denseBincount");fh("int32"===a.dtype,(()=>"Error in denseBincount: input "+"dtype must be int32, but got ".concat(a.dtype))),fh(a.rank<=2,(()=>"Error in denseBincount: input must be at most rank 2, but got "+"rank ".concat(a.rank,"."))),fh(n>=0,(()=>"size must be non-negative, but got ".concat(n,"."))),fh(i.size===a.size||0===i.size,(()=>"Error in denseBincount: weights must have the same shape as x or "+"0-length, but got x shape: ".concat(a.shape,", weights shape: ")+"".concat(i.shape,".")));const o={x:a,weights:i},s={size:n,binaryOutput:r};return yb.runKernel(Fp,o,s)}});const ww=Lb({depthwiseConv2d_:function(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0;const s=kb(e,"x","depthwiseConv2d","float32"),c=kb(t,"filter","depthwiseConv2d","float32");let u=s,l=!1;3===s.rank&&(l=!0,u=$x(s,[1,s.shape[0],s.shape[1],s.shape[2]])),fh(4===u.rank,(()=>"Error in depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(u.rank,"."))),fh(4===c.rank,(()=>"Error in depthwiseConv2d: filter must be rank 4, but got rank "+"".concat(c.rank,".")));const f="NHWC"===a?u.shape[3]:u.shape[1];fh(f===c.shape[2],(()=>"Error in depthwiseConv2d: number of input channels "+"(".concat(f,") must match the inChannels dimension in ")+"filter ".concat(c.shape[2],"."))),Zx("depthwiseConv2d",r,o);const d={x:u,filter:c},h={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},p=yb.runKernel(jp,d,h);return l?$x(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});const Sw=Lb({elu_:function(e){const t={x:kb(e,"x","elu","float32")};return yb.runKernel(Kp,t)}});const Cw=Lb({equal_:function(e,t){let n=kb(e,"a","equal","string_or_numeric"),r=kb(t,"b","equal","string_or_numeric");[n,r]=fb(n,r),tx(n.shape,r.shape);const a={a:n,b:r};return yb.runKernel(Zp,a)}});const Mw=Lb({erf_:function(e){let t=kb(e,"x","erf");fh("int32"===t.dtype||"float32"===t.dtype,(()=>"Input dtype must be `int32` or `float32`.")),"int32"===t.dtype&&(t=Iy(t,"float32"));const n={x:t};return yb.runKernel(Jp,n)}});const _w=Lb({exp_:function(e){const t={x:kb(e,"x","exp")};return yb.runKernel($p,t)}});const Ew=Lb({expandDims_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=kb(e,"x","expandDims","string_or_numeric");fh(t<=n.rank,(()=>"Axis must be <= rank of the tensor"));const r={input:n},a={dim:t};return yb.runKernel(eg,r,a)}});const Tw=Lb({tile_:function(e,t){const n=kb(e,"x","tile","string_or_numeric");fh(n.rank===t.length,(()=>"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of reps ".concat(t,".")));const r={x:n},a={reps:t};return yb.runKernel(qm,r,a)}});const Iw=Lb({eye_:function(e,t,n){null==t&&(t=e);const r=Ty([e,t],arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32"),a=e<=t?e:t;for(let o=0;o<a;++o)r.set(1,o,o);const i=$x(r.toTensor(),[e,t]);if(null==n)return i;if(1===n.length)return Tw(Ew(i,0),[n[0],1,1]);if(2===n.length)return Tw(Ew(Ew(i,0),0),[n[0],n[1],1,1]);if(3===n.length)return Tw(Ew(Ew(Ew(i,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+"batchShapes, but received ".concat(n.length,"D."))}});const kw=Lb({floor_:function(e){const t={x:kb(e,"x","floor","float32")};return yb.runKernel(ig,t)}});const Nw=Lb({gather_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const a={x:kb(e,"x","gather"),indices:kb(t,"indices","gather","int32")},i={axis:n,batchDims:r};return yb.runKernel(cg,a,i)}});const Lw=Lb({greater_:function(e,t){let n=kb(e,"a","greater","string_or_numeric"),r=kb(t,"b","greater","string_or_numeric");[n,r]=fb(n,r),tx(n.shape,r.shape);const a={a:n,b:r};return yb.runKernel(lg,a)}});const Aw=Lb({greaterEqual_:function(e,t){let n=kb(e,"a","greaterEqual","string_or_numeric"),r=kb(t,"b","greaterEqual","string_or_numeric");[n,r]=fb(n,r),tx(n.shape,r.shape);const a={a:n,b:r};return yb.runKernel(fg,a)}});const Rw=Lb({leakyRelu_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2;const n={x:kb(e,"x","leakyRelu")},r={alpha:t};return yb.runKernel(bg,n,r)}});const Dw=Lb({log_:function(e){const t={x:kb(e,"x","log","float32")};return yb.runKernel(Sg,t)}});const Ow=Lb({log1p_:function(e){const t={x:kb(e,"x","log1p")};return yb.runKernel(Cg,t)}});const Pw=Lb({max_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r={x:kb(e,"x","max")},a={reductionIndices:t,keepDims:n};return yb.runKernel(kg,r,a)}});const Fw=Lb({sum_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=kb(e,"x","sum");"bool"===r.dtype&&(r=Iy(r,"int32"));const a={x:r},i={axis:t,keepDims:n};return yb.runKernel(km,a,i)}});const zw=Lb({logSoftmax_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;const n=kb(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and axis was ").concat(t));const r=zy(((e,n)=>{const r=Pw(e,t,!0),a=Qy(e,r),i=Qy(Iy(a,"float32"),Dw(Fw(_w(a),t,!0)));n([i]);return{value:i,gradFunc:(e,n)=>{const[r]=n,a=_w(r);return Qy(e,Dy(Fw(e,t,!0),a))}}}));return r(n)}});function jw(e,t){for(let n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function Bw(e,t,n){const r=e.length+t.length,a=[];let i=0,o=0;for(let s=0;s<r;s++)-1===n.indexOf(s)?a.push(e[i++]):a.push(t[o++]);return a}function Uw(e,t){const n=[],r=e.length;for(let a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);return[n,t.map((t=>e[t]))]}function Ww(e,t){return Bw(e,t.map((e=>1)),t)}function Gw(e,t,n){fh(jw(t,n),(()=>"".concat(e," supports only inner-most axes for now. ")+"Got axes ".concat(t," and rank-").concat(n," input.")))}function Vw(e,t){if(jw(e,t))return null;const n=[];for(let r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((e=>n.push(e))),n}function Hw(e){return e.map(((e,t)=>[t,e])).sort(((e,t)=>e[1]-t[1])).map((e=>e[0]))}function Yw(e,t){const n=[];for(let r=t-e;r<t;++r)n.push(r);return n}const Xw=Lb({logSumExp_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=kb(e,"x","logSumExp"),a=wh(t,r.shape),i=Pw(r,a,!0),o=Qy(r,i),s=_w(o),c=Fw(s,a),u=Dw(c),l=Ly($x(i,u.shape),u);if(n){const e=Ww(l.shape,a);return $x(l,e)}return l}});const qw=Lb({logicalAnd_:function(e,t){const n=kb(e,"a","logicalAnd","bool"),r=kb(t,"b","logicalAnd","bool");tx(n.shape,r.shape);const a={a:n,b:r};return yb.runKernel(Mg,a)}});const Kw=Lb({matMul_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=kb(e,"a","matMul"),i=kb(t,"b","matMul");[a,i]=fb(a,i);const o={a:a,b:i},s={transposeA:n,transposeB:r};return yb.runKernel(gp,o,s)}});const Qw=Lb({maxPool_:function(e,t,n,r,a){const i=kb(e,"x","maxPool");let o=i,s=!1;3===i.rank&&(s=!0,o=$x(i,[1,i.shape[0],i.shape[1],i.shape[2]])),fh(4===o.rank,(()=>"Error in maxPool: input must be rank 4 but got rank ".concat(o.rank,"."))),fh(Kx(n,1),(()=>"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(1,"'"))),Zx("maxPool",r,a);const c={x:o},u={filterSize:t,strides:n,pad:r,dimRoundingMode:a},l=yb.runKernel(Lg,c,u);return s?$x(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});const Jw=Lb({maxPool3d_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC";const o=kb(e,"x","maxPool3d");let s=o,c=!1;4===o.rank&&(c=!0,s=$x(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),fh(5===s.rank,(()=>"Error in maxPool3d: x must be rank 5 but got rank ".concat(s.rank,"."))),fh("NDHWC"===i,(()=>"Error in maxPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i))),Zx("maxPool3d",r,a);const u={x:s},l={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i},f=yb.runKernel(Rg,u,l);return c?$x(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}});const Zw=Lb({mean_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r={x:kb(e,"x","mean")},a={axis:t,keepDims:n};return yb.runKernel(Pg,r,a)}});const $w=Lb({min_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r={x:kb(e,"x","min")},a={axis:t,keepDims:n};return yb.runKernel(Fg,r,a)}});const eS=Lb({minimum_:function(e,t){let n=kb(e,"a","minimum"),r=kb(t,"b","minimum");[n,r]=fb(n,r),"bool"===n.dtype&&(n=Iy(n,"int32"),r=Iy(r,"int32")),tx(n.shape,r.shape);const a={a:n,b:r};return yb.runKernel(zg,a)}});const tS=Lb({moments_:function(e){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=wh(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,(e=kb(e,"x","moments")).shape),r=Zw(e,n,t);let a=r.shape;t||(a=Ww(r.shape,n));const i=Py(Qy(Iy(e,"float32"),$x(r,a)));return{mean:r,variance:Zw(i,n,t)}}});const nS=Lb({neg_:function(e){const t={x:kb(e,"x","neg")};return yb.runKernel(Gg,t)}});const rS=Lb({notEqual_:function(e,t){let n=kb(e,"a","notEqual","string_or_numeric"),r=kb(t,"b","notEqual","string_or_numeric");[n,r]=fb(n,r),tx(n.shape,r.shape);const a={a:n,b:r};return yb.runKernel(Vg,a)}});const aS=Lb({oneHot_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"int32";if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(t));const i={indices:kb(e,"indices","oneHot","int32")},o={dtype:a,depth:t,onValue:n,offValue:r};return yb.runKernel(Kg,i,o)}});function iS(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if(zh(e),"complex64"===t){const t=iS(e,"float32"),n=iS(e,"float32");return Ab(t,n)}const n=Ph(ph(e),t);return yb.makeTensor(n,e,t)}function oS(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if(zh(e),"complex64"===t){const t=oS(e,"float32"),n=iS(e,"float32");return Ab(t,n)}const n=Oh(ph(e),t);return yb.makeTensor(n,e,t)}const sS=Lb({onesLike_:function(e){const t={x:kb(e,"x","onesLike")};return yb.runKernel(qg,t)}});const cS=Lb({pad_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=kb(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const a={paddings:t,constantValue:n},i={x:r};return yb.runKernel(Jg,i,a)}});const uS=Lb({prelu_:function(e,t){const n={x:kb(e,"x","prelu"),alpha:kb(t,"alpha","prelu")};return yb.runKernel($g,n)}});var lS=n(4334);class fS{constructor(e,t,n,r,a){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);const i=a||Math.random();this.random=lS.alea(i.toString())}nextValue(){if(!isNaN(this.nextVal)){const e=this.nextVal;return this.nextVal=NaN,e}let e,t,n=!1;for(;!n;){let r,a,i;do{r=2*this.random()-1,a=2*this.random()-1,i=r*r+a*a}while(i>=1||0===i);const o=Math.sqrt(-2*Math.log(i)/i);e=this.mean+this.stdDev*r*o,t=this.mean+this.stdDev*a*o,this.truncated&&!this.isValidTruncated(e)||(n=!0)}return this.truncated&&!this.isValidTruncated(t)||(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class dS{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"===typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(e," - ").concat(t," <= 1 and dtype is not float"));this.random=lS.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}const hS=Lb({randomNormal_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(zh(e),null!=r&&"bool"===r)throw new Error("Unsupported data type ".concat(r));const i=new fS(t,n,r,!1,a),o=Ty(e,r);for(let s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});const pS=Lb({randomUniform_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0;zh(e);const i=Ty(e,r),o=new dS(t,n,null,a);for(let s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}});function gS(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";if(0===n)throw new Error("Cannot have a step of zero");const a={start:e,stop:t,step:n,dtype:r};return yb.runKernel(am,{},a)}const mS=Lb({relu_:function(e){const t={x:kb(e,"x","relu")};return yb.runKernel(sm,t)}});const vS=Lb({reverse_:function(e,t){const n={x:kb(e,"x","reverse")},r={dims:t};return yb.runKernel(pm,n,r)}});const bS=Lb({selu_:function(e){const t={x:kb(e,"x","selu")};return yb.runKernel(wm,t)}});const yS=Lb({separableConv2d_:function(e,t,n,r,a){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NHWC";const s=kb(e,"x","separableConv2d"),c=kb(t,"depthwiseFilter","separableConv2d"),u=kb(n,"pointwiseFilter","separableConv2d");let l=s,f=!1;if(3===s.rank&&(f=!0,l=$x(s,[1,s.shape[0],s.shape[1],s.shape[2]])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");fh(4===l.rank,(()=>"Error in separableConv2d: input must be rank 4, but got "+"rank ".concat(l.rank,"."))),fh(4===c.rank,(()=>"Error in separableConv2d: depthwise filter must be rank 4, but "+"got rank ".concat(c.rank,"."))),fh(4===u.rank,(()=>"Error in separableConv2d: pointwise filter must be rank 4, but "+"got rank ".concat(c.rank,"."))),fh(1===u.shape[0],(()=>"Error in separableConv2d: the first dimension of pointwise filter "+" must be 1, but got ".concat(u.shape[0],"."))),fh(1===u.shape[1],(()=>"Error in separableConv2d: the second dimension of pointwise "+"filter must be 1, but got ".concat(u.shape[1],".")));const d=c.shape[2],h=c.shape[3];fh(u.shape[2]===d*h,(()=>"Error in separableConv2d: the third dimension of pointwise filter "+"must be ".concat(d*h,", ")+"but got ".concat(u.shape[2],".")));const p=ww(l,c,r,a,o,i),g=hw(p,u,1,"valid",o);return f?$x(g,[g.shape[1],g.shape[2],g.shape[3]]):g}});const xS=Lb({sigmoid_:function(e){const t={x:kb(e,"x","sigmoid","float32")};return yb.runKernel(Em,t)}});const wS=Lb({slice_:function(e,t,n){const r=kb(e,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");const a={x:r},i={begin:t,size:n};return yb.runKernel(Sm,a,i)}});const SS=Lb({slice1d_:function(e,t,n){const r=kb(e,"x","slice1d");return fh(1===r.rank,(()=>"slice1d expects a rank-1 tensor, but got a rank-".concat(r.rank," tensor"))),wS(r,[t],[n])}});const CS=Lb({slice2d_:function(e,t,n){const r=kb(e,"x","slice2d");return fh(2===r.rank,(()=>"slice2d expects a rank-2 tensor, but got a rank-".concat(r.rank," tensor"))),wS(r,t,n)}});const MS=Lb({slice3d_:function(e,t,n){const r=kb(e,"x","slice3d");return fh(3===r.rank,(()=>"slice3d expects a rank-3 tensor, but got a rank-".concat(r.rank," tensor"))),wS(r,t,n)}});const _S=Lb({slice4d_:function(e,t,n){const r=kb(e,"x","slice4d");return fh(4===r.rank,(()=>"slice4d expects a rank-4 tensor, but got a rank-".concat(r.rank," tensor"))),wS(r,t,n)}});const ES=Lb({softmax_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;const n=kb(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and dim was ").concat(t));const r={logits:n},a={dim:t};return yb.runKernel(Am,r,a)}});const TS=Lb({softplus_:function(e){const t={x:kb(e,"x","softplus")};return yb.runKernel(Tm,t)}});const IS=Lb({split_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r={x:kb(e,"x","split")},a={numOrSizeSplits:t,axis:n};return yb.runKernel(Lm,r,a)}});const kS=Lb({squeeze_:function(e,t){const n=kb(e,"x","squeeze","string_or_numeric");return $x(n,Sh(n.shape,t).newShape)}});const NS=Lb({stack_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=Nb(e,"tensors","stack","string_or_numeric");fh(n.length>=1,(()=>"Pass at least one tensor to tf.stack")),n.length>0&&fh(t<=n[0].rank,(()=>"Axis must be <= rank of the tensor"));const r=n,a={axis:t};return yb.runKernel(Qg,r,a)}});const LS=Lb({tanh_:function(e){const t={x:kb(e,"x","tanh","float32")};return yb.runKernel(Xm,t)}});function AS(e,t){hh(e);const n=Eb(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Rb(e,null,n,t)}function RS(e,t,n){if(hh(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");const r=Eb(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Rb(e,t,r,n)}const DS=Lb({truncatedNormal_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(zh(e),null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");const i=new fS(t,n,r,!0,a),o=Ty(e,r);for(let s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});const OS=Lb({unstack_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=kb(e,"x","unstack","string_or_numeric");fh(t>=-n.shape.length&&t<n.shape.length,(()=>"Axis = ".concat(t," is not in [-").concat(n.shape.length,", ").concat(n.shape.length,")")));const r={value:n},a={axis:t};return yb.runKernel($m,r,a)}});const PS=Lb({where_:function(e,t,n){const r=kb(t,"a","where"),a=kb(n,"b","where"),i=kb(e,"condition","where","bool"),o=tx(tx(i.shape,r.shape),a.shape),s={condition:ow(i,o),t:ow(r,o),e:ow(a,o)};return yb.runKernel(xm,s)}});const FS=Lb({imag_:function(e){const t={input:kb(e,"input","imag")};return yb.runKernel(pg,t)}});const zS=Lb({real_:function(e){const t={input:kb(e,"input","real")};return yb.runKernel(im,t)}});const jS=Lb({transpose_:function(e,t,n){const r=kb(e,"x","transpose");if(null==t&&(t=r.shape.map(((e,t)=>t)).reverse()),fh(r.rank===t.length,(()=>"Error in transpose: rank of input ".concat(r.rank," ")+"must match length of perm ".concat(t,"."))),t.forEach((e=>{fh(e>=0&&e<r.rank,(()=>"All entries in 'perm' must be between 0 and ".concat(r.rank-1)+" but got ".concat(t)))})),r.rank<=1)return r.clone();const a={x:r},i={perm:t};return"complex64"===r.dtype?zb((()=>{let e=zS(r),t=FS(r);return e=yb.runKernel(Jm,{x:e},i),t=yb.runKernel(Jm,{x:t},i),n&&(t=nS(t)),Ab(e,t)})):yb.runKernel(Jm,a,i)}});const BS=Lb({dropout_:function(e,t,n,r){const a=kb(e,"x","dropout");if(fh("float32"===a.dtype,(()=>"x has to be a floating point tensor since it's going to be "+"scaled, but got a ".concat(a.dtype," tensor instead."))),fh(t>=0&&t<1,(()=>"rate must be a float in the range [0, 1), but got ".concat(t,"."))),0===t)return e instanceof Zv?a.clone():a;const i=function(e,t){if(null==t)return e.shape.slice();if(gh(e.shape,t))return t;if(e.shape.length===t.length){const n=[];for(let r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(a,n),o=1-t,s=Ry(kw(Ly(pS(i,0,1,"float32",r),o)),o);return Dy(a,s)}});const US=Lb({fft_:function(e){fh("complex64"===e.dtype,(()=>"The dtype for tf.spectral.fft() must be complex64 "+"but got ".concat(e.dtype,".")));const t={input:e};return yb.runKernel(ng,t)}});const WS=Lb({rfft_:function(e,t){fh("float32"===e.dtype,(()=>"The dtype for rfft() must be real value but got ".concat(e.dtype)));let n=e.shape[e.shape.length-1];const r=e.size/n;let a;if(null!=t&&t<n){const r=e.shape.map((e=>0)),i=e.shape.map((e=>e));i[e.shape.length-1]=t,a=wS(e,r,i),n=t}else if(null!=t&&t>n){const r=e.shape.map((e=>e));r[e.shape.length-1]=t-n,a=cw([e,iS(r)],e.shape.length-1),n=t}else a=e;const i=Fy(a),o=$x(Ab(a,i),[r,n]),s=US(o),c=Math.floor(n/2)+1,u=zS(s),l=FS(s),f=IS(u,[c,n-c],u.shape.length-1),d=IS(l,[c,n-c],l.shape.length-1),h=a.shape.slice();return h[a.shape.length-1]=c,$x(Ab(f[0],d[0]),h)}});const GS=Lb({ifft_:function(e){fh("complex64"===e.dtype,(()=>"The dtype for tf.spectral.ifft() must be complex64 "+"but got ".concat(e.dtype,".")));const t={input:e};return yb.runKernel(hg,t)}});const VS=Lb({irfft_:function(e){const t=e.shape[e.shape.length-1],n=e.size/t;let r;if(t<=2){const a=$x(e,[n,t]);r=GS(a)}else{const a=[n,2*(t-1)],i=$x(zS(e),[n,t]),o=$x(FS(e),[n,t]),s=vS(wS(i,[0,1],[n,t-2]),1),c=Dy(vS(wS(o,[0,1],[n,t-2]),1),jy(-1)),u=cw([i,s],1),l=cw([o,c],1),f=$x(Ab(u,l),[a[0],a[1]]);r=GS(f)}if(r=zS(r),3===e.rank&&0!==e.shape[0]){const t=r,n=e.shape[0];r=$x(r,[n,r.shape[0]/n,r.shape[1]]),t.dispose()}return r}});const HS=Lb({conv2DBackpropFilter_:function(e,t,n,r,a){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=$x(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let c=t;3===c.rank&&(c=$x(t,[1,t.shape[0],t.shape[1],t.shape[2]])),fh(4===s.rank,(()=>"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(s.shape,"."))),fh(4===c.rank,(()=>"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(c.shape,"."))),fh(4===n.length,(()=>"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(n,".")));const u="NHWC"===i?s.shape[3]:s.shape[1],l="NHWC"===i?c.shape[3]:c.shape[1];fh(u===n[2],(()=>"Error in conv2dDerFilter: depth of input ".concat(u,") must ")+"match input depth in filter (".concat(n[2],"."))),fh(l===n[3],(()=>"Error in conv2dDerFilter: depth of dy (".concat(l,") must ")+"match output depth for filter (".concat(n[3],")."))),Zx("conv2dDerFilter",a,o);const f={x:s,dy:c},d={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:n};return yb.runKernel(Tp,f,d)}});const YS=Lb({relu6_:function(e){const t={x:kb(e,"x","relu6")};return yb.runKernel(hm,t)}});const XS=Lb({step_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n={x:kb(e,"x","step")},r={alpha:t};return yb.runKernel(nv,n,r)}});function qS(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return Dy(e,XS(t));throw new Error("Cannot compute gradient for fused activation ".concat(n,"."))}function KS(e,t){let n=t;const r=ex(e.shape,t.shape);return r.length>0&&(n=Fw(n,r)),$x(n,e.shape)}function QS(e,t,n,r){if("linear"===t)return e;if("relu"===t)return mS(e);if("elu"===t)return Sw(e);if("relu6"===t)return YS(e);if("prelu"===t)return uS(e,n);if("leakyrelu"===t)return Rw(e,r);if("sigmoid"===t)return xS(e);throw new Error("Unknown fused activation ".concat(t,"."))}const JS=(e,t)=>!(e>0)||"linear"===t;const ZS=Lb({fusedConv2d_:function(e){let{x:t,filter:n,strides:r,pad:a,dataFormat:i="NHWC",dilations:o=[1,1],dimRoundingMode:s,bias:c,activation:u="linear",preluActivationWeights:l,leakyreluAlpha:f}=e;if(u=u||"linear",!1===JS(yb.state.gradientDepth,u)){fh("NHWC"===i,(()=>"Error in fused conv2d: got dataFormat of ".concat(i," but ")+"only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear."));let e=hw(t,n,r,a,i,o,s);return null!=c&&(e=Ly(e,c)),QS(e,u,l,f)}const d=kb(t,"x","conv2d","float32"),h=kb(n,"filter","conv2d","float32");let p=d,g=!1;3===d.rank&&(g=!0,p=$x(d,[1,d.shape[0],d.shape[1],d.shape[2]])),fh(4===p.rank,(()=>"Error in fused conv2d: input must be rank 4, but got rank "+"".concat(p.rank,"."))),fh(4===h.rank,(()=>"Error in fused conv2d: filter must be rank 4, but got rank "+"".concat(h.rank,"."))),Zx("fused conv2d",a,s);const m="NHWC"===i?p.shape[3]:p.shape[1];fh(h.shape[2]===m,(()=>"Error in conv2d: depth of input (".concat(m,") must match ")+"input depth for filter ".concat(h.shape[2],"."))),fh(Kx(r,o),(()=>"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(r," and dilations '").concat(o,"'")));const v=Ux(p.shape,h.shape,r,o,a,s);let b,y;if(null!=c&&(b=kb(c,"bias","fused conv2d"),[b]=fb(b,d),"NHWC"===i?tx(v.outShape,b.shape):(fh(b.shape.length<=1,(()=>"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of "+"rank-".concat(b.shape.length,"."))),fh(0===b.shape.length||b.shape[0]===v.outChannels||1===b.shape[0],(()=>"Error in fused conv2d: bias shape (".concat(b.shape,") is not ")+"compatible with the number of output channels "+"(".concat(v.outChannels,")"))))),null!=l){const e=l.shape;if(fh(e.length<=1||3===e.length,(()=>"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of "+"rank-".concat(e.length,"."))),1===e.length)fh(1===e[0]||e[0]===v.outChannels,(()=>"Error in fused conv2d: PReLU activation weights "+"(".concat(e,") is not compatible with the number of output ")+"channels (".concat(v.outChannels,").")));else if(3===e.length)try{tx(e,v.outShape)}catch(IQ){const n="Error in fused conv2d: PReLU activation weights (".concat(e,") ")+"is not compatible with the output shape of the conv2d "+"(".concat(v.outShape,").");throw Error(n)}y=kb(l,"prelu weights","fused conv2d")}const x=(e,t)=>{fh("NHWC"===i,(()=>"Error in gradient of fused conv2D: got dataFormat of ".concat(i," but only NHWC is currently supported.")));const[n,s,c,l]=t,f=qS(e,c,u);fh(qx(o),(()=>"Error in gradient of fused conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(o,"'")));const d=[gw(s.shape,f,n,r,a),HS(s,f,n.shape,r,a)];if(null!=l){const e=KS(l,f);d.push(e)}return d},w={x:p,filter:h,bias:b,preluActivationWeights:y},S={strides:r,pad:a,dataFormat:i,dilations:o,dimRoundingMode:s,activation:u,leakyreluAlpha:f};if(null==c){const e=zy(((e,t,n)=>{let r=yb.runKernel(ov,w,S);return n([t,e,r]),g&&(r=$x(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:x}}));return e(p,h)}{const e=zy(((e,t,n,r)=>{let a=yb.runKernel(ov,w,S);return r([t,e,a,n]),g&&(a=$x(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:x}}));return e(p,h,b)}}});const $S=Lb({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,r,a){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=$x(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let c=t;3===c.rank&&(c=$x(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const u={x:s,dy:c},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,filterShape:n};return yb.runKernel(Bp,u,l)}});const eC=Lb({depthwiseConv2dNativeBackpropInput_:function(e,t,n,r,a){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=t,c=!1;3===t.rank&&(c=!0,s=$x(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const u={dy:s,filter:n},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,inputShape:e},f=yb.runKernel(Up,u,l);return c?$x(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});const tC=Lb({fusedMatMul_:function(e){let{a:t,b:n,transposeA:r=!1,transposeB:a=!1,bias:i,activation:o="linear",preluActivationWeights:s,leakyreluAlpha:c=.2}=e;if(!1===JS(yb.state.gradientDepth,o)){let e=Kw(t,n,r,a);return null!=i&&(e=Ly(e,i)),QS(e,o,s,c)}let u=kb(t,"a","fused matMul"),l=kb(n,"b","fused matMul");[u,l]=fb(u,l);const f=r?u.shape[u.rank-2]:u.shape[u.rank-1],d=a?l.shape[l.rank-1]:l.shape[l.rank-2],h=r?u.shape[u.rank-1]:u.shape[u.rank-2],p=a?l.shape[l.rank-2]:l.shape[l.rank-1],g=u.shape.slice(0,-2),m=l.shape.slice(0,-2),v=ph(g),b=ph(m);fh(f===d,(()=>"Error in fused matMul: inner shapes (".concat(f,") and (")+"".concat(d,") of Tensors with shapes ").concat(u.shape," and ")+"".concat(l.shape," and transposeA=").concat(r)+" and transposeB=".concat(a," must match.")));const y=tx(u.shape.slice(0,-2),l.shape.slice(0,-2)).concat([h,p]),x=$x(u,r?[v,f,h]:[v,h,f]),w=$x(l,a?[b,p,d]:[b,d,p]);let S,C;null!=i&&(S=kb(i,"bias","fused matMul"),[S]=fb(S,u),tx(y,S.shape)),null!=s&&(C=kb(s,"prelu weights","fused matMul"));const M=(e,t)=>{const[n,s,c,u]=t,l=qS($x(e,c.shape),c,o);let f,d;if(r||a?!r&&a?(f=Kw(l,s,!1,!1),d=Kw(l,n,!0,!1)):r&&!a?(f=Kw(s,l,!1,!0),d=Kw(n,l,!1,!1)):(f=Kw(s,l,!0,!0),d=Kw(l,n,!0,!0)):(f=Kw(l,s,!1,!0),d=Kw(n,l,!0,!1)),null!=i){return[f,d,KS(u,l)]}return[f,d]},_={a:x,b:w,bias:S,preluActivationWeights:C},E={transposeA:r,transposeB:a,activation:o,leakyreluAlpha:c};if(null==i){const e=zy(((e,t,n)=>{const r=yb.runKernel(iv,_,E);return n([e,t,r]),{value:$x(r,y),gradFunc:M}}));return e(x,w)}{const e=zy(((e,t,n,r)=>{const a=yb.runKernel(iv,_,E);return r([e,t,a,n]),{value:$x(a,y),gradFunc:M}}));return e(x,w,S)}}});const nC=Lb({cropAndResize_:function(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"bilinear",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const o=kb(e,"image","cropAndResize"),s=kb(t,"boxes","cropAndResize","float32"),c=kb(n,"boxInd","cropAndResize","int32"),u=s.shape[0];fh(4===o.rank,(()=>"Error in cropAndResize: image must be rank 4,"+"but got rank ".concat(o.rank,"."))),fh(2===s.rank&&4===s.shape[1],(()=>"Error in cropAndResize: boxes must be have size [".concat(u,",4] ")+"but had shape ".concat(s.shape,"."))),fh(1===c.rank&&c.shape[0]===u,(()=>"Error in cropAndResize: boxInd must be have size [".concat(u,"] ")+"but had shape ".concat(s.shape,"."))),fh(2===r.length,(()=>"Error in cropAndResize: cropSize must be of length 2, but got "+"length ".concat(r.length,"."))),fh(r[0]>=1&&r[1]>=1,(()=>"cropSize must be atleast [1,1], but was ".concat(r))),fh("bilinear"===a||"nearest"===a,(()=>"method must be bilinear or nearest, but was ".concat(a)));const l={image:o,boxes:s,boxInd:c},f={method:a,extrapolationValue:i,cropSize:r};return yb.runKernel(Pp,l,f)}});const rC=Lb({flipLeftRight_:function(e){const t=kb(e,"image","flipLeftRight","float32");fh(4===t.rank,(()=>"Error in flipLeftRight: image must be rank 4,"+"but got rank ".concat(t.rank,".")));const n={image:t};return yb.runKernel(ag,n,{})}});const aC=Lb({grayscaleToRGB_:function(e){const t=kb(e,"image","grayscaleToRGB"),n=t.rank-1,r=t.shape[n];fh(t.rank>=2,(()=>"Error in grayscaleToRGB: images must be at least rank 2, "+"but got rank ".concat(t.rank,"."))),fh(1===r,(()=>"Error in grayscaleToRGB: last dimension of a grayscale image "+"should be size 1, but got size ".concat(r,".")));const a=new Array(t.rank);return a.fill(1,0,n),a[n]=3,Tw(t,a)}});const iC=Lb({einsum_:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const a=n.map(((e,t)=>kb(e,"tensors".concat(t),"einsum"))),i={equation:e};return yb.runKernel(qp,a,i)}});const oC=Lb({rgbToGrayscale_:function(e){const t=kb(e,"image","RGBToGrayscale"),n=t.rank-1,r=t.shape[n];fh(t.rank>=2,(()=>"Error in RGBToGrayscale: images must be at least rank 2, "+"but got rank ".concat(t.rank,"."))),fh(3===r,(()=>"Error in RGBToGrayscale: last dimension of an RGB image "+"should be size 3, but got size ".concat(r,".")));const a=t.dtype,i=Iy(t,"float32"),o=AS([.2989,.587,.114]);let s;switch(t.rank){case 2:s=iC("ij,j->i",i,o);break;case 3:s=iC("ijk,k->ij",i,o);break;case 4:s=iC("ijkl,l->ijk",i,o);break;case 5:s=iC("ijklm,m->ijkl",i,o);break;case 6:s=iC("ijklmn,n->ijklm",i,o);break;default:throw new Error("Not a valid tensor rank.")}return s=Ew(s,-1),Iy(s,a)}});const sC=Lb({rotateWithOffset_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;const a=kb(e,"image","rotateWithOffset","float32");fh(4===a.rank,(()=>"Error in rotateWithOffset: image must be rank 4,"+"but got rank ".concat(a.rank,".")));const i={image:a},o={radians:t,fillValue:n,center:r};return yb.runKernel(av,i,o)}});function cC(e,t,n,r,a,i){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==i&&(i=0);const o=e.shape[0];return n=Math.min(n,o),fh(0<=r&&r<=1,(()=>"iouThreshold must be in [0, 1], but was '".concat(r,"'"))),fh(2===e.rank,(()=>"boxes must be a 2D tensor, but was of rank '".concat(e.rank,"'"))),fh(4===e.shape[1],(()=>"boxes must have 4 columns, but 2nd dimension was ".concat(e.shape[1]))),fh(1===t.rank,(()=>"scores must be a 1D tensor")),fh(t.shape[0]===o,(()=>"scores has incompatible shape with boxes. Expected ".concat(o,", ")+"but was ".concat(t.shape[0]))),fh(0<=i&&i<=1,(()=>"softNmsSigma must be in [0, 1], but was '".concat(i,"'"))),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}const uC=Lb({nonMaxSuppression_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY;const i=kb(e,"boxes","nonMaxSuppression","float32"),o=kb(t,"scores","nonMaxSuppression","float32"),s=cC(i,o,n,r,a);n=s.maxOutputSize,r=s.iouThreshold,a=s.scoreThreshold;const c={maxOutputSize:n,iouThreshold:r,scoreThreshold:a};return yb.runKernel(Hg,{boxes:i,scores:o},c)}});function lC(e,t,n){const r=function(e,t,n){return function(e,t,n){let r=0,a=e.length,i=0,o=!1;for(;r<a;){i=r+(a-r>>>1);const s=n(t,e[i]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}(e,t,n||fC)}(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function fC(e,t){return e>t?1:e<t?-1:0}function dC(e,t,n,r,a){return gC(e,t,n,r,a,0)}function hC(e,t,n,r,a,i){return gC(e,t,n,r,a,0,!1,i,!0)}function pC(e,t,n,r,a,i){return gC(e,t,n,r,a,i,!0)}function gC(e,t,n,r,a,i){let o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const u=[];for(let m=0;m<t.length;m++)t[m]>a&&u.push({score:t[m],boxIndex:m,suppressBeginIndex:0});u.sort(bC);const l=i>0?-.5/i:0,f=[],d=[];for(;f.length<n&&u.length>0;){const t=u.pop(),{score:n,boxIndex:i,suppressBeginIndex:o}=t;if(n<a)break;let s=!1;for(let c=f.length-1;c>=o;--c){const n=mC(e,i,f[c]);if(n>=r){s=!0;break}if(t.score=t.score*vC(r,l,n),t.score<=a)break}t.suppressBeginIndex=f.length,s||(t.score===n?(f.push(i),d.push(t.score)):t.score>a&&lC(u,t,bC))}const h=f.length,p=n-h;s&&p>0&&(f.push(...new Array(p).fill(0)),d.push(...new Array(p).fill(0)));const g={selectedIndices:f};return o&&(g.selectedScores=d),c&&(g.validOutputs=h),g}function mC(e,t,n){const r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),c=Math.max(r[1],r[3]),u=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),f=Math.max(a[0],a[2]),d=Math.max(a[1],a[3]),h=(s-i)*(c-o),p=(f-u)*(d-l);if(h<=0||p<=0)return 0;const g=Math.max(i,u),m=Math.max(o,l),v=Math.min(s,f),b=Math.min(c,d),y=Math.max(v-g,0)*Math.max(b-m,0);return y/(h+p-y)}function vC(e,t,n){const r=Math.exp(t*n*n);return n<=e?r:0}function bC(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}const yC=async function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY;const i=kb(e,"boxes","nonMaxSuppressionAsync"),o=kb(t,"scores","nonMaxSuppressionAsync"),s=cC(i,o,n,r,a);n=s.maxOutputSize,r=s.iouThreshold,a=s.scoreThreshold;const c=await Promise.all([i.data(),o.data()]),u=c[0],l=c[1],{selectedIndices:f}=dC(u,l,n,r,a);return i!==e&&i.dispose(),o!==t&&o.dispose(),AS(f,"int32")};const xC=Lb({nonMaxSuppressionWithScore_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const o=kb(e,"boxes","nonMaxSuppression"),s=kb(t,"scores","nonMaxSuppression"),c=cC(o,s,n,r,a,i);n=c.maxOutputSize,r=c.iouThreshold,a=c.scoreThreshold,i=c.softNmsSigma;const u={boxes:o,scores:s},l={maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i},f=yb.runKernel(Xg,u,l);return{selectedIndices:f[0],selectedScores:f[1]}}});const wC=async function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const o=kb(e,"boxes","nonMaxSuppressionAsync"),s=kb(t,"scores","nonMaxSuppressionAsync"),c=cC(o,s,n,r,a,i);n=c.maxOutputSize,r=c.iouThreshold,a=c.scoreThreshold,i=c.softNmsSigma;const u=await Promise.all([o.data(),s.data()]),l=u[0],f=u[1],{selectedIndices:d,selectedScores:h}=pC(l,f,n,r,a,i);return o!==e&&o.dispose(),s!==t&&s.dispose(),{selectedIndices:AS(d,"int32"),selectedScores:AS(h)}};const SC=Lb({nonMaxSuppressionPadded_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const o=kb(e,"boxes","nonMaxSuppression"),s=kb(t,"scores","nonMaxSuppression"),c=cC(o,s,n,r,a,null),u={boxes:o,scores:s},l={maxOutputSize:c.maxOutputSize,iouThreshold:c.iouThreshold,scoreThreshold:c.scoreThreshold,padToMaxOutputSize:i},f=yb.runKernel(Yg,u,l);return{selectedIndices:f[0],validOutputs:f[1]}}});const CC=async function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const o=kb(e,"boxes","nonMaxSuppressionAsync"),s=kb(t,"scores","nonMaxSuppressionAsync"),c=cC(o,s,n,r,a,null),u=c.maxOutputSize,l=c.iouThreshold,f=c.scoreThreshold,[d,h]=await Promise.all([o.data(),s.data()]),{selectedIndices:p,validOutputs:g}=hC(d,h,u,l,f,i);return o!==e&&o.dispose(),s!==t&&s.dispose(),{selectedIndices:AS(p,"int32"),validOutputs:jy(g,"int32")}};const MC=Lb({resizeBilinear_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=kb(e,"images","resizeBilinear");fh(3===a.rank||4===a.rank,(()=>"Error in resizeBilinear: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,"."))),fh(2===t.length,(()=>"Error in resizeBilinear: new shape must 2D, but got shape "+"".concat(t,"."))),fh(!1===r||!1===n,(()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."));let i=a,o=!1;3===a.rank&&(o=!0,i=$x(a,[1,a.shape[0],a.shape[1],a.shape[2]]));const[]=t,s={images:i},c={alignCorners:n,halfPixelCenters:r,size:t},u=yb.runKernel(fm,s,c);return o?$x(u,[u.shape[1],u.shape[2],u.shape[3]]):u}});const _C=Lb({resizeNearestNeighbor_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=kb(e,"images","resizeNearestNeighbor");fh(3===a.rank||4===a.rank,(()=>"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,"."))),fh(2===t.length,(()=>"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+"".concat(t,"."))),fh("float32"===a.dtype||"int32"===a.dtype,(()=>"`images` must have `int32` or `float32` as dtype")),fh(!1===r||!1===n,(()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."));let i=a,o=!1;3===a.rank&&(o=!0,i=$x(a,[1,a.shape[0],a.shape[1],a.shape[2]]));const[]=t,s={images:i},c={alignCorners:n,halfPixelCenters:r,size:t},u=yb.runKernel(um,s,c);return o?$x(u,[u.shape[1],u.shape[2],u.shape[3]]):u}});const EC=Lb({bincount_:function(e,t,n){const r=kb(e,"x","bincount"),a=kb(t,"weights","bincount");fh("int32"===r.dtype,(()=>"Error in bincount: input "+"dtype must be int32, but got ".concat(r.dtype))),fh(n>=0,(()=>"size must be non-negative, but got ".concat(n,"."))),fh(a.size===r.size||0===a.size,(()=>"Error in bincount: weights must have the same size as input or"+"0-length, but got input shape: ".concat(r.shape,", weights shape: ")+"".concat(a.shape,".")));const i={x:r,weights:a},o={size:n};return yb.runKernel(vp,i,o)}});const TC=Lb({lessEqual_:function(e,t){let n=kb(e,"a","lessEqual","string_or_numeric"),r=kb(t,"b","lessEqual","string_or_numeric");[n,r]=fb(n,r),tx(n.shape,r.shape);const a={a:n,b:r};return yb.runKernel(xg,a)}});const IC=Lb({round_:function(e){const t={x:kb(e,"x","round")};return yb.runKernel(gm,t)}});const kC=Lb({threshold_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"binary",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;const a=kb(e,"image","threshold"),i=a.shape[0]*a.shape[1];let o,s,c,u,l=Dy(AS([r]),255);if(fh(3===a.rank,(()=>"Error in threshold: image must be rank 3,"+"but got rank ".concat(a.rank,"."))),fh(3===a.shape[2]||1===a.shape[2],(()=>"Error in threshold: image color channel must be equal to 3 or 1"+"but got ".concat(a.shape[2],"."))),fh("int32"===a.dtype||"float32"===a.dtype,(()=>"Error in dtype: image dtype must be int32 or float32,"+"but got dtype ".concat(a.dtype,"."))),fh("otsu"===t||"binary"===t,(()=>"Method must be binary or otsu, but was ".concat(t))),3===a.shape[2]){[o,s,c]=IS(a,[1,1,1],-1);const e=Dy(o,.2989),t=Dy(s,.587),n=Dy(c,.114);u=Ly(Ly(e,t),n)}else u=e;if("otsu"===t){l=function(e,t){let n,r,a,i,o,s,c=AS([-1]),u=AS([0]),l=AS([0]);for(let f=0;f<e.size-1;f++){n=wS(e,0,f+1),r=wS(e,f+1),o=Ry(Fw(n),t),s=Ry(Fw(r),t);const d=Fw(Dy(n,gS(0,n.size)));a=Ry(d,Fw(n));const h=Xy(r.shape,n.size),p=Ly(gS(0,r.size),h),g=Dy(r,p);i=Ry(Fw(g),Fw(r));const m=Qy(a,i),v=Qy(a,i),b=Dy(o,s);l=Dy(Dy(b,m),v);const y=Lw(l,u);u=PS(y,l,u),c=PS(y,AS([f]),c)}return c}(EC(Iy(IC(u),"int32"),Db([]),256),i)}const f=n?TC(u,l):Lw(u,l);return Iy(Dy(f,255),"int32")}});const NC=Lb({transform_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nearest",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"constant",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5?arguments[5]:void 0;const o=kb(e,"image","transform","float32"),s=kb(t,"transforms","transform","float32");fh(4===o.rank,(()=>"Error in transform: image must be rank 4,"+"but got rank ".concat(o.rank,"."))),fh(2===s.rank&&(s.shape[0]===o.shape[0]||1===s.shape[0])&&8===s.shape[1],(()=>"Error in transform: Input transform should be batch x 8 or 1 x 8")),fh(null==i||2===i.length,(()=>"Error in transform: outputShape must be [height, width] or null, "+"but got ".concat(i,".")));const c={image:o,transforms:s},u={interpolation:n,fillMode:r,fillValue:a,outputShape:i};return yb.runKernel(Qm,c,u)}});const LC=Lb({less_:function(e,t){let n=kb(e,"a","less","string_or_numeric"),r=kb(t,"b","less","string_or_numeric");[n,r]=fb(n,r),tx(n.shape,r.shape);const a={a:n,b:r};return yb.runKernel(yg,a)}});const AC=Lb({bandPart_:function(e,t,n){const r=kb(e,"a","bandPart");fh(r.rank>=2,(()=>"bandPart(): Rank must be at least 2, got ".concat(r.rank,".")));const a=r.shape,[i,o]=r.shape.slice(-2);let s,c;"number"===typeof t?(fh(t%1===0,(()=>"bandPart(): numLower must be an integer, got ".concat(t,"."))),fh(t<=i,(()=>"bandPart(): numLower (".concat(t,")")+" must not be greater than the number of rows (".concat(i,")."))),s=kb(t<0?i:t,"numLower","bandPart")):(fh("int32"===t.dtype,(()=>"bandPart(): numLower's dtype must be an int32.")),s=PS(LC(t,0),i,eS(t,i))),"number"===typeof n?(fh(n%1===0,(()=>"bandPart(): numUpper must be an integer, got ".concat(n,"."))),fh(n<=o,(()=>"bandPart(): numUpper (".concat(n,")")+" must not be greater than the number of columns (".concat(o,")."))),c=kb(n<0?o:n,"numUpper","bandPart")):(fh("int32"===n.dtype,(()=>"bandPart(): numUpper's dtype must be an int32.")),c=PS(LC(n,0),o,eS(n,o)));const u=$x(gS(0,i,1,"int32"),[-1,1]),l=gS(0,o,1,"int32"),f=Qy(u,l),d=qw(TC(f,s),Aw(f,nS(c))),h=iS([i,o],r.dtype);return $x(NS(OS($x(r,[-1,i,o])).map((e=>PS(d,e,h)))),a)}});function RC(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(0===e.rank)return Zy(e);if(1!==e.rank&&null===n)return RC($x(e,[-1]),t,n);if(1===e.rank||"number"===typeof n||Array.isArray(n)&&1===n.length){if(1===t)return Fw(Zy(e),n);if(t===1/0)return Pw(Zy(e),n);if(t===-1/0)return $w(Zy(e),n);if("euclidean"===t||2===t)return Oy(Fw(Ky(Zy(e),jy(2,"int32")),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}if(Array.isArray(n)&&2===n.length){if(1===t)return Pw(Fw(Zy(e),n[0]),n[1]-1);if(t===1/0)return Pw(Fw(Zy(e),n[1]),n[0]);if(t===-1/0)return $w(Fw(Zy(e),n[1]),n[0]);if("fro"===t||"euclidean"===t)return Oy(Fw(Py(e),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}throw new Error("Error in norm: invalid axis: ".concat(n))}const DC=Lb({norm_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"euclidean",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=RC(e=kb(e,"x","norm"),t,n);let i=a.shape;if(r){const t=wh(n,e.shape);i=Ww(a.shape,t)}return $x(a,i)}});const OC=Lb({gramSchmidt_:function(e){let t;if(Array.isArray(e)){t=!1,fh(null!=e&&e.length>0,(()=>"Gram-Schmidt process: input must not be null, undefined, or empty"));const n=e[0].shape[0];for(let t=1;t<e.length;++t)fh(e[t].shape[0]===n,(()=>"Gram-Schmidt: Non-unique lengths found in the input vectors: "+"(".concat(e[t].shape[0]," vs. ").concat(n,")")))}else t=!0,e=IS(e,e.shape[0],0).map((e=>kS(e,[0])));fh(e.length<=e[0].shape[0],(()=>"Gram-Schmidt: Number of vectors (".concat(e.length,") exceeds ")+"number of dimensions (".concat(e[0].shape[0],").")));const n=[],r=e;for(let a=0;a<e.length;++a)n.push(yb.tidy((()=>{let e=r[a];if(a>0)for(let t=0;t<a;++t){const r=Dy(Fw(Dy(n[t],e)),n[t]);e=Qy(e,r)}return Ry(e,DC(e,"euclidean"))})));return t?NS(n,0):n}});function PC(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return yb.tidy((()=>{fh(2===e.shape.length,(()=>"qr2d() requires a 2D Tensor, but got a ".concat(e.shape.length,"D Tensor.")));const n=e.shape[0],r=e.shape[1];let a=Iw(n),i=ky(e);const o=RS([[1]],[1,1]);let s=ky(o);const c=n>=r?r:n;for(let e=0;e<c;++e){const t=i,c=s,u=a;[s,i,a]=yb.tidy((()=>{const t=wS(i,[e,e],[n-e,1]),c=DC(t),u=wS(i,[e,e],[1,1]),l=PS(Lw(u,0),RS([[-1]]),RS([[1]])),f=Qy(u,Dy(l,c)),d=Ry(t,f);s=1===d.shape[0]?ky(o):cw([o,wS(d,[1,0],[d.shape[0]-1,d.shape[1]])],0);const h=nS(Ry(Kw(l,f),c)),p=wS(i,[e,0],[n-e,r]),g=Dy(h,s),m=jS(s);if(0===e)i=Qy(p,Kw(g,Kw(m,p)));else{const t=Qy(p,Kw(g,Kw(m,p)));i=cw([wS(i,[0,0],[e,r]),t],0)}const v=jS(g),b=wS(a,[0,e],[n,a.shape[1]-e]);if(0===e)a=Qy(b,Kw(Kw(b,s),v));else{const t=Qy(b,Kw(Kw(b,s),v));a=cw([wS(a,[0,0],[n,e]),t],1)}return[s,i,a]})),jb([t,c,u])}return!t&&n>r&&(a=wS(a,[0,0],[n,r]),i=wS(i,[0,0],[r,r])),[a,i]}))}const FC=Lb({qr_:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(fh(e.rank>=2,(()=>"qr() requires input tensor to have a rank >= 2, but got rank ".concat(e.rank))),2===e.rank)return PC(e,t);{const n=e.shape.slice(0,e.shape.length-2).reduce(((e,t)=>e*t)),r=OS($x(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],i=[];r.forEach((e=>{const[n,r]=PC(e,t);a.push(n),i.push(r)}));return[$x(NS(a,0),e.shape),$x(NS(i,0),e.shape)]}}});var zC;!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(zC||(zC={}));const jC=Lb({squaredDifference_:function(e,t){let n=kb(e,"a","squaredDifference"),r=kb(t,"b","squaredDifference");[n,r]=fb(n,r),tx(n.shape,r.shape);const a={a:n,b:r};return yb.runKernel(zm,a,{})}});const BC={flipLeftRight:rC,grayscaleToRGB:aC,resizeNearestNeighbor:_C,resizeBilinear:MC,rgbToGrayscale:oC,rotateWithOffset:sC,cropAndResize:nC,nonMaxSuppression:uC,nonMaxSuppressionAsync:yC,nonMaxSuppressionWithScore:xC,nonMaxSuppressionWithScoreAsync:wC,nonMaxSuppressionPadded:SC,nonMaxSuppressionPaddedAsync:CC,threshold:kC,transform:NC},UC={bandPart:AC,gramSchmidt:OC,qr:FC};const WC=class{static sgd(e){return new ax(e)}static momentum(e,t){return new ix(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2])}static rmsprop(e){return new ox(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}static adam(){return new Jy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}static adadelta(){return new Yy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.95,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}static adamax(){return new rx(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.002,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]?arguments[4]:0)}static adagrad(e){return new qy(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1)}},GC="undefined"!==typeof requestAnimationFrame?requestAnimationFrame:"undefined"!==typeof setImmediate?setImmediate:e=>e();function VC(){return new Promise((e=>GC((()=>e()))))}function HC(e,t){const n=e[0].length;e.forEach(((e,t)=>{fh(e.length===n,(()=>"Error in concat".concat(n,"D: rank of tensors[").concat(t,"] must be the same ")+"as the rank of the rest (".concat(n,")")))})),fh(t>=0&&t<n,(()=>"Error in concat".concat(n,"D: axis must be between 0 and ").concat(n-1,".")));const r=e[0];e.forEach(((e,a)=>{for(let i=0;i<n;i++)fh(i===t||e[i]===r[i],(()=>"Error in concat".concat(n,"D: Shape of tensors[").concat(a,"] (").concat(e,") ")+"does not match the shape of the rest (".concat(r,") ")+"along the non-concatenated axis ".concat(a,".")))}))}function YC(e,t){const n=e[0].slice();for(let r=1;r<e.length;r++)n[t]+=e[r][t];return n}var XC;function qC(e,t,n){let r=new Array;if(null==n&&null==t)return r;if(null==t)for(;r.length<e+n.length;)r.push(-1);else r=t.slice();if(null==n)return r;if(e+n.length!==r.length)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.rank = ").concat(e+n.length,", but shape.rank = ").concat(r.length));for(let a=1;a<n.length;++a){const i=n[a],o=r[r.length-n.length+a],s=r[o];if(i>=0)if(s>=0){if(s!==i)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.shape[").concat(a+e,"] = ").concat(i," but shape[").concat(a+e,"] = ").concat(s))}else r[o]=i}return r}function KC(e){const t={FIRST_DIM_SIZE:XC.FIRST_DIM_SIZE,VALUE_ROWIDS:XC.VALUE_ROWIDS,ROW_LENGTHS:XC.ROW_LENGTHS,ROW_SPLITS:XC.ROW_SPLITS,ROW_LIMITS:XC.ROW_LIMITS,ROW_STARTS:XC.ROW_STARTS},n=[];for(const r of e){if(!(r in t))break;n.push(t[r])}return n}function QC(e){return 0===e.length?0:e[0]===XC.FIRST_DIM_SIZE?e.length-1:e.length}function JC(e,t){if(null==e||null==t)return;const n=e.length,r=t.length;if(n>=r)throw new Error("defaultValue.shape=".concat(e," and ragged tensor flatValues.shape=").concat(t,", are incompatible: defaultValue.rank = ").concat(n," must be less than ragged tensor input flatValues.rank = ").concat(r,")"));for(let a=0;a<Math.min(n,r-1);++a){const n=e[a],r=t[a+1];if(n>=0&&r>=0&&1!==n&&n!==r)throw new Error("defaultValue.shape=".concat(e,", and ragged tensor input flatValues.shape=").concat(t," are incompatible: defaultValue.shape[").concat(a-e.length,"] = ").concat(n," but ragged tensor input.flatValues.shape[").concat(a-e.length,"] = ").concat(r))}}!function(e){e[e.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",e[e.VALUE_ROWIDS=1]="VALUE_ROWIDS",e[e.ROW_LENGTHS=2]="ROW_LENGTHS",e[e.ROW_SPLITS=3]="ROW_SPLITS",e[e.ROW_LIMITS=4]="ROW_LIMITS",e[e.ROW_STARTS=5]="ROW_STARTS"}(XC||(XC={}));const ZC=30;function $C(e){return e<=ZC?e:Lh(e,Math.floor(Math.sqrt(e)))}function eM(e,t,n){return[n*("number"===typeof e?e:e[0]),t*("number"===typeof e?e:e[1])]}function tM(e,t,n){let r=[];if(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])r=r.concat(t.slice(0)),r.push(e[0]/n),r=r.concat(e.slice(1));else{r=r.concat(e[0]);const n=t.length;for(let a=0;a<n;++a)r=r.concat([e[a+1]/t[a],t[a]]);r=r.concat(e.slice(n+1))}return r}function nM(e,t){const n=[];if(!(arguments.length>2&&void 0!==arguments[2])||arguments[2]){n.push(t);for(let r=t+1;r<e;++r)r<=2*t?(n.push(r),n.push(r-(t+1))):n.push(r)}else{const r=[],a=[];for(let n=1;n<e;++n)n>=2*t+1||n%2===1?a.push(n):r.push(n);n.push(...r),n.push(0),n.push(...a)}return n}function rM(e,t,n){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(let i=1;i<e.length;++i)i<=t.length?r?a.push(t[i-1]*e[i]):a.push(e[i]/t[i-1]):a.push(e[i]);return a}function aM(e,t){const n=[0];for(let r=0;r<t;++r)n.push(e[r][0]);return n}function iM(e,t,n){const r=e.slice(0,1);for(let a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}function oM(e,t){const n=e.shape.length,r=t.shape.length;if(n<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher,"+" but the rank was ".concat(n,"."));if(r<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(r,"."));if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type,"+" but the dtype was ".concat(t.dtype,"."));if(t.shape[r-1]>n)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+"".concat(t.shape[r-1]," vs. ").concat(n));if(0===ph(e.shape))throw new Error("Requested more than 0 entries, but input is empty."+" Input shape: ".concat(e.shape,"."));const a=t.shape,i=a[a.length-1];let o=1;for(let f=0;f<a.length-1;++f)o*=a[f];const s=e.shape,c=a.slice();c.pop();let u=1;for(let f=i;f<n;++f)u*=s[f],c.push(s[f]);const l=[...Ah(e.shape).map((e=>e/u)),1].slice(0,i);return[c,o,u,l]}function sM(e,t,n){const r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+"shape[sliceDim:], got updates.shape: ".concat(n.shape)+", indices.shape: ".concat(t.shape,", shape: ").concat(e)+", sliceDim: ".concat(r,", and batchDim: ").concat(a,".");if(n.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(e.length<r+(n.rank-a))throw new Error(i+" Output shape length < ".concat(r+(n.rank-a)));if(n.rank!==a+e.length-r)throw new Error(i+" update.rank != ".concat(a+e.length-r));for(let o=0;o<a;++o)if(n.shape[o]!==t.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(n.shape[o],") != indices.shape[").concat(o,"] (").concat(t.shape[o],")."));for(let o=0;o<n.rank-a;++o)if(n.shape[o+a]!==e[o+r])throw new Error(i+" updates.shape[".concat(o+a,"] (").concat(n.shape[o+a],") != shape[").concat(o+a,"] (").concat(e[o+a],")"))}function cM(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(t.rank,"."));if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+" but the rank was ".concat(e.rank,"."));if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(t.dtype));if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(n));if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: ".concat(t.shape));if(0===e.size)throw new Error("Updates specified for empty output. updates shape: ".concat(e.shape))}sM(n,t,e)}function uM(e,t,n){const r=t.shape.length,a=r>1?t.shape[r-1]:1,i=n.length;let o=1;for(let c=a;c<i;++c)o*=n[c];const s=a<1?1:a;return{sliceRank:a,numUpdates:ph(t.shape)/s,sliceSize:o,strides:[...Ah(n.slice(0,a)),1],outputSize:ph(n)}}const lM=1.7580993408473768,fM=1.0507009873554805,dM=.3275911,hM=.254829592,pM=-.284496736,gM=1.421413741,mM=-1.453152027,vM=1.061405429;function bM(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+"".concat(e.length,", imag: ").concat(t.length,"."));const n=new Float32Array(2*e.length);for(let r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function yM(e){const t=new Float32Array(e.length/2),n=new Float32Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function xM(e){const t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let a=0;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function wM(e){const t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let a=2;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function SM(e,t){return{real:e[2*t],imag:e[2*t+1]}}function CM(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function MM(e,t){const n=new Float32Array(e/2),r=new Float32Array(e/2);for(let a=0;a<Math.ceil(e/2);a++){const i=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(i),r[a]=Math.sin(i)}return{real:n,imag:r}}function _M(e,t,n){const r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}const EM="->",TM=/->/g,IM=",",kM="...";function NM(e,t){const n=((e=e.replace(/\s/g,"")).length-e.replace(TM,"").length)/EM.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("'.concat(EM,'").'));const[r,a]=e.split(EM);fh(-1===r.indexOf(kM),(()=>'The ellipsis notation ("'.concat(kM,'") is not supported yet.')));const i=r.split(IM),o=i.length;if(t!==o)throw new Error("Expected ".concat(o," input tensors, received ").concat(t));if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const s=[];for(let f=0;f<a.length;++f){const e=a[f];if(!i.some((t=>-1!==t.indexOf(e))))throw new Error("Output subscripts contain the label ".concat(e," ")+"not present in the input subscripts.");-1===s.indexOf(e)&&s.push(e)}for(let f=0;f<r.length;++f){const e=r[f];-1===s.indexOf(e)&&e!==IM&&s.push(e)}const c=new Array(i.length);for(let f=0;f<o;++f){if(new Set(i[f].split("")).size!==i[f].length)throw new Error("Found duplicate axes in input component ".concat(i[f],". ")+"Support for duplicate axes in input is not implemented yet.");c[f]=[];for(let e=0;e<i[f].length;++e)c[f].push(s.indexOf(i[f][e]))}const u=s.length,l=[];for(let f=a.length;f<u;++f)l.push(f);return{allDims:s,summedDims:l,idDims:c}}function LM(e,t){let n=new Array(e);n.fill(-1);for(let a=0;a<t.length;++a)n[t[a]]=a;const r=[];for(let a=0;a<e;++a)-1===n[a]&&r.push(a);return n=n.filter((e=>-1!==e)),{permutationIndices:n,expandDims:r}}function AM(e,t,n){const r=new Array(e);for(let a=0;a<n.length;++a){const e=n[a].shape;for(let n=0;n<t[a].length;++n)void 0===r[t[a][n]]?r[t[a][n]]=e[n]:fh(r[t[a][n]]===e[n],(()=>"Expected dimension ".concat(r[t[a][n]]," at axis ").concat(n," ")+"of input shaped ".concat(JSON.stringify(e),", ")+"but got dimension ".concat(e[n])))}}function RM(e,t){const n=e,r=[];let a=0;0===e.length&&n.push(-1),a=e.length+1;for(let o=0;o<a;++o)r.push([]);const i=[];for(let o=0;o<n.length;++o){const e=OM(t,n[o]);for(const t of e)-1===i.indexOf(t)&&(r[o].push(t),i.push(t))}return{path:n,steps:r}}function DM(e){return e.every(((e,t)=>e===t))}function OM(e,t){const n=[];for(let r=0;r<e.length;++r)0!==e[r].length&&-1===e[r].indexOf(t)&&-1!==t||n.push(r);return n}function PM(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[];if("number"===typeof t)fh(e.shape[n]%t===0,(()=>"Number of splits must evenly divide the axis.")),r=new Array(t).fill(e.shape[n]/t);else{const a=t.reduce(((e,t)=>(-1===t&&(e+=1),e)),0);fh(a<=1,(()=>"There should be only one negative value in split array."));const i=t.indexOf(-1);if(-1!==i){const r=t.reduce(((e,t)=>t>0?e+t:e));t[i]=e.shape[n]-r}fh(e.shape[n]===t.reduce(((e,t)=>e+t)),(()=>"The sum of sizes must match the size of the axis dimension.")),r=t}return r}function FM(e){return"Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ".concat(e)}function zM(e,t){return"indices(".concat(e,", 0) is invalid: ").concat(t," < 0")}function jM(e,t,n){return"indices(".concat(e,", 0) is invalid: ").concat(t," >= ").concat(n)}function BM(e,t){return"only one output dimension may be -1, not both ".concat(e," and ").concat(t)}function UM(e,t){return"size ".concat(e," must be non-negative, not ").concat(t)}function WM(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function GM(e,t){const n=ph(e),r=ph(t);return"Input to reshape is a SparseTensor with ".concat(n,"\n  dense values, but the requested shape requires a multiple of ").concat(r,". inputShape=").concat(e," outputShape= ").concat(t)}function VM(e,t){const n=ph(e),r=ph(t);return"Input to reshape is a tensor with ".concat(n," dense values, but the requested shape has ").concat(r,". inputShape=").concat(e," outputShape=").concat(t)}function HM(){return"segment ids must be >= 0"}function YM(){return"segment ids are not increasing"}function XM(e,t){return"Segment id ".concat(e," out of range [0, ").concat(t,"), possibly because segmentIds input is not sorted.")}function qM(e,t,n){return"Bad: indices[".concat(e,"] == ").concat(t," out of range [0, ").concat(n,")")}function KM(e,t){let n,r=!1;for(e<=ZC?(n=e,r=!0):n=Lh(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=Lh(e,n+1);return n}function QM(e,t,n){const r=[],a=e.length;for(let i=0;i<a;i++)i!==t?r.push(e[i]):r.push(n);return r}function JM(e,t,n,r){const a=t.shape.length,i=e.shape.length;if(0!==r&&(r<-a||r>a))throw new Error("Expect batchDims in the range of [-".concat(a,", ").concat(a,"], but got ").concat(r));if(r<0&&(r+=a),r>i)throw new Error("batchDims (".concat(r,") must be less than rank(x) (\n    ").concat(i,")."));if(n<r)throw new Error("batchDims (".concat(r,") must be less than or equal to axis (").concat(n,")."));for(let f=0;f<r;++f)if(e.shape[f]!==t.shape[f])throw new Error("x.shape[".concat(f,"]: ").concat(e.shape[f]," should be equal to indices.shape[").concat(f,"]: ").concat(t.shape[f],"."));const o=e.shape[n],s=[];let c=1,u=1,l=1;for(let f=0;f<r;++f)s.push(e.shape[f]),c*=e.shape[f];for(let f=r;f<n;f++)s.push(e.shape[f]),u*=e.shape[f];for(let f=r;f<a;f++)s.push(t.shape[f]);for(let f=n+1;f<i;f++)s.push(e.shape[f]),l*=e.shape[f];return{batchSize:c,sliceSize:l,outerSize:u,dimSize:o,outputShape:s}}function ZM(e){try{return e.map((e=>Fv(e)))}catch(upe){throw new Error("Failed to decode encoded string bytes into utf-8, error: ".concat(upe))}}function $M(e){return e.map((e=>Pv(e)))}function e_(e,t){const n=[];for(let i=0;i<t.length;i++)t[i]&&n.push(i);const r=Ty(e,"int32"),a=Ty([n.length,e.length],"int32");for(let i=0;i<n.length;i++){const t=r.indexToLoc(n[i]),o=i*e.length;a.values.set(t,o)}return a.toTensor()}!function(){for(const e of sx)Vy(e)}();const t_={kernelName:Jh,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Dy(e,XS(Iy(n,"float32"),-1))}}},n_={kernelName:Zh,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=Py(Iy(n,"float32")),r=Oy(Qy(jy(1),t));return nS(Ry(e,r))}}}},r_={kernelName:$h,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=Oy(Qy(Py(Iy(n,"float32")),1));return Ry(e,t)}}}},a_={kernelName:ep,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,a=tx(n.shape,r.shape);return{a:()=>{let t=e;const r=ex(n.shape,a);return r.length>0&&(t=Fw(t,r)),$x(t,n.shape)},b:()=>{let t=e;const n=ex(r.shape,a);return n.length>0&&(t=Fw(t,n)),$x(t,r.shape)}}}},i_={kernelName:tp,saveAllInputs:!0,gradFunc:(e,t)=>{const n={};return t.forEach(((t,r)=>{n[r]=()=>e.clone()})),n}},o_={kernelName:ap,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Fy(n)}}},s_={kernelName:ip,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Fy(n)}}},c_={kernelName:op,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Ry(e,Oy(Qy(jy(1),Py(Iy(n,"float32")))))}}},u_={kernelName:sp,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=Oy(Ly(jy(1),Py(Iy(n,"float32"))));return Ry(e,t)}}}},l_={kernelName:lp,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,a=tx(n.shape,r.shape);return{a:()=>{const t=Ly(Py(n),Py(r));let i=Dy(e,Ry(r,t));const o=ex(n.shape,a);return o.length>0&&(i=Fw(i,o)),$x(i,n.shape)},b:()=>{const t=Ly(Py(n),Py(r));let i=nS(Dy(e,Ry(n,t)));const o=ex(r.shape,a);return o.length>0&&(i=Fw(i,o)),$x(i,r.shape)}}}},f_={kernelName:cp,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Ry(e,Ly(Py(Iy(n,"float32")),1))}}},d_={kernelName:up,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Ry(e,Qy(jy(1),Py(Iy(n,"float32"))))}}};const h_=Lb({avgPool3dGrad_:function(e,t,n,r,a,i){const o=kb(e,"dy","avgPool3dGrad"),s=kb(t,"input","avgPool3dGrad");let c=o,u=s,l=!1;4===s.rank&&(l=!0,c=$x(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),u=$x(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),fh(5===c.rank,(()=>"Error in avgPool3dGrad: dy must be rank 5 but got rank "+"".concat(c.rank,"."))),fh(5===u.rank,(()=>"Error in avgPool3dGrad: input must be rank 5 but got rank "+"".concat(u.rank,"."))),Zx("avgPool3dGrad",a,i);const f={dy:c,input:u},d={filterSize:n,strides:r,pad:a,dimRoundingMode:i},h=yb.runKernel(pp,f,d);return l?$x(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}}),p_={kernelName:hp,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{filterSize:a,strides:i,pad:o,dimRoundingMode:s}=n;return{x:()=>h_(e,r,a,i,o,s)}}};const g_=Lb({avgPoolGrad_:function(e,t,n,r,a){const i=kb(e,"dy","avgPoolGrad"),o=kb(t,"input","avgPoolGrad");fh(o.rank===i.rank,(()=>"Rank of input (".concat(o.rank,") does not match rank of dy (").concat(i.rank,")")));let s=o,c=i,u=!1;3===o.rank&&(u=!0,s=$x(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=$x(i,[1,i.shape[0],i.shape[1],i.shape[2]])),fh(4===c.rank,(()=>"Error in avgPoolGrad: dy must be rank 4 but got rank "+"".concat(c.rank,"."))),fh(4===s.rank,(()=>"Error in avgPoolGrad: input must be rank 4 but got rank "+"".concat(s.rank,".")));const l={dy:c,input:s},f={filterSize:n,strides:r,pad:a},d=yb.runKernel(dp,l,f);return u?$x(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),m_={kernelName:fp,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{filterSize:a,strides:i,pad:o}=n;return{x:()=>g_(e,r,a,i,o)}}},v_={kernelName:gp,inputsToSave:["a","b"],gradFunc:(e,t,n)=>{const[r,a]=t,{transposeA:i,transposeB:o}=n;return i||o?!i&&o?{a:()=>Kw(e,a,!1,!1),b:()=>Kw(e,r,!0,!1)}:i&&!o?{a:()=>Kw(a,e,!1,!0),b:()=>Kw(r,e,!1,!1)}:{a:()=>Kw(a,e,!0,!0),b:()=>Kw(e,r,!0,!0)}:{a:()=>Kw(e,a,!1,!0),b:()=>Kw(r,e,!0,!1)}}};const b_=Lb({spaceToBatchND_:function(e,t,n){const r=kb(e,"x","spaceToBatchND");fh(r.rank>=1+t.length,(()=>"input rank ".concat(r.rank," should be > than [blockShape] ").concat(t.length))),fh(n.length===t.length,(()=>"paddings.shape[0] ".concat(n.length," must be equal to [blockShape] ").concat(t.length))),fh(r.shape.reduce(((e,r,a)=>a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]===0:e),!0),(()=>"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(n.toString()," must be divisible by blockShapes ").concat(t.toString())));const a={x:r},i={blockShape:t,paddings:n};return yb.runKernel(Nm,a,i)}}),y_={kernelName:mp,gradFunc:(e,t,n)=>{const{blockShape:r,crops:a}=n;return{x:()=>b_(e,r,a)}}},x_={kernelName:"BroadcastTo",gradFunc:(e,t,n)=>{const r=n,a=r.inputShape,i=r.shape,o=Array.from(i);for(let c=a.length-1;c>=0;c--)if(a[c]===i[c])o[c]=1;else if(1!==a[c])throw new Error("broadcastTo(): [".concat(a,"] cannot be broadcast to [").concat(i,"]."));const s=[];for(let c=0;c<o.length;c++)o[c]>1&&s.push(c);return{x:()=>Fw(e,s,!0)}}},w_={kernelName:xp,gradFunc:e=>({x:()=>e.clone()})},S_={kernelName:wp,gradFunc:e=>({x:()=>Fy(e)})},C_={kernelName:Sp,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{clipValueMin:a,clipValueMax:i}=n;return{x:()=>PS(qw(Aw(r,a),TC(r,i)),e,Fy(e))}}},M_={kernelName:Mp,inputsToSave:["x"],gradFunc:t_.gradFunc},__={kernelName:_p,saveAllInputs:!0,gradFunc:(e,t,n)=>{const r=t.map((e=>e.shape)),{axis:a}=n,i=wh(a,t[0].shape)[0],o=r.map((e=>e[i]));return IS(e,o,i).map((e=>()=>e))}},E_={kernelName:Ep,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[r,a]=t,{dilations:i,strides:o,pad:s,dataFormat:c}=n;return fh(qx(i),(()=>"Error in gradient of conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(i,"'"))),{x:()=>gw(r.shape,e,a,o,s,c),filter:()=>HS(r,e,a.shape,o,s,c)}}},T_={kernelName:Ip,inputsToSave:["dy","filter"],gradFunc:(e,t,n)=>{const[r,a]=t,{strides:i,pad:o,dataFormat:s,dimRoundingMode:c}=n;return{dy:()=>hw(e,a,i,o,s,1,c),filter:()=>HS(e,r,a.shape,i,o,s,c)}}};const I_=Lb({conv3DBackpropFilter_:function(e,t,n,r,a){let i=e;4===e.rank&&(i=$x(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));let o=t;4===o.rank&&(o=$x(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),fh(5===i.rank,(()=>"Error in conv3dDerFilter: input must be rank 5, but got shape "+"".concat(i.shape,"."))),fh(5===o.rank,(()=>"Error in conv3dDerFilter: dy must be rank 5, but got shape "+"".concat(o.shape,"."))),fh(5===n.length,(()=>"Error in conv3dDerFilter: filterShape must be length 5, but got "+"".concat(n,"."))),fh(i.shape[4]===n[3],(()=>"Error in conv3dDerFilter: depth of input ".concat(i.shape[4],") must ")+"match input depth in filter (".concat(n[3],"."))),fh(o.shape[4]===n[4],(()=>"Error in conv3dDerFilter: depth of dy (".concat(o.shape[4],") must ")+"match output depth for filter (".concat(n[4],").")));const s={x:i,dy:o},c={strides:r,pad:a,filterShape:n};return yb.runKernel(Np,s,c)}}),k_={kernelName:kp,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:r,strides:a,pad:i}=n;fh(qx(r),(()=>"Error in gradient of conv3D: dilation rates greater than 1 are "+"not yet supported in gradients. Got dilations '".concat(r,"'")));const[o,s]=t;return{x:()=>bw(o.shape,e,s,a,i),filter:()=>I_(o,e,s.shape,a,i)}}};const N_=Lb({sin_:function(e){const t={x:kb(e,"x","sin","float32")};return yb.runKernel(Cm,t)}}),L_={kernelName:Ap,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Dy(nS(N_(Iy(n,"float32"))),e)}}};const A_=Lb({sinh_:function(e){const t={x:kb(e,"x","sinh")};return yb.runKernel(Mm,t)}}),R_={kernelName:Rp,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Dy(A_(Iy(n,"float32")),e)}}};const D_=Lb({cumsum_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a={x:kb(e,"x","cumsum")},i={axis:t,exclusive:n,reverse:r};return yb.runKernel(Op,a,i)}}),O_={kernelName:Op,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{axis:a,exclusive:i,reverse:o}=n;return{x:()=>{const t=Vw([a],r.rank);let n=D_(e,a,i,!o);return null!=t&&(n=jS(n,t)),n}}}},P_={kernelName:jp,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:r,strides:a,pad:i,dimRoundingMode:o}=n,s=null==r?[1,1]:r;fh(qx(s),(()=>"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(s,"'")));const[c,u]=t;return fh(4===c.rank,(()=>"Error in gradient of depthwiseConv2dNative: input must be "+"rank 4, but got rank ".concat(c.rank,"."))),fh(4===u.rank,(()=>"Error in gradient of depthwiseConv2dNative: filter must be "+"rank 4, but got rank ".concat(u.rank,"."))),fh(c.shape[3]===u.shape[2],(()=>"Error in gradient of depthwiseConv2d: number of input "+"channels (".concat(c.shape[3],") must match the inChannels dimension ")+"in filter ".concat(u.shape[2],"."))),fh(Kx(a,s),(()=>"Error in gradient of depthwiseConv2d: Either strides or "+"dilations must be  1. Got strides ".concat(a," and dilations ")+"'".concat(s,"'."))),Zx("depthwiseConv2d",i,o),{x:()=>eC(c.shape,e,u,a,i,s,o),filter:()=>$S(c,e,u.shape,a,i,s,o)}}},F_={kernelName:Gp,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[r,a]=t,i={x:r,filter:a,dy:e},o={x:r,filter:a,dy:e};return{x:()=>yb.runKernel(Vp,i,n),filter:()=>yb.runKernel(Hp,o,n)}}},z_={kernelName:Kp,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t,r={dy:e,y:n};return{x:()=>yb.runKernel(Qp,r)}}},j_={kernelName:Jp,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,r=Dy(_w(nS(Py(n))),2/Math.sqrt(Math.PI));return{x:()=>Dy(e,r)}}},B_={kernelName:$p,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Dy(e,n)}}},U_={kernelName:eg,inputsToSave:["input"],gradFunc:(e,t)=>{const[n]=t;return{input:()=>$x(e,n.shape)}}},W_={kernelName:tg,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Dy(e,_w(n))}}},G_={kernelName:ig,gradFunc:e=>({x:()=>Fy(e)})},V_={kernelName:og,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,a=tx(n.shape,r.shape);return{a:()=>{const t=Ry(e,Iy(r,"float32")),i=ex(n.shape,a);return i.length>0?$x(Fw(t,i),n.shape):t},b:()=>{let t=Dy(e,Iy(n,"float32"));const i=ex(r.shape,a);i.length>0&&(t=$x(Fw(t,i),r.shape));const o=Py(r);return nS(Ry(t,Iy(o,"float32")))}}}};const H_=Lb({rsqrt_:function(e){const t={x:kb(e,"x","rsqrt","float32")};return yb.runKernel(mm,t)}}),Y_={kernelName:sg,inputsToSave:["x","mean","variance","scale"],gradFunc:(e,t,n)=>{const{varianceEpsilon:r}=n,[a,i,o,s]=t,c=null==s?jy(1):s,u=ex(i.shape,a.shape),l=[];if(1===i.rank){for(let e=0;e<a.shape.length-1;++e)l.push(a.shape[e]);l.push(1)}const f=Qy(a,i),d=Dy(e,c),h=H_(Ly(o,jy(r))),p=Dy(Dy(Dy(h,h),h),jy(-.5));return{x:()=>1===i.rank?$x(Dy(Dy(e,Tw($x(h,[1,1,1,i.shape[0]]),l)),c),a.shape):$x(Dy(Dy(e,h),c),a.shape),mean:()=>{let e=Dy(Dy(h,jy(-1)),d);return 1===i.rank&&(e=Fw(e,u)),$x(e,i.shape)},variance:()=>{let e=Dy(Dy(p,f),d);return 1===i.rank&&(e=Fw(e,u)),$x(e,i.shape)},scale:()=>{const t=Dy(f,h);let n=Dy(e,t);return 1===i.rank&&(n=Fw(n,u)),$x(n,i.shape)},offset:()=>{let t=e;return 1===i.rank&&(t=Fw(t,u)),$x(t,i.shape)}}}};const X_=Lb({unsortedSegmentSum_:function(e,t,n){const r=kb(e,"x","unsortedSegmentSum"),a=kb(t,"segmentIds","unsortedSegmentSum","int32");fh(mh(n),(()=>"numSegments must be of dtype int"));const i={x:r,segmentIds:a},o={numSegments:n};return yb.runKernel(ev,i,o)}}),q_={kernelName:cg,inputsToSave:["x","indices"],gradFunc:(e,t,n)=>{const[r,a]=t,{axis:i,batchDims:o}=n,s=wh(i,r.shape)[0],c=(e,t,n)=>()=>{const r=e.shape,a=t.size,o=r.slice(0,s),c=o.length,u=r.slice(i,r.length).slice(1),l=u.length,f=K_(0,c),d=K_(c+1,c+1+l),h=Q_([o,[a],u]),p=$x(n,h),g=$x(t,[a]),m=Q_([[c],f,d]),v=jS(p,m);let b=X_(v,g,e.shape[s]);const y=Hw(m);return b=jS(b,y),b};if(1===o){const t=r.shape[0],n=r.split(t,0),i=()=>{const t=NS(n.map(((t,n)=>c(t,a.slice(n,1),e.slice(n,1))())));return t.reshape(r.shape)};return{x:i,indices:()=>a}}return{x:c(r,a,e),indices:()=>a}}};function K_(e,t){const n=[];for(let r=e;r<t;++r)n.push(r);return n}function Q_(e){const t=[];for(let n=0;n<e.length;++n)for(let r=0;r<e[n].length;++r)t.push(e[n][r]);return t}const J_={kernelName:fg,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>Fy(n),b:()=>Fy(r)}}},Z_={kernelName:dg,gradFunc:e=>({x:()=>Iy(e,"float32")})},$_={kernelName:gg,gradFunc:e=>({x:()=>Fy(e)})},eE={kernelName:mg,gradFunc:e=>({x:()=>Fy(e)})},tE={kernelName:vg,gradFunc:e=>({x:()=>Fy(e)})},nE={kernelName:bg,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{alpha:a}=n,i=Lw(r,0);return{x:()=>PS(i,e,Dy(e,a))}}},rE={kernelName:Cg,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Ry(e,Ly(n,1))}}},aE={kernelName:Sg,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Ry(e,Iy(n,"float32"))}}},iE={kernelName:"LogSoftmax",inputsToSave:[],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r]=t,{axis:a}=n;return{logits:()=>{const t=_w(r);return Qy(e,Dy(Fw(e,a,!0),t))}}}};const oE=Lb({localResponseNormalizationBackprop_:function(e,t,n){const r={x:e,y:t,dy:n},a={depthRadius:arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,bias:arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,alpha:arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,beta:arguments.length>6&&void 0!==arguments[6]?arguments[6]:.5};return yb.runKernel(Ig,r,a)}}),sE={kernelName:Tg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,a]=t,{depthRadius:i,bias:o,alpha:s,beta:c}=n;return{x:()=>oE(r,a,e,i,o,s,c)}}};function cE(e,t,n,r){return t.rank<n.rank&&(t=$x(t,Ww(t.shape,r))),e.rank<n.rank&&(e=$x(e,Ww(e.shape,r))),{x:()=>Dy(e,Iy(Cw(n,t),e.dtype))}}const uE={kernelName:kg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const r=n,{reductionIndices:a}=r,i=t[0],o=cE(e,t[1],i,wh(a,i.shape));return{x:()=>o.x()}}},lE={kernelName:Ng,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>Dy(e,Iy(Aw(n,r),"float32")),b:()=>Dy(e,Iy(LC(n,r),"float32"))}}};const fE=Lb({maxPool3dGrad_:function(e,t,n,r,a,i,o){const s=kb(e,"dy","maxPool3dGrad"),c=kb(t,"input","maxPool3dGrad"),u=kb(n,"output","maxPool3dGrad");let l=s,f=c,d=u,h=!1;4===c.rank&&(h=!0,l=$x(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),f=$x(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]]),d=$x(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),fh(5===l.rank,(()=>"Error in maxPool3dGrad: dy must be rank 5 but got rank "+"".concat(l.rank,"."))),fh(5===f.rank,(()=>"Error in maxPool3dGrad: input must be rank 5 but got rank "+"".concat(f.rank,"."))),fh(5===d.rank,(()=>"Error in maxPool3dGrad: output must be rank 5 but got rank "+"".concat(d.rank,"."))),Zx("maxPool3dGrad",i,o);const p={dy:l,input:f,output:d},g={filterSize:r,strides:a,pad:i,dimRoundingMode:o},m=yb.runKernel(Dg,p,g);return h?$x(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}}),dE={kernelName:Rg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,a]=t,{filterSize:i,strides:o,pad:s,dimRoundingMode:c}=n;return{x:()=>fE(e,r,a,i,o,s,c)}}};const hE=Lb({maxPoolGrad_:function(e,t,n,r,a,i,o){const s=kb(e,"dy","maxPoolGrad"),c=kb(t,"input","maxPoolGrad"),u=kb(n,"output","maxPoolGrad");fh(c.rank===s.rank,(()=>"Rank of input (".concat(c.rank,") does not match rank of dy ")+"(".concat(s.rank,")"))),fh(4===s.rank,(()=>"Error in maxPoolGrad: dy must be rank 4 but got rank "+"".concat(s.rank,"."))),fh(4===c.rank,(()=>"Error in maxPoolGrad: input must be rank 4 but got rank "+"".concat(c.rank,"."))),Zx("maxPoolGrad",i,o);const l={dy:s,input:c,output:u},f={filterSize:r,strides:a,pad:i,dimRoundingMode:o};return yb.runKernel(Ag,l,f)}}),pE={kernelName:Lg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,a]=t,{filterSize:i,strides:o,pad:s}=n;return{x:()=>hE(e,r,a,i,o,s)}}},gE={kernelName:Pg,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{axis:a}=n,i=wh(a,r.shape),o=ph(Uw(r.shape,i)[1]);return{x:()=>{const t=r.shape.slice();i.forEach((e=>{t[e]=1}));const n=$x(e,t);return Ry(Dy(n,oS(r.shape,"float32")),o)}}}},mE={kernelName:Fg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const r=n,{axis:a}=r,[i,o]=t,s=cE(e,o,i,wh(a,i.shape));return{x:()=>s.x()}}},vE={kernelName:zg,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>Dy(e,Iy(TC(n,r),"float32")),b:()=>Dy(e,Iy(Lw(n,r),"float32"))}}},bE={kernelName:jg,inputsToSave:["x"],gradFunc:(e,t,n)=>{const r=t[0],{paddings:a}=n,i=a.map((e=>e[0]));return{x:()=>wS(e,i,r.shape)}}},yE={kernelName:Bg,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,a=tx(n.shape,r.shape);return{a:()=>{const t=ex(n.shape,a);return t.length>0?$x(Fw(e,t),n.shape):e},b:()=>{const t=Dy(e,nS(kw(Ry(n,r)))),i=ex(r.shape,a);return i.length>0?$x(Fw(t,i),r.shape):t}}}},xE={kernelName:Wg,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,a=tx(n.shape,r.shape);return{a:()=>{const t=Dy(e,Iy(r,"float32")),i=ex(n.shape,a);return i.length>0?$x(Fw(t,i),n.shape):t},b:()=>{const t=Dy(e,Iy(n,"float32")),i=ex(r.shape,a);return i.length>0?$x(Fw(t,i),r.shape):t}}}},wE={kernelName:Gg,gradFunc:e=>({x:()=>nS(e)})},SE={kernelName:Kg,inputsToSave:["indices"],gradFunc:(e,t)=>{const n=t[0];return{indices:()=>iS(n.shape,"float32")}}},CE={kernelName:qg,gradFunc:e=>({x:()=>Fy(e)})},ME={kernelName:Qg,saveAllInputs:!0,gradFunc:(e,t,n)=>{const{axis:r}=n;return OS(e,r).map((e=>()=>e))}},_E={kernelName:Jg,inputsToSave:["x"],gradFunc:(e,t,n)=>{const r=t[0],{paddings:a}=n,i=a.map((e=>e[0]));return{x:()=>wS(e,i,r.shape)}}},EE={kernelName:Zg,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(e,t)=>{const[n,r,a]=t,i=n,o=r,s=tx(i.shape,o.shape);return{a:()=>{const t=Iy(o,"float32");let n=Dy(e,Dy(t,Ky(i,Qy(t,jy(1)))));const r=ex(i.shape,s);return r.length>0&&(n=Fw(n,r)),$x(n,i.shape)},b:()=>{const t=Lw(i,0),n=PS(t,Dw(i),Fy(i));let r=Dy(e,Dy(a,n));const c=ex(o.shape,s);return c.length>0&&(r=Fw(r,c)),$x(r,o.shape)}}}},TE={kernelName:$g,inputsToSave:["x","alpha"],gradFunc:(e,t)=>{const[n,r]=t,a=Lw(n,0);return{x:()=>PS(a,e,Dy(e,r)),alpha:()=>{let t=PS(a,Fy(e),Dy(e,n));const i=ex(r.shape,e.shape);return i.length>0&&(t=Fw(t,i)),$x(t,r.shape)}}}};const IE=Lb({cumprod_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a={x:kb(e,"x","cumprod")},i={axis:t,exclusive:n,reverse:r};return yb.runKernel(Dp,a,i)}});function kE(e,t,n){const r=e.shape.length,a=r-n.length,i=Vw(n,r);let o=e;null!=i&&(o=jS(e,i));const s=o.shape.slice(),c=s.splice(r-n.length,n.length).reduce(((e,t)=>e*t),1);s.push(c);let u=function(e,t,n){const r=e.shape.slice();r[n]=1;const a=$x(t,r),i=IE(e,n,!0,!1),o=IE(e,n,!0,!0),s=Dy(i,o);return Dy(a,s)}(o.reshape(s),t,a);if(u=u.reshape(o.shape),null!=i){const e=Hw(i);u=jS(u,e)}return u}const NE={kernelName:em,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{axis:a}=n;let i=[];return i=void 0===a||null===a?r.shape.map(((e,t)=>t)):"number"===typeof a?[a]:a,{x:()=>kE(r,e,i)}}},LE={kernelName:Xp,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,a=tx(n.shape,r.shape);return{a:()=>{const t=Ry(e,Iy(r,"float32")),i=ex(n.shape,a);return i.length>0?$x(Fw(t,i),n.shape):t},b:()=>{let t=Dy(e,Iy(n,"float32"));const i=ex(r.shape,a);i.length>0&&(t=$x(Fw(t,i),r.shape));const o=Py(r);return nS(Ry(t,Iy(o,"float32")))}}}},AE={kernelName:om,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Ry(e,nS(Py(n)))}}},RE={kernelName:hm,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,r=Dy(TC(n,6),XS(n));return{x:()=>Dy(e,Iy(r,"float32"))}}},DE={kernelName:sm,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Dy(e,Iy(XS(n),"float32"))}}},OE={kernelName:cm,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>$x(e,n.shape)}}},PE={kernelName:fm,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[r]=t,a={dy:e,images:r};return{images:()=>yb.runKernel(dm,a,n)}}},FE={kernelName:um,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[r]=t,a={dy:e,images:r};return{images:()=>yb.runKernel(lm,a,n)}}},zE={kernelName:pm,gradFunc:(e,t,n)=>{const{dims:r}=n,a=wh(r,e.shape);return{x:()=>vS(e,a)}}},jE={kernelName:gm,gradFunc:e=>({x:()=>Fy(e)})},BE={kernelName:mm,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>nS(Ry(e,Dy(Ky(n,1.5),2)))}}};const UE=Lb({logicalNot_:function(e){const t={x:kb(e,"x","logicalNot","bool")};return yb.runKernel(_g,t)}}),WE={kernelName:xm,inputsToSave:["condition"],gradFunc:(e,t)=>{const[n]=t;return{condition:()=>Iy(Fy(n),"float32"),t:()=>Dy(e,Iy(n,e.dtype)),e:()=>Dy(e,Iy(UE(n),e.dtype))}}},GE={kernelName:wm,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=Lw(n,jy(0)),r=jy(lM),a=jy(fM),i=Dy(e,a),o=Dy(Dy(e,r),_w(Iy(n,"float32")));return PS(t,i,o)}}}},VE={kernelName:Em,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Dy(e,Dy(n,Qy(jy(1),n)))}}},HE={kernelName:_m,gradFunc:e=>({x:()=>Fy(e)})};const YE=Lb({cos_:function(e){const t={x:kb(e,"x","cos","float32")};return yb.runKernel(Ap,t)}}),XE={kernelName:Cm,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Dy(YE(Iy(n,"float32")),e)}}};const qE=Lb({cosh_:function(e){const t={x:kb(e,"x","cosh","float32")};return yb.runKernel(Rp,t)}}),KE={kernelName:Mm,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Dy(qE(Iy(n,"float32")),e)}}},QE={kernelName:Sm,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{begin:a,size:i}=n,o=r.shape,[s,c]=Ax(r,a,i),u=[];for(let l=0;l<e.rank;l++)u.push([s[l],o[l]-s[l]-c[l]]);return{x:()=>cS(e,u)}}},JE={kernelName:Am,outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r]=t,{dim:a}=n,i=Dy(e,r);return{logits:()=>Qy(i,Dy(Fw(i,[a],true),r))}}},ZE={kernelName:Tm,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Dy(e,xS(n))}}};const $E=Lb({batchToSpaceND_:function(e,t,n){const r=kb(e,"x","batchToSpaceND"),a=t.reduce(((e,t)=>e*t));fh(r.rank>=1+t.length,(()=>"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(t.length))),fh(n.length===t.length,(()=>"crops.length is ".concat(n.length," but should be equal to blockShape.length  ").concat(t.length))),fh(r.shape[0]%a===0,(()=>"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(t.join(" * ")," === ").concat(a)));const i={x:r},o={blockShape:t,crops:n};return yb.runKernel(mp,i,o)}}),eT={kernelName:Nm,gradFunc:(e,t,n)=>{const{blockShape:r,paddings:a}=n;return{x:()=>$E(e,r,a)}}},tT={kernelName:Lm,gradFunc:(e,t,n)=>{const{axis:r}=n;return{x:()=>cw(e,r)}}},nT={kernelName:Im,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Ry(e,Dy(Oy(Iy(n,"float32")),2))}}},rT={kernelName:jm,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Dy(e,Dy(Iy(n,"float32"),2))}}},aT={kernelName:zm,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,a=jy(2);return{a:()=>Dy(e,Dy(a,Qy(n,r))),b:()=>Dy(e,Dy(a,Qy(r,n)))}}},iT={kernelName:Hm,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,a=tx(n.shape,r.shape);return{a:()=>{let t=e;const r=ex(n.shape,a);return r.length>0&&(t=Fw(t,r)),$x(t,n.shape)},b:()=>{let t=e;const n=ex(r.shape,a);return n.length>0&&(t=Fw(t,n)),$x(nS(t),r.shape)}}}},oT={kernelName:km,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,a=r.shape.slice(),{axis:i}=n;wh(i,r.shape).forEach((e=>{a[e]=1}));const o=$x(e,a),s=Dy(o,oS(r.shape,"float32"));return{x:()=>s}}},sT={kernelName:Ym,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Ry(e,Py(YE(n)))}}},cT={kernelName:Xm,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Dy(Qy(jy(1),Py(n)),e)}}},uT={kernelName:qm,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{reps:a}=n;return{x:()=>{let t=Fy(r);if(1===r.rank)for(let n=0;n<a[0];++n)t=Ly(t,wS(e,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(let n=0;n<a[0];++n)for(let i=0;i<a[1];++i)t=Ly(t,wS(e,[n*r.shape[0],i*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(let n=0;n<a[0];++n)for(let i=0;i<a[1];++i)for(let o=0;o<a[2];++o)t=Ly(t,wS(e,[n*r.shape[0],i*r.shape[1],o*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+"".concat(r.rank," tensors yet."));for(let n=0;n<a[0];++n)for(let i=0;i<a[1];++i)for(let o=0;o<a[2];++o)for(let s=0;s<a[3];++s)t=Ly(t,wS(e,[n*r.shape[0],i*r.shape[1],o*r.shape[2],s*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},lT={kernelName:ev,inputsToSave:["segmentIds"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>function(e,t){const n=nx(t,Fy(t)),r=Nw(e,n);let a=Aw(t,jy(0,"int32"));const i=r.rank-a.rank;for(let s=0;s<i;++s)a=Ew(a,s+1);a=qw(a,oS(r.shape,"bool"));const o=Fy(r);return PS(a,r,o)}(e,n)}}};const fT=[t_,n_,r_,a_,i_,o_,s_,c_,u_,l_,f_,d_,p_,m_,v_,y_,x_,w_,S_,C_,M_,__,T_,E_,k_,L_,R_,O_,P_,F_,LE,z_,j_,B_,U_,W_,V_,G_,Y_,q_,J_,Z_,$_,eE,tE,nE,rE,aE,iE,sE,uE,uE,lE,dE,pE,gE,mE,vE,bE,yE,xE,wE,SE,CE,ME,_E,_E,EE,TE,NE,AE,RE,DE,OE,PE,FE,zE,jE,BE,WE,GE,VE,HE,XE,KE,QE,JE,ZE,eT,eT,tT,tT,nT,aT,rT,{kernelName:nv,gradFunc:e=>({x:()=>Fy(e)})},iT,oT,sT,cT,uT,{kernelName:Jm,gradFunc:(e,t,n)=>{const r=n,{perm:a}=r,i=Hw(a);return{x:()=>jS(e,i)}}},{kernelName:$m,gradFunc:(e,t,n)=>{const r=n,{axis:a}=r;return{value:()=>NS(e,a)}}},lT,{kernelName:tv,gradFunc:e=>({x:()=>Fy(e)})}];for(const n of fT)mv(n);$v().prototype.abs=function(){return this.throwIfDisposed(),Zy(this)};const dT=Lb({acos_:function(e){const t={x:kb(e,"x","acos")};return yb.runKernel(Zh,t)}});$v().prototype.acos=function(){return this.throwIfDisposed(),dT(this)};const hT=Lb({acosh_:function(e){const t={x:kb(e,"x","acosh")};return yb.runKernel($h,t)}});$v().prototype.acosh=function(){return this.throwIfDisposed(),hT(this)},$v().prototype.add=function(e){return this.throwIfDisposed(),Ly(this,e)},$v().prototype.all=function(e,t){return this.throwIfDisposed(),Ox(this,e,t)},$v().prototype.any=function(e,t){return this.throwIfDisposed(),Px(this,e,t)},$v().prototype.argMax=function(e){return this.throwIfDisposed(),Fx(this,e)};const pT=Lb({argMin_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n={x:kb(e,"x","argMin")},r={axis:t};return yb.runKernel(ip,n,r)}});$v().prototype.argMin=function(e){return this.throwIfDisposed(),pT(this,e)},$v().prototype.asScalar=function(){return this.throwIfDisposed(),fh(1===this.size,(()=>"The array must have only 1 element.")),$x(this,[])},$v().prototype.asType=function(e){return this.throwIfDisposed(),Iy(this,e)},$v().prototype.as1D=function(){return this.throwIfDisposed(),$x(this,[this.size])},$v().prototype.as2D=function(e,t){return this.throwIfDisposed(),$x(this,[e,t])},$v().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),$x(this,[e,t,n])},$v().prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),$x(this,[e,t,n,r])},$v().prototype.as5D=function(e,t,n,r,a){return this.throwIfDisposed(),$x(this,[e,t,n,r,a])};const gT=Lb({asin_:function(e){const t={x:kb(e,"x","asin")};return yb.runKernel(op,t)}});$v().prototype.asin=function(){return this.throwIfDisposed(),gT(this)};const mT=Lb({asinh_:function(e){const t={x:kb(e,"x","asinh")};return yb.runKernel(sp,t)}});$v().prototype.asinh=function(){return this.throwIfDisposed(),mT(this)};const vT=Lb({atan_:function(e){const t={x:kb(e,"x","atan")};return yb.runKernel(cp,t)}});$v().prototype.atan=function(){return this.throwIfDisposed(),vT(this)};const bT=Lb({atan2_:function(e,t){let n=kb(e,"a","atan2"),r=kb(t,"b","atan2");[n,r]=fb(n,r);const a={a:n,b:r};return yb.runKernel(lp,a)}});$v().prototype.atan2=function(e){return this.throwIfDisposed(),bT(this,e)};const yT=Lb({atanh_:function(e){const t={x:kb(e,"x","atanh")};return yb.runKernel(up,t)}});$v().prototype.atanh=function(){return this.throwIfDisposed(),yT(this)},$v().prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),ew(this,e,t,n,r)},$v().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),$E(this,e,t)},$v().prototype.batchNorm=function(e,t,n,r,a){return this.throwIfDisposed(),nw(this,e,t,n,r,a)},$v().prototype.broadcastTo=function(e){return this.throwIfDisposed(),ow(this,e)},$v().prototype.cast=function(e){return this.throwIfDisposed(),Iy(this,e)};const xT=Lb({ceil_:function(e){const t={x:kb(e,"x","ceil","float32")};return yb.runKernel(wp,t)}});$v().prototype.ceil=function(){return this.throwIfDisposed(),xT(this)},$v().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),sw(this,e,t)},$v().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof Zv&&(e=[e]),cw([this,...e],t)},$v().prototype.conv1d=function(e,t,n,r,a,i){return this.throwIfDisposed(),pw(this,e,t,n,r,a,i)},$v().prototype.conv2dTranspose=function(e,t,n,r,a){return this.throwIfDisposed(),mw(this,e,t,n,r,a)},$v().prototype.conv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),hw(this,e,t,n,r,a,i)},$v().prototype.cos=function(){return this.throwIfDisposed(),YE(this)},$v().prototype.cosh=function(){return this.throwIfDisposed(),qE(this)},$v().prototype.cumprod=function(e,t,n){return this.throwIfDisposed(),IE(this,e,t,n)},$v().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),D_(this,e,t,n)};const wT=Lb({depthToSpace_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"NHWC";const r=kb(e,"x","depthToSpace","float32"),a="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];fh(t>1,(()=>"blockSize should be > 1 for depthToSpace, but was: ".concat(t))),fh(a*t>=0,(()=>"Negative dimension size caused by overflow when multiplying\n    ".concat(a," and ").concat(t,"  for depthToSpace with input shape\n    ").concat(r.shape))),fh(i*t>=0,(()=>"Negative dimension size caused by overflow when multiplying\n    ".concat(i," and ").concat(t," for depthToSpace with input shape\n        ").concat(r.shape))),fh(o%(t*t)===0,(()=>"Dimension size must be evenly divisible by ".concat(t*t," but is ").concat(o," for depthToSpace with input shape ").concat(r.shape)));const s={x:r},c={blockSize:t,dataFormat:n};return yb.runKernel(zp,s,c)}});$v().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),wT(this,e,t)},$v().prototype.depthwiseConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),ww(this,e,t,n,r,a,i)};const ST=Lb({dilation2d_:function(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC";const o=kb(e,"x","dilation2d"),s=kb(t,"filter","dilation2d");fh(3===o.rank||4===o.rank,(()=>"Error in dilation2d: input must be rank 3 or 4, but got rank "+"".concat(o.rank,"."))),fh(3===s.rank,(()=>"Error in dilation2d: filter must be rank 3, but got rank "+"".concat(s.rank,"."))),fh("NHWC"===i,(()=>"Error in dilation2d: Only NHWC is currently supported, "+"but got dataFormat of ".concat(i)));let c=o,u=!1;3===o.rank&&(c=$x(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=!0),fh(c.shape[3]===s.shape[2],(()=>"Error in dilation2d:  input and filter must have the same depth: ".concat(c.shape[3]," vs ").concat(s.shape[2])));const l={x:c,filter:s},f={strides:n,pad:r,dilations:a},d=yb.runKernel(Gp,l,f);return u?$x(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});$v().prototype.dilation2d=function(e,t,n,r,a){return this.throwIfDisposed(),ST(this,e,t,n,r,a)};const CT=Lb({divNoNan_:function(e,t){let n=kb(e,"a","div"),r=kb(t,"b","div");[n,r]=fb(n,r);const a=Ry(n,r),i=Fy(a),o=Cw(r,i);return PS(o,i,a)}});$v().prototype.divNoNan=function(e){return this.throwIfDisposed(),CT(this,e)},$v().prototype.div=function(e){return this.throwIfDisposed(),Ry(this,e)};const MT=Lb({dot_:function(e,t){const n=kb(e,"t1","dot"),r=kb(t,"t2","dot");fh((1===n.rank||2===n.rank)&&(1===r.rank||2===r.rank),(()=>"Error in dot: inputs must all be rank 1 or 2, but got ranks "+"".concat(n.rank," and ").concat(r.rank,".")));const a=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];if(fh(a===i,(()=>"Error in dot: inner dimensions of inputs must match, but got "+"".concat(a," and ").concat(i,"."))),1===n.rank&&1===r.rank){const e=$x(n,[1,-1]),t=$x(r,[-1,1]),a=Kw(e,t);return $x(a,[])}if(1===n.rank&&2===r.rank){const e=$x(n,[1,-1]),t=$x(r,[r.shape[0],r.shape[1]]),a=Kw(e,t);return $x(a,[a.size])}if(2===n.rank&&1===r.rank){const e=$x(r,[-1,1]),t=Kw(n,e);return $x(t,[t.size])}{const e=$x(r,[r.shape[0],r.shape[1]]);return Kw(n,e)}}});$v().prototype.dot=function(e){return this.throwIfDisposed(),MT(this,e)},$v().prototype.elu=function(){return this.throwIfDisposed(),Sw(this)},$v().prototype.equal=function(e){return this.throwIfDisposed(),Cw(this,e)},$v().prototype.erf=function(){return this.throwIfDisposed(),Mw(this)};const _T=Lb({euclideanNorm_:function(e){return DC(e,"euclidean",arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]&&arguments[2])}});$v().prototype.euclideanNorm=function(e,t){return this.throwIfDisposed(),_T(this,e,t)},$v().prototype.exp=function(){return this.throwIfDisposed(),_w(this)},$v().prototype.expandDims=function(e){return this.throwIfDisposed(),Ew(this,e)};const ET=Lb({expm1_:function(e){const t={x:kb(e,"x","expm1")};return yb.runKernel(tg,t)}});$v().prototype.expm1=function(){return this.throwIfDisposed(),ET(this)},$v().prototype.fft=function(){return this.throwIfDisposed(),US(this)},$v().prototype.flatten=function(){return this.throwIfDisposed(),$x(this,[this.size])},$v().prototype.floor=function(){return this.throwIfDisposed(),kw(this)},$v().prototype.floorDiv=function(e){return this.throwIfDisposed(),Ay(this,e)},$v().prototype.gather=function(e,t,n){return this.throwIfDisposed(),Nw(this,e,t,n)},$v().prototype.greaterEqual=function(e){return this.throwIfDisposed(),Aw(this,e)},$v().prototype.greater=function(e){return this.throwIfDisposed(),Lw(this,e)},$v().prototype.ifft=function(){return this.throwIfDisposed(),GS(this)},$v().prototype.irfft=function(){return this.throwIfDisposed(),VS(this)};const TT=Lb({isFinite_:function(e){const t={x:kb(e,"x","isFinite")};return yb.runKernel(gg,t)}});$v().prototype.isFinite=function(){return this.throwIfDisposed(),TT(this)};const IT=Lb({isInf_:function(e){const t={x:kb(e,"x","isInf")};return yb.runKernel(mg,t)}});$v().prototype.isInf=function(){return this.throwIfDisposed(),IT(this)};const kT=Lb({isNaN_:function(e){const t={x:kb(e,"x","isNaN")};return yb.runKernel(vg,t)}});$v().prototype.isNaN=function(){return this.throwIfDisposed(),kT(this)},$v().prototype.leakyRelu=function(e){return this.throwIfDisposed(),Rw(this,e)},$v().prototype.lessEqual=function(e){return this.throwIfDisposed(),TC(this,e)},$v().prototype.less=function(e){return this.throwIfDisposed(),LC(this,e)};const NT=Lb({localResponseNormalization_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;const i=kb(e,"x","localResponseNormalization");fh(4===i.rank||3===i.rank,(()=>"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ".concat(i.rank,"."))),fh(mh(t),(()=>"Error in localResponseNormalization: depthRadius must be an "+"integer but got depthRadius ".concat(t,".")));let o=i,s=!1;3===i.rank&&(s=!0,o=$x(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const c={x:o},u={depthRadius:t,bias:n,alpha:r,beta:a},l=yb.runKernel(Tg,c,u);return s?$x(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});$v().prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),NT(this,e,t,n,r)};const LT=Lb({logSigmoid_:function(e){const t=kb(e,"x","logSigmoid"),n=zy((e=>({value:nS(TS(nS(e))),gradFunc:t=>Dy(t,xS(nS(e)))})));return n(t)}});$v().prototype.logSigmoid=function(){return this.throwIfDisposed(),LT(this)},$v().prototype.logSoftmax=function(e){return this.throwIfDisposed(),zw(this,e)},$v().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),Xw(this,e,t)},$v().prototype.log=function(){return this.throwIfDisposed(),Dw(this)},$v().prototype.log1p=function(){return this.throwIfDisposed(),Ow(this)},$v().prototype.logicalAnd=function(e){return this.throwIfDisposed(),qw(this,e)},$v().prototype.logicalNot=function(){return this.throwIfDisposed(),UE(this)};const AT=Lb({logicalOr_:function(e,t){const n=kb(e,"a","logicalOr","bool"),r=kb(t,"b","logicalOr","bool");tx(n.shape,r.shape);const a={a:n,b:r};return yb.runKernel(Eg,a)}});$v().prototype.logicalOr=function(e){return this.throwIfDisposed(),AT(this,e)};const RT=Lb({logicalXor_:function(e,t){const n=kb(e,"a","logicalXor","bool"),r=kb(t,"b","logicalXor","bool");return tx(n.shape,r.shape),qw(AT(e,t),UE(qw(e,t)))}});$v().prototype.logicalXor=function(e){return this.throwIfDisposed(),RT(this,e)},$v().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),Kw(this,e,t,n)},$v().prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),Qw(this,e,t,n,r)},$v().prototype.max=function(e,t){return this.throwIfDisposed(),Pw(this,e,t)},$v().prototype.maximum=function(e){return this.throwIfDisposed(),nx(this,e)},$v().prototype.mean=function(e,t){return this.throwIfDisposed(),Zw(this,e,t)},$v().prototype.min=function(e,t){return this.throwIfDisposed(),$w(this,e,t)},$v().prototype.minimum=function(e){return this.throwIfDisposed(),eS(this,e)};const DT=Lb({mirrorPad_:function(e,t,n){fh("reflect"===n||"symmetric"===n,(()=>"Invalid mode. Mode must be either reflect or symmetric. "+"Got ".concat(n,".")));const r=kb(e,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");fh(t.length===r.rank,(()=>"Padding doesn't match input. Must be ".concat(r.rank,". ")+"Got ".concat(t.length,".")));const a="reflect"===n?1:0;for(let s=0;s<r.rank;s++)fh(2===t[s].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),fh(t[s][0]>=0&&t[s][0]<=r.shape[s]-a&&t[s][1]>=0&&t[s][1]<=r.shape[s]-a,(()=>"Padding in dimension ".concat(s," cannot be greater than or equal ")+"to ".concat(r.shape[s]-a," or less than 0 for input of ")+"shape ".concat(r.shape)));const i={paddings:t,mode:n},o={x:r};return yb.runKernel(jg,o,i)}});$v().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),DT(this,e,t)};const OT=Lb({mod_:function(e,t){let n=kb(e,"a","mod"),r=kb(t,"b","mod");[n,r]=fb(n,r);const a={a:n,b:r};return yb.runKernel(Bg,a)}});$v().prototype.mod=function(e){return this.throwIfDisposed(),OT(this,e)},$v().prototype.mul=function(e){return this.throwIfDisposed(),Dy(this,e)},$v().prototype.neg=function(){return this.throwIfDisposed(),nS(this)},$v().prototype.norm=function(e,t,n){return this.throwIfDisposed(),DC(this,e,t,n)},$v().prototype.notEqual=function(e){return this.throwIfDisposed(),rS(this,e)},$v().prototype.oneHot=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.throwIfDisposed(),aS(this,e,t,n)},$v().prototype.onesLike=function(){return this.throwIfDisposed(),sS(this)},$v().prototype.pad=function(e,t){return this.throwIfDisposed(),cS(this,e,t)};const PT=Lb({pool_:function(e,t,n,r,a,i,o){null==a&&(a=[1,1]),null==i&&(i=1),0===r&&(r="valid");const s=kb(e,"x","maxPool");let c=s,u=!1;3===s.rank&&(u=!0,c=$x(s,[1,s.shape[0],s.shape[1],s.shape[2]])),fh(Kx(i,a),(()=>"Error in pool: Either strides or dilations must be 1. "+"Got strides ".concat(i," and dilations '").concat(a,"'")));const l=jx(c.shape,t,i,a,r),f=[l.dilationHeight,l.dilationWidth];let d;d="same"===r?function(e,t){const n=e.map(((e,n)=>e+(e-1)*(t[n]-1))),r=n.map((e=>e-1)),a=r.map((e=>Math.floor(e/2))),i=r.map(((e,t)=>e-a[t]));return r.map(((e,t)=>[a[t],i[t]]))}([l.filterHeight,l.filterWidth],f):[[0,0],[0,0]];const h=1===f[0]&&1===f[1],[p,g]=function(e,t,n){const r=n.map((e=>e[0])),a=n.map((e=>e[1])),i=e.concat(r,a),o=t.map(((e,t)=>(e-i[t]%e)%e)),s=a.map(((e,t)=>e+o[t])),c=t.map(((e,t)=>[r[t],s[t]])),u=t.map(((e,t)=>[0,o[t]]));return[c,u]}([l.inHeight,l.inWidth],f,d),m=h?r:"valid",v=h?c:b_(c,f,p),b=("avg"===n?()=>ew(v,t,i,m,o):()=>Qw(v,t,i,m,o))(),y=h?b:$E(b,f,g);return u?$x(y,[y.shape[1],y.shape[2],y.shape[3]]):y}});$v().prototype.pool=function(e,t,n,r,a,i){return this.throwIfDisposed(),PT(this,e,t,n,r,a,i)},$v().prototype.pow=function(e){return this.throwIfDisposed(),Ky(this,e)},$v().prototype.prelu=function(e){return this.throwIfDisposed(),uS(this,e)};const FT=Lb({prod_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=kb(e,"x","prod");"bool"===r.dtype&&(r=Iy(r,"int32"));const a={x:r},i={axis:t,keepDims:n};return yb.runKernel(em,a,i)}});$v().prototype.prod=function(e,t){return this.throwIfDisposed(),FT(this,e,t)};const zT=Lb({reciprocal_:function(e){const t={x:kb(e,"x","reciprocal")};return yb.runKernel(om,t)}});$v().prototype.reciprocal=function(){return this.throwIfDisposed(),zT(this)},$v().prototype.relu=function(){return this.throwIfDisposed(),mS(this)},$v().prototype.relu6=function(){return this.throwIfDisposed(),YS(this)},$v().prototype.reshapeAs=function(e){return this.throwIfDisposed(),$x(this,e.shape)},$v().prototype.reshape=function(e){return this.throwIfDisposed(),$x(this,e)},$v().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),MC(this,e,t,n)},$v().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),_C(this,e,t,n)},$v().prototype.reverse=function(e){return this.throwIfDisposed(),vS(this,e)},$v().prototype.rfft=function(){return this.throwIfDisposed(),WS(this)},$v().prototype.round=function(){return this.throwIfDisposed(),IC(this)},$v().prototype.rsqrt=function(){return this.throwIfDisposed(),H_(this)},$v().prototype.selu=function(){return this.throwIfDisposed(),bS(this)},$v().prototype.separableConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),yS(this,e,t,n,r,a,i)},$v().prototype.sigmoid=function(){return this.throwIfDisposed(),xS(this)};const jT=Lb({sign_:function(e){const t={x:kb(e,"x","sign")};return yb.runKernel(_m,t)}});$v().prototype.sign=function(){return this.throwIfDisposed(),jT(this)},$v().prototype.sin=function(){return this.throwIfDisposed(),N_(this)},$v().prototype.sinh=function(){return this.throwIfDisposed(),A_(this)},$v().prototype.slice=function(e,t){return this.throwIfDisposed(),wS(this,e,t)},$v().prototype.softmax=function(e){return this.throwIfDisposed(),ES(this,e)},$v().prototype.softplus=function(){return this.throwIfDisposed(),TS(this)},$v().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),b_(this,e,t)},$v().prototype.split=function(e,t){return this.throwIfDisposed(),IS(this,e,t)},$v().prototype.sqrt=function(){return this.throwIfDisposed(),Oy(this)},$v().prototype.square=function(){return this.throwIfDisposed(),Py(this)},$v().prototype.squaredDifference=function(e){return this.throwIfDisposed(),jC(this,e)},$v().prototype.squeeze=function(e){return this.throwIfDisposed(),kS(this,e)},$v().prototype.stack=function(e,t){this.throwIfDisposed();const n=e instanceof Zv?[this,e]:[this,...e];return NS(n,t)},$v().prototype.step=function(e){return this.throwIfDisposed(),XS(this,e)};const BT=Lb({stridedSlice_:function(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0;const u={x:kb(e,"x","stridedSlice","string_or_numeric")},l={begin:t,end:n,strides:r,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:c};return yb.runKernel(Um,u,l)}});$v().prototype.stridedSlice=function(e,t,n,r,a,i,o,s){return this.throwIfDisposed(),BT(this,e,t,n,r,a,i,o,s)},$v().prototype.sub=function(e){return this.throwIfDisposed(),Qy(this,e)},$v().prototype.sum=function(e,t){return this.throwIfDisposed(),Fw(this,e,t)};const UT=Lb({tan_:function(e){const t={x:kb(e,"x","tan","float32")};return yb.runKernel(Ym,t)}});$v().prototype.tan=function(){return this.throwIfDisposed(),UT(this)},$v().prototype.tanh=function(){return this.throwIfDisposed(),LS(this)},$v().prototype.tile=function(e){return this.throwIfDisposed(),Tw(this,e)},$v().prototype.toBool=function(){return this.throwIfDisposed(),Iy(this,"bool")},$v().prototype.toFloat=function(){return this.throwIfDisposed(),Iy(this,"float32")},$v().prototype.toInt=function(){return this.throwIfDisposed(),Iy(this,"int32")};const WT=Lb({topk_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=kb(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");const a=r.shape[r.shape.length-1];if(t<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(t));if(t>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") ")+"but got ".concat(t));const i={x:r},o={k:t,sorted:n},[s,c]=yb.runKernel(Km,i,o);return{values:s,indices:c}}});$v().prototype.topk=function(e,t){return this.throwIfDisposed(),WT(this,e,t)},$v().prototype.transpose=function(e){return this.throwIfDisposed(),jS(this,e)};const GT=Lb({unique_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=kb(e,"x","unique","string_or_numeric");fh(n.rank>0,(()=>"The input tensor must be at least 1D"));const r={x:n},a={axis:t},[i,o]=yb.runKernel(Zm,r,a);return{values:i,indices:o}}});$v().prototype.unique=function(e){return this.throwIfDisposed(),GT(this,e)},$v().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),X_(this,e,t)},$v().prototype.unstack=function(e){return this.throwIfDisposed(),OS(this,e)},$v().prototype.where=function(e,t){return this.throwIfDisposed(),PS(e,this,t)},$v().prototype.zerosLike=function(){return this.throwIfDisposed(),Fy(this)};class VT extends Error{constructor(e){super(e),Object.setPrototypeOf(this,VT.prototype)}}class HT extends Error{constructor(e){super(e),Object.setPrototypeOf(this,HT.prototype)}}class YT extends Error{constructor(e){super(e),Object.setPrototypeOf(this,YT.prototype)}}class XT extends Error{constructor(e){super(e),Object.setPrototypeOf(this,XT.prototype)}}class qT extends Error{constructor(e){super(e),Object.setPrototypeOf(this,qT.prototype)}}Error;class KT{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const e=this.cache.keys().next().value;this.cache.delete(e)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error("The maxEntries of LRU caches must be at least 0, but got ".concat(e,"."));if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const e=this.cache.keys().next().value;this.cache.delete(e)}this.maxEntries=e}}function QT(e,t){if(Array.isArray(e)){let n=[];for(let r=0;r<t;r++)n=n.concat(e);return n}{const n=new Array(t);return n.fill(e),n}}function JT(e,t){if(!e)throw new qT(t)}function ZT(e,t){let n=0;for(const r of e)r===t&&n++;return n}function $T(e){return 1===e.length?e[0]:e}function eI(e){return Array.isArray(e)?e:[e]}function tI(e){const t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function nI(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,((e,t)=>t.toUpperCase()))}let rI={};function aI(e){if(null===e||void 0===e)return null;const t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function iI(e){if(null!=e&&"object"===typeof e)if(Array.isArray(e))e.forEach((e=>iI(e)));else{const t=Object.keys(e);for(const n of t){const t=e[n];null!=t&&"object"===typeof t&&(Array.isArray(t)||"ndarray"!==t.type||"number"!==typeof t.value?iI(t):e[n]=t.value)}}}function oI(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"object",a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("string"===typeof e){const a=e;let i;if(a in n)i=n[a];else if(a in rI)i=rI[a];else if(i=t[a],null==i)throw new YT("Unknown ".concat(r,": ").concat(e,". ")+"This may be due to one of the following reasons:\n"+"1. The ".concat(r," is defined in Python, in which ")+"case it needs to be ported to TensorFlow.js or your JavaScript code.\n"+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");return i}{const i=e;if(null==i.className||null==i.config)throw new YT("".concat(r,": Improper config format: ")+"".concat(JSON.stringify(i),".\n")+"'className' and 'config' must set.");const o=i.className;let s,c;if(o in n?[s,c]=n[o]:o in rI?[s,c]=rI.className:o in t&&([s,c]=t[o]),null==s)throw new YT("Unknown ".concat(r,": ").concat(o,". ")+"This may be due to one of the following reasons:\n"+"1. The ".concat(r," is defined in Python, in which ")+"case it needs to be ported to TensorFlow.js or your JavaScript code.\n"+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");if(null!=c){const e={};for(const n of Object.keys(rI))e[n]=rI[n];for(const a of Object.keys(n))e[a]=n[a];i.config.customObjects=e;const t=Object.assign({},rI);for(const a of Object.keys(n))rI[a]=n[a];iI(i.config);const r=c(s,i.config,n,a);return rI=Object.assign({},t),r}{const e=Object.assign({},rI);for(const r of Object.keys(n))rI[r]=n[r];const t=new s(i.config);return rI=Object.assign({},e),t}}}function sI(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function cI(e){if(null==e)return e;const t=[];for(const n of e)-1===t.indexOf(n)&&t.push(n);return t}function uI(e){if(null==e)throw new YT("Invalid value in obj: ".concat(JSON.stringify(e)));for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}function lI(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new YT("".concat(n," is not a valid ").concat(t,".  Valid values are ").concat(e," or null/undefined."))}function fI(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return JT(n>=0),JT(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every((e=>typeof e===t))}function dI(e,t){Array.isArray(e)?(fh(e.length>0,(()=>"".concat(t," is unexpectedly an empty array."))),e.forEach(((e,n)=>dI(e,"element ".concat(n+1," of ").concat(t))))):fh(Number.isInteger(e)&&e>0,(()=>"Expected ".concat(t," to be a positive integer, but got ")+"".concat(hI(e),".")))}function hI(e){return null===e?"null":Array.isArray(e)?"["+e.map((e=>hI(e))).join(",")+"]":"string"===typeof e?'"'.concat(e,'"'):"".concat(e)}function pI(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}let gI=0;function mI(){return gI++}const vI={};function bI(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e in vI||(vI[e]=0),vI[e]+=1,e+vI[e].toString()}const yI=["channelsFirst","channelsLast"],xI=["nearest","bilinear"],wI=["valid","same","causal"],SI=["max","avg"],CI=["sum","mul","concat","ave"],MI=new Map;function _I(e){lI(yI,"DataFormat",e)}function EI(e){lI(wI,"PaddingMode",e)}function TI(e){lI(SI,"PoolMode",e)}const II=[];function kI(e,t){II.push(e);try{const e=t();return II.pop(),e}catch(IQ){throw II.pop(),IQ}}function NI(e){if(!RI(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===II.length?"":II.join("/")+"/")+e}function LI(e){if(!RI(e))throw new Error("Not a valid tensor name: '"+e+"'");MI.has(e)||MI.set(e,0);const t=MI.get(e);if(MI.set(e,MI.get(e)+1),t>0){const n="".concat(e,"_").concat(t);return MI.set(n,1),n}return e}const AI=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function RI(e){return!!e.match(AI)}function DI(e){return e===parseInt(e.toString(),10)}function OI(e,t,n){null==t&&(t=0),null==n&&(n=e.length);let r=1;for(let a=t;a<n;++a)r*=e[a];return r}function PI(e){if(0===e.length)return Number.NaN;let t=Number.POSITIVE_INFINITY;for(let n=0;n<e.length;n++){const r=e[n];r<t&&(t=r)}return t}function FI(e){if(0===e.length)return Number.NaN;let t=Number.NEGATIVE_INFINITY;for(let n=0;n<e.length;n++){const r=e[n];r>t&&(t=r)}return t}function zI(e,t){if(t<e)throw new YT("end (".concat(t,") < begin (").concat(e,") is forbidden."));const n=[];for(let r=e;r<t;++r)n.push(r);return n}let jI;function BI(){return null==jI&&(jI=Wb().epsilon()),jI}function UI(e,t){return Iy(e,t)}function WI(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;const n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),$x(e,n)}function GI(e,t,n){return zb((()=>{switch(e.rank){case 1:return SS(e,t,n);case 2:return CS(e,[t,0],[n,e.shape[1]]);case 3:return MS(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return _S(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return wS(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return wS(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new YT("sliceAlongFirstAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function VI(e,t,n){return zb((()=>{switch(e.rank){case 1:return SS(e,t,n);case 2:return CS(e,[0,t],[e.shape[0],n]);case 3:return MS(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return _S(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new YT("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function HI(e,t,n,r){return zb((()=>{switch(e.rank){case 1:return SS(e,t,n);case 2:switch(r){case 1:return GI(e,t,n);case 2:return VI(e,t,n);default:throw new YT("The axis is not within the rank of the tensor "+"".concat(r))}case 3:switch(r){case 1:return GI(e,t,n);case 2:return MS(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return VI(e,t,n);default:throw new YT("The axis is not within the rank of the tensor "+"".concat(r))}case 4:switch(r){case 1:return GI(e,t,n);case 2:return _S(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return _S(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return VI(e,t,n);default:throw new YT("The axis is not within the rank of the tensor "+"".concat(r))}default:throw new YT("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function YI(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return n<0&&(t=e[0].rank,n=0!==t?t:0),n===e[0].rank&&(n=-1),cw(e,n)}function XI(e,t){switch(e.rank){case 1:return uw([e,t]);case 2:return lw([e,t],0);case 3:return fw([e,t],0);case 4:return dw([e,t],0);default:throw new YT("concatAlongFirstAxis() received an unsupported "+"tensor rank: ".concat(e.rank))}}function qI(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new YT("The length of input n (".concat(t.length,") does not match ")+"the number of dimensions in input x (".concat(e.rank,")"));return Tw(e,t)}function KI(e){return hS(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0)}function QI(e,t,n,r){if(e.rank<2||t.rank<2)throw new XT("dot requires both inputs to be rank >= 2"+" but got x shape = ".concat(e.shape," and y shape = ").concat(t.shape));if(t.rank>=3){if(e.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new XT("If rank y >= 3, then the second last dim"+" of y must equal the last dim of x but got x shape = ".concat(e.shape," and ")+" y shape = ".concat(t.shape))}if(2===e.rank&&2===t.rank){return tC({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?$I(e.rank,r,"channelsLast"):null,activation:n})}{const a=e.shape.slice(),i=a.pop();e=$x(e,[-1,i]);const o=t.shape.slice(),s=o.pop(),c=o.pop(),u=[...o,s],l=Array.from({length:t.rank},((e,n)=>0===n?t.rank-2:n<=t.rank-2?n-1:n));t=$x(jS(t,l),[c,-1]);const f=[...a,...u];return $x(tC({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?$I(e.rank,r,"channelsLast"):null,activation:n}),f)}}function JI(e,t,n){return zb((()=>(t=Array.isArray(t)?AS(t,"int32"):Iy(t,"int32"),Nw(e,t,n))))}function ZI(e){return Dy(e,e)}function $I(e,t,n){const r=t.shape;if(1!==t.rank&&t.rank!==e)throw new YT("Unexpected bias dimensions: ".concat(t.rank)+"; expected it to be 1 or ".concat(e));if(5===e){if("channelsFirst"===n)return 1===r.length?$x(t,[1,r[0],1,1,1]):$x(t,[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return 1===r.length?$x(t,[1,1,1,1,r[0]]):$x(t,[1].concat(r))}else if(4===e){if("channelsFirst"===n)return 1===r.length?$x(t,[1,r[0],1,1]):$x(t,[1,r[2],r[0],r[1]]);if("channelsLast"===n)return 1===r.length?$x(t,[1,1,1,r[0]]):$x(t,[1].concat(r))}else if(3===e){if("channelsFirst"===n)return 1===r.length?$x(t,[1,r[0],1]):$x(t,[1,r[1],r[0]]);if("channelsLast"===n)return 1===r.length?$x(t,[1,1,r[0]]):$x(t,[1].concat(r))}else if(e<3)return t;throw new YT("Unsupported input rank by biasAdd: ".concat(t.rank))}function ek(e,t,n){return zb((()=>(null==n&&(n="channelsLast"),_I(n),Ly(e,$I(e.rank,t,n)))))}function tk(e,t,n,r){return zb((()=>BS(e,t,n,r)))}function nk(e,t){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]?e():t()}const rk=["fanIn","fanOut","fanAvg"],ak=["normal","uniform","truncatedNormal"];class ik extends Wy{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class ok extends ik{apply(e,t){return iS(e,t)}}ok.className="Zeros",Vy(ok);class sk extends ik{apply(e,t){return oS(e,t)}}sk.className="Ones",Vy(sk);class ck extends ik{constructor(e){if(super(),"object"!==typeof e)throw new YT("Expected argument of type ConstantConfig but got ".concat(e));if(void 0===e.value)throw new YT("config must have value set but got ".concat(e));this.value=e.value}apply(e,t){return zb((()=>Dy(jy(this.value),oS(e,t))))}getConfig(){return{value:this.value}}}ck.className="Constant",Vy(ck);class uk extends ik{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return pS(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}uk.className="RandomUniform",Vy(uk);class lk extends ik{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new XT("randomNormal does not support dType ".concat(t,"."));return KI(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}lk.className="RandomNormal",Vy(lk);class fk extends ik{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new XT("truncatedNormal does not support dType ".concat(t,"."));return DS(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}fk.className="TruncatedNormal",Vy(fk);class dk extends ik{constructor(e){super(),this.gain=null!=e.gain?e.gain:1}apply(e,t){return zb((()=>{if(2!==e.length||e[0]!==e[1])throw new YT("Identity matrix initializer can only be used for 2D square matrices.");return Dy(this.gain,Iw(e[0]))}))}getConfig(){return{gain:this.gain}}}dk.className="Identity",Vy(dk);class hk extends ik{constructor(e){if(super(),e.scale<0)throw new YT("scale must be a positive float. Got: ".concat(e.scale));this.scale=null==e.scale?1:e.scale,this.mode=null==e.mode?"fanIn":e.mode,function(e){lI(rk,"FanMode",e)}(this.mode),this.distribution=null==e.distribution?"normal":e.distribution,function(e){lI(ak,"Distribution",e)}(this.distribution),this.seed=e.seed}apply(e,t){const n=function(e){let t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"channelsLast";if(_I(r),2===e.length)t=e[0],n=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===r){const r=OI(e,2);t=e[1]*r,n=e[0]*r}else if("channelsLast"===r){const r=OI(e,0,e.length-2);t=e[e.length-2]*r,n=e[e.length-1]*r}}else{const r=OI(e);t=Math.sqrt(r),n=Math.sqrt(r)}return[t,n]}(e),r=n[0],a=n[1];let i=this.scale;if("fanIn"===this.mode?i/=Math.max(1,r):"fanOut"===this.mode?i/=Math.max(1,a):i/=Math.max(1,(r+a)/2),"normal"===this.distribution){const n=Math.sqrt(i);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new XT("".concat(this.getClassName()," does not support dType ").concat(t,"."));return DS(e,0,n,t,this.seed)}{const n=Math.sqrt(3*i);return pS(e,-n,n,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}hk.className="VarianceScaling",Vy(hk);class pk extends hk{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return hk.className}}pk.className="GlorotUniform",Vy(pk);class gk extends hk{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return hk.className}}gk.className="GlorotNormal",Vy(gk);class mk extends hk{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return hk.className}}mk.className="HeNormal",Vy(mk);class vk extends hk{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return hk.className}}vk.className="HeUniform",Vy(vk);class bk extends hk{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return hk.className}}bk.className="LeCunNormal",Vy(bk);class yk extends hk{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return hk.className}}yk.className="LeCunUniform",Vy(yk);class xk extends ik{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=null==e.gain?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return zb((()=>{if(e.length<2)throw new XT("Shape must be at least 2D.");if("int32"!==t&&"float32"!==t&&void 0!==t)throw new TypeError("Unsupported data type ".concat(t,"."));const n=ph(e.slice(0,-1)),r=e[e.length-1],a=n*r;a>this.ELEMENTS_WARN_SLOW&&console.warn("Orthogonal initializer is being called on a matrix with more "+"than ".concat(this.ELEMENTS_WARN_SLOW," (").concat(a,") elements: ")+"Slowness may result.");const i=KI([Math.max(r,n),Math.min(r,n)],0,1,t,this.seed),o=UC.qr(i,!1);let s=o[0];const c=o[1].flatten().stridedSlice([0],[Math.min(r,n)*Math.min(r,n)],[Math.min(r,n)+1]);return s=Dy(s,c.sign()),n<r&&(s=s.transpose()),Dy(jy(this.gain),s.reshape(e))}))}getConfig(){return{gain:this.gain,seed:this.seed}}}xk.className="Orthogonal",Vy(xk);const wk={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function Sk(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return oI(e,Gy.getMap().classNameMap,t,"initializer")}function Ck(e){return aI(e)}function Mk(e){if("string"===typeof e){const t=e in wk?wk[e]:e;if("GlorotNormal"===t)return new gk;if("GlorotUniform"===t)return new pk;if("HeNormal"===t)return new mk;if("HeUniform"===t)return new vk;if("LeCunNormal"===t)return new bk;if("LeCunUniform"===t)return new yk;{const e={};return e.className=t,e.config={},Sk(e)}}return e instanceof ik?e:Sk(e)}function _k(e){return Array.isArray(e)&&Array.isArray(e[0])}function Ek(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function Tk(e){let t;if(Array.isArray(e)){if(1!==e.length)throw new YT("Expected Tensor length to be 1; got ".concat(e.length));t=e[0]}else t=e;return t}function Ik(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return e[0];throw new YT("Expected exactly 1 Shape; got ".concat(e.length))}return e}function kk(e){let t=0;for(const n of e)0===n.shape.length?t+=1:t+=n.shape.reduce(((e,t)=>e*t));return t}const Nk="Variable";class Lk{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Nk,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.dtype=null==t?"float32":t,this.shape=e.shape,this.id=mI(),n=null==n?Nk:n,this.originalName=NI(n),this.name=LI(this.originalName),this.trainable_=r,this.constraint=a,this.val=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return yb.makeVariable(e,t,n,r)}(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error("LayersVariable ".concat(this.name," is already disposed."))}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function Ak(e){return e.map((e=>e.read()))}function Rk(e){e.forEach((e=>{e[0].write(e[1])}))}class Dk{constructor(e){this.dtype=e.dtype,this.shape=e.shape,null!=e.shape?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class Ok{constructor(e,t,n,r,a,i,o){this.dtype=e,this.shape=t,this.sourceLayer=n,this.inputs=r,this.callArgs=a,this.outputTensorIndex=o,this.id=mI(),null!=i&&(this.originalName=NI(i),this.name=LI(this.originalName)),this.rank=t.length}}let Pk=0;class Fk{constructor(e,t){this.callArgs=t,this.id=Pk++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const n of e.inboundLayers)null!=n&&n.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)null!=t?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let zk=0;class jk extends Wy{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=zk++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const e=this.getClassName();t=tI(e)+"_"+bI(e)}if(this.name=t,this.trainable_=null==e.trainable||e.trainable,null!=e.inputShape||null!=e.batchInputShape){let t;if(null!=e.batchInputShape)t=e.batchInputShape;else if(null!=e.inputShape){let n=null;null!=e.batchSize&&(n=e.batchSize),t=[n].concat(e.inputShape)}this.batchInputShape=t;let n=e.dtype;null==n&&(n=e.inputDType),null==n&&(n="float32"),this.dtype=n}null!=e.weights?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(0===this.inboundNodes.length)throw new HT("The layer has never been called "+"and thus has no defined ".concat(t,"."));if(this.inboundNodes.length<=e)throw new YT("Asked to get ".concat(t," at node ").concat(e,", ")+"but the layer has only ".concat(this.inboundNodes.length," inbound nodes."));return this.inboundNodes[e]}getInputAt(e){return $T(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return $T(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new VT("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new VT("Layer ".concat(this.name)+" is not connected, no input to return.");return $T(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(0===this.inboundNodes.length)throw new VT("Layer ".concat(this.name)+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new VT("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return $T(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map((e=>e()))}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach((t=>t.trainable=e)),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter((e=>e.trainable)):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter((e=>!e.trainable)).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const t=eI(e);if(null==this.inputSpec||0===this.inputSpec.length)return;const n=eI(this.inputSpec);if(t.length!==n.length)throw new YT("Layer ".concat(this.name," expects ").concat(n.length," inputs, ")+"but it received ".concat(t.length," input tensors. ")+"Input received: ".concat(e));for(let r=0;r<t.length;r++){const e=t[r],a=n[r];if(null==a)continue;const i=e.rank;if(null!=a.ndim&&i!==a.ndim)throw new YT("Input ".concat(r," is incompatible with layer ").concat(this.name,": ")+"expected ndim=".concat(a.ndim,", found ndim=").concat(i));if(null!=a.maxNDim&&i>a.maxNDim)throw new YT("Input ".concat(r," is incompatible with layer ").concat(this.name)+": expected max_ndim=".concat(a.maxNDim,", found ndim=").concat(i));if(null!=a.minNDim&&i<a.minNDim)throw new YT("Input ".concat(r," is incompatible with layer ").concat(this.name)+": expected min_ndim=".concat(a.minNDim,", found ndim=").concat(i,"."));if(null!=a.dtype&&e.dtype!==a.dtype)throw new YT("Input ".concat(r," is incompatible with layer ").concat(this.name," ")+": expected dtype=".concat(a.dtype,", found dtype=").concat(e.dtype,"."));if(a.axes){const t=e.shape;for(const e in a.axes){const n=Number(e),i=a.axes[e],o=n>=0?t[n]:t[t.length+n];if(null!=i&&-1===[i,null].indexOf(o))throw new YT("Input ".concat(r," is incompatible with layer ")+"".concat(this.name,": expected axis ").concat(n," of input shape to ")+"have value ".concat(i," but got shape ").concat(t,"."))}}if(null!=a.shape)for(let t=0;t<a.shape.length;++t){const n=a.shape[t],i=e.shape[t];if(null!=n&&null!=i&&n!==i)throw new YT("Input ".concat(r," is incompatible with layer ")+"".concat(this.name,": expected shape=").concat(a.shape,", ")+"found shape=".concat(e.shape,"."))}}}call(e,t){return e}invokeCallHook(e,t){null!=this._callHook&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const n=eI(e),r=function(e){let t=!0;for(const n of eI(e))if(!(n instanceof Ok)){t=!1;break}return t}(e),a=function(e){let t=!0;for(const n of eI(e))if(n instanceof Ok){t=!1;break}return t}(e);if(r===a)throw new YT("Arguments to apply() must be all SymbolicTensors or all Tensors");return kI(this.name,(()=>{if(!this.built){this.assertInputCompatibility(e);const t=[];for(const n of eI(e))t.push(n.shape);this.build($T(t)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),null===this._refCount&&a&&(this._refCount=1)}if(this.assertInputCompatibility(e),a){let r=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,r);const a=eI(r),i=[];for(let e of a)-1!==n.indexOf(e)&&(e=e.clone()),i.push(e);if(r=$T(i),null!=this.activityRegularizer)throw new XT("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return r}{const n=function(e){e=eI(e);const t=[];for(const n of e)t.push(n.shape);return $T(t)}(e),r=this.computeOutputShape(n);let a;const i="float32";if(this.warnOnIncompatibleInputShape(Array.isArray(e)?n[0]:n),a=null!=r&&r.length>0&&Array.isArray(r[0])?r.map(((n,r)=>new Ok(i,n,this,eI(e),t,this.name,r))):new Ok(i,r,this,eI(e),t,this.name),this.addInboundNode(e,a,null,null,n,r,t),this._refCount++,null!=this.activityRegularizer)throw new XT("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return a}}))}warnOnIncompatibleInputShape(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+"".concat(JSON.stringify(e),") does not match that of the ")+"batchInputShape (".concat(JSON.stringify(this.batchInputShape),") ")+"of the layer ".concat(this.name));else{let t=!1;this.batchInputShape.forEach(((n,r)=>{null!=n&&null!=e[r]&&e[r]!==n&&(t=!0)})),t&&console.warn("The shape of the input tensor "+"(".concat(JSON.stringify(e),") does not ")+"match the expectation of layer ".concat(this.name,": ")+"".concat(JSON.stringify(this.batchInputShape)))}}get outputShape(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new VT("The layer ".concat(this.name," has never been called and thus has no ")+"defined output shape.");const e=[];for(const t of this.inboundNodes){const n=JSON.stringify(t.outputShapes);-1===e.indexOf(n)&&e.push(n)}if(1===e.length){const e=this.inboundNodes[0].outputShapes;return Array.isArray(e)&&Array.isArray(e[0])&&1===e.length?e[0]:e}throw new VT("The layer ".concat(this.name," has multiple inbound nodes with different ")+'output shapes. Hence the notion of "output shape" is ill-defined for the layer.')}countParams(){if(!this.built)throw new HT("You tried to call countParams() on ".concat(this.name,", ")+"but the layer is not built yet. Build it first by calling build(batchInputShape).");return kk(this.weights)}build(e){this.built=!0}getWeights(){return Ak(arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.trainableWeights:this.weights)}setWeights(e){zb((()=>{const t=this.weights;if(t.length!==e.length)throw new YT('You called setWeights(weights) on layer "'.concat(this.name,'" ')+"with a weight list of length ".concat(e.length,", ")+"but the layer was expecting ".concat(t.length," weights. ")+"Provided weights: ".concat(e,"..."));if(0===t.length)return;const n=[],r=Ak(t);for(let a=0;a<r.length;++a){const i=r[a],o=t[a],s=e[a];if(!gh(i.shape,s.shape))throw new YT("Layer weight shape ".concat(i.shape," ")+"not compatible with provided weight shape ".concat(s.shape));n.push([o,s])}Rk(n)}))}addWeight(e,t,n,r,a,i,o,s){if(-1!==this._addedWeightNames.indexOf(e))throw new YT("Duplicate weight name ".concat(e," for layer ").concat(this.name));this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=null!=s?s():Mk("zeros"));const c=r.apply(t,n),u=new Lk(c,n,e,i,o);return c.dispose(),null!=a&&this.addLoss((()=>a.apply(u.read()))),null==i&&(i=!0),i?this._trainableWeights.push(u):this._nonTrainableWeights.push(u),u}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){null==e||Array.isArray(e)&&0===e.length||(e=eI(e),void 0!==this._losses&&null!==this._losses&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError("Layer ".concat(this.name," does not support masking, ")+"but was passed an inputMask.");t.forEach((e=>{if(null!=e)throw new TypeError("Layer ".concat(this.name," does not support masking, ")+"but was passed an inputMask.")}))}return null}return t}setMaskMetadata(e,t,n){if(!this.supportsMasking)return;const r=this.computeMask(e,n),a=eI(t),i=eI(r);if(a.length!==i.length)throw new Error("".concat(this.name," outputs ").concat(a.length," tensors ")+"but ".concat(a.length," masks for those tensors"));for(let o=0;o<a.length;o++)a[o].kerasMask=i[o]}addInboundNode(e,t,n,r,a,i){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;const s=eI(e);t=eI(t),n=eI(n),r=eI(r),a=Ek(a),i=Ek(i);const c=[],u=[],l=[];for(const f of s)c.push(f.sourceLayer),u.push(f.nodeIndex),l.push(f.tensorIndex);new Fk({outboundLayer:this,inboundLayers:c,nodeIndices:u,tensorIndices:l,inputTensors:s,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:a,outputShapes:i},o);for(let f=0;f<t.length;f++)t[f].sourceLayer=this,t[f].nodeIndex=this.inboundNodes.length-1,t[f].tensorIndex=f}getConfig(){const e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach((e=>e.dispose())),this.weights.length}assertNotDisposed(){if(0===this._refCount)throw new Error("Layer '".concat(this.name,"' is already disposed."))}dispose(){if(!this.built)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been ")+"built yet.");if(null===this._refCount)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been used ")+"yet.");this.assertNotDisposed();let e=0;return 0===--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function Bk(e,t,n){if((null==t||null!=n&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),0===t.inboundNodes.length)return[e];{const e=t.inboundNodes[n];if(0===e.inboundLayers.length)return e.inputTensors;{const t=[];for(let n=0;n<e.inboundLayers.length;n++){const r=Bk(e.inputTensors[n],e.inboundLayers[n],e.nodeIndices[n]);for(const e of r)-1===t.indexOf(e)&&t.push(e)}return t}}}class Uk extends jk{constructor(e){if(super({dtype:e.dtype,name:null!=e.name?e.name:bI("input").toString()}),null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new YT("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(null==t){if(null==e.inputShape)throw new YT("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new YT("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const n=e.dtype||"float32";this.batchInputShape=t,this.dtype=n,this.inputSpec=[{shape:t}];const r=new Ok(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new Fk({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new YT("Cannot pass any input to an "+"InputLayer's apply() method. InputLayer name: ".concat(this.name))}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}Uk.className="InputLayer",Vy(Uk);class Wk{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof Wk)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(null==e)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,n){if(null!=this.id2Value[e.id])throw new YT("Duplicate key: name=".concat(e.name,", id=").concat(e.id));return this.id2Value[e.id]=function(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return Iy(t,e.dtype)}catch(upe){throw new YT("The dtype of the feed (".concat(t.dtype,") can not be cast to the dtype ")+"of the key '".concat(e.name,"' (").concat(e.dtype,")."))}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return null!=this.id2Value[e.id]}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof Ok){if(null==this.id2Value[e.id])throw new YT("Nonexistent key: ".concat(e.name));return this.id2Value[e.id]}{const t=this.name2Id[e];if(null==t)throw new YT("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Value[t]}}getMask(e){if(e instanceof Ok){if(null==this.id2Value[e.id])throw new YT("Nonexistent key: ".concat(e.name));return this.id2Mask[e.id]}{const t=this.name2Id[e];if(null==t)throw new YT("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Mask[t]}}disposeMasks(){null!=this.id2Mask&&jb(this.id2Mask)}}const Gk=new KT,Vk=new KT;function Hk(e,t,n,r){const a=null!=n&&n.training,i=Array.isArray(e),o=i?e:[e],s=o.map((e=>e.name)),c=[],u=t.names();for(const p of s)-1!==u.indexOf(p)?c.push(t.getValue(p)):c.push(null);null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);const l=s.join(",")+"|"+t.names().sort().join(",");let f,d=Gk.get(l);if(null==d){const e=function(e,t){fh(null!=e&&e.length>0,(()=>"Expected at least one fetch, got none"));let n=[],r={};if(1===e.length){const a=Xk(e[0],t);n=a.sorted,r=a.recipientMap}else{const a=new Set;for(const i of e){const{sorted:e,recipientMap:o}=Xk(i,t);for(const t of e)a.has(t.name)||(n.push(t),a.add(t.name));for(const t in o)null==r[t]&&(r[t]=new Set),o[t].forEach((e=>r[t].add(e)))}}return{sorted:n,recipientCounts:Yk(r)}}(o,t);d=e.sorted,f=e.recipientCounts,Gk.put(l,d),Vk.put(l,f)}f={},a||Object.assign(f,Vk.get(l));const h=new Wk(t);for(let p=0;p<d.length;++p){if(null!=r){const e=Fb().numTensors;e>r.maxNumTensors&&(r.maxNumTensors=e),e<r.minNumTensors&&(r.minNumTensors=e)}const e=d[p],i=e.sourceLayer;if(i instanceof Uk)continue;const o=[],u=[],l=[];let g=!1;for(const n of e.inputs){const e=h.getValue(n),r=h.getMask(n);o.push(e),u.push(r),null!=r&&(g=!0),a||(f[n.name]--,0!==f[n.name]||t.hasKey(n)||-1!==s.indexOf(n.name)||e.isDisposed||!0===n.sourceLayer.stateful||l.push(e))}g&&((n=n||{}).mask=u[0]);const m=eI(i.apply(o,n));let v=null;i.supportsMasking&&(v=i.computeMask(o,u));const b=qk(e),y=Array.isArray(b)?b:[b];for(let t=0;t<y.length;++t){h.hasKey(y[t])||h.add(y[t],m[t],Array.isArray(v)?v[0]:v);const e=s.indexOf(y[t].name);-1!==e&&(c[e]=m[t])}a||jb(l)}return h.disposeMasks(),i?c:c[0]}function Yk(e){const t={};for(const n in e)t[n]=e[n].size;return t}function Xk(e,t){const n=new Set,r=[],a={};for(const s of t.names())n.add(s);const i=[],o=[];for(i.push(e);i.length>0;){const e=i[i.length-1];if(n.has(e.name)){i.pop();continue}const t=o[o.length-1]===i.length-1;if(0===e.inputs.length||t)i.pop(),r.push(e),n.add(e.name),t&&o.pop();else{o.push(i.length-1);for(const t of e.inputs)null==a[t.name]&&(a[t.name]=new Set),a[t.name].add(e.name),n.has(t.name)||i.push(t)}}return{sorted:r,recipientMap:a}}function qk(e){let t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{let n=null;for(let t=0;t<e.sourceLayer.inboundNodes.length;++t)for(const r of e.sourceLayer.inboundNodes[t].outputTensors)if(r.id===e.id){n=t;break}t=e.sourceLayer.getOutputAt(n)}return t}function Kk(e,t){return zb((()=>Oy(Fw(Dy(e,e),t,!0))))}Hh().registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",(()=>100),(function(e){null!=Gk&&Gk.setMaxEntries(e),null!=Vk&&Vk.setMaxEntries(e)}));class Qk extends Wy{getConfig(){return{}}}class Jk extends Qk{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=null!=e.maxValue?e.maxValue:this.defaultMaxValue,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return zb((()=>{const t=Kk(e,this.axis),n=sw(t,0,this.maxValue);return Dy(e,Ry(n,Ly(BI(),t)))}))}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}Jk.className="MaxNorm",Vy(Jk);class Zk extends Qk{constructor(e){super(),this.defaultAxis=0,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return zb((()=>Ry(e,Ly(BI(),Kk(e,this.axis)))))}getConfig(){return{axis:this.axis}}}Zk.className="UnitNorm",Vy(Zk);class $k extends Qk{apply(e){return mS(e)}}$k.className="NonNeg",Vy($k);class eN extends Qk{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=null!=e.minValue?e.minValue:this.defaultMinValue,this.maxValue=null!=e.maxValue?e.maxValue:this.defaultMaxValue,this.rate=null!=e.rate?e.rate:this.defaultRate,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return zb((()=>{const t=Kk(e,this.axis),n=Ly(Dy(this.rate,sw(t,this.minValue,this.maxValue)),Dy(1-this.rate,t));return Dy(e,Ry(n,Ly(BI(),t)))}))}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}eN.className="MinMaxNorm",Vy(eN);const tN={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function nN(e){return aI(e)}function rN(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return oI(e,Gy.getMap().classNameMap,t,"constraint")}function aN(e){if(null==e)return null;if("string"===typeof e){return rN({className:e in tN?tN[e]:e,config:{}})}return e instanceof Qk?e:rN(e)}async function iN(e){if(null==e)return;const t=[],n=[],r=[];for(const a in e){const i=e[a];if("number"!==typeof i){const e=i;t.push(e.data()),n.push(a),r.push(e)}}if(t.length>0){const a=await Promise.all(t);for(let t=0;t<a.length;++t)e[n[t]]=a[t][0];jb(r)}}function oN(e){if(null!=e)for(const t in e){const n=e[t];"number"!==typeof n&&n.dispose()}}var sN;!function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"}(sN||(sN={}));class cN{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class uN{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;null==e&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onEpochBegin(e,t)}async onEpochEnd(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onEpochEnd(e,t)}async onBatchBegin(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onBatchBegin(e,t)}async onBatchEnd(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onBatchEnd(e,t)}async onTrainBegin(e){null==e&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){null==e&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class lN extends cN{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){null==t&&(t={});const n=null==t.size?0:t.size;this.seen+=n;for(const r in t){const e=t[r];if("number"===typeof e)this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+e*n;else{let t;r in this.totals?t=this.totals[r]:this.totals[r]=0;const a=zb((()=>Ly(this.totals[r],Dy(e,n))));this.totals[r]=a,null!=t&&t.dispose()}}}async onEpochEnd(e,t){if(null!=t)for(const n of this.params.metrics)null!=this.totals[n]&&("number"===typeof this.totals[n]?t[n]=this.totals[n]/this.seen:zb((()=>{const e=Dy(Ry(1,this.seen),this.totals[n]);t[n]=e,this.totals[n].dispose(),Bb(t[n])})))}}class fN extends cN{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){null==t&&(t={}),this.epoch.push(e);for(const n in t)null==this.history[n]&&(this.history[n]=[]),this.history[n].push(t[n])}async syncData(){const e=[],t=[],n=[];for(const a in this.history){const r=this.history[a];for(let i=0;i<r.length;++i)if("number"!==typeof r[i]){const o=r[i];e.push(o.data()),t.push(a),n.push(i)}}const r=await Promise.all(e);for(let a=0;a<r.length;++a){this.history[t[a]][n[a]].dispose(),this.history[t[a]][n[a]]=r[a][0]}}}class dN extends cN{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||VC,this.yieldEvery=t||"auto","auto"===this.yieldEvery&&(this.yieldEvery=125),"never"===this.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");Ih(this.yieldEvery)&&(this.maybeWait=function(e,t,n){let r,a=null!=n?n():Ov();return function(){const i=null!=n?n():Ov();return i-a<t||(a=i,r=e(...arguments)),r}}(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,n){const r=[];null!=this.yield&&(await iN(n),r.push(this.yield(e,t,n))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,t){this.currentEpoch=e,null!=this.epochBegin&&(await iN(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const n=[];null!=this.epochEnd&&(await iN(t),n.push(this.epochEnd(e,t))),"epoch"===this.yieldEvery&&n.push(this.nextFrameFunc()),await Promise.all(n)}async onBatchBegin(e,t){null!=this.batchBegin&&(await iN(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const n=[];null!=this.batchEnd&&(await iN(t),n.push(this.batchEnd(e,t))),"batch"===this.yieldEvery?n.push(this.nextFrameFunc()):Ih(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(n)}async onTrainBegin(e){null!=this.trainBegin&&(await iN(e),await this.trainBegin(e))}async onTrainEnd(e){null!=this.trainEnd&&(await iN(e),await this.trainEnd(e))}}function hN(e,t){if(null==e&&(e={}),e instanceof cN)return[e];if(Array.isArray(e)&&e[0]instanceof cN)return e;return eI(e).map((e=>new dN(e,t)))}class pN{constructor(){}static registerCallbackConstructor(e,t){fh(e>=0&&Number.isInteger(e),(()=>"Verbosity level is expected to be an integer >= 0, "+"but got ".concat(e))),pN.checkForDuplicate(t),null==pN.constructors[e]&&(pN.constructors[e]=[]),pN.constructors[e].push(t)}static checkForDuplicate(e){for(const t in pN.constructors){pN.constructors[+t].forEach((t=>{if(t===e)throw new YT("Duplicate callback constructor.")}))}}static clear(){pN.constructors={}}static createCallbacks(e){const t=[];for(const n in pN.constructors){const r=+n;e>=r&&t.push(...pN.constructors[r])}return t.map((e=>new e))}}function gN(e,t,n,r,a,i,o,s,c){const u=new fN,l=[new lN,...pN.createCallbacks(t)];null!=e&&l.push(...e),l.push(u);const f=new uN(l);return f.setParams({epochs:n,initialEpoch:r,samples:a,steps:i,batchSize:o,verbose:t,doValidation:s,metrics:c}),{callbackList:f,history:u}}function mN(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return oI(e,Gy.getMap().classNameMap,t,"layer",n)}function vN(e,t){return zb((()=>{"float32"!==e.dtype&&(e=Iy(e,"float32"));const n=Fw(ZI(e),t,!0),r=Xy(n.shape,BI()),a=Oy(nx(n,r));return Ry(e,a)}))}function bN(e,t){return zb((()=>Zw(ZI(Qy(t,e)),-1)))}function yN(e,t){return zb((()=>Zw(Zy(Qy(t,e)),-1)))}function xN(e,t){return zb((()=>{const n=Qy(e,t),r=sw(Zy(e),BI(),Number.MAX_VALUE),a=Zy(Ry(n,r));return Dy(100,Zw(a,-1))}))}function wN(e,t){return zb((()=>{const n=sw(t,BI(),Number.MAX_VALUE),r=Dw(Ly(1,n)),a=sw(e,BI(),Number.MAX_VALUE),i=Dw(Ly(1,a));return Zw(ZI(Qy(r,i)),-1)}))}function SN(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return zb((()=>{if(n)t=ES(t);else{const e=Fw(t,t.shape.length-1,!0);t=Ry(t,e)}return t=sw(t,BI(),1-BI()),nS(Fw(Dy(Iy(e,"float32"),Dw(t)),t.shape.length-1))}))}function CN(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return zb((()=>{const r=Iy(kw(function(e){const t=[OI(e.shape)];return $x(e,t)}(e)),"int32"),a=(t=sw(t,BI(),1-BI())).shape;return SN($x(aS(r,a[a.length-1]),a),t,n)}))}function MN(e,t){return zb((()=>{let n;return n=sw(t,BI(),1-BI()),n=Dw(Ry(n,Qy(1,n))),Zw(function(e,t){if(!gh(e.shape,t.shape))throw new YT("logits and labels must have the same shape, but got shapes "+"".concat(JSON.stringify(e.shape)," and ").concat(JSON.stringify(t.shape)));return zb((()=>{const n=mS(t),r=nS(Zy(t));return Ly(Qy(n,Dy(t,e)),Ow(_w(r)))}))}(e,n),-1)}))}function _N(e,t){return zb((()=>{const n=sw(e,BI(),1),r=sw(t,BI(),1);return Fw(Dy(e,Dw(Ry(n,r))),-1)}))}function EN(e,t){return zb((()=>{const n=vN(e,-1),r=vN(t,-1),a=Dy(n,r);return nS(Fw(a,-1))}))}pN.constructors={};const TN={meanSquaredError:bN,meanAbsoluteError:yN,meanAbsolutePercentageError:xN,meanSquaredLogarithmicError:wN,squaredHinge:function(e,t){return zb((()=>{const n=nx(0,Qy(1,Dy(e,t)));return Zw(ZI(n),-1)}))},hinge:function(e,t){return zb((()=>{const n=nx(0,Qy(1,Dy(e,t)));return Zw(n,-1)}))},categoricalHinge:function(e,t){return zb((()=>{const n=Fw(Dy(e,t),-1),r=Pw(Dy(Qy(1,e),t),-1);return nx(0,Ly(1,Qy(r,n)))}))},logcosh:function(e,t){return zb((()=>{const n=Math.log(2),r=Qy(t,e),a=Qy(Ly(r,TS(Dy(-2,r))),n);return Zw(a,-1)}))},categoricalCrossentropy:SN,sparseCategoricalCrossentropy:CN,binaryCrossentropy:MN,kullbackLeiblerDivergence:_N,poisson:function(e,t){return zb((()=>{const n=Dw(Ly(BI(),t));return Zw(Qy(t,Dy(e,n)),-1)}))},cosineProximity:EN};function IN(e){if("string"===typeof e){if(e in TN)return TN[e];let t="Unknown loss ".concat(e);throw e.toLowerCase().includes("softmaxcrossentropy")&&(t="Unknown loss ".concat(e,". ")+'Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new YT(t)}return e}function kN(e,t){return zb((()=>{const n=Dy(.5,sS(t)),r=UI(Lw(t,n),e.dtype);return Zw(Cw(e,r),-1)}))}function NN(e,t){return zb((()=>UI(Cw(Fx(e,-1),Fx(t,-1)),"float32")))}function LN(e,t){return zb((()=>Iy(Fw(qw(Cw(e,1),Cw(t,1))),"float32")))}function AN(e,t){return MN(e,t)}function RN(e,t){return e.rank===t.rank&&(e=kS(e,[e.rank-1])),(t=Fx(t,-1)).dtype!==e.dtype&&(t=Iy(t,e.dtype)),Iy(Cw(e,t),"float32")}const DN=SN,ON=CN,PN={binaryAccuracy:kN,categoricalAccuracy:NN,precision:function(e,t){return zb((()=>{const n=LN(e,t),r=function(e,t){return zb((()=>Iy(Fw(qw(Cw(e,0),Cw(t,1))),"float32")))}(e,t),a=Ly(n,r);return Iy(PS(Lw(a,0),Ry(n,a),0),"float32")}))},categoricalCrossentropy:DN,sparseCategoricalCrossentropy:ON,mse:bN,MSE:bN,mae:yN,MAE:yN,mape:xN,MAPE:xN,cosine:EN};function FN(e){if("string"===typeof e&&e in PN)return PN[e];if("string"!==typeof e&&null!=e)return e;throw new YT("Unknown metric ".concat(e))}function zN(e){if(JT(null!==e,"Unknown LossOrMetricFn ".concat(e)),"string"===typeof e)return e;{let t;for(const n of Object.keys(TN))if(TN[n]===e){t=n;break}if(void 0!==t)return t;for(const n of Object.keys(PN))if(PN[n]===e){t=n;break}return void 0!==t?t:e.name}}const jN=1048576;function BN(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e||"object"!==typeof e||Object.getPrototypeOf(e)!==Object.prototype||!UN(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const n=JSON.stringify(e);n.length>jN&&console.warn('User-defined metadata of model "'.concat(t,'" is too large in ')+"size (length=".concat(n.length," when serialized). It is not ")+"recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+"".concat(jN,"."))}}function UN(e){if(null===e)return!0;if("object"===typeof e){if(Object.getPrototypeOf(e)===Object.prototype){const t=Object.keys(e);for(const n of t){if("string"!==typeof n)return!1;if(!UN(e[n]))return!1}return!0}if(Array.isArray(e)){for(const t of e)if(!UN(t))return!1;return!0}return!1}{const t=typeof e;return"string"===t||"number"===t||"boolean"===t}}function WN(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:console.log;const a=function(e){let t=!0;const n=[],r=[];for(const a in e.nodesByDepth)n.push(e.nodesByDepth[a]);for(const a of n){if(a.length>1||1===a.length&&a[0].inboundLayers.length>1){t=!1;break}r.push(...a)}if(t)for(const a of e.layers){let e=!1;for(const n of a.inboundNodes)if(-1!==r.indexOf(n)){if(e){t=!1;break}e=!0}if(!t)break}return t}(e),i=["Layer (type)","Input Shape","Output shape","Param #"];let o;if(a?(t=t||90,n=n||[.32,.61,.89,1]):(t=t||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map((e=>Math.floor(t*e)))),!a){i.push("Receives inputs"),o=[];for(const t in e.nodesByDepth)o.push(...e.nodesByDepth[t])}r("_".repeat(t)),GN(i,n,r),r("=".repeat(t));const s=e.layers;for(let l=0;l<s.length;++l)a?VN(s[l],n,r):HN(s[l],n,o,r),r((l===s.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();const c=function(e){let t;t=null!=e.collectedTrainableWeights?kk(e.collectedTrainableWeights):kk(e.trainableWeights);return t}(e),u=kk(e.nonTrainableWeights);r("Total params: ".concat(c+u)),r("Trainable params: ".concat(c)),r("Non-trainable params: ".concat(u)),r("_".repeat(t))}function GN(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log,r="";for(let a=0;a<e.length;++a)a>0&&(r=r.slice(0,r.length-1)+" "),r+=e[a],r=r.slice(0,t[a]),r+=" ".repeat(t[a]-r.length);n(r)}function VN(e,t,n){let r,a;try{a=e.inboundNodes.map((e=>JSON.stringify(e.inputShapes))).join(",")}catch(upe){a="multiple"}try{r=JSON.stringify(e.outputShape)}catch(upe){r="multiple"}const i=e.name,o=e.getClassName();GN(["".concat(i," (").concat(o,")"),a,r,e.countParams().toString()],t,n)}function HN(e,t,n,r){let a,i;try{i=e.inboundNodes.map((e=>JSON.stringify(e.inputShapes))).join(",")}catch(upe){i="multiple"}try{a=JSON.stringify(e.outputShape)}catch(upe){a="multiple"}const o=[];for(const l of e.inboundNodes)if(!(null!=n&&n.length>0&&-1===n.indexOf(l)))for(let e=0;e<l.inboundLayers.length;++e){const t=l.inboundLayers[e].name,n=l.nodeIndices[e],r=l.tensorIndices[e];o.push("".concat(t,"[").concat(n,"][").concat(r,"]"))}const s=e.name,c=e.getClassName(),u=0===o.length?"":o[0];GN(["".concat(s," (").concat(c,")"),i,a,e.countParams().toString(),u],t,r);for(let l=1;l<o.length;++l)GN(["","","","",o[l]],t,r)}function YN(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"===typeof n}function XN(e,t){if(null===e)return null;if("string"===typeof e)return nI(e);if("number"===typeof e||"boolean"===typeof e)return e;if(e instanceof Array){const n=[],r=e.length;for(let a=0;a<r;++a){const r=e[a];YN(t,a,r)?n.push(r):n.push(XN(r,t))}return n}{const t={};for(const n of Object.keys(e)){const r=e[n];if("name"===n&&"string"===typeof r)t[n]=r;else{const e=nI(n);t[e]=XN(r,e)}}return t}}function qN(e,t){if(null===e||void 0===e)return null;if("string"===typeof e)return tI(e);if("number"===typeof e||"boolean"===typeof e)return e;if(e instanceof Array){const n=[],r=e.length;for(let a=0;a<r;++a){const r=e[a];YN(t,a,r)?n.push(r):n.push(qN(r,t))}return n}{const t={};for(const n of Object.keys(e)){const r=e[n],a=tI(n);t[a]="name"!==n&&"className"!==n||"string"!==typeof r?qN(r,n):r}return t}}const KN="4.22.0";class QN extends jk{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,null==this.name){const e=this.getClassName().toLowerCase();this.name=bI(e)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],cI(this.inputs).length!==this.inputs.length)throw new YT("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+"".concat(this.inputs.map((e=>e.name))));cI(this.outputs).length!==this.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+"".concat(this.outputs.map((e=>e.name)))),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const v of this.outputs){const e=v.sourceLayer,t=v.nodeIndex,n=v.tensorIndex;this.outputLayers.push(e),this.outputLayersNodeIndices.push(t),this.outputLayersTensorIndices.push(n)}for(const v of this.inputs){const e=v.sourceLayer,t=v.nodeIndex,n=v.tensorIndex;JT(0===t,"input layer has >1 nodes"),JT(0===n,"input layer has >1 tensors"),this.inputLayers.push(e),this.inputLayersNodeIndices.push(t),this.inputLayersTensorIndices.push(n)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let v=0;v<this.inputLayers.length;v++){const t=this.inputLayers[v];if(!(t instanceof Uk))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. "+"Received inputs: ".concat(e.inputs,". ")+"Input ".concat(v," (0-based) originates ")+"from layer type ".concat(t.getClassName(),"."));this.inputNames.push(t.name),this.feedInputShapes.push(t.batchInputShape),this.feedInputNames.push(t.name)}for(const v of this.outputLayers)this.outputNames.push(v.name);this.internalInputShapes=this.inputs.map((e=>e.shape)),this.internalOutputShapes=this.outputs.map((e=>e.shape));const t={},n={},r={},a={},i={},o=[],s=(e,t,n,r,a,c)=>{null!=r&&null!=a&&null!=c||(r=e.sourceLayer,a=e.nodeIndex,c=e.tensorIndex);const u=r.inboundNodes[a];if(-1!==n.indexOf(u))throw new HT("The tensor ".concat(e.name,' at layer "').concat(r.name,'" ')+"is part of a cycle.");if(-1!==t.indexOf(u))return;this.containerNodes.add(QN.nodeKey(r,a)),r.id in i||(i[r.id]=Object.keys(i).length),-1===n.indexOf(u)&&n.push(u);const l=u.inboundLayers.length;for(let i=0;i<l;i++){const e=u.inputTensors[i],r=u.inboundLayers[i],a=u.nodeIndices[i],o=u.tensorIndices[i];s(e,t,n,r,a,o)}for(t.push(u);n.indexOf(u)>=0;)n.splice(n.indexOf(u),1);o.push(u)},c=[],u=[];for(const v of this.outputs)s(v,c,u);const l=o.slice().reverse();for(const v of l){n[v.id]=v,v.id in t||(t[v.id]=0);let e=t[v.id];const i=null==r[v.outboundLayer.id]?0:r[v.outboundLayer.id];e=Math.max(e,i),r[v.outboundLayer.id]=e,a[v.outboundLayer.id]=v.outboundLayer,t[v.id]=e;for(let r=0;r<v.inboundLayers.length;r++){const a=v.inboundLayers[r],i=v.nodeIndices[r],o=a.inboundNodes[i],s=null==t[o.id]?0:t[o.id];t[o.id]=Math.max(e+1,s),n[o.id]=o}}const f={};for(const v in t){const e=t[v];e in f||(f[e]=[]),f[e].push(n[v])}const d={};for(const v in r){const e=r[v];e in d||(d[e]=[]),d[e].push(a[v])}let h=Object.keys(d).map((e=>parseInt(e,10))).sort(sI);this.layers=[];for(const v of h){const e=d[v];e.sort(((e,t)=>{const n=i[e.id],r=i[t.id];return n<r?-1:n>r?1:0}));for(const t of e)t instanceof QN&&this.internalContainerRefs.push(t),this.layers.push(t)}this.layersByDepth=d,h=Object.keys(f).map((e=>parseInt(e,10))).sort(sI);const p=this.inputs.slice(),g=[];for(const v of h)for(const e of f[v]){const t=e.outboundLayer;if(null!=t){for(const n of e.inputTensors)if(-1===p.indexOf(n))throw new HT("Graph disconnected: cannot obtain value for tensor ".concat(n)+' at layer "'.concat(t.name,'". ')+"The following previous layers were accessed without "+"issue: ".concat(g));for(const t of e.outputTensors)p.push(t);g.push(t.name)}}this.nodesByDepth=f;const m=this.layers.map((e=>e.name));for(const v of m){const e=m.filter((e=>e===v)).length;if(1!==e)throw new HT('The name "'.concat(v,'" is used ').concat(e," times ")+"in the model. All layer names should be unique. Layer names: "+JSON.stringify(m))}this.outboundNodes=[],this.inboundNodes=[],new Fk({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map((e=>null)),outputMasks:this.outputs.map((e=>null)),inputShapes:this.inputs.map((e=>e.shape)),outputShapes:this.outputs.map((e=>e.shape))}),this.built=!0,this._refCount=1}assertNotDisposed(){if(0===this._refCount)throw new Error("Container '".concat(this.name,"' is already disposed."))}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(0===--this._refCount){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach((t=>{t._trainableWeights.forEach((t=>t.trainable=e))})),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new YT("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const e of this.layers)t.push(...e.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n={};let r=0;const a=(e=>{const t=Object.keys(e);if(0===t.length)return!1;const n=t[0].split("/");return!isNaN(parseInt(n[n.length-1],10))})(e);a&&this.parseWeights(e);for(const o of this.layers)for(const[e,t]of o.weights.entries()){const i=a?"".concat(t.name.split("/").slice(0,-1).join("/")+"/").concat(e):t.originalName;if(null!=n[i])throw new YT("Duplicate weight name: ".concat(i));n[i]=t,r++}const i=[];for(const o in e){let r=o;if(null==n[o]){const e=o.split("/");r=e.slice(0,-2).concat([e[e.length-1]]).join("/")}if(null!=n[r])i.push([n[r],e[o]]);else if(t)throw new YT("Provided weight data has no target variable: ".concat(o));delete n[r]}if(t){const e=[];for(const t in n)e.push(t);if(e.length>0)throw new YT("".concat(e.length," of ").concat(r," weights are not set: ")+"".concat(e))}Rk(i)}parseWeights(e){for(const t in Object.keys(e)){const n=t.split("/"),r=["vars","layer_checkpoint_dependencies"],a=n.map((e=>e.startsWith("_")?e.slice(1):e)).filter((e=>!r.includes(e))).join("/");a!==t&&(e[a]=e[t],delete e[t])}}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion="tfjs-layers ".concat(KN),t.backend="TensorFlow.js",t}toJSON(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=qN(this.updatedConfig());return t?JSON.stringify(n):n}call(e,t){return zb((()=>{e=eI(e);const n=new Wk;for(let t=0;t<this.inputs.length;++t)n.add(this.inputs[t],e[t]);return Hk(this.outputs,n,t)}))}computeMask(e,t){return zb((()=>{let n;return e=eI(e),n=null==t?QT(null,e.length):eI(t),this.runInternalGraph(e,n)[1]}))}computeOutputShape(e){const t=Ek(e);if(t.length!==this.inputLayers.length)throw new YT("Invalid inputShape argument ".concat(e,": ")+"model has ".concat(this.inputLayers.length," tensor inputs."));const n={};for(let o=0;o<t.length;o++){const e=this.inputLayers[o],r=t[o];n[e.name+"_0_0"]=r}const r=Object.keys(this.nodesByDepth).map((e=>parseInt(e,10))).sort(sI);if(r.length>1)for(const o of r){const e=this.nodesByDepth[o];for(const t of e){const e=t.outboundLayer;if(-1!==this.inputLayers.map((e=>e.id)).indexOf(e.id))continue;const r=[];for(let o=0;o<t.inboundLayers.length;o++){const e=t.inboundLayers[o],a=t.nodeIndices[o],i=t.tensorIndices[o],s=n["".concat(e.name,"_").concat(a,"_").concat(i)];r.push(s)}const a=Ek(e.computeOutputShape($T(r))),i=e.inboundNodes.indexOf(t);for(let t=0;t<a.length;t++){n["".concat(e.name,"_").concat(i,"_").concat(t)]=a[t]}}}const a=[],i=[];for(let o=0;o<this.outputLayers.length;o++){const e=this.outputLayers[o],t=this.outputLayersNodeIndices[o],n=this.outputLayersTensorIndices[o],r="".concat(e.name,"_").concat(t,"_").concat(n);i.push(r)}for(let o=0;o<i.length;o++){const e=i[o];JT(e in n),a.push(n[e])}return $T(a)}runInternalGraph(e,t){null==t&&(t=QT(null,e.length));const n={};for(let s=0;s<this.inputs.length;++s){const r=this.inputs[s],a=e[s],i=t[s];n[r.id]=[a,i]}const r=Object.keys(this.nodesByDepth).map((e=>parseInt(e,10))).sort(sI);for(const s of r){const e=this.nodesByDepth[s];for(const t of e){const e=t.outboundLayer,r=t.inputTensors,a=t.outputTensors,i=new Array;for(const t of r)t.id in n&&i.push(n[t.id]);if(i.length===r.length){let r,o,s,c,u={};if(null!=t.callArgs&&(u=t.callArgs),1===i.length){const[t,n]=i[0];null==u.mask&&(u.mask=n),s=eI(e.call(t,u)),c=eI(e.computeMask(t,n)),r=[t],o=[n]}else r=i.map((e=>e[0])),o=i.map((e=>e[1])),null==u.mask&&(u.mask=o),s=eI(e.call(r,u)),c=eI(e.computeMask(r,o));if(e.activityRegularizer)throw new XT("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let e=0;e<a.length;++e){const t=a[e],r=s[e],i=c[e];n[t.id]=[r,i]}}}}const a=[],i=[],o=[];for(const s of this.outputs){JT(s.id in n,"Could not compute output ".concat(s.name," : ").concat(s.id));const[e,t]=n[s.id];o.push(e.shape),a.push(e),i.push(t)}return[a,i,o]}buildNodeConversionMap(e){const t={};let n;for(const r of this.layers){n=r instanceof QN?1:0;for(let e=0;e<r.inboundNodes.length;e++){const a=QN.nodeKey(r,e);this.containerNodes.has(a)&&(t[a]=n,n+=1)}}return t}getLayer(e,t){if(null!=t)return this.findLayer(t);if(null==e)throw new YT("Provide either a layer name or layer index");if("number"===typeof e)return this.findLayer(e);for(const n of this.layers)if(n.name===e)return n;throw new YT("No such layer: ".concat(e))}findLayer(e){if(this.layers.length<=e)throw new YT("Was asked to retrieve layer at index ".concat(e,", but model only ")+"has ".concat(this.layers.length," layer(s)."));return this.layers[e]}calculateLosses(){return zb((()=>{const e=[];for(const t of this.layers)for(let n=0;n<t.inboundNodes.length;++n){const r=QN.nodeKey(t,n);this.containerNodes.has(r)&&e.push(...t.calculateLosses())}return e}))}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),n=[];for(const i of this.layers){const e=i.getClassName(),r=i.getConfig(),a=[];for(let n=0;n<i.inboundNodes.length;n++){const e=i.inboundNodes[n],r=QN.nodeKey(i,n);let o={};if(this.containerNodes.has(r)){if(e.callArgs)try{JSON.stringify(e.callArgs),o=e.callArgs}catch(upe){console.warn("Layer ".concat(i.name," was passed ")+"non-serializable keyword arguments: "+"".concat(e.callArgs,". They will not be included ")+"in the serialized model (and thus will be missing at deserialization time)."),o={}}if(e.inboundLayers.length>0){const n=[];for(let r=0;r<e.inboundLayers.length;r++){const a=e.inboundLayers[r],i=e.nodeIndices[r],s=e.tensorIndices[r];let c=t[QN.nodeKey(a,i)];null==c&&(c=0),n.push([a.name,c,s,o])}a.push(n)}}}const o={};o.name=i.name,o.className=e,o.config=r,o.inboundNodes=a,n.push(o)}e.layers=n;const r=[];for(let i=0;i<this.inputLayers.length;i++){const e=this.inputLayers[i],n=this.inputLayersNodeIndices[i],a=QN.nodeKey(e,n);if(!this.containerNodes.has(a))continue;let o=t[a];null!==o&&void 0!==o||(o=0);const s=this.inputLayersTensorIndices[i];r.push([e.name,o,s])}e.inputLayers=r;const a=[];for(let i=0;i<this.outputLayers.length;i++){const e=this.outputLayers[i],n=this.outputLayersNodeIndices[i],r=QN.nodeKey(e,n);if(!this.containerNodes.has(r))continue;let o=t[r];null!==o&&void 0!==o||(o=0);const s=this.outputLayersTensorIndices[i];a.push([e.name,o,s])}return e.outputLayers=a,e}static fromConfig(e,t){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r={},a={};function i(e,t){e.name in a?a[e.name].push(t):a[e.name]=[t]}function o(e,t){const n=[];let a;for(const o of t){const s=o[0],c=o[1],u=o[2];if(a=null==o[3]?{}:o[3],!(s in r))return void i(e,t);const l=r[s];if(l.inboundNodes.length<=c)return void i(e,t);const f=l.inboundNodes[c];n.push(f.outputTensors[u])}n.length>0&&e.apply($T(n),a)}function s(e){const a=e.name,o=mN(e,null!=t.customObjects?t.customObjects:{});o.setFastWeightInitDuringBuild(n),r[a]=o;e.inboundNodes.forEach((e=>{if(!(e instanceof Array))throw new YT("Corrupted configuration, expected array for nodeData: ".concat(e));i(o,e)}))}const c=t.name,u=t.layers;for(const p of u)s(p);for(;!uI(a);)for(const e of u){const t=r[e.name];if(t.name in a){const e=a[t.name];delete a[t.name];for(const n of e)o(t,n)}}const l=[],f=[],d=t.inputLayers;for(const p of d){const e=p[0],t=p[1],n=p[2];JT(e in r);const a=r[e].inboundNodes[t].outputTensors;l.push(a[n])}const h=t.outputLayers;for(const p of h){const e=p[0],t=p[1],n=p[2];JT(e in r);const a=r[e].inboundNodes[t].outputTensors;f.push(a[n])}return new e({inputs:l,outputs:f,name:c})}get stateful(){if(this._stateful)throw new YT("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){zb((()=>{this.layers.forEach((e=>{e.stateful&&e.resetStates()}))}))}}function JN(e,t,n){const r=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map((e=>null));if(1===r)return Array.isArray(e)&&1===e.length?e:"object"===typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error("Provided ".concat(n," is an array of ").concat(e.length," ")+"element(s), but the model has ".concat(r," outputs. ")+"Make sure a set of weights is provided for each model output.");return e}if("object"===typeof e&&Object.keys(e).length>0&&"object"===typeof e[Object.keys(e)[0]]){const n=[];return t.forEach((t=>{t in e?n.push(e[t]):n.push(null)})),n}throw new Error("The model has multiple (".concat(r,") outputs, ")+"so ".concat(n," must be either an array with ")+"".concat(r," elements or an object with ").concat(t," keys. ")+"Provided ".concat(n," not understood: ").concat(JSON.stringify(e)))}function ZN(e,t){return JN(e,t,"classWeight")}async function $N(e,t,n,r){if(null!=t||null!=r)throw new Error("Support sampleWeight is not implemented yet");if(null!=n){const t=zb((()=>{if(1===e.shape.length)return ky(e);if(2===e.shape.length){if(e.shape[1]>1){return Fx(e,1)}if(1===e.shape[1])return $x(e,[e.shape[0]]);throw new Error("Encountered unexpected last-dimension size (".concat(e.shape[1],") ")+"during handling of class weights. The size is expected to be >= 1.")}throw new Error("Unexpected rank of target (y) tensor (".concat(e.rank,") during ")+"handling of class weights. The rank is expected to be 1 or 2.")})),r=Array.from(await t.data());jb(t);const a=[];return r.forEach((e=>{if(null==n[e])throw new Error("classWeight must contain all classes in the training data. "+"The class ".concat(e," exists in the data but not in ")+"classWeight");a.push(n[e])})),AS(a,"float32")}return null}function eL(e,t){return Dy(e,t)}function tL(e,t){let n,r;const a=t;n=a.xs,r=a.ys,fh(null!=n&&null!=r,(()=>"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+"".concat(t)));const i=nL("input",e.inputNames,n),o=nL("output",e.outputNames,r),s=i[0].shape[0];fh(i.length===e.inputs.length,(()=>"LayersModel has ".concat(e.inputs.length," inputs, but the dataset ")+"provides ".concat(i.length," inputs.  (Expected input keys: ")+"".concat(JSON.stringify(e.inputNames),")"))),fh(o.length===e.outputs.length,(()=>"LayersModel has ".concat(e.outputs.length," outputs, but the dataset ")+"provides ".concat(o.length," outputs.  (Expected output keys: ")+"".concat(JSON.stringify(e.outputNames),")")));for(let c=0;c<i.length;c++)fh(i[c].shape[0]===s,(()=>"Batch size mismatch: input "+"".concat(e.inputNames[c]," has ").concat(i[c].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(e.inputNames[0],".")));for(let c=0;c<o.length;c++)fh(o[c].shape[0]===s,(()=>"Batch size mismatch: output "+"".concat(e.outputNames[c]," has ").concat(o[c].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(e.inputNames[0],".")));return{xs:i,ys:o}}function nL(e,t,n){if(n instanceof Zv)return[n];if(Array.isArray(n))return fh(n.length===t.length,(()=>"Received an array of ".concat(n.length," Tensors, but expected ").concat(t.length," to match the ").concat(e," keys ").concat(t,"."))),n;{const r=[];for(const a of t){if(null==n[a])throw new YT("The feature data generated by the dataset lacks the required "+"".concat(e," key '").concat(a,"'."));r.push(n[a])}return r}}async function rL(e,t,n){const r=null!=n.batchesPerEpoch;if(fh(null!=e.optimizer,(()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig).")),fh(null!=n,(()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call.")),fh(null!=n.epochs&&n.epochs>0&&Number.isInteger(n.epochs),(()=>"For fitDataset(), config.epochs is expected to be a positive "+"integer, but got ".concat(n.epochs))),fh(!r||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),(()=>"For fitDataset(), config.batchesPerEpoch is expected to be a "+"positive integer if specified, but got ".concat(n.batchesPerEpoch))),fh(null==n.validationSplit,(()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead.")),e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");e.isTraining=!0;try{const a=null!=n.validationData;let i,o;if(a)if(aL(n.validationData))fh(null==n.validationBatches||n.validationBatches>0&&Number.isInteger(n.validationBatches),(()=>"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, "+"but got ".concat(n.validationBatches)));else{const e=function(e){if(3===e.length)throw new XT("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}(n.validationData);i=e.xs,o=e.ys}const s=e.makeTrainFunction(),c=e.getDedupedMetricsNames();let u;u=a?c.slice().concat(c.map((e=>"val_"+e))):c.slice();const l=hN(n.callbacks,n.yieldEvery),f=null==n.verbose?1:n.verbose,{callbackList:d,history:h}=gN(l,f,n.epochs,null,null,function(e,t){let n=null;null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size);return n}(t,n),null,a,u);d.setModel(e),e.history=h,await d.onTrainBegin(),e.stopTraining_=!1;let p=null==n.initialEpoch?0:n.initialEpoch,g=await t.iterator();for(;p<n.epochs;){const u={};await d.onEpochBegin(p);let l=0,f=0;for(r||(g=await t.iterator());!r||l<n.batchesPerEpoch;){const t=await g.next();if(r&&t.done){console.warn("You provided `batchesPerEpoch` as "+"".concat(n.batchesPerEpoch,", ")+"but your dataset iterator ran out of data after "+"".concat(l," batches; ")+"interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+"".concat(n.batchesPerEpoch*n.epochs," batches). ")+"You may need to use the repeat() function when building your dataset.");break}if(null!=t.value){const{xs:r,ys:a}=tL(e,t.value),i={};i.batch=f,i.size=r[0].shape[0],await d.onBatchBegin(f,i);const o=[];if(null!=n.classWeight){const t=ZN(n.classWeight,e.outputNames);for(let e=0;e<t.length;++e)o.push(await $N(a[e],null,t[e]))}const u=r.concat(a).concat(o),h=s(u);jb(u);for(let e=0;e<c.length;++e){const t=c[e],n=h[e];i[t]=n,Bb(n)}await d.onBatchEnd(f,i),oN(i),f++,l++}if(r?l>=n.batchesPerEpoch:t.done){if(a){let t;t=aL(n.validationData)?eI(await e.evaluateDataset(n.validationData,{batches:n.validationBatches})):eI(e.evaluate(i,o,{batchSize:null==n.validationBatchSize?32:n.validationBatchSize,verbose:0}));for(let n=0;n<e.metricsNames.length;++n)u["val_".concat(e.metricsNames[n])]=t[n]}break}if(e.stopTraining_)break}if(await d.onEpochEnd(p,u),p++,e.stopTraining_)break}return await d.onTrainEnd(),await e.history.syncData(),e.history}finally{e.isTraining=!1}}function aL(e){return"function"===typeof e.iterator}function iL(e){fh(e>0&&Number.isInteger(e),(()=>"batchSize is required to be a positive integer, but got ".concat(e)))}function oL(e,t,n){return null==e?[null]:Array.isArray(e)?e.map((e=>GI(e,t,n-t))):GI(e,t,n-t)}function sL(e,t){return zb((()=>null==e?null:Array.isArray(e)?e.map((e=>sL(e,t))):JI(e,"int32"===t.dtype?t:Iy(t,"int32"))))}function cL(e,t){const n=[];let r=0,a=null;for(;r<e;)a=r+t,a>=e&&(a=e),n.push([r,a]),r=a;return n}function uL(e){const t=[];e instanceof Zv&&(e=[e]);for(let n=0;n<e.length;++n){const r=e[n];if(1===r.rank)t.push(WI(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function lL(e,t){if(null==e)return;const n=[];if(t instanceof Zv)n.push(t.id);else if(Array.isArray(t))t.forEach((e=>n.push(e.id)));else if(null!=t)for(const a in t){const e=t[a];n.push(e.id)}const r=[];if(e instanceof Zv)-1===n.indexOf(e.id)&&r.push(e);else if(Array.isArray(e))e.forEach((e=>{-1===n.indexOf(e.id)&&r.push(e)}));else if(null!=e)for(const a in e){const t=e[a];-1===n.indexOf(t.id)&&r.push(t)}r.forEach((e=>{e.isDisposed||e.dispose()}))}function fL(e){return Array.isArray(e)}function dL(e){return!function(e){return e instanceof Zv}(e)&&!fL(e)}function hL(e,t,n){let r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(null==t||0===t.length){if(null!=e){let t=!1;if(fL(e)&&e.length>0)t=!0;else if(dL(e)){for(const n in e)if(e.hasOwnProperty(n)){t=!0;break}}else t=!0;if(t)throw new YT("Error when checking model ".concat(i," expected no data, ")+"but got ".concat(e))}return[]}if(null==e)return t.map((e=>null));if(dL(e)){r=[];for(const n of t){if(null==e[n])throw new YT('No data provided for "'.concat(n,'". Need data for each key in: ')+"".concat(t));r.push(e[n])}}else if(fL(e)){if(e.length!==t.length)throw new YT("Error when checking model ".concat(i,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"model expected. Expected to see ".concat(t.length," Tensor(s), but ")+"instead got the following list of Tensor(s): ".concat(e));r=e}else{if(t.length>1)throw new YT("The model ".concat(i," expects ").concat(t.length," Tensor(s), ")+"but only received one Tensor. Found: Tensor with shape ".concat(e.shape));r=[e]}if(r=uL(r),null!=n)for(let o=0;o<t.length;++o){if(null==n[o])continue;const e=r[o];if(e.shape.length!==n[o].length)throw new YT("Error when checking ".concat(i,": expected ").concat(t[o]," ")+"to have ".concat(n[o].length," dimension(s). but got array with ")+"shape ".concat(e.shape));for(let t=0;t<n[o].length;++t){if(0===t&&!a)continue;const r=e.shape[t],s=n[o][t];if(null!=s&&s>=0&&r!==s)throw new YT("".concat(i," expected a batch of elements where each ")+"example has shape [".concat(n[o].slice(1,n[o].length),"] ")+"(i.e.,tensor shape [*,".concat(n[o].slice(1,n[o].length),"])")+" but the ".concat(i," received an input with ").concat(e.shape[0])+" examples, each with shape [".concat(e.shape.slice(1,e.shape.length),"]")+" (tensor shape [".concat(e.shape,"])"))}}return r}function pL(e,t,n){let r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(Array.isArray(e)){if(e.length!==t.length)throw new YT("Error when checking model ".concat(i,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"the model expected. Expected to see ".concat(t.length," Tensor(s),")+" but instead got ".concat(e.length," Tensors(s)."));r=e}else{if(t.length>1)throw new YT("The model expects ".concat(t.length," ").concat(i," Tensors, ")+"but only received one Tensor. Found: array with shape "+"".concat(JSON.stringify(e.shape),"."));r=[e]}if(null!=n)for(let o=0;o<t.length;++o){if(null==n[o])continue;const e=r[o];if(e.shape.length!==n[o].length)throw new YT("Error when checking ".concat(i,": expected ").concat(t[o]," ")+"to have ".concat(n[o].length," dimension(s), but got array with ")+"shape ".concat(JSON.stringify(e.shape)));for(let r=0;r<n[o].length;++r){if(0===r&&!a)continue;const s=e.shape[r],c=n[o][r];if(null!=c&&c!==s)throw new YT("Error when checking ".concat(i,": expected ")+"".concat(t[o]," to have shape ").concat(JSON.stringify(n[o])," but ")+"got array with shape ".concat(JSON.stringify(e.shape),"."))}}}class gL extends QN{constructor(e){super(e),this.isTraining=!1}summary(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;if(!this.built)throw new YT("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");WN(this,e,t,n)}compile(e){if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"===typeof e.optimizer)this.optimizer_=function(e){const t={Adagrad:()=>WC.adagrad(.01),Adadelta:()=>WC.adadelta(1,.95,BI()),Adam:()=>WC.adam(.001,.9,.999,BI()),Adamax:()=>WC.adamax(.002,.9,.999,BI(),0),RMSProp:()=>WC.rmsprop(.001,.9,0,BI()),SGD:()=>WC.sgd(.01)};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new YT("Unknown Optimizer ".concat(e))}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Hy))throw new YT("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(Array.isArray(e.loss)||"string"===typeof e.loss||"function"===typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new YT("When passing an Array as loss, it should have one entry per "+"model output. The model has ".concat(this.outputs.length," output(s), ")+"but you passed loss=".concat(e.loss,"."));const n=e.loss;t=n.map((e=>IN(e)))}else{const n=IN(e.loss);this.outputs.forEach((e=>{t.push(n)}))}else{e.loss=e.loss;for(const t in e.loss)if(-1===this.outputNames.indexOf(t))throw new YT('Unknown entry in loss dictionary: "'.concat(t,'". ')+"Only expected the following keys: ".concat(this.outputNames));for(const n of this.outputNames)null==e.loss[n]&&console.warn('Output "'.concat(n,'" is missing from loss dictionary. We assume ')+"this was done on purpose, and we will not be expecting data "+"to be passed to ".concat(n," during training")),t.push(IN(e.loss[n]))}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let i=0;i<this.outputs.length;++i){const e=this.internalOutputShapes[i],t=this.outputNames[i];this.feedOutputNames.push(t),this.feedOutputShapes.push(e),this.feedLossFns.push(this.lossFunctions[i])}const n=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],kI("loss",(()=>{for(let e=0;e<this.outputs.length;++e){if(-1!==n.indexOf(e))continue;const t=this.lossFunctions[e];this.outputs.length>1&&(this.metricsTensors.push([t,e]),this.metricsNames.push(this.outputNames[e]+"_loss"))}}));const r=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map((e=>[]));let n;if("string"===typeof e||"function"===typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!==typeof e)throw new TypeError("Type of metrics argument not understood. Expected an string,"+"function, Array, or Object, found: ".concat(e));n=e}if(Array.isArray(n))return t.map((e=>n));{const e=[];for(const r of t){let t=n.hasOwnProperty(r)?n[r]:[];Array.isArray(t)||(t=[t]),e.push(t)}return e}}(e.metrics,this.outputNames),a=(e,t,n)=>{this.outputNames.length>1&&(t=this.outputNames[e]+"_"+t),this.metricsNames.push(t),this.metricsTensors.push([n,e])};kI("metric",(()=>{for(let e=0;e<this.outputs.length;++e){if(-1!==n.indexOf(e))continue;(t=>{let n,r,i;for(const o of t){if("string"===typeof o&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(o)){const t=this.internalOutputShapes[e];let a;1===t[t.length-1]||this.lossFunctions[e]===MN?-1!==["accuracy","acc"].indexOf(o)?r=kN:-1!==["crossentropy","ce"].indexOf(o)&&(r=AN):this.lossFunctions[e]===CN?-1!==["accuracy","acc"].indexOf(o)?r=RN:-1!==["crossentropy","ce"].indexOf(o)&&(r=ON):-1!==["accuracy","acc"].indexOf(o)?r=NN:-1!==["crossentropy","ce"].indexOf(o)&&(r=DN),-1!==["accuracy","acc"].indexOf(o)?a="acc":-1!==["crossentropy","ce"].indexOf(o)&&(a="ce"),i=r,n=""+a}else{const e=FN(o);i=e,n=""+zN(o)}let t;kI(n,(()=>{t=i})),a(e,n,t)}})(r[e])}})),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=null==n.batchSize?32:n.batchSize;iL(r);const a=this.standardizeUserDataXY(e,t,!0,r);try{const e=a[0].concat(a[1]);this.makeTestFunction();const t=this.testFunction;return $T(this.testLoop(t,e,r,n.verbose,n.steps))}finally{lL(a[0],e),lL(a[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),async function(e,t,n){const r=null!=(n=n||{}).batches,a=e.testFunction;let i=[];if(n.verbose>0)throw new XT("Verbose mode is not implemented yet.");fh(!r||n.batches>0&&Number.isInteger(n.batches),(()=>"Test loop expects `batches` to be a positive integer, but "+"received ".concat(JSON.stringify(n.batches))));const o="function"===typeof t.next?t:await t.iterator();let s=0,c=0;for(;!r||c<n.batches;){const t=await o.next();if(i=zb((()=>{if(t.value){const{xs:n,ys:r}=tL(e,t.value),o=n.concat(r),u=zb((()=>a(o)));if(jb(o),0===c)for(let e=0;e<u.length;++e)i.push(jy(0));const l=o[0].shape[0];for(let e=0;e<u.length;++e){const t=u[e],n=i[e];i[e]=zb((()=>Ly(i[e],Dy(l,t)))),c>0&&jb(n)}jb(u),s+=l,++c}return i})),t.done){r&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` "+"batches (in this case, ".concat(n.batches," batches). ")+"You may need to use the repeat() function when building your dataset.");break}}for(let u=0;u<i.length;++u){const e=i[u];i[u]=Ry(i[u],s),jb(e)}return $T(i)}(this,e,t)}checkNumSamples(e,t,n){let r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"steps";if(null!=n){if(r=null,null!=t)throw new YT("If ".concat(a," is set, batchSize must be null or undefined.")+"Got batchSize = ".concat(t))}else{if(null==e)throw new YT("Either the input data should have a defined shape, or "+"".concat(a," shoud be specified."));r=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return r}execute(e,t){if(Array.isArray(t)&&0===t.length)throw new YT("`outputs` is an empty Array, which is not allowed.");const n=Array.isArray(t),r=n?t:[t],a=this.retrieveSymbolicTensors(r),i=new Wk;if(e instanceof Zv&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new YT("The number of inputs provided (".concat(e.length,") ")+"does not match the number of inputs of this model "+"(".concat(this.inputs.length,")."));for(let t=0;t<this.inputs.length;++t)i.add(this.inputs[t],e[t])}else for(const s of this.inputs){const t=e[s.name];if(null==t)throw new YT("No value is provided for the model's input ".concat(s.name));i.add(s,t)}const o=Hk(a,i);return n?o:o[0]}retrieveSymbolicTensors(e){const t=QT(null,e.length);let n=e.length;for(const r of this.layers){const a=Array.isArray(r.output)?r.output:[r.output],i=a.map((e=>e.name));for(let r=0;r<e.length;++r){const o=i.indexOf(e[r]);if(-1!==o&&(t[r]=a[o],n--),0===n)break}if(0===n)break}if(n>0){const n=[];throw t.forEach(((t,r)=>{null==t&&n.push(e[r])})),new YT("Cannot find SymbolicTensors for output name(s): "+"".concat(JSON.stringify(n)))}return t}predictLoop(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return zb((()=>{const r=this.checkNumSamples(e);if(n)throw new XT("Verbose predictLoop() is not implemented yet.");const a=cL(r,t),i=this.outputs.map((e=>[]));for(let t=0;t<a.length;++t){const n=zb((()=>{const n=a[t][0],r=a[t][1],i=oL(e,n,r),o=[];if(Array.isArray(i))for(let e=0;e<i.length;++e)o.push({key:this.inputs[e],value:i[e]});else o.push({key:this.inputs[0],value:i});const s=new Wk(o);return Hk(this.outputs,s)}));n.forEach(((e,t)=>i[t].push(e)))}return $T(i.map((e=>cw(e,0))))}))}predict(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=uL(e);pL(n,this.inputNames,this.feedInputShapes,!1);try{const e=null==t.batchSize?32:t.batchSize;return iL(e),this.predictLoop(n,e)}finally{lL(n,e)}}predictOnBatch(e){pL(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t){let n=arguments.length>3?arguments[3]:void 0;if(null==this.optimizer_)throw new HT("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const r=[];for(let a=0;a<this.feedOutputShapes.length;++a){const e=this.feedOutputShapes[a];this.feedLossFns[a]===CN?r.push(e.slice(0,e.length-1).concat([1])):r.push(e)}if(function(e,t){const n=cI(e.map((e=>e.shape[0])));n.sort();const r=cI(t.map((e=>e.shape[0])));if(r.sort(),n.length>1)throw new YT("All input Tensors (x) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(e.map((e=>e.shape)))));if(r.length>1)throw new YT("All target Tensors (y) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(t.map((e=>e.shape)))));if(n.length>0&&r.length>0&&!gh(n,r))throw new YT("Input Tensors should have the same number of samples as target "+"Tensors. Found ".concat(n[0]," input sample(s) and ").concat(r[0]," target ")+"sample(s).")}(e=hL(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=hL(t,this.feedOutputNames,r,!1,"target")),function(e,t,n){const r=[bN,MN,SN];for(let a=0;a<e.length;++a){const i=e[a],o=t[a],s=n[a];if(null!=o){if(o===SN&&1===i.shape[i.shape.length-1])throw new YT("You are passing a target array of shape ".concat(i.shape," while using ")+"a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(-1!==r.indexOf(o)){const e=i.shape.slice(1),t=s.slice(1);for(let n=0;n<e.length;++n){const r=e[n],a=t[n];if(null!=a&&r!==a)throw new YT("A target Tensor with shape ".concat(i.shape," was passed for an ")+"output of shape ".concat(s,", while using a loss function that ")+"expects targets to have the same shape as the output.")}}}}}(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=n&&n>0&&e[0].shape[0]%n!==0)throw new YT("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+"".concat(n,". Found: ").concat(e[0].shape[0]," sample(s)."));return[e,t]}async standardizeUserData(e,t,n,r){let a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=arguments.length>5?arguments[5]:void 0;const[o,s]=this.standardizeUserDataXY(e,t,a,i);if(null!=n)throw new Error("sample weight is not supported yet.");let c=null;if(null!=r){const e=ZN(r,this.outputNames);c=[];for(let t=0;t<e.length;++t)c.push(await $N(s[t],null,e[t]))}return[o,s,c]}testLoop(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4?arguments[4]:void 0;return zb((()=>{const i=this.checkNumSamples(t,n,a,"steps"),o=[];if(r>0)throw new XT("Verbose mode is not implemented yet.");if(null!=a)throw new XT("steps mode in testLoop() is not implemented yet");{const r=cL(i,n),a=AS(zI(0,i));for(let n=0;n<r.length;++n){const i=r[n][0],s=r[n][1],c=GI(a,i,s-i),u=sL(t,c),l=e(u);if(0===n)for(let e=0;e<l.length;++e)o.push(jy(0));for(let e=0;e<l.length;++e){const t=l[e];o[e]=Ly(o[e],Dy(s-i,t))}}for(let e=0;e<o.length;++e)o[e]=Ry(o[e],i)}return o}))}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let n=0;n<e.length;++n){const r=e[n];let a=r;if(ZT(e,r)>1){const t=ZT(e.slice(0,n),r);a+="_".concat(t)}t.push(a)}return t}makeTrainFunction(){return e=>{const t=[],n=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),a=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+2*this.outputs.length),i=[],o=this.collectedTrainableWeights.map((e=>e.read())),s=this.optimizer_.minimize((()=>{const e=[];for(let t=0;t<this.inputs.length;++t)e.push({key:this.inputs[t],value:n[t]});const o=new Wk(e),s=Hk(this.outputs,o,{training:!0});let c;for(let n=0;n<this.lossFunctions.length;++n){let e=(0,this.lossFunctions[n])(r[n],s[n]);null!=a[n]&&(e=eL(e,a[n]));const i=Zw(e);t.push(i),c=0===n?e:Ly(c,e)}for(let n=0;n<this.metricsTensors.length;++n){let e;if(this.outputs.length>1&&n<this.outputs.length)e=t[n];else{const t=this.metricsTensors[n][0],a=this.metricsTensors[n][1];e=Zw(t(r[a],s[a]))}Bb(e),i.push(e)}return c=Zw(c),this.calculateLosses().forEach((e=>{c=Ly(c,e)})),c}),!0,o);return[s].concat(i)}}makeTestFunction(){this.testFunction=e=>zb((()=>{const t=[];let n;const r=e.slice(0,this.inputs.length),a=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=[];for(let e=0;e<this.inputs.length;++e)i.push({key:this.inputs[e],value:r[e]});const o=new Wk(i),s=Hk(this.outputs,o);for(let e=0;e<this.lossFunctions.length;++e){const r=this.lossFunctions[e],i=Zw(r(a[e],s[e]));n=0===e?i:Ly(n,i),t.push(n)}for(let e=0;e<this.metricsTensors.length;++e){const n=this.metricsTensors[e][0],r=this.metricsTensors[e][1],i=Zw(n(a[r],s[r]));t.push(i)}return t}))}async fit(e,t){let n,r,a,i,o,s,c,u,l,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;try{const d=null==f.batchSize?32:f.batchSize;iL(d);const h=!1,p=await this.standardizeUserData(e,t,f.sampleWeight,f.classWeight,h,d);n=p[0],r=p[1],l=p[2];let g,m=!1;if(null!=f.validationData&&f.validationData.length>0){if(m=!0,2!==f.validationData.length)throw 3===f.validationData.length?new XT("validationData including sample weights is not supported yet."):new YT("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+"".concat(f.validationData," is invalid."));o=f.validationData[0],s=f.validationData[1];const e=!0,t=await this.standardizeUserData(o,s,null,null,e,d);c=t[0],u=t[1],g=c.concat(u)}else if(null!=f.validationSplit&&f.validationSplit>0&&f.validationSplit<1){m=!0;const e=Math.floor(n[0].shape[0]*(1-f.validationSplit)),t=n[0].shape[0];c=oL(n,e,t),a=n,n=oL(n,0,e),u=oL(r,e,t),i=r,r=oL(r,0,e),g=c.concat(u)}else null!=f.validationSteps&&(m=!0);const v=n.concat(r).concat(l);this.checkTrainableWeightsConsistency();const b=this.makeTrainFunction(),y=this.getDedupedMetricsNames();let x,w;m?(this.makeTestFunction(),x=this.testFunction,w=y.slice().concat(y.map((e=>"val_"+e)))):(x=null,g=[],w=y.slice());const S=hN(f.callbacks,f.yieldEvery);return await this.fitLoop(b,v,y,d,f.epochs,f.verbose,S,x,g,f.shuffle,w,f.initialEpoch,null,null)}finally{this.isTraining=!1,lL(n,e),lL(r,t),lL(a,e),lL(i,t),lL(c,o),lL(u,s),null!=l&&jb(l)}}async fitLoop(e,t,n,r,a,i,o,s,c,u,l,f,d,h){null==r&&(r=32),null==a&&(a=1),null==u&&(u=!0),null==f&&(f=0);let p=!1;if(null!=s&&null!=c&&(p=!0),null!=h&&(p=!0,null==d))throw new YT("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const g=this.checkNumSamples(t,r,d,"steps_per_epoch");let m;null!=g&&(m=zI(0,g)),null==i&&(i=1);const{callbackList:v,history:b}=gN(o,i,a,f,g,d,r,p,l);v.setModel(this),this.history=b,await v.onTrainBegin(),this.stopTraining_=!1;for(let y=f;y<a;++y){await v.onEpochBegin(y);const a={};if(null!=d)throw new XT("stepsPerEpoch mode is not implemented yet.");{if("batch"===u)throw new XT("batch shuffling is not implemneted yet");u&&sh(m);const i=AS(m),o=cL(g,r);for(let u=0;u<o.length;++u){const l={};if(await v.onBatchBegin(u,l),zb((()=>{const f=o[u][0],d=o[u][1],h=GI(i,f,d-f);l.batch=u,l.size=d-f;const g=sL(t,h),m=e(g);for(let e=0;e<n.length;++e){const t=n[e],r=m[e];l[t]=r,Bb(r)}if(u===o.length-1&&p){const e=this.testLoop(s,c,r);for(let t=0;t<n.length;++t){const r=n[t],i=e[t];Bb(i),a["val_"+r]=i}}})),await v.onBatchEnd(u,l),oN(l),this.stopTraining_)break}i.dispose()}if(await v.onEpochEnd(y,a),this.stopTraining_)break}return await v.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return rL(this,e,t)}async trainOnBatch(e,t){const n=await this.standardizeUserData(e,t),r=n[0],a=n[1],i=this.makeTrainFunction()(r.concat(a)),o=[];for(const s of i){const e=await s.data();o.push(e[0])}return jb(i),lL(n[0],e),lL(n[1],t),$T(o)}getNamedWeights(e){const t=[],n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,a=this.getWeights(n);for(let i=0;i<r.length;++i)n&&!r[i].trainable||t.push({name:r[i].originalName,tensor:a[i]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){const t=Fb().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-Fb().numTensors}return e}getLossIdentifiers(){let e;if("string"===typeof this.loss)e=tI(this.loss);else if(Array.isArray(this.loss)){for(const e of this.loss)if("string"!==typeof e)throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map((e=>tI(e)))}else{const t=Object.keys(this.loss);e={};const n=this.loss;for(const r of t){if("string"!==typeof n[r])throw new Error("Serialization of non-string loss is not supported.");e[r]=tI(n[r])}}return e}getMetricIdentifiers(){if("string"===typeof this.metrics||"function"===typeof this.metrics)return[tI(zN(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((e=>tI(zN(e))));{const e={};for(const t in this.metrics)e[t]=tI(zN(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");const t=mN(XN(e.optimizer_config));let n,r;if("string"===typeof e.loss)n=nI(e.loss);else if(Array.isArray(e.loss))n=e.loss.map((e=>nI(e)));else if(null!=e.loss){n={};for(const t in e.loss)n[t]=nI(e.loss[t])}if(Array.isArray(e.metrics))r=e.metrics.map((e=>nI(e)));else if(null!=e.metrics){r={};for(const t in e.metrics)r[t]=nI(e.metrics[t])}this.compile({loss:n,metrics:r,optimizer:t})}async save(e,t){if("string"===typeof e){const t=(e=>Zb.getSaveHandlers(e))(e);if(0===t.length)throw new YT("Cannot find any save handlers for URL '".concat(e,"'"));if(t.length>1)throw new YT("Found more than one (".concat(t.length,") save handlers for ")+"URL '".concat(e,"'"));e=t[0]}if(null==e.save)throw new YT("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const n=await Vb(this.getNamedWeights(t)),r={modelTopology:this.toJSON(null,!1),format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v".concat(KN),convertedBy:null};if(null!=t&&t.includeOptimizer&&null!=this.optimizer){r.trainingConfig=this.getTrainingConfig();const e="optimizer",{data:t,specs:i}=await Vb(await this.optimizer.getWeights(),e);n.specs.push(...i),n.data=(a=[n.data,t],Ob.join(a))}var a;if(null!=this.userDefinedMetadata){const e=!0;BN(this.userDefinedMetadata,this.name,e),r.userDefinedMetadata=this.userDefinedMetadata}return r.weightData=n.data,r.weightSpecs=n.specs,e.save(r)}setUserDefinedMetadata(e){BN(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}gL.className="Model",Vy(gL);class mL extends gL{}mL.className="Functional",Vy(mL);class vL extends gL{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=null!=e.name?e.name:bI("sequential_"),null!=e.layers)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some((e=>e<0)))throw new YT("Negative dimension size caused by adding layer "+"".concat(e.name," with input shape [")+"".concat(e.inboundNodes[0].inputTensors[0].shape,"]"))}add(e){const t=e instanceof vL||e instanceof gL;let n;if(t){if(n=e,1!==n.outputs.length)throw new YT("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==n.inputs.length)throw new YT("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new YT("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const t=function(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new YT("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));let n=e.dtype;return null==n&&(n="float32"),new Uk({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(t)}if(t)this.outputs=n.outputs,this.inputs=n.inputs;else{if(1!==e.inboundNodes.length)throw new YT("A layer added to a Sequential model must not already be "+"connected somewhere else. LayersModel received layer ".concat(e.name," ")+"which has ".concat(e.inboundNodes.length," pre-existing inbound ")+"connections.");if(1!==e.inboundNodes[0].outputTensors.length)throw new YT("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=Bk(this.outputs[0])}this.inboundNodes=[],new Fk({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:QT(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((e=>e.shape)),outputShapes:this.outputs[0].shape})}else{const t=e.apply(this.outputs[0]);if(Array.isArray(t))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[t],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return null==this.model&&this.build(),this.model.call(e,t)}build(e){if(Ik(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new gL({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;this.built||this.build(),super.summary(e,t,n)}setWeights(e){null==this.model&&this.build(),this.model.setWeights(e)}evaluate(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.built)throw new HT("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)}async evaluateDataset(e,t){if(!this.built)throw new HT("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null==this.model&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return null==this.model?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.built)throw new HT("The model needs to be compiled before being used.");return this.model.fit(e,t,n)}async fitDataset(e,t){if(!this.built)throw new HT("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t){let n,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a={};if(t instanceof Array){if(null==t[0].className||"Merge"===t[0].className)throw new YT("Legacy serialization format not supported yet.");n=t}else fh(null!=t.layers,(()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field.")),n=t.layers,delete t.layers,a=t;const i=new e(a);if(!(i instanceof vL))throw new XT("Sequential.fromConfig called on non-Sequential input: ".concat(i));for(const o of n){const e=mN(o,void 0,r);r&&e.setFastWeightInitDuringBuild(!0),i.add(e)}return i}set stopTraining(e){if(null==this.model)throw new YT("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(null==this.model)throw new YT("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const n={};n.className=t.getClassName(),n.config=t.getConfig(),e.push(n)}return{name:this.name,layers:e}}}vL.className="Sequential",Vy(vL);class bL extends Wy{getConfig(){return{}}}class yL extends bL{apply(e){return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(1!==t)throw new XT("Support for alpha values other than 1 (".concat(t,") is not implemented ")+"yet.");return Sw(e)}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}}yL.className="elu",Vy(yL);class xL extends bL{apply(e){return bS(e)}}xL.className="selu",Vy(xL);class wL extends bL{apply(e){return mS(e)}}wL.className="relu",Vy(wL);class SL extends bL{apply(e){return zb((()=>eS(6,mS(e))))}}SL.className="relu6",Vy(SL);class CL extends bL{apply(e){return e}}CL.className="linear",Vy(CL);class ML extends bL{apply(e){return xS(e)}}ML.className="sigmoid",Vy(ML);class _L extends bL{apply(e){return function(e){return zb((()=>{const t=Ly(.5,Dy(.2,e));return sw(t,0,1)}))}(e)}}_L.className="hardSigmoid",Vy(_L);class EL extends bL{apply(e){return TS(e)}}EL.className="softplus",Vy(EL);class TL extends bL{apply(e){return function(e){return zb((()=>Ry(e,Ly(Zy(e),1))))}(e)}}TL.className="softsign",Vy(TL);class IL extends bL{apply(e){return LS(e)}}IL.className="tanh",Vy(IL);class kL extends bL{apply(e){return ES(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1)}}kL.className="softmax",Vy(kL);class NL extends bL{apply(e){return zw(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1)}}NL.className="logSoftmax",Vy(NL);class LL extends bL{apply(e){return zb((()=>zb((()=>{const t=Math.sqrt(2),n=Dy(.5,Ly(1,Mw(Ry(e,t))));return Dy(e,n)}))))}}LL.className="gelu",Vy(LL);class AL extends bL{apply(e){return zb((()=>Dy(.5,Dy(e,Ly(1,LS(Dy(Oy(Ry(2,Math.PI)),Ly(e,Dy(.044715,Ky(e,3))))))))))}}AL.className="gelu_new",Vy(AL);class RL extends bL{apply(e){return zb((()=>Dy(e,LS(TS(e)))))}}RL.className="mish",Vy(RL);class DL extends bL{apply(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return zb((()=>Dy(xS(Dy(e,t)),e)))}}function OL(e){return e.getClassName()}function PL(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return oI(e,Gy.getMap().classNameMap,t,"activation")}function FL(e){if(null==e){const e={className:"linear",config:{}};return PL(e)}if("string"===typeof e){const t={};return t.className=e,t.config={},PL(t)}return e instanceof bL?e:PL(e)}function zL(e){if(null!=e&&"object"!==typeof e)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an "+"object, but received: ".concat(e))}DL.className="swish",Vy(DL);class jL extends Wy{}class BL extends jL{constructor(e){super(),zL(e),this.l1=null==e||null==e.l1?.01:e.l1,this.l2=null==e||null==e.l2?.01:e.l2,this.hasL1=0!==this.l1,this.hasL2=0!==this.l2}apply(e){return zb((()=>{let t=iS([1]);return this.hasL1&&(t=Ly(t,Fw(Dy(this.l1,Zy(e))))),this.hasL2&&(t=Ly(t,Fw(Dy(this.l2,ZI(e))))),$x(t,[])}))}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}BL.className="L1L2",Vy(BL);const UL={l1l2:"L1L2"};function WL(e){return aI(e)}function GL(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return oI(e,Gy.getMap().classNameMap,t,"regularizer")}function VL(e){if(null==e)return null;if("string"===typeof e){return GL({className:e in UL?UL[e]:e,config:{}})}return e instanceof jL?e:GL(e)}class HL extends jk{constructor(e){super(null==e?{}:e),this.supportsMasking=!0,null!=e&&(this.maxValue=e.maxValue)}call(e,t){e=Tk(e);let n=mS(e);return null!=this.maxValue&&(n=sw(n,0,this.maxValue)),n}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}HL.className="ReLU",Vy(HL);class YL extends jk{constructor(e){super(null==e?{}:e),this.DEFAULT_ALPHA=.3,null==e&&(e={}),this.alpha=null==e.alpha?this.DEFAULT_ALPHA:e.alpha}call(e,t){const n=Tk(e);return Rw(n,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}YL.className="LeakyReLU",Vy(YL);class XL extends jk{constructor(e){if(super(null==e?{}:e),this.DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),this.supportsMasking=!0,this.alphaInitializer=Mk(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=VL(e.alphaRegularizer),this.alphaConstraint=aN(e.alphaConstraint),null==e.sharedAxes)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else{if("number"!==typeof e.sharedAxes)throw new YT("Expected sharedAxes to be a number or an array of numbers, "+"but got ".concat(e.sharedAxes));this.sharedAxes=[e.sharedAxes]}}build(e){const t=(e=Ik(e)).slice(1);if(null!=this.sharedAxes)for(const r of this.sharedAxes)t[r-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const n={};if(null!=this.sharedAxes)for(let r=1;r<e.length;++r)n[r]=e[r];this.inputSpec=[new Dk({ndim:e.length,axes:n})],this.built=!0}call(e,t){return e=Tk(e),uS(e,this.alpha.read())}getConfig(){const e={alphaInitializer:Ck(this.alphaInitializer),alphaRegularizer:WL(this.alphaRegularizer),alphaConstraint:nN(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}XL.className="PReLU",Vy(XL);class qL extends jk{constructor(e){if(super(null==e?{}:e),this.DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==this.DEFAULT_ALPHA)throw new XT("Non-default alpha value (".concat(e.alpha,") is not supported by the ")+"ELU layer yet.");this.alpha=null==e.alpha?this.DEFAULT_ALPHA:e.alpha}call(e,t){const n=Tk(e);return Sw(n)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}qL.className="ELU",Vy(qL);class KL extends jk{constructor(e){super(null==e?{}:e),this.DEFAULT_THETA=1,null==e&&(e={}),this.theta=null==e.theta?this.DEFAULT_THETA:e.theta}call(e,t){const n=Tk(e);return Dy(n,Iy(Lw(n,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}KL.className="ThresholdedReLU",Vy(KL);class QL extends jk{constructor(e){super(null==e?{}:e),this.DEFAULT_AXIS=1,null==e&&(e={}),this.softmax=(new kL).apply,this.axis=null==e.axis?this.DEFAULT_AXIS:e.axis}call(e,t){return zb((()=>{let n=Tk(e);const r=t.mask;if(null!=r){const e=Dy(Qy(oS(n.shape),Iy(r,n.dtype)),jy(-1e9));n=Ly(n,e)}return this.axis instanceof Array?this.axis.length>1?_w(Qy(n,Xw(n,this.axis,!0))):this.softmax(n,this.axis[0]):this.softmax(n,this.axis)}))}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}function JL(e,t,n){if("number"===typeof e)return QT(e,t);if(e.length!==t)throw new YT("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers.")+" Received: ".concat(e.length," elements."));for(let r=0;r<t;++r){const a=e[r];if(!DI(a))throw new YT("The ".concat(n," argument must be an integer or tuple of ").concat(t)+" integers. Received: ".concat(JSON.stringify(e)," including a")+" non-integer number ".concat(a))}return e}function ZL(e,t,n,r){if(null==e)return e;let a;return a="same"===n?e:e-(t+(t-1)*((arguments.length>4&&void 0!==arguments[4]?arguments[4]:1)-1))+1,Math.floor((a+r-1)/r)}function $L(e,t,n,r){if(null==e)return null;if("valid"===r)e=e*t+FI([n-t,0]);else{if("same"!==r)throw new YT("Unsupport padding mode: ".concat(r,"."));e*=t}return e}function eA(e,t){return zb((()=>(_I(t),"channelsFirst"===t?jS(e,[0,2,3,1]):e)))}function tA(e,t){return zb((()=>(_I(t),"channelsFirst"===t?jS(e,[0,2,3,4,1]):e)))}function nA(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return zb((()=>{if(null==i&&(i="channelsLast"),_I(i),3!==e.shape.length)throw new YT("The input of a conv1dWithBias operation should be 3, but is "+"".concat(e.shape.length," instead."));if(3!==t.shape.length)throw new YT("The kernel for a conv1dWithBias operation should be 3, but is "+"".concat(t.shape.length," instead"));if(null!=n&&1!==n.shape.length)throw new YT("The bias for a conv1dWithBias operation should be 1, but is "+"".concat(n.shape.length," instead"));if("channelsFirst"===i&&(e=jS(e,[0,2,1])),"causal"===a)throw new XT("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let s=pw(e,t,r,"same"===a?"same":"valid","NWC",o);return null!=n&&(s=ek(s,n)),s}))}function rA(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;return zb((()=>{if(null==i&&(i="channelsLast"),_I(i),3!==e.rank&&4!==e.rank)throw new YT("conv2dWithBiasActivation expects input to be of rank 3 or 4, "+"but received ".concat(e.rank,"."));if(3!==t.rank&&4!==t.rank)throw new YT("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, "+"but received ".concat(e.rank,"."));let c=eA(e,i);if("causal"===a)throw new XT("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return c=ZS({x:c,filter:t,strides:r,pad:"same"===a?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:s}),"channelsFirst"===i&&(c=jS(c,[0,3,1,2])),c}))}function aA(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;return zb((()=>{if(null==i&&(i="channelsLast"),_I(i),4!==e.rank&&5!==e.rank)throw new YT("conv3dWithBias expects input to be of rank 4 or 5, but received "+"".concat(e.rank,"."));if(4!==t.rank&&5!==t.rank)throw new YT("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+"".concat(e.rank,"."));let s=tA(e,i);if("causal"===a)throw new XT("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=vw(s,t,r,"same"===a?"same":"valid","NDHWC",o),null!=n&&(s=ek(s,n)),"channelsFirst"===i&&(s=jS(s,[0,4,1,2,3])),s}))}QL.className="Softmax",Vy(QL);class iA extends jk{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",iA.verifyArgs(t),this.rank=e,dI(this.rank,"rank"),1!==this.rank&&2!==this.rank&&3!==this.rank)throw new XT("Convolution layer for rank other than 1, 2, or 3 (".concat(this.rank,") is ")+"not implemented yet.");if(this.kernelSize=JL(t.kernelSize,e,"kernelSize"),this.strides=JL(null==t.strides?1:t.strides,e,"strides"),this.padding=null==t.padding?"valid":t.padding,EI(this.padding),this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,_I(this.dataFormat),this.activation=FL(t.activation),this.useBias=null==t.useBias||t.useBias,this.biasInitializer=Mk(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=aN(t.biasConstraint),this.biasRegularizer=VL(t.biasRegularizer),this.activityRegularizer=VL(t.activityRegularizer),this.dilationRate=JL(null==t.dilationRate?1:t.dilationRate,e,"dilationRate"),1===this.rank&&Array.isArray(this.dilationRate)&&1!==this.dilationRate.length)throw new YT("dilationRate must be a number or an array of a single number for 1D convolution, but received "+"".concat(JSON.stringify(this.dilationRate)));if(2===this.rank){if("number"===typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate];else if(2!==this.dilationRate.length)throw new YT("dilationRate must be a number or array of two numbers for 2D "+"convolution, but received ".concat(JSON.stringify(this.dilationRate)))}else if(3===this.rank)if("number"===typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(3!==this.dilationRate.length)throw new YT("dilationRate must be a number or array of three numbers for 3D "+"convolution, but received ".concat(JSON.stringify(this.dilationRate)))}static verifyArgs(e){if(JT("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!==typeof e.kernelSize&&!fI(e.kernelSize,"number",1,3))throw new YT("BaseConv expects config.kernelSize to be number or number[] with "+"length 1, 2, or 3, but received ".concat(JSON.stringify(e.kernelSize),"."))}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:OL(this.activation),useBias:this.useBias,biasInitializer:Ck(this.biasInitializer),biasRegularizer:WL(this.biasRegularizer),activityRegularizer:WL(this.activityRegularizer),biasConstraint:nN(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class oA extends iA{constructor(e,t){super(e,t),this.kernel=null,oA.verifyArgs(t),this.filters=t.filters,dI(this.filters,"filters"),this.kernelInitializer=Mk(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=aN(t.kernelConstraint),this.kernelRegularizer=VL(t.kernelRegularizer)}build(e){e=Ik(e);const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new YT("The channel dimension of the input should be defined. "+"Found ".concat(e[t]));const n=e[t],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:n}}],this.built=!0}call(e,t){return zb((()=>{let t;e=Tk(e);const n=null==this.bias?null:this.bias.read(),r=pI(this.activation.getClassName());if(null!=r&&2===this.rank)t=rA(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate,r);else{if(1===this.rank)t=nA(e,this.kernel.read(),n,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(2===this.rank)t=rA(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate);else{if(3!==this.rank)throw new XT("convolutions greater than 3D are not implemented yet.");t=aA(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate)}null!=this.activation&&(t=this.activation.apply(t))}return t}))}computeOutputShape(e){e=Ik(e);const t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2);for(let a=0;a<n.length;++a){const e=ZL(n[a],this.kernelSize[a],this.padding,this.strides[a],"number"===typeof this.dilationRate?this.dilationRate:this.dilationRate[a]);t.push(e)}let r=[e[0]];return"channelsLast"===this.dataFormat?(r=r.concat(t),r.push(this.filters)):(r.push(this.filters),r=r.concat(t)),r}getConfig(){const e={filters:this.filters,kernelInitializer:Ck(this.kernelInitializer),kernelRegularizer:WL(this.kernelRegularizer),kernelConstraint:nN(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||"number"!==typeof e.filters||e.filters<1)throw new YT("Convolution layer expected config.filters to be a 'number' > 0 "+"but got ".concat(JSON.stringify(e.filters)))}}class sA extends oA{constructor(e){super(2,e),sA.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if("number"!==typeof e.kernelSize&&!fI(e.kernelSize,"number",1,2))throw new YT("Conv2D expects config.kernelSize to be number or number[] with "+"length 1 or 2, but received ".concat(JSON.stringify(e.kernelSize),"."))}}sA.className="Conv2D",Vy(sA);class cA extends oA{constructor(e){super(3,e),cA.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if("number"!==typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new YT("Conv3D expects config.kernelSize to be number or"+" [number, number, number], but received ".concat(JSON.stringify(e.kernelSize),"."))}}cA.className="Conv3D",Vy(cA);class uA extends sA{constructor(e){if(super(e),this.inputSpec=[new Dk({ndim:4})],"same"!==this.padding&&"valid"!==this.padding)throw new YT("Conv2DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(this.padding))}build(e){if(4!==(e=Ik(e)).length)throw new YT("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new YT("The channel dimension of the inputs should be defined. Found `None`.");const n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Dk({ndim:4,axes:{[t]:n}})],this.built=!0}call(e,t){return zb((()=>{let t=Tk(e);if(4!==t.shape.length)throw new YT("Conv2DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(t.shape.length));const n=t.shape,r=n[0];let a,i;"channelsFirst"===this.dataFormat?(a=2,i=3):(a=1,i=2);const o=n[a],s=n[i],c=this.kernelSize[0],u=this.kernelSize[1],l=this.strides[0],f=this.strides[1],d=[r,$L(o,l,c,this.padding),$L(s,f,u,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(t=jS(t,[0,2,3,1]));let h=mw(t,this.kernel.read(),d,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(h=jS(h,[0,3,1,2])),null!=this.bias&&(h=ek(h,this.bias.read(),this.dataFormat)),null!=this.activation&&(h=this.activation.apply(h)),h}))}computeOutputShape(e){const t=(e=Ik(e)).slice();let n,r,a;"channelsFirst"===this.dataFormat?(n=1,r=2,a=3):(n=3,r=1,a=2);const i=this.kernelSize[0],o=this.kernelSize[1],s=this.strides[0],c=this.strides[1];return t[n]=this.filters,t[r]=$L(t[r],s,i,this.padding),t[a]=$L(t[a],c,o,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}uA.className="Conv2DTranspose",Vy(uA);class lA extends cA{constructor(e){if(super(e),this.inputSpec=[new Dk({ndim:5})],"same"!==this.padding&&"valid"!==this.padding)throw new YT("Conv3DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(this.padding))}build(e){if(5!==(e=Ik(e)).length)throw new YT("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new YT("The channel dimension of the inputs should be defined. Found `None`.");const n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Dk({ndim:5,axes:{[t]:n}})],this.built=!0}call(e,t){return zb((()=>{let t=Tk(e);if(5!==t.shape.length)throw new YT("Conv3DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(t.shape.length));const n=t.shape,r=n[0];let a,i,o;"channelsFirst"===this.dataFormat?(o=2,a=3,i=4):(o=1,a=2,i=3);const s=n[o],c=n[a],u=n[i],l=this.kernelSize[0],f=this.kernelSize[1],d=this.kernelSize[2],h=this.strides[0],p=this.strides[1],g=this.strides[2],m=[r,$L(s,h,l,this.padding),$L(c,p,f,this.padding),$L(u,g,d,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(t=jS(t,[0,2,3,4,1]));let v=yw(t,this.kernel.read(),m,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(v=jS(v,[0,4,1,2,3])),null!==this.bias&&(v=ek(v,this.bias.read(),this.dataFormat)),null!==this.activation&&(v=this.activation.apply(v)),v}))}computeOutputShape(e){const t=(e=Ik(e)).slice();let n,r,a,i;"channelsFirst"===this.dataFormat?(n=1,r=2,a=3,i=4):(n=4,r=1,a=2,i=3);const o=this.kernelSize[0],s=this.kernelSize[1],c=this.kernelSize[2],u=this.strides[0],l=this.strides[1],f=this.strides[2];return t[n]=this.filters,t[r]=$L(t[r],u,o,this.padding),t[a]=$L(t[a],l,s,this.padding),t[i]=$L(t[i],f,c,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}lA.className="Conv3DTranspose",Vy(lA);class fA extends oA{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,null==t.filters)throw new YT("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=t.kernelInitializer||null!=t.kernelRegularizer||null!=t.kernelConstraint)throw new YT("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=t.padding&&"same"!==t.padding&&"valid"!==t.padding)throw new YT("SeparableConv".concat(this.rank,"D supports only padding modes: ")+"'same' and 'valid', but received ".concat(JSON.stringify(t.padding)));this.depthMultiplier=null==t.depthMultiplier?1:t.depthMultiplier,this.depthwiseInitializer=Mk(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=VL(t.depthwiseRegularizer),this.depthwiseConstraint=aN(t.depthwiseConstraint),this.pointwiseInitializer=Mk(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=VL(t.pointwiseRegularizer),this.pointwiseConstraint=aN(t.pointwiseConstraint)}build(e){if((e=Ik(e)).length<this.rank+2)throw new YT("Inputs to SeparableConv".concat(this.rank,"D should have rank ")+"".concat(this.rank+2,", but received input shape: ")+"".concat(JSON.stringify(e)));const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new YT("The channel dimension of the inputs should be defined, "+"but found ".concat(JSON.stringify(e[t])));const n=e[t],r=this.kernelSize.concat([n,this.depthMultiplier]),a=[];for(let o=0;o<this.rank;++o)a.push(1);a.push(n*this.depthMultiplier,this.filters);const i=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,i,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",a,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,i,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,i,this.biasConstraint):this.bias=null,this.inputSpec=[new Dk({ndim:this.rank+2,axes:{[t]:n}})],this.built=!0}call(e,t){return zb((()=>{let t;if(e=Tk(e),1===this.rank)throw new XT("1D separable convolution is not implemented yet.");return 2===this.rank&&("channelsFirst"===this.dataFormat&&(e=jS(e,[0,2,3,1])),t=yS(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(t=ek(t,this.bias.read(),this.dataFormat)),null!=this.activation&&(t=this.activation.apply(t)),"channelsFirst"===this.dataFormat&&(t=jS(t,[0,3,1,2])),t}))}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Ck(this.depthwiseInitializer),e.pointwiseInitializer=Ck(this.pointwiseInitializer),e.depthwiseRegularizer=WL(this.depthwiseRegularizer),e.pointwiseRegularizer=WL(this.pointwiseRegularizer),e.depthwiseConstraint=nN(this.depthwiseConstraint),e.pointwiseConstraint=nN(this.pointwiseConstraint),e}}fA.className="SeparableConv";class dA extends fA{constructor(e){super(2,e)}}dA.className="SeparableConv2D",Vy(dA);class hA extends oA{constructor(e){super(1,e),hA.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if("number"!==typeof e.kernelSize&&!fI(e.kernelSize,"number",1,1))throw new YT("Conv1D expects config.kernelSize to be number or number[] with "+"length 1, but received ".concat(JSON.stringify(e.kernelSize),"."))}}hA.className="Conv1D",Vy(hA);class pA extends jk{constructor(e){super(e),"number"===typeof e.cropping?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"===typeof e.cropping[0]?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return zb((()=>{if(e=Tk(e),"channelsLast"===this.dataFormat){const t=HI(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return HI(t,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}{const t=HI(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return HI(t,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}}))}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}pA.className="Cropping2D",Vy(pA);class gA extends jk{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=null==e.size?this.DEFAULT_SIZE:e.size,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,_I(this.dataFormat),this.interpolation=null==e.interpolation?"nearest":e.interpolation,function(e){lI(xI,"InterpolationFormat",e)}(this.interpolation)}computeOutputShape(e){if("channelsFirst"===this.dataFormat){const t=null==e[2]?null:this.size[0]*e[2],n=null==e[3]?null:this.size[1]*e[3];return[e[0],e[1],t,n]}{const t=null==e[1]?null:this.size[0]*e[1],n=null==e[2]?null:this.size[1]*e[2];return[e[0],t,n,e[3]]}}call(e,t){return zb((()=>{let t=Tk(e);const n=t.shape;if("channelsFirst"===this.dataFormat){t=jS(t,[0,2,3,1]);const e=this.size[0]*n[2],r=this.size[1]*n[3],a="nearest"===this.interpolation?BC.resizeNearestNeighbor(t,[e,r]):BC.resizeBilinear(t,[e,r]);return jS(a,[0,3,1,2])}{const e=this.size[0]*n[1],r=this.size[1]*n[2];return"nearest"===this.interpolation?BC.resizeNearestNeighbor(t,[e,r]):BC.resizeBilinear(t,[e,r])}}))}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}gA.className="UpSampling2D",Vy(gA);class mA extends iA{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,this.depthwiseInitializer=Mk(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=aN(e.depthwiseConstraint),this.depthwiseRegularizer=VL(e.depthwiseRegularizer)}build(e){if((e=Ik(e)).length<4)throw new YT("Inputs to DepthwiseConv2D should have rank 4. "+"Received input shape: ".concat(JSON.stringify(e),"."));const t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new YT("The channel dimension of the inputs to DepthwiseConv2D should "+"be defined, but is not (".concat(e[t],")."));const n=e[t],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return zb((()=>{let t=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"valid",a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;return zb((()=>{null==a&&(a="channelsLast"),_I(a);let o=eA(e,a);if(4!==e.rank)throw new YT("Input for depthwiseConv2d is required to be 4-D, but is instead "+"".concat(e.rank,"-D"));if(4!==t.rank)throw new YT("depthwiseKernel is required to be 4-D, but is instead "+"".concat(t.rank,"-D"));return o=ww(o,t,n,"same"===r?"same":"valid","NHWC",i),"channelsFirst"===a&&(o=jS(o,[0,3,1,2])),o}))}(e=Tk(e),this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(t=ek(t,this.bias.read(),this.dataFormat)),null!=this.activation&&(t=this.activation.apply(t)),t}))}computeOutputShape(e){e=Ik(e);const t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,a=ZL(t,this.kernelSize[0],this.padding,this.strides[0]),i=ZL(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],r,a,i]:[e[0],a,i,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Ck(this.depthwiseInitializer),e.depthwiseRegularizer=WL(this.depthwiseRegularizer),e.depthwiseConstraint=nN(this.depthwiseRegularizer),e}}function vA(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new YT("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function a(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=a(t),constants:n=a(n)}}function bA(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return zb((()=>{const c=t.shape.length;if(c<3)throw new YT("Input should be at least 3D, but is ".concat(c,"D."));const u=[1,0].concat(zI(2,c));if(t=jS(t,u),null!=i)throw new XT("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=a&&(a=Iy(Iy(a,"bool"),"float32"),a.rank===c-1&&(a=Ew(a,-1)),a=jS(a,u)),r&&(t=vS(t,0),null!=a&&(a=vS(a,0)));const l=[];let f,d=n;const h=t.shape[0],p=OS(t);let g,m;null!=a&&(g=OS(a));for(let t=0;t<h;++t){const n=p[t],r=zb((()=>e(n,d)));if(null==a)f=r[0],d=r[1];else{const e=zb((()=>{const e=g[t],n=Qy(sS(e),e),a=Ly(Dy(r[0],e),Dy(d[0],n)),i=d.map(((t,a)=>Ly(Dy(r[1][a],e),Dy(t,n))));return{output:a,newStates:i}}));f=e.output,d=e.newStates}s&&l.push(f)}if(s){m=NS(l,1)}return[f,m,d]}))}mA.className="DepthwiseConv2D",Vy(mA);class yA extends jk{constructor(e){let t;if(super(e),null==e.cell)throw new YT("cell property is missing for the constructor of RNN.");if(t=Array.isArray(e.cell)?new TA({cells:e.cell}):e.cell,null==t.stateSize)throw new YT("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=null!=e.returnSequences&&e.returnSequences,this.returnState=null!=e.returnState&&e.returnState,this.goBackwards=null!=e.goBackwards&&e.goBackwards,this._stateful=null!=e.stateful&&e.stateful,this.unroll=null!=e.unroll&&e.unroll,this.supportsMasking=!0,this.inputSpec=[new Dk({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(null==this.states_){return zI(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((e=>null))}return this.states_}setStates(e){this.states_=e}computeOutputShape(e){_k(e)&&(e=e[0]);let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const n=t[0];let r;if(r=this.returnSequences?[e[0],e[1],n]:[e[0],n],this.returnState){const n=[];for(const r of t)n.push([e[0],r]);return[r].concat(n)}return r}computeMask(e,t){return zb((()=>{Array.isArray(t)&&(t=t[0]);const e=this.returnSequences?t:null;if(this.returnState){const t=this.states.map((e=>null));return[e].concat(t)}return e}))}get states(){if(null==this.states_){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let n=0;n<e;++n)t.push(null);return t}return this.states_}set states(e){this.states_=e}build(e){if(null!=this.numConstants)throw new XT("Constants support is not implemented in RNN yet.");_k(e)&&(e=e[0]);const t=this.stateful?e[0]:null,n=e.slice(2);this.inputSpec[0]=new Dk({shape:[t,null,...n]});const r=[e[0]].concat(e.slice(2));let a;if(this.cell.build(r),a=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!gh(this.stateSpec.map((e=>e.shape[e.shape.length-1])),a))throw new YT("An initialState was passed that is not compatible with "+"cell.stateSize. Received stateSpec=".concat(this.stateSpec,"; ")+"However cell.stateSize is ".concat(this.cell.stateSize))}else this.stateSpec=a.map((e=>new Dk({shape:[null,e]})));this.stateful&&this.resetStates()}resetStates(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];zb((()=>{if(!this.stateful)throw new VT("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape[0];if(null==n)throw new YT("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.states_)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((e=>iS([n,e]))):this.states_=[iS([n,this.cell.stateSize])];else if(null==e)jb(this.states_),null!=this.keptStates&&(jb(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((e=>iS([n,e]))):this.states_[0]=iS([n,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new YT("Layer ".concat(this.name," expects ").concat(this.states_.length," state(s), ")+"but it received ".concat(e.length," state value(s). Input ")+"received: ".concat(e));!0===t?this.keptStates.push(this.states_.slice()):jb(this.states_);for(let t=0;t<this.states_.length;++t){const r=e[t],a=Array.isArray(this.cell.stateSize)?this.cell.stateSize[t]:this.cell.stateSize,i=[n,a];if(!gh(r.shape,i))throw new YT("State ".concat(t," is incompatible with layer ").concat(this.name,": ")+"expected shape=".concat(i,", received shape=").concat(r.shape));this.states_[t]=r}}this.states_=this.states_.map((e=>Bb(e.clone())))}))}apply(e,t){let n=null==t?null:t.initialState,r=null==t?null:t.constants;null==t&&(t={});const a=vA(e,n,r,this.numConstants);e=a.inputs,n=a.initialState,r=a.constants;let i=[],o=[];if(null!=n){t.initialState=n,i=i.concat(n),this.stateSpec=[];for(const e of n)this.stateSpec.push(new Dk({shape:e.shape}));o=o.concat(this.stateSpec)}null!=r&&(t.constants=r,i=i.concat(r),this.numConstants=r.length);if(i[0]instanceof Ok){const n=[e].concat(i),r=this.inputSpec.concat(o),a=this.inputSpec;this.inputSpec=r;const s=super.apply(n,t);return this.inputSpec=a,s}return super.apply(e,t)}call(e,t){return zb((()=>{const n=null==t?null:t.mask,r=null==t?null:t.training;let a=null==t?null:t.initialState;e=Tk(e),null==a&&(a=this.stateful?this.states_:this.getInitialState(e));const i=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(a.length!==i)throw new YT("RNN Layer has ".concat(i," state(s) but was passed ")+"".concat(a.length," initial state(s)."));this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const o={training:r},s=bA(((e,t)=>{const n=this.cell.call([e].concat(t),o);return[n[0],n.slice(1)]}),e,a,this.goBackwards,n,null,this.unroll,this.returnSequences),c=s[0],u=s[1],l=s[2];this.stateful&&this.resetStates(l,r);const f=this.returnSequences?u:c;return this.returnState?[f].concat(l):f}))}getInitialState(e){return zb((()=>{let t=iS(e.shape);return t=Fw(t,[1,2]),t=WI(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map((e=>e>1?qI(t,[1,e]):t)):this.cell.stateSize>1?[qI(t,[1,this.cell.stateSize])]:[t]}))}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);const n=this.cell.getConfig();return this.getClassName()===yA.className&&(t.cell={className:this.cell.getClassName(),config:n}),Object.assign(Object.assign(Object.assign({},n),e),t)}static fromConfig(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=mN(t.cell,n);return new e(Object.assign(t,{cell:r}))}}yA.className="RNN",Vy(yA);class xA extends jk{}class wA extends xA{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,dI(this.units,"units"),this.activation=FL(null==e.activation?this.DEFAULT_ACTIVATION:e.activation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=Mk(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Mk(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Mk(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=VL(e.kernelRegularizer),this.recurrentRegularizer=VL(e.recurrentRegularizer),this.biasRegularizer=VL(e.biasRegularizer),this.kernelConstraint=aN(e.kernelConstraint),this.recurrentConstraint=aN(e.recurrentConstraint),this.biasConstraint=aN(e.biasConstraint),this.dropout=PI([1,FI([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=PI([1,FI([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Ik(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return zb((()=>{if(2!==e.length)throw new YT("SimpleRNNCell expects 2 input Tensors, got ".concat(e.length,"."));let n=e[1];e=e[0];const r=null!=t.training&&t.training;let a;0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=IA({ones:()=>sS(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=IA({ones:()=>sS(n),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,o=this.recurrentDropoutMask;a=QI(null!=i?Dy(e,i):e,this.kernel.read()),null!=this.bias&&(a=ek(a,this.bias.read())),null!=o&&(n=Dy(n,o));let s=Ly(a,QI(n,this.recurrentKernel.read()));return null!=this.activation&&(s=this.activation.apply(s)),[s,s]}))}getConfig(){const e=super.getConfig(),t={units:this.units,activation:OL(this.activation),useBias:this.useBias,kernelInitializer:Ck(this.kernelInitializer),recurrentInitializer:Ck(this.recurrentInitializer),biasInitializer:Ck(this.biasInitializer),kernelRegularizer:WL(this.kernelRegularizer),recurrentRegularizer:WL(this.recurrentRegularizer),biasRegularizer:WL(this.biasRegularizer),activityRegularizer:WL(this.activityRegularizer),kernelConstraint:nN(this.kernelConstraint),recurrentConstraint:nN(this.recurrentConstraint),biasConstraint:nN(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}wA.className="SimpleRNNCell",Vy(wA);class SA extends yA{constructor(e){e.cell=new wA(e),super(e)}call(e,t){return zb((()=>{null!=this.cell.dropoutMask&&(jb(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(jb(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,r=null==t?null:t.training,a=null==t?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:a})}))}static fromConfig(e,t){return new e(t)}}SA.className="SimpleRNN",Vy(SA);class CA extends xA{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new YT("GRUCell does not support reset_after parameter set to true.");this.units=e.units,dI(this.units,"units"),this.activation=FL(void 0===e.activation?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=FL(void 0===e.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=Mk(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Mk(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Mk(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=VL(e.kernelRegularizer),this.recurrentRegularizer=VL(e.recurrentRegularizer),this.biasRegularizer=VL(e.biasRegularizer),this.kernelConstraint=aN(e.kernelConstraint),this.recurrentConstraint=aN(e.recurrentConstraint),this.biasConstraint=aN(e.biasConstraint),this.dropout=PI([1,FI([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=PI([1,FI([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){const t=(e=Ik(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return zb((()=>{if(2!==e.length)throw new YT("GRUCell expects 2 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));const n=null!=t.training&&t.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=IA({ones:()=>sS(e),rate:this.dropout,training:n,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=IA({ones:()=>sS(r),rate:this.recurrentDropout,training:n,count:3,dropoutFunc:this.dropoutFunc}));const a=this.dropoutMask,i=this.recurrentDropoutMask;let o,s,c;0<this.dropout&&this.dropout<1&&(e=Dy(e,a[0]));let u=QI(e,this.kernel.read());this.useBias&&(u=ek(u,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=Dy(r,i[0]));const l=this.recurrentKernel.read(),[f,d]=IS(l,[2*this.units,this.units],l.rank-1),h=QI(r,f),[p,g,m]=IS(u,3,u.rank-1),[v,b]=IS(h,2,h.rank-1);o=this.recurrentActivation.apply(Ly(p,v)),s=this.recurrentActivation.apply(Ly(g,b));const y=QI(Dy(s,r),d);c=this.activation.apply(Ly(m,y));const x=Ly(Dy(o,r),Dy(Ly(1,nS(o)),c));return[x,x]}))}getConfig(){const e=super.getConfig(),t={units:this.units,activation:OL(this.activation),recurrentActivation:OL(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Ck(this.kernelInitializer),recurrentInitializer:Ck(this.recurrentInitializer),biasInitializer:Ck(this.biasInitializer),kernelRegularizer:WL(this.kernelRegularizer),recurrentRegularizer:WL(this.recurrentRegularizer),biasRegularizer:WL(this.biasRegularizer),activityRegularizer:WL(this.activityRegularizer),kernelConstraint:nN(this.kernelConstraint),recurrentConstraint:nN(this.recurrentConstraint),biasConstraint:nN(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}CA.className="GRUCell",Vy(CA);class MA extends yA{constructor(e){0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new CA(e),super(e)}call(e,t){return zb((()=>{null!=this.cell.dropoutMask&&(jb(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(jb(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,r=null==t?null:t.training,a=null==t?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:a})}))}static fromConfig(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}MA.className="GRU",Vy(MA);class _A extends xA{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,dI(this.units,"units"),this.activation=FL(void 0===e.activation?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=FL(void 0===e.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=Mk(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Mk(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Mk(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=VL(e.kernelRegularizer),this.recurrentRegularizer=VL(e.recurrentRegularizer),this.biasRegularizer=VL(e.biasRegularizer),this.kernelConstraint=aN(e.kernelConstraint),this.recurrentConstraint=aN(e.recurrentConstraint),this.biasConstraint=aN(e.biasConstraint),this.dropout=PI([1,FI([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=PI([1,FI([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;const n=(e=Ik(e))[e.length-1];let r;if(this.kernel=this.addWeight("kernel",[n,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){const e=this.biasInitializer,n=this.units;r=new((t=class extends ik{apply(t,r){const a=e.apply([n]),i=(new sk).apply([n]),o=e.apply([2*n]);return XI(XI(a,i),o)}}).className="CustomInit",t)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return zb((()=>{const n=null!=t.training&&t.training;if(3!==e.length)throw new YT("LSTMCell expects 3 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));let r=e[1];const a=e[2];e=e[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=IA({ones:()=>sS(e),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=IA({ones:()=>sS(r),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,o=this.recurrentDropoutMask;let s,c,u,l;0<this.dropout&&this.dropout<1&&(e=Dy(e,i[0]));let f=QI(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=Dy(r,o[0])),f=Ly(f,QI(r,this.recurrentKernel.read())),this.useBias&&(f=ek(f,this.bias.read()));const[d,h,p,g]=IS(f,4,f.rank-1);s=this.recurrentActivation.apply(d),c=this.recurrentActivation.apply(h),u=Ly(Dy(c,a),Dy(s,this.activation.apply(p))),l=this.recurrentActivation.apply(g);const m=Dy(l,this.activation.apply(u));return[m,m,u]}))}getConfig(){const e=super.getConfig(),t={units:this.units,activation:OL(this.activation),recurrentActivation:OL(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Ck(this.kernelInitializer),recurrentInitializer:Ck(this.recurrentInitializer),biasInitializer:Ck(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:WL(this.kernelRegularizer),recurrentRegularizer:WL(this.recurrentRegularizer),biasRegularizer:WL(this.biasRegularizer),activityRegularizer:WL(this.activityRegularizer),kernelConstraint:nN(this.kernelConstraint),recurrentConstraint:nN(this.recurrentConstraint),biasConstraint:nN(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}_A.className="LSTMCell",Vy(_A);class EA extends yA{constructor(e){0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new _A(e),super(e)}call(e,t){return zb((()=>{null!=this.cell.dropoutMask&&(jb(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(jb(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,r=null==t?null:t.training,a=null==t?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:a})}))}static fromConfig(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}EA.className="LSTM",Vy(EA);class TA extends xA{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return zb((()=>{let n=e.slice(1);const r=[];for(const e of this.cells.slice().reverse())Array.isArray(e.stateSize)?r.push(n.splice(0,e.stateSize.length)):r.push(n.splice(0,1));r.reverse();const a=[];let i;for(let o=0;o<this.cells.length;++o){const s=this.cells[o];n=r[o],i=0===o?[e[0]].concat(n):[i[0]].concat(n),i=s.call(i,t),a.push(i.slice(1))}n=[];for(const e of a.slice().reverse())n.push(...e);return[i[0]].concat(n)}))}build(e){let t;_k(e)&&(e=e[0]),this.cells.forEach(((n,r)=>{kI("RNNCell_".concat(r),(()=>{n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]}))})),this.built=!0}getConfig(){const e=super.getConfig(),t={cells:this.cells.map((e=>({className:e.getClassName(),config:e.getConfig()})))};return Object.assign(Object.assign({},e),t)}static fromConfig(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=[];for(const a of t.cells)r.push(mN(a,n));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const e of this.cells)t.push(...e.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return Ak(e)}setWeights(e){const t=[];for(const n of this.cells){const r=n.weights.length,a=e.splice(r);for(let e=0;e<n.weights.length;++e)t.push([n.weights[e],a[e]])}Rk(t)}}function IA(e){const{ones:t,rate:n,training:r=!1,count:a=1,dropoutFunc:i}=e,o=()=>null!=i?i(t(),n):tk(t(),n),s=()=>nk(o,t,r);if(!a||a<=1)return Bb(s().clone());return Array(a).fill(void 0).map(s).map((e=>Bb(e.clone())))}TA.className="StackedRNNCells",Vy(TA);var kA=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n};class NA extends yA{constructor(e){if(e.unroll)throw new XT("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new XT("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new Dk({ndim:5})]}call(e,t){return zb((()=>{if(null!=this.cell.dropoutMask&&(jb(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(jb(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new YT("ConvRNN2D cell does not support constants");const n=null==t?null:t.mask,r=null==t?null:t.training,a=null==t?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:a})}))}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return zb((()=>{const{stateSize:t}=this.cell,n=e.shape,r=this.computeSingleOutputShape(n),a=iS([r[0],...r.slice(2)]);return Array.isArray(t)?Array(t.length).fill(a):[a]}))}resetStates(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];zb((()=>{if(!this.stateful)throw new VT("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape,r=this.computeSingleOutputShape(n),a=[r[0],...r.slice(2)];if(null==n[0])throw new YT("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.getStates())Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((()=>iS(a))):this.states_=[iS(a)];else if(null==e)jb(this.states_),null!=this.keptStates&&(jb(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((()=>iS(a))):this.states_[0]=iS(a);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new YT("Layer ".concat(this.name," expects ").concat(this.states_.length," state(s), ")+"but it received ".concat(e.length," state value(s). Input ")+"received: ".concat(e));t?this.keptStates.push(this.states_.slice()):jb(this.states_);for(let t=0;t<this.states_.length;++t){const n=e[t],r=a;if(!gh(n.shape,r))throw new YT("State ".concat(t," is incompatible with layer ").concat(this.name,": ")+"expected shape=".concat(r,", received shape=").concat(n.shape));this.states_[t]=n}}this.states_=this.states_.map((e=>Bb(e.clone())))}))}computeSingleOutputShape(e){const{dataFormat:t,filters:n,kernelSize:r,padding:a,strides:i,dilationRate:o}=this.cell,s="channelsFirst"===t,c=e[s?3:2],u=e[s?4:3],l=ZL(c,r[0],a,i[0],o[0]),f=ZL(u,r[1],a,i[1],o[1]);return[...e.slice(0,2),...s?[n,l,f]:[l,f,n]]}}NA.className="ConvRNN2D";class LA extends _A{constructor(e){const{filters:t,kernelSize:n,strides:r,padding:a,dataFormat:i,dilationRate:o}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,dI(this.filters,"filters"),this.kernelSize=JL(n,2,"kernelSize"),this.kernelSize.forEach((e=>dI(e,"kernelSize"))),this.strides=JL(r||1,2,"strides"),this.strides.forEach((e=>dI(e,"strides"))),this.padding=a||"valid",EI(this.padding),this.dataFormat=i||"channelsLast",_I(this.dataFormat),this.dilationRate=JL(o||1,2,"dilationRate"),this.dilationRate.forEach((e=>dI(e,"dilationRate")))}build(e){var t;e=Ik(e);const n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new YT("The channel dimension of the input should be defined. "+"Found ".concat(e[n]));const r=e[n],a=this.kernelSize.concat([r,4*this.filters]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const i=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",i,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let e;if(this.unitForgetBias){const n=this.biasInitializer,r=this.filters;e=new((t=class extends ik{apply(e,t){return YI([n.apply([r]),oS([r]),n.apply([2*r])])}}).className="CustomInit",t)}else e=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,e,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return zb((()=>{if(3!==e.length)throw new YT("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));const n=t.training||!1,r=e[0],a=e[1],i=e[2];0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=IA({ones:()=>sS(r),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,s=(e,t,n)=>t&&t[n]?Dy(t[n],e):e;let c=s(r,o,0),u=s(r,o,1),l=s(r,o,2),f=s(r,o,3);0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=IA({ones:()=>sS(a),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const d=this.recurrentDropoutMask;let h=s(a,d,0),p=s(a,d,1),g=s(a,d,2),m=s(a,d,3);const[v,b,y,x]=IS(this.kernel.read(),4,3),[w,S,C,M]=this.useBias?IS(this.bias.read(),4):[null,null,null,null];c=this.inputConv(c,v,w,this.padding),u=this.inputConv(u,b,S,this.padding),l=this.inputConv(l,y,C,this.padding),f=this.inputConv(f,x,M,this.padding);const[_,E,T,I]=IS(this.recurrentKernel.read(),4,3);h=this.recurrentConv(h,_),p=this.recurrentConv(p,E),g=this.recurrentConv(g,T),m=this.recurrentConv(m,I);const k=this.recurrentActivation.apply(Ly(c,h)),N=this.recurrentActivation.apply(Ly(u,p)),L=Ly(Dy(N,i),Dy(k,this.activation.apply(Ly(l,g)))),A=Dy(this.recurrentActivation.apply(Ly(f,m)),this.activation.apply(L));return[A,A,L]}))}getConfig(){const e=super.getConfig(),{units:t}=e,n=kA(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},n),r)}inputConv(e,t,n,r){const a=hw(e,t,this.strides,r||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?ek(a,n,this.dataFormat):a}recurrentConv(e,t){return hw(e,t,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}LA.className="ConvLSTM2DCell",Vy(LA);class AA extends NA{constructor(e){const t=new LA(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}AA.className="ConvLSTM2D",Vy(AA);class RA extends jk{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(null==this.noiseShape)return this.noiseShape;const t=e.shape,n=[];for(let r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?t[r]:this.noiseShape[r]);return n}call(e,t){return zb((()=>{this.invokeCallHook(e,t);const n=Tk(e);if(0<this.rate&&this.rate<1){const e=null!=t.training&&t.training,r=this.getNoiseShape(n);return nk((()=>tk(n,this.rate,r,this.seed)),(()=>n),e)}return e}))}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}RA.className="Dropout",Vy(RA);class DA extends RA{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}DA.className="SpatialDropout1D",Vy(DA);class OA extends jk{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){let t=null;null!=e.batchSize&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,dI(this.units,"units"),this.activation=FL(e.activation),null!=e.useBias&&(this.useBias=e.useBias),this.kernelInitializer=Mk(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=Mk(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=aN(e.kernelConstraint),this.biasConstraint=aN(e.biasConstraint),this.kernelRegularizer=VL(e.kernelRegularizer),this.biasRegularizer=VL(e.biasRegularizer),this.activityRegularizer=VL(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){const t=(e=Ik(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){const t=(e=Ik(e)).slice();return t[t.length-1]=this.units,t}call(e,t){return zb((()=>{this.invokeCallHook(e,t);const n=Tk(e),r=pI(this.activation.getClassName());let a;return null!=r?a=QI(n,this.kernel.read(),r,this.bias?this.bias.read():null):(a=QI(n,this.kernel.read()),null!=this.bias&&(a=ek(a,this.bias.read())),null!=this.activation&&(a=this.activation.apply(a))),a}))}getConfig(){const e={units:this.units,activation:OL(this.activation),useBias:this.useBias,kernelInitializer:Ck(this.kernelInitializer),biasInitializer:Ck(this.biasInitializer),kernelRegularizer:WL(this.kernelRegularizer),biasRegularizer:WL(this.biasRegularizer),activityRegularizer:WL(this.activityRegularizer),kernelConstraint:nN(this.kernelConstraint),biasConstraint:nN(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}OA.className="Dense",Vy(OA);class PA extends jk{constructor(e){super(e=e||{}),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Ik(e);for(const t of e.slice(1))if(null==t)throw new YT('The shape of the input to "Flatten" is not fully defined '+"(got ".concat(e.slice(1),"). Make sure to pass a complete ")+'"input_shape" or "batch_input_shape" argument to the first layer in your model.');return[e[0],OI(e,1)]}call(e,t){return zb((()=>{this.invokeCallHook(e,t);let n=Tk(e);if("channelsFirst"===this.dataFormat&&n.rank>1){const e=[0];for(let t=2;t<n.rank;++t)e.push(t);e.push(1),n=jS(n,e)}return function(e){if(e.rank<=1)throw new YT("batchFlatten requires a minimum rank of 2. Got rank: ".concat(e.rank,"."));const t=[e.shape[0],OI(e.shape,1)];return $x(e,t)}(n)}))}getConfig(){const e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}PA.className="Flatten",Vy(PA);class FA extends jk{constructor(e){super(e),this.supportsMasking=!0,this.activation=FL(e.activation)}call(e,t){return zb((()=>{this.invokeCallHook(e,t);const n=Tk(e);return this.activation.apply(n)}))}getConfig(){const e={activation:OL(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}FA.className="Activation",Vy(FA);class zA extends jk{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return zb((()=>function(e,t){return zb((()=>{if(2!==e.shape.length)throw new YT("repeat() expects a rank-2 tensor, but received a "+"rank-".concat(e.shape.length," tensor."));return qI(WI(e,1),[1,t,1])}))}(e=Tk(e),this.n)))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}zA.className="RepeatVector",Vy(zA);class jA extends jk{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||null==e}fixUnknownDimension(e,t){const n="Total size of new array must be unchanged.",r=t.slice();let a=1,i=null;for(let s=0;s<r.length;++s){const e=r[s];if(this.isUnknown(e)){if(null!==i)throw new YT("Can only specifiy one unknown dimension.");i=s}else a*=e}const o=OI(e);if(null!==i){if(0===a||o%a!==0)throw new YT(n);r[i]=o/a}else if(o!==a)throw new YT(n);return r}computeOutputShape(e){let t=!1;for(let n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return zb((()=>{this.invokeCallHook(e,t);const n=Tk(e),r=n.shape,a=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return $x(n,a)}))}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}jA.className="Reshape",Vy(jA);class BA extends jk{constructor(e){if(super(e),null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+"".concat(e.dims," instead."));const t=zI(1,e.dims.length+1);if(!gh(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Dk({ndim:this.dims.length+1})]}computeOutputShape(e){const t=(e=Ik(e)).slice();return this.dims.forEach(((n,r)=>{t[r+1]=e[n]})),t}call(e,t){return jS(Tk(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}BA.className="Permute",Vy(BA);class UA extends jk{constructor(e){super(null==e?{}:e),this.supportsMasking=!0,this.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const n=Tk(e);return Px(rS(n,this.maskValue),-1)}call(e,t){return zb((()=>{this.invokeCallHook(e,t);const n=Tk(e),r=Px(rS(n,this.maskValue),-1,!0);return Dy(n,Iy(r,n.dtype))}))}}UA.className="Masking",Vy(UA);class WA extends jk{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){let t=null;null!=e.batchSize&&(t=e.batchSize),null==e.inputLength?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(eI(e.inputLength))}this.inputDim=e.inputDim,dI(this.inputDim,"inputDim"),this.outputDim=e.outputDim,dI(this.outputDim,"outputDim"),this.embeddingsInitializer=Mk(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=VL(e.embeddingsRegularizer),this.activityRegularizer=VL(e.activityRegularizer),this.embeddingsConstraint=aN(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return zb((()=>this.maskZero?(e=Tk(e),rS(e,Fy(e))):null))}computeOutputShape(e){if(e=Ik(e),null==this.inputLength)return[...e,this.outputDim];const t=eI(this.inputLength);if(t.length!==e.length-1)throw new YT('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(e));{let n=0;for(let r=0;r<t.length;++r){const a=t[r],i=e[r+1];if(null!=a&&null!=i&&a!==i)throw new YT('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(e));null==a&&(t[n]=i),n++}}return[e[0],...t,this.outputDim]}call(e,t){return zb((()=>{this.invokeCallHook(e,t);let n=Tk(e);"int32"!==n.dtype&&(n=UI(n,"int32"));const r=JI(this.embeddings.read(),$x(n,[n.size]));return $x(r,Ik(this.computeOutputShape(n.shape)))}))}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Ck(this.embeddingsInitializer),embeddingsRegularizer:WL(this.embeddingsRegularizer),activityRegularizer:WL(this.activityRegularizer),embeddingsConstraint:nN(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}WA.className="Embedding",Vy(WA);class GA extends jk{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new XT}computeElementwiseOpOutputShape(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;const n=e.slice(0,e.length-t.length);for(let r=0;r<t.length;++r){const a=e[e.length-t.length+r],i=t[r];if(null==a||null==i||a<0||i<0)n.push(null);else if(1===a)n.push(i);else if(1===i)n.push(a);else{if(a!==i)throw new YT("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(a)}}return n}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Ik(e)]),e.length<2)throw new YT("A merge layer should be called on an Array of at least 2 inputs."+" Got ".concat(e.length," input(s)."));let t=[];for(const a of e)null!=a&&null!==a[0]&&t.push(a[0]);if(t=cI(t),t.length>1)throw new YT("Can not merge tensors with different batch sizes. "+"Got tensors with shapes: ".concat(JSON.stringify(e),"."));let n=null==e[0]?null:e[0].slice(1);for(let a=1;a<e.length;++a){const t=null==e[a]?null:e[a].slice(1);n=this.computeElementwiseOpOutputShape(n,t)}const r=e.map((e=>e.length));-1===e.indexOf(null)&&1===cI(r).length?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return zb((()=>{if(this.reshapeRequired){const t=[],n=e.map((e=>e.rank));if(-1===n.indexOf(null)){const r=FI(n);for(let n of e){const e=n.rank;for(let t=0;t<r-e;++t)n=WI(n,1);t.push(n)}return this.mergeFunction(t)}{let n=!1;for(const i of e){const e=i.rank;if(null==e){const e=i.shape,r=e[0],a=e.slice(1).concat([r]);let o=$x(i,[r].concat(OI(e.slice(1))));o=jS(o,[1,0]),o=$x(o,a),t.push(o),n=!0}else if(e>1){const r=zI(1,e).concat([0]);t.push(jS(i,r)),n=!0}else t.push(i)}let r=this.mergeFunction(t);const a=r.rank;if(n)if(null==a){const e=r.shape,t=e[e.length-1],n=[t].concat(e.slice(0,e.length-1));r=$x(jS($x(r,[-1,t]),[1,0]),n)}else if(a>1){const e=[a-1].concat(zI(0,a-1));r=jS(r,e)}return r}}return this.mergeFunction(e)}))}computeOutputShape(e){let t;t=null==e[0]?null:e[0].slice(1);for(let r=1;r<e.length;++r){const n=null==e[r]?null:e[r].slice(1);t=this.computeElementwiseOpOutputShape(t,n)}let n=[];for(const r of e)null!=r&&null!==r[0]&&n.push(r[0]);return n=cI(n),t=1===n.length?n.concat(t):[null].concat(t),t}computeMask(e,t){return zb((()=>{if(null==t)return null;if(!Array.isArray(t))throw new YT("`mask` should be an Array");if(!Array.isArray(e))throw new YT("`inputs` should be an Array");if(t.length!==e.length)throw new YT("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths "+"(".concat(e.length," vs ").concat(t.length,")"));if(t.every((e=>null==e)))return null;t=t.map((e=>null==e?e:Ew(e,0)));let n=t[0];for(let e=1;e<t.length-1;++e)n=qw(n,t[e]);return n}))}}class VA extends GA{constructor(e){super(e)}mergeFunction(e){return zb((()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=Ly(t,e[n]);return t}))}}VA.className="Add",Vy(VA);class HA extends GA{constructor(e){super(e)}mergeFunction(e){return zb((()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=Dy(t,e[n]);return t}))}}HA.className="Multiply",Vy(HA);class YA extends GA{constructor(e){super(e)}mergeFunction(e){return zb((()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=Ly(t,e[n]);return Dy(1/e.length,t)}))}}YA.className="Average",Vy(YA);class XA extends GA{constructor(e){super(e)}mergeFunction(e){return zb((()=>{let t=e[0];for(let n=1;n<e.length;++n)t=nx(t,e[n]);return t}))}}XA.className="Maximum",Vy(XA);class qA extends GA{constructor(e){super(e)}mergeFunction(e){return zb((()=>{let t=e[0];for(let n=1;n<e.length;++n)t=eS(t,e[n]);return t}))}}qA.className="Minimum",Vy(qA);class KA extends GA{constructor(e){super(e),this.DEFAULT_AXIS=-1,null==e&&(e={}),this.axis=null==e.axis?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new YT("A `Concatenate` layer should be called on a list of at least 2 inputs");let t=!0;for(const r of e)if(null!=r){t=!1;break}if(t)return;const n=[];for(let r=0;r<e.length;++r){const t=e[r].slice();t.splice(this.axis,1);let a=!1;for(const e of n)if(gh(e,t)){a=!0;break}a||n.push(t)}if(n.length>1)throw new YT("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return zb((()=>YI(e,this.axis)))}computeOutputShape(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new YT("A `Concatenate` layer should be called on a list of inputs.");const t=e,n=t[0].slice(),r=this.axis<0?n.length+this.axis:this.axis;for(const a of t.slice(1)){if(null==n[r]||null==a[r]){n[r]=null;break}n[r]+=a[r]}return n}computeMask(e,t){if(null==t)return null;if(!Array.isArray(t))throw new YT("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new YT("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new YT("Mismatch in the length of mask (".concat(t.length,") ")+"and the legnth of inputs (".concat(e.length,")"));return zb((()=>{let n=!0;if(t.forEach((e=>{null==e||(n=!1)})),n)return null;const r=[];for(let i=0;i<e.length;++i)null==t[i]?r.push(Iy(sS(e[i]),"bool")):t[i].rank<e[i].rank?r.push(Ew(t[i],-1)):r.push(t[i]);const a=cw(r,this.axis);return Ox(a,-1,!1)}))}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}function QA(e,t){for(;e<0;)e+=t;return e}KA.className="Concatenate",Vy(KA);class JA extends GA{constructor(e){super(e),this.axes=e.axes,this.normalize=null!=e.normalize&&e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){fh(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(()=>"A `Dot` layer should be called on a list of exactly 2 inputs."));const t=e[0],n=e[1];if(t.length>3||n.length>3)throw new XT("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,n);if(t[r[0]]!==n[r[1]])throw new YT("Dimension incompatibility: "+"".concat(t[r[0]]," !== ").concat(n[r[1]]))}mergeFunction(e){if(2!==e.length)throw new YT("A `Dot` layer must be called on exactly 2 inputs, "+"but received ".concat(e.length," input(s)."));let t,n=e[0],r=e[1];return t=Array.isArray(this.axes)?this.axes.map(((t,n)=>QA(t,e[n].shape.length))):[QA(this.axes,n.shape.length),QA(this.axes,r.shape.length)],this.normalize&&(n=vN(n,t[0]),r=vN(r,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new XT("batchDot is not implemented for tensors of 4D or higher rank yet");if(fh(e.shape.length>=2,(()=>"batchDot requires the rank of x to be >= 2, "+"but got ".concat(e.shape.length))),fh(e.shape.length>=2,(()=>"batchDot requires the rank of y to be >= 2, "+"but got ".concat(t.shape.length))),"number"===typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new XT("batchDot is not implemented for complex64-type Tensors yet.");const r=e.shape.length,a=t.shape.length;null==n&&(n=[r-1,a-2]);const i=n;return zb((()=>{let n,o;if(r>a){n=r-a;const e=[];for(let t=0;t<n;++t)e.push(1);t=$x(t,t.shape.concat(e))}else if(a>r){n=a-r;const t=[];for(let e=0;e<n;++e)t.push(1);e=$x(e,e.shape.concat(t))}else n=0;if(2===e.shape.length&&2===t.shape.length)o=i[0]===i[1]?Fw(Dy(e,t),i[0]):Fw(Dy(jS(e,[1,0]),t),i[1]);else{const n=i[0]!==e.shape.length-1,r=i[1]===t.shape.length-1;o=Kw(e,t,n,r)}if(n>0){let e;e=r>a?r+a-3:r-1;const t=[];for(let r=e;r<e+n;++r)t.push(r);o=kS(o,t)}return 1===o.shape.length&&(o=Ew(o,1)),o}))}(n,r,t)}interpretAxes(e,t){let n;return n=Array.isArray(this.axes)?this.axes:[QA(this.axes,e.length),QA(this.axes,t.length)],n}computeOutputShape(e){fh(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(()=>"A `Dot` layer should be called on a list of exactly 2 inputs."));const t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new XT("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,n);t.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);const a=t.concat(n);return 1===a.length&&a.push(1),a}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}JA.className="Dot",Vy(JA);class ZA extends jk{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return zb((()=>{this.invokeCallHook(e,t);const n=Tk(e);return nk((()=>Ly(KI(n.shape,0,this.stddev),n)),(()=>n),t.training||!1)}))}}ZA.className="GaussianNoise",Vy(ZA);class $A extends jk{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return zb((()=>{this.invokeCallHook(e,t);const n=Tk(e);if(this.rate>0&&this.rate<1){return nk((()=>{const e=Math.sqrt(this.rate/(1-this.rate));return Dy(n,KI(n.shape,1,e))}),(()=>n),t.training||!1)}return n}))}}$A.className="GaussianDropout",Vy($A);class eR extends jk{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||Tk(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return zb((()=>{if(this.rate<1&&this.rate>0){const n=this._getNoiseShape(e),r=()=>{const t=Tk(e),r=-1.7580993408473766;let a=Aw(pS(n),this.rate);a=UI(a,"float32");const i=((1-this.rate)*(1+this.rate*r**2))**-.5,o=-i*r*this.rate,s=Ly(Dy(t,a),Dy(Ly(a,-1),r));return Ly(Dy(s,i),o)};return nk(r,(()=>Tk(e)),t.training||!1)}return e}))}}function tR(e,t,n,r,a){let i,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.001;if(2===e.rank)i=rw(e,t,n,r,a,o);else if(3===e.rank)i=aw(e,t,n,r,a,o);else{if(4!==e.rank)throw new XT("batchNormalization is not implemented for array of rank ".concat(e.rank," ")+"yet");i=iw(e,t,n,r,a,o)}return i}function nR(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return gh(r.slice().sort(),zI(0,e.rank-1))?function(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return zb((()=>{const i=tS(e,r),o=i.mean,s=i.variance;return[tR(e,o,s,n,t,a),o,s]}))}(e,t,n,r,a):function(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return zb((()=>{const i=tS(e,r),o=i.mean,s=i.variance,c=[];for(const t of zI(0,e.rank))-1!==r.indexOf(t)?c.push(1):c.push(e.shape[t]);const u=$x(o,c),l=$x(s,c),f=null==t?null:$x(t,c),d=null==n?null:$x(n,c);return[tR(e,u,l,d,f,a),o,s]}))}(e,t,n,r,a)}eR.className="AlphaDropout",Vy(eR);class rR extends jk{constructor(e){null==e&&(e={}),super(e),this.supportsMasking=!0,this.axis=null==e.axis?-1:e.axis,this.momentum=null==e.momentum?.99:e.momentum,this.epsilon=null==e.epsilon?.001:e.epsilon,this.center=null==e.center||e.center,this.scale=null==e.scale||e.scale,this.betaInitializer=Mk(e.betaInitializer||"zeros"),this.gammaInitializer=Mk(e.gammaInitializer||"ones"),this.movingMeanInitializer=Mk(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=Mk(e.movingVarianceInitializer||"ones"),this.betaConstraint=aN(e.betaConstraint),this.gammaConstraint=aN(e.gammaConstraint),this.betaRegularizer=VL(e.betaRegularizer),this.gammaRegularizer=VL(e.gammaRegularizer)}build(e){e=Ik(e);const t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new YT("Axis ".concat(t," of input tensor should have a defined dimension but ")+"the layer received an input with shape "+"".concat(JSON.stringify(e),"."));this.inputSpec=[new Dk({ndim:e.length,axes:{[t]:n}})];const r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return zb((()=>{const n=null!=t.training&&t.training,r=Tk(e),a=r.shape,i=a.length,o=zI(0,i),s=this.axis>=0?this.axis:this.axis+i;o.splice(s,1);const c=QT(1,i);c[s]=a[s];const u=o.slice();u.sort();const l=!gh(u,zI(0,i).slice(0,i-1));if(!n)return(()=>{if(l){const e=$x(this.movingMean.read(),c),t=$x(this.movingVariance.read(),c),n=this.center?$x(this.beta.read(),c):null,a=this.scale?$x(this.gamma.read(),c):null;return tR(r,e,t,n,a,this.epsilon)}return tR(r,this.movingMean.read(),this.movingVariance.read(),null==this.beta?null:this.beta.read(),null==this.gamma?null:this.gamma.read(),this.epsilon)})();const[f,d,h]=nR(r,this.gamma.read(),this.beta.read(),o,this.epsilon),p=(e,t,n)=>{zb((()=>{const r=1-n,a=e.read(),i=Dy(Qy(a,t),r);e.write(Qy(a,i))}))};return(()=>{p(this.movingMean,d,this.momentum),p(this.movingVariance,h,this.momentum)})(),f}))}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Ck(this.betaInitializer),gammaInitializer:Ck(this.gammaInitializer),movingMeanInitializer:Ck(this.movingMeanInitializer),movingVarianceInitializer:Ck(this.movingVarianceInitializer),betaRegularizer:WL(this.betaRegularizer),gammaRegularizer:WL(this.gammaRegularizer),betaConstraint:nN(this.betaConstraint),gammaConstraint:nN(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}rR.className="BatchNormalization",Vy(rR);class aR extends jk{constructor(e){if(null==e&&(e={}),super(e),this.axis=null==e.axis?-1:e.axis,"number"===typeof this.axis){if(!Number.isInteger(this.axis))throw new Error("Expected axis to be an integer, but received ".concat(this.axis))}else{if(!Array.isArray(this.axis))throw new Error("Expected axis to be an integer or an array of integers, "+"but received ".concat(JSON.stringify(this.axis)));for(const e of this.axis)if(!Number.isInteger(e))throw new Error("Expected axis to be an array of integers, "+"but received ".concat(JSON.stringify(this.axis)))}this.epsilon=null==e.epsilon?.001:e.epsilon,this.center=null==e.center||e.center,this.scale=null==e.scale||e.scale,this.betaInitializer=Mk(e.betaInitializer||"zeros"),this.gammaInitializer=Mk(e.gammaInitializer||"ones"),this.betaRegularizer=VL(e.betaRegularizer),this.gammaRegularizer=VL(e.gammaRegularizer),this.supportsMasking=!0}build(e){const t=(e=Ik(e)).length;"number"===typeof this.axis&&(this.axis=[this.axis]);for(let a=0;a<this.axis.length;++a)this.axis[a]<0&&(this.axis[a]+=t);for(const a of this.axis)if(a<0||a>=t)throw new Error("Invalid axis: ".concat(a));if(this.axis.length!==cI(this.axis).length)throw new Error("Found duplicate axes in: ".concat(this.axis));const n=this.axis.map((t=>e[t])),r=!0;this.scale?this.gamma=this.addWeight("gamma",n,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",n,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,t){const n=Tk(e),r=n.shape,a=r.length;return zb((()=>{let{mean:e,variance:t}=tS(n,this.axis,!0);const i=QT(1,a);for(const n of this.axis)i[n]=r[n];const o=e=>null!=e&&e.shape.length!==a?$x(e,i):e;let s=this.scale?o(this.gamma.read()):null,c=this.center?o(this.beta.read()):null;const u=[],l=[];for(let n=0;n<a;++n)-1!==this.axis.indexOf(n)?(u.push(r[n]),l.push(1)):(u.push(1),l.push(r[n]));return e=Tw(e,u),t=Tw(t,u),null!=s&&(s=Tw(s,l)),null!=c&&(c=Tw(c,l)),tR(n,e,t,c,s,this.epsilon)}))}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Ck(this.betaInitializer),gammaInitializer:Ck(this.gammaInitializer),betaRegularizer:WL(this.betaRegularizer),gammaRegularizer:WL(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}aR.className="LayerNormalization",Vy(aR);class iR extends jk{constructor(e){if(null==e&&(e={}),super(e),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)this.padding=[[1,1],[1,1]];else if("number"===typeof e.padding)this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new YT("ZeroPadding2D expects padding to be a length-2 array, but "+"received a length-".concat(e.padding.length," array."));let t,n;if("number"===typeof e.padding[0])t=[e.padding[0],e.padding[0]],n=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new YT("ZeroPadding2D expects height padding to be a length-2 array, "+"but received a length-".concat(e.padding[0].length," array."));if(t=e.padding[0],2!==e.padding[1].length)throw new YT("ZeroPadding2D expects width padding to be a length-2 array, "+"but received a length-".concat(e.padding[1].length," array."));n=e.padding[1]}this.padding=[t,n]}this.inputSpec=[new Dk({ndim:4})]}computeOutputShape(e){let t,n;return e=Ik(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])}call(e,t){return zb((()=>function(e,t,n){return zb((()=>{if(4!==e.rank)throw new YT("temporalPadding expects input tensor to be 4-D, but received a "+"".concat(e.rank,"-D tensor."));if(null==t&&(t=[[1,1],[1,1]]),2!==t.length||2!==t[0].length||2!==t[1].length)throw new YT("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==n&&(n="channelsLast"),"channelsLast"!==n&&"channelsFirst"!==n)throw new YT("Unknown data format: ".concat(n,". ")+"Supported data formats are 'channelsLast' and 'channelsFirst.");let r;return r="channelsFirst"===n?[[0,0],[0,0],t[0],t[1]]:[[0,0],t[0],t[1],[0,0]],cS(e,r)}))}(Tk(e),this.padding,this.dataFormat)))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}function oR(e,t,n,r,a,i){return zb((()=>{let o;_I(a),TI(i),EI(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=eA(e,a);const s="same"===r?"same":"valid";return o="max"===i?Qw(e,t,n,s):ew(e,t,n,s),"channelsFirst"===a&&(o=jS(o,[0,3,1,2])),o}))}function sR(e,t,n,r,a,i){return zb((()=>{let o;_I(a),TI(i),EI(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=tA(e,a);const s="same"===r?"same":"valid";return o="max"===i?Jw(e,t,n,s):tw(e,t,n,s),"channelsFirst"===a&&(o=jS(o,[0,4,1,2,3])),o}))}iR.className="ZeroPadding2D",Vy(iR);class cR extends jk{constructor(e){if(null==e.poolSize&&(e.poolSize=2),super(e),"number"===typeof e.poolSize)this.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!==typeof e.poolSize[0])throw new YT("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(e.poolSize)));this.poolSize=e.poolSize}if(dI(this.poolSize,"poolSize"),null==e.strides)this.strides=this.poolSize;else if("number"===typeof e.strides)this.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!==typeof e.strides[0])throw new YT("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(e.strides)));this.strides=e.strides}dI(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,EI(this.padding),this.inputSpec=[new Dk({ndim:3})]}computeOutputShape(e){const t=ZL((e=Ik(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return zb((()=>{this.invokeCallHook(e,t),e=WI(Tk(e),2);const n=this.poolingFunction(Tk(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return kS(n,[2])}))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class uR extends cR{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return _I(a),EI(r),oR(e,t,n,r,a,"max")}}uR.className="MaxPooling1D",Vy(uR);class lR extends cR{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return _I(a),EI(r),oR(e,t,n,r,a,"avg")}}lR.className="AveragePooling1D",Vy(lR);class fR extends jk{constructor(e){if(null==e.poolSize&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new YT("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+"".concat(e.strides.length,"."));this.strides=e.strides}else this.strides=[e.strides,e.strides];dI(this.poolSize,"poolSize"),dI(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,_I(this.dataFormat),EI(this.padding),this.inputSpec=[new Dk({ndim:4})]}computeOutputShape(e){e=Ik(e);let t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=ZL(t,this.poolSize[0],this.padding,this.strides[0]),n=ZL(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}call(e,t){return zb((()=>(this.invokeCallHook(e,t),this.poolingFunction(Tk(e),this.poolSize,this.strides,this.padding,this.dataFormat))))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class dR extends fR{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return _I(a),EI(r),oR(e,t,n,r,a,"max")}}dR.className="MaxPooling2D",Vy(dR);class hR extends fR{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return _I(a),EI(r),oR(e,t,n,r,a,"avg")}}hR.className="AveragePooling2D",Vy(hR);class pR extends jk{constructor(e){if(null==e.poolSize&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new YT("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+"".concat(e.strides.length,"."));this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];dI(this.poolSize,"poolSize"),dI(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,_I(this.dataFormat),EI(this.padding),this.inputSpec=[new Dk({ndim:5})]}computeOutputShape(e){e=Ik(e);let t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[4]:e[3];return t=ZL(t,this.poolSize[0],this.padding,this.strides[0]),n=ZL(n,this.poolSize[1],this.padding,this.strides[1]),r=ZL(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]}call(e,t){return zb((()=>(this.invokeCallHook(e,t),this.poolingFunction(Tk(e),this.poolSize,this.strides,this.padding,this.dataFormat))))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class gR extends pR{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return _I(a),EI(r),sR(e,t,n,r,a,"max")}}gR.className="MaxPooling3D",Vy(gR);class mR extends pR{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return _I(a),EI(r),sR(e,t,n,r,a,"avg")}}mR.className="AveragePooling3D",Vy(mR);class vR extends jk{constructor(e){super(e),this.inputSpec=[new Dk({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new XT}}class bR extends vR{constructor(e){super(e||{})}call(e,t){return zb((()=>{const t=Tk(e);return Zw(t,1)}))}}bR.className="GlobalAveragePooling1D",Vy(bR);class yR extends vR{constructor(e){super(e||{})}call(e,t){return zb((()=>{const t=Tk(e);return Pw(t,1)}))}}yR.className="GlobalMaxPooling1D",Vy(yR);class xR extends jk{constructor(e){super(e),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,_I(this.dataFormat),this.inputSpec=[new Dk({ndim:4})]}computeOutputShape(e){return"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new XT}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class wR extends xR{call(e,t){return zb((()=>{const t=Tk(e);return"channelsLast"===this.dataFormat?Zw(t,[1,2]):Zw(t,[2,3])}))}}wR.className="GlobalAveragePooling2D",Vy(wR);class SR extends xR{call(e,t){return zb((()=>{const t=Tk(e);return"channelsLast"===this.dataFormat?Pw(t,[1,2]):Pw(t,[2,3])}))}}SR.className="GlobalMaxPooling2D",Vy(SR);class CR extends jk{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return null!=this.layer&&this.layer.trainable}set trainable(e){null!=this.layer&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=mN(t.layer,n);delete t.layer;const a={layer:r};return Object.assign(a,t),new e(a)}}class MR extends CR{constructor(e){super(e),this.supportsMasking=!0}build(e){if((e=Ik(e)).length<3)throw new YT("TimeDistributed layer expects an input shape >= 3D, but received "+"input shape ".concat(JSON.stringify(e)));this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){const t=[(e=Ik(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),r=e[1];return[n[0],r].concat(n.slice(1))}call(e,t){return zb((()=>bA(((e,n)=>[Tk(this.layer.call(e,t)),[]]),e=Tk(e),[],!1,null,null,!1,!0)[1]))}}MR.className="TimeDistributed",Vy(MR);class _R extends CR{constructor(e){super(e);const t=e.layer.getConfig(),n={};n.className=e.layer.getClassName(),n.config=t,this.forwardLayer=mN(n),t.goBackwards=!0!==t.goBackwards;const r={};if(r.className=e.layer.getClassName(),r.config=t,this.backwardLayer=mN(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=void 0===e.mergeMode?"concat":e.mergeMode,function(e){lI(CI,"BidirectionalMergeMode",e)}(this.mergeMode),e.weights)throw new XT("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))}computeOutputShape(e){let t,n,r,a=this.forwardLayer.computeOutputShape(e);return Array.isArray(a)&&Array.isArray(a[0])||(a=[a]),this.returnState?(r=a.slice(1),t=a[0]):t=a[0],"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):$T(n)}apply(e,t){let n=null==t?null:t.initialState,r=null==t?null:t.constants;null==t&&(t={});const a=vA(e,n,r,this.numConstants);if(e=a.inputs,n=a.initialState,r=a.constants,Array.isArray(e)&&(n=e.slice(1),e=e[0]),(null==n||0===n.length)&&null==r)return super.apply(e,t);const i=[],o=[];if(null!=n){const e=n.length;if(e%2>0)throw new YT("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=n,i.push(...n);const r=n.map((e=>new Dk({shape:e.shape})));this.forwardLayer.stateSpec=r.slice(0,e/2),this.backwardLayer.stateSpec=r.slice(e/2),o.push(...r)}if(null!=r)throw new XT("Support for constants in Bidirectional layers is not implemented yet.");const s=i[0]instanceof Ok;for(const c of i)if(c instanceof Ok!==s)throw new YT("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(s){const n=[e].concat(i),r=this.inputSpec.concat(o),a=this.inputSpec;this.inputSpec=r;const s=super.apply(n,t);return this.inputSpec=a,s}return super.apply(e,t)}call(e,t){return zb((()=>{const n=t.initialState;let r,a,i,o;if(null==n)r=this.forwardLayer.call(e,t),a=this.backwardLayer.call(e,t);else{const i=n.slice(0,n.length/2),o=n.slice(n.length/2);r=this.forwardLayer.call(e,Object.assign(t,{initialState:i})),a=this.backwardLayer.call(e,Object.assign(t,{initialState:o}))}return this.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(a.slice(1))),r=r[0],a=a[0]),this.returnSequences&&(a=vS(a,1)),"concat"===this.mergeMode?o=YI([r,a]):"sum"===this.mergeMode?o=Ly(r,a):"ave"===this.mergeMode?o=Dy(.5,Ly(r,a)):"mul"===this.mergeMode?o=Dy(r,a):null==this.mergeMode&&(o=[r,a]),this.returnState?null==this.mergeMode?o.concat(i):[o].concat(i):o}))}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){kI(this.forwardLayer.name,(()=>{this.forwardLayer.build(e)})),kI(this.backwardLayer.name,(()=>{this.backwardLayer.build(e)})),this.built=!0}computeMask(e,t){let n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){const e=this.forwardLayer.states.map((e=>null));return Array.isArray(n)?n.concat(e).concat(e):[n].concat(e).concat(e)}return n}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const n=mN(t.layer);if(delete t.layer,null!=t.numConstants)throw new XT("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=t;return r.layer=n,new e(r)}}_R.className="Bidirectional",Vy(_R);class ER extends jk{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return zb((()=>("float32"!==(e=Tk(e)).dtype&&(e=UI(e,"float32")),Ly(Dy(e,this.scale),this.offset))))}}ER.className="Rescaling",Vy(ER);const{resizeBilinear:TR,cropAndResize:IR}=BC;class kR extends jk{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,n,r,a,i,o,s){return zb((()=>{let c,u=!1;const l=[t/i,n/o,(r+t)/i,(a+n)/o],f=[];3===e.rank?(u=!0,c=NS([e])):c=e;for(let e=0;e<c.shape[0];e++)f.push(l);const d=Db(f,[f.length,4]),h=gS(0,f.length,1,"int32"),p=IR(c,d,h,[r,a],"nearest");return UI(u?Tk(OS(p)):p,s)}))}upsize(e,t,n,r){return zb((()=>UI(TR(e,[t,n]),r)))}call(e,t){return zb((()=>{const t=Tk(e),n=t.dtype,r=t.shape,a=r[r.length-3],i=r[r.length-2];let o=0;a!==this.height&&(o=Math.floor((a-this.height)/2));let s=0;return i!==this.width&&(s=Math.floor((i-this.width)/2),0===s&&(s=1)),o>=0&&s>=0?this.centerCrop(t,o,s,this.height,this.width,a,i,n):this.upsize(e,this.height,this.width,n)}))}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){const t=(e=Ik(e)).length-3,n=e.length-2;return e[t]=this.height,e[n]=this.width,e}}kR.className="CenterCrop",Vy(kR);class NR extends jk{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return null==(e=Ik(e))?[this.numTokens]:"oneHot"===this.outputMode&&1!==e[e.length-1]?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return zb((()=>{let n;if("int32"!==(e=Tk(e)).dtype&&(e=UI(e,"int32")),"undefined"!==typeof t.countWeights){if("count"!==this.outputMode)throw new YT("countWeights is not used when outputMode !== count.\n              Received countWeights=".concat(t.countWeights));n=Tk(t.countWeights)}const r=Pw(e),a=$w(e),i=Lw(this.numTokens,r).bufferSync().get(0),o=Aw(a,0).bufferSync().get(0);if(!i||!o)throw new YT("Input values must be between 0 < values <="+" numTokens with numTokens=".concat(this.numTokens));return function(e,t,n,r){let a=Tk(e);if("int32"!==a.dtype&&(a=UI(a,"int32")),"int"===t)return a;const i=a.shape;if(0===a.rank&&(a=Ew(a,-1)),"oneHot"===t&&1!==a.shape[a.shape.length-1]&&(a=Ew(a,-1)),a.rank>2)throw new YT("When outputMode is not int, maximum output rank is 2"+" Received outputMode ".concat(t," and input shape ").concat(i)+" which would result in output rank ".concat(a.rank,"."));const o=["multiHot","oneHot"].includes(t),s=a;let c;if(c=xw(s,"undefined"!==typeof r&&"count"===t?r:[],n,o),"tfIdf"!==t)return c;if(r)return Dy(c,r);throw new YT("When outputMode is 'tfIdf', weights must be provided.")}(e,this.outputMode,this.numTokens,n)}))}}NR.className="CategoryEncoding",Vy(NR);const LR=new Set(["bilinear","nearest"]);class AR extends jk{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation){if(!LR.has(e.interpolation))throw new YT("Invalid interpolation parameter: ".concat(e.interpolation," is not implemented"));this.interpolation=e.interpolation}else this.interpolation="bilinear";this.cropToAspectRatio=Boolean(e.cropToAspectRatio)}computeOutputShape(e){const t=(e=Ik(e))[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return zb((()=>{const t=[this.height,this.width];if("bilinear"===this.interpolation)return BC.resizeBilinear(e,t,!this.cropToAspectRatio);if("nearest"===this.interpolation)return BC.resizeNearestNeighbor(e,t,!this.cropToAspectRatio);throw new Error("Interpolation is ".concat(this.interpolation," but only ").concat([...LR]," are supported"))}))}}AR.className="Resizing",Vy(AR);class RR{constructor(e){this.seed=e}next(){if(void 0!==this.seed)return this.seed++}}RR.className="RandomSeed";class DR extends jk{constructor(e){super(e),this.randomGenerator=new RR(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}DR.className="BaseRandomLayer";const OR=new Set(["bilinear","nearest"]);class PR extends DR{constructor(e){super(e);const{factor:t,interpolation:n="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&2===this.factor.length)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else{if(Array.isArray(this.factor)||!(this.factor>0))throw new YT("Invalid factor: ".concat(this.factor,". Must be positive number or tuple of 2 numbers"));this.widthLower=-this.factor,this.widthUpper=this.factor}if(this.widthLower<-1||this.widthUpper<-1)throw new YT("factor must have values larger than -1. Got: ".concat(this.factor));if(this.widthUpper<this.widthLower)throw new YT("factor cannot have upper bound less than lower bound.\n        Got upper bound: ".concat(this.widthUpper,".\n        Got lower bound: ").concat(this.widthLower,"\n      "));if(n){if(!OR.has(n))throw new YT("Invalid interpolation parameter: ".concat(n," is not implemented"));this.interpolation=n}}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){const t=(e=Ik(e))[2];return[this.imgHeight,-1,t]}call(e,t){return zb((()=>{const t=Tk(e);this.imgHeight=t.shape[t.shape.length-3];const n=t.shape[t.shape.length-2];this.widthFactor=pS([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let r=this.widthFactor.dataSync()[0]*n;r=Math.round(r);const a=[this.imgHeight,r];switch(this.interpolation){case"bilinear":return BC.resizeBilinear(e,a);case"nearest":return BC.resizeNearestNeighbor(e,a);default:throw new Error("Interpolation is ".concat(this.interpolation,"\n          but only ").concat([...OR]," are supported"))}}))}}PR.className="RandomWidth",Vy(PR);var FR,zR;Hh().registerFlag("KEEP_INTERMEDIATE_TENSORS",(()=>!1),(e=>{e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")})),function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"}(FR||(FR={})),function(e){let t;!function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(t=e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))}(zR||(zR={}));n(6382).Buffer;Error;new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function jR(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Set;if(null==e)return null;if("function"===typeof Blob&&e instanceof Blob)return e.slice();if(r.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);const a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(a.recurse){if(GR(e)){const a=Array.isArray(e)?[]:{};r.add(e);for(const i in e){const o=jR(e[i],t,n,r);a[i]=o}return r.delete(e),e.__proto__&&(a.__proto__=e.__proto__),a}throw new Error("Can't recurse into non-iterable type: ".concat(e))}return n.set(e,a.value),a.value}function BR(e){return UR(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:WR)}function UR(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set;const r=e[0];if(n.has(r))throw new Error("Circular references are not supported.");const a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse){if(GR(r)){const a=Array.isArray(r)?[]:{};n.add(r);for(const i in r){const r=e.map((e=>e[i])),o=UR(r,t,n);a[i]=o}return n.delete(r),a}throw new Error("Can't recurse into non-iterable type: ".concat(r))}return a.value}function WR(e){return null===e?null:GR(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}function GR(e){let t=!1;if(Hh().get("IS_BROWSER"))t=e instanceof TextDecoder;else{const{StringDecoder:r}=n(551);t=e instanceof r}return null!=e&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||"object"===typeof e&&!(e instanceof Zv)&&!(e instanceof Promise)&&!t)}function VR(e){return function(e,t){return jR(e,t)}(e,HR)}function HR(e){return e instanceof Zv?{value:e.clone(),recurse:!1}:GR(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}class YR{constructor(e){if(this.capacity=e,this.begin=0,this.end=0,null==e)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}wrap(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}get(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}set(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}length(){let e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}isFull(){return this.length()===this.capacity}isEmpty(){return 0===this.length()}push(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}pushAll(e){for(const t of e)this.push(t)}pop(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);const e=this.get(this.end);return this.set(this.end,void 0),e}unshift(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}shift(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}shuffleExcise(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n}}class XR extends YR{constructor(){super(XR.INITIAL_CAPACITY)}isFull(){return!1}push(e){super.isFull()&&this.expand(),super.push(e)}unshift(e){super.isFull()&&this.expand(),super.unshift(e)}expand(){const e=2*this.capacity,t=new Array(e),n=this.length();for(let r=0;r<n;r++)t[r]=this.get(this.wrap(this.begin+r));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}function qR(e){return new ZR(e)}function KR(e,t){return new uD(e,t)}XR.INITIAL_CAPACITY=32;class QR{async toArray(){const e=[];let t=await this.next();for(;!t.done;)e.push(t.value),t=await this.next();return e}async toArrayForTest(){const e=this.prefetch(100),t=[];let n=await e.next();for(;!n.done;)t.push(n.value),n=await e.next();return t}async resolveFully(){let e=await this.next();for(;!e.done;)e=await this.next()}async resolveWhile(e){let t=await this.next(),n=e(t.value);for(;!t.done&&n;)t=await this.next(),n=e(t.value)}handleErrors(e){return new iD(this,e)}filter(e){return new rD(this,e)}map(e){return new aD(this,e)}mapAsync(e){return new oD(this,e)}serialMapAsync(e){return new oD(this,e).serial()}flatmap(e){return new cD(this,e)}async forEachAsync(e){return this.map(e).resolveFully()}async serialForEach(e){return this.serialMapAsync(e).resolveWhile((e=>!0===e))}rowMajorBatch(e){return new nD(this,e,!(arguments.length>1&&void 0!==arguments[1])||arguments[1])}columnMajorBatch(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:WR;return this.rowMajorBatch(e,t).map((e=>BR(e,n)))}concatenate(e,t){return new uD(new JR([this,e]),t)}take(e){return e<0||null==e?this:new tD(this,e)}skip(e){return e<0||null==e?this:new eD(this,e)}prefetch(e){return new fD(this,e)}shuffle(e,t){return new dD(this,e,t)}serial(){return new $R(this)}}class JR extends QR{constructor(e){super(),this.items=e,this.trav=0}summary(){return"Array of ".concat(this.items.length," items")}async next(){if(this.trav>=this.items.length)return{value:null,done:!0};const e=this.items[this.trav];return this.trav++,{value:VR(e),done:!1}}}class ZR extends QR{constructor(e){super(),this.nextFn=e}summary(){return"Function call"}async next(){try{return this.nextFn()}catch(IQ){throw IQ.message="Error thrown while iterating through a dataset: ".concat(IQ.message),IQ}}}class $R extends QR{constructor(e){super(),this.upstream=e,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> Serial")}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){return this.upstream.next()}}class eD extends QR{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> Skip")}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;this.count++<this.maxCount;){const e=await this.upstream.next();if(e.done)return e;jb(e.value)}return this.upstream.next()}}class tD extends QR{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0}summary(){return"".concat(this.upstream.summary()," -> Take")}async next(){return this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next()}}class nD extends QR{constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(),this.upstream=e,this.batchSize=t,this.enableSmallLastBatch=n,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> RowMajorBatch")}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){const e=[];for(;e.length<this.batchSize;){const t=await this.upstream.next();if(t.done)return this.enableSmallLastBatch&&e.length>0?{value:e,done:!1}:{value:null,done:!0};e.push(t.value)}return{value:e,done:!1}}}class rD extends QR{constructor(e,t){super(),this.upstream=e,this.predicate=t,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> Filter")}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;;){const e=await this.upstream.next();if(e.done||this.predicate(e.value))return e;jb(e.value)}}}class aD extends QR{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return"".concat(this.upstream.summary()," -> Map")}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const t=hb(e.value),n=this.transform(e.value),r=hb(n);for(const a of t)db(a,r)||a.dispose();return{value:n,done:!1}}}class iD extends QR{constructor(e,t){super(),this.upstream=e,this.handler=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> handleErrors")}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;;)try{return await this.upstream.next()}catch(IQ){if(!this.handler(IQ))return{value:null,done:!0}}}}class oD extends QR{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return"".concat(this.upstream.summary()," -> AsyncMap")}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const t=hb(e.value),n=await this.transform(e.value),r=hb(n);for(const a of t)db(a,r)||a.dispose();return{value:n,done:!1}}}class sD extends QR{constructor(){super(),this.outputQueue=new XR,this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;0===this.outputQueue.length();)if(!await this.pump())return{value:null,done:!0};return{value:this.outputQueue.shift(),done:!1}}}class cD extends sD{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return"".concat(this.upstream.summary()," -> Flatmap")}async pump(){const e=await this.upstream.next();if(e.done)return!1;const t=hb(e.value),n=this.transform(e.value),r=hb(n);this.outputQueue.pushAll(n);for(const a of t)db(a,r)||a.dispose();return!0}}class uD extends QR{constructor(e,t){super(),this.baseErrorHandler=t,this.lastRead=null,this.iterator=null,this.moreIterators=e}summary(){return"".concat("TODO: fill in upstream of chained summaries"," -> Chained")}async next(){return this.lastRead=this.readFromChain(this.lastRead),this.lastRead}async readFromChain(e){if(await e,null==this.iterator){const e=await this.moreIterators.next();if(e.done)return{value:null,done:!0};this.iterator=e.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler))}const t=await this.iterator.next();return t.done?(this.iterator=null,this.readFromChain(e)):t}}var lD;!function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"}(lD||(lD={}));class fD extends QR{constructor(e,t){super(),this.upstream=e,this.bufferSize=t,this.buffer=new YR(t)}summary(){return"".concat(this.upstream.summary()," -> Prefetch")}refill(){for(;!this.buffer.isFull();){const e=this.upstream.next();this.buffer.push(e)}}next(){return this.refill(),this.buffer.shift()}}class dD extends fD{constructor(e,t,n){super(e,t),this.upstream=e,this.windowSize=t,this.upstreamExhausted=!1,this.random=lS.alea(n||Ov().toString()),this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}randomInt(e){return Math.floor(this.random()*e)}chooseIndex(){return this.randomInt(this.buffer.length())}async serialNext(){for(this.upstreamExhausted||this.refill();!this.buffer.isEmpty();){const e=this.chooseIndex(),t=await this.buffer.shuffleExcise(e);if(!t.done)return this.refill(),t;this.upstreamExhausted=!0}return{value:null,done:!0}}}class hD{constructor(){this.size=null}batch(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=this;let r;return fh(e>0,(()=>"batchSize needs to be positive, but it is\n      ".concat(e))),r=this.size===1/0||null==this.size?this.size:t?Math.ceil(this.size/e):Math.floor(this.size/e),pD((async()=>(await n.iterator()).columnMajorBatch(e,t,gD)),r)}concatenate(e){const t=this;let n;return n=this.size===1/0||e.size===1/0?1/0:null!=this.size&&null!=e.size?this.size+e.size:null,pD((async()=>(await t.iterator()).concatenate(await e.iterator())),n)}filter(e){const t=this;let n;return n=this.size===1/0?1/0:null,pD((async()=>(await t.iterator()).filter((t=>zb((()=>e(t)))))),n)}async forEachAsync(e){return(await this.iterator()).forEachAsync(e)}map(e){const t=this;return pD((async()=>(await t.iterator()).map((t=>zb((()=>e(t)))))),this.size)}mapAsync(e){const t=this;return pD((async()=>(await t.iterator()).mapAsync(e)),this.size)}prefetch(e){if(null==e)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");const t=this;return pD((async()=>(await t.iterator()).prefetch(e)),this.size)}repeat(e){const t=this;let n;return n=null!=this.size&&e>0?this.size*e:0===e?0:null!=this.size&&(void 0===e||e<0)?1/0:null,pD((async()=>KR(qR((async()=>({value:await t.iterator(),done:!1}))).take(e))),n)}skip(e){const t=this;let n;return n=null!=this.size&&e>=0&&this.size>=e?this.size-e:null!=this.size&&(this.size<e||void 0===e||e<0)?0:null,pD((async()=>(await t.iterator()).skip(e)),n)}shuffle(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null==e||e<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting "+"bufferSize to the dataset size (".concat(this.size," elements)"));const r=this,a=lS.alea(t||Ov().toString());return pD((async()=>{let t=a.int32();return n&&(t+=a.int32()),(await r.iterator()).shuffle(e,t.toString())}),this.size)}take(e){const t=this;let n;return n=null!=this.size&&this.size>e?e:null!=this.size&&this.size<=e?this.size:null,pD((async()=>(await t.iterator()).take(e)),n)}async toArray(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArray()}async toArrayForTest(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArrayForTest()}}function pD(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new class extends hD{constructor(){super(...arguments),this.size=t}async iterator(){return e()}}}function gD(e){if(null===e)return null;const t=e[0];if(null==(n=t)||function(e){return null===e||"object"!==typeof e&&"function"!==typeof e}(n)||Array.isArray(n)||"object"===typeof n&&n instanceof Zv||zv(n)){return{value:function(e){if(0===e.length)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof Zv?NS(e):Db(e)}(e),recurse:!1}}var n;return{value:null,recurse:!0}}hD.MAX_BUFFER_SIZE=1e4;Symbol("out"),Symbol("field"),Symbol("quote"),Symbol("quoteafterquote"),Symbol("quoteinquote");n(6382).Buffer;function mD(e,t){Array.isArray(e)||(e=[e]),e.forEach((e=>{null!=e&&fh("complex64"!==e.dtype,(()=>"".concat(t," does not support complex64 tensors in the CPU backend.")))}))}const vD=e_;class bD extends ih{nextDataId(){return bD.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new ah(this,Pb())}write(e,t,n){this.firstUse&&(this.firstUse=!1,Hh().get("IS_NODE")&&cv("\n============================\nHi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. \n============================"));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}makeTensorInfo(e,t,n){let r;if("string"===t&&null!=n&&n.length>0&&Th(n[0])){const a=n.map((e=>Pv(e)));r=this.write(a,e,t)}else r=this.write(n,e,t);return{dataId:r,shape:e,dtype:t}}refCount(e){if(this.data.has(e)){return this.data.get(e).refCount}return 0}incRef(e){this.data.get(e).refCount++}decRef(e){if(this.data.has(e)){this.data.get(e).refCount--}}move(e,t,n,r,a){this.data.set(e,{values:t,dtype:r,refCount:a})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:n}=this.data.get(e);if("complex64"===t){return bM(this.readSync(n.real.dataId),this.readSync(n.imag.dataId))}return function(e,t){if(Array.isArray(e))return e;if("float32"===t)return e instanceof Float32Array?e:new Float32Array(e);if("int32"===t)return e instanceof Int32Array?e:new Int32Array(e);if("bool"===t||"string"===t)return Uint8Array.from(new Int32Array(e));throw new Error("Unknown dtype ".concat(t))}(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if("string"===e.dtype)try{const n=t.map((e=>Fv(e)));return Ty(e.shape,e.dtype,n)}catch(u2){throw new Error("Failed to decode encoded string bytes into utf-8")}return Ty(e.shape,e.dtype,t)}makeOutput(e,t,n){return Pb().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,e),this)}disposeData(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:n}=this.data.get(e);null!=n&&(this.disposeData(n.real.dataId,!0),this.disposeData(n.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=Ov();e();return{kernelMs:Ov()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){mD([e],"where");const t=this.readSync(e.dataId);return vD(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}bD.nextDataId=0;function yD(e){return(t,n,r)=>{const a=Mh(n,t.length);for(let i=0;i<t.length;++i)a[i]=e(t[i],r);return a}}function xD(e,t,n){return wD(e,yD(t),n)}function wD(e,t,n){return r=>{let{inputs:a,attrs:i,backend:o}=r;const{x:s}=a;mD(s,e);const c=o,u=c.data.get(s.dataId).values;let l;if("string"===s.dtype){if(!Array.isArray(u))throw new Error("String tensor's value was not an instance of Array");l=ZM(u)}else l=u;const f=n||s.dtype,d=t(l,f,i);return c.makeTensorInfo(s.shape,f,d)}}Ub("cpu",(()=>new bD),1);const SD=xD(Kp,(e=>e>=0?e:Math.exp(e)-1)),CD={kernelName:Kp,backendName:"cpu",kernelFunc:SD};function MD(e){const{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const _D={kernelName:dg,backendName:"cpu",kernelFunc:MD};function ED(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{alpha:i}=r;mD([a],"leakyRelu");const o=ph(a.shape),s=n.data.get(a.dataId).values,c=Ch("float32",o);for(let u=0;u<s.length;u++)c[u]=s[u]<0?i*s[u]:s[u];return n.makeTensorInfo(a.shape,"float32",c)}const TD={kernelName:bg,backendName:"cpu",kernelFunc:ED};function ID(e){return(t,n,r,a,i)=>{const o=tx(t,n),s=o.length,c=Ah(o),u=Ch(i,ph(o)),l=t.length,f=n.length,d=Ah(t),h=Ah(n),p=$y(t,o),g=$y(n,o);if(p.length+g.length===0)for(let m=0;m<u.length;++m)u[m]=e(r[m%r.length],a[m%a.length]);else for(let m=0;m<u.length;++m){const t=Bh(m,s,c),n=t.slice(-l);p.forEach((e=>n[e]=0));const i=jh(n,l,d),o=t.slice(-f);g.forEach((e=>o[e]=0));const v=jh(o,f,h);u[m]=e(r[i],a[v])}return[u,o]}}const kD=ID(((e,t)=>e<0?t*e:e));function ND(e){const{inputs:t,backend:n}=e,{x:r,alpha:a}=t;mD([r,a],"prelu");const i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,[s,c]=kD(r.shape,a.shape,i,o,"float32");return n.makeTensorInfo(c,"float32",s)}const LD={kernelName:$g,backendName:"cpu",kernelFunc:ND},AD=xD(sm,(e=>Math.max(0,e))),RD={kernelName:sm,backendName:"cpu",kernelFunc:AD},DD=xD(hm,(e=>Math.min(Math.max(0,e),6))),OD={kernelName:hm,backendName:"cpu",kernelFunc:DD},PD=yD((e=>1/(1+Math.exp(-e)))),FD=xD(Em,(e=>1/(1+Math.exp(-e)))),zD={kernelName:Em,backendName:"cpu",kernelFunc:FD};function jD(e,t,n,r,a){if("linear"===n)return MD({inputs:{x:t},backend:e});if("relu"===n)return AD({inputs:{x:t},backend:e});if("elu"===n)return SD({inputs:{x:t},backend:e});if("relu6"===n)return DD({inputs:{x:t},backend:e});if("prelu"===n)return ND({inputs:{x:t,alpha:r},backend:e});if("leakyrelu"===n)return ED({inputs:{x:t},backend:e,attrs:{alpha:a}});if("sigmoid"===n)return FD({inputs:{x:t},backend:e});throw new Error("Activation ".concat(n," has not been implemented for the CPU backend."))}function BD(e){const{inputs:t,backend:n}=e,{real:r,imag:a}=t,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=n.makeTensorInfo(r.shape,"complex64");return n.data.get(s.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",i),imag:n.makeTensorInfo(a.shape,"float32",o)},s}const UD={kernelName:Cp,backendName:"cpu",kernelFunc:BD};function WD(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"float32";if("complex64"===n){return BD({inputs:{real:WD(e,t,"float32"),imag:WD(e,t,"float32")},backend:e})}const r=Ph(ph(t),n);return e.makeTensorInfo(t,n,r)}function GD(e){const{inputs:t,backend:n}=e,{input:r}=t,a=n.data.get(r.dataId).complexTensorInfos.real,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}const VD={kernelName:im,backendName:"cpu",kernelFunc:GD};function HD(e,t,n,r){if("int32"===r){return[t,"int32",Int32Array.from(e)]}if("bool"===r){const r=Dv([0],n),[a,i]=ID(((e,t)=>e!==t?1:0))(t,[],e,r,"bool");return[i,"bool",a]}throw new Error("Error in Cast: failed to cast ".concat(n," to ").concat(r))}function YD(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dtype:i}=r;if("complex64"===i){if("complex64"===a.dtype)return MD({inputs:{x:a},backend:n});const e=WD(n,a.shape,a.dtype),t=YD({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),r=BD({inputs:{real:t,imag:e},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),r}if("complex64"===a.dtype){const e=GD({inputs:{input:a},backend:n}),t=YD({inputs:{x:e},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(e),t}if(!_h(a.dtype,i)){const e=MD({inputs:{x:a},backend:n});return{dataId:e.dataId,shape:e.shape,dtype:i}}const o=n.data.get(a.dataId).values,[s,c,u]=HD(o,a.shape,a.dtype,i);return n.makeTensorInfo(s,c,u)}const XD={kernelName:xp,backendName:"cpu",kernelFunc:YD};function qD(e,t,n,r){return null==n?n=>{let{inputs:a,backend:i}=n;const{a:o,b:s}=a,c=i;mD([o,s],e);const u=c.data.get(o.dataId).values,l=c.data.get(s.dataId).values,f="string"===o.dtype?ZM(u):u,d="string"===o.dtype?ZM(l):l,h=r||o.dtype,[p,g]=t(o.shape,s.shape,f,d,h);return c.makeTensorInfo(g,h,p)}:e=>{let{inputs:a,backend:i}=e;const{a:o,b:s}=a,c=i;if("complex64"===o.dtype||"complex64"===s.dtype){const e=YD({inputs:{x:o},backend:c,attrs:{dtype:"complex64"}}),t=c.data.get(e.dataId),r=t.complexTensorInfos.real,a=t.complexTensorInfos.imag,i=c.data.get(r.dataId).values,u=c.data.get(a.dataId).values,l=YD({inputs:{x:s},backend:c,attrs:{dtype:"complex64"}}),f=c.data.get(l.dataId),d=f.complexTensorInfos.real,h=f.complexTensorInfos.imag,p=c.data.get(d.dataId).values,g=c.data.get(h.dataId).values,[m,v,b]=n(o.shape,s.shape,i,u,p,g),y=c.makeTensorInfo(b,"float32",m),x=c.makeTensorInfo(b,"float32",v),w=BD({inputs:{real:y,imag:x},backend:c});return c.disposeIntermediateTensorInfo(e),c.disposeIntermediateTensorInfo(l),c.disposeIntermediateTensorInfo(y),c.disposeIntermediateTensorInfo(x),w}{const e=c.data.get(o.dataId).values,n=c.data.get(s.dataId).values,a=r||o.dtype,[i,u]=t(o.shape,s.shape,e,n,a);return c.makeTensorInfo(u,a,i)}}}function KD(e){return(t,n,r,a,i,o)=>{const s=tx(t,n),c=ph(s),u=s.length,l=Ah(s),f=Ch("float32",c),d=Ch("float32",c),h=$y(t,s),p=$y(n,s),g=bM(r,a),m=bM(i,o),v=t.length,b=Ah(t),y=n.length,x=Ah(n);if(h.length+p.length===0)for(let w=0;w<f.length;w++){const t=w%g.length,n=w%m.length,r=e(g[2*t],g[2*t+1],m[2*n],m[2*n+1]);f[w]=r.real,d[w]=r.imag}else for(let w=0;w<f.length;w++){const t=Bh(w,u,l),n=t.slice(-v);h.forEach((e=>n[e]=0));const r=jh(n,v,b),a=t.slice(-y);p.forEach((e=>a[e]=0));const i=jh(a,y,x),o=e(g[2*r],g[2*r+1],m[2*i],m[2*i+1]);f[w]=o.real,d[w]=o.imag}return[f,d,s]}}const QD=ID(((e,t)=>e+t)),JD=KD(((e,t,n,r)=>({real:e+n,imag:t+r}))),ZD=qD(ep,QD,JD),$D={kernelName:ep,backendName:"cpu",kernelFunc:ZD};function eO(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{shape:i}=r,o=ph(a.shape),s=xh(i,o),c=ph(s);fh(o===c,(()=>"The new shape (".concat(s,") has ").concat(c," elements and the old ")+"shape (".concat(a.shape,") has ").concat(o," elements. The new shape and old ")+"shape must have the same number of elements.")),n.incRef(a.dataId);const u=n.data.get(a.dataId);if(null!=u.complexTensorInfos){const e=u.complexTensorInfos.real,t=u.complexTensorInfos.imag;e.shape=s,t.shape=s}return{dataId:a.dataId,shape:s,dtype:a.dtype}}const tO={kernelName:cm,backendName:"cpu",kernelFunc:eO};function nO(e){const{inputs:t,backend:n,attrs:r}=e,{a:a,b:i}=t,{transposeA:o,transposeB:s}=r;mD([a,i],"matMul");const c=a.shape.length,u=i.shape.length,l=o?a.shape[c-2]:a.shape[c-1],f=s?i.shape[u-1]:i.shape[u-2],d=o?a.shape[c-1]:a.shape[c-2],h=s?i.shape[u-2]:i.shape[u-1],p=a.shape.slice(0,-2),g=i.shape.slice(0,-2),m=ph(p),v=ph(g),b=tx(a.shape.slice(0,-2),i.shape.slice(0,-2)).concat([d,h]);fh(l===f,(()=>"Error in matMul: inner shapes (".concat(l,") and (")+"".concat(f,") of Tensors with shapes ").concat(a.shape," and ")+"".concat(i.shape," and transposeA=").concat(o)+" and transposeB=".concat(s," must match.")));const y=s?[v,h,f]:[v,f,h],x=eO({inputs:{x:a},backend:n,attrs:{shape:o?[m,l,d]:[m,d,l]}}),w=eO({inputs:{x:i},backend:n,attrs:{shape:y}}),S=o?x.shape[1]:x.shape[2],C=o?x.shape[2]:x.shape[1],M=s?w.shape[1]:w.shape[2],_=Math.max(m,v),E=n.data.get(x.dataId).values,T=n.data.get(w.dataId).values,I=Ah(x.shape),k=Ah(w.shape),[N,L,A]=o?[I[0],1,I[1]]:[I[0],I[1],1],[R,D,O]=s?[1,k[1],k[0]]:[k[1],1,k[0]],P=C*M,F=Ty([_,C,M],x.dtype),z=F.values,j=n.blockSize;for(let B=0;B<_;B++){const e=B%m,t=B%v;for(let n=0;n<C;n+=j){const r=Math.min(n+j,C);for(let a=0;a<M;a+=j){const i=Math.min(a+j,M);for(let o=0;o<S;o+=j){const s=Math.min(o+j,S);for(let c=n;c<r;c++)for(let n=a;n<i;n++){let r=0;for(let a=o;a<s;a++){r+=E[e*N+c*L+a*A]*T[a*R+n*D+t*O]}z[B*P+(c*M+n)]+=r}}}}}return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(w),n.makeTensorInfo(b,F.dtype,F.values)}const rO={kernelName:gp,backendName:"cpu",kernelFunc:nO};const aO={kernelName:iv,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{a:a,b:i,bias:o,preluActivationWeights:s}=t,{transposeA:c,transposeB:u,activation:l,leakyreluAlpha:f}=r;let d,h,p;const g=[];d=nO({inputs:{a:a,b:i},attrs:{transposeA:c,transposeB:u},backend:n}),o&&(h=ZD({inputs:{a:d,b:o},backend:n}),g.push(d),d=h),l&&(p=jD(n,d,l,s,f),g.push(d),d=p);for(const m of g)n.disposeIntermediateTensorInfo(m);return d}};function iO(e){const t=new Float32Array(e.length);for(let n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}const oO={kernelName:Jh,backendName:"cpu",kernelFunc:e=>{const{x:t}=e.inputs,n=e.backend;mD(t,"abs");let r=new Float32Array(ph(t.shape));return r=iO(n.data.get(t.dataId).values),n.makeOutput(r,t.shape,t.dtype)}},sO=xD(Zh,(e=>Math.acos(e))),cO={kernelName:Zh,backendName:"cpu",kernelFunc:sO},uO=xD($h,(e=>Math.acosh(e))),lO={kernelName:$h,backendName:"cpu",kernelFunc:uO};const fO={kernelName:tp,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,r=t;mD(t,"addN");const a=r.map((e=>n.data.get(e.dataId).values)),i=Ty(r[0].shape,r[0].dtype),o=i.values;for(let s=0;s<r.length;s++){const e=a[s];for(let t=0;t<o.length;t++)o[t]+=e[t]}return n.makeTensorInfo(i.shape,i.dtype,i.values)}};function dO(e,t,n,r,a){const i=t.length,o=ph(t),s=Ah(t),c=Ah(a),u=Ch(n,ph(a));for(let l=0;l<o;++l){const t=Bh(l,i,s),n=new Array(t.length);for(let e=0;e<n.length;e++)n[e]=t[r[e]];u[jh(n,i,c)]=e[l]}return u}function hO(e){const{inputs:t,attrs:n,backend:r}=e,{x:a}=t,{perm:i}=n;mD(a,"transpose");const o=a.shape.length,s=new Array(o);for(let u=0;u<s.length;u++)s[u]=a.shape[i[u]];const c=dO(r.data.get(a.dataId).values,a.shape,a.dtype,i,s);return{dataId:r.write(c,s,a.dtype),shape:s,dtype:a.dtype}}const pO={kernelName:Jm,backendName:"cpu",kernelFunc:hO};const gO={kernelName:np,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:o}=r;mD(a,"all");const s=wh(i,a.shape);let c=s;const u=Vw(c,a.shape.length);let l=a;null!=u&&(l=hO({inputs:{x:a},backend:n,attrs:{perm:u}}),c=Yw(c.length,a.shape.length)),Gw("all",c,l.shape.length);const[f,d]=Uw(l.shape,c),h=ph(d),p=Ph(ph(f),l.dtype),g=n.data.get(l.dataId).values;for(let v=0;v<p.length;++v){const e=v*h;let t=g[e];for(let n=0;n<h;++n){const r=g[e+n];t=t&&r}p[v]=t}null!=u&&n.disposeIntermediateTensorInfo(l);const m=n.makeTensorInfo(f,l.dtype,p);if(o){const e=eO({inputs:{x:m},backend:n,attrs:{shape:Ww(f,s)}});return n.disposeIntermediateTensorInfo(m),e}return m}};const mO={kernelName:rp,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:o}=r;mD(a,"any");const s=wh(i,a.shape);let c=s;const u=Vw(c,a.shape.length);let l=a;null!=u&&(l=hO({inputs:{x:a},backend:n,attrs:{perm:u}}),c=Yw(c.length,a.shape.length)),Gw("any",c,l.shape.length);const[f,d]=Uw(l.shape,c),h=ph(d),p=Ph(ph(f),l.dtype),g=n.data.get(l.dataId).values;for(let v=0;v<p.length;++v){const e=v*h;let t=g[e];for(let n=0;n<h;++n){const r=g[e+n];t=t||r}p[v]=t}null!=u&&n.disposeIntermediateTensorInfo(l);const m=n.makeTensorInfo(f,l.dtype,p);if(o){const e=eO({inputs:{x:m},backend:n,attrs:{shape:Ww(f,s)}});return n.disposeIntermediateTensorInfo(m),e}return m}};const vO={kernelName:ap,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i}=r;mD(a,"argMax");let o=wh(i,a.shape);const s=Vw(o,a.shape.length);let c=a;const u=[];null!=s&&(c=hO({inputs:{x:a},backend:n,attrs:{perm:s}}),u.push(c),o=Yw(o.length,c.shape.length)),o=[o[0]],Gw("argMax",o,c.shape.length);const[l,f]=Uw(c.shape,o),d=Ph(ph(l),"int32"),h=ph(f),p=n.data.get(c.dataId).values;for(let g=0;g<d.length;++g){const e=g*h;let t=p[e],n=0;for(let r=0;r<h;++r){const a=p[e+r];a>t&&(t=a,n=r)}d[g]=n}return u.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.makeTensorInfo(l,"int32",d)}};const bO={kernelName:ip,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i}=r;mD(a,"argMin");let o=wh(i,a.shape);const s=Vw(o,a.shape.length);let c=a;const u=[];null!=s&&(c=hO({inputs:{x:a},backend:n,attrs:{perm:s}}),u.push(c),o=Yw(o.length,c.shape.length)),o=[o[0]],Gw("argMin",o,c.shape.length);const[l,f]=Uw(c.shape,o),d=Ph(ph(l),"int32"),h=ph(f),p=n.data.get(c.dataId).values;for(let g=0;g<d.length;++g){const e=g*h;let t=p[e],n=0;for(let r=0;r<h;++r){const a=p[e+r];a<t&&(t=a,n=r)}d[g]=n}return u.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.makeTensorInfo(l,"int32",d)}},yO=xD(op,(e=>Math.asin(e))),xO={kernelName:op,backendName:"cpu",kernelFunc:yO},wO=xD(sp,(e=>Math.asinh(e))),SO={kernelName:sp,backendName:"cpu",kernelFunc:wO},CO=xD(cp,(e=>Math.atan(e))),MO={kernelName:cp,backendName:"cpu",kernelFunc:CO},_O=ID(((e,t)=>Math.atan2(e,t))),EO=qD(lp,_O),TO={kernelName:lp,backendName:"cpu",kernelFunc:EO},IO=xD(up,(e=>Math.atanh(e))),kO={kernelName:up,backendName:"cpu",kernelFunc:IO};function NO(e,t,n,r,a,i){const o=a.strideHeight,s=a.strideWidth,c=a.dilationHeight,u=a.dilationWidth,l=a.effectiveFilterHeight,f=a.effectiveFilterWidth,d=a.padInfo.top,h=a.padInfo.left,p="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=Ty(a.outShape,n),m=g.values,v=a.outShape[1]*a.outShape[2]*a.outShape[3],b=a.outShape[2]*a.outShape[3],y=a.outShape[3];for(let x=0;x<a.batchSize;++x){const t=x*v,n=x*r[0];for(let g=0;g<a.inChannels;++g)for(let v=0;v<a.outHeight;++v){const x=v*o-d,w=Math.max(0,x),S=Math.min(a.inHeight,l+x),C=t+v*b;for(let t=0;t<a.outWidth;++t){const o=t*s-h,l=Math.max(0,o),d=Math.min(a.inWidth,f+o);let v=p,b=0,x=0;for(let t=w;t<S;t+=c){const a=n+t*r[1];for(let t=l;t<d;t+=u){const n=e[a+t*r[2]+g];"max"===i&&n>v?v=n:"avg"===i&&(b+=n,x++)}if(isNaN(v))break}m[C+t*y+g]="avg"===i?b/x:v}}}return g}function LO(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const o=Ty(r.outShape,"int32"),s=r.strideHeight,c=r.strideWidth,u=r.dilationHeight,l=r.dilationWidth,f=r.effectiveFilterHeight,d=r.effectiveFilterWidth,h=r.padInfo.top,p=r.padInfo.left,g=Ty(t,n,e);for(let m=0;m<r.batchSize;++m)for(let e=0;e<r.inChannels;++e)for(let t=0;t<r.outHeight;++t){const n=t*s-h;let v=n;for(;v<0;)v+=u;const b=Math.min(r.inHeight,f+n);for(let s=0;s<r.outWidth;++s){const f=s*c-p;let h=f;for(;h<0;)h+=l;const y=Math.min(r.inWidth,d+f);let x=Number.NEGATIVE_INFINITY,w=-1;for(let t=v;t<b;t+=u){const o=t-n;for(let n=h;n<y;n+=l){const s=n-f,c=g.get(m,t,n,e);c>x&&(x=c,w=a?i?((m*r.inHeight+t)*r.inWidth+n)*r.inChannels+e:(t*r.inWidth+n)*r.inChannels+e:o*d+s)}}o.set(w,m,t,s,e)}}return o}function AO(e,t,n,r,a,i){const o=a.strideDepth,s=a.strideHeight,c=a.strideWidth,u=a.dilationDepth,l=a.dilationHeight,f=a.dilationWidth,d=a.effectiveFilterDepth,h=a.effectiveFilterHeight,p=a.effectiveFilterWidth,g=a.padInfo.front,m=a.padInfo.top,v=a.padInfo.left,b="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,y=Ty(a.outShape,n),x=y.values,w=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],S=a.outShape[2]*a.outShape[3]*a.outShape[4],C=a.outShape[3]*a.outShape[4],M=a.outShape[4];for(let _=0;_<a.batchSize;++_){const t=_*w,n=_*r[0];for(let y=0;y<a.inChannels;++y)for(let w=0;w<a.outDepth;++w){const _=w*o-g;let E=_;for(;E<0;)E+=u;const T=Math.min(a.inDepth,d+_),I=t+w*S;for(let t=0;t<a.outHeight;++t){const o=t*s-m;let d=o;for(;d<0;)d+=l;const g=Math.min(a.inHeight,h+o),w=I+t*C;for(let t=0;t<a.outWidth;++t){const o=t*c-v;let s=o;for(;s<0;)s+=f;const h=Math.min(a.inWidth,p+o),m=w+t*M;let S=b,C=0,_=0;for(let t=E;t<T;t+=u){const a=n+t*r[1];for(let t=d;t<g;t+=l){const n=a+t*r[2];for(let t=s;t<h;t+=f){const a=e[n+t*r[3]+y];if("max"===i&&a>S?S=a:"avg"===i&&(C+=a,_++),isNaN(S))break}if(isNaN(S))break}if(isNaN(S))break}x[m+y]="avg"===i?C/Math.max(_,1):S}}}}return y}const RO={kernelName:fp,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t;mD(a,"avgPool");const{filterSize:i,strides:o,pad:s,dimRoundingMode:c}=r;fh(Kx(o,1),(()=>"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")));const u=jx(a.shape,i,o,1,s,c);let l;if(1===u.filterWidth&&1===u.filterHeight&&gh(u.inShape,u.outShape))l=MD({inputs:{x:a},backend:n});else{const e=n.data.get(a.dataId).values,t=Ah(a.shape),r=NO(e,a.shape,a.dtype,t,u,"avg");l=n.makeTensorInfo(u.outShape,a.dtype,r.values)}return l}};const DO={kernelName:hp,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:i,strides:o,pad:s,dimRoundingMode:c,dataFormat:u}=r;mD(a,"avgPool3d");const l=Bx(a.shape,i,o,1,s,c,u),f=AO(n.data.get(a.dataId).values,a.shape,a.dtype,Ah(a.shape),l,"avg");return n.makeTensorInfo(f.shape,"float32",f.values)}};const OO={kernelName:pp,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,{filterSize:o,strides:s,pad:c,dimRoundingMode:u}=r;mD([a,i],"avgPool3DGrad");const l=Bx(i.shape,o,s,1,c,u),f=l.strideDepth,d=l.strideHeight,h=l.strideWidth,p=l.filterDepth,g=l.filterHeight,m=l.filterWidth,v=l.dilationDepth,b=l.dilationHeight,y=l.dilationWidth,x=l.effectiveFilterDepth,w=l.effectiveFilterHeight,S=l.effectiveFilterWidth,C=x-1-l.padInfo.front,M=S-1-l.padInfo.left,_=w-1-l.padInfo.top,E=Ty(i.shape,"float32"),T=1/(p*g*m),I=n.bufferSync(a);for(let k=0;k<l.batchSize;++k)for(let e=0;e<l.inChannels;++e)for(let t=0;t<l.inDepth;++t)for(let n=0;n<l.inHeight;++n)for(let r=0;r<l.inWidth;++r){const a=t-C,i=n-_,o=r-M;let s=0;for(let t=0;t<x;t+=v){const n=(a+t)/f;if(!(n<0||n>=l.outDepth||Math.floor(n)!==n))for(let t=0;t<w;t+=b){const r=(i+t)/d;if(!(r<0||r>=l.outHeight||Math.floor(r)!==r))for(let t=0;t<S;t+=y){const a=(o+t)/h;if(a<0||a>=l.outWidth||Math.floor(a)!==a)continue;s+=I.get(k,n,r,a,e)}}}E.set(s*T,k,t,n,r,e)}return n.makeTensorInfo(E.shape,E.dtype,E.values)}};const PO={kernelName:dp,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,o=i;mD([a,i],"avgPoolGrad");const{filterSize:s,strides:c,pad:u}=r,l=jx(o.shape,s,c,1,u),f=l.strideHeight,d=l.strideWidth,h=l.filterHeight,p=l.filterWidth,g=l.dilationHeight,m=l.dilationWidth,v=l.effectiveFilterHeight,b=l.effectiveFilterWidth,y=b-1-l.padInfo.left,x=v-1-l.padInfo.top,w=Ty(o.shape,"float32"),S=1/(h*p),C=n.data.get(a.dataId).values,M=Ty(a.shape,"float32",C);for(let _=0;_<l.batchSize;++_)for(let e=0;e<l.inChannels;++e)for(let t=0;t<l.inHeight;++t)for(let n=0;n<l.inWidth;++n){const r=t-x,a=n-y;let i=0;for(let t=0;t<v;t+=g){const n=(r+t)/f;if(!(n<0||n>=l.outHeight||Math.floor(n)!==n))for(let t=0;t<b;t+=m){const r=(a+t)/d;if(r<0||r>=l.outWidth||Math.floor(r)!==r)continue;i+=M.get(_,n,r,e)}}w.set(i*S,_,t,n,e)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}};const FO={kernelName:sg,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,scale:i,offset:o,mean:s,variance:c}=t;fh(s.shape.length===c.shape.length,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),fh(null==o||s.shape.length===o.shape.length,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),fh(null==i||s.shape.length===i.shape.length,(()=>"Batch normalization gradient requires mean and scale to have equal ranks.")),mD([a,s,c,i,o],"batchNorm");let{varianceEpsilon:u}=r;null==u&&(u=.001);const l=n.data.get(a.dataId).values,f=n.data.get(s.dataId).values,d=n.data.get(c.dataId).values,h=i?n.data.get(i.dataId).values:new Float32Array([1]),p=o?n.data.get(o.dataId).values:new Float32Array([0]),g=new Float32Array(l.length),m=p.length,v=h.length,b=d.length,y=f.length;let x=0,w=0,S=0,C=0;for(let M=0;M<l.length;++M)g[M]=p[x++]+(l[M]-f[w++])*h[S++]/Math.sqrt(d[C++]+u),x>=m&&(x=0),w>=y&&(w=0),S>=v&&(S=0),C>=b&&(C=0);return n.makeTensorInfo(a.shape,a.dtype,g)}};function zO(e,t,n,r,a){const i=Nx(r,t,n),o=ph(n),s=Ah(r);if(i){const n=Lx(t,s);return"string"===a?e.slice(n,n+o):e.subarray(n,n+o)}const c=Ty(r,a,"string"===a?ZM(e):e),u=Ty(n,a);for(let l=0;l<u.size;++l){const e=u.indexToLoc(l),n=e.map(((e,n)=>e+t[n]));u.set(c.get(...n),...e)}return"string"===a?$M(u.values):u.values}function jO(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:i,size:o}=r;mD(a,"slice");const[s,c]=Ax(a,i,o);bx(a,s,c);const u=zO(n.data.get(a.dataId).values,s,c,a.shape,a.dtype);return n.makeTensorInfo(c,a.dtype,u)}const BO={kernelName:Sm,backendName:"cpu",kernelFunc:jO};const UO={kernelName:mp,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:i,crops:o}=r;mD([a],"batchToSpaceND");const s=i.reduce(((e,t)=>e*t)),c=tM(a.shape,i,s),u=nM(c.length,i.length),l=rM(a.shape,i,s),f=aM(o,i.length),d=iM(l,o,i.length),h=eO({inputs:{x:a},backend:n,attrs:{shape:c}}),p=hO({inputs:{x:h},backend:n,attrs:{perm:u}}),g=eO({inputs:{x:p},backend:n,attrs:{shape:l}}),m=jO({inputs:{x:g},backend:n,attrs:{begin:f,size:d}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),m}};function WO(e,t,n,r,a){const i=ph(r),o=Ph(a,n);for(let s=0;s<e.length;s++){const n=e[s];if(n<0)throw new Error("Input x must be non-negative!");n>=a||(o[n]+=i>0?t[s]:1)}return o}function GO(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=e.shape[0],i=e.shape[1],o=Ty([a,n],t.dtype);for(let s=0;s<a;s++)for(let a=0;a<i;a++){const i=e.get(s,a);if(i<0)throw new Error("Input x must be non-negative!");i>=n||(r?o.set(1,s,i):t.size>0?o.set(o.get(s,i)+t.get(s,a),s,i):o.set(o.get(s,i)+1,s,i))}return o}const VO={kernelName:vp,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,weights:i}=t,{size:o}=r,s=WO(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,s)}},HO=ID(((e,t)=>e&t)),YO={kernelName:bp,backendName:"cpu",kernelFunc:qD(bp,HO)};const XO={kernelName:yp,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{s0:r,s1:a}=t,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=tx(Array.from(i),Array.from(o));return n.makeTensorInfo([s.length],"int32",Int32Array.from(s))}},qO=yD((e=>Math.ceil(e))),KO=wD(wp,qO),QO={kernelName:wp,backendName:"cpu",kernelFunc:KO},JO=xD(Sp,((e,t)=>{const n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e})),ZO={kernelName:Sp,backendName:"cpu",kernelFunc:JO},$O={kernelName:Mp,backendName:"cpu",kernelFunc:e=>{const{x:t}=e.inputs,n=e.backend,r=new Float32Array(ph(t.shape)),a=n.data.get(t.dataId),i=a.complexTensorInfos.real,o=a.complexTensorInfos.imag,s=n.data.get(i.dataId).values,c=n.data.get(o.dataId).values;for(let u=0;u<s.length;u++){const e=s[u],t=c[u];r[u]=Math.hypot(e,t)}return n.makeOutput(r,t.shape,"float32")}};function eP(e,t,n,r){const a=Mh(n,ph(t));if(r&&"string"!==n){let t=0;e.forEach((e=>{const n=ph(e.shape);a.set(e.vals,t),t+=n}))}else{let r=0;e.forEach((e=>{const i="string"===n?ZM(e.vals):e.vals;let o=0;for(let n=0;n<e.shape[0];++n){const s=n*t[1]+r;for(let t=0;t<e.shape[1];++t)a[s+t]=i[o++]}r+=e.shape[1]}))}return a}function tP(e){const{inputs:t,backend:n}=e,{input:r}=t,a=n.data.get(r.dataId).complexTensorInfos.imag,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}const nP={kernelName:pg,backendName:"cpu",kernelFunc:tP};function rP(e){const{inputs:t,backend:n,attrs:r}=e,{axis:a}=r,i=wh(a,t[0].shape)[0];HC(t.map((e=>e.shape)),i);let o=YC(t.map((e=>e.shape)),i);if(0===ph(o))return n.makeTensorInfo(o,t[0].dtype,[]);const s=t.filter((e=>ph(e.shape)>0));if(1===s.length)return MD({inputs:{x:s[0]},backend:n});if("complex64"===s[0].dtype){const e=s.map((e=>GD({inputs:{input:e},backend:n}))),t=s.map((e=>tP({inputs:{input:e},backend:n}))),r=rP({inputs:e,backend:n,attrs:{axis:i}}),a=rP({inputs:t,backend:n,attrs:{axis:i}}),o=BD({inputs:{real:r,imag:a},backend:n});return e.forEach((e=>n.disposeIntermediateTensorInfo(e))),t.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(a),o}const c=s.map((e=>{const t=ph(e.shape.slice(i));return eO({inputs:{x:e},backend:n,attrs:{shape:[-1,t]}})})),u=c.map((e=>({vals:n.data.get(e.dataId).values,shape:e.shape})));o=YC(c.map((e=>e.shape)),1);const l=1===c[0].shape[0],f=eP(u,o,t[0].dtype,l),d=YC(s.map((e=>e.shape)),i),h=n.makeTensorInfo(d,t[0].dtype,f);return c.forEach((e=>n.disposeIntermediateTensorInfo(e))),h}const aP={kernelName:_p,backendName:"cpu",kernelFunc:rP};function iP(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:o,pad:s,dataFormat:c,dilations:u,dimRoundingMode:l}=r;mD([a,i],"conv2d");const f=Jx(c),d=Ux(a.shape,i.shape,o,u,s,l,!1,f),h=d.filterHeight,p=d.filterWidth,g=d.dilationHeight,m=d.dilationWidth,v=d.padInfo.left,b=d.padInfo.top,y="channelsLast"===d.dataFormat,x=new qv(d.outShape,a.dtype),w=Ah(a.shape),S=Ah(i.shape),C=w[0],M=y?w[1]:w[2],_=y?w[2]:1,E=y?1:w[1],T=x.strides[0],I=y?x.strides[1]:x.strides[2],k=y?x.strides[2]:1,N=y?1:x.strides[1],L=n.data.get(a.dataId).values,A=n.data.get(i.dataId).values,R=x.values;for(let D=0;D<d.batchSize;++D){const e=D*C,t=D*T;for(let n=0;n<d.outHeight;++n){const r=t+n*I,a=n*d.strideHeight-b;for(let t=0;t<h;++t){const n=a+t*g;if(n<0||n>=d.inHeight)continue;const i=t*S[0],o=e+n*M;for(let e=0;e<d.outWidth;++e){const t=r+e*k,n=e*d.strideWidth-v;for(let e=0;e<p;++e){const r=n+e*m;if(r<0||r>=d.inWidth)continue;const a=o+r*_;let s=i+e*S[1];for(let e=0;e<d.inChannels;++e){const n=L[a+e*E];for(let e=0;e<d.outChannels;++e)R[t+e*N]+=n*A[s+e];s+=d.outChannels}}}}}}return n.makeTensorInfo(x.shape,x.dtype,R)}const oP={kernelName:Ep,backendName:"cpu",kernelFunc:iP};const sP={kernelName:Tp,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:o,pad:s,dataFormat:c,dimRoundingMode:u,filterShape:l}=r;mD([a,i],"conv2dBackpropFilter");const f=Jx(c),d=Ux(a.shape,l,o,1,s,u,!1,f),{strideHeight:h,strideWidth:p,filterHeight:g,filterWidth:m}=d,v="channelsLast"===d.dataFormat,b=new qv(d.filterShape,"float32"),y=d.padInfo.left,x=d.padInfo.top,w=n.data.get(a.dataId).values,S=n.data.get(i.dataId).values,C=new qv(a.shape,a.dtype,w),M=new qv(i.shape,i.dtype,S);for(let _=0;_<g;++_){const e=Math.max(0,Math.ceil((x-_)/h)),t=Math.min(d.outHeight,(d.inHeight+x-_)/h);for(let n=0;n<m;++n){const r=Math.max(0,Math.ceil((y-n)/p)),a=Math.min(d.outWidth,(d.inWidth+y-n)/p);for(let i=0;i<d.inChannels;++i)for(let o=0;o<d.outChannels;++o){let s=0;for(let c=0;c<d.batchSize;++c)for(let u=e;u<t;++u){const e=_+u*h-x;for(let t=r;t<a;++t){const r=n+t*p-y;s+=v?C.get(c,e,r,i)*M.get(c,u,t,o):C.get(c,i,e,r)*M.get(c,o,u,t)}}b.set(s,_,n,i,o)}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};const cP={kernelName:Ip,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{inputShape:o,strides:s,pad:c,dataFormat:u,dimRoundingMode:l}=r;mD([a,i],"conv2dBackpropInput");const f=Ah(i.shape),d=Ah(a.shape);let h=Jx(u);const p=Ux(o,i.shape,s,1,c,l,!1,h),g=new qv(p.inShape,"float32"),m=g.values,v=n.data.get(a.dataId).values,b=n.data.get(i.dataId).values,[y,x,w]=f,{batchSize:S,filterHeight:C,filterWidth:M,inChannels:_,inHeight:E,inWidth:T,outChannels:I,outHeight:k,outWidth:N,strideHeight:L,strideWidth:A}=p;h=p.dataFormat;const R=C-1-p.padInfo.top,D=M-1-p.padInfo.left,O="channelsLast"===h,P=g.strides[0],F=O?g.strides[1]:g.strides[2],z=O?g.strides[2]:1,j=O?1:g.strides[1],B=d[0],U=O?d[1]:d[2],W=O?d[2]:1,G=O?1:d[1];for(let V=0;V<S;++V)for(let e=0;e<_;++e)for(let t=0;t<E;++t){const n=t-R,r=Math.max(0,Math.ceil(n/L)),a=Math.min(k,(C+n)/L);for(let i=0;i<T;++i){const o=i-D,s=Math.max(0,Math.ceil(o/A)),c=Math.min(N,(M+o)/A);let u=0;for(let t=r;t<a;++t){const r=t*L-n;for(let n=s;n<c;++n){const a=B*V+U*t+W*n,i=y*(C-1-r)+x*(M-1-(n*A-o))+w*e;for(let e=0;e<I;++e){u+=v[a+G*e]*b[i+e]}}}m[P*V+F*t+z*i+j*e]=u}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}};const uP={kernelName:kp,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:o,pad:s,dilations:c}=r;mD([a,i],"conv3d");const u=Wx(a.shape,i.shape,o,c,s),{filterDepth:l,filterHeight:f,filterWidth:d,dilationDepth:h,dilationHeight:p,dilationWidth:g,padInfo:m}=u,v=m.front,b=m.left,y=m.top,x=new qv(u.outShape,a.dtype),w=n.data.get(a.dataId).values,S=n.data.get(i.dataId).values,C=x.values,M=Ah(a.shape),_=Ah(i.shape);for(let E=0;E<u.batchSize;++E){const e=E*M[0],t=E*x.strides[0];for(let n=0;n<u.outDepth;++n){const r=t+n*x.strides[1],a=n*u.strideDepth-v;for(let t=0;t<l;++t){const n=a+t*h;if(n<0||n>=u.inDepth)continue;const i=t*_[0],o=e+n*M[1];for(let e=0;e<u.outHeight;++e){const t=r+e*x.strides[2],n=e*u.strideHeight-y;for(let e=0;e<f;++e){const r=n+e*p;if(r<0||r>=u.inHeight)continue;const a=i+e*_[1],s=o+r*M[2];for(let e=0;e<u.outWidth;++e){const n=t+e*u.outChannels,r=e*u.strideWidth-b;for(let e=0;e<d;++e){const t=r+e*g;if(t<0||t>=u.inWidth)continue;const i=a+e*_[2],o=s+t*u.inChannels;let c=i;for(let e=0;e<u.inChannels;++e){const t=w[o+e];for(let e=0;e<u.outChannels;++e)C[n+e]+=t*S[c+e];c+=u.outChannels}}}}}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}};const lP={kernelName:Np,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:o,pad:s,filterShape:c}=r;mD([a,i],"conv3dBackpropFilterV2");const u=Ah(a.shape),l=Ah(i.shape),f=Wx(a.shape,c,o,1,s),d=f.strideDepth,h=f.strideHeight,p=f.strideWidth,g=f.filterDepth,m=f.filterHeight,v=f.filterWidth,b=new qv(f.filterShape,"float32"),y=b.values,[x,w,S,C]=b.strides,M=n.data.get(i.dataId).values,[_,E,T,I]=l,k=n.data.get(a.dataId).values,[N,L,A,R]=u,D=f.padInfo.front,O=f.padInfo.left,P=f.padInfo.top;for(let F=0;F<g;++F){const e=Math.max(0,Math.ceil((D-F)/d)),t=Math.min(f.outDepth,(f.inDepth+D-F)/d),n=F*x;for(let r=0;r<m;++r){const a=Math.max(0,Math.ceil((P-r)/h)),i=Math.min(f.outHeight,(f.inHeight+P-r)/h),o=r*w+n;for(let n=0;n<v;++n){const s=Math.max(0,Math.ceil((O-n)/p)),c=Math.min(f.outWidth,(f.inWidth+O-n)/p),u=n*S+o;for(let o=0;o<f.inChannels;++o){const l=o*C+u;for(let u=0;u<f.outChannels;++u){let g=0;for(let l=0;l<f.batchSize;++l){const f=l*N,m=l*_;for(let l=e;l<t;++l){const e=(F+l*d-D)*L+f,t=l*E+m;for(let l=a;l<i;++l){const a=(r+l*h-P)*A+e,i=l*T+t;for(let e=s;e<c;++e){const t=e*I+i;g+=k[(n+e*p-O)*R+a+o]*M[t+u]}}}}y[l+u]=g}}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};const fP={kernelName:Lp,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{pad:o,strides:s,inputShape:c}=r;mD([a],"conv3dBackpropInputV2");const u=Ah(a.shape),l=Ah(i.shape),f=Wx(c,i.shape,s,1,o),d=new qv(f.inShape,"float32"),h=d.values,[p,g,m,v]=d.strides,b=n.data.get(a.dataId).values,[y,x,w,S]=u,C=n.data.get(i.dataId).values,[M,_,E,T]=l,{batchSize:I,filterDepth:k,filterHeight:N,filterWidth:L,inChannels:A,inDepth:R,inHeight:D,inWidth:O,outChannels:P,outDepth:F,outHeight:z,outWidth:j,strideDepth:B,strideHeight:U,strideWidth:W}=f,G=k-1-f.padInfo.front,V=N-1-f.padInfo.top,H=L-1-f.padInfo.left;for(let Y=0;Y<I;++Y)for(let e=0;e<A;++e)for(let t=0;t<R;++t){const n=t-G,r=Math.max(0,Math.ceil(n/B)),a=Math.min(F,(k+n)/B);for(let i=0;i<D;++i){const o=i-V,s=Math.max(0,Math.ceil(o/U)),c=Math.min(z,(N+o)/U);for(let u=0;u<O;++u){const l=u-H,f=Math.max(0,Math.ceil(l/W)),d=Math.min(j,(L+l)/W);let I=0;for(let t=r;t<a;++t){const r=t*B-n;for(let n=s;n<c;++n){const a=n*U-o;for(let i=f;i<d;++i){const o=y*Y+x*t+w*n+S*i,s=M*(k-1-r)+_*(N-1-a)+E*(L-1-(i*W-l))+T*e;for(let e=0;e<P;++e){I+=b[o+e]*C[s+e]}}}}h[p*Y+g*t+m*i+v*u+e]=I}}}return n.makeTensorInfo(d.shape,d.dtype,d.values)}},dP=xD(Ap,(e=>Math.cos(e))),hP={kernelName:Ap,backendName:"cpu",kernelFunc:dP},pP=xD(Rp,(e=>Math.cosh(e))),gP={kernelName:Rp,backendName:"cpu",kernelFunc:pP};const mP={kernelName:Pp,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{image:a,boxes:i,boxInd:o}=t,{cropSize:s,method:c,extrapolationValue:u}=r,[l,f,d,h]=a.shape,p=i.shape[0],[g,m]=s,v=Ty([p,g,m,h],"float32"),b=n.data.get(i.dataId).values,y=n.data.get(o.dataId).values,x=n.data.get(a.dataId).values,w=Ah(a.shape),S=Ah(v.shape);for(let C=0;C<p;C++){const e=4*C,t=b[e],n=b[e+1],r=b[e+2],a=b[e+3],i=y[C];if(i>=l)continue;const o=g>1?(r-t)*(f-1)/(g-1):0,s=m>1?(a-n)*(d-1)/(m-1):0;for(let l=0;l<g;l++){const e=g>1?t*(f-1)+l*o:.5*(t+r)*(f-1);if(e<0||e>f-1)for(let t=0;t<m;t++)for(let e=0;e<h;e++){const n=e+t*S[2]+l*S[1]+C*S[0];v.values[n]=u}else if("bilinear"===c){const t=Math.floor(e),r=Math.ceil(e),o=e-t;for(let e=0;e<m;e++){const c=m>1?n*(d-1)+e*s:.5*(n+a)*(d-1);if(c<0||c>d-1){for(let t=0;t<h;t++){const n=t+e*S[2]+l*S[1]+C*S[0];v.values[n]=u}continue}const f=Math.floor(c),p=Math.ceil(c),g=c-f;for(let n=0;n<h;n++){let a=n+f*w[2]+t*w[1]+i*w[0];const s=x[a];a=n+p*w[2]+t*w[1]+i*w[0];const c=x[a];a=n+f*w[2]+r*w[1]+i*w[0];const u=x[a];a=n+p*w[2]+r*w[1]+i*w[0];const d=s+(c-s)*g,h=u+(x[a]-u)*g;a=n+e*S[2]+l*S[1]+C*S[0],v.values[a]=d+(h-d)*o}}}else for(let t=0;t<m;++t){const r=m>1?n*(d-1)+t*s:.5*(n+a)*(d-1);if(r<0||r>d-1){for(let e=0;e<h;e++){const n=e+t*S[2]+l*S[1]+C*S[0];v.values[n]=u}continue}const o=Math.round(r),c=Math.round(e);for(let e=0;e<h;e++){const n=e+o*w[2]+c*w[1]+i*w[0],r=e+t*S[2]+l*S[1]+C*S[0];v.values[r]=x[n]}}}}return n.makeTensorInfo(v.shape,v.dtype,v.values)}};const vP={kernelName:Dp,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,exclusive:o,reverse:s}=r;mD(a,"cumprod");const c=Vw([i],a.shape.length);let u=a;null!=c&&(u=hO({inputs:{x:a},backend:n,attrs:{perm:c}}));const l=Yw(1,a.shape.length)[0];if(l!==u.shape.length-1)throw new Error("backend.cumprod in CPU expects an inner-most "+"axis=".concat(u.shape.length-1," but got axis=").concat(l));const f=sb(u.dtype,"int32"),d=Oh(ph(u.shape),f),h=n.data.get(u.dataId).values,p=u.shape[u.shape.length-1],g=s?(e,t)=>e+p-t-1:(e,t)=>e+t;for(let v=0;v<h.length;v+=p)for(let e=0;e<p;e++){const t=g(v,e);if(0===e)d[t]=o?1:h[t];else{const n=g(v,e-1);d[t]=o?h[n]*d[n]:h[t]*d[n]}}const m=n.makeTensorInfo(u.shape,f,d);if(null!=c){const e=hO({inputs:{x:m},backend:n,attrs:{perm:Hw(c)}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(u),e}return m}};const bP={kernelName:Op,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,exclusive:o,reverse:s}=r;mD(a,"cumsum");const c=Vw([i],a.shape.length);let u=a;null!=c&&(u=hO({inputs:{x:a},backend:n,attrs:{perm:c}}));const l=Yw(1,a.shape.length)[0];if(l!==u.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most "+"axis=".concat(u.shape.length-1," but got axis=").concat(l));const f=sb(u.dtype,"int32"),d=Ph(ph(u.shape),f),h=n.data.get(u.dataId).values,p=u.shape[u.shape.length-1],g=s?(e,t)=>e+p-t-1:(e,t)=>e+t;for(let v=0;v<h.length;v+=p)for(let e=0;e<p;e++){const t=g(v,e);if(0===e)d[t]=o?0:h[t];else{const n=g(v,e-1);d[t]=o?h[n]+d[n]:h[t]+d[n]}}const m=n.makeTensorInfo(u.shape,f,d);if(null!=c){const e=hO({inputs:{x:m},backend:n,attrs:{perm:Hw(c)}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(u),e}return m}};const yP={kernelName:Fp,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,weights:i}=t,{size:o,binaryOutput:s}=r;if(1===a.shape.length){const e=WO(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,e)}if(2===a.shape.length){const e=GO(n.bufferSync(a),n.bufferSync(i),o,s);return n.makeTensorInfo(e.shape,i.dtype,e.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}};const xP={kernelName:zp,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockSize:i,dataFormat:o}=r;fh("NHWC"===o,(()=>"Only NHWC dataFormat supported on CPU for depthToSpace. Got ".concat(o)));const s=a.shape[0],c=a.shape[1],u=a.shape[2],l=a.shape[3],f=c*i,d=u*i,h=l/(i*i),p=n.data.get(a.dataId).values,g=new Float32Array(s*f*d*h);let m=0;for(let v=0;v<s;++v)for(let e=0;e<f;++e){const t=Math.floor(e/i),n=e%i;for(let e=0;e<d;++e){const r=Math.floor(e/i),a=(n*i+e%i)*h;for(let e=0;e<h;++e){const n=e+a+l*(r+u*(t+c*v));g[m++]=p[n]}}}return n.makeTensorInfo([s,f,d,h],a.dtype,g)}};function wP(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:o,pad:s,dilations:c,dimRoundingMode:u}=r;mD([a,i],"depthwiseConv2DNative");const l=Ah(a.shape),f=Ah(i.shape);let d=c;null==d&&(d=[1,1]),fh(Kx(o,d),(()=>"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(d,"'")));const h=Ux(a.shape,i.shape,o,d,s,u,!0),{filterHeight:p,filterWidth:g,dilationHeight:m,dilationWidth:v,padInfo:b}=h,y=b.left,x=b.top,w=h.outChannels/h.inChannels,S=new qv(h.outShape,a.dtype),C=n.data.get(a.dataId).values,M=n.data.get(i.dataId).values,_=S.values;for(let E=0;E<h.batchSize;++E){const e=E*l[0],t=E*S.strides[0];for(let n=0;n<h.outHeight;++n){const r=t+n*S.strides[1],a=n*h.strideHeight-x;for(let t=0;t<p;++t){const n=a+t*m;if(n<0||n>=h.inHeight)continue;const i=t*f[0],o=e+n*l[1];for(let e=0;e<h.outWidth;++e){const t=r+e*S.strides[2],n=e*h.strideWidth-y;for(let e=0;e<g;++e){const r=n+e*v;if(r<0||r>=h.inWidth)continue;const a=i+e*f[1],s=o+r*h.inChannels;let c=t,u=a;for(let e=0;e<h.inChannels;++e){const t=C[s+e];for(let e=0;e<w;++e)_[c+e]+=t*M[u+e];c+=w,u+=w}}}}}}return n.makeTensorInfo(S.shape,S.dtype,S.values)}const SP={kernelName:jp,backendName:"cpu",kernelFunc:wP};const CP={kernelName:Bp,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:o,dilations:s,pad:c,dimRoundingMode:u,filterShape:l}=r;mD([a,i],"depthwiseConv2dNativeBackpropFilter");const f=Ux(a.shape,l,o,s,c,u,!0),{strideHeight:d,strideWidth:h,filterHeight:p,filterWidth:g}=f,m=new qv(f.filterShape,"float32"),v=f.padInfo.left,b=f.padInfo.top,y=f.outChannels/f.inChannels,x=n.data.get(a.dataId).values,w=new qv(a.shape,a.dtype,x),S=n.data.get(i.dataId).values,C=new qv(i.shape,i.dtype,S);for(let M=0;M<p;++M){const e=Math.max(0,Math.ceil((b-M)/d)),t=Math.min(f.outHeight,(f.inHeight+b-M)/d);for(let n=0;n<g;++n){const r=Math.max(0,Math.ceil((v-n)/h)),a=Math.min(f.outWidth,(f.inWidth+v-n)/h);for(let i=0;i<f.outChannels;++i){const o=Math.trunc(i/y),s=i%y;let c=0;for(let u=0;u<f.batchSize;++u)for(let s=e;s<t;++s){const e=M+s*d-b;for(let t=r;t<a;++t){const r=n+t*h-v;c+=w.get(u,e,r,o)*C.get(u,s,t,i)}}m.set(c,M,n,o,s)}}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}};const MP={kernelName:Up,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{strides:o,dilations:s,pad:c,dimRoundingMode:u,inputShape:l}=r;mD([a,i],"depthwiseConv2DNativeBackpropInput");const f=Ah(a.shape),d=Ah(i.shape),h=Ux(l,i.shape,o,s,c,u,!0),p=new qv(h.inShape,"float32"),g=p.values,[m,v,b]=p.strides,y=n.data.get(a.dataId).values,[x,w,S]=f,C=n.data.get(i.dataId).values,[M,_,E]=d,{batchSize:T,filterHeight:I,filterWidth:k,inChannels:N,inHeight:L,inWidth:A,outChannels:R,outHeight:D,outWidth:O,strideHeight:P,strideWidth:F}=h,z=I-1-h.padInfo.top,j=k-1-h.padInfo.left,B=R/N;for(let U=0;U<T;++U)for(let e=0;e<N;++e)for(let t=0;t<L;++t){const n=t-z,r=Math.max(0,Math.ceil(n/P)),a=Math.min(D,(I+n)/P);for(let i=0;i<A;++i){const o=i-j,s=Math.max(0,Math.ceil(o/F)),c=Math.min(O,(k+o)/F);let u=0;for(let t=r;t<a;++t){const r=t*P-n;for(let n=s;n<c;++n){const a=x*U+w*t+S*n,i=M*(I-1-r)+_*(k-1-(n*F-o))+E*e;for(let t=0;t<B;++t){u+=y[a+(e*B+t)]*C[i+t]}}}g[m*U+v*t+b*i+e]=u}}return n.makeTensorInfo(p.shape,p.dtype,p.values)}};const _P={kernelName:Wp,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t,a=ph(r.shape),i=n.data.get(r.dataId).values,o=Ty([a,a],r.dtype),s=o.values;for(let u=0;u<i.length;u++)s[u*a+u]=i[u];const c=[...r.shape,...r.shape];return n.makeTensorInfo(c,o.dtype,o.values)}},EP={kernelName:Gp,backendName:"cpu",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e;const{x:a,filter:i}=t,{strides:o,pad:s,dilations:c}=r,u=n,l=u.data.get(a.dataId).values,f=a.shape.length,d=u.data.get(i.dataId).values,h=i.shape.length,{batchSize:p,inHeight:g,inWidth:m,inChannels:v,outHeight:b,outWidth:y,padInfo:x,strideHeight:w,strideWidth:S,filterHeight:C,filterWidth:M,dilationHeight:_,dilationWidth:E,outShape:T}=zx(a.shape,i.shape,o,s,"NHWC",c),I=ph(T),k=T.length,N=Mh(a.dtype,I);for(let L=0;L<p;++L)for(let e=0;e<b;++e){const t=e*w-x.top;for(let n=0;n<y;++n){const r=n*S-x.left;for(let o=0;o<v;++o){let s=Number.MIN_SAFE_INTEGER;for(let e=0;e<C;++e){const n=t+e*_;if(n>=0&&n<g)for(let t=0;t<M;++t){const c=r+t*E;if(c>=0&&c<m){const r=jh([L,n,c,o],f,Ah(a.shape)),u=jh([e,t,o],h,Ah(i.shape)),p=l[r]+d[u];p>s&&(s=p)}}}N[jh([L,e,n,o],k,Ah(T))]=s}}}return{dataId:u.write(Dv(N,a.dtype),T,a.dtype),shape:T,dtype:a.dtype}}},TP={kernelName:Hp,backendName:"cpu",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e;const{x:a,filter:i,dy:o}=t,{strides:s,pad:c,dilations:u}=r,l=n,f=Dh(a.shape,l.data.get(a.dataId).values),d=Dh(i.shape,l.data.get(i.dataId).values),{batchSize:h,inHeight:p,inWidth:g,inChannels:m,outHeight:v,outWidth:b,padInfo:y,strideHeight:x,strideWidth:w,filterHeight:S,filterWidth:C,dilationHeight:M,dilationWidth:_,outShape:E}=zx(a.shape,i.shape,s,c,"NHWC",u);fh(o.rank===E.length,(()=>"Error in ".concat(Hp,", dy ")+"must have the same rank as output ".concat(E.length,", but got ")+"".concat(o.rank)));const T=Dh(E,l.data.get(o.dataId).values),I=Fh(i.shape,i.dtype);for(let k=0;k<h;++k)for(let e=0;e<v;++e){const t=e*x-y.top;for(let n=0;n<b;++n){const r=n*w-y.left;for(let a=0;a<m;++a){let i=Number.MIN_SAFE_INTEGER,o=0,s=0;for(let e=0;e<S;++e){const n=t+e*M;if(n>=0&&n<p)for(let t=0;t<C;++t){const c=r+t*_;if(c>=0&&c<g){const r=f[k][n][c][a]+d[e][t][a];r>i&&(i=r,o=e,s=t)}}}I[o][s][a]+=T[k][e][n][a]}}}return{dataId:l.write(Dv(I,a.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},IP={kernelName:Vp,backendName:"cpu",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e;const{x:a,filter:i,dy:o}=t,{strides:s,pad:c,dilations:u}=r,l=n,f=Dh(a.shape,l.data.get(a.dataId).values),d=Dh(i.shape,l.data.get(i.dataId).values),{batchSize:h,inHeight:p,inWidth:g,inChannels:m,outHeight:v,outWidth:b,padInfo:y,strideHeight:x,strideWidth:w,filterHeight:S,filterWidth:C,dilationHeight:M,dilationWidth:_,outShape:E}=zx(a.shape,i.shape,s,c,"NHWC",u);fh(o.rank===E.length,(()=>"Error in ".concat(Vp,", dy ")+"must have the same rank as output ".concat(E.length,", but got ")+"".concat(o.rank)));const T=Dh(E,l.data.get(o.dataId).values),I=Fh(a.shape,a.dtype);for(let k=0;k<h;++k)for(let e=0;e<v;++e){const t=e*x-y.top;for(let n=0;n<b;++n){const r=n*w-y.left;for(let a=0;a<m;++a){let i=Number.MIN_SAFE_INTEGER,o=t<0?0:t,s=r<0?0:r;for(let e=0;e<S;++e){const n=t+e*M;if(n>=0&&n<p)for(let t=0;t<C;++t){const c=r+t*_;if(c>=0&&c<g){const r=f[k][n][c][a]+d[e][t][a];r>i&&(i=r,o=n,s=c)}}}I[k][o][s][a]+=T[k][e][n][a]}}}return{dataId:l.write(Dv(I,a.dtype),a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}};const kP={kernelName:Yp,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{image:a}=t,{canvas:i,options:o}=r,{contextOptions:s,imageOptions:c}=o||{},u=(null===c||void 0===c?void 0:c.alpha)||1,l=(null===s||void 0===s?void 0:s.contextType)||"2d";if("2d"!==l)throw new Error("Context type ".concat(s.contextType," is not supported by the CPU backend."));const f=i.getContext(l,(null===s||void 0===s?void 0:s.contextAttributes)||{});if(null==f)throw new Error("Could not get the context with ".concat(l," type."));const[d,h]=a.shape.slice(0,2),p=2===a.shape.length?1:a.shape[2],g=n.data.get(a.dataId).values,m="float32"===a.dtype?255:1,v=new Uint8ClampedArray(h*d*4);for(let y=0;y<d*h;++y){const e=[0,0,0,255*u];for(let n=0;n<p;n++){const t=g[y*p+n];if("float32"===a.dtype){if(t<0||t>1)throw new Error("Tensor values for a float32 Tensor must be in the "+"range [0 - 1] but encountered ".concat(t,"."))}else if("int32"===a.dtype&&(t<0||t>255))throw new Error("Tensor values for a int32 Tensor must be in the "+"range [0 - 255] but encountered ".concat(t,"."));1===p?(e[0]=t*m,e[1]=t*m,e[2]=t*m):e[n]=t*m}const t=4*y;v[t+0]=Math.round(e[0]),v[t+1]=Math.round(e[1]),v[t+2]=Math.round(e[2]),v[t+3]=Math.round(e[3])}i.width=h,i.height=d;const b=new ImageData(v,h,d);return f.putImageData(b,0,0),a}},NP=ID(((e,t)=>e*t)),LP=KD(((e,t,n,r)=>({real:e*n-t*r,imag:e*r+t*n}))),AP=qD(Wg,NP,LP),RP={kernelName:Wg,backendName:"cpu",kernelFunc:AP};function DP(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:o}=r;let s;mD(a,"sum"),s="bool"===a.dtype?YD({inputs:{x:a},backend:n,attrs:{dtype:"int32"}}):MD({inputs:{x:a},backend:n});const c=s.shape.length,u=wh(i,s.shape),l=Vw(u,c);let f=u,d=s;null!=l&&(d=hO({inputs:{x:s},backend:n,attrs:{perm:l}}),f=Yw(f.length,c)),Gw("sum",f,d.shape.length);const[h,p]=Uw(d.shape,f);let g=WD(n,h,sb(d.dtype,"int32"));const m=ph(p),v=n.data.get(g.dataId).values,b=n.data.get(d.dataId).values;for(let y=0;y<v.length;++y){const e=y*m;let t=0;for(let n=0;n<m;++n)t+=b[e+n];v[y]=t}if(o){const e=g;g=eO({inputs:{x:g},backend:n,attrs:{shape:Ww(g.shape,u)}}),n.disposeIntermediateTensorInfo(e)}return n.disposeIntermediateTensorInfo(s),null!=l&&n.disposeIntermediateTensorInfo(d),g}const OP={kernelName:km,backendName:"cpu",kernelFunc:DP};const PP={kernelName:qp,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{equation:a}=r,i=t,{allDims:o,summedDims:s,idDims:c}=NM(a,i.length);AM(o.length,c,i);const{path:u,steps:l}=RM(s,c),f=l.length;let d=null,h=o.length;const p=[];for(let g=0;g<f;++g){for(const e of l[g]){const{permutationIndices:t,expandDims:r}=LM(h,c[e]);let a;DM(t)?a=i[e]:(a=hO({inputs:{x:i[e]},backend:n,attrs:{perm:t}}),p.push(a));const o=a.shape.slice();for(let e=0;e<r.length;++e)o.splice(r[e],0,1);gh(a.shape,o)||(a=eO({inputs:{x:a},backend:n,attrs:{shape:o}}),p.push(a)),null===d?d=a:(d=AP({inputs:{a:a,b:d},backend:n}),p.push(d))}g<f-1&&(u[g]>=0&&(d=DP({inputs:{x:d},backend:n,attrs:{axis:u[g]-(o.length-h),keepDims:!1}}),p.push(d)),h--)}for(const g of p)g!==d&&n.disposeIntermediateTensorInfo(g);return d}};const FP={kernelName:Qp,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{dy:r,y:a}=t;mD([r,a],"eluGrad");const i=new Float32Array(ph(a.shape)),o=n.data.get(a.dataId).values,s=n.data.get(r.dataId).values;for(let c=0;c<o.length;++c){const e=o[c];i[c]=e>=0?s[c]:s[c]*(e+1)}return n.makeTensorInfo(a.shape,"float32",i)}},zP=ID(((e,t)=>e===t?1:0)),jP=qD(Zp,zP,null,"bool"),BP={kernelName:Zp,backendName:"cpu",kernelFunc:jP},UP=dM,WP=hM,GP=pM,VP=gM,HP=mM,YP=vM,XP=xD(Jp,(e=>{const t=Math.sign(e),n=Math.abs(e),r=1/(1+UP*n);return t*(1-((((YP*r+HP)*r+VP)*r+GP)*r+WP)*r*Math.exp(-n*n))})),qP={kernelName:Jp,backendName:"cpu",kernelFunc:XP},KP=yD((e=>Math.exp(e))),QP=wD($p,KP,"float32"),JP={kernelName:$p,backendName:"cpu",kernelFunc:QP};function ZP(e){const{inputs:t,backend:n,attrs:r}=e,{input:a}=t,{dim:i}=r,o=a.shape.length,s=a.shape.slice();let c=i;return i<0&&(fh(-(o+1)<=i,(()=>"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]"))),c=o+i+1),s.splice(c,0,1),eO({inputs:{x:a},backend:n,attrs:{shape:s}})}const $P={kernelName:eg,backendName:"cpu",kernelFunc:ZP},eF=yD((e=>Math.expm1(e))),tF=wD(tg,eF),nF={kernelName:tg,backendName:"cpu",kernelFunc:tF},rF=ID(((e,t)=>e/t)),aF=qD(Xp,rF),iF={kernelName:Xp,backendName:"cpu",kernelFunc:aF},oF=ID(((e,t)=>e-t)),sF=KD(((e,t,n,r)=>({real:e-n,imag:t-r}))),cF=qD(Hm,oF,sF),uF={kernelName:Hm,backendName:"cpu",kernelFunc:cF};function lF(e,t,n){const r=e.shape,a=r[0],i=r[1],o=n.data.get(e.dataId),s=o.complexTensorInfos.real,c=o.complexTensorInfos.imag,u=[a,i],l=ph(u),f=Ch("float32",l),d=Ch("float32",l);for(let m=0;m<a;m++){const e=jO({inputs:{x:s},backend:n,attrs:{begin:[m,0],size:[1,i]}}),r=jO({inputs:{x:c},backend:n,attrs:{begin:[m,0],size:[1,i]}}),a=BD({inputs:{real:e,imag:r},backend:n}),{real:o,imag:u}=fF(a,t,n),l=bM(o,u);for(let t=0;t<i;t++){const e=SM(l,t);f[m*i+t]=e.real,d[m*i+t]=e.imag}n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(a)}const h=n.makeTensorInfo(u,"float32",f),p=n.makeTensorInfo(u,"float32",d),g=BD({inputs:{real:h,imag:p},backend:n});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),g}function fF(e,t,n){const r=ph(e.shape),a=n.data.get(e.dataId),i=n.data.get(a.complexTensorInfos.real.dataId).values,o=n.data.get(a.complexTensorInfos.imag.dataId).values;if(0===((s=r)&s-1)){const a=dF(i,o,r,t,n),s=[e.shape[0],e.shape[1]];if(t){const e=n.makeTensorInfo(s,"float32",a.real),t=n.makeTensorInfo(s,"float32",a.imag),i=n.makeTensorInfo([],"float32",Rv(r,"float32")),o=MD({inputs:{x:i},backend:n}),c=iF.kernelFunc({inputs:{a:e,b:i},backend:n}),u=iF.kernelFunc({inputs:{a:t,b:o},backend:n}),l=n.data.get(c.dataId).values,f=n.data.get(u.dataId).values;return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(u),{real:l,imag:f}}return a}{const e=function(e,t,n){const r=new Float32Array(2*t);for(let a=0;a<t;a++){let i=0,o=0;for(let r=0;r<t;r++){const s=_M(a*r,t,n),c=SM(e,r);i+=c.real*s.real-c.imag*s.imag,o+=c.real*s.imag+c.imag*s.real}n&&(i/=t,o/=t),CM(r,i,o,a)}return r}(bM(i,o),r,t);return yM(e)}var s}function dF(e,t,n,r,a){if(1===n)return{real:e,imag:t};const i=bM(e,t),o=n/2,s=xM(i),c=s.real,u=s.imag,l=[c.length],f=a.makeTensorInfo(l,"float32",c),d=a.makeTensorInfo(l,"float32",u),h=BD({inputs:{real:f,imag:d},backend:a}),p=wM(i),g=p.real,m=p.imag,v=[g.length],b=a.makeTensorInfo(v,"float32",g),y=a.makeTensorInfo(v,"float32",m),x=BD({inputs:{real:b,imag:y},backend:a}),w=dF(c,u,o,r,a),S=w.real,C=w.imag,M=[S.length],_=a.makeTensorInfo(M,"float32",S),E=a.makeTensorInfo(M,"float32",C),T=BD({inputs:{real:_,imag:E},backend:a}),I=dF(g,m,o,r,a),k=I.real,N=I.imag,L=[k.length],A=a.makeTensorInfo(L,"float32",k),R=a.makeTensorInfo(L,"float32",N),D=BD({inputs:{real:A,imag:R},backend:a}),O=MM(n,r),P=[O.real.length],F=a.makeTensorInfo(P,"float32",O.real),z=a.makeTensorInfo(P,"float32",O.imag),j=BD({inputs:{real:F,imag:z},backend:a}),B=AP({inputs:{a:j,b:D},backend:a}),U=ZD({inputs:{a:T,b:B},backend:a}),W=cF({inputs:{a:T,b:B},backend:a}),G=GD({inputs:{input:U},backend:a}),V=GD({inputs:{input:W},backend:a}),H=tP({inputs:{input:U},backend:a}),Y=tP({inputs:{input:W},backend:a}),X=rP({inputs:[G,V],backend:a,attrs:{axis:0}}),q=rP({inputs:[H,Y],backend:a,attrs:{axis:0}}),K=a.data.get(X.dataId).values,Q=a.data.get(q.dataId).values;return a.disposeIntermediateTensorInfo(f),a.disposeIntermediateTensorInfo(d),a.disposeIntermediateTensorInfo(h),a.disposeIntermediateTensorInfo(b),a.disposeIntermediateTensorInfo(y),a.disposeIntermediateTensorInfo(x),a.disposeIntermediateTensorInfo(_),a.disposeIntermediateTensorInfo(E),a.disposeIntermediateTensorInfo(T),a.disposeIntermediateTensorInfo(A),a.disposeIntermediateTensorInfo(R),a.disposeIntermediateTensorInfo(D),a.disposeIntermediateTensorInfo(F),a.disposeIntermediateTensorInfo(z),a.disposeIntermediateTensorInfo(j),a.disposeIntermediateTensorInfo(B),a.disposeIntermediateTensorInfo(U),a.disposeIntermediateTensorInfo(W),a.disposeIntermediateTensorInfo(G),a.disposeIntermediateTensorInfo(H),a.disposeIntermediateTensorInfo(V),a.disposeIntermediateTensorInfo(Y),a.disposeIntermediateTensorInfo(X),a.disposeIntermediateTensorInfo(q),{real:K,imag:Q}}const hF={kernelName:ng,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:r}=t,a=ph(r.shape),i=r.shape[r.shape.length-1],o=eO({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),s=lF(o,!1,n),c=eO({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),c}};function pF(e){const{backend:t,attrs:n}=e,{shape:r,value:a,dtype:i}=n,o=i||kh(a),s=Mh(o,ph(r));return function(e,t){e.fill(t)}(s,a),t.makeTensorInfo(r,o,s)}const gF={kernelName:rg,backendName:"cpu",kernelFunc:pF};const mF={kernelName:ag,backendName:"cpu",kernelFunc:e=>{let{inputs:t,attrs:n,backend:r}=e;const{image:a}=t,i=r,o=Ch(a.dtype,ph(a.shape)),[s,c,u,l]=a.shape,f=i.data.get(a.dataId).values;for(let d=0;d<s;d++){const e=d*u*c*l;for(let t=0;t<c;t++){const n=t*(u*l);for(let t=0;t<u;t++){const r=t*l;for(let a=0;a<l;a++){const i=Math.round(u-t-1),s=e+n+r+a;let c=f[s];if(i>=0&&i<u){c=f[e+n+i*l+a]}o[s]=c}}}}return{dataId:i.write(o,a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},vF=yD((e=>Math.floor(e))),bF=wD(ig,vF),yF={kernelName:ig,backendName:"cpu",kernelFunc:bF},xF=ID(((e,t)=>Math.floor(e/t))),wF=qD(og,xF,null,"int32"),SF={kernelName:og,backendName:"cpu",kernelFunc:wF};const CF={kernelName:ov,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i,bias:o,preluActivationWeights:s}=t,{strides:c,pad:u,dataFormat:l,dilations:f,dimRoundingMode:d,activation:h,leakyreluAlpha:p}=r;let g=iP({inputs:{x:a,filter:i},backend:n,attrs:{strides:c,pad:u,dataFormat:l,dilations:f,dimRoundingMode:d}});if(o){const e=g;if("NCHW"===l&&1===o.shape.length&&1!==o.shape[0]){const e=eO({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});g=ZD({inputs:{a:g,b:e},backend:n}),n.disposeIntermediateTensorInfo(e)}else g=ZD({inputs:{a:g,b:o},backend:n});n.disposeIntermediateTensorInfo(e)}if(h){const e=g;if("NCHW"===l&&"prelu"===h&&1===s.shape.length&&1!==s.shape[0]){const e=eO({inputs:{x:s},backend:n,attrs:{shape:[s.shape[0],1,1]}});g=jD(n,g,h,e,p),n.disposeIntermediateTensorInfo(e)}else g=jD(n,g,h,s,p);n.disposeIntermediateTensorInfo(e)}return g}};const MF={kernelName:sv,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i,bias:o,preluActivationWeights:s}=t,{strides:c,pad:u,dataFormat:l,dilations:f,dimRoundingMode:d,activation:h,leakyreluAlpha:p}=r;let g=wP({inputs:{x:a,filter:i},backend:n,attrs:{strides:c,pad:u,dataFormat:l,dilations:f,dimRoundingMode:d}});if(o){const e=g;g=ZD({inputs:{a:g,b:o},backend:n}),n.disposeIntermediateTensorInfo(e)}if(h){const e=g;g=jD(n,g,h,s,p),n.disposeIntermediateTensorInfo(e)}return g}};function _F(e,t,n,r,a,i,o,s,c){const u=Ty([r,i],n);for(let l=0;l<r;l++){const n=[];let r=0;for(let t=0;t<a;t++){const i=e[l*a+t];r+=i*o[t],n.push(i)}if(r<0||r>=c/i)throw new Error("Invalid indices: ".concat(n," does not index into ").concat(s));for(let e=0;e<i;e++)u.values[l*i+e]=t.get(...t.indexToLoc(r*i+e))}return u}const EF={kernelName:ug,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{params:r,indices:a}=t,i=ph(r.shape),o=a.shape,s=o[o.length-1],[c,u,l,f]=oM(r,a);if(0===u)return n.makeTensorInfo(c,r.dtype,[]);const d=_F(n.data.get(a.dataId).values,n.bufferSync(r),r.dtype,u,s,l,f,r.shape,i);return n.makeTensorInfo(c,r.dtype,d.values)}};function TF(e,t,n){const r=Ty(n,e.dtype);for(let a=0;a<r.size;++a){const n=r.indexToLoc(a).slice(),i=n[0],o=n[2],s=t.locToIndex([i,o]);n[2]=t.values[s];const c=e.locToIndex(n);0<=c&&c<e.values.length&&(r.values[a]=e.values[c])}return r}const IF={kernelName:cg,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,indices:i}=t,{axis:o,batchDims:s}=r;mD([a,i],"gatherV2");const c=wh(o,a.shape)[0],u=n.data.get(i.dataId).values,l=a.shape[c];for(let y=0;y<u.length;++y){const e=u[y];fh(e<=l-1&&e>=0,(()=>"GatherV2: the index value ".concat(e," is not in [0, ").concat(l-1,"]")))}let f=s;null==s&&(f=0);const d=ph(i.shape),h=JM(a,i,c,f),p=eO({inputs:{x:a},backend:n,attrs:{shape:[h.batchSize,h.outerSize,h.dimSize,h.sliceSize]}}),g=eO({inputs:{x:i},backend:n,attrs:{shape:[h.batchSize,d/h.batchSize]}}),m=[h.batchSize,h.outerSize,d/h.batchSize,h.sliceSize],v=n.bufferSync(g),b=TF(n.bufferSync(p),v,m);return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),n.makeTensorInfo(h.outputShape,b.dtype,b.values)}},kF=ID(((e,t)=>e>t?1:0)),NF=qD(lg,kF,null,"bool"),LF={kernelName:lg,backendName:"cpu",kernelFunc:NF},AF=ID(((e,t)=>e>=t?1:0)),RF=qD(fg,AF,null,"bool"),DF={kernelName:fg,backendName:"cpu",kernelFunc:RF};const OF={kernelName:hg,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:r}=t,a=ph(r.shape),i=r.shape[r.shape.length-1],o=eO({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),s=lF(o,!0,n),c=eO({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),c}},PF=xD(gg,(e=>Number.isFinite(e)?1:0),"bool"),FF={kernelName:gg,backendName:"cpu",kernelFunc:PF},zF=xD(mg,(e=>Math.abs(e)===1/0?1:0),"bool"),jF={kernelName:mg,backendName:"cpu",kernelFunc:zF},BF=xD(vg,(e=>Number.isNaN(e)?1:0),"bool"),UF={kernelName:vg,backendName:"cpu",kernelFunc:BF},WF=ID(((e,t)=>e<t?1:0)),GF=qD(yg,WF,null,"bool"),VF={kernelName:yg,backendName:"cpu",kernelFunc:GF},HF=ID(((e,t)=>e<=t?1:0)),YF=qD(xg,HF,null,"bool"),XF={kernelName:xg,backendName:"cpu",kernelFunc:YF};function qF(e,t,n){const r=(t-e)/(n-1),a=Ph(n,"float32");a[0]=e;for(let i=1;i<a.length;i++)a[i]=a[i-1]+r;return a}const KF={kernelName:wg,backendName:"cpu",kernelFunc:function(e){const{backend:t,attrs:n}=e,{start:r,stop:a,num:i}=n,o=qF(r,a,i);return t.makeTensorInfo([o.length],"float32",o)}},QF=yD((e=>Math.log(e))),JF=wD(Sg,QF),ZF={kernelName:Sg,backendName:"cpu",kernelFunc:JF},$F=xD(Cg,(e=>Math.log1p(e))),ez={kernelName:Cg,backendName:"cpu",kernelFunc:$F},tz=ID(((e,t)=>e&&t)),nz=qD(Mg,tz,null,"bool"),rz={kernelName:Mg,backendName:"cpu",kernelFunc:nz},az=xD(_g,(e=>e?0:1),"bool"),iz={kernelName:_g,backendName:"cpu",kernelFunc:az},oz=ID(((e,t)=>e||t)),sz=qD(Eg,oz,null,"bool"),cz={kernelName:Eg,backendName:"cpu",kernelFunc:sz};const uz={kernelName:Tg,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{depthRadius:i,bias:o,alpha:s,beta:c}=r;mD(a,"LRN");const u=a.shape[3],l=u-1,f=n.data.get(a.dataId).values,d=ph(a.shape),h=new Float32Array(d);function p(e){const t=e%u;let n=e-t+Math.max(0,t-i);const r=e-t+Math.min(t+i,l);let a=0;for(;n<=r;n++){const e=f[n];a+=e*e}return a}for(let g=0;g<d;g++){const e=p(g),t=f[g]*Math.pow(o+s*e,-c);h[g]=t}return n.makeTensorInfo(a.shape,a.dtype,h)}};const lz={kernelName:Ig,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,y:i,dy:o}=t,{depthRadius:s,bias:c,alpha:u,beta:l}=r;mD(o,"LRNGrad");const f=ph(o.shape),d=o.shape[3],h=n.data.get(o.dataId).values,p=n.data.get(a.dataId).values,g=n.data.get(i.dataId).values,m=new Float32Array(f),v=f;for(let b=0;b<v;b++){const e=b%d,t=b-e+Math.max(0,e-s),n=b-e+Math.min(d,e+s+1);let r=0;for(let a=t;a<n;a++)r+=Math.pow(p[a],2);r=u*r+c;for(let a=t;a<n;a++){let e=-2*u*l*p[a]*g[b]/r;b===a&&(e+=Math.pow(r,-l)),e*=h[b],m[a]+=e}}return n.makeTensorInfo(o.shape,a.dtype,m)}};function fz(e,t,n,r){const a=Ch(r,ph(n));for(let i=0;i<a.length;++i){const n=i*t;let r=e[n];for(let a=0;a<t;++a){const t=e[n+a];(Number.isNaN(t)||t>r)&&(r=t)}a[i]=r}return a}function dz(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reductionIndices:i,keepDims:o}=r,s=n;let c=a.shape;const u=c.length,l=wh(i,c);let f=l;const d=Vw(f,u);let h=s.data.get(a.dataId).values;if(null!=d){const e=new Array(u);for(let t=0;t<e.length;t++)e[t]=c[d[t]];h=dO(h,c,a.dtype,d,e),f=Yw(f.length,u),c=e}mD(a,"max"),Gw("max",f,u);const[p,g]=Uw(c,f),m=fz(h,ph(g),p,a.dtype),v=s.write(m,p,a.dtype);let b=p;if(o){b=Ww(p,l)}return{dataId:v,shape:b,dtype:a.dtype}}const hz={kernelName:kg,backendName:"cpu",kernelFunc:dz},pz=ID(((e,t)=>Math.max(e,t))),gz=qD(Ng,pz),mz={kernelName:Ng,backendName:"cpu",kernelFunc:gz};const vz={kernelName:Lg,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t;mD(a,"maxPool");const{filterSize:i,strides:o,pad:s,dimRoundingMode:c}=r;fh(Kx(o,1),(()=>"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")));const u=jx(a.shape,i,o,1,s,c);let l;if(1===u.filterWidth&&1===u.filterHeight&&gh(u.inShape,u.outShape))l=MD({inputs:{x:a},backend:n});else{const e=n.data.get(a.dataId).values,t=Ah(a.shape),r=NO(e,a.shape,a.dtype,t,u,"max");l=n.makeTensorInfo(u.outShape,a.dtype,r.values)}return l}};const bz={kernelName:Rg,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:i,strides:o,pad:s,dimRoundingMode:c,dataFormat:u}=r;mD(a,"maxPool3d");const l=Bx(a.shape,i,o,1,s,c,u),f=AO(n.data.get(a.dataId).values,a.shape,a.dtype,Ah(a.shape),l,"max");return n.makeTensorInfo(f.shape,"float32",f.values)}};const yz={kernelName:Dg,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,{filterSize:o,strides:s,pad:c,dimRoundingMode:u}=r;mD([a,i],"maxPool3DGrad");const l=Bx(i.shape,o,s,1,c,u),f=function(e,t){const n=Ty(t.outShape,"int32"),r=t.strideDepth,a=t.strideHeight,i=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,c=t.dilationWidth,u=t.effectiveFilterDepth,l=t.effectiveFilterHeight,f=t.effectiveFilterWidth,d=t.padInfo.front,h=t.padInfo.top,p=t.padInfo.left;for(let g=0;g<t.batchSize;++g)for(let m=0;m<t.inChannels;++m)for(let v=0;v<t.outDepth;++v){const b=v*r-d;let y=b;for(;y<0;)y+=o;const x=Math.min(t.inDepth,u+b);for(let r=0;r<t.outHeight;++r){const u=r*a-h;let d=u;for(;d<0;)d+=s;const w=Math.min(t.inHeight,l+u);for(let a=0;a<t.outWidth;++a){const h=a*i-p;let S=h;for(;S<0;)S+=c;const C=Math.min(t.inWidth,f+h);let M=Number.NEGATIVE_INFINITY,_=-1;for(let t=y;t<x;t+=o){const n=t-b;for(let r=d;r<w;r+=s){const a=r-u;for(let i=S;i<C;i+=c){const o=i-h,s=e.get(g,t,r,i,m);s>=M&&(M=s,_=n*l*f+a*l+o)}}}n.set(_,g,v,r,a,m)}}}return n}(n.bufferSync(i),l),d=l.strideDepth,h=l.strideHeight,p=l.strideWidth,g=l.dilationDepth,m=l.dilationHeight,v=l.dilationWidth,b=l.effectiveFilterDepth,y=l.effectiveFilterHeight,x=l.effectiveFilterWidth,w=b-1-l.padInfo.front,S=x-1-l.padInfo.left,C=y-1-l.padInfo.top,M=Ty(i.shape,"float32"),_=n.bufferSync(a);for(let E=0;E<l.batchSize;++E)for(let e=0;e<l.inChannels;++e)for(let t=0;t<l.inDepth;++t)for(let n=0;n<l.inHeight;++n)for(let r=0;r<l.inWidth;++r){const a=t-w,i=n-C,o=r-S;let s=0;for(let t=0;t<b;t+=g){const n=(a+t)/d;if(!(n<0||n>=l.outDepth||Math.floor(n)!==n))for(let r=0;r<y;r+=m){const a=(i+r)/h;if(!(a<0||a>=l.outHeight||Math.floor(a)!==a))for(let i=0;i<x;i+=v){const c=(o+i)/p;if(c<0||c>=l.outWidth||Math.floor(c)!==c)continue;const u=b*y*x-1-f.get(E,n,a,c,e)===t*y*x+r*x+i?1:0;if(0===u)continue;s+=_.get(E,n,a,c,e)*u}}}M.set(s,E,t,n,r,e)}return n.makeTensorInfo(M.shape,M.dtype,M.values)}};const xz={kernelName:Ag,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i,output:o}=t,s=i;mD([i,o],"maxPoolGrad");const{filterSize:c,strides:u,pad:l,dimRoundingMode:f}=r,d=jx(s.shape,c,u,1,l,f),h=n.data.get(s.dataId).values,p=Ty(d.outShape,s.dtype,LO(h,s.shape,s.dtype,d).values),g=d.strideHeight,m=d.strideWidth,v=d.dilationHeight,b=d.dilationWidth,y=d.effectiveFilterHeight,x=d.effectiveFilterWidth,w=x-1-d.padInfo.left,S=y-1-d.padInfo.top,C=Ty(s.shape,"float32"),M=n.data.get(a.dataId).values,_=Ty(a.shape,"float32",M);for(let E=0;E<d.batchSize;++E)for(let e=0;e<d.inChannels;++e)for(let t=0;t<d.inHeight;++t)for(let n=0;n<d.inWidth;++n){const r=t-S,a=n-w;let i=0;for(let t=0;t<y;t+=v){const n=(r+t)/g;if(!(n<0||n>=d.outHeight||Math.floor(n)!==n))for(let r=0;r<x;r+=b){const o=(a+r)/m;if(o<0||o>=d.outWidth||Math.floor(o)!==o)continue;const s=y*x-1-p.get(E,n,o,e)===t*x+r?1:0;if(0===s)continue;i+=_.get(E,n,o,e)*s}}C.set(i,E,t,n,e)}return n.makeTensorInfo(C.shape,C.dtype,C.values)}};const wz={kernelName:Og,backendName:"cpu",kernelFunc:e=>{let{inputs:t,attrs:n,backend:r}=e;const{x:a}=t,{filterSize:i,strides:o,pad:s,includeBatchInIndex:c}=n,u=r;mD(a,"MaxPoolWithArgmax");const l=u.data.get(a.dataId).values,f=jx(a.shape,i,o,[1,1],s),[d,h]=function(e,t,n,r,a){const i=NO(e,0,n,Ah(t),a,"max"),o=LO(e,t,n,a,!0,r);return[i.values,o.values]}(l,a.shape,a.dtype,c,f),p=u.write(d,f.outShape,a.dtype),g=u.write(h,f.outShape,a.dtype);return[{dataId:p,shape:f.outShape,dtype:a.dtype},{dataId:g,shape:f.outShape,dtype:"int32"}]}};const Sz={kernelName:Pg,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:o}=r,s=wh(i,a.shape),c=ph(Uw(a.shape,s)[1]),u=[],l=n.makeTensorInfo([],"float32",new Float32Array([c]));u.push(l);const f=YD({inputs:{x:a},backend:n,attrs:{dtype:"float32"}});u.push(f);const d=aF({inputs:{a:f,b:l},backend:n});u.push(d);const h=DP({inputs:{x:d},backend:n,attrs:{axis:i,keepDims:o}});return u.forEach((e=>n.disposeIntermediateTensorInfo(e))),h}};const Cz={kernelName:Fg,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:o}=r;mD(a,"min");const s=wh(i,a.shape);let c=s;const u=Vw(c,a.shape.length);let l=a;null!=u&&(l=hO({inputs:{x:a},backend:n,attrs:{perm:u}}),c=Yw(c.length,a.shape.length)),Gw("min",c,l.shape.length);const[f,d]=Uw(l.shape,c),h=ph(d),p=Ph(ph(f),l.dtype),g=n.data.get(l.dataId).values;for(let v=0;v<p.length;++v){const e=v*h;let t=g[e];for(let n=0;n<h;++n){const r=g[e+n];(Number.isNaN(r)||r<t)&&(t=r)}p[v]=t}null!=u&&n.disposeIntermediateTensorInfo(l);const m=n.makeTensorInfo(f,l.dtype,p);if(o){const e=eO({inputs:{x:m},backend:n,attrs:{shape:Ww(f,s)}});return n.disposeIntermediateTensorInfo(m),e}return m}},Mz=ID(((e,t)=>Math.min(e,t))),_z=qD(zg,Mz),Ez={kernelName:zg,backendName:"cpu",kernelFunc:_z};const Tz={kernelName:jg,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{paddings:i,mode:o}=r;mD(a,"mirrorPad");const s=i.map(((e,t)=>e[0]+a.shape[t]+e[1])),c=i.map((e=>e[0])),u=i.map(((e,t)=>e[0]+a.shape[t])),l="reflect"===o?0:1,f=n.data.get(a.dataId).values,d=a.shape.length,h=Ah(a.shape),p=ph(s),g=s.length,m=Ah(s),v=Ch(a.dtype,p);for(let b=0;b<p;b++){let e=Bh(b,g,m);for(let n=0;n<g;n++)e[n]<c[n]?e[n]=2*c[n]-e[n]-l:e[n]>=u[n]&&(e[n]=2*(u[n]-1)-e[n]+l);e=e.map(((e,t)=>e-c[t]));const t=jh(e,d,h);v[b]=f[t]}return{dataId:n.write(v,s,a.dtype),shape:s,dtype:a.dtype}}},Iz=ID(((e,t)=>{const n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})),kz=qD(Bg,Iz),Nz={kernelName:Bg,backendName:"cpu",kernelFunc:kz};function Lz(e){const{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{dim:i}=r,o=a.shape.length;let s=i;if(-1===s&&(s=o-1),s!==o-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(o," and dim was ").concat(s));const c=wh([s],a.shape),u=dz({inputs:{x:a},backend:n,attrs:{reductionIndices:c,keepDims:!1}}),l=Ww(u.shape,c),f=eO({inputs:{x:u},backend:n,attrs:{shape:l}}),d=cF({inputs:{a:a,b:f},backend:n}),h=QP({inputs:{x:d},backend:n}),p=DP({inputs:{x:h},backend:n,attrs:{axis:c,keepDims:!1}}),g=eO({inputs:{x:p},backend:n,attrs:{shape:l}}),m=aF({inputs:{a:h,b:g},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),m}const Az={kernelName:Am,backendName:"cpu",kernelFunc:Lz};const Rz={kernelName:Ug,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{numSamples:i,seed:o,normalized:s}=r;mD(a,"multinomial");const c=s?a:Lz({inputs:{logits:a},backend:n,attrs:{dim:-1}}),u=c.shape[0],l=c.shape[1],f=n.data.get(c.dataId).values,d=[u,i],h=Ph(ph(d),"int32");for(let p=0;p<u;++p){const e=p*l,t=new Float32Array(l-1);t[0]=f[e];for(let a=1;a<t.length;++a)t[a]=t[a-1]+f[e+a];const n=lS.alea(o.toString()),r=p*i;for(let a=0;a<i;++a){const e=n();h[r+a]=t.length;for(let n=0;n<t.length;n++)if(e<t[n]){h[r+a]=n;break}}}return s||n.disposeIntermediateTensorInfo(c),n.makeTensorInfo(d,"int32",h)}};function Dz(e,t,n){const r=Rv(-1,n);return NP([],t,r,e,n)}const Oz={kernelName:Gg,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t;mD(r,"neg");const a=n.data.get(r.dataId).values,[i,o]=Dz(a,r.shape,r.dtype);return n.makeTensorInfo(o,r.dtype,i)}},Pz=dC;const Fz={kernelName:Hg,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:i}=t,{maxOutputSize:o,iouThreshold:s,scoreThreshold:c}=r;mD(a,"NonMaxSuppression");const u=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,{selectedIndices:f}=Pz(u,l,o,s,c);return n.makeTensorInfo([f.length],"int32",new Int32Array(f))}},zz=hC;const jz={kernelName:Yg,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:i}=t,{maxOutputSize:o,iouThreshold:s,scoreThreshold:c,padToMaxOutputSize:u}=r;mD(a,"NonMaxSuppressionPadded");const l=n.data.get(a.dataId).values,f=n.data.get(i.dataId).values,{selectedIndices:d,validOutputs:h}=zz(l,f,o,s,c,u);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([h]))]}},Bz=pC;const Uz={kernelName:Xg,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:i}=t,{maxOutputSize:o,iouThreshold:s,scoreThreshold:c,softNmsSigma:u}=r;mD(a,"NonMaxSuppressionWithScore");const l=n.data.get(a.dataId).values,f=n.data.get(i.dataId).values,d=o,h=s,p=c,g=u,{selectedIndices:m,selectedScores:v}=Bz(l,f,d,h,p,g);return[n.makeTensorInfo([m.length],"int32",new Int32Array(m)),n.makeTensorInfo([v.length],"float32",new Float32Array(v))]}},Wz=ID(((e,t)=>e!==t?1:0)),Gz=qD(Vg,Wz,null,"bool"),Vz={kernelName:Vg,backendName:"cpu",kernelFunc:Gz};const Hz={kernelName:Kg,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{indices:a}=t,{dtype:i,depth:o,onValue:s,offValue:c}=r;mD(a,"oneHot");const u=ph(a.shape),l=new Float32Array(u*o);l.fill(c);const f=n.data.get(a.dataId).values;for(let d=0;d<u;++d)f[d]>=0&&f[d]<o&&(l[d*o+f[d]]=s);return n.makeTensorInfo([...a.shape,o],i,l)}};function Yz(e){const{inputs:t,backend:n}=e,{x:r}=t;if("string"===r.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===r.dtype){const e=GD({inputs:{input:r},backend:n}),t=Yz({inputs:{x:e},backend:n}),a=tP({inputs:{input:r},backend:n}),i=Yz({inputs:{x:a},backend:n}),o=BD({inputs:{real:t,imag:i},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),o}return pF({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}const Xz={kernelName:tv,backendName:"cpu",kernelFunc:Yz};const qz={kernelName:qg,backendName:"cpu",kernelFunc:function e(t){const{inputs:n,backend:r}=t,{x:a}=n;if("string"===a.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===a.dtype){const t=GD({inputs:{input:a},backend:r}),n=e({inputs:{x:t},backend:r}),i=tP({inputs:{input:a},backend:r}),o=Yz({inputs:{x:i},backend:r}),s=BD({inputs:{real:n,imag:o},backend:r});return r.disposeIntermediateTensorInfo(t),r.disposeIntermediateTensorInfo(n),r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}return pF({backend:r,attrs:{shape:a.shape,value:1,dtype:a.dtype}})}};function Kz(e){const{inputs:t,backend:n,attrs:r}=e,{axis:a}=r;if(1===t.length)return ZP({inputs:{input:t[0]},backend:n,attrs:{dim:a}});const i=t[0].shape,o=t[0].dtype;t.forEach((e=>{dh(i,e.shape,"All tensors passed to stack must have matching shapes"),fh(o===e.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));const s=[],c=rP({inputs:t.map((e=>{const t=ZP({inputs:{input:e},backend:n,attrs:{dim:a}});return s.push(t),t})),backend:n,attrs:{axis:a}});return s.forEach((e=>n.disposeIntermediateTensorInfo(e))),c}const Qz={kernelName:Qg,backendName:"cpu",kernelFunc:Kz};const Jz={kernelName:Jg,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{paddings:i,constantValue:o}=r;mD(a,"pad");const s=i.map(((e,t)=>e[0]+a.shape[t]+e[1])),c=i.map((e=>e[0])),u=n.data.get(a.dataId).values,l=ph(a.shape),f=a.shape.length,d=Ah(a.shape),h=ph(s),p=s.length,g=Ah(s),m=Ch(a.dtype,h);0!==o&&m.fill(o);for(let v=0;v<l;v++){m[jh(Bh(v,f,d).map(((e,t)=>e+c[t])),p,g)]=u[v]}return{dataId:n.write(m,s,a.dtype),shape:s,dtype:a.dtype}}},Zz=ID(((e,t)=>Math.pow(e,t))),$z=qD(Zg,Zz),ej={kernelName:Zg,backendName:"cpu",kernelFunc:$z};function tj(e,t,n,r){const[a,i]=Uw(e,r),o=sb(t,"int32"),s=Ph(ph(a),o),c=ph(i);for(let u=0;u<s.length;++u){const e=u*c;let t=1;for(let r=0;r<c;++r)t*=n[e+r];s[u]=t}return{outVals:s,outShape:a,outDtype:o}}const nj={kernelName:em,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:o}=r;mD(a,"prod");const s=a.shape.length,c=wh(i,a.shape),u=Vw(c,s);let l=c,f=a;const d=[];null!=u&&(f=hO({inputs:{x:a},backend:n,attrs:{perm:u}}),d.push(f),l=Yw(l.length,s));const h=n.data.get(f.dataId).values,{outVals:p,outShape:g,outDtype:m}=tj(f.shape,f.dtype,h,l);let v=g;return o&&(v=Ww(g,c)),d.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.makeTensorInfo(v,m,p)}};function rj(e,t,n,r){const a=[];let i=0;const o=t.length-1+n.length,s=new Array(o).fill(null).map((()=>[0]));!function(e,t){for(let n=0;n<e.length;++n){const r=e[n],a=n===e.length-1?t:e[n+1].length;if(0===r.length)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>a)throw new Error("Ragged splits must not point past values");for(let e=1;e<r.length;++e)if(r[e-1]>r[e])throw new Error("Ragged splits must be sorted in ascending order")}}(n,r);let c=1;for(let u=0;u<t.length-1;++u){c*=t[u];const e=t[u+1];for(let t=1;t<c+1;++t)s[u].push(t*e)}for(let u=0;u<e.length;++u){let r=e[u],o=e[u]+1;for(let e=0;e<n.length;++e){const a=n[e],i=e+t.length-1;if(i>=0){const e=s[i],t=e[e.length-1]-a[r];for(let n=r;n<o;++n)s[i].push(a[n+1]+t)}r=a[r],o=a[o]}o!==r&&(a.push([r,o]),i+=o-r)}return{outSplits:s,valueSlices:a,numValues:i}}function aj(e,t){const n=e.slice(0,t);for(;n.length<t;)n.push(1);for(let r=t;r<e.length;r++)n[t-1]*=e[r];return n}function ij(e,t,n,r,a){const i=t.slice();i[0]=a;const o=Mh(n,ph(i)),s=e.length;return function(e,t,n,r,a,i){const o=aj(t,2)[1],s=aj(i,2)[1];let c=0;for(const u of n)for(let t=u[0];t<u[1];++t){for(let n=0;n<r;++n)a[c*s+n]=e[t*o+n];++c}}(e,t,r,0===s?0:s/t[0],o,i),[o,i]}function oj(e,t,n,r,a,i,o,s){if(0===e.length)throw new Error("paramsNestedSplits must be non empty");if(0===t[0].length)throw new Error("Split tensors must not be scalars");if(function(e,t,n){e.forEach(((e,r)=>{if(e<0||e>=n){const a=Bh(r,t.length,Ah(t)).join(",");throw new Error("indices[".concat(a,"] = ").concat(e," is not in [0, ").concat(n,")"))}}))}(i,o,t[0][0]-1),0===r.length)throw new Error("params.rank must be nonzero");const c=r[0],{outSplits:u,valueSlices:l,numValues:f}=rj(i,o,e,c),d=function(e){const t=[];for(let n=0;n<e.length;++n){const r=Mh("int32",e[n].length);t.push(r),e[n].forEach(((e,t)=>r[t]=e))}return t}(u),h=ij(n,r,a,l,f);return[d,h[0],h[1]]}const sj={kernelName:tm,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{paramsNestedSplits:a,paramsDenseValues:i,indices:o}=t,{outputRaggedRank:s}=r,c=a.map((e=>n.data.get(e.dataId).values)),u=a.map((e=>e.shape)),l=n.data.get(i.dataId).values,f=n.data.get(o.dataId).values,[d,h,p]=oj(c,u,l,i.shape,i.dtype,f,o.shape),g=d.map((e=>n.makeTensorInfo([e.length],"int32",e))),m=n.makeTensorInfo(p,i.dtype,h);return g.concat([m])}},cj=2147483647;function uj(e,t,n,r,a,i,o){if(t.length>1)throw new Error("starts must be a scalar or vector");if(a.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const s=0===t.length,c=0===a.length,u=0===o.length,l=[];s||l.push(t[0]),c||l.push(a[0]),u||l.push(o[0]);for(let g=1;g<l.length;++g)if(l[g]!==l[g-1])throw new Error("starts, limits, and deltas must have the same shape");const f=0===l.length?1:l[0],d=Mh("int32",f+1);d[0]=0;for(let g=0;g<f;++g){const t=s?e[0]:e[g],n=c?r[0]:r[g],a=u?i[0]:i[g];if(0===a)throw new Error("Requires delta != 0");let o;if(a>0&&n<t||a<0&&n>t)o=0;else if(o=Math.ceil(Math.abs((n-t)/a)),o>cj)throw new Error("Requires ((limit - start) / delta) <= ".concat(cj));d[g+1]=d[g]+o}const h=Mh(n,d[f]);let p=0;for(let g=0;g<f;++g){const t=d[g+1]-d[g];let n=s?e[0]:e[g];const r=u?i[0]:i[g];for(let e=0;e<t;++e)h[p++]=n,n+=r}return[d,h]}const lj={kernelName:nm,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{starts:r,limits:a,deltas:i}=t,o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,[u,l]=uj(o,r.shape,r.dtype,s,a.shape,c,i.shape);return[n.makeTensorInfo([u.length],"int32",u),n.makeTensorInfo([l.length],r.dtype,l)]}};var fj=XC;class dj{constructor(e,t,n,r,a,i,o,s,c,u){this.shape=e,this.shapeShape=t,this.values=n,this.valuesShape=r,this.valuesDType=a,this.defaultValue=i,this.defaultValueShape=o,this.rowPartitionValues=s,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=KC(u),this.raggedRank=QC(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===fj.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===fj.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case fj.VALUE_ROWIDS:return dj.getMaxWidthValueRowID(t);case fj.ROW_SPLITS:return dj.getMaxWidthRowSplit(t);default:throw new Error("Cannot handle partition type ".concat(fj[this.getRowPartitionTypeByDimension(e-1)]))}}static getMaxWidthRowSplit(e){const t=e.length;if(0===t||1===t)return 0;let n=0;for(let r=0;r<t-1;++r){const t=e[r+1]-e[r];t>n&&(n=t)}return n}static getMaxWidthValueRowID(e){const t=e.length;if(0===t)return 0;let n=0,r=e[0],a=0;for(let i=1;i<t;++i){const t=e[i];t!==r&&(r=t,a=Math.max(i-n,a),n=i)}return Math.max(t-n,a)}tensorShapeFromTensor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(0===t.length){if(-1===e[0])return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return pj(e,n)}calculateOutputSize(e){const t=this.valuesShape;JC(this.defaultValueShape,t);const n=this.tensorShapeFromTensor(this.shape,this.shapeShape),r=qC(this.raggedRank,n,t);r[0]<0&&(r[0]=e);for(let a=1;a<=this.raggedRank;++a)r[a]<0&&(r[a]=this.getMaxWidth(a));return r}calculateFirstParentOutputIndex(e,t,n){const r=Math.min(e,n),a=[];let i=0;for(let o=0;o<r;++o,i+=t)a.push(i);for(let o=r;o<e;++o)a.push(-1);return fh(a.length===e,(()=>"Final length of result must be equal to firstDimension.")),a}calculateOutputIndexRowSplit(e,t,n,r){const a=e.length,i=[];for(let o=0;o<a-1;++o){const a=e[o+1]-e[o];let s=Math.min(r,a),c=t[o];-1===c&&(s=0);for(let e=0;e<s;++e)i.push(c),c+=n;for(let e=0;e<a-s;++e)i.push(-1)}if(a>0&&i.length!==e[a-1])throw new Error("Invalid row split size.");return i}calculateOutputIndexValueRowID(e,t,n,r){const a=e.length,i=[];if(0===a)return[];let o=0,s=e[0];if(s>=t.length)throw new Error("Got currentValueRowId=".concat(s,", which is not less than ").concat(t.length));let c=t[s];i.push(c);for(let u=1;u<a;++u){const a=e[u];if(a===s)c>=0&&(++o,o<r?c+=n:c=-1);else{if(o=0,s=a,a>=t.length)throw new Error("Got nextValueRowId=".concat(a," which is not less than ").concat(t.length));c=t[a]}i.push(c)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}calculateOutputIndex(e,t,n,r){const a=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case fj.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(a,t,n,r);case fj.ROW_SPLITS:if(a.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(a.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(a,t,n,r);default:throw new Error("Unsupported partition type: ".concat(fj[i]))}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(0===this.rowPartitionTypes.length)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case fj.FIRST_DIM_SIZE:return e[0];case fj.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case fj.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(fj[t]))}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const e=this.getFirstDimensionSize(),t=this.calculateOutputSize(e),n=new Array(this.raggedRank+1);n[n.length-1]=1;for(let i=n.length-2;i>=0;--i)n[i]=n[i+1]*t[i+1];const r=pj(t,!1),a=Mh(this.valuesDType,ph(r));if(n[0]*t[0]>0){let i=this.calculateFirstParentOutputIndex(e,n[0],t[0]);for(let e=1;e<=this.raggedRank;++e){i=this.calculateOutputIndex(e-1,i,n[e],t[e])}this.setOutput(this.raggedRank,i,a,r)}return[r,a]}setOutput(e,t,n,r){if(0===n.length)return;const a=this.values,i=n;let o=r.slice();o=o.slice(e+1);const s=ph(o),c=t.length;let u=this.defaultValue;if(u.length!==s&&1!==u.length){const e=this.defaultValueShape;zb((()=>{const t=$x(u,e),n=ow(t,o);u=n.dataSync()}))}let l=0,f=0,d=0;for(let h=0;h<=c;++h){let e=h<c?t[h]:-1;if(e!==d){if(f<d){const e=a.subarray(l*s);hj(i.subarray(f*s),e,(d-f)*s)}if(h>=c){const t=n.length;e=Math.floor(t/s)}if(e>d)if(1===this.defaultValue.length)i.subarray(d*s,e*s).fill(this.defaultValue[0]),d=e;else for(;e>d;){hj(i.slice(d*s),u,s),++d}e<0?(l=h+1,f=d):(l=h,f=d,d=f+1)}else++d}}}function hj(e,t,n){for(let r=0;r<n;r++)e[r]=t[r]}function pj(e,t){const n=[];for(let r of e){if(r<0){if(!t)throw new Error("Dimension ".concat(r," must be >= 0"));if(r<-1)throw new Error("Dimension ".concat(r," must be >= -1"));r=-1}n.push(r)}return n}function gj(e,t,n,r,a,i,o,s,c,u){return new dj(e,t,n,r,a,i,o,s,c,u).compute()}const mj={kernelName:rm,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{shape:a,values:i,defaultValue:o,rowPartitionTensors:s}=t,{rowPartitionTypes:c}=r,u=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,f=n.data.get(o.dataId).values,d=s.map((e=>n.data.get(e.dataId).values)),h=s.map((e=>e.shape)),[p,g]=gj(u,a.shape,l,i.shape,i.dtype,f,o.shape,d,h,c);return n.makeTensorInfo(p,i.dtype,g)}};function vj(e,t,n,r){if(e===t||e<t&&n<0||t<e&&n>1)return Ph(0,r);const a=Ph(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),a[0]=e;for(let i=1;i<a.length;i++)a[i]=a[i-1]+n;return a}const bj={kernelName:am,backendName:"cpu",kernelFunc:function(e){const{backend:t,attrs:n}=e,{start:r,stop:a,dtype:i,step:o}=n,s=vj(r,a,o,i);return t.makeTensorInfo([s.length],i,s)}},yj=xD(om,(e=>1/e)),xj={kernelName:om,backendName:"cpu",kernelFunc:yj};const wj={kernelName:fm,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:i,halfPixelCenters:o,size:s}=r;mD(a,"resizeBilinear");const c=Ah(a.shape),[u,l]=s,[f,d,h,p]=a.shape,g=n.data.get(a.dataId).values,m=new Float32Array(ph([f,u,l,p])),v=[i&&u>1?d-1:d,i&&l>1?h-1:h],b=[i&&u>1?u-1:u,i&&l>1?l-1:l];let y=0;const x=v[0]/b[0],w=v[1]/b[1];for(let S=0;S<f;S++)for(let e=0;e<u;e++){let t;t=o?x*(e+.5)-.5:x*e;const n=Math.max(0,Math.floor(t)),r=t-n,a=Math.min(d-1,Math.ceil(t)),i=S*c[0]+n*c[1],s=S*c[0]+a*c[1];for(let e=0;e<l;e++){let t;t=o?w*(e+.5)-.5:w*e;const n=Math.max(0,Math.floor(t)),a=t-n,u=Math.min(h-1,Math.ceil(t)),l=i+n*c[2],f=s+n*c[2],d=i+u*c[2],v=s+u*c[2];for(let e=0;e<p;e++){const t=g[l+e],n=g[f+e],i=t+(g[d+e]-t)*a,o=i+(n+(g[v+e]-n)*a-i)*r;m[y++]=o}}}return n.makeTensorInfo([f,u,l,p],"float32",m)}};const Sj={kernelName:dm,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:a,dy:i}=t,{alignCorners:o}=r;mD([i,a],"resizeBilinearGrad");const s=Ah(a.shape),[c,u,l,f]=a.shape,[,d,h]=i.shape,p=new Float32Array(c*u*l*f),g=[o&&d>1?u-1:u,o&&h>1?l-1:l],m=[o&&d>1?d-1:d,o&&h>1?h-1:h],v=g[0]/m[0],b=g[1]/m[1],y=n.data.get(i.dataId).values;let x=0;for(let w=0;w<c;w++){const e=w*s[0];for(let t=0;t<d;t++){const n=t*v,r=Math.floor(n),a=Math.min(Math.ceil(n),u-1),i=e+r*s[1],o=e+a*s[1],c=n-r,d=1-c;for(let e=0;e<h;e++){const t=e*b,n=Math.floor(t),r=Math.min(Math.ceil(t),l-1),a=t-n,u=1-a,h=i+n*s[2],g=i+r*s[2],m=o+n*s[2],v=o+r*s[2],w=d*u,S=d*a,C=c*u,M=c*a;for(let e=0;e<f;e++){const t=y[x++];p[h+e]+=t*w,p[g+e]+=t*S,p[m+e]+=t*C,p[v+e]+=t*M}}}}return n.makeTensorInfo([c,l,u,f],"float32",p)}};const Cj={kernelName:um,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:i,halfPixelCenters:o,size:s}=r;mD(a,"resizeNearestNeighbor");const c=Ah(a.shape),[u,l]=s,[f,d,h,p]=a.shape,g=n.data.get(a.dataId).values,m=new Float32Array(f*u*l*p),v=[i&&u>1?d-1:d,i&&l>1?h-1:h],b=[i&&u>1?u-1:u,i&&l>1?l-1:l],y=v[0]/b[0],x=v[1]/b[1];let w=0;for(let S=0;S<f;S++){const e=S*c[0];for(let t=0;t<u;t++){const n=o?y*(t+.5):y*t;let r=Math.min(d-1,i?Math.round(n):Math.floor(n));o&&(r=Math.max(0,r));const a=e+r*c[1];for(let e=0;e<l;e++){const t=o?x*(e+.5):x*e;let n=Math.min(h-1,i?Math.round(t):Math.floor(t));o&&(n=Math.max(0,n));const r=a+n*c[2];for(let e=0;e<p;e++){const t=g[r+e];m[w++]=t}}}}return n.makeTensorInfo([f,u,l,p],a.dtype,m)}};const Mj={kernelName:lm,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:a,dy:i}=t,{alignCorners:o}=r;mD([i,a],"resizeNearestNeighborGrad");const s=Ah(a.shape),c=Ah(i.shape),[u,l,f,d]=a.shape,[,h,p]=i.shape,g=new Float32Array(u*l*f*d),m=n.data.get(i.dataId).values,v=[o&&h>1?l-1:l,o&&p>1?f-1:f],b=[o&&h>1?h-1:h,o&&p>1?p-1:p],y=v[0]/b[0],x=v[1]/b[1],w=1/y,S=1/x,C=2*Math.ceil(w)+2,M=2*Math.ceil(S)+2;for(let _=0;_<u;_++){const e=_*s[0];for(let t=0;t<l;t++){const n=e+t*s[1],r=Math.floor(t*w),a=Math.floor(r-C/2);for(let i=0;i<f;i++){const r=n+i*s[2],u=Math.floor(i*S),v=Math.floor(u-M/2);for(let n=0;n<d;n++){let s=0;for(let r=0;r<C;r++){const u=r+a;if(u<0||u>=h)continue;const d=e+u*c[1],g=u*y;if(t===Math.min(l-1,o?Math.round(g):Math.floor(g)))for(let e=0;e<M;e++){const t=e+v;if(t<0||t>=p)continue;const r=d+t*c[2],a=t*x;i===Math.min(f-1,o?Math.round(a):Math.floor(a))&&(s+=m[r+n])}}g[r+n]=s}}}}return n.makeTensorInfo(a.shape,a.dtype,g)}};const _j={kernelName:pm,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dims:i}=r;mD(a,"reverse");const o=a.shape.length,s=wh(i,a.shape);if(0===o)return MD({inputs:{x:a},backend:n});const c=new qv(a.shape,a.dtype),u=n.bufferSync(a);for(let l=0;l<c.size;l++){const e=c.indexToLoc(l),t=e.slice();s.forEach((e=>t[e]=a.shape[e]-1-t[e])),c.set(u.get(...t),...e)}return n.makeTensorInfo(c.shape,c.dtype,c.values)}},Ej={kernelName:av,backendName:"cpu",kernelFunc:e=>{let{inputs:t,attrs:n,backend:r}=e;const{image:a}=t,{radians:i,fillValue:o,center:s}=n,c=r,u=Ch(a.dtype,ph(a.shape)),[l,f,d,h]=a.shape,[p,g]=eM(s,f,d),m=Math.sin(i),v=Math.cos(i),b=c.data.get(a.dataId).values;for(let y=0;y<l;y++){const e=y*d*f*h;for(let t=0;t<f;t++){const n=t*(d*h);for(let r=0;r<d;r++){const a=r*h;for(let i=0;i<h;i++){const s=[l,t,r,i],c=s[2],y=s[1];let x=(c-p)*v-(y-g)*m,w=(c-p)*m+(y-g)*v;x=Math.round(x+p),w=Math.round(w+g);let S=o;if("number"!==typeof o&&(S=3===i?255:o[i]),x>=0&&x<d&&w>=0&&w<f){S=b[e+w*(d*h)+x*h+i]}u[e+n+a+i]=S}}}}return{dataId:c.write(u,a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},Tj=xD(gm,(e=>{const t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2===0?t:t+1})),Ij={kernelName:gm,backendName:"cpu",kernelFunc:Tj},kj=yD((e=>1/Math.sqrt(e))),Nj=wD(mm,kj),Lj={kernelName:mm,backendName:"cpu",kernelFunc:Nj};function Aj(e,t,n,r,a,i,o,s,c,u){const l=[r/a,a],f=e.values,d=t.values;if(0===r)return Ty(n,t.dtype);const h=c instanceof qv?c:Ty(l,t.dtype);"string"===typeof c||"number"===typeof c?h.values.fill(c):"boolean"===typeof c&&h.values.fill(+c);for(let p=0;p<i;p++){const e=[];let i=0;for(let t=0;t<o;t++){const n=f[p*o+t];e.push(n),i+=n*s[t]}if(i<0||i>=r/a)throw new Error("Invalid indices: ".concat(e," does not index into ").concat(n));for(let n=0;n<a;n++)u?h.values[i*a+n]+=d[p*a+n]:h.values[i*a+n]=0===t.rank?d[0]:d[p*a+n]}return h}const Rj={kernelName:vm,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{indices:a,updates:i}=t,{shape:o}=r,{sliceRank:s,numUpdates:c,sliceSize:u,strides:l,outputSize:f}=uM(0,a,o),d=Aj(n.bufferSync(a),n.bufferSync(i),o,f,u,c,s,l,0,!0);return n.makeTensorInfo(o,d.dtype,d.values)}};function Dj(e,t){let n=0,r=e.length,a=0;for(;n<r;)a=Math.floor((n+r)/2),e[a]<t?n=a+1:r=a;return r}function Oj(e,t){let n=0,r=e.length,a=0;for(;n<r;)a=Math.floor((n+r)/2),e[a]<=t?n=a+1:r=a;return r}const Pj={kernelName:ym,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{sortedSequence:a,values:i}=t,{side:o}=r,s=function(e,t,n,r,a,i){const o=Mh("int32",n*a);for(let s=0;s<n;++s){const n=e.slice(s*r,(s+1)*r),c=s*a;for(let e=0;e<a;++e)o[c+e]="left"===i?Dj(n,t[e+c]):Oj(n,t[e+c])}return o}(n.data.get(a.dataId).values,n.data.get(i.dataId).values,a.shape[0],a.shape[1],i.shape[1],o);return n.makeTensorInfo(i.shape,"int32",s)}};const Fj={kernelName:xm,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{condition:r,t:a,e:i}=t;mD([r,a,i],"select");const o=r.shape.length,s=n.data.get(r.dataId).values,c=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,l=sb(a.dtype,i.dtype),f=Ph(ph(a.shape),l);let d=0;const h=0===o||o>1||1===a.shape.length?1:ph(a.shape.slice(1));for(let p=0;p<s.length;p++)for(let e=0;e<h;e++)1===s[p]?f[d++]=c[p]:f[d++]=u[p];return n.makeTensorInfo(a.shape,l,f)}},zj=lM,jj=fM,Bj=xD(wm,(e=>e>=0?jj*e:zj*(Math.exp(e)-1))),Uj={kernelName:wm,backendName:"cpu",kernelFunc:Bj},Wj=xD(_m,(e=>e<0?-1:e>0?1:0)),Gj={kernelName:_m,backendName:"cpu",kernelFunc:Wj},Vj=xD(Cm,(e=>Math.sin(e))),Hj={kernelName:Cm,backendName:"cpu",kernelFunc:Vj},Yj=xD(Mm,(e=>Math.sinh(e))),Xj={kernelName:Mm,backendName:"cpu",kernelFunc:Yj},qj=Math.log(1.1920928955078125e-7)+2,Kj=xD(Tm,(e=>{const t=e>-qj,n=e<qj,r=Math.exp(e);let a;return a=n?r:t?e:Math.log(1+r),a})),Qj={kernelName:Tm,backendName:"cpu",kernelFunc:Kj};const Jj={kernelName:Nm,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:i,paddings:o}=r;mD([a],"spaceToBatchND");const s=ph(i),c=[[0,0]];c.push(...o);for(let m=1+i.length;m<a.shape.length;++m)c.push([0,0]);const u=Jz.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:c,constantValue:0}}),l=tM(u.shape,i,s,!1),f=nM(l.length,i.length,!1),d=rM(u.shape,i,s,!1),h=eO({inputs:{x:u},backend:n,attrs:{shape:l}}),p=hO({inputs:{x:h},backend:n,attrs:{perm:f}}),g=eO({inputs:{x:p},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),g}};function Zj(e,t,n,r,a,i,o){const s=t[0],c=i[0],u=new Array(c),l=new Array(s),f=t[1];if(0===c){if(0!==s)throw new Error(FM(s));return[Mh(n,0),[0,f],Mh(a,0),u,l]}let d=!0,h=0;const p=new Array(c).fill(0);for(let m=0;m<s;++m){const t=e[m*f];if(t<0)throw new Error(zM(m,t));if(t>=c)throw new Error(jM(m,t,c));++p[t],d=d&&t>=h,h=t}let g=!0;for(let m=0;m<c;++m){const e=0===p[m];u[m]=e,g=g&&!e,p[m]=Math.max(p[m],1),m>0&&(p[m]+=p[m-1])}if(g&&d){const t=e,n=r;for(let e=0;e<s;++e)l[e]=e;return[t,[s,f],n,u,l]}{const t=p[c-1],i=Mh(n,t*f),d=Mh(a,t),h=new Array(c).fill(0);for(let n=0;n<s;++n){const t=e[n*f],a=h[t],o=(0===t?0:p[t-1])+a;h[t]++;for(let r=0;r<f;++r)i[o*f+r]=e[n*f+r];d[o]=r[n],l[n]=o}for(let e=0;e<c;++e){if(0===h[e]){const t=0===e?0:p[e-1];i[t*f+0]=e;for(let e=1;e<f;++e)i[t*f+e]=0;d[t]=o}}return[i,[t,f],d,u,l]}}const $j={kernelName:Rm,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{indices:r,values:a,denseShape:i,defaultValue:o}=t;if(1!==i.shape.length)throw new Error("Dense shape must be a vector, saw:\n        ".concat(i.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n        ".concat(a.shape));if(0!==o.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(o.shape));const s=n.data.get(r.dataId).values,c=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,l=n.data.get(o.dataId).values[0],[f,d,h,p,g]=Zj(s,r.shape,r.dtype,c,a.dtype,u,l);return[n.makeTensorInfo(d,r.dtype,f),n.makeTensorInfo([d[0]],a.dtype,h),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map((e=>Number(e))))),n.makeTensorInfo([g.length],r.dtype,new Int32Array(g))]}};function eB(e,t,n,r,a){const i=ph(r),o=t[0],s=a.length,c=[];let u=1,l=-1;for(let g=0;g<s;++g){const e=a[g];if(-1===e){if(-1!==l)throw new Error(BM(l,g));l=g,c.push(1)}else{if(e<0)throw new Error(UM(g,e));u*=e,c.push(e)}}if(-1!==l){if(u<=0)throw new Error("reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero");const e=Math.trunc(i/u);if(u*e!==i)throw new Error(GM(r,c));c[l]=e}if(ph(c)!==i)throw new Error(VM(r,c));const f=r.length,d=[];if(f>0){d[f-1]=1;for(let e=f-2;e>=0;--e)d[e]=d[e+1]*r[e+1]}const h=[];if(s>0){h[s-1]=1;for(let e=s-2;e>=0;--e)h[e]=h[e+1]*c[e+1]}const p=Mh(n,o*s);for(let g=0;g<o;++g){let t=0;for(let n=0;n<f;++n)t+=e[g*f+n]*d[n];for(let e=0;e<s;++e)p[g*s+e]=Math.trunc(t/h[e]),t%=h[e]}return[p,[o,s],c]}const tB={kernelName:Dm,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{inputIndices:r,inputShape:a,newShape:i}=t;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape\n        ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));const o=Array.from(n.data.get(a.dataId).values),s=n.data.get(r.dataId).values,c=Array.from(n.data.get(i.dataId).values),[u,l,f]=eB(s,r.shape,r.dtype,o,c);return[n.makeTensorInfo(l,r.dtype,u),n.makeTensorInfo([f.length],i.dtype,new Int32Array(f))]}};function nB(e,t,n,r,a){let i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const s=r.length,c=[t[0],e.length/t[0]],u=c[1],l=s>0?a[s-1]+1:0;if(l<0)throw new Error("segment ids must be >= 0");const f=t.slice();f[0]=l;const d=f.reduce(((e,t)=>e*t),1),h=Mh(n,d);if(0===s)return l>0&&h.fill(o),[h,f];if(l<=0)throw new Error("segment ids must be >= 0");let p=0,g=1,m=0,v=a[p];for(;;){let t=0;if(g<s){if(t=a[g],v===t){++g;continue}if(v>=t)throw new Error("segment ids are not increasing")}if(v<0||v>=l)throw new Error(XM(v,l));v>m&&h.fill(o,m*u,v*u);for(let n=p;n<g;++n){const t=r[n];if(t<0||t>=c[0])throw new Error(qM(n,r[n],c[0]));for(let n=0;n<u;n++)h[v*u+n]+=e[t*u+n]}if(i)for(let e=0;e<u;e++)h[v*u+e]/=g-p;if(p=g,++g,m=v+1,v=t,g>s)break}return m<l&&h.fill(o,m*u,l*u),[h,f]}const rB={kernelName:Om,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:r,indices:a,segmentIds:i}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n          ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n          ".concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,[u,l]=nB(o,r.shape,r.dtype,s,c,!0);return n.makeTensorInfo(l,r.dtype,u)}};const aB={kernelName:Pm,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:r,indices:a,segmentIds:i}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n         ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n         ".concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,[u,l]=nB(o,r.shape,r.dtype,s,c);return n.makeTensorInfo(l,r.dtype,u)}};const iB={kernelName:Fm,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{sparseIndices:a,sparseValues:i,defaultValue:o}=t,{outputShape:s}=r,{sliceRank:c,numUpdates:u,sliceSize:l,strides:f,outputSize:d}=uM(0,a,s),h=!1,p=n.bufferSync(a);let g;switch(i.dtype){case"bool":g=Aj(p,n.bufferSync(i),s,d,l,u,c,f,Boolean(n.data.get(o.dataId).values[0]),h);break;case"float32":g=Aj(p,n.bufferSync(i),s,d,l,u,c,f,n.data.get(o.dataId).values[0],h);break;case"int32":g=Aj(p,n.bufferSync(i),s,d,l,u,c,f,n.data.get(o.dataId).values[0],h);break;case"string":g=Aj(p,n.bufferSync(i),s,d,l,u,c,f,Fv(n.data.get(o.dataId).values[0]),h);break;default:throw new Error("Unsupported type ".concat(i.dtype))}return n.makeTensorInfo(s,g.dtype,g.values)}};const oB={kernelName:Lm,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{numOrSizeSplits:i,axis:o}=r,s=wh(o,a.shape)[0],c=PM(a,i,s),u=new Array(a.shape.length).fill(0),l=a.shape.slice();return c.map((e=>{const t=[...l];t[s]=e;const r=jO({inputs:{x:a},backend:n,attrs:{begin:u,size:t}});return u[s]+=e,r}))}},sB=yD((e=>Math.sqrt(e))),cB=xD(Im,(e=>Math.sqrt(e))),uB={kernelName:Im,backendName:"cpu",kernelFunc:cB},lB={kernelName:jm,backendName:"cpu",kernelFunc:e=>{let{inputs:t,backend:n}=e;const{x:r}=t,a=n;mD(r,"square");const i=a.data.get(r.dataId).values,o=new Float32Array(i.length);for(let s=0;s<i.length;++s){const e=i[s];o[s]=e*e}return{dataId:a.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},fB=ID(((e,t)=>{const n=e-t;return n*n})),dB=qD(zm,fB),hB={kernelName:zm,backendName:"cpu",kernelFunc:dB},pB=yD(((e,t)=>{const{pattern:n,replaceGlobal:r,rewrite:a}=t;return e.replace(new RegExp(n,r?"g":""),a)})),gB=wD(Bm,pB),mB={kernelName:Bm,backendName:"cpu",kernelFunc:gB},vB=xD(nv,((e,t)=>{const n=t;return isNaN(e)?NaN:e>0?1:n.alpha})),bB={kernelName:nv,backendName:"cpu",kernelFunc:vB};function yB(e,t,n,r){const a=Ty(e,t.dtype);for(let i=0;i<a.size;i++){const e=a.indexToLoc(i),o=new Array(e.length);for(let t=0;t<o.length;t++)o[t]=e[t]*n[t]+r[t];a.set(t.get(...o),...e)}return a}const xB={kernelName:Um,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:i,end:o,strides:s,beginMask:c,endMask:u,ellipsisMask:l,newAxisMask:f,shrinkAxisMask:d}=r;mD(a,"stridedSlice");const{finalShapeSparse:h,finalShape:p,isIdentity:g,sliceDim0:m,isSimpleSlice:v,begin:b,end:y,strides:x}=Rx(a.shape,i,o,s,c,u,l,f,d);let w;if(g)w=eO({inputs:{x:a},backend:n,attrs:{shape:p}});else if(m||v){fh(a.shape.length>=1,(()=>"Input must have rank at least 1, got: ".concat(a.shape.length)));const e=xx(b,y,x),t=jO({inputs:{x:a},backend:n,attrs:{begin:b,size:e}});w=eO({inputs:{x:t},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(t)}else{const e=yB(h,n.bufferSync(a),x,b);w=n.makeTensorInfo(p,e.dtype,e.values)}return w}};class wB{constructor(e,t,n,r,a,i){this.separator=Pv(e),this.nGramWidths=t,this.leftPad=Pv(n),this.rightPad=Pv(r),this.padWidth=a,this.preserveShort=i}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}createNGrams(e,t,n,r,a,i){for(let o=0;o<a;++o){const s=this.getPadWidth(i),c=Math.max(0,s-o),u=Math.max(0,s-(a-(o+1))),l=i-(c+u),f=t+(c>0?0:o-s);let d=0;d+=c*this.leftPad.length;for(let t=0;t<l;++t)d+=e[f+t].length;d+=u*this.rightPad.length;d+=(c+u+l-1)*this.separator.length,n[r+o]=new Uint8Array(d);const h=n[r+o];let p=0;const g=e=>e.forEach((e=>h[p++]=e));for(let e=0;e<c;++e)g(this.leftPad),g(this.separator);for(let t=0;t<l-1;++t)g(e[f+t]),g(this.separator);if(l>0){g(e[f+l-1]);for(let e=0;e<u;++e)g(this.separator),g(this.rightPad)}else{for(let e=0;e<u-1;++e)g(this.rightPad),g(this.separator);g(this.rightPad)}}}compute(e,t){const n=e.length,r=t.length;if(r>0){let e=t[0];if(0!==e)throw new Error("First split value must be 0, got ".concat(e));for(let a=1;a<r;++a){let r=t[a]>=e;if(r=r&&t[a]<=n,!r)throw new Error("Invalid split value ".concat(t[a],", must be in [").concat(e,", ").concat(n,"]"));e=t[a]}if(e!==n)throw new Error("Last split value must be data size. Expected ".concat(n,", got ").concat(e))}const a=r-1,i=Mh("int32",r);if(0===n||0===r){const e=new Array(n);for(let t=0;t<=a;++t)i[t]=0;return[e,i]}i[0]=0;for(let s=1;s<=a;++s){const e=t[s]-t[s-1];let n=0;this.nGramWidths.forEach((t=>{n+=this.getNumNGrams(e,t)})),this.preserveShort&&e>0&&0===n&&(n=1),i[s]=i[s-1]+n}const o=new Array(i[a]);for(let s=0;s<a;++s){const n=t[s];let r=i[s];if(this.nGramWidths.forEach((a=>{const i=t[s+1]-t[s],c=this.getNumNGrams(i,a);this.createNGrams(e,n,o,r,c,a),r+=c})),this.preserveShort&&r===i[s]){const a=t[s+1]-t[s];if(0===a)continue;const i=a+2*this.padWidth,c=1;this.createNGrams(e,n,o,r,c,i)}}return[o,i]}}function SB(e,t,n,r,a,i,o,s){return new wB(n,r,a,i,o,s).compute(e,t)}const CB={kernelName:Wm,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{separator:a,nGramWidths:i,leftPad:o,rightPad:s,padWidth:c,preserveShortSequences:u}=r,{data:l,dataSplits:f}=t,d=n.data.get(l.dataId).values,h=n.data.get(f.dataId).values,[p,g]=SB(d,h,a,i,o,s,c,u);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(f.shape,"int32",g)]}};function MB(e,t,n,r){if(!e.length)return;if(0===t.length){for(let t=0;t<e.length;++t)r.push(e.subarray(t,t+1));return}if(1===t.length){const a=t[0];let i=e.indexOf(a);for(;-1!==i;){const t=e.subarray(0,i);n&&0===t.length||r.push(t),i=(e=e.subarray(i+1)).indexOf(a)}return void(n&&0===e.length||r.push(e))}let a=0;for(let i=0;i<e.length+1;i++)if(i===e.length||-1!==t.indexOf(e[i])){const t=e.subarray(a,i);n&&0===t.length||r.push(t),a=i+1}}function _B(e,t,n){const r=e.length,a=[];let i=0,o=0;const s=new Array(r);for(let d=0;d<r;++d){const r=a.length;MB(e[d],t,n,a);const c=a.length-r;s[d]=c,i+=c,o=Math.max(o,c)}const c=Mh("int32",2*i),u=new Array(i),l=[r,o];let f=0;for(let d=0;d<r;++d)for(let e=0;e<s[d];++e)c[2*f]=d,c[2*f+1]=e,u[f]=a[f],++f;return[c,u,l]}const EB={kernelName:Gm,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{skipEmpty:a}=r,{input:i,delimiter:o}=t;if("string"!==i.dtype)throw new Error("Input must be of datatype string");if(1!==i.shape.length)throw new Error("Input must be a vector, got shape: ".concat(i.shape));if(0!==o.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(o.shape));const s=n.data.get(i.dataId).values,c=n.data.get(o.dataId).values[0],[u,l,f]=_B(s,c,a),d=l.length;return[n.makeTensorInfo([d,2],"int32",u),n.makeTensorInfo([d],"string",l),n.makeTensorInfo([2],"int32",new Int32Array(f))]}};function TB(e,t){const n=Mh("int32",e.length);for(let r=0;r<e.length;++r)n[r]=Av(e[r]).modulo(t).getLowBitsUnsigned();return n}const IB={kernelName:Vm,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{numBuckets:a}=r,{input:i}=t;if("string"!==i.dtype)throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");const o=TB(n.data.get(i.dataId).values,a);return n.makeTensorInfo(i.shape,"int32",o)}},kB=xD(Ym,(e=>Math.tan(e))),NB={kernelName:Ym,backendName:"cpu",kernelFunc:kB},LB=xD(Xm,(e=>Math.tanh(e)));const AB={kernelName:bm,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{tensor:r,indices:a,updates:i}=t,{sliceRank:o,numUpdates:s,sliceSize:c,strides:u,outputSize:l}=uM(0,a,r.shape),f=n.bufferSync(a),d=n.bufferSync(i),h=n.bufferSync(r),p=Aj(f,d,r.shape,l,c,s,o,u,h,!1);return n.makeTensorInfo(r.shape,p.dtype,p.values)}};function RB(e,t){const n=new Array(e.rank);for(let a=0;a<n.length;a++)n[a]=e.shape[a]*t[a];const r=Ty(n,e.dtype);for(let a=0;a<r.values.length;++a){const t=r.indexToLoc(a),n=new Array(e.rank);for(let r=0;r<n.length;r++)n[r]=t[r]%e.shape[r];const i=e.locToIndex(n);r.values[a]=e.values[i]}return r}const DB={kernelName:qm,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reps:i}=r;mD(a,"tile");const o=RB(n.bufferSync(a),i);return n.makeTensorInfo(o.shape,o.dtype,o.values)}},OB=(e,t)=>{const n=t.value-e.value;return 0===n?e.index-t.index:n};function PB(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length-1;for(;r>n;){if(r-n>600){const a=r-n+1,i=t-n+1,o=Math.log(a),s=.5*Math.exp(2*o/3),c=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2);PB(e,t,Math.max(n,Math.floor(t-i*s/a+c)),Math.min(r,Math.floor(t+(a-i)*s/a+c)))}const a=e[t];let i=n,o=r;for(lh(e,n,t),OB(e[r],a)>0&&lh(e,n,r);i<o;){for(lh(e,i,o),i++,o--;OB(e[i],a)<0;)i+=1;for(;OB(e[o],a)>0;)o-=1}0===OB(e[n],a)?lh(e,n,o):(o+=1,lh(e,o,r)),o<=t&&(n=o+1),t<=o&&(r=o-1)}}function FB(e,t,n,r,a){const i=t[t.length-1],[o,s]=[e.length/i,i],c=Ch(n,o*r),u=Ch("int32",o*r);for(let f=0;f<o;f++){const t=f*s,n=e.subarray(t,t+s);let i=new Array(n.length);n.forEach(((e,t)=>i[t]={value:e,index:t})),r<i.length&&(PB(i,r),i=i.slice(0,r)),a&&i.sort(OB);const o=f*r,l=c.subarray(o,o+r),d=u.subarray(o,o+r);for(let e=0;e<r;e++)l[e]=i[e].value,d[e]=i[e].index}const l=t.slice();return l[l.length-1]=r,[Ty(l,n,c),Ty(l,"int32",u)]}const zB={kernelName:Km,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{k:i,sorted:o}=r;mD(a,"topk");const s=n.data.get(a.dataId).values,[c,u]=FB(s,a.shape,a.dtype,i,o);return[n.makeTensorInfo(c.shape,c.dtype,c.values),n.makeTensorInfo(u.shape,u.dtype,u.values)]}};const jB={kernelName:Qm,backendName:"cpu",kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,{image:a,transforms:i}=t,{interpolation:o,fillMode:s,fillValue:c,outputShape:u}=n,[l,f,d,h]=a.shape,[p,g]=null!=u?u:[f,d],m=[l,p,g,h],v=Ah(a.shape),b=v[0],y=v[1],x=v[2],w=Ah(m),S=w[0],C=w[1],M=w[2],_=Ch(a.dtype,ph(m));_.fill(c);const E=r.data.get(a.dataId).values,T=r.data.get(i.dataId).values;for(let I=0;I<l;++I){const e=1===i.shape[0]?T:T.subarray(8*I,8*I+8);for(let t=0;t<p;++t)for(let n=0;n<g;++n)for(let r=0;r<h;++r){let a;const i=e[6]*n+e[7]*t+1;if(0===i)continue;const u=(e[0]*n+e[1]*t+e[2])/i,l=(e[3]*n+e[4]*t+e[5])/i,h=BB(u,d,s),p=BB(l,f,s);switch(o){case"nearest":a=WB(E,f,d,b,y,x,I,p,h,r,c);break;case"bilinear":a=GB(E,f,d,b,y,x,I,p,h,r,c);break;default:throw new Error("Error in Transform: Expect 'nearest' or "+"'bilinear', but got ".concat(o))}_[I*S+t*C+n*M+r]=a}return r.makeTensorInfo(m,a.dtype,_)}return{dataId:r.write(_,m,a.dtype),shape:a.shape,dtype:a.dtype}}};function BB(e,t,n){switch(n){case"reflect":return function(e,t){let n=e;if(n<0)if(t<=1)n=0;else{const e=2*t;n<e&&(n=e*Math.trunc(-n/e)+n),n=n<-t?n+e:-n-1}else if(n>t-1)if(t<=1)n=0;else{const e=2*t;n-=e*Math.trunc(n/e),n>=t&&(n=e-n-1)}return ch(0,n,t-1)}(e,t);case"wrap":return function(e,t){let n=e;if(n<0)if(t<=1)n=0;else{const e=t-1;n+=t*(Math.trunc(-n/e)+1)}else if(n>t-1)if(t<=1)n=0;else{const e=t-1;n-=t*Math.trunc(n/e)}return ch(0,n,t-1)}(e,t);case"nearest":return function(e,t){return ch(0,e,t-1)}(e,t);default:return function(e){return e}(e)}}function UB(e,t,n,r,a,i,o,s,c,u,l){return 0<=s&&s<t&&0<=c&&c<n?e[o*r+s*a+c*i+u]:l}function WB(e,t,n,r,a,i,o,s,c,u,l){return UB(e,t,n,r,a,i,o,Math.round(s),Math.round(c),u,l)}function GB(e,t,n,r,a,i,o,s,c,u,l){const f=Math.floor(s),d=Math.floor(c),h=f+1,p=d+1;return(h-s)*((p-c)*UB(e,t,n,r,a,i,o,f,d,u,l)+(c-d)*UB(e,t,n,r,a,i,o,f,p,u,l))+(s-f)*((p-c)*UB(e,t,n,r,a,i,o,h,d,u,l)+(c-d)*UB(e,t,n,r,a,i,o,h,p,u,l))}function VB(e,t,n,r){const a=wh(t,n)[0],i=[1,n[0],1];for(let p=0;p<a;p++)i[0]*=n[p];i[1]=n[a];for(let p=a+1;p<n.length;p++)i[2]*=n[p];const o=new Map,s=new Int32Array(n[a]),c=new qv(i,r,e),u=[],l=1===i[0]&&1===i[2];for(let p=0;p<n[a];p++){let t;if(l)t=e[p].toString();else{const e=[];for(let t=0;t<i[0];t++)for(let n=0;n<i[2];n++)e.push(c.get(t,p,n));t=e.join(",")}const n=o.get(t);if(null!=n)s[p]=n;else{const e=o.size;o.set(t,e),s[p]=e,u.push(p)}}const f=i.slice();f[1]=o.size;const d=new qv(f,r);u.forEach(((e,t)=>{for(let n=0;n<i[0];n++)for(let r=0;r<i[2];r++)d.set(c.get(n,e,r),n,t,r)}));const h=n.slice();return h[a]=f[1],{outputValues:d.values,outputShape:h,indices:s}}const HB={kernelName:Zm,backendName:"cpu",kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,{axis:a}=n,{x:i}=t;mD(i,"unique");const o=r.data.get(i.dataId).values,{outputValues:s,outputShape:c,indices:u}=VB(o,a,i.shape,i.dtype);return[r.makeTensorInfo(c,i.dtype,s),r.makeTensorInfo([u.length],"int32",u)]}};const YB={kernelName:$m,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{value:a}=t;let{axis:i}=r;i<0&&(i+=a.shape.length);const o=a.shape.length,s=a.shape[i],c=new Array(o-1);let u=0;for(let h=0;h<o;h++)h!==i&&(c[u++]=a.shape[h]);const l=new Array(o).fill(0),f=a.shape.slice();f[i]=1;const d=new Array(s);for(let h=0;h<d.length;h++){l[i]=h;const e=jO({inputs:{x:a},backend:n,attrs:{begin:l,size:f}});d[h]=eO({inputs:{x:e},backend:n,attrs:{shape:c}}),n.disposeIntermediateTensorInfo(e)}return d}};const XB={kernelName:ev,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,segmentIds:i}=t,{numSegments:o}=r;mD(a,"unsortedSegmentSum");const s=[],c=[],u=a.shape.length-i.shape.length;let l=i;for(let d=0;d<u;++d){const e=ZP({inputs:{input:l},backend:n,attrs:{dim:d+1}});l=e,c.push(e)}for(let d=0;d<o;++d){const e=Rv(d,"int32"),t=n.makeTensorInfo([],"int32",e),r=jP({inputs:{a:t,b:l},backend:n}),i=YD({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),o=AP({inputs:{a:i,b:a},backend:n}),u=DP({inputs:{x:o},backend:n,attrs:{axis:0,keepDims:!1}});s.push(u),c.push(t),c.push(r),c.push(i),c.push(o),c.push(u)}const f=Kz({inputs:s,backend:n,attrs:{axis:0}});return c.forEach((e=>n.disposeIntermediateTensorInfo(e))),f}},qB=[aO,oO,cO,lO,$D,fO,gO,mO,vO,bO,xO,SO,MO,TO,kO,RO,DO,OO,PO,rO,FO,UO,VO,YO,XO,XD,QO,ZO,UD,$O,aP,oP,sP,cP,uP,lP,fP,hP,gP,mP,vP,bP,yP,xP,SP,CP,MP,_P,EP,TP,IP,kP,PP,CD,FP,BP,qP,JP,$P,nF,hF,gF,mF,yF,SF,CF,MF,EF,IF,LF,DF,_D,OF,nP,FF,jF,UF,TD,VF,XF,KF,ZF,ez,rz,iz,cz,uz,lz,hz,mz,vz,bz,yz,xz,wz,Sz,Cz,Ez,Tz,Nz,Rz,RP,Oz,Fz,jz,Uz,Vz,Hz,qz,Qz,Jz,ej,LD,nj,sj,lj,mj,bj,VD,iF,xj,RD,OD,tO,wj,Sj,Cj,Mj,_j,Ej,Ij,Lj,Rj,Pj,Fj,Uj,zD,Gj,Hj,Xj,BO,Az,Qj,Jj,$j,tB,rB,aB,iB,oB,uB,lB,hB,mB,bB,xB,CB,EB,IB,uF,OP,NB,{kernelName:Xm,backendName:"cpu",kernelFunc:LB},AB,DB,zB,jB,pO,HB,YB,XB,Xz];for(const n of qB)gv(n);const KB={},QB={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function JB(e,t){if(!(e in KB)||null!=t){const n=function(e,t){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=null==t?function(e){if(Hh().getBool("IS_SAFARI")||"undefined"===typeof OffscreenCanvas||2!==e){if("undefined"!==typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}return new OffscreenCanvas(300,150)}(e):t;n.addEventListener("webglcontextlost",(t=>{t.preventDefault(),delete KB[e]}),!1),Hh().getBool("SOFTWARE_WEBGL_ENABLED")&&(QB.failIfMajorPerformanceCaveat=!1);if(1===e)return n.getContext("webgl",QB)||n.getContext("experimental-webgl",QB);return n.getContext("webgl2",QB)}(e,t);if(null===n)return console.log("Could not get context for WebGL version",e),null;KB[e]=n}const n=KB[e];return null==n||n.isContextLost()?(delete KB[e],JB(e)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),KB[e])}var ZB,$B,eU;function tU(e,t){return[t,e]}function nU(e){const t=ph(e);return vh(Math.ceil(t/4))}function rU(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function aU(e,t){const n=e;let r,a,i,o,s,c,u,l,f,d;return 2===Hh().getNumber("WEBGL_VERSION")?(r=n.R32F,a=n.R16F,i=n.RGBA16F,o=n.RGBA32F,s=n.RED,u=4,l=1,f=n.HALF_FLOAT,d=n.FLOAT,c=n.RGBA8):(r=e.RGBA,a=e.RGBA,i=e.RGBA,o=n.RGBA,s=e.RGBA,u=4,l=4,f=null!=t?t.HALF_FLOAT_OES:null,d=e.FLOAT,c=e.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:a,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:s,downloadTextureFormat:c,downloadUnpackNumChannels:u,defaultNumChannels:l,textureTypeHalfFloat:f,textureTypeFloat:d}}function iU(e,t){const n=t();return Hh().getBool("DEBUG")&&function(e){const t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+function(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(t)}}(e,t))}(e),n}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(ZB||(ZB={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}($B||($B={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(eU||(eU={}));function oU(e){return!!(Hh().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function sU(e,t){return mU(e,(()=>e.getExtension(t)),'Extension "'+t+'" not supported on this browser.')}const cU=/ERROR: [0-9]+:([0-9]+):/g;function uU(e,t){const n=cU.exec(t);if(null==n)return console.log("Couldn't parse line number in error: ".concat(t)),void console.log(e);const r=+n[1],a=e.split("\n"),i=a.length.toString().length+2,o=a.map(((e,t)=>bh((t+1).toString(),i)+e));let s=0;for(let f=0;f<o.length;f++)s=Math.max(o[f].length,s);const c=o.slice(0,r-1),u=o.slice(r-1,r),l=o.slice(r);console.log(c.join("\n")),console.log(t.split("\n")[0]),console.log("%c ".concat(bh(u[0],s)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(l.join("\n"))}function lU(e,t){if(iU(e,(()=>e.validateProgram(t))),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function fU(e,t,n,r,a,i,o){const s=e.getAttribLocation(t,n);return-1!==s&&(iU(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,r))),iU(e,(()=>e.vertexAttribPointer(s,a,e.FLOAT,!1,i,o))),iU(e,(()=>e.enableVertexAttribArray(s))),!0)}function dU(e,t,n,r){iU(e,(()=>function(e,t,n){vU(e,n),iU(e,(()=>e.activeTexture(e.TEXTURE0+n))),iU(e,(()=>e.bindTexture(e.TEXTURE_2D,t)))}(e,t,r))),iU(e,(()=>e.uniform1i(n,r)))}function hU(e,t,n){iU(e,(()=>e.bindFramebuffer(e.FRAMEBUFFER,n))),iU(e,(()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)))}function pU(e,t){iU(e,(()=>e.bindFramebuffer(e.FRAMEBUFFER,t))),iU(e,(()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)))}function gU(e){const t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(t)}}(e,t))}function mU(e,t,n){const r=iU(e,(()=>t()));if(null==r)throw new Error(n);return r}function vU(e,t){const n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n){const e="[gl.TEXTURE0, gl.TEXTURE".concat(n,"]");throw new Error("textureUnit must be in ".concat(e,"."))}}function bU(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return ph(e.slice(0,e.length-t))}function yU(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function xU(e){let t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[bU(e),...yU(e)]),t}function wU(e){return e%2===0}function SU(e,t){if(gh(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){const n=e[e.length-1],r=t[t.length-1];if(n===r)return!0;if(wU(n)&&wU(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&wU(e[0])&&wU(t[0])}let CU,MU;function _U(e,t){return null!=e.getExtension(t)}function EU(e){try{if(null!=JB(e))return!0}catch(IQ){return console.log("Error when getting WebGL context: ",IQ),!1}return!1}function TU(e){if(0===e)return!1;const t=JB(e);if(1!==e){if(_U(t,"EXT_color_buffer_float"))return IU(t);const e="EXT_color_buffer_half_float";if(_U(t,e)){const n=t.getExtension(e);return function(e,t){const n=aU(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);const a=1,i=1;e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,a,i,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const o=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);const s=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(o),s}(t,n)}return!1}if(!_U(t,"OES_texture_float"))return!1;if(!_U(t,"WEBGL_color_buffer_float"))return!1;return IU(t)}function IU(e){const t=aU(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);const r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);const a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function kU(e,t){Array.isArray(e)||(e=[e]),e.forEach((e=>{null!=e&&fh("complex64"!==e.dtype,(()=>"".concat(t," does not support complex64 tensors ")+"in the WebGL backend."))}))}const NU=Hh();function LU(){let e,t,n,r,a,i,o,s,c,u;return 2===Hh().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",i="outputColor",o="out vec4 outputColor;",s=Hh().getBool("WEBGL2_ISNAN_CUSTOM")?"\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ":"",c="",u="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",i="gl_FragColor",o="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",c="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",u="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:c,defineRound:u}}function AU(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index";const r=Ah(t);return r.map(((t,a)=>{const i="int ".concat(e[a]," = ").concat(n," / ").concat(t),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * ").concat(t):"index -= ".concat(e[a]," * ").concat(t);return"".concat(i,"; ").concat(o,";")})).join("")}function RU(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index";const r=Ah(t);return r.map(((t,a)=>{const i="int ".concat(e[a]," = ").concat(n," / outShapeStrides[").concat(a,"]"),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * outShapeStrides[").concat(a,"]"):"index -= ".concat(e[a]," * outShapeStrides[").concat(a,"]");return"".concat(i,"; ").concat(o,";")})).join("")}function DU(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index";const r=e.map(((e,t)=>t)),a=function(e,t){const n=e.length,r=e.map((e=>"".concat(t,"[").concat(e,"]"))),a=new Array(n-1);a[n-2]=r[n-1];for(let i=n-3;i>=0;--i)a[i]="(".concat(a[i+1]," * ").concat(r[i+1],")");return a}(r,t);return a.map(((t,r)=>{const i="int ".concat(e[r]," = ").concat(n," / ").concat(a[r]),o=r===a.length-1?"int ".concat(e[r+1]," = ").concat(n," - ").concat(e[r]," * ").concat(a[r]):"index -= ".concat(e[r]," * ").concat(a[r]);return"".concat(i,"; ").concat(o,";")})).join("")}function OU(e){const t=Ah(e).map((e=>e.toString()));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ".concat(t[0]," + coords.y * ").concat(t[1]," + coords.z;\n  }\n")}NU.registerFlag("HAS_WEBGL",(()=>NU.getNumber("WEBGL_VERSION")>0)),NU.registerFlag("WEBGL_VERSION",(()=>EU(2)?2:EU(1)?1:0)),NU.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(()=>!1)),NU.registerFlag("WEBGL_BUFFER_SUPPORTED",(()=>2===NU.get("WEBGL_VERSION"))),NU.registerFlag("WEBGL_CPU_FORWARD",(()=>!0)),NU.registerFlag("WEBGL_FORCE_F16_TEXTURES",(()=>!1)),NU.registerFlag("WEBGL_PACK",(()=>NU.getBool("HAS_WEBGL"))),NU.registerFlag("WEBGL_PACK_NORMALIZATION",(()=>NU.getBool("WEBGL_PACK"))),NU.registerFlag("WEBGL_PACK_CLIP",(()=>NU.getBool("WEBGL_PACK"))),NU.registerFlag("WEBGL_PACK_DEPTHWISECONV",(()=>NU.getBool("WEBGL_PACK"))),NU.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(()=>NU.getBool("WEBGL_PACK"))),NU.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(()=>NU.getBool("WEBGL_PACK"))),NU.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(()=>NU.getBool("WEBGL_PACK"))),NU.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(()=>NU.getBool("WEBGL_PACK"))),NU.registerFlag("WEBGL_PACK_REDUCE",(()=>NU.getBool("WEBGL_PACK"))),NU.registerFlag("WEBGL_LAZILY_UNPACK",(()=>NU.getBool("WEBGL_PACK"))),NU.registerFlag("WEBGL_CONV_IM2COL",(()=>NU.getBool("WEBGL_PACK"))),NU.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",(()=>NU.getBool("WEBGL_PACK"))),NU.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(()=>function(e){if(null==CU){const t=JB(e);CU=t.getParameter(t.MAX_TEXTURE_SIZE)}return CU}(NU.getNumber("WEBGL_VERSION")))),NU.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(()=>function(e){if(null==MU){const t=JB(e);MU=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,MU)}(NU.getNumber("WEBGL_VERSION")))),NU.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(()=>{const e=NU.getNumber("WEBGL_VERSION");return 0===e?0:function(e){if(0===e)return 0;let t;const n=JB(e);return t=_U(n,"EXT_disjoint_timer_query_webgl2")&&2===e?2:_U(n,"EXT_disjoint_timer_query")?1:0,t}(e)})),NU.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(()=>NU.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Sb())),NU.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(()=>function(e){if(0===e)return!1;const t=JB(e);if(1===e){if(!_U(t,"OES_texture_float"))return!1}else if(!_U(t,"EXT_color_buffer_float"))return!1;return IU(t)}(NU.getNumber("WEBGL_VERSION")))),NU.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(()=>!NU.getBool("WEBGL_FORCE_F16_TEXTURES")&&NU.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))),NU.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(()=>TU(NU.getNumber("WEBGL_VERSION")))),NU.registerFlag("WEBGL_FENCE_API_ENABLED",(()=>{return 2===(e=NU.getNumber("WEBGL_VERSION"))&&null!=JB(e).fenceSync;var e})),NU.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(()=>NU.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0)),NU.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(()=>-1),(e=>{if("number"!==typeof e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but "+"got ".concat(e,"."));if(e<0&&-1!==e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never "+"delete) or at least 0, but got ".concat(e,"."))})),NU.registerFlag("WEBGL_FLUSH_THRESHOLD",(()=>Sb()?1:-1),(e=>{if("number"!==typeof e)throw new Error("WEBGL_FLUSH_THRESHOLD must be a number but got "+"".concat(e,"."));if(e<0&&-1!==e)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never "+"manual flush) or at least 0, but got ".concat(e,"."))})),NU.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",(()=>128)),NU.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",(()=>!1)),NU.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",(()=>1e5)),NU.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",(()=>128)),NU.registerFlag("WEBGL_EXP_CONV",(()=>!1)),NU.registerFlag("SOFTWARE_WEBGL_ENABLED",(()=>NU.getBool("IS_TEST"))),NU.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",(()=>1/0)),NU.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",(()=>!1)),NU.registerFlag("WEBGL2_ISNAN_CUSTOM",(()=>!1)),NU.registerFlag("ENGINE_COMPILE_ONLY",(()=>!1));const PU="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",{getBroadcastDims:FU}=a;function zU(e,t,n){const r=[];if(e.forEach((e=>{const t=ph(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform?r.push("uniform float ".concat(e.name).concat(t>1?"[".concat(t,"]"):"",";")):(r.push("uniform sampler2D ".concat(e.name,";")),r.push("uniform int offset".concat(e.name,";"))),n.enableShapeUniforms){const{uniformShape:t}=qU(n.packedInputs,e.shapeInfo.logicalShape,e.shapeInfo.texShape);switch(t.length){case 1:r.push("uniform int ".concat(e.name,"Shape;"));break;case 2:r.push("uniform ivec2 ".concat(e.name,"Shape;"));break;case 3:r.push("uniform ivec3 ".concat(e.name,"Shape;"));break;case 4:r.push("uniform ivec4 ".concat(e.name,"Shape;"))}r.push("uniform ivec2 ".concat(e.name,"TexShape;"))}})),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;")}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach((e=>{r.push("uniform ".concat(e.type," ").concat(e.name).concat(e.arrayIndex?"[".concat(e.arrayIndex,"]"):"",";"))}));const a=r.join("\n"),i=e.map((e=>function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,a="";a+=n?BU(e,r):jU(e,r);const i=e.shapeInfo.logicalShape,o=t.logicalShape;i.length<=o.length&&(a+=n?function(e,t){const n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",i=e.shapeInfo.logicalShape.length,o=t.logicalShape.length,s=FU(e.shapeInfo.logicalShape,t.logicalShape),c=XU(o),u=o-i;let l;const f=["x","y","z","w","u","v"];l=0===i?"":o<2&&s.length>=1?"coords = 0;":s.map((e=>"coords.".concat(f[e+u]," = 0;"))).join("\n");let d="";d=o<2&&i>0?"coords":e.shapeInfo.logicalShape.map(((e,t)=>"coords.".concat(f[t+u]))).join(", ");let h="return outputValue;";const p=1===ph(e.shapeInfo.logicalShape),g=ph(t.logicalShape),m=1===g;if(1!==i||p||m){if(p&&!m)h=1===o?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(s.length){const e=i-2,t=i-1;s.indexOf(e)>-1&&s.indexOf(t)>-1?h="return vec4(outputValue.x);":s.indexOf(e)>-1?h="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":s.indexOf(t)>-1&&(h="return vec4(outputValue.xx, outputValue.zz);")}}else h="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 ".concat(a,"() {\n      ").concat(c," coords = getOutputCoords();\n      ").concat(l,"\n      vec4 outputValue = get").concat(r,"(").concat(d,");\n      ").concat(h,"\n    }\n  ")}(e,t):function(e,t){const n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",i=t.texShape,o=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,c=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===c&&null==e.shapeInfo.flatOffset&&gh(o,i))return"\n      float ".concat(a,"() {\n        return sampleTexture(").concat(n,", resultUV);\n      }\n    ");const u=XU(c),l=FU(e.shapeInfo.logicalShape,t.logicalShape),f=c-s;let d;const h=["x","y","z","w","u","v"];d=0===s?"":c<2&&l.length>=1?"coords = 0;":l.map((e=>"coords.".concat(h[e+f]," = 0;"))).join("\n");let p="";p=c<2&&s>0?"coords":e.shapeInfo.logicalShape.map(((e,t)=>"coords.".concat(h[t+f]))).join(", ");return"\n    float ".concat(a,"() {\n      ").concat(u," coords = getOutputCoords();\n      ").concat(d,"\n      return get").concat(r,"(").concat(p,");\n    }\n  ")}(e,t));return a}(e,t,n.packedInputs,n.enableShapeUniforms))).join("\n"),o=t.texShape,s=LU(),c=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ".concat(e.texture2D,"(textureSampler, uv).r;\n    }\n  ")}(s);let u,l,f=function(e){const t="".concat(e.version,"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ").concat(e.varyingFs," vec2 resultUV;\n    ").concat(e.defineOutput,"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ").concat(e.defineSpecialNaN,"\n    ").concat(e.defineSpecialInf,"\n    ").concat(e.defineRound,"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ").concat(UU,"\n    ").concat(WU,"\n    ").concat(GU,"\n  ");return t}(s);t.isPacked?(u=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(1===r[0])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ".concat(r[1],".0);\n      }\n    ");if(1===r[1])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ".concat(r[0],".0);\n      }\n    ");if(n)return"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ";return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      return 2 * (resTexRC.x * ").concat(r[1]," + resTexRC.y);\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(gh(e,t))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(".concat(r[0],", ").concat(r[1],"));\n      }\n    ");const a=Math.ceil(e[1]/2);if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ";return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[2]/2),i=a*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ")}(e,t,n);default:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[e.length-1]/2),i=a*Math.ceil(e[e.length-2]/2);let o=i,s="",c="b, r, c";for(let u=2;u<e.length-1;u++)o*=e[e.length-u-1],s="\n      int b".concat(u," = index / ").concat(o,";\n      index -= b").concat(u," * ").concat(o,";\n    ")+s,c="b".concat(u,", ")+c;return"\n    ivec".concat(e.length," getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(").concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      ").concat(s,"\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec").concat(e.length,"(").concat(c,");\n    }\n  ")}(e,t,n)}}(t.logicalShape,o,n.enableShapeUniforms),l=function(e){return"\n    void setOutput(vec4 val) {\n      ".concat(e.output," = val;\n    }\n  ")}(s)):(u=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){if(1===t[0])return n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.x * ".concat(t[1],".0);\n      }\n    ");if(1===t[1])return n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.y * ".concat(t[0],".0);\n      }\n    ");if(n)return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ";return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      return resTexRC.x * ").concat(t[1]," + resTexRC.y;\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){if(gh(e,t))return n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(".concat(t[0],", ").concat(t[1],"));\n      }\n    ");if(1===e[1])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ");if(1===e[0])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ");if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ";return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      int r = index / ").concat(e[1],";\n      int c = index - r * ").concat(e[1],";\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n){const t=RU(["r","c","d"],e);return"\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ".concat(t,"\n    return ivec3(r, c, d);\n  }\n")}const r=AU(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(r,"\n      return ivec3(r, c, d);\n    }\n  ")}(e,t,n);case 4:return function(e,t,n){if(n){const t=RU(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ".concat(t,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}const r=AU(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(r,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}(e,t,n);case 5:return function(e,t){const n=AU(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(".concat(t[0],",\n                             ").concat(t[1],"));\n\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ")}(e,t);case 6:return function(e,t){const n=AU(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ")}(e,t);default:throw new Error("".concat(e.length,"-D output sampling is not yet supported"))}}(t.logicalShape,o,n.enableShapeUniforms),l=function(e){return"\n    void setOutput(float val) {\n      ".concat(e.output," = vec4(val, 0, 0, 0);\n    }\n  ")}(s)),n.packedInputs&&(f+=VU);return[f,c,l,a,u,i,n.userCode].join("\n")}function jU(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=e.shapeInfo.logicalShape;switch(n.length){case 0:return function(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"float ".concat(r,"() {return ").concat(n,";}");const[a,i]=e.shapeInfo.texShape;if(1===a&&1===i)return"\n      float ".concat(r,"() {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");const o=HU(n);if(t)return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], ").concat(o,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");const[s,c]=e.shapeInfo.texShape;return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(s,", ").concat(c,", ").concat(o,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e,t);case 1:return function(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int index) {\n        ").concat(YU(e),"\n      }\n    ");const a=e.shapeInfo.texShape,i=a[0],o=a[1];if(1===o&&1===i)return"\n      float ".concat(r,"(int index) {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");const s=HU(n);if(1===o)return t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[0]));\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / ").concat(i,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(1===i)return t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / ").concat(o,".0, 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(t)return"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");return"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(i,", ").concat(o,", index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape;if(null!=i&&gh(n,i)){if(t)return"\n      float ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");const e=i[0],n=i[1];return"\n    float ".concat(a,"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(n,".0, ").concat(e,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}const{newShape:o,keptDims:s}=Sh(n),c=o;if(c.length<n.length){const n=KU(e,c),r=["row","col"];return"\n      ".concat(jU(n,t),"\n      float ").concat(a,"(int row, int col) {\n        return ").concat(a,"(").concat(QU(r,s),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(").concat(n[1],", 1)));\n        ").concat(YU(e),"\n      }\n    ");const u=i[0],l=i[1],f=HU(r);if(1===l)return t?"\n      float ".concat(a,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(f,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(").concat(r,"TexShape[0]));\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(f,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ").concat(u,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");if(1===u)return t?"\n      float ".concat(a,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(f,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(").concat(r,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(f,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2((index + 0.5) / ").concat(l,".0, 0.5);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");if(t)return"\n      float ".concat(a,"(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(r,"Shape[1] + col + ").concat(f,";\n        vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");return"\n  float ".concat(a,"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ").concat(n[1]," + col + ").concat(f,";\n    vec2 uv = uvFromFlat(").concat(u,", ").concat(l,", index);\n    return sampleTexture(").concat(r,", uv);\n  }\n")}(e,t);case 3:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[1]*n[2],o=n[2],{newShape:s,keptDims:c}=Sh(n),u=s;if(u.length<n.length){const n=KU(e,u),r=["row","col","depth"];return"\n        ".concat(jU(n,t),"\n        float ").concat(a,"(int row, int col, int depth) {\n          return ").concat(a,"(").concat(QU(r,c),");\n        }\n      ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(").concat(i,", ").concat(o,", 1)));\n        ").concat(YU(e),"\n      }\n    ");const l=e.shapeInfo.texShape,f=l[0],d=l[1],h=e.shapeInfo.flatOffset;if(d===i&&null==h)return t?"\n      float ".concat(a,"(int row, int col, int depth) {\n        int stride1 = ").concat(r,"Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n        float ".concat(a,"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(").concat(o,", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(").concat(d,".0, ").concat(f,".0);\n          return sampleTexture(").concat(r,", uv);\n        }\n      ");if(d===o&&null==h)return t?"\n      float ".concat(a,"(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(").concat(r,"Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(").concat(n[1],", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(d,".0, ").concat(f,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");const p=HU(r);if(t)return"\n    float ".concat(a,"(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ").concat(r,"Shape[1] * ").concat(r,"Shape[2];\n      int stride1 = ").concat(r,"Shape[2];\n      int index = row * stride0 + col * stride1 + depth + ").concat(p,";\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n      return sampleTexture(").concat(r,", uv);\n    }\n    ");return"\n      float ".concat(a,"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(i," + col * ").concat(o," + depth + ").concat(p,";\n        vec2 uv = uvFromFlat(").concat(f,", ").concat(d,", index);\n        return sampleTexture(").concat(r,", uv);\n      }\n  ")}(e,t);case 4:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[3],o=n[2]*i,s=n[1]*o,{newShape:c,keptDims:u}=Sh(n);if(c.length<n.length){const n=KU(e,c),r=["row","col","depth","depth2"];return"\n      ".concat(jU(n,t),"\n      float ").concat(a,"(int row, int col, int depth, int depth2) {\n        return ").concat(a,"(").concat(QU(r,u),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(").concat(s,", ").concat(o,", ").concat(i,", 1)));\n        ").concat(YU(e),"\n      }\n    ");const l=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,d=f[0],h=f[1],p="int stride2 = ".concat(r,"Shape[3];"),g="int stride1 = ".concat(r,"Shape[2] * stride2;"),m="int stride0 = ".concat(r,"Shape[1] * stride1;");if(h===s&&null==l)return t?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        ").concat(p,"\n        ").concat(g,"\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(").concat(o,", ").concat(i,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(h,".0, ").concat(d,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");if(h===i&&null==l)return t?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(r,"Shape[1] * ").concat(r,"Shape[2], ").concat(r,"Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(n[1]*n[2],", ").concat(n[2],", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(h,".0, ").concat(d,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");const v=HU(r);if(t)return"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ").concat(p,"\n      ").concat(g,"\n      ").concat(m,"\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index + ").concat(v,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");return"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," +\n          depth * ").concat(i," + depth2;\n      vec2 uv = uvFromFlat(").concat(d,", ").concat(h,", index + ").concat(v,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}(e,t);case 5:return function(e){const t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],i=t[3]*a,o=t[2]*i,s=t[1]*o,{newShape:c,keptDims:u}=Sh(t);if(c.length<t.length){const t=KU(e,c),n=["row","col","depth","depth2","depth3"];return"\n      ".concat(jU(t),"\n      float ").concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        return ").concat(r,"(").concat(QU(n,u),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(s,", ").concat(o,", ").concat(i,", ").concat(a,")) +\n          depth3;\n        ").concat(YU(e),"\n      }\n    ");const l=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,d=f[0],h=f[1];if(h===s&&null==l)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(").concat(o,", ").concat(i,", ").concat(a,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(h,".0, ").concat(d,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(h===a&&null==l)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3],",\n               ").concat(t[2]*t[3],", ").concat(t[3],", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(h,".0, ").concat(d,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");const p=HU(n);return"\n    float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," + depth * ").concat(i," +\n          depth2 * ").concat(a," + depth3 + ").concat(p,";\n      vec2 uv = uvFromFlat(").concat(d,", ").concat(h,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);case 6:return function(e){const t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:a,keptDims:i}=Sh(t);if(a.length<t.length){const t=KU(e,a),n=["row","col","depth","depth2","depth3","depth4"];return"\n      ".concat(jU(t),"\n      float ").concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ").concat(r,"(").concat(QU(n,i),");\n      }\n    ")}const o=t[5],s=t[4]*o,c=t[3]*s,u=t[2]*c,l=t[1]*u;if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(l,", ").concat(u,", ").concat(c,", ").concat(s,")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(").concat(o,", 1)));\n        ").concat(YU(e),"\n      }\n    ");const f=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,h=d[0],p=d[1];if(p===l&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(").concat(u,", ").concat(c,", ").concat(s,", ").concat(o,")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(p,".0, ").concat(h,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(p===o&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3]*t[4],",\n               ").concat(t[2]*t[3]*t[4],",\n               ").concat(t[3]*t[4],",\n               ").concat(t[4],")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(p,".0, ").concat(h,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");const g=HU(n);return"\n    float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(l," + col * ").concat(u," + depth * ").concat(c," +\n          depth2 * ").concat(s," + depth3 * ").concat(o," + depth4 + ").concat(g,";\n      vec2 uv = uvFromFlat(").concat(h,", ").concat(p,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);default:throw new Error("".concat(n.length,"-D input sampling")+" is not yet supported")}}function BU(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){const t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=LU();return"\n    vec4 ".concat(n,"() {\n      return ").concat(r.texture2D,"(").concat(t,", halfCR);\n    }\n  ")}(e);case 1:return function(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=LU();if(t)return"\n    vec4 ".concat(r,"(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ");const o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return"\n    vec4 ".concat(r,"(int index) {\n      vec2 uv = packedUVfrom1D(\n        ").concat(o[0],", ").concat(o[1],", index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=i[0],s=i[1],c=LU();if(null!=i&&gh(n,i))return t?"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n\n        return ").concat(c.texture2D,"(").concat(r,", uv);\n      }\n    "):"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n\n        return ").concat(c.texture2D,"(").concat(r,", uv);\n      }\n    ");if(t)return"\n    vec4 ".concat(a,"(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ").concat(c.texture2D,"(").concat(r,", uv);\n    }\n  ");const u=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],l=Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int row, int col) {\n      vec2 uv = packedUVfrom2D(").concat(l,", ").concat(u[0],", ").concat(u[1],", row, col);\n      return ").concat(c.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);case 3:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===n[0]){const r=[1,2],i=KU(e,n.slice(1)),o=["b","row","col"];return"\n        ".concat(BU(i,t),"\n        vec4 ").concat(a,"(int b, int row, int col) {\n          return ").concat(a,"(").concat(QU(o,r),");\n        }\n      ")}const s=LU();if(t)return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ").concat(s.texture2D,"(").concat(r,", uv);\n    }\n  ");const c=o[0],u=o[1],l=Math.ceil(n[2]/2),f=l*Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ").concat(c,", ").concat(u,", ").concat(f,", ").concat(l,", b, row, col);\n      return ").concat(s.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);default:return function(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=LU();if(t)return"\n    vec4 ".concat(r,"(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(").concat(n,"Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(n,"Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ").concat(n,"Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ");const i=e.shapeInfo.logicalShape,o=i.length,s=e.shapeInfo.texShape,c=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],u=c[0],l=c[1],f=Math.ceil(i[o-1]/2);let d=f*Math.ceil(i[o-2]/2),h="int b, int row, int col",p="b * ".concat(d," + (row / 2) * ").concat(f," + (col / 2)");for(let g=2;g<o-1;g++)h="int b".concat(g,", ")+h,d*=i[o-g-1],p="b".concat(g," * ").concat(d," + ")+p;return"\n    vec4 ".concat(r,"(").concat(h,") {\n      int index = ").concat(p,";\n      int texR = index / ").concat(l,";\n      int texC = index - texR * ").concat(l,";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(l,", ").concat(u,");\n      return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t)}}const UU="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",WU="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",GU="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",VU="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function HU(e){return"offset".concat(e)}function YU(e){const t=e.name,n=ph(e.shapeInfo.logicalShape);return n<2?"return ".concat(t,";"):"\n    for (int i = 0; i < ".concat(n,"; i++) {\n      if (i == index) {\n        return ").concat(t,"[i];\n      }\n    }\n  ")}function XU(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank ".concat(e," is not yet supported"))}function qU(e,t,n){const{newShape:r,keptDims:a}=Sh(t),i=t.length,o=e&&3===i&&1===t[0],s=o?t.slice(1):r,c=!e&&i>1&&!gh(t,n)&&r.length<i||o;return{useSqueezeShape:c,uniformShape:c?s:t,keptDims:a}}function KU(e,t){const n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function QU(e,t){return t.map((t=>e[t])).join(", ")}function JU(e,t,n,r){const a=n.map(((e,n)=>{const r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),i=a.map((e=>e.shapeInfo)),o={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},s=zU(a,o,t),c=function(e,t){const n=mU(e,(()=>e.createShader(e.FRAGMENT_SHADER)),"Unable to create fragment WebGLShader.");if(iU(e,(()=>e.shaderSource(n,t))),iU(e,(()=>e.compileShader(n))),Hh().get("ENGINE_COMPILE_ONLY"))return n;if(!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw uU(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}(e.gl,s),u=e.createProgram(c);return Hh().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:c,source:s,webGLProgram:u,inShapeInfos:i,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(e.buildVao(u),Object.assign({program:t,fragmentShader:c,source:s,webGLProgram:u,inShapeInfos:i,outShapeInfo:o},ZU(e,t,u)))}function ZU(e,t,n){const r=[],a=[];let i,o,s,c=null,u=null;u=e.getUniformLocation(n,"NAN",!1),1===Hh().getNumber("WEBGL_VERSION")&&(c=e.getUniformLocation(n,"INFINITY",!1));const l=!1;for(const f of t.variableNames){const a={name:f,uniform:e.getUniformLocation(n,f,l),offset:e.getUniformLocation(n,"offset".concat(f),l)};t.enableShapeUniforms&&(a.shape=e.getUniformLocation(n,"".concat(f,"Shape"),l),a.texShape=e.getUniformLocation(n,"".concat(f,"TexShape"),l)),r.push(a)}if(t.enableShapeUniforms&&(i=e.getUniformLocation(n,"outShape",l),s=e.getUniformLocation(n,"outShapeStrides",l),o=e.getUniformLocation(n,"outTexShape",l)),t.customUniforms)for(const f of t.customUniforms)a.push(e.getUniformLocation(n,f.name,l));return{variablesLocations:r,customUniformLocations:a,infLoc:c,nanLoc:u,outShapeLocation:i,outShapeStridesLocation:s,outTexShapeLocation:o}}function $U(e,t){if(e.length!==t.length)throw Error("Binary was compiled with ".concat(e.length," inputs, but ")+"was executed with ".concat(t.length," inputs"));e.forEach(((e,n)=>{const r=e.logicalShape,a=t[n],i=a.shape;if(!gh(r,i))throw Error("Binary was compiled with different shapes than "+"the current args. Shapes ".concat(r," and ").concat(i," must match"));if(e.isUniform&&a.isUniform)return;const o=e.texShape,s=a.isUniform?null:a.texData.texShape;if(!gh(o,s))throw Error("Binary was compiled with different texture shapes than the"+" current args. Shape ".concat(o," and ").concat(s," must match"))}))}function eW(e){return Hh().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}class tW{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=ZB.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=LU();this.outputShape=e,this.enableShapeUniforms=eW(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?RU(["r","c","d"],e):AU(["r","c","d"],e),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ").concat(t.output," = result;\n      }\n    ")}}class nW{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=ZB.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=LU();this.outputShape=e,this.enableShapeUniforms=eW(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?RU(["r","c","d"],e):AU(["r","c","d"],e),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ").concat(t.output," = result;\n      }\n    ")}}class rW{constructor(e){this.variableNames=["A"],this.outTexUsage=$B.DOWNLOAD;const t=LU();this.outputShape=e,this.userCode="\n      ".concat(PU,"\n\n      void main() {\n        float x = getAAtOutCoords();\n        ").concat(t.output," = encode_float(x);\n      }\n    ")}}class aW{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=$B.DOWNLOAD;const t=LU();this.outputShape=e,this.userCode="\n      ".concat(PU,"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ").concat(t.output," = encode_float(x);\n      }\n    ")}}const iW={R:0,G:1,B:2,A:3};class oW{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"RGBA";this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=LU();this.outputShape=e,this.enableShapeUniforms=eW(this.outputShape.length);let a="result";t&&(a="floor(result * 255. + 0.5)");let i="";for(let o=0;o<n.length;o++){const e=n[o];i+="\n          if(offset == ".concat(o,") {\n            result = values[").concat(iW[e],"];\n          }")}this.userCode="\n      ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":OU(e),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int flatIndex = getFlatIndex(coords);\n        float result = 0.;\n        int offset = imod(flatIndex, ").concat(n.length,");\n\n        flatIndex = idiv(flatIndex, ").concat(n.length,", 1.);\n\n        int r = flatIndex / texShape[1];\n        if (r < texShape[0]) {\n          int c = imod(flatIndex, texShape[1]);\n          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n          vec4 values = ").concat(r.texture2D,"(A, uv);\n          ").concat(i,"\n        }\n        ").concat(r.output," = vec4(").concat(a,", 0., 0., 0.);\n      }\n    ")}}class sW{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=LU();this.outputShape=e,this.enableShapeUniforms=eW(this.outputShape.length);let r="",a="result";t&&(a="floor(result * 255. + 0.5)");for(let i=0;i<=1;i++)for(let t=0;t<=1;t++){const a=2*i+t;r+="\n          localCoords = coords;\n          if(localCoords[2] + ".concat(t," < ").concat(this.enableShapeUniforms?"outShape[2]":"".concat(e[2]),") {\n          localCoords[2] += ").concat(t,";\n          if (localCoords[1] + ").concat(i," < ").concat(this.enableShapeUniforms?"outShape[1]":"".concat(e[1]),") {\n            localCoords[1] += ").concat(i,";\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ").concat(n.texture2D,"(A, uv);\n\n            if (offset == 0) {\n              result[").concat(a,"] = values[0];\n            } else if (offset == 1) {\n              result[").concat(a,"] = values[1];\n            } else if (offset == 2) {\n              result[").concat(a,"] = values[2];\n            } else {\n              result[").concat(a,"] = values[3];\n            }\n          }\n        }\n        ")}this.userCode="\n        ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":OU(e),"\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ").concat(r,"\n\n          ").concat(n.output," = ").concat(a,";\n        }\n    ")}}function cW(e){const t=LU();return function(e,t){const n=mU(e,(()=>e.createShader(e.VERTEX_SHADER)),"Unable to create vertex WebGLShader.");if(iU(e,(()=>e.shaderSource(n,t))),iU(e,(()=>e.compileShader(n))),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(e,"".concat(t.version,"\n    precision highp float;\n    ").concat(t.attribute," vec3 clipSpacePos;\n    ").concat(t.attribute," vec2 uv;\n    ").concat(t.varyingVs," vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }"))}function uW(e){return function(e,t){const n=mU(e,(()=>e.createBuffer()),"Unable to create WebGLBuffer");return iU(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,n))),iU(e,(()=>e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW))),n}(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function lW(e){return function(e,t){const n=mU(e,(()=>e.createBuffer()),"Unable to create WebGLBuffer");return iU(e,(()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n))),iU(e,(()=>e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW))),n}(e,new Uint16Array([0,1,2,2,1,3]))}function fW(e,t,n,r,a,i){!function(e,t){const n=Hh().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){const n="[".concat(e,"x").concat(t,"]");throw new Error("Requested texture size "+n+" is invalid.")}if(e>n||t>n){const r="[".concat(e,"x").concat(t,"]"),a="[".concat(n,"x").concat(n,"]");throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+a+".")}}(t,n);const o=function(e){return mU(e,(()=>e.createTexture()),"Unable to create WebGLTexture.")}(e),s=e.TEXTURE_2D;return iU(e,(()=>e.bindTexture(s,o))),iU(e,(()=>e.texParameteri(s,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE))),iU(e,(()=>e.texParameteri(s,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE))),iU(e,(()=>e.texParameteri(s,e.TEXTURE_MIN_FILTER,e.NEAREST))),iU(e,(()=>e.texParameteri(s,e.TEXTURE_MAG_FILTER,e.NEAREST))),1===Hh().getNumber("WEBGL_VERSION")?iU(e,(()=>e.texImage2D(s,0,r,t,n,0,a,i,null))):iU(e,(()=>e.texStorage2D(s,1,r,t,n))),iU(e,(()=>e.bindTexture(e.TEXTURE_2D,null))),{texture:o,texShape:[n,t]}}function dW(e){return e.internalFormatFloat}function hW(e){return e.internalFormatHalfFloat}function pW(e){return e.downloadTextureFormat}function gW(e){return e.internalFormatPackedFloat}function mW(e){return e.internalFormatPackedHalfFloat}function vW(e,t,n,r,a,i,o,s){const c=e,u=new Float32Array(function(e,t){const[n,r]=rU(e,t);return n*r*4}(i,o));return c.bindBuffer(c.PIXEL_PACK_BUFFER,t),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,u),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),u}class bW{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=Hh().getNumber("WEBGL_VERSION");if(null!=e?(this.gl=e,function(e,t){KB[e]=t}(t,e)):this.gl=JB(t),e=this.gl,2===Hh().getNumber("WEBGL_VERSION")){const t=e;this.createVertexArray=()=>iU(t,(()=>t.createVertexArray())),this.bindVertexArray=e=>iU(t,(()=>t.bindVertexArray(e))),this.deleteVertexArray=e=>iU(t,(()=>t.deleteVertexArray(e))),this.getVertexArray=()=>iU(t,(()=>t.getParameter(t.VERTEX_ARRAY_BINDING)))}else if(null!=e){const t=e.getExtension("OES_vertex_array_object");if(null==t)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>iU(e,(()=>t.createVertexArrayOES())),this.bindVertexArray=n=>iU(e,(()=>t.bindVertexArrayOES(n))),this.deleteVertexArray=n=>iU(e,(()=>t.deleteVertexArrayOES(n))),this.getVertexArray=()=>iU(e,(()=>e.getParameter(t.VERTEX_ARRAY_BINDING_OES)))}let n="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===Hh().getNumber("WEBGL_VERSION")){const e="OES_texture_float",t="OES_texture_half_float";if(this.textureFloatExtension=sU(this.gl,e),_U(this.gl,t))this.textureHalfFloatExtension=sU(this.gl,t);else if(Hh().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),_U(this.gl,r))this.colorBufferHalfFloatExtension=sU(this.gl,r);else if(Hh().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",_U(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!_U(this.gl,r))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(r)}this.vertexBuffer=uW(this.gl),this.indexBuffer=lW(this.gl),this.framebuffer=function(e){return mU(e,(()=>e.createFramebuffer()),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=aU(this.gl,this.textureHalfFloatExtension)}get debug(){return Hh().getBool("DEBUG")}dispose(){if(this.disposed)return;null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;iU(e,(()=>e.finish())),iU(e,(()=>e.bindFramebuffer(e.FRAMEBUFFER,null))),iU(e,(()=>e.deleteFramebuffer(this.framebuffer))),iU(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,null))),iU(e,(()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null))),iU(e,(()=>e.deleteBuffer(this.indexBuffer))),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[a,i]=tU(t,n);return fW(e,a,i,dW(r),r.textureFormatFloat,e.FLOAT)}(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[a,i]=tU(t,n);return fW(e,a,i,hW(r),r.textureFormatFloat,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[a,i]=tU(t,n);return fW(e,a,i,pW(r),e.RGBA,e.UNSIGNED_BYTE)}(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),function(e,t,n){iU(e,(()=>e.bindTexture(e.TEXTURE_2D,t))),n.data instanceof Uint8Array?2===Hh().getNumber("WEBGL_VERSION")?iU(e,(()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data))):iU(e,(()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data))):2===Hh().getNumber("WEBGL_VERSION")?iU(e,(()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n))):iU(e,(()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n))),iU(e,(()=>e.bindTexture(e.TEXTURE_2D,null)))}(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,n,r){this.throwIfDisposed(),function(e,t,n,r,a,i){let o,s,c;iU(e,(()=>e.bindTexture(e.TEXTURE_2D,t))),a instanceof Uint8Array?(o=new Uint8Array(n*r*4),s=e.UNSIGNED_BYTE,c=e.RGBA):(o=new Float32Array(n*r*4),s=e.FLOAT,c=i.internalFormatPackedFloat),o.set(a),2===Hh().getNumber("WEBGL_VERSION")?iU(e,(()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,e.RGBA,s,o))):iU(e,(()=>e.texImage2D(e.TEXTURE_2D,0,c,n,r,0,e.RGBA,s,o))),iU(e,(()=>e.bindTexture(e.TEXTURE_2D,null)))}(this.gl,e,t,n,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[a,i]=rU(t,n);return fW(e,a,i,mW(r),e.RGBA,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[a,i]=rU(t,n);return fW(e,a,i,gW(r),e.RGBA,e.FLOAT)}(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(pU(this.gl,this.framebuffer),this.outputTexture=null),iU(this.gl,(()=>this.gl.deleteTexture(e)))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,n){return this.downloadMatrixDriver(e,(()=>function(e,t,n,r){const[a,i]=tU(t,n),o=new Uint8Array(t*n*4);return iU(e,(()=>e.readPixels(0,0,a,i,r.downloadTextureFormat,e.UNSIGNED_BYTE,o))),new Float32Array(o.buffer)}(this.gl,t,n,this.textureConfig)))}downloadPackedMatrixFromBuffer(e,t,n,r,a,i){return vW(this.gl,e,0,0,0,a,i,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return function(e,t,n){const r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}(this.gl,e,t)}createBufferFromTexture(e,t,n){this.bindTextureToFrameBuffer(e);const r=function(e,t,n){const r=e.createBuffer();iU(e,(()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,r)));const a=16*t*n;return iU(e,(()=>e.bufferData(e.PIXEL_PACK_BUFFER,a,e.STREAM_READ))),iU(e,(()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0))),iU(e,(()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,null))),r}(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,n;if(Hh().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,a=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=()=>{const e=r.clientWaitSync(a,0,0);return e===r.ALREADY_SIGNALED||e===r.CONDITION_SATISFIED},t=a}else Hh().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(t,Hh().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:t,isFencePassed:n}}downloadMatrixFromPackedTexture(e,t,n){return this.downloadMatrixDriver(e,(()=>function(e,t,n){const r=new Float32Array(t*n*4);return iU(e,(()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r))),r}(this.gl,t,n)))}createProgram(e){this.throwIfDisposed();const t=this.gl;null==this.vertexShader&&(this.vertexShader=cW(t));const n=function(e){return mU(e,(()=>e.createProgram()),"Unable to create WebGLProgram.")}(t);iU(t,(()=>t.attachShader(n,this.vertexShader))),iU(t,(()=>t.attachShader(n,e))),function(e,t){if(iU(e,(()=>e.linkProgram(t))),!Hh().get("ENGINE_COMPILE_ONLY")&&!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}(t,n);const r=Object.assign(n,{vao:this.createVertexArray()});return this.debug&&lU(t,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;iU(t,(()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer))),function(e,t,n){iU(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,n))),fU(e,t,"clipSpacePos",n,3,20,0)&&fU(e,t,"uv",n,2,20,12)}(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&(iU(this.gl,(()=>this.gl.deleteProgram(e))),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&lU(this.gl,this.program),iU(this.gl,(()=>this.gl.useProgram(e)))}getUniformLocation(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.throwIfDisposed(),n?function(e,t,n){return mU(e,(()=>e.getUniformLocation(t,n)),'uniform "'+n+'" not present in program.')}(this.gl,e,t):function(e,t,n){return e.getUniformLocation(t,n)}(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),iU(this.gl,(()=>this.gl.getAttribLocation(e,t)))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),dU(this.gl,e,t,n)}setOutputMatrixTexture(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}setOutputPackedMatrixTexture(e,t,n){this.throwIfDisposed();const[r,a]=rU(t,n);this.setOutputMatrixTextureDriver(e,r,a)}setOutputMatrixWriteRegion(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){null!=this.program&&lU(this.gl,this.program),gU(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const e=this.getVertexArray();console.assert(e===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}iU(e,(()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),iU(this.gl,(()=>this.gl.finish()))}getQueryTimerExtension(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=sU(this.gl,2===Hh().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(2===Hh().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(2===Hh().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2();return void e.endQuery(t.TIME_ELAPSED_EXT)}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await yh((()=>this.disposed||this.isQueryAvailable(e,Hh().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")))),this.getQueryTime(e,Hh().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(0===t)return null;if(2===t){const t=this.gl;return t.getQueryParameter(e,t.QUERY_RESULT)/1e6}{const t=this.getQueryTimerExtensionWebGL1();return t.getQueryObjectEXT(e,t.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(0===t)return!0;if(2===t){const t=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=t.getQueryParameter(e,t.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),r&&!this.disjoint}{const t=this.getQueryTimerExtensionWebGL1(),n=t.getQueryObjectEXT(e,t.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(t.GPU_DISJOINT_EXT)),n&&!this.disjoint}}pollFence(e){return new Promise((t=>{this.addItemToPoll((()=>e.isFencePassed()),(()=>t()))}))}pollItems(){const e=function(e){let t=0;for(;t<e.length;++t){if(!e[t]())break}return t-1}(this.itemsToPoll.map((e=>e.isDoneFn)));for(let t=0;t<=e;++t){const{resolveFn:e}=this.itemsToPoll[t];e()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let n;"setTimeoutCustom"in Hh().platform&&(n=Hh().platform.setTimeoutCustom.bind(Hh().platform)),yh((()=>(this.pollItems(),0===this.itemsToPoll.length)),(()=>0),null,n)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),hU(this.gl,e,this.framebuffer),this.debug&&gU(this.gl)}unbindTextureToFrameBuffer(){null!=this.outputTexture?(hU(this.gl,this.outputTexture,this.framebuffer),this.debug&&gU(this.gl)):pU(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const n=t();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(e,t,n){this.throwIfDisposed();const r=this.gl;hU(r,e,this.framebuffer),this.debug&&gU(r),this.outputTexture=e,iU(r,(()=>r.viewport(0,0,t,n))),iU(r,(()=>r.scissor(0,0,t,n)))}setOutputMatrixWriteRegionDriver(e,t,n,r){this.throwIfDisposed(),iU(this.gl,(()=>this.gl.scissor(e,t,n,r)))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(null==this.program)throw new Error("No GPU program is currently set.")}}const{mx:yW,XI:xW,Nk:wW,f6:SW,ct:CW,YG:MW,hH:_W,z3:EW,sG:TW,uM:IW,vS:kW,qB:NW,GG:LW,rq:AW,lg:RW,WR:DW,cu:OW,GE:PW,px:FW,jC:zW,He:jW,hE:BW,BF:UW,Dk:WW,cl:GW,_B:VW,ub:HW,_f:YW,Ku:XW,qy:qW,Zy:KW,bu:QW,zv:JW,dH:ZW,HS:$W,yH:eG,l3:tG,z9:nG,x6:rG,_m:aG,eW:iG,GK:oG,SP:sG,yr:cG,dl:uG,Dw:lG,xT:fG,_X:dG,wz:hG}=i;function pG(e,t){return["x","y","z","w","u","v"].slice(0,t).map((t=>"".concat(e,".").concat(t)))}function gG(e,t){return 1===t?[e]:pG(e,t)}class mG{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=eW(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{const e=gG("rc",this.rank),t=XU(this.rank),n=this.getOutOfBoundsCondition(e),r=this.getSetup(e),a=this.getOutput(e);this.userCode="\n        void main() {\n          ".concat(t," rc = getOutputCoords();\n\n          if(").concat(n,") {\n            setOutput(vec4(0));\n          } else {\n            ").concat(r,"\n\n            setOutput(vec4(").concat(a,"));\n          }\n        }\n      ")}}getSourceCoordsArr(e){const t=[];for(let n=0;n<=1;n++)for(let r=0;r<=1;r++){let a="".concat(0===n?"r":"rp1",", ").concat(0===r?"c":"cp1");for(let t=2;t<this.rank;t++)a="".concat(e[e.length-1-t],",")+a;t.push(a)}return t}getOutOfBoundsCondition(e){if(1===this.rank)return"rc > ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]);let t="";for(let n=this.rank-2;n<this.rank;n++)t+="".concat(e[n]," >= ").concat(this.enableShapeUniforms?"outShape[".concat(n,"]"):this.outputShape[n]),n<this.rank-1&&(t+="||");return t}getSetup(e){if(1===this.rank)return"";const t=e.slice(-2),n=this.enableShapeUniforms?"outShape[".concat(this.rank," - 1]"):this.outputShape[this.rank-1],r=this.enableShapeUniforms?"outShape[".concat(this.rank," - 2]"):this.outputShape[this.rank-2];return"\n      int r = ".concat(t[0],";\n      int c = ").concat(t[1],";\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ").concat(n,";\n      bool rEdge = rp1 >= ").concat(r,";\n    ")}getOutput(e){const t=this.getSourceCoordsArr(e);if(1===this.rank){const e=this.enableShapeUniforms?"outShape":this.outputShape[0];return"getA(rc), (rc + 1 >= ".concat(e," ? 0. : getA(rc + 1)), 0, 0")}return"getA(".concat(t[0],"),\n            cEdge ? 0. : getA(").concat(t[1],"),\n            rEdge ? 0. : getA(").concat(t[2],"),\n            rEdge || cEdge ? 0. : getA(").concat(t[3],")")}}class vG{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=eW(this.outputShape.length);let n="";for(let r=0;r<4;r++){let e="thisRC = rc;";r%2===1&&(e+="thisRC.z += 1;"),r>1&&(e+="thisRC.y += 1;"),n+="\n        ".concat(e,"\n        ").concat(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"","\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[").concat(r,"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ").concat(r>0?"}":"","\n      ")}this.userCode="\n      ".concat(function(e,t){const n=t?DU(["r","c","d"],"inputShape"):AU(["r","c","d"],e);return"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ".concat(n,"\n      return ivec3(r, c, d);\n    }\n  ")}(t,this.enableShapeUniforms),"\n      ").concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":OU(e),"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ").concat(this.enableShapeUniforms?"outShape[1]":e[1],";\n        int cols = ").concat(this.enableShapeUniforms?"outShape[2]":e[2],";\n\n        ").concat(n,"\n\n        setOutput(result);\n      }\n    ")}}class bG{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,n){const r=xG(t,n),a=wG(e,r,n);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);const i=yG(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=i,this.log();const e=this.freeTextures[a].pop();return this.usedTextures[a].push(e),e}let o;return r===eU.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===eU.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===eU.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===eU.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===eU.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(o),this.numUsedTextures++,this._numBytesAllocated+=i,this.log(),o}releaseTexture(e,t,n,r){if(null==this.freeTextures)return;const a=xG(n,r),i=wG(t,a,r);i in this.freeTextures||(this.freeTextures[i]=[]);const o=yG(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,r),s=Hh().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==s&&this._numBytesAllocated>s?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=o):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=o),this.numUsedTextures--;const c=this.usedTextures[i],u=c&&c.indexOf(e);if(null==u||u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c[u]=c[c.length-1],c.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(e,")"));const t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*t),"%)"))}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(null!=this.freeTextures){for(const e in this.freeTextures)this.freeTextures[e].forEach((e=>{this.gpgpu.deleteMatrixTexture(e.texture)}));for(const e in this.usedTextures)this.usedTextures[e].forEach((e=>{this.gpgpu.deleteMatrixTexture(e.texture)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function yG(e,t,n,r,a){const i=function(e,t){switch(e){case eU.PACKED_2X2_FLOAT32:return gW(t);case eU.PACKED_2X2_FLOAT16:return mW(t);case eU.UNPACKED_FLOAT32:return dW(t);case eU.UNPACKED_FLOAT16:return hW(t);case eU.PACKED_4X1_UNSIGNED_BYTE:return pW(t);default:throw new Error("Unknown physical texture type ".concat(e))}}(t,r);let o;if(a){const[t,n]=rU(e[0],e[1]);o=t*n}else{const[t,n]=tU(e[0],e[1]);o=t*n}const s=function(e,t){const n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error("Unknown internal format ".concat(t))}(n,i);return o*s}function xG(e,t){if(e===$B.UPLOAD)return eU.PACKED_2X2_FLOAT32;if(e===$B.RENDER||null==e)return function(e){return Hh().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?eU.PACKED_2X2_FLOAT32:eU.UNPACKED_FLOAT32:e?eU.PACKED_2X2_FLOAT16:eU.UNPACKED_FLOAT16}(t);if(e===$B.DOWNLOAD||e===$B.PIXELS)return eU.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(e))}function wG(e,t,n){return"".concat(e[0],"_").concat(e[1],"_").concat(t,"_").concat(n)}class SG{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=eW(this.outputShape.length),this.userCode="\n      float unaryOperation(float x) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")}}const CG="if (isnan(x)) return x;",MG="return abs(x);";const _G=CG+"\n  return (x < 0.0) ? 0.0 : x;\n",EG=CG+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",TG="return x;";class IG{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=eW(this.outputShape.length),this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        ".concat(t,"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")}}class kG{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=eW(this.outputShape.length);const t=e.length,n=gG("rc",t),r=XU(t),a=function(e,t){if(1===e)return"rc";let n="";for(let r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(t,n),i=n.slice(-2),o=t<=1?"rc":"vec2(".concat(i.join(","),")");this.userCode="\n      void main() {\n        ".concat(r," rc = getOutputCoords();\n        vec4 packedInput = getA(").concat(a,");\n\n        setOutput(getChannel(packedInput, ").concat(o,"));\n      }\n    ")}}const NG=e_,LG={};const AG=Hh().getNumber("CPU_HANDOFF_SIZE_THRESHOLD");class RG extends ih{nextDataId(){return RG.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!Hh().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(null!=e){if(e instanceof bW)t=e;else{const n=JB(Hh().getNumber("WEBGL_VERSION"),e);t=new bW(n)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const e=JB(Hh().getNumber("WEBGL_VERSION"));t=new bW(e),this.binaryCache=((n=Hh().getNumber("WEBGL_VERSION"))in LG||(LG[n]={}),LG[n]),this.gpgpuCreatedLocally=!0}var n;this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new bG(this.gpgpu),this.numMBBeforeWarning=null==Hh().global.screen?1024:Hh().global.screen.height*Hh().global.screen.width*window.devicePixelRatio*600/1024/1024,this.texData=new ah(this,Pb())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,n,r,a,i){const o=this.makeTensorInfo(t,n),s=this.texData.get(o.dataId);s.isPacked=!1,s.texture={texture:e,texShape:[r,a]},s.texShape=[r,a];const c=xU(t),u=new oW(c,!1,i),l=this.runWebGLProgram(u,[o],n,[[r,a]]);return l.shape=t,s.texture=null,this.disposeIntermediateTensorInfo(o),l.dataId}write(e,t,n){if((Hh().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||Hh().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:$B.UPLOAD,refCount:1}),r}refCount(e){if(this.texData.has(e)){return this.texData.get(e).refCount}return 0}incRef(e){this.texData.get(e).refCount++}decRef(e){if(this.texData.has(e)){this.texData.get(e).refCount--}}move(e,t,n,r,a){if(Hh().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:$B.UPLOAD,refCount:a})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:n,dtype:r,complexTensorInfos:a,slice:i,shape:o,isPacked:s}=t;if(null!=i){let t;t=s?new IG(o,TG):new SG(o,TG);const n=this.runWebGLProgram(t,[{dataId:e,shape:o,dtype:r}],r),a=this.readSync(n.dataId);return this.disposeIntermediateTensorInfo(n),a}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;const c=null!=this.activeTimers;let u,l;if(c&&(u=Ov()),"complex64"===r){l=bM(this.readSync(a.real.dataId),this.readSync(a.imag.dataId))}else l=this.getValuesFromTexture(e);return c&&(this.downloadWaitMs+=Ov()-u),this.convertAndCacheOnCPU(e,l)}async read(e){if(this.pendingRead.has(e)){const t=this.pendingRead.get(e);return new Promise((e=>t.push(e)))}const t=this.texData.get(e),{values:n,shape:r,slice:a,dtype:i,complexTensorInfos:o,isPacked:s}=t;if(null!=a){let t;t=s?new IG(r,TG):new SG(r,TG);const n=this.runWebGLProgram(t,[{dataId:e,shape:r,dtype:i}],i),a=this.read(n.dataId);return this.disposeIntermediateTensorInfo(n),a}if(null!=n)return this.convertAndCacheOnCPU(e);if(Hh().getBool("DEBUG")&&!Hh().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===Hh().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let c,u,l=null;if("complex64"!==i&&Hh().get("WEBGL_BUFFER_SUPPORTED")){c=this.decode(e);const t=this.texData.get(c.dataId);l=this.gpgpu.createBufferFromTexture(t.texture.texture,...nU(r))}if(this.pendingRead.set(e,[]),"complex64"!==i&&await this.gpgpu.createAndWaitForFence(),"complex64"===i){const e=await Promise.all([this.read(o.real.dataId),this.read(o.imag.dataId)]);u=bM(e[0],e[1])}else if(null==l)u=this.getValuesFromTexture(e);else{const e=ph(r);u=this.gpgpu.downloadFloat32MatrixFromBuffer(l,e)}if(null!=c&&this.disposeIntermediateTensorInfo(c),null!=l){const e=this.gpgpu.gl;iU(e,(()=>e.deleteBuffer(l)))}const f=this.convertAndCacheOnCPU(e,u),d=this.pendingRead.get(e);return this.pendingRead.delete(e),d.forEach((e=>e(f))),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&Pb().removeDataId(e,this),this.pendingDeletes--),f}readToGPU(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this.texData.get(e),{values:r,shape:a,slice:i,dtype:o,isPacked:s,texture:c}=n;if("complex64"===o)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=i){let n;n=s?new IG(a,TG):new SG(a,TG);const r=this.runWebGLProgram(n,[{dataId:e,shape:a,dtype:o}],o),i=this.readToGPU(r,t);return this.disposeIntermediateTensorInfo(r),i}if(null==c)throw null!=r?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const u=this.decode(e,t.customTexShape),l=Pb().makeTensorFromTensorInfo(u),f=this.texData.get(u.dataId);return Object.assign({tensorRef:l},f.texture)}bufferSync(e){const t=this.readSync(e.dataId);if("string"===e.dtype)try{const n=t.map((e=>Fv(e)));return Ty(e.shape,e.dtype,n)}catch(u2){throw new Error("Failed to decode encoded string bytes into utf-8")}return Ty(e.shape,e.dtype,t)}checkNumericalProblems(e){if(null!=e)for(let t=0;t<e.length;t++){const n=e[t];if(!oU(n)){if(Hh().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value ".concat(n," cannot be represented with your ")+"current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value ".concat(n," cannot be represented on this device."))}}}getValuesFromTexture(e){const{shape:t,dtype:n,isPacked:r}=this.texData.get(e),a=ph(t);if(Hh().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const n=this.decode(e),r=this.texData.get(n.dataId),i=this.gpgpu.downloadMatrixFromPackedTexture(r.texture.texture,...nU(t)).subarray(0,a);return this.disposeIntermediateTensorInfo(n),i}const i=Hh().getBool("WEBGL_PACK")&&!0===r,o=i?xU(t):t,s=i?new aW(o):new rW(o),c=this.runWebGLProgram(s,[{shape:o,dtype:n,dataId:e}],"float32"),u=this.texData.get(c.dataId),l=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(u.texture.texture,u.texShape[0],u.texShape[1]).subarray(0,a);return this.disposeIntermediateTensorInfo(c),l}timerAvailable(){return Hh().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,n=[];let r=!1;null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e();const a=jv(this.activeTimers.map((e=>e.query))).filter((e=>null!=e)),i=jv(this.activeTimers.map((e=>e.name))).filter((e=>null!=e));this.activeTimers=t,r&&(this.programTimersStack=null);const o={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(Hh().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const e=await Promise.all(a);o.kernelMs=function(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t}(e),o.getExtraProfileInfo=()=>e.map(((e,t)=>({name:i[t],ms:e}))).map((e=>"".concat(e.name,": ").concat(e.ms))).join(", ")}else o.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,o})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return Hh().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Ov(),endMs:null}}endTimer(e){return Hh().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Ov(),e)}async getQueryTime(e){if(Hh().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:n}=this.texData.get(e);return null!=n&&(this.disposeData(n.real.dataId,t),this.disposeData(n.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:n,texShape:r,usage:a,isPacked:i,slice:o}=this.texData.get(e),s=o&&o.origDataId||e,c=this.dataRefCount.get(s);c>1?this.dataRefCount.set(s,c-1):(this.dataRefCount.delete(s),null!=t&&(this.numBytesInGPU-=this.computeBytes(r,n),this.textureManager.releaseTexture(t,r,a,i)));const u=this.texData.get(e);u.texture=null,u.texShape=null,u.isPacked=!1,u.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:AG;return Hh().getBool("WEBGL_CPU_FORWARD")&&e.every((e=>null==this.texData.get(e.dataId).texture&&ph(e.shape)<t))}getGPGPUContext(){return this.gpgpu}where(e){cv("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return NG(e.shape,t)}packedUnaryOp(e,t,n){const r=new IG(e.shape,t),a=this.compileAndRun(r,[e],n);return Pb().makeTensorFromTensorInfo(a)}abs(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){const t=ZW(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(Hh().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,MG,e.dtype);const t=new SG(e.shape,MG),n=this.compileAndRun(t,[e]);return Pb().makeTensorFromTensorInfo(n)}makeTensorInfo(e,t,n){let r;if("string"===t&&null!=n&&n.length>0&&Th(n[0])){const a=n.map((e=>Pv(e)));r=this.write(a,e,t)}else r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}makeOutput(e,t,n){return Pb().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,n),this)}unpackTensor(e){const t=new kG(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new mG(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const n=[bU(e.shape),...yU(e.shape)],r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[bU(t),...yU(t)],i=new vG(a,n),o=[n],s=this.runWebGLProgram(i,[r],e.dtype,o,!0);return{dataId:s.dataId,shape:t,dtype:s.dtype}}decode(e,t){const n=this.texData.get(e),{isPacked:r,shape:a,dtype:i}=n;if(null!=t){fh(ph(a)<=t[0]*t[1]*4,(()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."))}const o=xU(a);let s;s=r?new nW(o):new tW(o);const c=[null!=t?t:nU(o)];return{dtype:i,shape:a,dataId:this.runWebGLProgram(s,[{shape:o,dtype:i,dataId:e}],i,c,!0,t).dataId}}runWebGLProgram(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5?arguments[5]:void 0;const o=this.makeTensorInfo(e.outputShape,n),s=this.texData.get(o.dataId);if(e.packedOutput&&(s.isPacked=!0),e.outPackingScheme===ZB.DENSE){const t=null!=i?i:nU(e.outputShape);s.texShape=t.map((e=>2*e))}if(null!=e.outTexUsage&&(s.usage=e.outTexUsage),0===ph(o.shape))return s.values=Ch(o.dtype,0),o;const c=[],u=t.map((t=>{if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let n=this.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&ph(t.shape)<=Hh().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}if(this.uploadToGPU(t.dataId),!!n.isPacked!==!!e.packedInputs)t=n.isPacked?this.unpackTensor(t):this.packTensor(t),c.push(t),n=this.texData.get(t.dataId);else if(n.isPacked&&!SU(n.shape,t.shape)){const e=t,r=t.shape;t.shape=n.shape,t=this.packedReshape(t,r),c.push(t),n=this.texData.get(t.dataId),e.shape=r}return{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(o.dataId);const l={shape:o.shape,texData:s,isUniform:!1},f=function(e,t,n){let r="";t.concat(n).forEach((t=>{const a=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!t.isUniform){const i=t.texData.texShape,{useSqueezeShape:o,uniformShape:s,keptDims:c}=qU(e.packedInputs,t.shape,i);let u="",l="",f="";if(1===s.length&&e.packedInputs){const e=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];u="".concat(e[0]>1,"_").concat(e[1]>1)}else if(2!==s.length||e.packedInputs){if(s.length>2&&!e.packedInputs){const e=Ah(s);f="".concat(e[0]===i[1],"_").concat(e[e.length-1]===i[1])}}else l="".concat(s[0]>1,"_").concat(s[1]>1);const d=t.shape.length,h=2===s.length&&gh(t.shape,i),p=1===ph(t.shape),g=$y(t.shape,n.shape),m=!e.packedInputs&&d===n.shape.length&&gh(i,n.texData.texShape),v=e.packedInputs||s.length>2?"":"".concat(i[0]>1,"_").concat(i[1]>1);r+="".concat(d,"_").concat(m,"_").concat(o?c:"","_").concat(s.length,"_").concat(p,"_").concat(g,"_").concat(h,"_").concat(u,"_").concat(l,"_").concat(f,"_").concat(v,"_").concat(a)}else{const e=t.isUniform?"uniform":t.texData.texShape;r+="".concat(t.shape,"_").concat(e,"_").concat(a)}}));const a=e.userCode;let i=e.constructor.name;return i+="_"+r+"_"+a+"".concat(Hh().getNumber("WEBGL_VERSION")),i}(e,u,l),d=this.getAndSaveBinary(f,(()=>JU(this.gpgpu,e,u,l))),h=null!=this.activeTimers;let p;h&&(p=this.startTimer()),Hh().get("ENGINE_COMPILE_ONLY")||function(e,t,n,r,a){t.program.enableShapeUniforms||($U(t.inShapeInfos,n),$U([t.outShapeInfo],[r]));const i=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):e.setOutputMatrixTexture(i.texture,o[0],o[1]),e.setProgram(t.webGLProgram),e.bindVertexArray(t.webGLProgram.vao),1===Hh().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN);for(let c=0;c<n.length;++c){const r=n[c],{uniform:a,offset:i,shape:o,texShape:s}=t.variablesLocations[c];if(o){const{uniformShape:n}=qU(t.program.packedInputs,r.shape,r.texData.texShape);switch(n.length){case 1:e.gl.uniform1iv(o,new Int32Array(n));break;case 2:e.gl.uniform2iv(o,new Int32Array(n));break;case 3:e.gl.uniform3iv(o,new Int32Array(n));break;case 4:e.gl.uniform4iv(o,new Int32Array(n))}}if(s&&e.gl.uniform2i(s,r.texData.texShape[0],r.texData.texShape[1]),null!=a)if(r.isUniform)if(ph(r.shape)<2)e.gl.uniform1f(a,r.uniformValues[0]);else{let t=r.uniformValues;t instanceof Float32Array||(t=new Float32Array(t)),e.gl.uniform1fv(a,t)}else null!=r.texData.slice&&null!=i&&e.gl.uniform1i(i,r.texData.slice.flatOffset),e.setInputMatrixTexture(r.texData.texture.texture,a,c)}const s=t.outShapeLocation;if(s)switch(r.shape.length){case 1:e.gl.uniform1iv(s,new Int32Array(r.shape));break;case 2:e.gl.uniform2iv(s,new Int32Array(r.shape));break;case 3:e.gl.uniform3iv(s,new Int32Array(r.shape));break;case 4:e.gl.uniform4iv(s,new Int32Array(r.shape))}if(t.outShapeStridesLocation){const n=Ah(r.shape);switch(r.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(n));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(n));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(n))}}if(t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),t.program.customUniforms&&a)for(let c=0;c<t.program.customUniforms.length;++c){const n=t.program.customUniforms[c],r=t.customUniformLocations[c],i=a[c];if("float"===n.type)e.gl.uniform1fv(r,i);else if("vec2"===n.type)e.gl.uniform2fv(r,i);else if("vec3"===n.type)e.gl.uniform3fv(r,i);else if("vec4"===n.type)e.gl.uniform4fv(r,i);else if("int"===n.type)e.gl.uniform1iv(r,i);else if("ivec2"===n.type)e.gl.uniform2iv(r,i);else if("ivec3"===n.type)e.gl.uniform3iv(r,i);else{if("ivec4"!==n.type)throw Error("uniform type ".concat(n.type," is not supported yet."));e.gl.uniform4iv(r,i)}}e.executeProgram()}(this.gpgpu,d,u,l,r),c.forEach((e=>this.disposeIntermediateTensorInfo(e))),h&&(p=this.endTimer(p),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(p)}));const g=Hh().getNumber("WEBGL_FLUSH_THRESHOLD");if(g>0){const e=Ov();e-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=e)}if(!Hh().getBool("WEBGL_LAZILY_UNPACK")&&s.isPacked&&!1===a){const e=this.unpackTensor(o);return this.disposeIntermediateTensorInfo(o),e}return o}compileAndRun(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];n=n||t[0].dtype;return this.runWebGLProgram(e,t,n,r,a)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){if(!this.disposed){if(!Hh().getBool("IS_TEST")){Object.keys(this.binaryCache).forEach((e=>{this.gpgpu.deleteProgram(this.binaryCache[e].webGLProgram),delete this.binaryCache[e]}))}this.textureManager.dispose(),null!=this.canvas&&"undefined"!==typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}}floatPrecision(){return null==this.floatPrecisionValue&&(this.floatPrecisionValue=zb((()=>{if(!Hh().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=Hh().getBool("DEBUG");Hh().set("DEBUG",!1);const t=this.abs(jy(1e-8)).dataSync()[0];if(Hh().set("DEBUG",e),t>0)return 32}return 16}))),this.floatPrecisionValue}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}uploadToGPU(e){const t=this.texData.get(e),{shape:n,dtype:r,values:a,texture:i,usage:o,isPacked:s}=t;if(null!=i)return;const c=null!=this.activeTimers;let u;c&&(u=Ov());let l=t.texShape;if(null==l&&(l=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Hh().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=Hh().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");if(r===1/0&&Hh().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=n/2),t&&(n*=2,r*=2,e=e.map(((t,n)=>n>=e.length-2?uh(e[n]):e[n])),1===e.length&&(e=[2,e[0]])),2!==e.length){const t=Sh(e);e=t.newShape}let a=ph(e),i=null;e.length<=1&&a<=n?i=[1,a]:2===e.length&&e[0]<=n&&e[1]<=n?i=e:3===e.length&&e[0]*e[1]<=n&&e[2]<=n?i=[e[0]*e[1],e[2]]:3===e.length&&e[0]<=n&&e[1]*e[2]<=n?i=[e[0],e[1]*e[2]]:4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n?i=[e[0]*e[1]*e[2],e[3]]:4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n&&(i=[e[0],e[1]*e[2]*e[3]]);const o=null!=i&&Math.max(...i)>r&&Math.min(...i)<=(t?2:1)&&Math.min(...i)>0;if(null==i||o)if(t){const t=bU(e);let n=2,r=2;e.length&&([n,r]=yU(e)),a=t*(n/2)*(r/2),i=vh(a).map((e=>2*e))}else i=vh(a);return i}(n,s),t.texShape=l),null!=a){const e=xU(n);let i,o=l[1],f=l[0];const d=a instanceof Uint8Array||a instanceof Uint8ClampedArray;!s&&d||([o,f]=rU(l[0],l[1])),i=s?new sW(e,d):new oW(e,d);const h=d?[f,o]:l,p=this.makeTensorInfo(h,r),g=this.texData.get(p.dataId);g.usage=d?$B.PIXELS:$B.UPLOAD,g.texShape=h,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(p.dataId),o,f,a);const m=[[f,o]],v=!0,b=this.runWebGLProgram(i,[p],r,m,v),y=this.texData.get(b.dataId);t.texShape=y.texShape,t.isPacked=y.isPacked,t.usage=y.usage,Hh().get("ENGINE_COMPILE_ONLY")?this.disposeData(b.dataId):(t.texture=y.texture,t.values=null,this.texData.delete(b.dataId)),this.disposeIntermediateTensorInfo(p),c&&(this.uploadWaitMs+=Ov()-u)}else{const e=this.acquireTexture(l,o,r,s);t.texture=e}}convertAndCacheOnCPU(e,t){const n=this.texData.get(e),{dtype:r}=n;return null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){const n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length);for(let t=0;t<n.length;++t)n[t]=Math.round(e[t]);return n}throw new Error("Unknown dtype ".concat(t))}(t,r)),n.values}acquireTexture(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){const e=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(e," MB, ")+"most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*Eh(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}for(const[,t]of Object.entries(this.binaryCache)){const n=new Promise((e=>{try{this.checkCompletion_(t),e(!0)}catch(n){throw n}}));e.push(n)}return Promise.all(e)}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await VC(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(!1===this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)){if(console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS))throw uU(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.");throw new Error("Failed to link vertex and fragment shaders.")}return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:n,infLoc:r,nanLoc:a,outShapeLocation:i,outShapeStridesLocation:o,outTexShapeLocation:s}=ZU(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=n,e.infLoc=r,e.nanLoc=a,e.outShapeLocation=i,e.outShapeStridesLocation=o,e.outTexShapeLocation=s}}createTensorFromGPUData(e,t,n){e.channels=e.channels||"RGBA";const{texture:r,height:a,width:i,channels:o}=e,s=Pb().backend;if(!s.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const c=s.writeTexture(r,t,n,a,i,o);return Pb().makeTensorFromDataId(c,t,n,s)}}RG.nextDataId=0;Cb()&&Ub("webgl",(()=>new RG),2);const DG="\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n";class OG{constructor(e,t,n){this.variableNames=["A","B"],this.outputShape=tx(t,n),this.enableShapeUniforms=eW(this.outputShape.length),this.userCode="\n      float binaryOperation(float a, float b) {\n        ".concat(e,"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    ")}}const PG="\n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n";class FG{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=tx(t,n);const a=this.outputShape.length;this.enableShapeUniforms=eW(a);let i="";if(r)if(0===a||1===ph(this.outputShape))i="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else{const e=XU(a);if(i="\n          ".concat(e," coords = getOutputCoords();\n        "),1===a)this.enableShapeUniforms?i+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":i+="\n            result.y = (coords + 1) >= ".concat(this.outputShape[0]," ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ");else{const e=gG("coords",a);this.enableShapeUniforms?i+="\n            bool nextRowOutOfBounds =\n              (".concat(e[a-2]," + 1) >= outShape[").concat(a," - 2];\n            bool nextColOutOfBounds =\n              (").concat(e[a-1]," + 1) >= outShape[").concat(a," - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "):i+="\n            bool nextRowOutOfBounds =\n              (".concat(e[a-2]," + 1) >= ").concat(this.outputShape[a-2],";\n            bool nextColOutOfBounds =\n              (").concat(e[a-1]," + 1) >= ").concat(this.outputShape[a-1],";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          ")}}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ".concat(e,"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ").concat(i,"\n\n        setOutput(result);\n      }\n    ")}}function zG(e){const{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const jG={kernelName:dg,backendName:"webgl",kernelFunc:zG};function BG(e){const{inputs:t,backend:n}=e,{real:r,imag:a}=t,i=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(i.dataId),s=zG({inputs:{x:r},backend:n}),c=zG({inputs:{x:a},backend:n});return o.complexTensorInfos={real:s,imag:c},i}const UG={kernelName:Cp,backendName:"webgl",kernelFunc:BG},WG="return (a < 0.) ? b * a : a;",GG="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";const VG={kernelName:bg,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{alpha:i}=r,o=n.makeTensorInfo([],"float32",Rv(i,"float32")),s=Hh().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new FG(GG,a.shape,o.shape):new OG(WG,a.shape,o.shape),c=n.runWebGLProgram(s,[a,o],"float32");return n.disposeIntermediateTensorInfo(o),c}},HG="return (a < 0.) ? b * a : a;",YG="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";const XG={kernelName:$g,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r,alpha:a}=t,i=Hh().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new FG(YG,r.shape,a.shape):new OG(HG,r.shape,a.shape);return n.runWebGLProgram(i,[r,a],"float32")}},qG="if (isnan(x)) return x;";function KG(e){let{opSnippet:t,packedOpSnippet:n,cpuKernelImpl:r,dtype:a}=e;return e=>{let{inputs:i,backend:o}=e;const{x:s}=i,c=o,u=a||s.dtype;if(c.shouldExecuteOnCPU([s])&&null!=r){const e=c.texData.get(s.dataId),t=r(e.values,u);return c.makeTensorInfo(s.shape,u,t)}let l;return l=Hh().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=n?new IG(s.shape,n):new SG(s.shape,t),c.runWebGLProgram(l,[s],u)}}function QG(e){let{opSnippet:t,packedOpSnippet:n,checkOutOfBounds:r=!1,supportsComplex:a=!1,cpuKernelImpl:i,dtype:o}=e;return e=>{let{inputs:s,backend:c}=e;const{a:u,b:l}=s,f=c;if(a&&"complex64"===u.dtype){const e=f.texData.get(u.dataId),n=f.texData.get(l.dataId),[r,a]=[[e.complexTensorInfos.real,n.complexTensorInfos.real],[e.complexTensorInfos.imag,n.complexTensorInfos.imag]].map((e=>{const[n,r]=e,a={dataId:n.dataId,dtype:n.dtype,shape:u.shape},i={dataId:r.dataId,dtype:r.dtype,shape:l.shape},o=new OG(t,u.shape,l.shape);return f.runWebGLProgram(o,[a,i],sb(n.dtype,r.dtype))})),i=BG({inputs:{real:r,imag:a},backend:f});return f.disposeIntermediateTensorInfo(r),f.disposeIntermediateTensorInfo(a),i}const d=o||sb(u.dtype,l.dtype);if(("string"===u.dtype||"string"===l.dtype||f.shouldExecuteOnCPU([u,l]))&&null!=i){const e=f.texData.get(u.dataId).values,t=f.texData.get(l.dataId).values,n="string"===u.dtype?ZM(e):e,r="string"===u.dtype?ZM(t):t,[a,o]=i(u.shape,l.shape,n,r,d),s=f.makeTensorInfo(o,d);return f.texData.get(s.dataId).values=a,s}let h;return h=Hh().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=n?new FG(n,u.shape,l.shape,r):new OG(t,u.shape,l.shape),f.runWebGLProgram(h,[u,l],d)}}function JG(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("linear"===e)return"return x;";if("relu"===e)return t?"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":_G;if("elu"===e)return t?"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n":"return (x >= 0.0) ? x : (exp(x) - 1.0);";if("relu6"===e)return t?"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":EG;if("prelu"===e)return t?YG:HG;if("leakyrelu"===e)return t?GG:WG;if("sigmoid"===e)return"return 1.0 / (1.0 + exp(-1.0 * x));";throw new Error("Activation ".concat(e," has not been implemented for the WebGL backend."))}class ZG{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]&&arguments[8];this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=eW(this.outputShape.length);const u=r?e[1]:e[2],l=Math.ceil(u/2),f=r?"i * 2, rc.y":"rc.y, i * 2",d=a?"rc.z, i * 2":"i * 2, rc.z",h=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],p=a?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let g="",m="";o&&(g=s?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(o,"\n        }"):c?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(o,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(o,"\n        }"),m="result = activation(result);");const v=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");let b="rc.x",y="rc.x";e[0]<t[0]?b="imod(rc.x, ".concat(e[0],")"):t[0]<e[0]&&(y="imod(rc.x, ".concat(t[0],")")),this.userCode="\n      ".concat(g,"\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ").concat(l,".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        int batchA = ").concat(b,";\n        int batchB = ").concat(y,";\n        for (int i = 0; i < ").concat(l,"; i++) {\n          vec4 a = getMatrixA(batchA, ").concat(f,");\n          vec4 b = getMatrixB(batchB, ").concat(d,");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (").concat(h[0]," * ").concat(p[0],");\n          result += (").concat(h[1]," * ").concat(p[1],");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ").concat(v,"\n\n        ").concat(m,"\n\n        setOutput(result);\n      }\n    ")}}const $G="return areal * breal - aimag * bimag;",eV="return areal * bimag + aimag * breal;";class tV{constructor(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=tx(t,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ".concat(e,"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    ")}}const nV="return a * b;";function rV(e){const{inputs:t,backend:n}=e,{a:r,b:a}=t,i=sb(r.dtype,a.dtype);if("complex64"===r.dtype){const e=n.texData.get(r.dataId),t=n.texData.get(a.dataId),i=new tV($G,r.shape,a.shape),o=new tV(eV,r.shape,a.shape),s=[{dataId:e.complexTensorInfos.real.dataId,dtype:e.complexTensorInfos.real.dtype,shape:r.shape},{dataId:e.complexTensorInfos.imag.dataId,dtype:e.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:t.complexTensorInfos.real.dataId,dtype:t.complexTensorInfos.real.dtype,shape:a.shape},{dataId:t.complexTensorInfos.imag.dataId,dtype:t.complexTensorInfos.imag.dtype,shape:a.shape}],c=n.runWebGLProgram(i,s,"float32"),u=n.runWebGLProgram(o,s,"float32"),l=BG({inputs:{real:c,imag:u},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(u),l}if(n.shouldExecuteOnCPU([r,a])){const e=n.texData.get(r.dataId),t=n.texData.get(a.dataId),[o,s]=UW(r.shape,a.shape,e.values,t.values,i),c=n.makeTensorInfo(s,i);return n.texData.get(c.dataId).values=o,c}let o;return o=Hh().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new FG(nV,r.shape,a.shape):new OG(nV,r.shape,a.shape),n.runWebGLProgram(o,[r,a],i)}const aV={kernelName:Wg,backendName:"webgl",kernelFunc:rV};function iV(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{shape:i}=r,o=n,s=ph(a.shape),c=xh(i,s),u=ph(c);fh(s===u,(()=>"The new shape (".concat(c,") has ").concat(u," elements and the old ")+"shape (".concat(a.shape,") has ").concat(s," elements. The new shape and old ")+"shape must have the same number of elements."));const l=o.texData.get(a.dataId);return!l.isPacked||SU(a.shape,c)||null!==l.texture&&SU(l.shape,c)?(o.incRef(a.dataId),{dataId:a.dataId,shape:c,dtype:a.dtype}):function(e,t,n){const r=[bU(e.shape),...yU(e.shape)],a={dtype:e.dtype,shape:r,dataId:e.dataId},i=[bU(t),...yU(t)],o=new vG(i,r),s=[r],c=n.runWebGLProgram(o,[a],e.dtype,s,!0);return{dataId:c.dataId,shape:t,dtype:c.dtype}}(a,c,o)}const oV={kernelName:cm,backendName:"webgl",kernelFunc:iV};class sV{constructor(e,t){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:a,outSize:i}=e;this.outputShape=[r,i];const o=4*Math.floor(n/4),s=n%4;let c="sumValue += dot(values, ones);";if(null!=t){const e=1/t;c="sumValue += dot(values * ".concat(mh(e)?e.toPrecision(2):e,", ones);")}let u="";a%n>0&&(u="\n        if (inIdx < 0 || inIdx >= ".concat(a,") {\n          return 0.0;\n        }\n      ")),this.userCode="\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ".concat(u,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(n,";\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(o,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(c,"\n        }\n\n        int inIdx = inOffset + ").concat(o,";\n        if (").concat(1===s,") {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(2===s,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(3===s,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ").concat(c,"\n        }\n        setOutput(sumValue);\n      }\n    ")}}class cV{constructor(e,t){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:a,outSize:i}=e;this.outputShape=[r,i];let o="0.0",s="";"prod"===t?o="1.0":"min"===t?(o="1.0 / 1e-20",s="min"):"max"===t&&(o="-1.0 / 1e-20",s="max");let c="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===t?c="sumValue":"prod"===t?c="prodValue":"all"===t?c="allValue":"any"===t&&(c="anyValue");const u=4*Math.floor(n/4),l=n%4;let f="\n      if (".concat("sum"===t,") {\n        sumValue += dot(values, ones);\n      } else if (").concat("prod"===t,") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ").concat(s,"(values, minMaxValue);\n        if (").concat("min"===t," || ").concat("max"===t,") {\n          minMaxValue = ").concat(s,"(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    "),d="vec4";"all"===t?(o="1.0",f="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===t&&(o="0.0",f="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");let h="";a%n>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(a,") {\n          return initializationValue;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat(o,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ").concat(h,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(n,";\n\n        vec4 minMaxValue = vec4(").concat(o,");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ").concat(u,"; i += 4) {\n          int inIdx = inOffset + i;\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(f,"\n        }\n\n        int inIdx = inOffset + ").concat(u,";\n        if (").concat(1===l,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(f,"\n        } else if (").concat(2===l,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(f,"\n        } else if (").concat(3===l,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ").concat(f,"\n        }\n        setOutput(").concat(c,");\n      }\n    ")}}function uV(e,t,n,r){const a=function(e){const t=[];for(;0===t.length||1!==t[t.length-1].outSize;){const n=t.length?t[t.length-1].outSize:e[1],r=$C(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}(e.shape);let i=e;for(let o=0;o<a.length;o++){const{inSize:s,windowSize:c,outSize:u}=a[o];let l,f;l="mean"===n?0===o?new sV({windowSize:c,inSize:s,batchSize:e.shape[0],outSize:u},s):new sV({windowSize:c,inSize:s,batchSize:e.shape[0],outSize:u}):new cV({windowSize:c,inSize:s,batchSize:e.shape[0],outSize:u},n),f=i,i=r.runWebGLProgram(l,[i],t),f.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(f)}return i}class lV{constructor(e,t){this.variableNames=["A"];const n=new Array(e.length);for(let i=0;i<n.length;i++)n[i]=e[t[i]];this.outputShape=n,this.rank=n.length;const r=XU(this.rank),a=function(e){const t=e.length;if(t>6)throw Error("Transpose for rank ".concat(t," is not yet supported"));const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t);for(let a=0;a<e.length;a++)r[e[a]]=n[a];return r.join()}(t);this.userCode="\n    void main() {\n      ".concat(r," resRC = getOutputCoords();\n      setOutput(getA(").concat(a,"));\n    }\n    ")}}class fV{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const n=new Array(e.length);for(let u=0;u<n.length;u++)n[u]=e[t[u]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));const r=XU(this.rank),a=pG("rc",this.rank),i=new Array(this.rank);for(let u=0;u<t.length;u++)i[t[u]]=a[u];const o="vec2(".concat(i.slice(-2).join(),")"),s="++".concat(a[this.rank-1]," < ").concat(n[this.rank-1]),c="getChannel(getA(".concat(i.join(),"), ").concat(o,")");this.userCode="\n    void main() {\n      ".concat(r," rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ").concat(c,";\n      if(").concat(s,") {\n        result[1] = ").concat(c,";\n      }\n      --").concat(a[this.rank-1],";\n      if(++").concat(a[this.rank-2]," < ").concat(n[this.rank-2],") {\n        result[2] = ").concat(c,";\n        if(").concat(s,") {\n          result[3] = ").concat(c,";\n        }\n      }\n      setOutput(result);\n    }\n    ")}}function dV(e,t,n){const r=Hh().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new fV(e.shape,t):new lV(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function hV(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:o}=r;return function(e,t,n,r){const a=t,i=e.shape.length,o=wh(a,e.shape);let s=o;const c=Vw(s,i),u=null!=c;let l=e;u&&(l=dV(e,c,r),s=Yw(s.length,i)),Gw("sum",s,i);const[f,d]=Uw(l.shape,s);let h=f;n&&(h=Ww(f,o));const p=ph(d),g=iV({inputs:{x:l},attrs:{shape:[ph(e.shape)/p,p]},backend:r}),m=uV(g,cb(e.dtype),"sum",r),v=iV({inputs:{x:m},attrs:{shape:h},backend:r});return r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(m),u&&r.disposeIntermediateTensorInfo(l),v}(a,i,o,n)}const pV={kernelName:km,backendName:"webgl",kernelFunc:hV};function gV(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{perm:i}=r,o=n,s=a.shape.length,c=new Array(s);for(let l=0;l<c.length;l++)c[l]=a.shape[i[l]];let u;if(o.shouldExecuteOnCPU([a])){const e=o.texData.get(a.dataId).values,t=dG(e,a.shape,a.dtype,i,c);u=o.makeTensorInfo(c,a.dtype);o.texData.get(u.dataId).values=t}else u=dV(a,i,o);return u}const mV={kernelName:Jm,backendName:"webgl",kernelFunc:gV};function vV(e){let{a:t,b:n,transposeA:r,transposeB:a,backend:i,bias:o=null,preluActivationWeights:s=null,leakyreluAlpha:c=0,activation:u=null}=e;const l=t.shape.length,f=n.shape.length,d=r?t.shape[l-2]:t.shape[l-1],h=a?n.shape[f-1]:n.shape[f-2],p=r?t.shape[l-1]:t.shape[l-2],g=a?n.shape[f-2]:n.shape[f-1],m=t.shape.slice(0,-2),v=n.shape.slice(0,-2),b=ph(m),y=ph(v),x=tx(t.shape.slice(0,-2),n.shape.slice(0,-2)).concat([p,g]);fh(d===h,(()=>"Error in matMul: inner shapes (".concat(d,") and (")+"".concat(h,") of Tensors with shapes ").concat(t.shape," and ")+"".concat(n.shape," and transposeA=").concat(r)+" and transposeB=".concat(a," must match.")));const w=r?[b,d,p]:[b,p,d],S=a?[y,g,h]:[y,h,g],C=iV({inputs:{x:t},backend:i,attrs:{shape:w}}),M=iV({inputs:{x:n},backend:i,attrs:{shape:S}}),_=[C,M],E=Math.max(b,y),T=r?C.shape[1]:C.shape[2],I=null!=o,k=null!=s,N="leakyrelu"===u,L=null!=u?JG(u,!0):null;let A;if((1===p||1===g)&&T>1e3&&!1===(I||k||N||null!=L)){let e=C,t=M;r&&(e=gV({inputs:{x:C},backend:i,attrs:{perm:[0,2,1]}}),_.push(e)),a&&(t=gV({inputs:{x:M},backend:i,attrs:{perm:[0,2,1]}}),_.push(t));const n=1===g;let o=e;1!==g&&(o=iV({inputs:{x:e},backend:i,attrs:{shape:[E,T,1]}}),_.push(o));const s=1===g?2:1;let c=t;n&&(c=iV({inputs:{x:t},backend:i,attrs:{shape:[E,1,T]}}),_.push(c));const u=rV({inputs:{a:o,b:c},backend:i});A=hV({inputs:{x:u},backend:i,attrs:{axis:s,keepDims:!0}}),_.push(u)}else{const e=sb(t.dtype,n.dtype),u=new ZG(w,S,[E,p,g],r,a,I,L,k,N),l=[C,M];if(null!=o&&l.push(o),k&&l.push(s),N){const e=i.makeTensorInfo([],"float32",Rv(c,"float32"));l.push(e),_.push(e)}A=i.runWebGLProgram(u,l,e)}const R=iV({inputs:{x:A},backend:i,attrs:{shape:x}});_.push(A);for(const D of _)i.disposeIntermediateTensorInfo(D);return R}const bV={kernelName:iv,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{a:a,b:i,bias:o,preluActivationWeights:s}=t,{transposeA:c,transposeB:u,activation:l,leakyreluAlpha:f}=r;return vV({a:a,b:i,transposeA:c,transposeB:u,backend:n,bias:o,preluActivationWeights:s,leakyreluAlpha:f,activation:l})}},yV="return abs(x);";const xV={kernelName:Jh,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t;if(n.shouldExecuteOnCPU([r])&&"complex64"!==r.dtype){const e=n.texData.get(r.dataId),t=ZW(e.values);return n.makeTensorInfo(r.shape,r.dtype,t)}let a;return a=Hh().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new IG(r.shape,yV):new SG(r.shape,yV),n.runWebGLProgram(a,[r],r.dtype)}},wV=KG({opSnippet:CG+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"}),SV={kernelName:Zh,backendName:"webgl",kernelFunc:wV},CV=KG({opSnippet:CG+"\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"}),MV={kernelName:$h,backendName:"webgl",kernelFunc:CV},_V="return a + b;",EV=QG({opSnippet:_V,packedOpSnippet:_V,supportsComplex:!0,cpuKernelImpl:yW}),TV={kernelName:ep,backendName:"webgl",kernelFunc:EV};class IV{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map(((e,t)=>"T".concat(t)));const n=[];this.variableNames.forEach((e=>{n.push("float v".concat(e," = get").concat(e,"AtOutCoords();"))}));const r=this.variableNames.map((e=>"v".concat(e))).join(" + ");this.userCode="\n      void main() {\n        ".concat(n.join("\n        "),"\n\n        float result = ").concat(r,";\n        setOutput(result);\n      }\n    ")}}class kV{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map(((e,t)=>"T".concat(t)));const n=[];this.variableNames.forEach((e=>{n.push("vec4 v".concat(e," = get").concat(e,"AtOutCoords();"))}));const r=this.variableNames.map((e=>"v".concat(e))).join(" + ");this.userCode="\n      void main() {\n        ".concat(n.join("\n        "),"\n\n        vec4 result = ").concat(r,";\n        setOutput(result);\n      }\n    ")}}const NV={kernelName:tp,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:r}=t,a=n;if(1===a.length)return zG({inputs:{x:a[0]},backend:r});if(a.length>Hh().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const t=Math.floor(a.length/2),n=e({inputs:a.slice(0,t),backend:r}),i=e({inputs:a.slice(t),backend:r});return e({inputs:[n,i],backend:r})}const i=a.map((e=>e.dtype)).reduce(((e,t)=>sb(e,t))),o=a.map((e=>e.shape)),s=Hh().getBool("WEBGL_PACK")?new kV(a[0].shape,o):new IV(a[0].shape,o);return r.runWebGLProgram(s,a,i)}};const LV={kernelName:np,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:o}=r,s=a.shape.length,c=wh(i,a.shape);let u=c;const l=Vw(u,s);let f=a;null!=l&&(f=gV({inputs:{x:a},backend:n,attrs:{perm:l}}),u=Yw(u.length,s)),Gw("all",u,s);const[d,h]=Uw(f.shape,u),p=iV({inputs:{x:f},backend:n,attrs:{shape:[-1,ph(h)]}}),g=uV(p,p.dtype,"all",n);let m;if(o){m=iV({inputs:{x:g},backend:n,attrs:{shape:Ww(d,c)}})}else m=iV({inputs:{x:g},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),null!=l&&n.disposeIntermediateTensorInfo(f),m}};const AV={kernelName:rp,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:o}=r,s=a.shape.length,c=wh(i,a.shape);let u=c;const l=Vw(u,s);let f=a;null!=l&&(f=gV({inputs:{x:a},backend:n,attrs:{perm:l}}),u=Yw(u.length,s)),Gw("any",u,s);const[d,h]=Uw(f.shape,u),p=iV({inputs:{x:f},backend:n,attrs:{shape:[-1,ph(h)]}}),g=uV(p,p.dtype,"any",n);let m;if(o){m=iV({inputs:{x:g},backend:n,attrs:{shape:Ww(d,c)}})}else m=iV({inputs:{x:g},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),null!=l&&n.disposeIntermediateTensorInfo(f),m}};class RV{constructor(e,t,n){this.variableNames=["A"];const{windowSize:r,batchSize:a,outSize:i}=e;n||this.variableNames.push("bestIndicesA"),this.outputShape=[a,i];const o="max"===t?">":"<",s=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ".concat(r,";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ").concat(r,"; i++) {\n          int inIdx = ").concat(s,";\n          float candidate = getA(batch, inIdx);\n          if (candidate ").concat(o," bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    ")}}class DV{constructor(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,fh(e.length>2,(()=>"Packed arg".concat(n.charAt(0).toUpperCase()+n.slice(1)," supports only inputs with rank above 2.")));const a=e[e.length-1],i=Math.ceil(a/t);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");const o=this.outputShape,s=o.length,c=XU(s),u=gG("coords",s);let l,f;if(1===i){f=s+1;const e=XU(f);l="\n        ".concat(e," sourceLocR = ").concat(e,"(").concat(u.join(),", 0);\n        ++").concat(u[s-1],";\n        ").concat(e," sourceLocG = ").concat(e,"(").concat(u.join(),", 0);\n        ++").concat(u[s-2],";\n        ").concat(e," sourceLocA = ").concat(e,"(").concat(u.join(),", 0);\n        --").concat(u[s-1],";\n        ").concat(e," sourceLocB = ").concat(e,"(").concat(u.join(),", 0);\n        --").concat(u[s-2],";")}else f=s,l="\n        ".concat(c," sourceLocR = coords;\n        ++").concat(u[s-1],";\n        ").concat(c," sourceLocG = coords;\n        ++").concat(u[s-2],";\n        ").concat(c," sourceLocA = coords;\n        --").concat(u[s-1],";\n        ").concat(c," sourceLocB = coords;\n        --").concat(u[s-2],";");const d=["x","y","z","w","u","v"].slice(0,f),h="."+d[f-1],p=d.map((e=>"int "+e)),g=gG("sourceLocR",f-1).concat("inIdx.r"),m=gG("sourceLocG",f-1).concat("inIdx.g"),v=gG("sourceLocB",f-1).concat("inIdx.b"),b=gG("sourceLocA",f-1).concat("inIdx.a"),y="max"===n?"greaterThan":"lessThan",x=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel(".concat(g.join(),"),\n                             getBestIndicesAChannel(").concat(m.join(),"),\n                             getBestIndicesAChannel(").concat(v.join(),"),\n                             getBestIndicesAChannel(").concat(b.join(),")));"),w="vec4(\n            getAChannel(".concat(g.join(),"),\n            hasNextCol ? getAChannel(").concat(m.join(),") : 0.,\n            hasNextRow ? getAChannel(").concat(v.join(),") : 0.,\n            hasNextRow && hasNextCol ? getAChannel(").concat(b.join(),") : 0.)"),S=r?"":"\n      float getBestIndicesAChannel(".concat(p.join(),") {\n        return getChannel(getBestIndicesA(").concat(d.join(),"),\n                                          vec2(").concat(d.slice(-2).join(),"));\n      }");this.userCode="\n      float getAChannel(".concat(p.join(),") {\n        return getChannel(getA(").concat(d.join(),"),\n                               vec2(").concat(d.slice(-2).join(),"));\n      }\n      ").concat(S,"\n      void main() {\n        ").concat(c," coords = getOutputCoords();\n        bool hasNextCol = ").concat(u[s-1]," < ").concat(o[s-1]-1,";\n        bool hasNextRow = ").concat(u[s-2]," < ").concat(o[s-2]-1,";\n        ").concat(l,"\n        ivec4 srcIdx = ivec4(sourceLocR").concat(h,", sourceLocG").concat(h,",\n          sourceLocB").concat(h,", sourceLocA").concat(h,") * ").concat(t,";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ").concat(w,";\n\n        for (int i = 0; i < ").concat(t,"; i++) {\n          inIdx = srcIdx;\n          ").concat(x,"\n          vec4 candidate = ").concat(w,";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(").concat(y,"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    ")}}function OV(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=t.shape[0],i=t.shape[1];null!=r&&(a=r.shape[0],i=r.shape[1]);const o=$C(i),s={windowSize:o,inSize:i,batchSize:a,outSize:Math.ceil(i/o)},c=new RV(s,n,null==r),u=[t];null!=r&&u.push(r);const l=e.runWebGLProgram(c,u,"int32");if(1===l.shape[1])return l;const f=OV(e,t,n,l);return e.disposeIntermediateTensorInfo(l),f}function PV(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const a=null!=r?r.shape:t.shape,i=$C(a[a.length-1]),o=new DV(a,i,n,null==r),s=null==r?[t]:[t,r],c=e.runWebGLProgram(o,s,"int32");if(c.shape.length===t.shape.length){const r=PV(e,t,n,c);return e.disposeIntermediateTensorInfo(c),r}return c}function FV(e,t,n,r){const a=[n];if(Gw("arg"+r.charAt(0).toUpperCase()+r.slice(1),a,t.shape.length),!Hh().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){const n=[],i=e.texData.get(t.dataId);let o=t;null!==i&&i.isPacked&&(o=e.unpackTensor(t),n.push(o));const[s,c]=Uw(o.shape,a),u=ph(c),l=iV({inputs:{x:o},backend:e,attrs:{shape:[-1,u]}});n.push(l);const f=OV(e,l,r);n.push(f);const d=iV({inputs:{x:f},backend:e,attrs:{shape:s}});return n.forEach((t=>e.disposeIntermediateTensorInfo(t))),d}return PV(e,t,r)}const zV={kernelName:ap,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i}=r;let o=wh(i,a.shape);const s=Vw(o,a.shape.length);let c=a;const u=[];null!=s&&(c=gV({inputs:{x:a},backend:n,attrs:{perm:s}}),u.push(c),o=Yw(o.length,c.shape.length)),Gw("argMax",[o[0]],c.shape.length);const l=FV(n,c,o[0],"max");return u.forEach((e=>n.disposeIntermediateTensorInfo(e))),l}};const jV={kernelName:ip,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i}=r;let o=wh(i,a.shape);const s=Vw(o,a.shape.length);let c=a;const u=[];null!=s&&(c=gV({inputs:{x:a},backend:n,attrs:{perm:s}}),u.push(c),o=Yw(o.length,c.shape.length)),Gw("argMin",[o[0]],c.shape.length);const l=FV(n,c,o[0],"min");return u.forEach((e=>n.disposeIntermediateTensorInfo(e))),l}},BV=KG({opSnippet:CG+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"}),UV={kernelName:op,backendName:"webgl",kernelFunc:BV},WV=KG({opSnippet:CG+"return log(x + sqrt(x * x + 1.0));"}),GV={kernelName:sp,backendName:"webgl",kernelFunc:WV},VV=KG({opSnippet:CG+"\n  return atan(x);\n"}),HV={kernelName:cp,backendName:"webgl",kernelFunc:VV},YV=QG({opSnippet:DG+"\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+PG+"\n  return result;\n"}),XV={kernelName:lp,backendName:"webgl",kernelFunc:YV},qV=KG({opSnippet:CG+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"}),KV={kernelName:up,backendName:"webgl",kernelFunc:qV};class QV{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,o=e.strideHeight,s=e.strideWidth,c=e.dilationHeight,u=e.dilationWidth,l=e.effectiveFilterHeight,f=e.effectiveFilterWidth,d=e.padInfo.top,h=e.padInfo.left;this.outputShape=e.outShape;const p="avg"===t,g="((batch  * ".concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + d"),m="(xR * ".concat(e.inWidth," + xC) * ").concat(e.inChannels," + d");let v="0.0";if(p||(v="-1.0 / 1e-20"),n){const t=">=";return void(this.userCode="\n        const ivec2 strides = ivec2(".concat(o,", ").concat(s,");\n        const ivec2 pads = ivec2(").concat(d,", ").concat(h,");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ").concat(l,";\n              wR += ").concat(c,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(f,";\n                wC += ").concat(u,") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ").concat(t," currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ").concat(r?a?g:m:"wR * ".concat(f," + wC"),";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      "))}let b="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(b="avgValue / max(count, 1.0)");const y=4*Math.floor(i/4),x=i%4,w="\n      if (".concat(p,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat("max","(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec2 strides = ivec2(".concat(o,", ").concat(s,");\n      const ivec2 pads = ivec2(").concat(d,", ").concat(h,");\n      const float initializationValue = ").concat(v,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ").concat(e.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(v,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ").concat(l,";\n            wR += ").concat(c,") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ").concat(e.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(y,"; wC += 4) {\n            int xC = xCCorner + wC * ").concat(u,";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(u,", d),\n              getValue(batch, xR, xC + 2 * ").concat(u,", d),\n              getValue(batch, xR, xC + 3 * ").concat(u,", d)\n            );\n\n            ").concat(w,"\n          }\n\n          int xC = xCCorner + ").concat(y,";\n          if (").concat(1===x,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(w,"\n          } else if (").concat(2===x,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(u,", d),\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(w,"\n          } else if (").concat(3===x,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(u,", d),\n              getValue(batch, xR, xC + 2 * ").concat(u,", d),\n              initializationValue\n            );\n\n            ").concat(w,"\n          }\n        }\n        setOutput(").concat(b,");\n      }\n    ")}}class JV{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,o=e.strideDepth,s=e.strideHeight,c=e.strideWidth,u=e.dilationDepth,l=e.dilationHeight,f=e.dilationWidth,d=e.effectiveFilterDepth,h=e.effectiveFilterHeight,p=e.effectiveFilterWidth,g=e.padInfo.front,m=e.padInfo.top,v=e.padInfo.left;this.outputShape=e.outShape;const b="avg"===t;let y="0.0";if(b||(y="-1.0 / 1e-20"),n){const t=">=";return void(this.userCode="\n        const ivec3 strides =\n            ivec3(".concat(o,", ").concat(s,", ").concat(c,");\n        const ivec3 pads = ivec3(").concat(g,", ").concat(m,", ").concat(v,");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ").concat(d,";\n              wD += ").concat(u,") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ").concat(e.inDepth,") {\n              continue;\n            }\n\n            for (int wR = 0; wR < ").concat(h,";\n                wR += ").concat(l,") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ").concat(e.inHeight,") {\n                continue;\n              }\n\n              for (int wC = 0; wC < ").concat(p,";\n                  wC += ").concat(f,") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ").concat(t," currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ").concat(r?a?"(((batch * ".concat(e.inDepth," + xD) * ").concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + ch"):"((xD * ".concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + ch"):"wD * ".concat(h," * ").concat(p," +\n                      wR * ").concat(p," + wC"),";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      "))}let x="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(x="avgValue / max(count, 1.0)");const w=4*Math.floor(i/4),S=i%4,C="\n      if (".concat(b,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat("max","(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec3 strides =\n        ivec3(".concat(o,", ").concat(s,", ").concat(c,");\n      const ivec3 pads = ivec3(").concat(g,", ").concat(m,", ").concat(v,");\n      const float initializationValue = ").concat(y,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ").concat(e.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(y,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ").concat(d,";\n            wD += ").concat(u,") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ").concat(e.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(h,";\n            wR += ").concat(l,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(w,"; wC += 4) {\n              int xC = xCCorner + wC * ").concat(f,";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(f,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(f,", ch),\n                getValue(batch, xD, xR, xC + 3 * ").concat(f,", ch)\n              );\n\n              ").concat(C,"\n            }\n\n            int xC = xCCorner + ").concat(w,";\n            if (").concat(1===S,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(C,"\n            } else if (").concat(2===S,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(f,", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(C,"\n            } else if (").concat(3===S,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(f,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(f,", ch),\n                initializationValue\n              );\n\n              ").concat(C,"\n            }\n          }\n        }\n        setOutput(").concat(x,");\n      }\n    ")}}const ZV={kernelName:fp,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t;kU(a,"avgPool");const{filterSize:i,strides:o,pad:s,dimRoundingMode:c}=r;fh(Kx(o,1),(()=>"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")));const u=jx(a.shape,i,o,1,s,c);if(1===u.filterWidth&&1===u.filterHeight&&gh(u.inShape,u.outShape))return zG({inputs:{x:a},backend:n});const l=new QV(u,"avg",!1);return n.runWebGLProgram(l,[a],"float32")}};const $V={kernelName:hp,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:i,strides:o,pad:s,dimRoundingMode:c,dataFormat:u}=r,l=Bx(a.shape,i,o,[1,1,1],s,c,u),f=new JV(l,"avg",!1);return n.runWebGLProgram(f,[a],"float32")}};class eH{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,i=e.dilationHeight,o=e.dilationWidth,s=e.effectiveFilterHeight,c=e.effectiveFilterWidth,u=s-1-e.padInfo.top,l=c-1-e.padInfo.left,f=1/(t*n);this.userCode="\n      const ivec2 pads = ivec2(".concat(u,", ").concat(l,");\n      const float avgMultiplier = float(").concat(f,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(s,";\n            wR += ").concat(i,") {\n          float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(c,";\n            wC+= ").concat(o,") {\n            float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class tH{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,a=e.strideDepth,i=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,l=e.effectiveFilterDepth,f=e.effectiveFilterHeight,d=e.effectiveFilterWidth,h=l-1-e.padInfo.front,p=f-1-e.padInfo.top,g=d-1-e.padInfo.left,m=1/(t*n*r);this.userCode="\n      const ivec3 pads = ivec3(".concat(h,", ").concat(p,", ").concat(g,");\n      const float avgMultiplier = float(").concat(m,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(l,";\n            wD += ").concat(s,") {\n          float dyD = float(dyDCorner + wD) / ").concat(a,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(e.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(f,";\n              wR += ").concat(c,") {\n            float dyR = float(dyRCorner + wR) / ").concat(i,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(d,";\n                wC += ").concat(u,") {\n              float dyC = float(dyCCorner + wC) / ").concat(o,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}const nH={kernelName:pp,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,o=i,{filterSize:s,strides:c,pad:u,dimRoundingMode:l}=r,f=Bx(o.shape,s,c,[1,1,1],u,l),d=new tH(f);return n.runWebGLProgram(d,[a],o.dtype)}};const rH={kernelName:dp,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,o=i;kU([a,i],"avgPoolGrad");const{filterSize:s,strides:c,pad:u}=r,l=jx(o.shape,s,c,1,u),f=new eH(l);return n.runWebGLProgram(f,[a],o.dtype)}};const aH={kernelName:gp,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{a:a,b:i}=t,{transposeA:o,transposeB:s}=r;return vV({a:a,b:i,transposeA:o,transposeB:s,backend:n})}};class iH{constructor(e,t,n,r,a,i){this.outputShape=[],this.variableNames=["x","mean","variance"],tx(e,t),tx(e,n);let o="0.0";null!=r&&(tx(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");let s="1.0";null!=a&&(tx(e,a),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ".concat(o,";\n        float scale = ").concat(s,";\n        float inv = scale * inversesqrt(variance + float(").concat(i,"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    ")}}class oH{constructor(e,t,n,r,a,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],tx(e,t),tx(e,n);let o="vec4(0.0)";null!=r&&(tx(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");let s="vec4(1.0)";null!=a&&(tx(e,a),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        vec4 offset = ".concat(o,";\n        vec4 scale = ").concat(s,";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(").concat(i,"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    ")}}const sH={kernelName:sg,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e;const{x:a,mean:i,variance:o,offset:s,scale:c}=t;fh(i.shape.length===o.shape.length,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),fh(null==s||i.shape.length===s.shape.length,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),fh(null==c||i.shape.length===c.shape.length,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));let{varianceEpsilon:u}=r;null==u&&(u=.001);const l=[a,i,o];let f=null;null!=s&&(f=s.shape,l.push(s));let d=null;null!=c&&(d=c.shape,l.push(c));const h=Hh().getBool("WEBGL_PACK_NORMALIZATION")?new oH(a.shape,i.shape,o.shape,f,d,u):new iH(a.shape,i.shape,o.shape,f,d,u);return n.runWebGLProgram(h,l,l[0].dtype)}};class cH{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=XU(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=function(e){if(1===e)return"sourceLoc";if(e<=6)return uH.slice(0,e).map((e=>"sourceLoc."+e)).join(",");throw Error("Slicing for rank ".concat(e," is not yet supported"))}(this.rank);let r;const a=e.map(((e,t)=>"sourceLoc.".concat(uH[t]," = start[").concat(t,"] + coords.").concat(uH[t],";")));r="\n        ".concat(t," sourceLoc;\n        ").concat(t," coords = getOutputCoords();\n        ").concat(a.join("\n"),"\n      "),this.userCode="\n      void main() {\n        ".concat(r,"\n        setOutput(getSource(").concat(n,"));\n      }\n    ")}}const uH=["x","y","z","w","u","v"];class lH{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=XU(this.rank),n=gG("coords",this.rank),r=gG("sourceLoc",this.rank),a=1===this.rank?"sourceLoc":"vec2(".concat(r.slice(-2).join(),")"),i="getChannel(getSource(".concat(r.join(),"), ").concat(a,")"),o="\n      result.x = ".concat(i,";\n      if (++").concat(n[this.rank-1]," < ").concat(e[this.rank-1],") {\n        ++").concat(r[this.rank-1],";\n        result.y = ").concat(i,";\n        --").concat(r[this.rank-1],";\n      }\n    "),s=1===this.rank?"":"\n      --".concat(n[this.rank-1],";\n      if (++").concat(n[this.rank-2]," < ").concat(e[this.rank-2],") {\n        ++").concat(r[this.rank-2],";\n        result.z = ").concat(i,";\n        if (++").concat(n[this.rank-1]," < ").concat(e[this.rank-1],") {\n          ++").concat(r[this.rank-1],";\n          result.w = ").concat(i,";\n        }\n      }\n    "),c=this.rank<=4?"sourceLoc = coords +\n            ".concat(t,"(").concat(e.map(((e,t)=>"start[".concat(t,"]"))).join(),");"):e.map(((e,t)=>"".concat(r[t]," = ").concat(n[t]," + start[").concat(t,"];"))).join("\n");this.userCode="\n      void main() {\n        ".concat(t," coords = getOutputCoords();\n        ").concat(t," sourceLoc;\n        ").concat(c,"\n        vec4 result = vec4(0.);\n        ").concat(o,"\n        ").concat(s,"\n        setOutput(result);\n      }\n    ")}}function fH(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:i,size:o}=r,[s,c]=Ax(a,i,o);if(bx(a,s,c),0===ph(c))return n.makeTensorInfo(c,a.dtype,[]);if(n.shouldExecuteOnCPU([a])||"string"===a.dtype){const e=n.texData.get(a.dataId),t=$W(e.values,s,c,a.shape,a.dtype);return n.makeTensorInfo(c,a.dtype,t)}const{isPacked:u}=n.texData.get(a.dataId),l=Nx(a.shape,s,c);if(u||!l){const e=Hh().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new lH(c):new cH(c),t=[s];return n.runWebGLProgram(e,[a],a.dtype,t)}return n.uploadToGPU(a.dataId),function(e,t,n,r){const a=r.texData.get(e.dataId),i=r.makeTensorInfo(n,e.dtype),o=r.texData.get(i.dataId);Object.assign(o,a),o.refCount=1,o.shape=n,o.dtype=e.dtype;let s=Lx(t,Ah(e.shape));a.slice&&(s+=a.slice.flatOffset),o.slice={flatOffset:s,origDataId:a.slice&&a.slice.origDataId||e.dataId};const c=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,c+1),i}(a,s,c,n)}const dH={kernelName:Sm,backendName:"webgl",kernelFunc:fH},hH={kernelName:mp,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:i,crops:o}=r;fh(a.shape.length<=4,(()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"));const s=i.reduce(((e,t)=>e*t)),c=tM(a.shape,i,s),u=nM(c.length,i.length),l=rM(a.shape,i,s),f=aM(o,i.length),d=iM(l,o,i.length),h=[],p=iV({inputs:{x:a},backend:n,attrs:{shape:c}}),g=gV({inputs:{x:p},backend:n,attrs:{perm:u}}),m=iV({inputs:{x:g},backend:n,attrs:{shape:l}}),v=fH({inputs:{x:m},backend:n,attrs:{begin:f,size:d}});return h.push(p),h.push(g),h.push(m),h.forEach((e=>n.disposeIntermediateTensorInfo(e))),v}};const pH={kernelName:vp,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,weights:i}=t,{size:o}=r,s=n.readSync(a.dataId),c=n.readSync(i.dataId),u=xW(s,c,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,u)}};const gH={kernelName:bp,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{a:r,b:a}=t,i=Hh().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=Hh().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([r,a])||1===o){const e=n.texData.get(r.dataId).values,t=n.texData.get(a.dataId).values,[i,o]=SW(r.shape,a.shape,e,t,r.dtype),s=n.makeTensorInfo(o,r.dtype);return n.texData.get(s.dataId).values=i,s}let s;return s=i?new FG("\n  int r = int(a.r) & int(b.r);\n  int g = int(a.g) & int(b.g);\n  int rb = int(a.b) & int(b.b);\n  int ra = int(a.a) & int(b.a);\n  return vec4(r, g, rb, ra);\n",r.shape,a.shape,!1):new OG("\n  return float(int(a.r) & int(b.r));\n",r.shape,a.shape),n.runWebGLProgram(s,[r,a],r.dtype)}};const mH={kernelName:yp,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{s0:r,s1:a}=t,i=n.readSync(r.dataId),o=n.readSync(a.dataId),s=tx(Array.from(i),Array.from(o));return n.makeTensorInfo([s.length],"int32",Int32Array.from(s))}},vH=QG({opSnippet:"return float(a != b);",cpuKernelImpl:GW,dtype:"bool"}),bH={kernelName:Vg,backendName:"webgl",kernelFunc:vH};function yH(e){const{inputs:t,backend:n}=e,{input:r}=t;return zG({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}const xH={kernelName:im,backendName:"webgl",kernelFunc:yH};const wH={kernelName:xp,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:r,attrs:a}=t,{x:i}=n,{dtype:o}=a;if("complex64"===o){if("complex64"===i.dtype)return zG({inputs:{x:i},backend:r});const t=iS(i.shape),n=e({inputs:{x:i},backend:r,attrs:{dtype:"float32"}}),a=BG({inputs:{real:n,imag:t},backend:r});return t.dispose(),r.disposeIntermediateTensorInfo(n),a}if("complex64"===i.dtype){const t=yH({inputs:{input:i},backend:r}),n=e({inputs:{x:t},backend:r,attrs:{dtype:o}});return r.disposeIntermediateTensorInfo(t),n}if(!_h(i.dtype,o)){const e=zG({inputs:{x:i},backend:r});return{dataId:e.dataId,shape:e.shape,dtype:o}}if(r.shouldExecuteOnCPU([i])){const e=r.texData.get(i.dataId).values,[t,n,a]=CW(e,i.shape,i.dtype,o);return r.makeTensorInfo(t,n,a)}if("int32"===o)return function(e,t){const n=new SG(e.shape,"return float(int(x));"),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(i,r);if("bool"===o){const e=r.makeTensorInfo([],"bool",Ch("bool",1)),t=vH({inputs:{a:i,b:e},backend:r});return r.disposeIntermediateTensorInfo(e),t}throw new Error("Error in Cast: failed to cast ".concat(i.dtype," to ").concat(o))}},SH="return ceil(x);",CH=KG({opSnippet:SH,packedOpSnippet:SH,cpuKernelImpl:MW}),MH={kernelName:wp,backendName:"webgl",kernelFunc:CH};class _H{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}}class EH{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}}const TH={kernelName:Sp,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{clipValueMin:i,clipValueMax:o}=r;let s;s=Hh().getBool("WEBGL_PACK_CLIP")?new EH(a.shape):new _H(a.shape);const c=[[i],[o]];return n.runWebGLProgram(s,[a],a.dtype,c)}};class IH{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}}function kH(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}const NH={kernelName:Mp,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t,a=n.texData.get(r.dataId),i=new IH(r.shape),o=[kH(r,a.complexTensorInfos.real),kH(r,a.complexTensorInfos.imag)];return n.runWebGLProgram(i,o,o[0].dtype)}};class LH{constructor(e){this.outputShape=[],this.outputShape=YC(e,1),this.variableNames=e.map(((e,t)=>"T".concat(t)));const t=new Array(e.length-1);t[0]=e[0][1];for(let i=1;i<t.length;i++)t[i]=t[i-1]+e[i][1];const n=["if (yC < ".concat(t[0],") setOutput(getT0(yR, yC));")];for(let i=1;i<t.length;i++){const e=t[i-1];n.push("else if (yC < ".concat(t[i],") ")+"setOutput(getT".concat(i,"(yR, yC-").concat(e,"));"))}const r=t.length,a=t[t.length-1];n.push("else setOutput(getT".concat(r,"(yR, yC-").concat(a,"));")),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ".concat(n.join("\n        "),"\n      }\n    ")}}class AH{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=YC(e,t);const n=this.outputShape,r=n.length,a=XU(r),i=gG("coords",r),o=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map(((e,t)=>"T".concat(t)));const s=new Array(e.length-1);s[0]=e[0][t];for(let p=1;p<s.length;p++)s[p]=s[p-1]+e[p][t];const c=o[t],u=o.slice(-2),l=o.join();let f="if (".concat(c," < ").concat(s[0],") {\n        return getChannel(\n            getT0(").concat(l,"), vec2(").concat(u.join(),"));\n        }");for(let p=1;p<s.length;p++){const e=s[p-1];f+="\n        if (".concat(c," < ").concat(s[p],"  && ").concat(c," >= ").concat(s[p-1],") {\n          return getChannel(\n            getT").concat(p,"(").concat(RH(o,c,e),"),\n            vec2(").concat(RH(u,c,e),"));\n        }")}const d=s.length,h=s[s.length-1];f+="\n        return getChannel(\n          getT".concat(d,"(").concat(RH(o,c,h),"),\n          vec2(").concat(RH(u,c,h),"));"),this.userCode="\n      float getValue(".concat(o.map((e=>"int "+e)),") {\n        ").concat(f,"\n      }\n\n      void main() {\n        ").concat(a," coords = getOutputCoords();\n        vec4 result = vec4(getValue(").concat(i,"), 0., 0., 0.);\n\n        ").concat(i[r-1]," = ").concat(i[r-1]," + 1;\n        if (").concat(i[r-1]," < ").concat(n[r-1],") {\n          result.g = getValue(").concat(i,");\n        }\n\n        ").concat(i[r-2]," = ").concat(i[r-2]," + 1;\n        if (").concat(i[r-2]," < ").concat(n[r-2],") {\n          result.a = getValue(").concat(i,");\n        }\n\n        ").concat(i[r-1]," = ").concat(i[r-1]," - 1;\n        if (").concat(i[r-2]," < ").concat(n[r-2]," &&\n            ").concat(i[r-1]," < ").concat(n[r-1],") {\n          result.b = getValue(").concat(i,");\n        }\n        setOutput(result);\n      }\n    ")}}function RH(e,t,n){const r=e.indexOf(t);return e.map(((e,t)=>t===r?"".concat(e," - ").concat(n):e)).join()}function DH(e){const{inputs:t,backend:n}=e,{input:r}=t;return zG({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}const OH={kernelName:pg,backendName:"webgl",kernelFunc:DH};function PH(e,t,n){const r=e[0].dtype;if("complex64"===r){const r=e.map((e=>yH({inputs:{input:e},backend:n}))),a=e.map((e=>DH({inputs:{input:e},backend:n}))),i=PH(r,t,n),o=PH(a,t,n),s=BG({inputs:{real:i,imag:o},backend:n});return r.forEach((e=>n.disposeIntermediateTensorInfo(e))),a.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),s}let a=n.shouldExecuteOnCPU(e);if("string"===r&&(a=!0),a){const a=e.map((e=>{const r=ph(e.shape.slice(t));return iV({inputs:{x:e},backend:n,attrs:{shape:[-1,r]}})})),i=a.map((e=>({vals:n.readSync(e.dataId),shape:e.shape}))),o=YC(a.map((e=>e.shape)),1),s=1===a[0].shape[0],c=_W(i,o,r,s),u=YC(e.map((e=>e.shape)),t),l=n.makeTensorInfo(u,r,c);return a.forEach((e=>n.disposeIntermediateTensorInfo(e))),l}const i=e.filter((e=>ph(e.shape)>0)),o=Hh().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1;if(1===i.length){const t=o?new SG(e[0].shape,TG):new IG(e[0].shape,TG);return n.runWebGLProgram(t,e,r)}const s=Hh().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(i.length>s){const e=[];for(let a=0;a<i.length;a+=s){const r=i.slice(a,a+s);e.push(PH(r,t,n))}const r=PH(e,t,n);for(const t of e)n.disposeIntermediateTensorInfo(t);return r}if(o){const e=new AH(i.map((e=>e.shape)),t);return n.runWebGLProgram(e,i,r)}const{tensors2D:c,outShape:u}=function(e,t,n){const r=YC(e.map((e=>e.shape)),t),a=e.map((e=>iV({inputs:{x:e},attrs:{shape:[-1,ph(e.shape.slice(t))]},backend:n})));return{tensors2D:a,outShape:r}}(i,t,n),l=new LH(c.map((e=>e.shape))),f=n.runWebGLProgram(l,c,r);c.forEach((e=>n.disposeIntermediateTensorInfo(e)));const d=iV({inputs:{x:f},attrs:{shape:u},backend:n});return n.disposeIntermediateTensorInfo(f),d}function FH(e){const{inputs:t,backend:n,attrs:r}=e,{axis:a}=r,i=wh(a,t[0].shape)[0];HC(t.map((e=>e.shape)),i);const o=YC(t.map((e=>e.shape)),i);if(0===ph(o))return n.makeTensorInfo(o,t[0].dtype,[]);const s=t.filter((e=>ph(e.shape)>0));return 1===s.length?zG({inputs:{x:s[0]},backend:n}):PH(s,i,n)}const zH={kernelName:_p,backendName:"webgl",kernelFunc:FH};class jH{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.variableNames=["x","W"],this.outputShape=e.outShape;const i=e.padInfo.top,o=e.padInfo.left,s=e.strideHeight,c=e.strideWidth,u=e.dilationHeight,l=e.dilationWidth,f=e.filterHeight,d=e.filterWidth,h=4*Math.floor(e.inChannels/4),p=e.inChannels%4,g="channelsLast"===e.dataFormat,m=g?1:2,v=g?2:3,b=g?3:1;let y="",x="";n&&(y=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(n,"\n        }"):a?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(n,"\n        }"):"\n          float activation(float x) {\n            ".concat(n,"\n          }\n        "),x="result = activation(result);");const w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(y,"\n\n      const ivec2 strides = ivec2(").concat(s,", ").concat(c,");\n      const ivec2 pads = ivec2(").concat(i,", ").concat(o,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[").concat(b,"];\n\n        ivec2 xRCCorner =\n            ivec2(coords[").concat(m,"], coords[").concat(v,"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(f,"; wR++) {\n          int xR = xRCorner + wR * ").concat(u,";\n\n          if (xR < 0 || xR >= ").concat(e.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(d,"; wC++) {\n            int xC = xCCorner + wC * ").concat(l,";\n\n            if (xC < 0 || xC >= ").concat(e.inWidth,") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ").concat(h,"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (").concat(g,") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (").concat(1===p,") {\n\n              if (").concat(g,") {\n                dotProd +=\n                    getX(batch, xR, xC, ").concat(h,") *\n                    getW(wR, wC, ").concat(h,", d2);\n              } else {\n                dotProd +=\n                    getX(batch, ").concat(h,", xR, xC) *\n                    getW(wR, wC, ").concat(h,", d2);\n              }\n\n            } else if (").concat(2===p,") {\n              vec2 wValues = vec2(\n                getW(wR, wC, ").concat(h,", d2),\n                getW(wR, wC, ").concat(h," + 1, d2)\n              );\n\n              if (").concat(g,") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ").concat(h,"),\n                  getX(batch, xR, xC, ").concat(h," + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ").concat(h,", xR, xC),\n                  getX(batch, ").concat(h," + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (").concat(3===p,") {\n              vec3 wValues = vec3(\n                getW(wR, wC, ").concat(h,", d2),\n                getW(wR, wC, ").concat(h," + 1, d2),\n                getW(wR, wC, ").concat(h," + 2, d2)\n              );\n\n              if (").concat(g,") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ").concat(h,"),\n                  getX(batch, xR, xC, ").concat(h," + 1),\n                  getX(batch, xR, xC, ").concat(h," + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ").concat(h,", xR, xC),\n                  getX(batch, ").concat(h," + 1, xR, xC),\n                  getX(batch, ").concat(h," + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ").concat(w,"\n        ").concat(x,"\n        setOutput(result);\n      }\n    ")}}class BH{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,a=e.strideDepth,i=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,l=e.filterDepth,f=e.filterHeight,d=e.filterWidth,h=4*Math.floor(e.inChannels/4),p=e.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3(".concat(a,", ").concat(i,", ").concat(o,");\n      const ivec3 pads = ivec3(").concat(t,", ").concat(n,", ").concat(r,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(l,"; wF++) {\n          int xF = xFCorner + wF * ").concat(s,";\n\n          if (xF < 0 || xF >= ").concat(e.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(f,"; wR++) {\n            int xR = xRCorner + wR * ").concat(c,";\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(d,"; wC++) {\n              int xC = xCCorner + wC * ").concat(u,";\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ").concat(h,"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (").concat(1===p,") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ").concat(h,") *\n                  getW(wF, wR, wC, ").concat(h,", d2);\n              } else if (").concat(2===p,") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ").concat(h,"),\n                  getX(batch, xF, xR, xC, ").concat(h," + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ").concat(h,", d2),\n                  getW(wF, wR, wC, ").concat(h," + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (").concat(3===p,") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ").concat(h,"),\n                  getX(batch, xF, xR, xC, ").concat(h," + 1),\n                  getX(batch, xF, xR, xC, ").concat(h," + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ").concat(h,", d2),\n                  getW(wF, wR, wC, ").concat(h," + 1, d2),\n                  getW(wF, wR, wC, ").concat(h," + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class UH{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=eW(this.outputShape.length);const i=e.padInfo.left,o=e.strideWidth,s=e.dilationWidth,c=e.filterHeight,u=e.filterWidth,l=u;let f="\n       int xR; int xC; int xCOffset;\n       vec4 wTexel; vec4 previous; vec4 final;";for(let g=0;g<u;g++)f+="\n           vec4 xTexelC".concat(2*g,";\n           int xTexelC").concat(2*g,"Ready;\n           vec4 xTexelC").concat(2*g+1,";\n           int xTexelC").concat(2*g+1,"Ready;\n           vec4 xC").concat(g,";");f+="\n     for (int r = 0; r < ".concat(c,"; r++) {\n      for (int d1 = 0; d1 < ").concat(e.inChannels,"; d1 += 2) {\n       ");for(let g=0;g<u;g++)f+="\n           xTexelC".concat(2*g," = vec4(0.0);\n           xTexelC").concat(2*g,"Ready = 0;\n           xTexelC").concat(2*g+1," = vec4(0.0);\n           xTexelC").concat(2*g+1,"Ready = 0;\n           xC").concat(g," = vec4(0.0);");f+="\n         xR = xRCorner + r * dilations[0];\n         if (xR >=0 && xR < inDims[0]) {\n       ";for(let g=0;g<(l+1)/2;g++){const t=2*g;if(f+="\n           xC = xCCorner + ".concat(t*s,";\n           "),1===o){if(t<u&&(i%2===1?(f+="\n                 xCOffset = xC + 1;\n                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(t,"Ready == 0) {\n                   xTexelC").concat(t," = getX(batch, xR, xCOffset, d1);\n\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(t,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(t,"Ready = 1;\n                 }\n               "),f+=1===s&&t>0?"\n                 xC".concat(t," = vec4(xTexelC").concat(t-2,".zw, xTexelC").concat(t,".xy);\n                 "):"\n                   xCOffset = xC + 1 - 2;\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       previous.zw = vec2(0.0);\n                     }\n\n                     xC".concat(t," = vec4(previous.zw, xTexelC").concat(t,".xy);\n                   } else {\n                     xC").concat(t," = vec4(0.0, 0.0, xTexelC").concat(t,".xy);\n                   }\n                   ")):f+="\n                 if (xC >= 0 && xC < inDims[1] && xTexelC".concat(t,"Ready == 0) {\n                   xTexelC").concat(t," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(t,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(t,"Ready = 1;\n                 }\n\n                 xC").concat(t," = xTexelC").concat(t,";\n                 "),t+1<u)){const e=i%2===0?uh(s):s;s%2===0&&i%2===1||s%2!==0&&i%2!==1?(f+="\n                   xCOffset = xC + imod(pads[1], 2) + ".concat(e,";\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(t+1,"Ready == 0) {\n                     xTexelC").concat(t+1," = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       xTexelC").concat(t+1,".zw = vec2(0.0);\n                     }\n                     xTexelC").concat(t+1,"Ready = 1;\n                   }\n                   "),f+=s>1?"\n                     xCOffset -= 2;\n                     if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                      previous = getX(batch, xR, xCOffset, d1);\n                      xC".concat(t+1," = vec4(previous.zw, xTexelC").concat(t+1,".xy);\n                     } else {\n                      xC").concat(t+1," = vec4(0.0, 0.0, xTexelC").concat(t+1,".xy);\n                     }\n                     "):"\n                     xC".concat(t+1," = vec4(xTexelC").concat(t,".zw, xTexelC").concat(t+1,".xy);\n                     ")):f+=1===e?"\n                     xC".concat(t+1," = xTexelC").concat(t,";\n                     "):"\n                     xCOffset = xC + ".concat(e,";\n\n                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(t+1,"Ready == 0) {\n                       xTexelC").concat(t+1," = getX(batch, xR, xCOffset, d1);\n                       if (xCOffset + 1 >= inDims[1]) {\n                         xTexelC").concat(t+1,".zw = vec2(0.0);\n                       }\n                       xTexelC").concat(t+1,"Ready = 1;\n                     }\n\n                     xC").concat(t+1," = xTexelC").concat(t+1,";\n                     ")}}else t<u&&(i%2===1?(f+="\n                 xCOffset = xC + 1 - strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(t,"Ready == 0) {\n                   xTexelC").concat(t," = getX(batch, xR, xCOffset, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(t,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(t,"Ready = 1;\n                 }\n\n                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(t+1,"Ready == 0) {\n                   xTexelC").concat(t+1," = getX(batch, xR, xC + 1, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xC + 2 >= inDims[1]) {\n                     xTexelC").concat(t+1,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(t+1,"Ready = 1;\n                 }\n\n                 xC").concat(t," = vec4(xTexelC").concat(t,".zw, xTexelC").concat(t+1,".zw);\n               "),t+1<u&&(f+="\n                   final = vec4(0.0);\n                   xCOffset = xC + 1 + strides[1];\n                   if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                     final = getX(batch, xR, xCOffset, d1);\n                   }\n                   xC".concat(t+1," = vec4(xTexelC").concat(t+1,".xy, final.xy);\n                 "))):(f+="\n                 if(xC >= 0 && xC < inDims[1] && xTexelC".concat(t,"Ready == 0) {\n                   xTexelC").concat(t," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(t,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(t,"Ready = 1;\n                 }\n\n                 xCOffset = xC + strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(t+1,"Ready == 0) {\n                   xTexelC").concat(t+1," = getX(batch, xR, xCOffset, d1);\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(t+1,".zw = vec2(0.);\n                   }\n                   xTexelC").concat(t+1,"Ready = 1;\n                 }\n\n                 xC").concat(t," = vec4(\n                   xTexelC").concat(t,".xy, xTexelC").concat(t+1,".xy);\n               "),t+1<u&&(f+="\n                   xC".concat(t+1," = vec4(xTexelC").concat(t,".zw, xTexelC").concat(t+1,".zw);\n                 "))));t<u&&(f+="\n             wTexel = getW(r, ".concat(t,", d1, d2);\n             dotProd += xC").concat(t,".xxzz * vec4(wTexel.xy, wTexel.xy);\n             if(d1 + 1 < ").concat(e.inChannels,") {\n               dotProd += xC").concat(t,".yyww * vec4(wTexel.zw, wTexel.zw);\n             }\n           "),t+1<u&&(f+="\n               wTexel = getW(r, ".concat(t+1,", d1, d2);\n               dotProd += xC").concat(t+1,".xxzz * vec4(wTexel.xy, wTexel.xy);\n               if(d1 + 1 < ").concat(e.inChannels,") {\n                 dotProd += xC").concat(t+1,".yyww * vec4(wTexel.zw, wTexel.zw);\n               }\n             ")))}f+="\n     }\n   ",f+="\n     }\n   ",f+="\n     }\n   ";let d="",h="";n&&(d=r?"vec4 activation(vec4 a) {\n           vec4 b = getPreluActivationWeightsAtOutCoords();\n           ".concat(n,"\n         }"):a?"vec4 activation(vec4 a) {\n           vec4 b = getLeakyreluAlphaAtOutCoords();\n           ".concat(n,"\n         }"):"vec4 activation(vec4 x) {\n           ".concat(n,"\n         }"),h="result = activation(result);");const p=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n       ".concat(d,"\n\n       void main() {\n         ivec4 coords = getOutputCoords();\n         int batch = coords.x;\n         ivec2 xRCCorner = coords.yz * strides - pads;\n         int d2 = coords.w;\n         int xRCorner = xRCCorner.x;\n         int xCCorner = xRCCorner.y;\n\n         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n         vec4 dotProd = vec4(0.000000000000001);\n\n         ").concat(f,"\n\n         vec4 result = dotProd - vec4(0.000000000000001);\n         ").concat(p,"\n         ").concat(h,"\n         setOutput(result);\n       }\n     ")}}class WH{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=eW(this.outputShape.length);const{dataFormat:n}=t,r=LU(),a="channelsLast"===n,i=a?1:2,o=a?2:3,s=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":"if(blockIndex < ".concat(e[2]," && pos < ").concat(e[1],") {");let c="";for(let u=0;u<=1;u++)for(let e=0;e<=1;e++)c+="\n          blockIndex = rc.z + ".concat(e,";\n          pos = rc.y + ").concat(u,";\n\n          ").concat(s,"\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[").concat(i,"] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[").concat(o,"] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (").concat(a,") {\n                  innerDims = vec2(d1, ch);\n                  result[").concat(2*u+e,"] = getChannel(\n                    getA(rc.x, d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[").concat(2*u+e,"] = getChannel(\n                    getA(rc.x, ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ");this.userCode="\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ".concat(c,"\n\n        ").concat(r.output," = result;\n      }\n    ")}}function GH(e,t){const n=e.length;return n>=3?t?[...e.slice(0,-3),e[n-3]*e[n-2],e[n-1]]:[...e.slice(0,-3),e[n-3],e[n-2]*e[n-1]]:!t&&1===n&&e[0]>1?[e[0],1]:null}function VH(e){let{x:t,filter:n,convInfo:r,backend:a,bias:i=null,preluActivationWeights:o=null,leakyreluAlpha:s=0,activation:c=null}=e;const u=t.shape,l=a.texData.get(t.dataId),f=r.inChannels,d=u[0]*u[1]*u[2],h=r.outChannels,p="channelsLast"===r.dataFormat,g=!1;let m;const v=[];if(null!=o){const e=GH(o.shape,p);null!=e&&(o=iV({inputs:{x:o},backend:a,attrs:{shape:e}}),v.push(o))}if(null!=i){const e=GH(i.shape,p);null!=e&&(i=iV({inputs:{x:i},backend:a,attrs:{shape:e}}),v.push(i))}if(!((1===d||1===h)&&f>1e3)&&l.isPacked&&p&&null!=l.texture&&u[2]%2!==0&&gh(l.shape.slice(-3),u.slice(-3))){const e=u[0]*u[1]*(u[2]+1),f={dataId:t.dataId,shape:[1,e,r.inChannels],dtype:t.dtype},d=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,fh(SU(l.shape,f.shape),(()=>"packed reshape ".concat(l.shape," to ").concat(f.shape," isn't free")));const h=iV({inputs:{x:n},backend:a,attrs:{shape:[1,r.inChannels,r.outChannels]}});v.push(h);const p=vV({a:f,b:h,backend:a,transposeA:false,transposeB:g,bias:i,activation:c,preluActivationWeights:o,leakyreluAlpha:s}),b=a.texData.get(p.dataId);fh(b.isPacked,(()=>"batchMatMul result is expected to be packed")),l.shape=d,b.shape=r.outShape,m=zG({inputs:{x:p},backend:a}),m.shape=r.outShape,v.push(p)}else{const e=r.outHeight*r.outWidth,u=iV({inputs:{x:t},backend:a,attrs:{shape:p?[r.batchSize,e,r.inChannels]:[r.batchSize,r.inChannels,e]}}),l=iV({inputs:{x:n},backend:a,attrs:{shape:[1,r.inChannels,r.outChannels]}}),f=vV({a:p?u:l,b:p?l:u,transposeA:!p,transposeB:g,backend:a,bias:i,activation:c,preluActivationWeights:o,leakyreluAlpha:s});m=iV({inputs:{x:f},backend:a,attrs:{shape:r.outShape}}),v.push(u),v.push(l),v.push(f)}for(const b of v)a.disposeIntermediateTensorInfo(b);return m}function HH(e){let{x:t,filter:n,convInfo:r,backend:a,bias:i=null,preluActivationWeights:o=null,leakyreluAlpha:s=0,activation:c=null}=e;const{filterWidth:u,filterHeight:l,inChannels:f,outWidth:d,outHeight:h,dataFormat:p}=r,g="channelsLast"===p,m=u*l*f,v=h*d,b=[r.batchSize,m,v],y=[];if(null!=o){const e=GH(o.shape,g);null!=e&&(o=iV({inputs:{x:o},backend:a,attrs:{shape:e}}),y.push(o))}if(null!=i){const e=GH(i.shape,g);null!=e&&(i=iV({inputs:{x:i},backend:a,attrs:{shape:e}}),y.push(i))}const x=iV({inputs:{x:n},backend:a,attrs:{shape:[1,m,ph(n.shape)/m]}});y.push(x);const w=new WH(b,r),S=[t.shape,[r.padInfo.top,r.padInfo.left],[r.strideHeight,r.strideWidth],[r.dilationHeight,r.dilationWidth],[r.inChannels],[r.filterWidth*r.inChannels],[r.outWidth]],C=a.runWebGLProgram(w,[t],"float32",S),M=iV({inputs:{x:C},backend:a,attrs:{shape:b}});y.push(C),y.push(M);const _=null!=i,E=null!=o,T="leakyrelu"===c,I=c?JG(c,!0):null,k=new ZG(g?M.shape:x.shape,g?x.shape:M.shape,g?[r.batchSize,v,r.outChannels]:[r.batchSize,r.outChannels,v],!0,!1,_,I,E,T),N=g?[M,x]:[x,M];if(i&&N.push(i),E&&N.push(o),T){const e=a.makeTensorInfo([],"float32",Rv(s,"float32"));N.push(e),y.push(e)}const L=a.runWebGLProgram(k,N,"float32"),A=iV({inputs:{x:L},backend:a,attrs:{shape:r.outShape}});y.push(L);for(const R of y)a.disposeIntermediateTensorInfo(R);return A}const YH={kernelName:Ep,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:o,pad:s,dataFormat:c,dilations:u,dimRoundingMode:l}=r,f=Jx(c),d=Ux(a.shape,i.shape,o,u,s,l,!1,f);let h;if(1!==d.filterHeight||1!==d.filterWidth||1!==d.dilationHeight||1!==d.dilationWidth||1!==d.strideHeight||1!==d.strideWidth||"SAME"!==d.padInfo.type&&"VALID"!==d.padInfo.type)if(d.strideWidth<=2&&"channelsLast"===f&&Hh().getBool("WEBGL_EXP_CONV")){const e=new UH(d),t=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];h=n.runWebGLProgram(e,[a,i],"float32",t)}else if(Hh().getBool("WEBGL_CONV_IM2COL"))h=HH({x:a,filter:i,convInfo:d,backend:n});else{const e=new jH(d);h=n.runWebGLProgram(e,[a,i],"float32")}else h=VH({x:a,filter:i,convInfo:d,backend:n});const p=iV({inputs:{x:h},backend:n,attrs:{shape:d.outShape}});return n.disposeIntermediateTensorInfo(h),p}};class XH{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,i="channelsLast"===e.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(e.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(e.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(t," - ").concat(r,";\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(e.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(n," - ").concat(a,";\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              ").concat(i?"float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);":"float dyValue = getDy(b, d2, yR, yC);\n              float xValue = getX(b, d1, xR, xC);\n              dotProd += (xValue * dyValue);","\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class qH{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,i="channelsLast"===e.dataFormat,o=t-1-e.padInfo.top,s=n-1-e.padInfo.left,c=i?1:2,u=i?2:3,l=i?3:1;this.userCode="\n      const ivec2 pads = ivec2(".concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[").concat(l,"];\n\n        ivec2 dyCorner = ivec2(coords[").concat(c,"], coords[").concat(u,"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(t,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(t," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(n,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(n," - 1 - wC;\n\n            for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2++) {\n\n              if (").concat(i,") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class KH{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,a=e.padInfo.front,i=e.padInfo.top,o=e.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(e.batchSize,"; b++) {\n          for (int yF = 0; yF < ").concat(e.outDepth,"; yF++) {\n            int xF = wF + yF * ").concat(t," - ").concat(a,";\n\n            if (xF < 0 || xF >= ").concat(e.inDepth,") {\n              continue;\n            }\n\n            for (int yR = 0; yR < ").concat(e.outHeight,"; yR++) {\n              int xR = wR + yR * ").concat(n," - ").concat(i,";\n\n              if (xR < 0 || xR >= ").concat(e.inHeight,") {\n                continue;\n              }\n\n              for (int yC = 0; yC < ").concat(e.outWidth,"; yC++) {\n                int xC = wC + yC * ").concat(r," - ").concat(o,";\n\n                if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class QH{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,a=e.strideDepth,i=e.strideHeight,o=e.strideWidth,s=t-1-e.padInfo.front,c=n-1-e.padInfo.top,u=r-1-e.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3(".concat(s,", ").concat(c,", ").concat(u,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(t,"; wF++) {\n          float dyF = float(dyFCorner + wF) / ").concat(a,".0;\n\n          if (dyF < 0.0 || dyF >= ").concat(e.outDepth,".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ").concat(t," - 1 - wF;\n\n          for (int wR = 0; wR < ").concat(n,"; wR++) {\n            float dyR = float(dyRCorner + wR) / ").concat(i,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ").concat(n," - 1 - wR;\n\n            for (int wC = 0; wC < ").concat(r,"; wC++) {\n              float dyC = float(dyCCorner + wC) / ").concat(o,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ").concat(r," - 1 - wC;\n\n              for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}const JH={kernelName:Tp,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:o,pad:s,dataFormat:c,dimRoundingMode:u,filterShape:l}=r,f=Jx(c),d=Ux(a.shape,l,o,1,s,u,!1,f),h=new XH(d);return n.runWebGLProgram(h,[a,i],"float32")}};class ZH{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=eW(this.outputShape.length);const t=e.filterHeight,n=e.filterWidth,r=t-1-e.padInfo.top,a=n-1-e.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2(".concat(r,", ").concat(a,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        vec4 result = vec4(0.);\n        for (int wR = 0; wR < ").concat(t,"; wR++) {\n          float dyR = float(dyRCorner + wR) / strides[0];\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n          int wRPerm = ").concat(t," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(n,"; wC++) {\n            int wCPerm = ").concat(n," - 1 - wC;\n\n            float dyC = float(dyCCorner + wC) / strides[1];\n            bool idyCVal = (dyC >= 0.0) && (dyC < ").concat(e.outWidth,".0)\n              && (fract(dyC) == 0.0);\n            int idyC = int(dyC);\n\n            float dyC2 = float(dyCCorner + wC + 1) / strides[1];\n            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ").concat(e.outWidth,".0)\n              && (fract(dyC2) == 0.0);\n            int idyC2 = int(dyC2);\n\n            if (idyCVal && idyCVal2) {\n              for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC, d2);\n                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?\n                  dySample : getDy(batch, idyR, idyC2, d2);\n\n                vec2 dyValue = mod(float(idyC), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.xy += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n\n                dyValue = mod(float(idyC2), 2.) == 0. ?\n                  dySample2.xy : dySample2.zw;\n                result.zw += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            } else if (idyCVal) {\n              for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC, d2);\n                vec2 dyValue = mod(float(idyC), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.xy += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            } else if (idyCVal2) {\n              for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC2, d2);\n                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.zw += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            }\n          }\n        }\n        setOutput(result);\n      }\n    ")}}const $H={kernelName:Ip,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{inputShape:o,strides:s,pad:c,dataFormat:u,dimRoundingMode:l}=r,f=Jx(u),d=Ux(o,i.shape,s,1,c,l,!1,f);if(Hh().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&"channelsLast"===f){const e=[[d.strideHeight,d.strideWidth]],t=new ZH(d);return n.runWebGLProgram(t,[a,i],"float32",e)}{const e=new qH(d);return n.runWebGLProgram(e,[a,i],"float32")}}};const eY={kernelName:kp,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:o,pad:s,dilations:c}=r,u=Wx(a.shape,i.shape,o,c,s),l=new BH(u);return n.runWebGLProgram(l,[a,i],"float32")}};const tY={kernelName:Np,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:o,pad:s,filterShape:c}=r,u=Wx(a.shape,c,o,1,s),l=new KH(u);return n.runWebGLProgram(l,[a,i],"float32")}};const nY={kernelName:Lp,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{pad:o,strides:s,inputShape:c}=r,u=Wx(c,i.shape,s,1,o),l=new QH(u);return n.runWebGLProgram(l,[a,i],"float32")}},rY=KG({opSnippet:qG+"\n  return cos(x);\n",packedOpSnippet:"\n  vec4 result = cos(x);\n  bvec4 isNaN = isnan(x);\n  ".concat(PG,"\n  return result;\n")}),aY={kernelName:Ap,backendName:"webgl",kernelFunc:rY},iY=KG({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"}),oY={kernelName:Rp,backendName:"webgl",kernelFunc:iY};class sY{constructor(e,t,n,r,a){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[i,o,s,c]=e,[u]=t,[l,f]=n;this.outputShape=[u,l,f,c];const d="bilinear"===r?1:0,[h,p]=["".concat(o-1,".0"),"".concat(s-1,".0")],[g,m,v]=l>1?["".concat((o-1)/(l-1)),"(y2-y1) * height_ratio","y1*".concat(h," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(h)],[b,y,x]=f>1?["".concat((s-1)/(f-1)),"(x2-x1) * width_ratio","x1*".concat(p," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(p)];this.userCode="\n      const float height_ratio = float(".concat(g,");\n      const float width_ratio = float(").concat(b,");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ").concat(i,") {\n          return;\n        }\n\n        float height_scale = ").concat(m,";\n        float width_scale = ").concat(y,";\n\n        float in_y = ").concat(v,";\n        if( in_y < 0.0 || in_y > ").concat(h," ) {\n          setOutput(float(").concat(a,"));\n          return;\n        }\n        float in_x = ").concat(x,";\n        if( in_x < 0.0 || in_x > ").concat(p," ) {\n          setOutput(float(").concat(a,"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(").concat(d," == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    ")}}const cY={kernelName:Pp,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{image:a,boxes:i,boxInd:o}=t,{cropSize:s,method:c,extrapolationValue:u}=r,l=new sY(a.shape,i.shape,s,c,u);return n.runWebGLProgram(l,[a,i,o],"float32")}};var uY;!function(e){e.Prod="*",e.Sum="+"}(uY||(uY={}));class lY{constructor(e,t,n,r){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const a=this.outputShape.length,i=this.op===uY.Prod?"1.0":"0.0",o=n?i:"getX(".concat(fY(a,"coords",this.op),")"),s=this.outputShape[this.outputShape.length-1];let c="",u="";n?(c=r?"end != ".concat(s-1):"end != 0",u=r?"end + 1":"end - 1"):(c=r?"end + pow2 < ".concat(s):"end >= pow2",u=r?"end + pow2":"end - pow2"),this.userCode="\n      void main() {\n        ".concat(XU(a)," coords = getOutputCoords();\n        int end = ").concat(dY(a,"coords",this.op),";\n        float val = ").concat(o,";\n        int pow2 = int(pow(2.0, index));\n        if (").concat(c,") {\n          int idx = ").concat(u,";\n          ").concat(dY(a,"coords",this.op)," = idx;\n          val ").concat(this.op,"= getX(").concat(fY(a,"coords",this.op),");\n        }\n        setOutput(val);\n      }\n    ")}}function fY(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".x, ").concat(t,".y");if(3===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z");if(4===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z, ").concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function dY(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".y");if(3===e)return"".concat(t,".z");if(4===e)return"".concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function hY(e,t,n,r,a,i){const o=t.shape.length,s=Vw([r],o);let c=t;null!=s&&(c=gV({inputs:{x:t},backend:n,attrs:{perm:s}}));const u=Yw(1,o)[0];if(u!==o-1)throw new Error("WebGL cumprod shader expects an inner-most axis=".concat(t.shape.length-1," ")+"but got axis=".concat(r));const l=c.shape[u];let f=zG({inputs:{x:c},backend:n});for(let d=0;d<=Math.ceil(Math.log2(l))-1;d++){const t=new lY(e,c.shape,!1,i),r=[[d]],a=f;f=n.runWebGLProgram(t,[f],f.dtype,r),n.disposeIntermediateTensorInfo(a)}if(a){const t=new lY(e,c.shape,a,i),r=f;f=n.runWebGLProgram(t,[f],f.dtype),n.disposeIntermediateTensorInfo(r)}if(null!=s){const e=gV({inputs:{x:f},backend:n,attrs:{perm:Hw(s)}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(c),e}return f}const pY={kernelName:Dp,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,exclusive:o,reverse:s}=r;return hY(uY.Prod,a,n,i,o,s)}};const gY={kernelName:Op,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,exclusive:o,reverse:s}=r;return hY(uY.Sum,a,n,i,o,s)}};const mY={kernelName:Fp,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,weights:i}=t,{size:o,binaryOutput:s}=r;if(1===a.shape.length){const e=n.readSync(a.dataId),t=n.readSync(i.dataId),r=xW(e,t,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,r)}if(2===a.shape.length){const e=n.bufferSync(a),t=n.bufferSync(i),r=wW(e,t,o,s);return n.makeTensorInfo(r.shape,i.dtype,r.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}};class vY{constructor(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ".concat(this.getHeightCoordString(),";\n      int w = ").concat(this.getWidthCoordString(),";\n      int d = ").concat(this.getDepthCoordString(),";\n\n      int in_h = h / ").concat(t,";\n      int offset_h = imod(h, ").concat(t,");\n      int in_w = w / ").concat(t,";\n      int offset_w = imod(w, ").concat(t,");\n      int offset_d = (offset_h * ").concat(t," + offset_w) *\n        ").concat(this.getOutputDepthSize(),";\n      int in_d = d + offset_d;\n\n      float result = ").concat(this.getInputSamplingString(),";\n      setOutput(result);\n    }\n  ")}getHeightCoordString(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}getWidthCoordString(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}getDepthCoordString(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}getOutputDepthSize(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}const bY={kernelName:zp,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockSize:i,dataFormat:o}=r,s=a.shape[0],c=("NHWC"===o?a.shape[1]:a.shape[2])*i,u=("NHWC"===o?a.shape[2]:a.shape[3])*i,l=("NHWC"===o?a.shape[3]:a.shape[1])/(i*i),f=new vY("NHWC"===o?[s,c,u,l]:[s,l,c,u],i,o);return n.runWebGLProgram(f,[a],a.dtype)}};class yY{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=eW(this.outputShape.length);const i=e.filterHeight,o=e.filterWidth,s=e.outChannels/e.inChannels;let c="",u="";n&&(c=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(n,"\n        }"):a?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(n,"\n        }"):"\n          float activation(float x) {\n            ".concat(n,"\n          }\n        "),u="result = activation(result);");const l=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(c,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(s,";\n        int q = d2 - d1 * ").concat(s,";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ").concat(i,"; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(o,"; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ").concat(l,"\n        ").concat(u,"\n        setOutput(result);\n      }\n    ")}}class xY{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=eW(this.outputShape.length);const i=e.outChannels/e.inChannels,o=e.padInfo.left,s=e.strideWidth,c=e.dilationWidth,u=e.filterHeight,l=e.filterWidth,f=l;let d="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;";for(let m=0;m<l;m++)d+="\n          vec4 xTexelC".concat(2*m,";\n          int xTexelC").concat(2*m,"Ready;\n          vec4 xTexelC").concat(2*m+1,";\n          int xTexelC").concat(2*m+1,"Ready;\n          vec4 xC").concat(m,";");d+="\n    for (int r = 0; r < ".concat(u,"; r++) {\n      ");for(let m=0;m<l;m++)d+="\n          xTexelC".concat(2*m," = vec4(0.0);\n          xTexelC").concat(2*m,"Ready = 0;\n          xTexelC").concat(2*m+1," = vec4(0.0);\n          xTexelC").concat(2*m+1,"Ready = 0;\n          xC").concat(m," = vec4(0.0);");d+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(let m=0;m<(f+1)/2;m++){const e=2*m;if(d+="\n          xC = xCCorner + ".concat(e*c,";\n          "),1===s){if(e<l&&(o%2===1?(d+="\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(e,"Ready == 0) {\n                  xTexelC").concat(e," = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(e,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(e,"Ready = 1;\n                }\n              "),d+=1===c&&e>0?"\n                xC".concat(e," = vec4(xTexelC").concat(e-2,".zw, xTexelC").concat(e,".xy);\n                "):"\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC".concat(e," = vec4(previous.zw, xTexelC").concat(e,".xy);\n                  } else {\n                    xC").concat(e," = vec4(0.0, 0.0, xTexelC").concat(e,".xy);\n                  }\n                  ")):d+="\n                if (xC >= 0 && xC < inDims[1] && xTexelC".concat(e,"Ready == 0) {\n                  xTexelC").concat(e," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(e,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(e,"Ready = 1;\n                }\n\n                xC").concat(e," = xTexelC").concat(e,";\n                "),e+1<l)){const t=o%2===0?uh(c):c;c%2===0&&o%2===1||c%2!==0&&o%2!==1?(d+="\n                  xCOffset = xC + imod(pads[1], 2) + ".concat(t,";\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(e+1,"Ready == 0) {\n                    xTexelC").concat(e+1," = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC").concat(e+1,".zw = vec2(0.0);\n                    }\n                    xTexelC").concat(e+1,"Ready = 1;\n                  }\n                  "),d+=c>1?"\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n                     xC".concat(e+1," = vec4(previous.zw, xTexelC").concat(e+1,".xy);\n                    } else {\n                     xC").concat(e+1," = vec4(0.0, 0.0, xTexelC").concat(e+1,".xy);\n                    }\n                    "):"\n                    xC".concat(e+1," = vec4(xTexelC").concat(e,".zw, xTexelC").concat(e+1,".xy);\n                    ")):d+=1===t?"\n                    xC".concat(e+1," = xTexelC").concat(e,";\n                    "):"\n                    xCOffset = xC + ".concat(t,";\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(e+1,"Ready == 0) {\n                      xTexelC").concat(e+1," = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC").concat(e+1,".zw = vec2(0.0);\n                      }\n                      xTexelC").concat(e+1,"Ready = 1;\n                    }\n\n                    xC").concat(e+1," = xTexelC").concat(e+1,";\n                    ")}}else e<l&&(o%2===1?(d+="\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(e,"Ready == 0) {\n                  xTexelC").concat(e," = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(e,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(e,"Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(e+1,"Ready == 0) {\n                  xTexelC").concat(e+1," = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC").concat(e+1,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(e+1,"Ready = 1;\n                }\n\n                xC").concat(e," = vec4(xTexelC").concat(e,".zw, xTexelC").concat(e+1,".zw);\n              "),e+1<l&&(d+="\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC".concat(e+1," = vec4(xTexelC").concat(e+1,".xy, final.xy);\n                "))):(d+="\n                if(xC >= 0 && xC < inDims[1] && xTexelC".concat(e,"Ready == 0) {\n                  xTexelC").concat(e," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(e,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(e,"Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(e+1,"Ready == 0) {\n                  xTexelC").concat(e+1," = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(e+1,".zw = vec2(0.);\n                  }\n                  xTexelC").concat(e+1,"Ready = 1;\n                }\n\n                xC").concat(e," = vec4(\n                  xTexelC").concat(e,".xy, xTexelC").concat(e+1,".xy);\n              "),e+1<l&&(d+="\n                  xC".concat(e+1," = vec4(xTexelC").concat(e,".zw, xTexelC").concat(e+1,".zw);\n                "))));e<l&&(d+="\n            wTexel = getW(r, ".concat(e,", d1, q);\n            dotProd += xC").concat(e," * vec4(wTexel.xz, wTexel.xz);\n          "),e+1<l&&(d+="\n              wTexel = getW(r, ".concat(e+1,", d1, q);\n              dotProd += xC").concat(e+1," * vec4(wTexel.xz, wTexel.xz);\n            ")))}d+="\n    }\n  ",d+="\n      }\n    ";let h="",p="";n&&(h=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(n,"\n        }"):a?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(n,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(n,"\n        }"),p="result = activation(result);");const g=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(h,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(i,";\n        int q = d2 - d1 * ").concat(i,";\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ").concat(d,"\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ").concat(g,"\n        ").concat(p,"\n        setOutput(result);\n      }\n    ")}}const wY={kernelName:jp,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:o,pad:s,dilations:c,dimRoundingMode:u}=r;let l=c;null==l&&(l=[1,1]),fh(Kx(o,l),(()=>"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(l,"'")));const f=Ux(a.shape,i.shape,o,l,s,u,!0);let d;d=Hh().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels===1?new xY(f):new yY(f);const h=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];return n.runWebGLProgram(d,[a,i],"float32",h)}};class SY{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ".concat(i," + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ").concat(e.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(e.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(t," - ").concat(r,";\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(e.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(n," - ").concat(a,";\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class CY{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,i=t-1-e.padInfo.top,o=n-1-e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2(".concat(i,", ").concat(o,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ").concat(t,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(t," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(n,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(n," - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ").concat(s,"; dm++) {\n              int d2 = d1 * ").concat(s," + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}const MY={kernelName:Bp,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:o,dilations:s,pad:c,dimRoundingMode:u,filterShape:l}=r,f=Ux(a.shape,l,o,s,c,u,!0),d=new SY(f);return n.runWebGLProgram(d,[a,i],"float32")}};const _Y={kernelName:Up,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{strides:o,dilations:s,pad:c,dimRoundingMode:u,inputShape:l}=r,f=Ux(l,i.shape,o,s,c,u,!0),d=new CY(f);return n.runWebGLProgram(d,[a,i],"float32")}};class EY{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}}const TY={kernelName:Wp,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t,a=[...r.shape,...r.shape],i=ph(r.shape),o=iV({inputs:{x:r},backend:n,attrs:{shape:[i]}}),s=new EY(i),c=n.runWebGLProgram(s,[o],o.dtype),u=iV({inputs:{x:c},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(c),u}};class IY{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:n,padInfo:r,strideHeight:a,strideWidth:i,filterHeight:o,filterWidth:s,dilationHeight:c,dilationWidth:u}=e,{top:l,left:f}=r;this.userCode="\n      const ivec2 strides = ivec2(".concat(a,", ").concat(i,");\n      const ivec2 pads = ivec2(").concat(l,", ").concat(f,");\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ").concat(o,"; h++) {\n          int hIn = hBeg + h * ").concat(c,";\n\n          if (hIn >= 0 && hIn < ").concat(t,") {\n            for (int w = 0; w < ").concat(s,"; w++) {\n              int wIn = wBeg + w * ").concat(u,";\n\n              if (wIn >= 0 && wIn < ").concat(n,") {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    ")}}const kY={kernelName:Gp,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:o,pad:s,dilations:c}=r,u=zx(a.shape,i.shape,o,s,"NHWC",c);let l;const f=new IY(u);l=n.runWebGLProgram(f,[a,i],"float32");const d=iV({inputs:{x:l},backend:n,attrs:{shape:u.outShape}});return n.disposeIntermediateTensorInfo(l),d}};const NY={kernelName:qp,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{equation:a}=r,i=t,{allDims:o,summedDims:s,idDims:c}=NM(a,i.length);AM(o.length,c,i);const{path:u,steps:l}=RM(s,c),f=l.length;let d=null,h=o.length;const p=[];for(let g=0;g<f;++g){for(const e of l[g]){const{permutationIndices:t,expandDims:r}=LM(h,c[e]);let a;DM(t)?a=i[e]:(a=gV({inputs:{x:i[e]},backend:n,attrs:{perm:t}}),p.push(a));const o=a.shape.slice();for(let e=0;e<r.length;++e)o.splice(r[e],0,1);gh(a.shape,o)||(a=iV({inputs:{x:a},backend:n,attrs:{shape:o}}),p.push(a)),null===d?d=a:(d=rV({inputs:{a:a,b:d},backend:n}),p.push(d))}g<f-1&&(u[g]>=0&&(d=hV({inputs:{x:d},backend:n,attrs:{axis:u[g]-(o.length-h),keepDims:!1}}),p.push(d)),h--)}for(const g of p)g!==d&&n.disposeIntermediateTensorInfo(g);return d}},LY=KG({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"}),AY={kernelName:Kp,backendName:"webgl",kernelFunc:LY},RY={kernelName:Qp,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n}=e,{dy:r,y:a}=t,i=Hh().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new FG("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,a.shape):new OG("return (b >= 0.0) ? a : a * (b + 1.0);",r.shape,a.shape);return n.runWebGLProgram(i,[r,a],r.dtype)}},DY=QG({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool",cpuKernelImpl:EW}),OY={kernelName:Zp,backendName:"webgl",kernelFunc:DY},PY=KG({opSnippet:'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '.concat(dM,";\n  float a1 = ").concat(hM,";\n  float a2 = ").concat(pM,";\n  float a3 = ").concat(gM,";\n  float a4 = ").concat(mM,";\n  float a5 = ").concat(vM,";\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n")}),FY={kernelName:Jp,backendName:"webgl",kernelFunc:PY},zY=KG({opSnippet:qG+"\n  return exp(x);\n",packedOpSnippet:"\n  vec4 result = exp(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:TW,dtype:"float32"}),jY={kernelName:$p,backendName:"webgl",kernelFunc:zY};function BY(e){const{inputs:t,attrs:n,backend:r}=e,{dim:a}=n,{input:i}=t,o=i.shape.length,s=i.shape.slice();let c=a;return a<0&&(fh(-(o+1)<=a,(()=>"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]"))),c=o+a+1),s.splice(c,0,1),iV({inputs:{x:i},backend:r,attrs:{shape:s}})}const UY={kernelName:eg,backendName:"webgl",kernelFunc:BY},WY="return exp(x) - 1.0;",GY=KG({opSnippet:WY,packedOpSnippet:WY,cpuKernelImpl:IW}),VY={kernelName:tg,backendName:"webgl",kernelFunc:GY};class HY{constructor(e,t,n){this.variableNames=["real","imag"];const r=t[1];this.outputShape=t;const a=n?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),i=n?"".concat(r,".0"):"1.0";let o;if("real"===e)o="return real * expR - imag * expI;";else{if("imag"!==e)throw new Error('FFT component must be either "real" or "imag", got '.concat(e,"."));o="return real * expI + imag * expR;"}this.userCode="\n      const float exponentMultiplier = ".concat(a,";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ").concat(o,"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(").concat(r,");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ").concat(r,"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ").concat(i,";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    ")}}function YY(e,t,n){const r=n.texData.get(e.dataId),a=ph(e.shape),i=e.shape[e.shape.length-1],o=iV({inputs:{x:e},backend:n,attrs:{shape:[a/i,i]}}),s=o.shape,c=new HY("real",s,t),u=new HY("imag",s,t),l=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:s},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:s}],f=n.runWebGLProgram(c,l,"float32"),d=n.runWebGLProgram(u,l,"float32"),h=BG({inputs:{real:f,imag:d},backend:n});n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d);const p=iV({inputs:{x:h},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(h),p}const XY={kernelName:ng,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:r}=t;return YY(r,!1,n)}};class qY{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}}function KY(e){const{backend:t,attrs:n}=e,{shape:r,value:a}=n;let{dtype:i}=n;if(i=i||kh(a),"string"===i){const e=Mh(i,ph(r));return e.fill(a),t.makeTensorInfo(r,i,e)}{const e=new qY(r,a),n=[[a]];return t.runWebGLProgram(e,[],i,n)}}const QY={kernelName:rg,backendName:"webgl",kernelFunc:KY};class JY{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ".concat(t," - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ").concat(t,") {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")}}const ZY={kernelName:ag,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n}=e;const{image:r}=t,a=n,i=new JY(r.shape);return a.runWebGLProgram(i,[r],r.dtype)}},$Y="return floor(x);",eX=KG({opSnippet:$Y,packedOpSnippet:$Y,cpuKernelImpl:kW}),tX={kernelName:ig,backendName:"webgl",kernelFunc:eX},nX=QG({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"}),rX={kernelName:og,backendName:"webgl",kernelFunc:nX};class aX{constructor(e){this.variableNames=["A"];const t=LU(),[n,r]=e;this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(".concat(r,".0, ").concat(n,".0);\n\n        vec4 values = ").concat(t.texture2D,"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    ")}}class iX{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=LU(),[n,r]=e;this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(".concat(r,".0, ").concat(n,".0);\n            vec4 values = ").concat(t.texture2D,"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ").concat(t.output," = result;\n      }\n    ")}}const oX={kernelName:rv,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e;let{pixels:a}=t;const{numChannels:i}=r,o="undefined"!==typeof HTMLVideoElement&&a instanceof HTMLVideoElement,s="undefined"!==typeof HTMLImageElement&&a instanceof HTMLImageElement,[c,u]=o?[a.videoWidth,a.videoHeight]:[a.width,a.height],l=[u,c],f=[u,c,i];if(s||o){const e=Hh().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");null!=sX&&e===cX||(cX=e,sX=document.createElement("canvas").getContext("2d",{willReadFrequently:cX})),sX.canvas.width=c,sX.canvas.height=u,sX.drawImage(a,0,0,c,u),a=sX.canvas}const d=n.makeTensorInfo(l,"int32");n.texData.get(d.dataId).usage=$B.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(d.dataId),a);const h=Hh().getBool("WEBGL_PACK")?new iX(f):new aX(f),p=n.runWebGLProgram(h,[d],"int32");return n.disposeData(d.dataId),p}};let sX,cX=Hh().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");const uX={kernelName:ov,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i,bias:o,preluActivationWeights:s}=t,{strides:c,pad:u,dataFormat:l,dilations:f,dimRoundingMode:d,activation:h,leakyreluAlpha:p}=r,g=Jx(l),m=Ux(a.shape,i.shape,c,f,u,d,!1,g);let v;const b=[],y=null!=o,x=null!=s,w="leakyrelu"===h,S=()=>{const e=[a,i],t=(e,t)=>{if("NCHW"===t&&1===e.shape.length&&1!==e.shape[0]){const t=iV({inputs:{x:e},backend:n,attrs:{shape:[e.shape[0],1,1]}});return b.push(t),t}return e};if(y&&e.push(t(o,l)),x&&e.push(t(s,l)),w){const t=n.makeTensorInfo([],"float32",Rv(p,"float32"));e.push(t),b.push(t)}return e};if(1!==m.filterHeight||1!==m.filterWidth||1!==m.dilationHeight||1!==m.dilationWidth||1!==m.strideHeight||1!==m.strideWidth||"SAME"!==m.padInfo.type&&"VALID"!==m.padInfo.type)if(m.strideWidth<=2&&"channelsLast"===g&&Hh().getBool("WEBGL_EXP_CONV")){const e=h?JG(h,!0):null,t=new UH(m,y,e,x,w),r=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]],a=S();v=n.runWebGLProgram(t,a,"float32",r)}else if(Hh().getBool("WEBGL_CONV_IM2COL"))v=HH({x:a,filter:i,convInfo:m,backend:n,bias:o,activation:h,preluActivationWeights:s,leakyreluAlpha:p});else{const e=h?JG(h,!1):null,t=new jH(m,y,e,x,w),r=S();v=n.runWebGLProgram(t,r,"float32")}else v=VH({x:a,filter:i,convInfo:m,backend:n,bias:o,activation:h,preluActivationWeights:s,leakyreluAlpha:p});const C=iV({inputs:{x:v},backend:n,attrs:{shape:m.outShape}});return b.push(v),b.forEach((e=>n.disposeIntermediateTensorInfo(e))),C}};const lX={kernelName:sv,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i,bias:o,preluActivationWeights:s}=t,{strides:c,pad:u,dilations:l,dimRoundingMode:f,activation:d,leakyreluAlpha:h}=r,p=[];let g=l;null==g&&(g=[1,1]),fh(Kx(c,g),(()=>"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(c," and dilations '").concat(g,"'")));const m=Ux(a.shape,i.shape,c,g,u,f,!0),v=Hh().getBool("WEBGL_PACK_DEPTHWISECONV")&&m.strideWidth<=2&&m.outChannels/m.inChannels===1,b=d?JG(d,v):null,y=[a,i],x=null!=o,w=null!=s,S="leakyrelu"===d;if(x&&y.push(o),w&&y.push(s),S){const e=n.makeTensorInfo([],"float32",Rv(h,"float32"));y.push(e),p.push(e)}let C;C=v?new xY(m,x,b,w,S):new yY(m,x,b,w,S);const M=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]],_=n.runWebGLProgram(C,y,"float32",M);return p.forEach((e=>n.disposeIntermediateTensorInfo(e))),_}};class fX{constructor(e,t,n,r){this.sliceDim=e,this.strides=t,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=n;const a=XU(n.length);let i="\n    int index;";for(let o=0;o<this.sliceDim;o++)i+="\n          index = round(getIndices(coords[0], ".concat(o,"));\n          out_of_bounds = out_of_bounds || index < 0;\n          out_of_bounds = out_of_bounds || index >= ").concat(this.paramsShape[o],";\n          flattenIndex += index * ").concat(this.strides[o],";");this.userCode="\n         void main() {\n          ".concat(a," coords = getOutputCoords();\n          int flattenIndex = 0;\n          bool out_of_bounds = false;\n\n          ").concat(i,"\n\n          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));\n        }\n      ")}}const dX={kernelName:ug,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{params:r,indices:a}=t,i=a.shape,o=i[i.length-1],s=ph(r.shape),[c,u,l,f]=oM(r,a),d=iV({inputs:{x:a},backend:n,attrs:{shape:[u,o]}}),h=iV({inputs:{x:r},backend:n,attrs:{shape:[ph(r.shape)/l,l]}});if(n.shouldExecuteOnCPU([r,a])||"string"===r.dtype){const e=n.readSync(a.dataId),t=n.bufferSync(r),i=NW(e,t,r.dtype,u,o,l,f,r.shape,s);return n.makeTensorInfo(c,r.dtype,i.values)}const p=new fX(o,f,[u,l],r.shape),g=n.runWebGLProgram(p,[h,d],h.dtype),m=iV({inputs:{x:g},backend:n,attrs:{shape:c}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(g),m}};class hX{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const n=XU(this.rank),r=function(e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],n=[];for(let r=0;r<e.length;r++)2===r?n.push("index"):n.push("".concat(t[r]));return n.join()}(e);this.userCode="\n      void main() {\n        ".concat(n," resRC = getOutputCoords();\n        int index = int(getIndices(resRC.x, resRC.z));\n        float inBounds = (index >= 0) && (index < ").concat(e[2],") ? 1.0 : 0.0;\n        setOutput(inBounds * getA(").concat(r,"));\n      }\n    ")}}function pX(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,indices:i}=t,{axis:o,batchDims:s}=r,c=wh(o,a.shape)[0];if(Hh().get("DEBUG")){const e=n.readSync(i.dataId),t=a.shape[c];for(let n=0;n<e.length;++n){const r=e[n];fh(r<=t-1&&r>=0,(()=>"GatherV2: the index value ".concat(r," is not in [0, ").concat(t-1,"]")))}}const u=JM(a,i,c,s),l=ph(i.shape),f=[],d=iV({inputs:{x:a},backend:n,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),h=iV({inputs:{x:i},backend:n,attrs:{shape:[u.batchSize,l/u.batchSize]}});f.push(d),f.push(h);const p=[u.batchSize,u.outerSize,l/u.batchSize,u.sliceSize];if(n.shouldExecuteOnCPU([a,i])||"string"===a.dtype){const e=n.bufferSync(h),t=n.bufferSync(d),r=LW(t,e,p);return f.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.makeTensorInfo(u.outputShape,r.dtype,r.values)}const g=new hX(d.shape,p),m=n.runWebGLProgram(g,[d,h],d.dtype);f.push(m);const v=iV({inputs:{x:m},backend:n,attrs:{shape:u.outputShape}});return f.forEach((e=>n.disposeIntermediateTensorInfo(e))),v}const gX={kernelName:cg,backendName:"webgl",kernelFunc:pX},mX=QG({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:AW,dtype:"bool"}),vX={kernelName:lg,backendName:"webgl",kernelFunc:mX},bX=QG({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool",cpuKernelImpl:RW}),yX={kernelName:fg,backendName:"webgl",kernelFunc:bX};const xX={kernelName:hg,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:r}=t;return YY(r,!0,n)}},wX=KG({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),SX={kernelName:gg,backendName:"webgl",kernelFunc:wX},CX=KG({opSnippet:"return float(isinf(x));",dtype:"bool"}),MX={kernelName:mg,backendName:"webgl",kernelFunc:CX},_X=KG({opSnippet:"return float(isnan(x));",dtype:"bool"}),EX={kernelName:vg,backendName:"webgl",kernelFunc:_X},TX=QG({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:DW,dtype:"bool"}),IX={kernelName:yg,backendName:"webgl",kernelFunc:TX},kX=QG({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",cpuKernelImpl:OW,dtype:"bool"}),NX={kernelName:xg,backendName:"webgl",kernelFunc:kX};const LX={kernelName:wg,backendName:"webgl",kernelFunc:function(e){const{backend:t,attrs:n}=e,{start:r,stop:a,num:i}=n,o=PW(r,a,i);return t.makeTensorInfo([o.length],"float32",o)}},AX=KG({opSnippet:qG+"\n  return x < 0.0 ? 0./0. : log(x);\n",packedOpSnippet:"\n  vec4 result = log(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);\n  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);\n  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);\n  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);\n  return result;\n",cpuKernelImpl:FW}),RX={kernelName:Sg,backendName:"webgl",kernelFunc:AX},DX=KG({opSnippet:qG+"\n  return log(1.0 + x);\n"}),OX={kernelName:Cg,backendName:"webgl",kernelFunc:DX},PX=QG({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"}),FX={kernelName:Mg,backendName:"webgl",kernelFunc:PX},zX=KG({opSnippet:"return float(!(x >= 1.0));"}),jX={kernelName:_g,backendName:"webgl",kernelFunc:zX},BX=QG({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"}),UX={kernelName:Eg,backendName:"webgl",kernelFunc:BX};class WX{constructor(e,t,n,r,a){this.variableNames=["x"],this.outputShape=[];const i=t,o=e[3]-1;let s;this.outputShape=e;const c="float(".concat(n,") + float(").concat(r,") * sum");s=.5===a?"inversesqrt(".concat(c,")"):1===a?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(a,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -".concat(i,"; j <= ").concat(i,"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ").concat(o,") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ").concat(s,";\n        setOutput(val);\n      }\n    ")}}class GX{constructor(e,t,n,r,a){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const i=t,o=e[3]-1;let s;this.outputShape=e;const c="float(".concat(n,") + float(").concat(r,") * sum");s=.5===a?"inversesqrt(".concat(c,")"):1===a?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(a,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ".concat(this.outputShape[3],";\n        bool hasNextRow = c < ").concat(this.outputShape[2],";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ").concat(i,";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ").concat(i,"; j <= ").concat(i,"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(").concat(o,"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ").concat(s,";\n        setOutput(result);\n      }\n    ")}}const VX={kernelName:Tg,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{depthRadius:i,bias:o,alpha:s,beta:c}=r,u=Hh().getBool("WEBGL_PACK_NORMALIZATION")?new GX(a.shape,i,o,s,c):new WX(a.shape,i,o,s,c);return n.runWebGLProgram(u,[a],a.dtype)}};class HX{constructor(e,t,n,r,a){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=a,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ".concat(this.depth,"; ++d) {\n          int depthBegin = int(max(0.0, float(d - ").concat(t,")));\n          int depthEnd = int(min(float(").concat(this.depth,"),\n              float(d + ").concat(t," + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ").concat(this.depth,";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(").concat(r,") * norm + float(").concat(n,");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(").concat(r,")\n                * float(").concat(a,")\n                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ").concat(a,");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    ")}}const YX={kernelName:Ig,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{x:a,y:i,dy:o}=t,{depthRadius:s,bias:c,alpha:u,beta:l}=r,f=new HX(a.shape,s,c,u,l);return n.runWebGLProgram(f,[a,i,o],a.dtype)}};function XX(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reductionIndices:i,keepDims:o}=r,s=a.shape.length,c=wh(i,a.shape);let u=c;const l=Vw(u,s),f=null!=l,d=n.shouldExecuteOnCPU([a]);let h=a;if(f){if(d){const e=n.texData.get(h.dataId).values,t=new Array(s);for(let n=0;n<t.length;n++)t[n]=a.shape[l[n]];const r=dG(e,a.shape,a.dtype,l,t);h=n.makeTensorInfo(t,a.dtype);n.texData.get(h.dataId).values=r}else h=dV(a,l,n);u=Yw(u.length,s)}Gw("max",u,s);const[p,g]=Uw(h.shape,u);let m,v=p;if(o&&(v=Ww(p,c)),d){const e=n.texData.get(h.dataId).values,t=zW(e,ph(g),v,a.dtype);m=n.makeTensorInfo(v,a.dtype);n.texData.get(m.dataId).values=t}else m=function(e,t,n,r){const a=ph(t),i=iV({inputs:{x:e},attrs:{shape:[ph(e.shape)/a,a]},backend:r}),o=uV(i,e.dtype,"max",r),s=iV({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(h,g,v,n);return f&&n.disposeIntermediateTensorInfo(h),m}const qX={kernelName:kg,backendName:"webgl",kernelFunc:XX},KX=QG({opSnippet:DG+"\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+PG+"\n  return result;\n",cpuKernelImpl:jW}),QX={kernelName:Ng,backendName:"webgl",kernelFunc:KX};const JX={kernelName:Lg,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t;kU(a,"maxPool");const{filterSize:i,strides:o,pad:s,dimRoundingMode:c}=r;fh(Kx(o,1),(()=>"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")));const u=jx(a.shape,i,o,1,s,c);if(1===u.filterWidth&&1===u.filterHeight&&gh(u.inShape,u.outShape))return zG({inputs:{x:a},backend:n});const l=new QV(u,"max",!1);return n.runWebGLProgram(l,[a],a.dtype)}};const ZX={kernelName:Rg,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:i,strides:o,pad:s,dataFormat:c,dimRoundingMode:u}=r,l=Bx(a.shape,i,o,[1,1,1],s,u,c),f=new JV(l,"max",!1);return n.runWebGLProgram(f,[a],a.dtype)}};class $X{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,a=e.effectiveFilterHeight,i=e.effectiveFilterWidth,o=a-1-e.padInfo.top,s=i-1-e.padInfo.left,c=a*i-1;this.userCode="\n      const ivec2 pads = ivec2(".concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(a,";\n          wR += ").concat(r,") {\n          float dyR = float(dyRCorner + wR) / ").concat(t,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(i,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(n,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ").concat(c," - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ").concat(i," + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class eq{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,a=e.dilationDepth,i=e.dilationHeight,o=e.dilationWidth,s=e.effectiveFilterDepth,c=e.effectiveFilterHeight,u=e.effectiveFilterWidth,l=s-1-e.padInfo.front,f=c-1-e.padInfo.top,d=u-1-e.padInfo.left,h=s*c*u-1;this.userCode="\n      const ivec3 pads = ivec3(".concat(l,", ").concat(f,", ").concat(d,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(s,";\n           wD += ").concat(a,") {\n          float dyD = float(dyDCorner + wD) / ").concat(t,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(e.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(c,";\n              wR += ").concat(i,") {\n            float dyR = float(dyRCorner + wR) / ").concat(n,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(u,";\n                wC += ").concat(o,") {\n              float dyC = float(dyCCorner + wC) / ").concat(r,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ").concat(h," -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ").concat(c," * ").concat(u," +\n                  wR * ").concat(u," + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}const tq={kernelName:Dg,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,o=i,{filterSize:s,strides:c,pad:u,dimRoundingMode:l}=r,f=Bx(o.shape,s,c,[1,1,1],u,l),d=new JV(f,"max",!0),h=n.runWebGLProgram(d,[o],o.dtype),p=new eq(f),g=n.runWebGLProgram(p,[a,h],o.dtype);return n.disposeIntermediateTensorInfo(h),g}};const nq={kernelName:Ag,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i,output:o}=t,s=i;kU([i,o],"maxPoolGrad");const{filterSize:c,strides:u,pad:l,dimRoundingMode:f}=r,d=jx(s.shape,c,u,1,l,f),h=new QV(d,"max",!0),p=n.runWebGLProgram(h,[s],s.dtype),g=new $X(d),m=n.runWebGLProgram(g,[a,p],s.dtype);return n.disposeIntermediateTensorInfo(p),m}};const rq={kernelName:Og,backendName:"webgl",kernelFunc:e=>{let{inputs:t,attrs:n,backend:r}=e;const{x:a}=t,{filterSize:i,strides:o,pad:s,includeBatchInIndex:c}=n,u=r;fh(4===a.shape.length,(()=>"Error in maxPool: input must be rank 4 but got rank ".concat(a.shape.length,".")));const l=[1,1];fh(Kx(o,l),(()=>"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(l,"'")));const f=jx(a.shape,i,o,l,s),[d,h]=function(e,t,n,r){let a=new QV(n,"max",!1);const i=r.runWebGLProgram(a,[e],"float32");return a=new QV(n,"max",!0,!0,t),[i,r.runWebGLProgram(a,[e],"float32")]}(a,c,f,u);return[d,h]}};const aq={kernelName:Pg,backendName:"webgl",kernelFunc:e=>{let{inputs:t,attrs:n,backend:r}=e;const{x:a}=t,{keepDims:i,axis:o}=n,s=r,c=a.shape.length,u=wh(o,a.shape);let l=u;const f=Vw(l,c),d=null!=f,h=s.shouldExecuteOnCPU([a]),p=[];let g=a;if(d){if(h){const e=s.texData.get(g.dataId).values,t=new Array(c);for(let r=0;r<t.length;r++)t[r]=a.shape[f[r]];const n=dG(e,a.shape,a.dtype,f,t);g=s.makeTensorInfo(t,a.dtype);s.texData.get(g.dataId).values=n}else g=dV(a,f,s);p.push(g),l=Yw(l.length,c)}Gw("sum",l,c);const[m,v]=Uw(g.shape,l);let b=m;i&&(b=Ww(m,u));const y=function(e,t,n,r){const a=ph(t),i=iV({inputs:{x:e},attrs:{shape:[ph(e.shape)/a,a]},backend:r}),o=uV(i,"float32","mean",r),s=iV({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(g,v,b,s);for(const x of p)s.disposeIntermediateTensorInfo(x);return y}};const iq={kernelName:Fg,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:o}=r,s=a.shape.length,c=wh(i,a.shape);let u=c;const l=Vw(u,s);let f=a;null!=l&&(f=gV({inputs:{x:a},backend:n,attrs:{perm:l}}),u=Yw(u.length,a.shape.length)),Gw("min",u,s);const[d,h]=Uw(f.shape,u),p=iV({inputs:{x:f},backend:n,attrs:{shape:[-1,ph(h)]}}),g=uV(p,p.dtype,"min",n);let m;if(o){m=iV({inputs:{x:g},backend:n,attrs:{shape:Ww(d,c)}})}else m=iV({inputs:{x:g},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),null!=l&&n.disposeIntermediateTensorInfo(f),m}},oq=QG({opSnippet:DG+"\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+PG+"\n  return result;\n",cpuKernelImpl:BW}),sq={kernelName:zg,backendName:"webgl",kernelFunc:oq};class cq{constructor(e,t,n){this.variableNames=["x"],this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1]));const r=e.length,a=XU(r),i=t.map((e=>e[0])).join(","),o=t.map(((t,n)=>t[0]+e[n])).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),c="reflect"===n?0:1;this.userCode=1!==r?"\n      ".concat(a," start = ").concat(a,"(").concat(i,");\n      ").concat(a," end = ").concat(a,"(").concat(o,");\n\n      void main() {\n        ").concat(a," outC = getOutputCoords();\n        for (int i = 0; i < ").concat(r,"; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ").concat(c,";\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ").concat(c,";\n          }\n        }\n        ").concat(a," coords = outC - start;\n        setOutput(getX(").concat(s,"));\n      }\n    "):"\n        int start = ".concat(i,";\n        int end = ").concat(o,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ").concat(c,";\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ").concat(c,";\n          }\n          setOutput(getX(outC - start));\n        }\n      ")}}class uq{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1]));const r=e.length,a=XU(r),i=t.map((e=>e[0])).join(","),o=t.map(((t,n)=>t[0]+e[n])).join(","),s=gG("rc",r),c=gG("source",r),u="".concat(s[r-1]," < ").concat(this.outputShape[r-1]),l=1===r?"source":"vec2(".concat(c.slice(-2).join(),")"),f="reflect"===n?0:1;let d="";if(1===r){const e="\n        ".concat(a," source = rc;\n        if (source < start) {\n          source = start * 2 - source - ").concat(f,";\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ").concat(f,";\n        }\n        source -= start;\n      ");d="\n        ".concat(a," rc = outputLoc;\n        ").concat(e,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(l,");\n        ").concat(s[r-1]," += 1;\n        if(").concat(u,") {\n          ").concat(e,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(l,");\n        }\n      ")}else{const e="\n        ".concat(a," source = rc;\n        ").concat(a," lt = ").concat(a,"(lessThan(source, start));\n        ").concat(a," gte = ").concat(a,"(greaterThanEqual(source, end));\n        ").concat(a," orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ").concat(f,") +\n                gte * ((end - 1) * 2 - source + ").concat(f,");\n        source -= start;\n      ");d="\n        ".concat(a," rc = outputLoc;\n        ").concat(e,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(l,");\n        ").concat(s[r-1]," += 1;\n        if(").concat(u,") {\n          ").concat(e,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(l,");\n        }\n        rc = outputLoc;\n        ").concat(s[r-2]," += 1;\n        if(").concat(s[r-2]," < ").concat(this.outputShape[r-2],") {\n          ").concat(e,"\n          result[2] = getChannel(getX(").concat(c.join(),"), ").concat(l,");\n          ").concat(s[r-1]," += 1;\n          if(").concat(u,") {\n            ").concat(e,"\n            result[3] = getChannel(getX(").concat(c.join(),"), ").concat(l,");\n          }\n        }\n      ")}this.userCode="\n      const ".concat(a," start = ").concat(a,"(").concat(i,");\n      const ").concat(a," end = ").concat(a,"(").concat(o,");\n\n      void main() {\n        ").concat(a," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(d,"\n        setOutput(result);\n      }\n    ")}}const lq={kernelName:jg,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e;const{x:a}=t,{paddings:i,mode:o}=r,s=Hh().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new uq(a.shape,i,o):new cq(a.shape,i,o);return n.runWebGLProgram(s,[a],a.dtype)}},fq=QG({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  bvec4 isNaN = equal(b, vec4(0.0));\n  "+PG+"\n  return result;\n"}),dq={kernelName:Bg,backendName:"webgl",kernelFunc:fq};class hq{constructor(e,t,n){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ".concat(t-1,"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(").concat(t-1,"));\n      }\n    ")}}const pq=QG({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),gq={kernelName:Xp,backendName:"webgl",kernelFunc:pq},mq="return a - b;",vq=QG({opSnippet:mq,packedOpSnippet:mq,supportsComplex:!0,cpuKernelImpl:uG}),bq={kernelName:Hm,backendName:"webgl",kernelFunc:vq};function yq(e){const{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{dim:i}=r,o=wh([i],a.shape),s=XX({inputs:{x:a},backend:n,attrs:{reductionIndices:o,keepDims:!1}}),c=Ww(s.shape,o),u=iV({inputs:{x:s},backend:n,attrs:{shape:c}}),l=vq({inputs:{a:a,b:u},backend:n}),f=zY({inputs:{x:l},backend:n}),d=hV({inputs:{x:f},backend:n,attrs:{axis:o,keepDims:!1}}),h=iV({inputs:{x:d},backend:n,attrs:{shape:c}}),p=pq({inputs:{a:f,b:h},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),p}const xq={kernelName:Am,backendName:"webgl",kernelFunc:yq};const wq={kernelName:Ug,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{numSamples:i,seed:o,normalized:s}=r,c=s?a:yq({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),u=c.shape[0],l=c.shape[1],f=new hq(u,l,i),d=[[o]],h=n.runWebGLProgram(f,[c],"int32",d);return s||n.disposeIntermediateTensorInfo(c),h}},Sq=CG+"\n  return -x;\n";const Cq={kernelName:Gg,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t;if(n.shouldExecuteOnCPU([r])){const e=n.texData.get(r.dataId),[t,a]=WW(e.values,r.shape,r.dtype);return n.makeTensorInfo(a,r.dtype,t)}let a;return a=Hh().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new IG(r.shape,"\n  vec4 result = -x;\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"):new SG(r.shape,Sq),n.runWebGLProgram(a,[r],r.dtype)}},Mq=dC;const _q={kernelName:Hg,backendName:"webgl",kernelFunc:function(e){cv("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:i}=t,{maxOutputSize:o,iouThreshold:s,scoreThreshold:c}=r,u=n.readSync(a.dataId),l=n.readSync(i.dataId),{selectedIndices:f}=Mq(u,l,o,s,c);return n.makeTensorInfo([f.length],"int32",new Int32Array(f))}},Eq=hC;const Tq={kernelName:Yg,backendName:"webgl",kernelFunc:function(e){cv("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:i}=t,{maxOutputSize:o,iouThreshold:s,scoreThreshold:c,padToMaxOutputSize:u}=r,l=n.readSync(a.dataId),f=n.readSync(i.dataId),{selectedIndices:d,validOutputs:h}=Eq(l,f,o,s,c,u);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([h]))]}},Iq=pC;const kq={kernelName:Xg,backendName:"webgl",kernelFunc:function(e){cv("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:i}=t,{maxOutputSize:o,iouThreshold:s,scoreThreshold:c,softNmsSigma:u}=r,l=n.readSync(a.dataId),f=n.readSync(i.dataId),d=o,h=s,p=c,g=u,{selectedIndices:m,selectedScores:v}=Iq(l,f,d,h,p,g);return[n.makeTensorInfo([m.length],"int32",new Int32Array(m)),n.makeTensorInfo([v.length],"float32",new Float32Array(v))]}};class Nq{constructor(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(".concat(r,"), float(").concat(n,"),\n                      float(index == coords.y)));\n      }\n    ")}}const Lq={kernelName:Kg,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{indices:a}=t,{dtype:i,depth:o,onValue:s,offValue:c}=r,u=ph(a.shape),l=new Nq(u,o,s,c),f=iV({inputs:{x:a},backend:n,attrs:{shape:[u]}}),d=n.runWebGLProgram(l,[f],i);n.disposeIntermediateTensorInfo(f);const h=iV({inputs:{x:d},backend:n,attrs:{shape:[...a.shape,o]}});return n.disposeIntermediateTensorInfo(d),h}};function Aq(e){const{inputs:t,backend:n}=e,{x:r}=t;if("complex64"===r.dtype){const e=yH({inputs:{input:r},backend:n}),t=Aq({inputs:{x:e},backend:n}),a=DH({inputs:{input:r},backend:n}),i=Aq({inputs:{x:a},backend:n}),o=BG({inputs:{real:t,imag:i},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),o}return KY({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}const Rq={kernelName:tv,backendName:"webgl",kernelFunc:Aq};const Dq={kernelName:qg,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:r}=t,{x:a}=n;if("string"===a.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===a.dtype){const t=yH({inputs:{input:a},backend:r}),n=e({inputs:{x:t},backend:r}),i=DH({inputs:{input:a},backend:r}),o=Aq({inputs:{x:i},backend:r}),s=BG({inputs:{real:n,imag:o},backend:r});return r.disposeIntermediateTensorInfo(t),r.disposeIntermediateTensorInfo(n),r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}return KY({attrs:{shape:a.shape,dtype:a.dtype,value:1},backend:r})}};const Oq={kernelName:Qg,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{axis:a}=r;if(1===t.length)return BY({inputs:{input:t[0]},backend:n,attrs:{dim:a}});const i=t[0].shape,o=t[0].dtype;t.forEach((e=>{dh(i,e.shape,"All tensors passed to stack must have matching shapes"),fh(o===e.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));const s=[],c=FH({inputs:t.map((e=>{const t=BY({inputs:{input:e},backend:n,attrs:{dim:a}});return s.push(t),t})),backend:n,attrs:{axis:a}});return s.forEach((e=>n.disposeIntermediateTensorInfo(e))),c}};class Pq{constructor(e,t,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1]));const r=e.length,a=XU(r),i=t.map((e=>e[0])).join(","),o=t.map(((t,n)=>t[0]+e[n])).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      ".concat(a," start = ").concat(a,"(").concat(i,");\n      ").concat(a," end = ").concat(a,"(").concat(o,");\n\n      void main() {\n        ").concat(a," outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ").concat(a," coords = outC - start;\n          setOutput(getX(").concat(s,"));\n        }\n      }\n    "):"\n        int start = ".concat(i,";\n        int end = ").concat(o,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ")}}class Fq{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1]));const r=e.length,a=XU(r),i=t.map((e=>e[0])).join(","),o=t.map(((t,n)=>t[0]+e[n])).join(","),s=gG("rc",r),c=gG("source",r),u="".concat(s[r-1]," < ").concat(this.outputShape[r-1]),l=1===r?"source":"vec2(".concat(c.slice(-2).join(),")"),f=["".concat(a," rc = outputLoc;"),"".concat(s[r-1]," += 1;\n       if(").concat(u,") {\n      "),1===r?"":"}\n       rc = outputLoc;\n       ".concat(s[r-2]," += 1;\n       if(").concat(s[r-2]," < ").concat(this.outputShape[r-2],") {"),1===r?"":"  ".concat(s[r-1]," += 1;\n         if(").concat(u,") {")],d=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let h="";for(let p=0,g=1===r?2:4;p<g;p++)h+="\n        ".concat(f[p],"\n        if (").concat(d,") {\n          result[").concat(p,"] = float(value);\n        } else {\n          ").concat(a," source = rc - start;\n          result[").concat(p,"] = getChannel(getX(").concat(c.join(),"), ").concat(l,");\n        }\n      ");h+=1===r?"} ":"}}",this.userCode="\n      const ".concat(a," start = ").concat(a,"(").concat(i,");\n      const ").concat(a," end = ").concat(a,"(").concat(o,");\n\n      void main() {\n        ").concat(a," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(h,"\n        setOutput(result);\n      }\n    ")}}const zq=e=>{const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{paddings:i,constantValue:o}=r;if(0===ph(a.shape)){const e=i.map(((e,t)=>e[0]+a.shape[t]+e[1]));return KY({backend:n,attrs:{shape:e,value:o,dtype:a.dtype}})}const s=Hh().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Fq(a.shape,i,o):new Pq(a.shape,i,o),c=[[o]];return n.runWebGLProgram(s,[a],a.dtype,c)},jq={kernelName:Jg,backendName:"webgl",kernelFunc:zq},Bq=QG({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  bvec4 isNaN1 = lessThan(a, vec4(0.0));\n  bvec4 isNaN2 = lessThan(floor(b), b);\n  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);\n  "+PG+"\n  return result;\n"}),Uq={kernelName:Zg,backendName:"webgl",kernelFunc:Bq};const Wq={kernelName:em,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:o}=r,s=a.shape.length,c=[],u=wh(i,a.shape);let l=u;const f=Vw(l,s);let d,h=a;if(null!=f&&(h=gV({inputs:{x:a},backend:n,attrs:{perm:f}}),l=Yw(l.length,s),c.push(h)),Gw("prod",l,s),n.shouldExecuteOnCPU([h])){const e=n.texData.get(h.dataId).values,{outVals:t,outShape:r,outDtype:a}=VW(h.shape,h.dtype,e,l);d=n.makeTensorInfo(r,a,t)}else{const[e,t]=Uw(h.shape,l),r=ph(t),i=iV({inputs:{x:h},backend:n,attrs:{shape:[-1,r]}}),o=uV(i,cb(a.dtype),"prod",n);d=iV({inputs:{x:o},backend:n,attrs:{shape:e}}),c.push(i),c.push(o)}if(o){c.push(d);const e=Ww(d.shape,u);d=iV({inputs:{x:d},backend:n,attrs:{shape:e}})}return c.forEach((e=>n.disposeIntermediateTensorInfo(e))),d}};const Gq={kernelName:tm,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{paramsNestedSplits:a,paramsDenseValues:i,indices:o}=t,{outputRaggedRank:s}=r,c=a.map((e=>n.readSync(e.dataId))),u=a.map((e=>e.shape)),l=n.readSync(i.dataId),f=n.readSync(o.dataId),[d,h,p]=HW(c,u,l,i.shape,i.dtype,f,o.shape,s),g=d.map((e=>n.makeTensorInfo([e.length],"int32",e))),m=n.makeTensorInfo(p,i.dtype,h);return g.concat([m])}};const Vq={kernelName:nm,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{starts:r,limits:a,deltas:i}=t,o=n.readSync(r.dataId),s=n.readSync(a.dataId),c=n.readSync(i.dataId),[u,l]=YW(o,r.shape,r.dtype,s,a.shape,c,i.shape);return[n.makeTensorInfo([u.length],"int32",u),n.makeTensorInfo([l.length],r.dtype,l)]}};const Hq={kernelName:rm,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{shape:a,values:i,defaultValue:o,rowPartitionTensors:s}=t,{rowPartitionTypes:c}=r,u=n.readSync(a.dataId),l=n.readSync(i.dataId),f=n.readSync(o.dataId),d=s.map((e=>n.readSync(e.dataId))),h=s.map((e=>e.shape)),[p,g]=XW(u,a.shape,l,i.shape,i.dtype,f,o.shape,d,h,c);return n.makeTensorInfo(p,i.dtype,g)}},Yq=e=>{const{backend:t,attrs:n}=e,{start:r,stop:a,step:i,dtype:o}=n,s=qW(r,a,i,o);return t.makeTensorInfo([s.length],o,s)},Xq={kernelName:am,backendName:"webgl",kernelFunc:Yq},qq=KG({opSnippet:"return 1.0 / x;"}),Kq={kernelName:om,backendName:"webgl",kernelFunc:qq},Qq=KG({opSnippet:CG+"\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),Jq={kernelName:sm,backendName:"webgl",kernelFunc:Qq},Zq=KG({opSnippet:CG+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),$q={kernelName:hm,backendName:"webgl",kernelFunc:Zq};class eK{constructor(e,t,n,r,a){this.variableNames=["A"],this.outputShape=[];const[i,o,s,c]=e;this.outputShape=[i,t,n,c];const u=[r&&t>1?o-1:o,r&&n>1?s-1:s],l=[r&&t>1?t-1:t,r&&n>1?n-1:n];let f;f=a?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(u[0]/l[0],",\n          ").concat(u[1]/l[1],");\n      const vec2 inputShapeRC = vec2(").concat(o,".0, ").concat(s,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(f,";\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    ")}}class tK{constructor(e,t,n,r,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,o,s,c]=e;this.outputShape=[i,t,n,c];const u=[r&&t>1?o-1:o,r&&n>1?s-1:s],l=[r&&t>1?t-1:t,r&&n>1?n-1:n];let f;f=a?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(u[0]/l[0],",\n          ").concat(u[1]/l[1],",\n          ").concat(u[1]/l[1],");\n      const vec3 inputShapeRC = vec3(").concat(o,".0, ").concat(s,".0,\n                                     ").concat(s,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(f,";\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(c-1,";\n        bool hasNextRow = coords.z < ").concat(n-1,";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    ")}}const nK={kernelName:fm,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:i,halfPixelCenters:o,size:s}=r,[c,u]=s,l=Hh().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new tK(a.shape,c,u,i,o):new eK(a.shape,c,u,i,o);return n.runWebGLProgram(l,[a],"float32")}};class rK{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,a]=t,[,i,o]=e,s=[n&&i>1?r-1:r,n&&o>1?a-1:a],c=[n&&i>1?i-1:i,n&&o>1?o-1:o],u=s[0]/c[0],l=s[1]/c[1],f=1/u,d=1/l,h=2*Math.ceil(f)+2,p=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(u,");\n        const float widthScale = float(").concat(l,");\n\n        const float invHeightScale = float(").concat(f,");\n        const float invWidthScale = float(").concat(d,");\n\n        const int winHeight = int(").concat(h,");\n        const int winWidth = int(").concat(p,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(i,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(o,") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ").concat(r-1,".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ").concat(a-1,".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}}const aK={kernelName:dm,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:a,dy:i}=t,{alignCorners:o}=r,s=new rK(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}};class iK{constructor(e,t,n,r,a){this.variableNames=["A"],this.outputShape=[];const[i,o,s,c]=e;this.outputShape=[i,t,n,c];const u=[r&&t>1?o-1:o,r&&n>1?s-1:s],l=[r&&t>1?t-1:t,r&&n>1?n-1:n],f=r?"0.5":"0.0";let d;d=a?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(u[0]/l[0],",\n          ").concat(u[1]/l[1],");\n      const vec2 inputShapeRC = vec2(").concat(o,".0, ").concat(s,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(f,")));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    ")}}class oK{constructor(e,t,n,r,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,o,s,c]=e;this.outputShape=[i,t,n,c];const u=[r&&t>1?o-1:o,r&&n>1?s-1:s],l=[r&&t>1?t-1:t,r&&n>1?n-1:n],f=r?"0.5":"0.0";let d;d=a?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(u[0]/l[0],",\n          ").concat(u[1]/l[1],",\n          ").concat(u[1]/l[1],");\n      const vec3 inputShapeRC = vec3(").concat(o,".0, ").concat(s,".0,\n                                     ").concat(s,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec3 sourceNearestRC = ivec3(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(f,")));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(c-1,";\n        bool hasNextRow = coords.z < ").concat(n-1,";\n\n        vec4 newValue = vec4(\n          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),\n          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);\n\n        setOutput(newValue);\n      }\n    ")}}const sK={kernelName:um,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:i,halfPixelCenters:o,size:s}=r,[c,u]=s,l=Hh().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new oK(a.shape,c,u,i,o):new iK(a.shape,c,u,i,o);return n.runWebGLProgram(l,[a],a.dtype)}};class cK{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,a]=t,[,i,o]=e,s=[n&&i>1?r-1:r,n&&o>1?a-1:a],c=[n&&i>1?i-1:i,n&&o>1?o-1:o],u=s[0]/c[0],l=s[1]/c[1],f=1/u,d=1/l,h=2*Math.ceil(f)+2,p=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(u,");\n        const float widthScale = float(").concat(l,");\n\n        const float invHeightScale = float(").concat(f,");\n        const float invWidthScale = float(").concat(d,");\n\n        const int winHeight = int(").concat(h,");\n        const int winWidth = int(").concat(p,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(i,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(o,") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(").concat(s[0],") *\n                (float(dyR) / float(").concat(c[0],"));\n\n            float sourceFracCol =\n                float(").concat(s[1],") *\n                  (float(dyC) / float(").concat(c[1],"));\n\n            int sourceNearestRow = int(min(\n                float(int(").concat(r,") - 1),\n                ").concat(n," ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(").concat(a,") - 1),\n                ").concat(n," ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}}const uK={kernelName:lm,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:a,dy:i}=t,{alignCorners:o}=r,s=new cK(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}};class lK{constructor(e,t){this.variableNames=["x"];const n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-".concat(n," tensor is not yet supported"));if(this.outputShape=e,1===n)return void(this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(".concat(e[0]," - coord - 1));\n        }\n      "));const r=e.map(((n,r)=>(n=>-1!==t.indexOf(n)&&1!==e[n]?"".concat(e[n]," - coords[").concat(n,"] - 1"):"coords[".concat(n,"]"))(r))).join(","),a=XU(n);this.userCode="\n      void main() {\n        ".concat(a," coords = getOutputCoords();\n        setOutput(getX(").concat(r,"));\n      }\n    ")}}class fK{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-".concat(n," tensor is not yet supported"));this.outputShape=e;const r=gG("rc",n),a="".concat(r[n-1]," + 1 < ").concat(this.outputShape[n-1]),i="".concat(r[n-2]," + 1 < ").concat(this.outputShape[n-2]),o=XU(n);function s(n){const r=e.map(((r,a)=>function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?"".concat(e[n]," - ").concat(r[n]," - 1"):"".concat(r[n])}(a,n))),a=r.join(","),i=r.slice(-2).join(",");return"getChannel(getX(".concat(a,"), vec2(").concat(i,"))")}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(".concat(e[0]," - rc - 1),\n            ").concat(e[0]," - rc - 1);\n          if(").concat(a,"){\n              result.g = getChannel(getX(").concat(e[0]," - (rc  + 1) - 1),\n                ").concat(e[0]," - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      "):"\n        void main() {\n          ".concat(o," rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ").concat(function(e){return s(e)}(r.slice()),";\n          if(").concat(a,"){\n            result.g = ").concat(function(e){return e[n-1]="("+e[n-1]+" + 1)",s(e)}(r.slice()),";\n          }\n          if(").concat(i,") {\n            result.b = ").concat(function(e){return e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice()),";\n            if(").concat(a,") {\n              result.a = ").concat(function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice()),";\n            }\n          }\n          setOutput(result);\n        }\n    ")}}const dK={kernelName:pm,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dims:i}=r,o=a.shape.length,s=wh(i,a.shape);if(0===o)return zG({inputs:{x:a},backend:n});const c=Hh().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new fK(a.shape,s):new lK(a.shape,s);return n.runWebGLProgram(c,[a],a.dtype)}};class hK{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const n=e[1],r=e[2];this.outputShape=e;let a="";a="number"===typeof t?"float outputValue = ".concat(t.toFixed(2),";"):"\n        vec3 fill = vec3(".concat(t.join(","),");\n        float outputValue = fill[coords[3]];"),this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ".concat(a,"\n          if(coordX >= 0 && coordX < ").concat(r," && coordY >= 0 && coordY < ").concat(n,") {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")}}const pK={kernelName:av,backendName:"webgl",kernelFunc:e=>{let{inputs:t,attrs:n,backend:r}=e;const{image:a}=t,{radians:i,fillValue:o,center:s}=n,c=r,u=new hK(a.shape,o),[l,f]=eM(s,a.shape[1],a.shape[2]),d=[[l,f,Math.sin(i),Math.cos(i)]];return c.runWebGLProgram(u,[a],a.dtype,d)}},gK=KG({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"}),mK={kernelName:gm,backendName:"webgl",kernelFunc:gK},vK=KG({opSnippet:"return inversesqrt(x);",cpuKernelImpl:KW}),bK={kernelName:mm,backendName:"webgl",kernelFunc:vK};class yK{constructor(e,t,n,r,a,i){let o=arguments.length>7&&void 0!==arguments[7]&&arguments[7];this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;const s=XU(a.length),c=XU(i.length);let u="";1===n?u="i":2===n&&(u="i, j");const l="getIndices(".concat(u,")");let f="";1===r?f="i":2===r&&(f="i, coords[1]");const d="getUpdates(".concat(f,")");let h="";o&&(h="coords[0], coords[1]");const p="getDefaultValue(".concat(h,")"),g=t>1?"strides[j]":"strides";this.userCode="\n        ".concat(s," strides = ").concat(s,"(").concat(a,");\n\n        void main() {\n          ").concat(c," coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ").concat(e,"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ").concat(t,"; j++) {\n              int index = round(").concat(l,");\n              flattenedIndex += index * ").concat(g,";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ").concat(d,";\n              found = true;\n            }\n          }\n          setOutput(mix(").concat(p,", sum, float(found)));\n        }\n      ")}}class xK{constructor(e,t,n,r,a,i){let o=arguments.length>7&&void 0!==arguments[7]&&arguments[7];this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=i;const s=XU(a.length),c=XU(i.length);let u="";1===n?u="i":2===n&&(u="i, j");const l="getIndices(".concat(u,")");let f="";1===r?f="i":2===r&&(f="i, coords[1]");const d="getUpdates(".concat(f,")");let h="";o&&(h="coords[0], coords[1]");const p="getDefaultValue(".concat(h,")"),g=t>1?"strides[j]":"strides",m=t>1?"strides[j + 1]":"strides";this.userCode="\n        ".concat(s," strides = ").concat(s,"(").concat(a,");\n\n        void main() {\n          ").concat(c," coords = getOutputCoords();\n          vec4 sum = vec4(0.);\n          vec4 found = vec4(0.);\n          for (int i = 0; i < ").concat(e,"; i+=2) {\n            ivec2 flattenedIndex = ivec2(0);\n            for (int j = 0; j < ").concat(t,"; j+=2) {\n              ivec4 index = round(").concat(l,");\n              flattenedIndex += index.xz * ").concat(g,";\n              if (j + 1 < ").concat(t,") {\n                flattenedIndex += index.yw * ").concat(m,";\n              }\n            }\n            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||\n                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {\n              vec4 updVals = ").concat(d,";\n              if (flattenedIndex[0] == coords[0]) {\n                sum.xy += updVals.xy;\n                found.xy = vec2(1.);\n              } else if (flattenedIndex[0] == coords[0] + 1) {\n                sum.zw += updVals.xy;\n                found.zw = vec2(1.);\n              }\n              if (flattenedIndex[1] == coords[0]) {\n                sum.xy += updVals.zw;\n                found.xy = vec2(1.);\n              } else if (flattenedIndex[1] == coords[0] + 1) {\n                sum.zw += updVals.zw;\n                found.zw = vec2(1.);\n              }\n            }\n          }\n          setOutput(mix(").concat(p,", sum, found));\n        }\n      ")}}const wK={kernelName:vm,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{indices:a,updates:i}=t,{shape:o}=r,{sliceRank:s,numUpdates:c,sliceSize:u,strides:l,outputSize:f}=uM(0,a,o),d=[f/u,u];if(0===f)return n.makeTensorInfo(o,a.dtype);const h=iV({inputs:{x:a},backend:n,attrs:{shape:[c,s]}}),p=iV({inputs:{x:i},backend:n,attrs:{shape:[c,u]}}),g=n.makeTensorInfo([],"float32",new Float32Array([0]));let m;m=Hh().getBool("WEBGL_PACK")?new xK(c,s,h.shape.length,p.shape.length,l,d):new yK(c,s,h.shape.length,p.shape.length,l,d);const v=n.runWebGLProgram(m,[p,h,g],p.dtype),b=iV({inputs:{x:v},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),b}};class SK{constructor(e,t,n,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,n];const a="for (int i = 0; i < ".concat(Math.ceil(Math.log2(t+1)),"; ++i) { if (left >= right) break;"),i=2===Hh().getNumber("WEBGL_VERSION")?"while (left < right) {":a,o="left"===r?"<":"<=";this.userCode="\n       int findBound(int batch, float value) {\n         int left = 0;\n         int right = numInputs;\n         int mid;\n         ".concat(i,"\n           mid = (left + right) / 2;\n           if (getSortedSequence(batch, mid) ").concat(o," value) {\n             left = mid + 1;\n           } else {\n             right = mid;\n           }\n         }\n         return right;\n       }\n\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int valueIndex = coords[1];\n\n         float value = getValues(batch, valueIndex);\n\n         setOutput(float(findBound(batch, value)));\n       }\n     ")}}const CK={kernelName:ym,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{sortedSequence:a,values:i}=t,{side:o}=r,s=new SK(a.shape[0],a.shape[1],i.shape[1],o),c=[[a.shape[1]]];return n.runWebGLProgram(s,[a,i],"int32",c)}};class MK{constructor(e,t,n){let r,a;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank ".concat(n," is not yet supported"));if(1===n)a="resRC",r="resRC";else{const n=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],o=[];for(let r=0;r<t.length;r++)o.push("".concat(n[r])),r<e&&i.push("".concat(n[r]));r=i.join(),a=o.join()}const i=XU(n);this.userCode="\n      void main() {\n        ".concat(i," resRC = getOutputCoords();\n        float cVal = getC(").concat(r,");\n        if (cVal >= 1.0) {\n          setOutput(getA(").concat(a,"));\n        } else {\n          setOutput(getB(").concat(a,"));\n        }\n      }\n    ")}}const _K={kernelName:xm,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{condition:r,t:a,e:i}=t,o=new MK(r.shape.length,a.shape,a.shape.length);return n.runWebGLProgram(o,[r,a,i],sb(a.dtype,i.dtype))}},EK=KG({opSnippet:"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ".concat(lM,";\n  float scale = ").concat(fM,";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n")}),TK={kernelName:wm,backendName:"webgl",kernelFunc:EK},IK=KG({opSnippet:qG+"\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",packedOpSnippet:"\n  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:JW}),kK={kernelName:Em,backendName:"webgl",kernelFunc:IK},NK=KG({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"}),LK={kernelName:_m,backendName:"webgl",kernelFunc:NK},AK=KG({opSnippet:qG+"\n  return sin(x);\n",packedOpSnippet:"\n  vec4 result = sin(x);\n  bvec4 isNaN = isnan(x);\n  ".concat(PG,"\n  return result;\n")}),RK={kernelName:Cm,backendName:"webgl",kernelFunc:AK},DK=KG({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"}),OK={kernelName:Mm,backendName:"webgl",kernelFunc:DK},PK=KG({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"}),FK={kernelName:Tm,backendName:"webgl",kernelFunc:PK},zK={kernelName:Nm,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:i,paddings:o}=r;fh(a.shape.length<=4,(()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"));const s=i.reduce(((e,t)=>e*t)),c=[[0,0]];c.push(...o);for(let v=1+i.length;v<a.shape.length;++v)c.push([0,0]);const u=[],l=zq({inputs:{x:a},backend:n,attrs:{paddings:c,constantValue:0}}),f=tM(l.shape,i,s,!1),d=nM(f.length,i.length,!1),h=rM(l.shape,i,s,!1),p=iV({inputs:{x:l},backend:n,attrs:{shape:f}}),g=gV({inputs:{x:p},backend:n,attrs:{perm:d}}),m=iV({inputs:{x:g},backend:n,attrs:{shape:h}});return u.push(l),u.push(p),u.push(g),u.forEach((e=>n.disposeIntermediateTensorInfo(e))),m}};const jK={kernelName:Rm,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{indices:r,values:a,denseShape:i,defaultValue:o}=t;if(1!==i.shape.length)throw new Error("Dense shape must be a vector, saw:\n         ".concat(i.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n         ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n         ".concat(a.shape));if(0!==o.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(o.shape));const s=n.readSync(r.dataId),c=n.readSync(a.dataId),u=n.readSync(i.dataId),l=n.readSync(o.dataId)[0],[f,d,h,p,g]=eG(s,r.shape,r.dtype,c,a.dtype,u,l);return[n.makeTensorInfo(d,r.dtype,f),n.makeTensorInfo([d[0]],a.dtype,h),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map((e=>Number(e))))),n.makeTensorInfo([g.length],r.dtype,new Int32Array(g))]}};const BK={kernelName:Dm,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{inputIndices:r,inputShape:a,newShape:i}=t;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));const o=Array.from(n.readSync(a.dataId)),s=n.readSync(r.dataId),c=Array.from(n.readSync(i.dataId)),[u,l,f]=tG(s,r.shape,r.dtype,o,c);return[n.makeTensorInfo(l,r.dtype,u),n.makeTensorInfo([f.length],i.dtype,new Int32Array(f))]}};const UK={kernelName:Om,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:r,indices:a,segmentIds:i}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n              ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n              ".concat(i.shape));const o=n.readSync(r.dataId),s=n.readSync(a.dataId),c=n.readSync(i.dataId),[u,l]=nG(o,r.shape,r.dtype,s,c,!0);return n.makeTensorInfo(l,r.dtype,u)}};const WK={kernelName:Pm,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:r,indices:a,segmentIds:i}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n             ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n             ".concat(i.shape));const o=n.readSync(r.dataId),s=n.readSync(a.dataId),c=n.readSync(i.dataId),[u,l]=nG(o,r.shape,r.dtype,s,c);return n.makeTensorInfo(l,r.dtype,u)}};const GK={kernelName:Fm,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{sparseIndices:a,sparseValues:i,defaultValue:o}=t,{outputShape:s}=r,{sliceRank:c,numUpdates:u,sliceSize:l,strides:f,outputSize:d}=uM(0,a,s),h=!1;if("string"===i.dtype){const e=n.bufferSync(a),t=n.bufferSync(i),r=Fv(n.readSync(o.dataId)[0]),p=QW(e,t,s,d,l,u,c,f,r,h);return n.makeTensorInfo(s,p.dtype,p.values)}const p=new yK(u,c,a.shape.length,i.shape.length,f,[d,1],h),g=n.runWebGLProgram(p,[i,a,o],i.dtype),m=iV({inputs:{x:g},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(g),m}};const VK={kernelName:Lm,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{numOrSizeSplits:i,axis:o}=r,s=wh(o,a.shape)[0],c=PM(a,i,s),u=a.shape.length,l=new Array(u).fill(0),f=a.shape.slice();return c.map((e=>{const t=[...f];t[s]=e;const r=fH({inputs:{x:a},backend:n,attrs:{begin:l,size:t}});return l[s]+=e,r}))}},HK="return sqrt(x);",YK=KG({opSnippet:HK,packedOpSnippet:HK,cpuKernelImpl:rG}),XK={kernelName:Im,backendName:"webgl",kernelFunc:YK},qK={kernelName:jm,backendName:"webgl",kernelFunc:KG({opSnippet:"return x * x;"})},KK="return (a - b) * (a - b);",QK=QG({opSnippet:KK,packedOpSnippet:KK}),JK={kernelName:zm,backendName:"webgl",kernelFunc:QK};const ZK={kernelName:Bm,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t;if("string"!==a.dtype)throw new Error("Input must be of datatype string");const i=ZM(n.readSync(a.dataId)),o=aG(i,"string",r);return n.makeTensorInfo(a.shape,"string",o)}};const $K={kernelName:nv,backendName:"webgl",kernelFunc:function(e){let{inputs:t,attrs:n,backend:r}=e;const{x:a}=t,i=CG+"\n    return x > 0.0 ? 1.0 : float(".concat(n.alpha,");\n  "),o=new SG(a.shape,i);return r.runWebGLProgram(o,[a],a.dtype)}};class eQ{constructor(e,t,n){this.variableNames=["x"],this.outputShape=n;const r=n.length,a=XU(n.length),i=XU(n.length);let o="";if(1===r)o="coords * strides + begin";else{let e=0;o=n.map(((t,r)=>(e++,1===n.length?"coords * strides[".concat(r,"] + begin[").concat(r,"]"):"coords[".concat(e-1,"] * strides[").concat(r,"] + begin[").concat(r,"]")))).join(",")}this.userCode="\n      ".concat(a," begin = ").concat(a,"(").concat(e,");\n      ").concat(a," strides = ").concat(a,"(").concat(t,");\n\n      void main() {\n        ").concat(i," coords = getOutputCoords();\n        setOutput(getX(").concat(o,"));\n      }\n    ")}}const tQ={kernelName:Um,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:i,end:o,strides:s,beginMask:c,endMask:u,ellipsisMask:l,newAxisMask:f,shrinkAxisMask:d}=r,{finalShapeSparse:h,finalShape:p,isIdentity:g,sliceDim0:m,isSimpleSlice:v,begin:b,end:y,strides:x}=Rx(a.shape,i,o,s,c,u,l,f,d);let w;if(g)w=iV({inputs:{x:a},backend:n,attrs:{shape:p}});else if(m||v){fh(a.shape.length>=1,(()=>"Input must have rank at least 1, got: ".concat(a.shape.length)));const e=xx(b,y,x),t=fH({inputs:{x:a},backend:n,attrs:{begin:b,size:e}});w=iV({inputs:{x:t},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(t)}else{if(n.shouldExecuteOnCPU([a])){const e=n.readSync(a.dataId),t=Ty(a.shape,a.dtype,e),r=iG(h,t,x,b);w=n.makeTensorInfo(p,a.dtype,r.values)}else{const e=new eQ(b,x,h);w=n.runWebGLProgram(e,[a],a.dtype)}}const S=iV({inputs:{x:w},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(w),S}};const nQ={kernelName:Wm,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{separator:a,nGramWidths:i,leftPad:o,rightPad:s,padWidth:c,preserveShortSequences:u}=r,{data:l,dataSplits:f}=t,d=n.readSync(l.dataId),h=n.readSync(f.dataId),[p,g]=oG(d,h,a,i,o,s,c,u);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(f.shape,"int32",g)]}};const rQ={kernelName:Gm,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{skipEmpty:a}=r,{input:i,delimiter:o}=t;if("string"!==i.dtype)throw new Error("Input must be of datatype string");if(1!==i.shape.length)throw new Error("Input must be a vector, got shape: ".concat(i.shape));if(0!==o.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(o.shape));const s=n.readSync(i.dataId),c=n.readSync(o.dataId)[0],[u,l,f]=sG(s,c,a),d=l.length;return[n.makeTensorInfo([d,2],"int32",u),n.makeTensorInfo([d],"string",l),n.makeTensorInfo([2],"int32",new Int32Array(f))]}};const aQ={kernelName:Vm,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{numBuckets:a}=r,{input:i}=t;if("string"!==i.dtype)throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");const o=n.readSync(i.dataId),s=cG(o,a);return n.makeTensorInfo(i.shape,"int32",s)}},iQ=KG({opSnippet:"return tan(x);"}),oQ={kernelName:Ym,backendName:"webgl",kernelFunc:iQ},sQ=KG({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"}),cQ={kernelName:Xm,backendName:"webgl",kernelFunc:sQ};const uQ={kernelName:bm,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{tensor:a,indices:i,updates:o}=t,{}=r,{sliceRank:s,numUpdates:c,sliceSize:u,strides:l,outputSize:f}=uM(0,i,a.shape),d=[f/u,u];if(0===f)return n.makeTensorInfo(a.shape,i.dtype);const h=iV({inputs:{x:i},backend:n,attrs:{shape:[c,s]}}),p=iV({inputs:{x:o},backend:n,attrs:{shape:[c,u]}}),g=iV({inputs:{x:a},backend:n,attrs:{shape:d}}),m=new yK(c,s,h.shape.length,p.shape.length,l,d,!1,!0),v=n.runWebGLProgram(m,[p,h,g],g.dtype),b=iV({inputs:{x:v},backend:n,attrs:{shape:a.shape}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(v),b}};class lQ{constructor(e,t){this.variableNames=["A"];const n=new Array(e.length);for(let i=0;i<n.length;i++)n[i]=e[i]*t[i];this.outputShape=n,this.rank=n.length;const r=XU(this.rank),a=function(e){const t=e.length;if(t>5)throw Error("Tile for rank ".concat(t," is not yet supported"));if(1===t)return"imod(resRC, ".concat(e[0],")");const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let a=0;a<e.length;a++)r.push("imod(".concat(n[a],", ").concat(e[a],")"));return r.join()}(e);this.userCode="\n      void main() {\n        ".concat(r," resRC = getOutputCoords();\n        setOutput(getA(").concat(a,"));\n      }\n    ")}}function fQ(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reps:i}=r;if("string"===a.dtype||a.shape.length>5){const e=n.readSync(a.dataId),t="string"===a.dtype?e.map((e=>Fv(e))):e,r=Ty(a.shape,a.dtype,t),o=lG(r,i);return n.makeTensorInfo(o.shape,o.dtype,o.values)}const o=new lQ(a.shape,i);return n.runWebGLProgram(o,[a],a.dtype)}const dQ={kernelName:qm,backendName:"webgl",kernelFunc:fQ};class hQ{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode="\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // We compare elements pair-wise within a group of size 2 * inc.\n         // The comparing rule for each group alternates between ascending\n         // and descending. Within each group, we compare each pair at\n         // positions i and i+inc. To decide whether an element at position i\n         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n         // inc, it is in the first half of the group, we denote it as x0,\n         // otherwise we denote it as x1.\n         // For example, as shown in the Bitonic top K paper referenced above,\n         // Figure5(a) shows that element[1] is in the\n         // second half of the group when group size is 2, but it is in the\n         // first half of the group when group size is 4.\n\n         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;\n         int i = isFirstInPair ? elemIdx : elemIdx - inc;\n\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));\n         float x0 = i0 < n ? getX(batch, i0) : negativeInf;\n         float x1 = i1 < n ? getX(batch, i1) : negativeInf;\n\n         // Denotes which direction indices are in (ascending or descending).\n         bool reverse = imod(elemIdx, 2 * dir) >= dir;\n         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n         if (reverse == isGreater) { // Elements in opposite order of direction\n           int iTemp = i0;\n           i0 = i1;\n           i1 = iTemp;\n         }\n         if (isFirstInPair) {\n            setOutput(float(i0));\n         } else {\n            setOutput(float(i1));\n         }\n       }\n     "}}class pQ{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode="\n    void main() {\n         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // The output size is half of the previous size.\n         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),\n         // we only need to output the indices at positions |, the indices at\n         // positions _ can be thrown away, see Figure5(b) After Phase 2\n         // (Merge phase) in the Bitonic Top K paper referenced above.\n         // For example, the paper shows we only need to output the orange bars.\n         // The output sequence should look like this | | | | | | | |.\n         // Because the sequence is halved, to map the output index back\n         // to the previous sequence to find the corresponding value,\n         // we need to double the index. When we double the index,\n         // we basically interpolate a position, so 2i looks like\n         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position\n         // of each 2k positions by - elemIdx % k. E.g. for output at\n         // index 4,5,6,7, we want to get the corresponding element at\n         // original index 8,9,10,11, for output at index 8,9,10,11,\n         // we want to get the corresponding element at original index\n         // 16,17,18,19, so on and so forth.\n\n         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));\n\n         float x0 = getX(batch, i0);\n         float x1 = i1 < n ? getX(batch, i1) : x0;\n\n         setOutput(x0 >= x1 ? float(i0) : float(i1));\n       }\n     "}}function gQ(e,t){null!==t&&e.disposeIntermediateTensorInfo(t)}function mQ(e){let t=1;for(;t<e;)t*=2;return t}const vQ={kernelName:Km,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{k:i,sorted:o}=r,s=Hh().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),c=Hh().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),u=a.shape,l=u[u.length-1];if(n.shouldExecuteOnCPU([a])||l<s||i>c){const e=n.readSync(a.dataId),[t,r]=fG(e,u,a.dtype,i,o);return[n.makeTensorInfo(t.shape,t.dtype,t.values),n.makeTensorInfo(r.shape,r.dtype,r.values)]}if(0===i)return u[u.length-1]=0,[n.makeTensorInfo(u,a.dtype,[]),n.makeTensorInfo(u,"int32",[])];if(1===l)return[a,KY({attrs:{shape:u,dtype:"int32",value:0},backend:n})];const f=n.texData.get(a.dataId),d=null!==f&&f.isPacked,h=d?n.unpackTensor(a):a,p=ph(u)/l,g=iV({inputs:{x:h},attrs:{shape:[p,l]},backend:n});d&&gQ(n,h);const m=mQ(i),v=mQ(l);let b=null;const y=()=>null===b?[g,g]:[g,b],x=(e,t,r)=>{const a=y(),i=new hQ(r),o=[[l],[null===b?1:0],[Number.NEGATIVE_INFINITY],[e],[t]],s=b;b=n.runWebGLProgram(i,a,"int32",o),gQ(n,s)};for(let _=1;_<m;_*=2){const e=2*_;for(let t=_;t>=1;t/=2)x(e,t,[p,v])}for(let _=v;_>m;_/=2){const e=y(),t=new pQ([p,_/2]),r=[[l],[null===b?1:0],[m]],a=b;b=n.runWebGLProgram(t,e,"int32",r),gQ(n,a);const i=m/2,o=2*i;for(let n=i;n>=1;n/=2)x(o,n,b.shape)}let w=b;b=fH({inputs:{x:b},backend:n,attrs:{begin:0,size:[p,i]}}),gQ(n,w);let S=pX({inputs:{x:g,indices:b},backend:n,attrs:{axis:1,batchDims:1}});gQ(n,g);const C=u.slice(0,-1);C.push(i),w=b,b=iV({inputs:{x:b},attrs:{shape:C},backend:n}),gQ(n,w);const M=S;return S=iV({inputs:{x:S},attrs:{shape:C},backend:n}),gQ(n,M),[S,b]}};class bQ{constructor(e,t,n,r,a,i){this.variableNames=["Image","Transforms"],this.outputShape=i;const o="nearest"===n?1:2;let s;switch(r){case"constant":default:s=1;break;case"reflect":s=2;break;case"wrap":s=3;break;case"nearest":s=4}this.userCode="\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(".concat(s," == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ").concat(e," && 0 <= coordX && coordX < ").concat(t,") {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(").concat(a,");\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(").concat(a,");\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(").concat(t,"));\n                float mapY = mapCoord(inY, float(").concat(e,"));\n\n                if (").concat(o," == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        ")}}const yQ={kernelName:Qm,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{image:a,transforms:i}=t,{interpolation:o,fillMode:s,fillValue:c,outputShape:u}=r,[l,f,d,h]=a.shape,[p,g]=null!=u?u:[f,d],m=new bQ(f,d,o,s,c,[l,p,g,h]);return n.runWebGLProgram(m,[a,i],"float32")}};const xQ={kernelName:Zm,backendName:"webgl",kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,{axis:a}=n,{x:i}=t;kU(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=r.readSync(i.dataId),{outputValues:s,outputShape:c,indices:u}=hG(o,a,i.shape,i.dtype);return[r.makeTensorInfo(c,i.dtype,s),r.makeTensorInfo([u.length],"int32",u)]}};const wQ={kernelName:$m,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{value:a}=t;let{axis:i}=r;i<0&&(i+=a.shape.length);const o=a,s=o.shape.length,c=a.shape[i],u=new Array(s-1);let l=0;for(let g=0;g<s;g++)g!==i&&(u[l++]=o.shape[g]);const f=[],d=new Array(s).fill(0),h=o.shape.slice();h[i]=1;const p=new Array(c);for(let g=0;g<p.length;g++){d[i]=g;const e=fH({inputs:{x:o},backend:n,attrs:{begin:d,size:h}}),t=iV({inputs:{x:e},backend:n,attrs:{shape:u}});p[g]=t,f.push(e)}return f.forEach((e=>n.disposeIntermediateTensorInfo(e))),p}};class SQ{constructor(e,t){this.variableNames=["x","segmentIds"];const n=e.windowSize,r=e.batchSize,a=e.inSize,i=e.numSegments,o=i*Math.ceil(a/n);this.outputShape=[r,o];const s=4*Math.floor(n/4),c=n%4,u="\n        sumValue += dot(values, segFilter);\n    ";let l="";a%n>0&&(l="\n        if (inIdx < 0 || inIdx >= ".concat(a,") {\n          return initializationValue;\n        }\n      "));let f="";a%n>0&&(f="\n        if (inIdx < 0 || inIdx >= ".concat(a,") {\n          return -1.0;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat("0.0",";\n\n      float getValue(int batch, int inIdx) {\n        ").concat(l,"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ").concat(f,"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ").concat(i,")) * float(").concat(n,"));\n        int currentSeg = int(mod(float(outIdx), float(").concat(i,")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(s,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ").concat(u,"\n        }\n\n        int inIdx = inOffset + ").concat(s,";\n        if (").concat(1===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ").concat(u,"\n        } else if (").concat(2===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ").concat(u,"\n        } else if (").concat(3===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ").concat(u,"\n        }\n        setOutput(").concat("sumValue",");\n      }\n    ")}}const CQ={kernelName:ev,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,segmentIds:i}=t,{numSegments:o}=r,s=a.shape.length,c=[];let u=0;const l=Vw([u],s);let f=a;null!=l&&(f=gV({inputs:{x:a},backend:n,attrs:{perm:l}}),c.push(f),u=Yw(1,s)[0]);const d=QM(f.shape,u,o),h=ph([f.shape[u]]),p=iV({inputs:{x:f},backend:n,attrs:{shape:[-1,h]}});c.push(p);const g=cb(a.dtype),m=(e,t,r,a,i)=>{const o=e.shape[0],s=e.shape[1],u=KM(s,i),l=new SQ({windowSize:u,inSize:s,batchSize:o,numSegments:i},t),f=n.compileAndRun(l,[e,r],a);if(c.push(f),f.shape[1]===i)return f;const d=Yq({backend:n,attrs:{start:0,stop:i,step:1,dtype:"float32"}}),h=fQ({inputs:{x:d},backend:n,attrs:{reps:[s/u]}});c.push(d),c.push(h);return m(f,t,h,a,i)},v=iV({inputs:{x:m(p,"unsortedSegmentSum",i,g,o)},backend:n,attrs:{shape:d}});let b=v;if(null!=l){c.push(v);const e=Hw(l);b=gV({inputs:{x:b},backend:n,attrs:{perm:e}})}return c.forEach((e=>n.disposeIntermediateTensorInfo(e))),b}},MQ=[bV,xV,SV,MV,TV,NV,LV,AV,zV,jV,UV,GV,HV,XV,KV,ZV,$V,nH,rH,aH,sH,hH,pH,gH,mH,wH,MH,TH,UG,NH,zH,YH,JH,$H,eY,tY,nY,aY,oY,cY,pY,gY,mY,bY,wY,MY,_Y,TY,kY,NY,AY,RY,OY,FY,jY,UY,VY,XY,QY,ZY,tX,rX,oX,uX,lX,dX,gX,vX,yX,jG,xX,OH,SX,MX,EX,VG,IX,NX,LX,RX,OX,FX,jX,UX,VX,YX,qX,QX,JX,ZX,tq,nq,rq,aq,iq,sq,lq,dq,wq,aV,Cq,_q,Tq,kq,bH,Lq,Dq,Oq,jq,Uq,XG,Wq,Gq,Vq,Hq,Xq,xH,gq,Kq,Jq,$q,oV,nK,aK,sK,uK,dK,pK,mK,bK,wK,CK,_K,TK,kK,LK,RK,OK,dH,xq,FK,zK,jK,BK,UK,WK,GK,VK,XK,qK,JK,ZK,$K,tQ,nQ,rQ,aQ,bq,pV,oQ,cQ,uQ,dQ,vQ,yQ,mV,xQ,wQ,CQ,Rq];for(const n of MQ)gv(n);var _Q=n(2285),EQ=n(6382).Buffer,TQ=function(e,t){return(TQ=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function IQ(e,t){function n(){this.constructor=e}TQ(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function kQ(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?a(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))}function NQ(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var LQ=function(){function e(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return e.prototype.setPlatform=function(e,t){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},e.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+r+"."),this.set(e,r)}},e.prototype.get=function(e){return e in this.flags||(this.flags[e]=this.evaluateFlag(e)),this.flags[e]},e.prototype.getNumber=function(e){return this.get(e)},e.prototype.getBool=function(e){return this.get(e)},e.prototype.getFlags=function(){return this.flags},Object.defineProperty(e.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),e.prototype.set=function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)},e.prototype.evaluateFlag=function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},e.prototype.setFlags=function(e){this.flags=Object.assign({},e)},e.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},e.prototype.populateURLFlags=function(){var e=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var t,n,r=(t=this.global.location.search,n={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(n,t[0],t[1]),t.join("=")})),n);"tfjsflags"in r&&r.tfjsflags.split(",").forEach((function(t){var n=t.split(":"),r=n[0],a=n[1];e.urlFlags[r]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error("Could not parse value flag value "+t+" for flag "+e+".")}(r,a)}))}},e}();function AQ(){return RQ}var RQ=null,DQ=new Map,OQ=new Map;function PQ(e,t){var n=BQ(e,t);return DQ.get(n)}function FQ(e){for(var t=DQ.entries(),n=[];;){var r=t.next(),a=r.done,i=r.value;if(a)break;var o=i[0],s=i[1];o.split("_")[0]===e&&n.push(s)}return n}function zQ(e){var t=e.kernelName,n=e.backendName,r=BQ(t,n);if(DQ.has(r))throw new Error("The kernel '"+t+"' for backend '"+n+"' is already registered");DQ.set(r,e)}function jQ(e){var t=e.kernelName;OQ.has(t)&&console.warn("Overriding the gradient for '"+t+"'"),OQ.set(t,e)}function BQ(e,t){return t+"_"+e}function UQ(e){for(var t=e.length,n=0,r=0;t>0;)r=Math.random()*t|0,n=e[--t],e[t]=e[r],e[r]=n}function WQ(e,t,n){return Math.max(e,Math.min(t,n))}function GQ(e){return e%2==0?e:e+1}function VQ(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function HQ(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function YQ(e,t,n){void 0===n&&(n=""),HQ(QQ(e,t),(function(){return n+" Shapes "+e+" and "+t+" must match"}))}function XQ(e){HQ(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function qQ(e,t,n){if(void 0===t&&(t=[]),void 0===n&&(n=!1),null==t&&(t=[]),Array.isArray(e)||lJ(e)&&!n)for(var r=0;r<e.length;++r)qQ(e[r],t,n);else t.push(e);return t}function KQ(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function QQ(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function JQ(e){return e%1==0}function ZQ(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function $Q(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function eJ(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function tJ(e,t,n){return void 0===t&&(t=function(e){return 0}),new Promise((function(r,a){var i=0,o=function(){if(e())r();else{i++;var s=t(i);null!=n&&i>=n?a():setTimeout(o,s)}};o()}))}function nJ(e,t){for(var n=1,r=-1,a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(-1===e[a]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+a);r=a}else if(e[a]<0)throw Error("Shapes can not be < 0. Found "+e[a]+" at dim "+a);if(-1===r){if(t>0&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(0===n)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var i=e.slice();return i[r]=t/n,i}function rJ(e,t){var n=t.length;return HQ((e=null==e?t.map((function(e,t){return t})):[].concat(e)).every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e})),HQ(e.every((function(e){return JQ(e)})),(function(){return"All values in axis param must be integers but got axis "+e})),e.map((function(e){return e<0?n+e:e}))}function aJ(e,t){for(var n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||a?null:rJ(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=i){if(i[o]===s&&1!==e[s])throw new Error("Can't squeeze axis "+s+" since its dim '"+e[s]+"' is not 1");(null==i[o]||i[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),i[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function iJ(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function oJ(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type "+e);n=new Array(t)}return n}function sJ(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function cJ(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function uJ(e,t){return"complex64"!==t&&("float32"!==t||"complex64"===e)&&("int32"!==t||"float32"===e||"complex64"===e)&&("bool"!==t||"bool"!==e)}function lJ(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function fJ(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype "+e)}function dJ(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}function hJ(e){return"string"==typeof e||e instanceof String}function pJ(e){return"boolean"==typeof e}function gJ(e){return"number"==typeof e}function mJ(e){return Array.isArray(e)?mJ(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":gJ(e)?"float32":hJ(e)?"string":pJ(e)?"bool":"float32"}function vJ(e){return!!(e&&e.constructor&&e.call&&e.apply)}function bJ(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function yJ(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function xJ(e,t,n){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=qQ(e)),n&&sJ(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var r=new Uint8Array(e.length),a=0;a<r.length;++a)0!==Math.round(e[a])&&(r[a]=1);return r}throw new Error("Unknown data type "+t)}function wJ(e,t){if(0===e.length)return t[0];var n=e.reduce((function(e,t){return e*t}));if(0===n)return[];if(n!==t.length)throw new Error("["+e+"] does not match the input size.");return function e(t,n,r){var a=new Array;if(1===n.length)for(var i=n[0],o=0;o<i;o++)a[o]=r[t+o];else{i=n[0];var s=n.slice(1),c=s.reduce((function(e,t){return e*t}));for(o=0;o<i;o++)a[o]=e(t+o*c,s,r)}return a}(0,e,t)}function SJ(e,t){for(var n=CJ(e,t),r=0;r<n.length;r++)n[r]=1;return n}function CJ(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type "+t)}function MJ(){return AQ().platform.now()}function _J(e){e.forEach((function(t){HQ(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."}))}))}function EJ(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",AQ().platform.encode(e,t)}function TJ(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",AQ().platform.decode(e,t)}function IJ(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}function kJ(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}Object.freeze({shuffle:UQ,clamp:WQ,nearestLargerEven:GQ,sum:VQ,randUniform:function(e,t){var n=Math.random();return t*n+(1-n)*e},distSquared:function(e,t){for(var n=0,r=0;r<e.length;r++){var a=Number(e[r])-Number(t[r]);n+=a*a}return n},assert:HQ,assertShapesMatch:YQ,assertNonNull:XQ,flatten:qQ,sizeFromShape:KQ,isScalarShape:function(e){return 0===e.length},arraysEqual:QQ,isInt:JQ,tanh:ZQ,sizeToSquarishShape:$Q,createShuffledIndices:function(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return UQ(t),t},rightPad:eJ,repeatedTry:tJ,inferFromImplicitShape:nJ,parseAxisParam:rJ,squeezeShape:aJ,getTypedArrayFromDType:iJ,getArrayFromDType:oJ,checkConversionForErrors:sJ,isValidDtype:cJ,hasEncodingLoss:uJ,isTypedArray:lJ,bytesPerElement:fJ,bytesFromStringArray:dJ,isString:hJ,isBoolean:pJ,isNumber:gJ,inferDtype:mJ,isFunction:vJ,nearestDivisor:bJ,computeStrides:yJ,toTypedArray:xJ,toNestedArray:wJ,makeOnesTypedArray:SJ,makeZerosTypedArray:CJ,now:MJ,assertNonNegativeIntegerDimensions:_J,fetch:function(e,t){return AQ().platform.fetch(e,t)},encodeString:EJ,decodeString:TJ,locToIndex:IJ,indexToLoc:kJ});var NJ=function(){function e(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new LJ)}return e.prototype.profileKernel=function(e,t,n){var r,a=this,i=this.backendTimer.time((function(){r=n()}));return r.forEach((function(n){n.data().then((function(r){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var a=e[r];if(isNaN(a)||!isFinite(a))return console.warn("Found "+a+" in the result of '"+n+"'"),!0}}(r,n.dtype,e),i.then((function(i){var o="";null!=i.getExtraProfileInfo&&(o=i.getExtraProfileInfo()),a.logger.logKernelProfile(e,n,r,i.kernelMs,t,o)}))}))})),r},e}(),LJ=function(){function e(){}return e.prototype.logKernelProfile=function(e,t,n,r,a,i){var o="number"==typeof r?eJ(r+"ms",9):r.error,s=eJ(e,25),c=t.rank,u=t.size,l=eJ(t.shape.toString(),14),f="";for(var d in a){var h=a[d].shape||t.shape,p=h.length;f+=d+": "+p+"D "+(p>0?h:"")+" "}console.log("%c"+s+"\t%c"+o+"\t%c"+c+"D "+l+"\t%c"+u+"\t%c"+f+"\t%c"+i,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},e}();function AJ(e,t,n){return eJ(Array.isArray(e)?parseFloat(e[0].toFixed(7))+" + "+parseFloat(e[1].toFixed(7))+"j":hJ(e)?"'"+e+"'":"bool"===n?RJ(e):parseFloat(e.toFixed(7)).toString(),t)}function RJ(e){return 0===e?"false":"true"}function DJ(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var OJ=function(){function e(e,t,n){var r=this;if(this.dtype=t,this.shape=e.slice(),this.size=KQ(e),null!=n){var a=n.length;HQ(a===this.size,(function(){return"Length of values '"+a+"' does not match the size inferred by the shape '"+r.size+"'."}))}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||oJ(t,this.size),this.strides=yJ(e)}return e.prototype.set=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),HQ(n.length===this.rank,(function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+t.rank+")"}));var a=this.locToIndex(n);this.values[a]=e},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];0===e.length&&(e=[0]);for(var n=0,r=0,a=e;r<a.length;r++){var i=a[r];if(i<0||i>=this.shape[n]){var o="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(o)}n++}for(var s=e[e.length-1],c=0;c<e.length-1;++c)s+=this.strides[c]*e[c];return this.values[s]},e.prototype.locToIndex=function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},e.prototype.indexToLoc=function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return PJ().makeTensor(this.values,this.shape,this.dtype)},e}(),PJ=null,FJ=null,zJ=null,jJ=function(){function e(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=KQ(e),this.strides=yJ(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}return e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),HQ(1===this.size,(function(){return"The array must have only 1 element."})),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},e.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])},e.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),this.reshape([e,t,n,r])},e.prototype.as5D=function(e,t,n,r,a){return this.throwIfDisposed(),this.reshape([e,t,n,r,a])},e.prototype.asType=function(e){return this.throwIfDisposed(),FJ.cast(this,e)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return kQ(this,void 0,void 0,(function(){var e;return NQ(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,FJ.buffer(this.shape,this.dtype,e)]}}))}))},e.prototype.bufferSync=function(){return FJ.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return kQ(this,void 0,void 0,(function(){var e;return NQ(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,wJ(this.shape,e)]}}))}))},e.prototype.arraySync=function(){return wJ(this.shape,this.dataSync())},e.prototype.data=function(){return kQ(this,void 0,void 0,(function(){var e,t;return NQ(this,(function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=PJ().read(this.dataId),"string"!==this.dtype?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map((function(e){return TJ(e)}))]}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}}))}))},e.prototype.dataSync=function(){this.throwIfDisposed();var e=PJ().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return TJ(e)}))}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},e.prototype.bytes=function(){return kQ(this,void 0,void 0,(function(){var e;return NQ(this,(function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,PJ().read(this.dataId)];case 1:return e=t.sent(),"string"===this.dtype?[2,e]:[2,new Uint8Array(e.buffer)]}}))}))},e.prototype.dispose=function(){this.isDisposed||(PJ().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(e){return void 0===e&&(e=!1),FJ.print(this,e)},e.prototype.reshape=function(e){return this.throwIfDisposed(),FJ.reshape(this,e)},e.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},e.prototype.expandDims=function(e){return void 0===e&&(e=0),FJ.expandDims(this,e)},e.prototype.cumsum=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=!1),void 0===n&&(n=!1),FJ.cumsum(this,e,t,n)},e.prototype.squeeze=function(e){return this.throwIfDisposed(),FJ.squeeze(this,e)},e.prototype.clone=function(){return this.throwIfDisposed(),FJ.clone(this)},e.prototype.oneHot=function(e,t,n){return this.throwIfDisposed(),FJ.oneHot(this,e,t,n)},e.prototype.toString=function(e){return void 0===e&&(e=!1),function(e,t,n,r){var a=yJ(t),i=function(e,t,n,r){var a=KQ(t),i=r[r.length-1],o=new Array(i).fill(0),s=t.length,c="complex64"===n?DJ(e):e;if(s>1)for(var u=0;u<a/i;u++)for(var l=u*i,f=0;f<i;f++)o[f]=Math.max(o[f],AJ(c[l+f],0,n).length);return o}(e,t,n,a),o=t.length,s=function e(t,n,r,a,i,o){void 0===o&&(o=!0);var s="complex64"===r?2:1,c=n[0],u=n.length;if(0===u)return"complex64"===r?[AJ(DJ(t)[0],0,r)]:"bool"===r?[RJ(t[0])]:[t[0].toString()];if(1===u){if(c>20){var l=3*s,f=Array.from(t.slice(0,l)),d=Array.from(t.slice((c-3)*s,c*s));return"complex64"===r&&(f=DJ(f),d=DJ(d)),["["+f.map((function(e,t){return AJ(e,i[t],r)})).join(", ")+", ..., "+d.map((function(e,t){return AJ(e,i[c-3+t],r)})).join(", ")+"]"]}return["["+("complex64"===r?DJ(t):Array.from(t)).map((function(e,t){return AJ(e,i[t],r)})).join(", ")+"]"]}var h=n.slice(1),p=a.slice(1),g=a[0]*s,m=[];if(c>20){for(var v=0;v<3;v++){var b=(y=v*g)+g;m.push.apply(m,e(t.slice(y,b),h,r,p,i,!1))}for(m.push("..."),v=c-3;v<c;v++)b=(y=v*g)+g,m.push.apply(m,e(t.slice(y,b),h,r,p,i,v===c-1))}else for(v=0;v<c;v++){var y;b=(y=v*g)+g,m.push.apply(m,e(t.slice(y,b),h,r,p,i,v===c-1))}var x=2===u?",":"";for(m[0]="["+m[0]+x,v=1;v<m.length-1;v++)m[v]=" "+m[v]+x;var w=",\n";for(v=2;v<u;v++)w+="\n";return m[m.length-1]=" "+m[m.length-1]+"]"+(o?"":w),m}(e,t,n,a,i),c=["Tensor"];return r&&(c.push("  dtype: "+n),c.push("  rank: "+o),c.push("  shape: ["+t+"]"),c.push("  values:")),c.push(s.map((function(e){return"    "+e})).join("\n")),c.join("\n")}(this.dataSync(),this.shape,this.dtype,e)},e.prototype.tile=function(e){return this.throwIfDisposed(),FJ.tile(this,e)},e.prototype.gather=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),FJ.gather(this,e,t)},e.prototype.matMul=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),this.throwIfDisposed(),FJ.matMul(this,e,t,n)},e.prototype.dot=function(e){return this.throwIfDisposed(),FJ.dot(this,e)},e.prototype.norm=function(e,t,n){return void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===n&&(n=!1),this.throwIfDisposed(),FJ.norm(this,e,t,n)},e.prototype.slice=function(e,t){return this.throwIfDisposed(),FJ.slice(this,e,t)},e.prototype.reverse=function(e){return this.throwIfDisposed(),FJ.reverse(this,e)},e.prototype.concat=function(t,n){return void 0===n&&(n=0),this.throwIfDisposed(),t instanceof e&&(t=[t]),FJ.concat([this].concat(t),n)},e.prototype.split=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),FJ.split(this,e,t)},e.prototype.stack=function(e,t){return void 0===t&&(t=0),FJ.stack([this,e],t)},e.prototype.unstack=function(e){return void 0===e&&(e=0),FJ.unstack(this,e)},e.prototype.pad=function(e,t){return void 0===t&&(t=0),FJ.pad(this,e,t)},e.prototype.batchNormalization=function(e,t,n,r,a){return void 0===n&&(n=.001),zJ("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,a,r,n)},e.prototype.batchNorm=function(e,t,n,r,a){return void 0===a&&(a=.001),this.throwIfDisposed(),FJ.batchNorm(this,e,t,n,r,a)},e.prototype.all=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),FJ.all(this,e,t)},e.prototype.any=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),FJ.any(this,e,t)},e.prototype.logSumExp=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),FJ.logSumExp(this,e,t)},e.prototype.sum=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),FJ.sum(this,e,t)},e.prototype.prod=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),FJ.prod(this,e,t)},e.prototype.mean=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),FJ.mean(this,e,t)},e.prototype.min=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),FJ.min(this,e,t)},e.prototype.max=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),FJ.max(this,e,t)},e.prototype.argMin=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),FJ.argMin(this,e)},e.prototype.argMax=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),FJ.argMax(this,e)},e.prototype.cast=function(e){return this.throwIfDisposed(),FJ.cast(this,e)},e.prototype.add=function(e){return this.throwIfDisposed(),FJ.add(this,e)},e.prototype.addStrict=function(e){return this.throwIfDisposed(),FJ.addStrict(this,e)},e.prototype.atan2=function(e){return this.throwIfDisposed(),FJ.atan2(this,e)},e.prototype.sub=function(e){return this.throwIfDisposed(),FJ.sub(this,e)},e.prototype.subStrict=function(e){return this.throwIfDisposed(),FJ.subStrict(this,e)},e.prototype.pow=function(e){return this.throwIfDisposed(),FJ.pow(this,e)},e.prototype.powStrict=function(e){return this.throwIfDisposed(),FJ.powStrict(this,e)},e.prototype.mul=function(e){return this.throwIfDisposed(),FJ.mul(this,e)},e.prototype.mulStrict=function(e){return this.throwIfDisposed(),FJ.mulStrict(this,e)},e.prototype.div=function(e){return this.throwIfDisposed(),FJ.div(this,e)},e.prototype.divNoNan=function(e){return this.throwIfDisposed(),FJ.divNoNan(this,e)},e.prototype.floorDiv=function(e){return this.throwIfDisposed(),FJ.floorDiv(this,e)},e.prototype.divStrict=function(e){return this.throwIfDisposed(),FJ.divStrict(this,e)},e.prototype.minimum=function(e){return this.throwIfDisposed(),FJ.minimum(this,e)},e.prototype.minimumStrict=function(e){return this.throwIfDisposed(),FJ.minimumStrict(this,e)},e.prototype.maximum=function(e){return this.throwIfDisposed(),FJ.maximum(this,e)},e.prototype.maximumStrict=function(e){return this.throwIfDisposed(),FJ.maximumStrict(this,e)},e.prototype.mod=function(e){return this.throwIfDisposed(),FJ.mod(this,e)},e.prototype.modStrict=function(e){return this.throwIfDisposed(),FJ.modStrict(this,e)},e.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),FJ.squaredDifferenceStrict(this,e)},e.prototype.transpose=function(e){return this.throwIfDisposed(),FJ.transpose(this,e)},e.prototype.notEqual=function(e){return this.throwIfDisposed(),FJ.notEqual(this,e)},e.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),FJ.notEqualStrict(this,e)},e.prototype.less=function(e){return this.throwIfDisposed(),FJ.less(this,e)},e.prototype.lessStrict=function(e){return this.throwIfDisposed(),FJ.lessStrict(this,e)},e.prototype.equal=function(e){return this.throwIfDisposed(),FJ.equal(this,e)},e.prototype.equalStrict=function(e){return this.throwIfDisposed(),FJ.equalStrict(this,e)},e.prototype.lessEqual=function(e){return this.throwIfDisposed(),FJ.lessEqual(this,e)},e.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),FJ.lessEqualStrict(this,e)},e.prototype.greater=function(e){return this.throwIfDisposed(),FJ.greater(this,e)},e.prototype.greaterStrict=function(e){return this.throwIfDisposed(),FJ.greaterStrict(this,e)},e.prototype.greaterEqual=function(e){return this.throwIfDisposed(),FJ.greaterEqual(this,e)},e.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),FJ.greaterEqualStrict(this,e)},e.prototype.logicalAnd=function(e){return this.throwIfDisposed(),FJ.logicalAnd(this,e)},e.prototype.logicalOr=function(e){return this.throwIfDisposed(),FJ.logicalOr(this,e)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),FJ.logicalNot(this)},e.prototype.logicalXor=function(e){return this.throwIfDisposed(),FJ.logicalXor(this,e)},e.prototype.where=function(e,t){return this.throwIfDisposed(),FJ.where(e,this,t)},e.prototype.neg=function(){return this.throwIfDisposed(),FJ.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),FJ.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),FJ.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),FJ.sign(this)},e.prototype.isNaN=function(){return this.throwIfDisposed(),FJ.isNaN(this)},e.prototype.isInf=function(){return this.throwIfDisposed(),FJ.isInf(this)},e.prototype.isFinite=function(){return this.throwIfDisposed(),FJ.isFinite(this)},e.prototype.exp=function(){return this.throwIfDisposed(),FJ.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),FJ.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),FJ.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),FJ.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),FJ.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),FJ.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),FJ.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),FJ.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),FJ.abs(this)},e.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),FJ.clipByValue(this,e,t)},e.prototype.relu=function(){return this.throwIfDisposed(),FJ.relu(this)},e.prototype.relu6=function(){return this.throwIfDisposed(),FJ.relu6(this)},e.prototype.elu=function(){return this.throwIfDisposed(),FJ.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),FJ.selu(this)},e.prototype.leakyRelu=function(e){return void 0===e&&(e=.2),this.throwIfDisposed(),FJ.leakyRelu(this,e)},e.prototype.prelu=function(e){return this.throwIfDisposed(),FJ.prelu(this,e)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),FJ.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),FJ.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),FJ.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),FJ.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),FJ.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),FJ.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),FJ.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),FJ.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),FJ.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),FJ.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),FJ.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),FJ.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),FJ.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),FJ.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),FJ.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),FJ.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),FJ.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),FJ.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),FJ.round(this)},e.prototype.step=function(e){return void 0===e&&(e=0),this.throwIfDisposed(),FJ.step(this,e)},e.prototype.softmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),FJ.softmax(this,e)},e.prototype.logSoftmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),FJ.logSoftmax(this,e)},e.prototype.resizeBilinear=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),FJ.image.resizeBilinear(this,e,t)},e.prototype.resizeNearestNeighbor=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),FJ.image.resizeNearestNeighbor(this,e,t)},e.prototype.conv1d=function(e,t,n,r,a,i){return void 0===r&&(r="NWC"),void 0===a&&(a=1),this.throwIfDisposed(),FJ.conv1d(this,e,t,n,r,a,i)},e.prototype.conv2d=function(e,t,n,r,a,i){return void 0===r&&(r="NHWC"),void 0===a&&(a=[1,1]),this.throwIfDisposed(),FJ.conv2d(this,e,t,n,r,a,i)},e.prototype.conv2dTranspose=function(e,t,n,r,a){return this.throwIfDisposed(),FJ.conv2dTranspose(this,e,t,n,r,a)},e.prototype.depthwiseConv2D=function(e,t,n,r,a,i){return void 0===r&&(r="NHWC"),void 0===a&&(a=[1,1]),this.throwIfDisposed(),FJ.depthwiseConv2d(this,e,t,n,r,a,i)},e.prototype.separableConv2d=function(e,t,n,r,a,i){return void 0===a&&(a=[1,1]),void 0===i&&(i="NHWC"),this.throwIfDisposed(),FJ.separableConv2d(this,e,t,n,r,a,i)},e.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),FJ.avgPool(this,e,t,n,r)},e.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),FJ.maxPool(this,e,t,n,r)},e.prototype.localResponseNormalization=function(e,t,n,r){return void 0===e&&(e=5),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=.5),FJ.localResponseNormalization(this,e,t,n,r)},e.prototype.pool=function(e,t,n,r,a){return this.throwIfDisposed(),FJ.pool(this,e,t,n,r,a)},e.prototype.variable=function(e,t,n){return void 0===e&&(e=!0),this.throwIfDisposed(),PJ().makeVariable(this,e,t,n)},e.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),FJ.unsortedSegmentSum(this,e,t)},e.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),FJ.batchToSpaceND(this,e,t)},e.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),FJ.spaceToBatchND(this,e,t)},e.prototype.topk=function(e,t){return void 0===e&&(e=1),void 0===t&&(t=!0),this.throwIfDisposed(),FJ.topk(this,e,t)},e.prototype.stridedSlice=function(e,t,n,r,a,i,o,s){return void 0===r&&(r=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=0),this.throwIfDisposed(),FJ.stridedSlice(this,e,t,n,r,a,i,o,s)},e.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),FJ.depthToSpace(this,e,t)},e.prototype.fft=function(){return this.throwIfDisposed(),FJ.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),FJ.spectral.ifft(this)},e.prototype.rfft=function(){return this.throwIfDisposed(),FJ.spectral.rfft(this)},e.prototype.irfft=function(){return this.throwIfDisposed(),FJ.spectral.irfft(this)},e}();Object.defineProperty(jJ,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.dataId&&null!=e.shape&&null!=e.dtype}});var BJ,UJ,WJ,GJ,VJ,HJ=function(e){function t(t,n,r,a){var i=e.call(this,t.shape,t.dtype,t.dataId,a)||this;return i.trainable=n,i.name=r,i}return IQ(t,e),t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!QQ(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");PJ().disposeTensor(this),this.dataId=e.dataId,PJ().incRef(this,null)},t.prototype.dispose=function(){PJ().disposeVariable(this),this.isDisposedInternal=!0},t}(jJ);Object.defineProperty(HJ,Symbol.hasInstance,{value:function(e){return e instanceof jJ&&null!=e.assign&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(BJ||(BJ={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(UJ||(UJ={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(WJ||(WJ={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(GJ||(GJ={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(VJ||(VJ={}));var YJ={float32:GJ,int32:UJ,bool:WJ,complex64:VJ};function XJ(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast "+e+" with "+t)}return YJ[e][t]}function qJ(e){return XJ(e,"int32")}function KJ(e,t){if(e.dtype===t.dtype)return[e,t];var n=XJ(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function QJ(e,t){HQ(e.dtype===t.dtype,(function(){return"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match"}))}function JJ(e){var t=[];return function e(t,n,r){if(null!=t)if(t instanceof jJ)n.push(t);else if(a=t,Array.isArray(a)||"object"==typeof a){var a,i=t;for(var o in i){var s=i[o];r.has(s)||(r.add(s),e(s,n,r))}}}(e,t,new Set),t}Object.freeze({makeTypesMatch:KJ,assertTypesMatch:QJ,isTensorInList:function(e,t){return t.some((function(t){return t.id===e.id}))},getTensorsInContainer:JJ});var ZJ,$J=function(){function e(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},e}(),eZ=function(){function e(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new $J}return e.prototype.ready=function(){return kQ(this,void 0,void 0,(function(){var e,t,n;return NQ(this,(function(r){switch(r.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then((function(){}))];if(null!=this.backendInstance)return[2];e=this.getSortedBackends(),t=0,r.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return r.sent()?[4,this.setBackend(n)]:[3,4];case 3:return r.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}}))}))},Object.defineProperty(e.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),e.prototype.backendNames=function(){return Object.keys(this.registryFactory)},e.prototype.findBackend=function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]},e.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},e.prototype.registerBackend=function(e,t,n){return void 0===n&&(n=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},e.prototype.setBackend=function(e){return kQ(this,void 0,void 0,(function(){var t,n,r;return NQ(this,(function(a){switch(a.label){case 0:if(null==this.registryFactory[e])throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,null!=this.registry[e]?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,t.asyncInit?[4,n]:[3,2]);case 1:return r=a.sent(),[3,3];case 2:r=n,a.label=3;case 3:if(!r)return[2,!1];a.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new NJ(this.backendInstance),[2,!0]}}))}))},e.prototype.setupRegisteredKernels=function(){var e=this;FQ(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))},e.prototype.disposeRegisteredKernels=function(e){var t=this;FQ(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))},e.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var r=n.factory();if(Promise.resolve(r)===r){var a=++this.pendingBackendInitId,i=r.then((function(n){return!(a<t.pendingBackendInitId)&&(t.registry[e]=n,t.pendingBackendInit=null,!0)})).catch((function(n){return!(a<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(n.stack||n.message),!1)}));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(t){return console.warn("Initialization of backend "+e+" failed"),console.warn(t.stack||t.message),{success:!1,asyncInit:!1}}},e.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},e.prototype.getSortedBackends=function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))},e.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),a=r.success,i=r.asyncInit;if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")},e.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t);r.disposeData(t),n.backend=e,e.move(t,a,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},e.prototype.tidy=function(e,t){var n,r=this,a=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun((function(){return r.startScope(a)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))},e.prototype.scopedRun=function(e,t,n){e();try{var r=n();return t(),r}catch(e){throw t(),e}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(function(e){return{x:function(){return e.toFloat()}}}),[]),t},e.prototype.runKernel=function(e,t,n,r,a){return this.runKernelFunc(null,t,null,e,n,r,a)},e.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},e.prototype.checkKernelForMemLeak=function(e,t,n){var r=this.backend.numDataIds(),a=0;n.forEach((function(e){a+="complex64"===e.dtype?3:1}));var i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-a-i;if(o>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+o+" data ids) after running '"+e+"'")},e.prototype.runKernelFunc=function(e,t,n,r,a,i,o){var s,c=this;void 0===i&&(i=[]),void 0===o&&(o=[]);var u=[],l=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var f,d=function(e){l&&(u=e.map((function(e){return c.keep(c.clone(e))})))},h=this.state.numBytes,p=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var g,m=PQ(r,this.backendName);return f=null!=m?function(){var e=c.backend.numDataIds();g=m.kernelFunc({inputs:t,attrs:a,backend:c.backend});var n=Array.isArray(g)?g:[g];c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(r,e,n);var s=n.map((function(e){var t=e.dataId,n=e.shape,r=e.dtype;return c.makeTensorFromDataId(t,n,r)})),u=s.filter((function(e,t){return o[t]}));return d((i||[]).slice().concat(u)),s}:function(){var t=c.backend.numDataIds();g=c.tidy((function(){return e(c.backend,d)}));var n=Array.isArray(g)?g:[g];return c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(r,t,n),n},this.scopedRun((function(){return c.state.kernelDepth++}),(function(){return c.state.kernelDepth--}),(function(){s=c.ENV.getBool("DEBUG")?c.profiler.profileKernel(r,t,(function(){return f()})):f()})),l&&this.addTapeNode(r,t,s,n,u),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-h,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-p,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map((function(e){return t[e].shape})),outputShapes:s.map((function(e){return e.shape}))}),Array.isArray(g)?s:s[0]},e.prototype.makeTensor=function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var a=e;"string"===n&&hJ(e[0])&&(a=e.map((function(e){return EJ(e)})));var i=r.write(a,t,n),o=new jJ(t,n,i,this.nextTensorId());if(this.incRef(o,r),"string"===n){var s=this.state.tensorInfo.get(i),c=dJ(a);this.state.numBytes+=c-s.bytes,s.bytes=c}return o},e.prototype.makeTensorFromDataId=function(e,t,n,r){var a=new jJ(t,n=n||"float32",e,this.nextTensorId());return this.incRef(a,r),a},e.prototype.makeVariable=function(e,t,n,r){void 0===t&&(t=!0),n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.asType(r));var a=new HJ(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name "+a.name+" was already registered");return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a},e.prototype.incRef=function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(r=e.size*fJ(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof HJ||this.track(e)},e.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},e.prototype.disposeVariable=function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]},e.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},e.prototype.profile=function(e){return kQ(this,void 0,void 0,(function(){var t,n;return NQ(this,(function(r){return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]}))}))},e.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},e.prototype.addTapeNode=function(e,t,n,r,a){var i=this,o={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},s=function(e){return OQ.get(e)}(e);null!=s&&(r=s.gradFunc),null!=r&&(o.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],a=CJ(r.size,r.dtype);return i.makeTensor(a,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],a)}),this.state.activeTape.push(o)},e.prototype.keep=function(e){return e.kept=!0,e},e.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},e.prototype.endTape=function(){this.state.gradientDepth--},e.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},e.prototype.endScope=function(e){for(var t=this,n=JJ(e),r=new Set(n.map((function(e){return e.id}))),a=0;a<this.state.activeScope.track.length;a++){var i=this.state.activeScope.track[a];i.kept||r.has(i.id)||i.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){e.kept||e.scopeId!==o.id||t.track(e)}))},e.prototype.gradients=function(e,t,n,r){var a=this;if(void 0===r&&(r=!1),HQ(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var i=this.scopedRun((function(){return a.startTape()}),(function(){return a.endTape()}),(function(){return a.tidy("forward",e)}));HQ(i instanceof jJ,(function(){return"The result y returned by f() must be a tensor."}));var o=function(e,t,n){for(var r={},a={},i=0;i<t.length;i++)r[t[i].id]=!0;for(i=0;i<e.length;i++){var o=(p=e[i]).inputs;for(var s in o){for(var c=o[s],u=!1,l=0;l<t.length;l++)if(r[c.id]){p.outputs.forEach((function(e){return r[e.id]=!0})),u=!0,a[p.id]=!0;break}if(u)break}}var f={};f[n.id]=!0;var d={};for(i=e.length-1;i>=0;i--)for(o=(p=e[i]).inputs,l=0;l<p.outputs.length;l++)if(f[p.outputs[l].id]){for(var s in o)f[o[s].id]=!0,d[p.id]=!0;break}var h=[];for(i=0;i<e.length;i++){var p;if(a[(p=e[i]).id]&&d[p.id]){var g={};for(var s in p.inputs){var m=p.inputs[s];r[m.id]&&(g[s]=m)}var v=Object.assign({},p);v.inputs=g,v.outputs=p.outputs,h.push(v)}}return h}(this.state.activeTape,t,i);if(!r&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e,r,s={};s[i.id]=null==n?(r=SJ(KQ(e=i.shape),"float32"),tZ.makeTensor(r,e,"float32")):n,function(e,t,n){for(var r=function(r){var a=t[r],i=[];if(a.outputs.forEach((function(t){var n=e[t.id];null!=n?i.push(n):i.push(null)})),null==a.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+a.kernelName+".");var o=a.gradient(i),s=function(t){if(!(t in o))throw new Error("Cannot backprop through input "+t+". Available gradients found: "+Object.keys(o)+".");var r=n((function(){return o[t]()}));if("float32"!==r.dtype)throw new Error("Error in gradient for op "+a.kernelName+". The gradient of input "+t+" must have 'float32' dtype, but has '"+r.dtype+"'");var i=a.inputs[t];if(!QQ(r.shape,i.shape))throw new Error("Error in gradient for op "+a.kernelName+". The gradient of input '"+t+"' has shape '"+r.shape+"', which does not match the shape of the input '"+i.shape+"'");if(null==e[i.id])e[i.id]=r;else{var s=e[i.id];e[i.id]=s.add(r),s.dispose()}};for(var c in a.inputs)s(c)},a=t.length-1;a>=0;a--)r(a)}(s,o,(function(e){return a.tidy(e)}));var c=t.map((function(e){return s[e.id]}));return 0===a.state.gradientDepth&&(a.state.activeTape.forEach((function(e){for(var t=0,n=e.saved;t<n.length;t++)n[t].dispose()})),a.state.activeTape=null),{value:i,grads:c}}))},e.prototype.customGrad=function(e){var t=this;return HQ(vJ(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n,r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];HQ(r.every((function(e){return e instanceof jJ})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var i={};return r.forEach((function(e,t){i[t]=e})),t.runKernelFunc((function(t,a){return HQ((n=e.apply(void 0,r.concat([a]))).value instanceof jJ,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),HQ(vJ(n.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),n.value}),i,(function(e,t){var a=n.gradFunc(e,t),i=Array.isArray(a)?a:[a];HQ(i.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),HQ(i.every((function(e){return e instanceof jJ})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return i.forEach((function(e,t){o[t]=function(){return e}})),o}))}},e.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},e.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},e.prototype.time=function(e){return kQ(this,void 0,void 0,(function(){var t,n;return NQ(this,(function(r){switch(r.label){case 0:return t=MJ(),[4,this.backend.time(e)];case 1:return(n=r.sent()).wallMs=MJ()-t,[2,n]}}))}))},e.prototype.track=function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(e.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new $J,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},e.nextTensorId=0,e.nextVariableId=0,e}(),tZ=function(){var e=function(){if(null==ZJ){var e=void 0;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof n.g)e=n.g;else if("undefined"!=typeof _Q)e=_Q;else{if("undefined"==typeof self)throw new Error("Could not find a global object");_Q=self}ZJ=e}return ZJ}();if(null==e._tfengine){var t=new LQ(e);e._tfengine=new eZ(t)}return function(e){RQ=e}(e._tfengine.ENV),PJ=function(){return e._tfengine},e._tfengine}();function nZ(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var rZ=AQ();rZ.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),rZ.registerFlag("IS_BROWSER",(function(){return nZ()})),rZ.registerFlag("IS_NODE",(function(){return"undefined"!=typeof _Q&&void 0!==_Q.versions&&void 0!==_Q.versions.node})),rZ.registerFlag("IS_CHROME",(function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),rZ.registerFlag("PROD",(function(){return!1})),rZ.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return rZ.getBool("DEBUG")})),rZ.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),rZ.registerFlag("IS_TEST",(function(){return!1}));var aZ,iZ,oZ,sZ={},cZ={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function uZ(e,t){sZ[e]=t}function lZ(e){e in sZ||(sZ[e]=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return t.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete sZ[e]}),!1),1===e?t.getContext("webgl",cZ)||t.getContext("experimental-webgl",cZ):t.getContext("webgl2",cZ)}(e));var t=sZ[e];return t.isContextLost()?(delete sZ[e],lZ(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),sZ[e])}function fZ(e,t){return[t,e]}function dZ(e){var t=KQ(e);return $Q(Math.ceil(t/4))}function hZ(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function pZ(e,t){var n,r,a,i,o,s,c,u,l,f=e;return 2===AQ().getNumber("WEBGL_VERSION")?(n=f.R32F,r=f.R16F,a=f.RGBA16F,i=f.RGBA32F,o=f.RED,s=4,c=1,u=f.HALF_FLOAT,l=f.FLOAT):(n=e.RGBA,r=e.RGBA,a=e.RGBA,i=f.RGBA,o=e.RGBA,s=4,c=4,u=null!=t?t.HALF_FLOAT_OES:null,l=e.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:i,textureFormatFloat:o,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:c,textureTypeHalfFloat:u,textureTypeFloat:l}}function gZ(e,t,n){var r=n();return t&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+vZ(e,t))}(e),r}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(aZ||(aZ={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(iZ||(iZ={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(oZ||(oZ={}));function mZ(e){return!!(AQ().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function vZ(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function bZ(e,t,n){return UZ(e,t,(function(){return e.getExtension(n)}),'Extension "'+n+'" not supported on this browser.')}function yZ(e,t,n){var r=UZ(e,t,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(gZ(e,t,(function(){return e.shaderSource(r,n)})),gZ(e,t,(function(){return e.compileShader(r)})),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function xZ(e,t,n){var r=UZ(e,t,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(gZ(e,t,(function(){return e.shaderSource(r,n)})),gZ(e,t,(function(){return e.compileShader(r)})),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw function(e,t){var n=CZ.exec(t);if(null==n)return console.log("Couldn't parse line number in error: "+t),void console.log(e);for(var r=+n[1],a=e.split("\n"),i=a.length.toString().length+2,o=a.map((function(e,t){return eJ((t+1).toString(),i)+e})),s=0,c=0;c<o.length;c++)s=Math.max(o[c].length,s);var u=o.slice(0,r-1),l=o.slice(r-1,r),f=o.slice(r);console.log(u.join("\n")),console.log(t.split("\n")[0]),console.log("%c "+eJ(l[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(f.join("\n"))}(n,e.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var wZ,SZ,CZ=/ERROR: [0-9]+:([0-9]+):/g;function MZ(e,t){return UZ(e,t,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}function _Z(e,t,n){if(gZ(e,t,(function(){return e.linkProgram(n)})),!1===e.getProgramParameter(n,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function EZ(e,t,n){if(gZ(e,t,(function(){return e.validateProgram(n)})),!1===e.getProgramParameter(n,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function TZ(e,t,n){var r=UZ(e,t,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return gZ(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),gZ(e,t,(function(){return e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)})),r}function IZ(e,t,n){var r=UZ(e,t,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return gZ(e,t,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)})),gZ(e,t,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW)})),r}function kZ(e,t){return UZ(e,t,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}function NZ(e,t){var n=AQ().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="["+e+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n)throw r="["+e+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+n+"x"+n+"].")}function LZ(e,t){return UZ(e,t,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function AZ(e,t,n,r,a,i,o,s){var c=e.getAttribLocation(n,r);return-1!==c&&(gZ(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,a)})),gZ(e,t,(function(){return e.vertexAttribPointer(c,i,e.FLOAT,!1,o,s)})),gZ(e,t,(function(){return e.enableVertexAttribArray(c)})),!0)}function RZ(e,t,n,r){WZ(e,r),gZ(e,t,(function(){return e.activeTexture(e.TEXTURE0+r)})),gZ(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)}))}function DZ(e,t,n,r){return UZ(e,t,(function(){return e.getUniformLocation(n,r)}),'uniform "'+r+'" not present in program.')}function OZ(e,t,n){return e.getUniformLocation(t,n)}function PZ(e,t,n,r,a,i){gZ(e,t,(function(){return RZ(e,t,r,i)})),gZ(e,t,(function(){return e.uniform1i(a,i)}))}function FZ(e,t,n,r){gZ(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)})),gZ(e,t,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}))}function zZ(e,t,n){gZ(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),gZ(e,t,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function jZ(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+BZ(e,t))}function BZ(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function UZ(e,t,n,r){var a=gZ(e,t,(function(){return n()}));if(null==a)throw new Error(r);return a}function WZ(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+n+"].")}function GZ(e,t){return void 0===t&&(t=2),KQ(e.slice(0,e.length-t))}function VZ(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function HZ(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[GZ(e)].concat(VZ(e))),t}function YZ(e,t){var n;void 0===t&&(t=!1);var r=AQ().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,1===(e=e.map((function(t,n){return n>=e.length-2?GQ(e[n]):e[n]}))).length&&(e=[2,e[0]])),2!==e.length){var a=aJ(e);e=a.newShape}var i=KQ(e);if(e.length<=1&&i<=r)return[1,i];if(2===e.length&&e[0]<=r&&e[1]<=r)return e;if(3===e.length&&e[0]*e[1]<=r&&e[2]<=r)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=r&&e[1]*e[2]<=r)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=r&&e[3]<=r)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=r&&e[1]*e[2]*e[3]<=r)return[e[0],e[1]*e[2]*e[3]];if(t){var o=GZ(e),s=2,c=2;return e.length&&(s=(n=VZ(e))[0],c=n[1]),$Q(i=o*(s/2)*(c/2)).map((function(e){return 2*e}))}return $Q(i)}function XZ(e){return e%2==0}function qZ(e,t){if(QQ(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(XZ(n)&&XZ(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&XZ(e[0])&&XZ(t[0])}function KZ(e){if(null==wZ){var t=lZ(e);wZ=t.getParameter(t.MAX_TEXTURE_SIZE)}return wZ}function QZ(e){if(null==SZ){var t=lZ(e);SZ=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,SZ)}function JZ(e){if(0===e)return 0;var t=lZ(e);return ZZ(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:ZZ(t,"EXT_disjoint_timer_query")?1:0}function ZZ(e,t){return null!=e.getExtension(t)}function $Z(e){try{if(null!=lZ(e))return!0}catch(e){return!1}return!1}function e$(e){if(0===e)return!1;var t=lZ(e);if(1===e){if(!ZZ(t,"OES_texture_float"))return!1}else if(!ZZ(t,"EXT_color_buffer_float"))return!1;return n$(t)}function t$(e){if(0===e)return!1;var t=lZ(e);if(1!==e){if(ZZ(t,"EXT_color_buffer_float"))return n$(t);if(ZZ(t,"EXT_color_buffer_half_float")){var n=t.getExtension("EXT_color_buffer_half_float");return function(e,t){var n=pZ(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(a),i}(t,n)}return!1}return!!ZZ(t,"OES_texture_float")&&!!ZZ(t,"WEBGL_color_buffer_float")&&n$(t)}function n$(e){var t=pZ(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function r$(e){return 2===e&&null!=lZ(e).fenceSync}var a$=Object.freeze({callAndCheck:gZ,canBeRepresented:mZ,getWebGLErrorMessage:vZ,getExtensionOrThrow:bZ,createVertexShader:yZ,createFragmentShader:xZ,createProgram:MZ,linkProgram:_Z,validateProgram:EZ,createStaticVertexBuffer:TZ,createStaticIndexBuffer:IZ,getNumChannels:function(){return 2===AQ().getNumber("WEBGL_VERSION")?1:4},createTexture:kZ,validateTextureSize:NZ,createFramebuffer:LZ,bindVertexBufferToProgramAttribute:AZ,bindTextureUnit:RZ,unbindTextureUnit:function(e,t,n){WZ(e,n),gZ(e,t,(function(){return e.activeTexture(e.TEXTURE0+n)})),gZ(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))},getProgramUniformLocationOrThrow:DZ,getProgramUniformLocation:OZ,bindTextureToProgramUniformSampler:PZ,bindCanvasToFramebuffer:function(e,t){gZ(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)})),gZ(e,t,(function(){return e.viewport(0,0,e.canvas.width,e.canvas.height)})),gZ(e,t,(function(){return e.scissor(0,0,e.canvas.width,e.canvas.height)}))},bindColorTextureToFramebuffer:FZ,unbindColorTextureFromFramebuffer:zZ,validateFramebuffer:jZ,getFramebufferErrorMessage:BZ,getBatchDim:GZ,getRowsCols:VZ,getShapeAs3D:HZ,getTextureShapeFromLogicalShape:YZ,isReshapeFree:qZ,getWebGLMaxTextureSize:KZ,resetMaxTextureSize:function(){wZ=null},resetMaxTexturesInShader:function(){SZ=null},getMaxTexturesInShader:QZ,getWebGLDisjointQueryTimerVersion:JZ,hasExtension:ZZ,isWebGLVersionEnabled:$Z,isCapableOfRenderingToFloatTexture:e$,isDownloadFloatTextureEnabled:t$,isWebGLFenceEnabled:r$}),i$=AQ();function o$(e){AQ().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function s$(e,t){return tZ.tidy(e,t)}function c$(e){JJ(e).forEach((function(e){return e.dispose()}))}function u$(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];AQ().getBool("IS_TEST")||console.warn.apply(console,e)}function l$(e,t){var n=e;if(lJ(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||lJ(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&AQ().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function e(t,n,r){if(r=r||[],Array.isArray(t)||lJ(t)){HQ(n.length>0,(function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+t.length+" elements"})),HQ(t.length===n[0],(function(){return"Element arr["+r.join("][")+"] should have "+n[0]+" elements, but has "+t.length+" elements"}));for(var a=n.slice(1),i=0;i<t.length;++i)e(t[i],a,r.concat(i))}else HQ(0===n.length,(function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array/TypedArray of "+n[0]+" elements"}))}(e,r,[]),r}function f$(e,t,n,r){if(null!=e&&("numeric"!==e&&e!==t||"numeric"===e&&"string"===t))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+e+" tensor, but got "+t+" tensor")}function d$(e,t,n,r){if(void 0===r&&(r="numeric"),e instanceof jJ)return f$(r,e.dtype,t,n),e;var a=mJ(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),f$(r,a,t,n),null==e||!lJ(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){var i=null==e?"null":e.constructor.name;throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+i+"'")}var o=l$(e,a);lJ(e)||Array.isArray(e)||(e=[e]);var s="string"!==a?xJ(e,a,AQ().getBool("DEBUG")):qQ(e,[],!0);return tZ.makeTensor(s,o,a)}function h$(e,t,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(e))throw new Error("Argument "+t+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return e.map((function(e,r){return d$(e,t+"["+r+"]",n)}),r)}function p$(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function g$(e,t,n){for(var r=e.length+t.length,a=[],i=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?a.push(e[i++]):a.push(t[o++]);return a}function m$(e,t){for(var n=[],r=e.length,a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);return[n,t.map((function(t){return e[t]}))]}function v$(e,t){return g$(e,t.map((function(e){return 1})),t)}function b$(e,t,n){HQ(p$(t,n),(function(){return e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input."}))}function y$(e,t){if(p$(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}function x$(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function w$(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}function S$(e,t){var n=e[0].length;e.forEach((function(e,t){HQ(e.length===n,(function(){return"Error in concat"+n+"D: rank of tensors["+t+"] must be the same as the rank of the rest ("+n+")"}))})),HQ(t>=0&&t<n,(function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."}));var r=e[0];e.forEach((function(e,a){for(var i=0;i<n;i++)HQ(i===t||e[i]===r[i],(function(){return"Error in concat"+n+"D: Shape of tensors["+a+"] ("+e+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+a+"."}))}))}function C$(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function M$(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var a=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];tZ.startScope(n);try{var a=r.apply(void 0,e);return a instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),tZ.endScope(a),a}catch(e){throw tZ.endScope(null),e}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}i$.registerFlag("HAS_WEBGL",(function(){return i$.getNumber("WEBGL_VERSION")>0})),i$.registerFlag("WEBGL_VERSION",(function(){return $Z(2)?2:$Z(1)?1:0})),i$.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===i$.get("WEBGL_VERSION")})),i$.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),i$.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),i$.registerFlag("WEBGL_PACK",(function(){return i$.getBool("HAS_WEBGL")})),i$.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return i$.getBool("WEBGL_PACK")})),i$.registerFlag("WEBGL_PACK_CLIP",(function(){return i$.getBool("WEBGL_PACK")})),i$.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),i$.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return i$.getBool("WEBGL_PACK")})),i$.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return i$.getBool("WEBGL_PACK")})),i$.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return i$.getBool("WEBGL_PACK")})),i$.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return i$.getBool("WEBGL_PACK")})),i$.registerFlag("WEBGL_PACK_REDUCE",(function(){return i$.getBool("WEBGL_PACK")})),i$.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return i$.getBool("WEBGL_PACK")})),i$.registerFlag("WEBGL_CONV_IM2COL",(function(){return i$.getBool("WEBGL_PACK")})),i$.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return KZ(i$.getNumber("WEBGL_VERSION"))})),i$.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return QZ(i$.getNumber("WEBGL_VERSION"))})),i$.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=i$.getNumber("WEBGL_VERSION");return 0===e?0:JZ(e)})),i$.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return i$.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(e=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))));var e})),i$.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return e$(i$.getNumber("WEBGL_VERSION"))})),i$.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!i$.getBool("WEBGL_FORCE_F16_TEXTURES")&&i$.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),i$.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return t$(i$.getNumber("WEBGL_VERSION"))})),i$.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return r$(i$.getNumber("WEBGL_VERSION"))})),i$.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return i$.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),zJ=o$;var _$=M$({complex_:function(e,t){var n=d$(e,"real","complex"),r=d$(t,"imag","complex");return YQ(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),tZ.runKernelFunc((function(e){return e.complex(n,r)}),{$real:n,$imag:r})}}),E$=M$({real_:function(e){var t=d$(e,"input","real");return tZ.runKernelFunc((function(e){return e.real(t)}),{$input:t})}}),T$=M$({imag_:function(e){var t=d$(e,"input","imag");return tZ.runKernelFunc((function(e){return e.imag(t)}),{$input:t})}});function I$(e,t,n){return k$(e,t,l$(e,n),n)}function k$(e,t,n,r){if(null==r&&(r=mJ(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!lJ(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){_J(t);var a=KQ(t),i=KQ(n);HQ(a===i,(function(){return"Based on the provided shape, ["+t+"], the tensor should have "+a+" values but has "+i}));for(var o=0;o<n.length;++o){var s=n[o],c=o!==n.length-1||s!==KQ(t.slice(o));HQ(n[o]===t[o]||!c,(function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+t+"). "}))}}return lJ(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?xJ(e,r,AQ().getBool("DEBUG")):qQ(e,[],!0),tZ.makeTensor(e,t,r)}function N$(e,t){if((lJ(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&lJ(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return k$(e,[],[],t)}function L$(e,t){XQ(e);var n=l$(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return k$(e,null,n,t)}function A$(e,t,n){if(XQ(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=l$(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return k$(e,t,r,n)}function R$(e,t,n){if(XQ(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=l$(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return k$(e,t,r,n)}function D$(e,t,n){if(XQ(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=l$(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return k$(e,t,r,n)}function O$(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=O$(e,"float32"),r=P$(e,"float32");return _$(n,r)}var a=SJ(KQ(e),t);return tZ.makeTensor(a,e,t)}function P$(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=P$(e,"float32"),r=P$(e,"float32");return _$(n,r)}var a=CJ(KQ(e),t);return tZ.makeTensor(a,e,t)}function F$(e,t,n){return tZ.runKernelFunc((function(r){return r.fill(e,t,n)}),{})}function z$(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return P$([0],r);var a=CJ(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+n;return L$(a,r)}var j$=M$({onesLike_:function(e){var t=d$(e,"x","onesLike");if("complex64"===t.dtype){var n=j$(E$(t)),r=B$(T$(t));return _$(n,r)}return tZ.runKernelFunc((function(e){return e.onesLike(t)}),{$x:t},(function(e,t){return{$x:function(){return B$(e)}}}))}}),B$=M$({zerosLike_:function(e){var t=d$(e,"x","zerosLike");return tZ.runKernelFunc((function(e){return e.zerosLike(t)}),{$x:t},(function(e,t){return{$x:function(){return B$(e)}}}))}}),U$=M$({concat_:function(e,t){void 0===t&&(t=0),HQ(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=h$(e,"tensors","concat");"complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+e.dtype+". ")})),t=rJ(t,n[0].shape)[0];var r=C$(n.map((function(e){return e.shape})),t);if(0===KQ(r))return I$([],r);if(1===(n=n.filter((function(e){return e.size>0}))).length)return n[0];var a=n.map((function(e){return e.shape}));S$(a,t);var i=n,o={axis:t};return tZ.runKernelFunc((function(e){return e.concat(n,t)}),i,(function(e){var n=a.map((function(e){return e[t]}));return Y$(e,n,t).map((function(e){return function(){return e}}))}),"Concat",o)}}),W$=M$({concat1d_:function(e){return U$(e,0)}}),G$=M$({concat2d_:function(e,t){return U$(e,t)}}),V$=M$({concat3d_:function(e,t){return U$(e,t)}}),H$=M$({concat4d_:function(e,t){return U$(e,t)}}),Y$=M$({split_:function(e,t,n){void 0===n&&(n=0);var r,a=d$(e,"x","split");return n=rJ(n,a.shape)[0],"number"==typeof t?(HQ(a.shape[n]%t==0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(a.shape[n]/t)):(HQ(a.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t),tZ.runKernelFunc((function(e){return e.split(a,r,n)}),{$x:a},(function(e){return{$x:function(){return U$(e,n)}}}))}});function X$(e,t){return e(t={exports:{}},t.exports),t.exports}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self&&self;var q$=X$((function(e){!function(e,t){function n(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function r(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function a(e,t){var a=new n(e),i=t&&t.state,o=a.next;return o.int32=function(){return 4294967296*a.next()|0},o.double=function(){return o()+11102230246251565e-32*(2097152*o()|0)},o.quick=o,i&&("object"==typeof i&&r(i,a),o.state=function(){return r(a,{})}),o}t&&t.exports?t.exports=a:this.alea=a}(0,e)})),K$=X$((function(e){!function(e,t){function n(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function a(e,t){var a=new n(e),i=t&&t.state,o=function(){return(a.next()>>>0)/4294967296};return o.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=a.next,o.quick=o,i&&("object"==typeof i&&r(i,a),o.state=function(){return r(a,{})}),o}t&&t.exports?t.exports=a:this.xor128=a}(0,e)})),Q$=X$((function(e){!function(e,t){function n(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function a(e,t){var a=new n(e),i=t&&t.state,o=function(){return(a.next()>>>0)/4294967296};return o.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=a.next,o.quick=o,i&&("object"==typeof i&&r(i,a),o.state=function(){return r(a,{})}),o}t&&t.exports?t.exports=a:this.xorwow=a}(0,e)})),J$=X$((function(e){!function(e,t){function n(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],n^=(e^=e<<13)^e<<9,r[a]=n,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function r(e,t){return t.x=e.x.slice(),t.i=e.i,t}function a(e,t){null==e&&(e=+new Date);var a=new n(e),i=t&&t.state,o=function(){return(a.next()>>>0)/4294967296};return o.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=a.next,o.quick=o,i&&(i.x&&r(i,a),o.state=function(){return r(a,{})}),o}t&&t.exports?t.exports=a:this.xorshift7=a}(0,e)})),Z$=X$((function(e){!function(e,t){function n(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,i=t.i;return t.w=r=r+1640531527|0,n=a[i+34&127],e=a[i=i+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[i]=n^e,t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,a,i,o,s=[],c=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,c=Math.max(c,t.length)),a=0,i=-32;i<c;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(o=o+1640531527|0,a=0==(n=s[127&i]^=r+o)?a+1:0);for(a>=128&&(s[127&(t&&t.length||0)]=-1),a=127,i=512;i>0;--i)r=s[a+34&127],n=s[a=a+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[a]=r^n;e.w=o,e.X=s,e.i=a}(t,e)}function r(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function a(e,t){null==e&&(e=+new Date);var a=new n(e),i=t&&t.state,o=function(){return(a.next()>>>0)/4294967296};return o.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=a.next,o.quick=o,i&&(i.X&&r(i,a),o.state=function(){return r(a,{})}),o}t&&t.exports?t.exports=a:this.xor4096=a}(0,e)})),$$=X$((function(e){!function(e,t){function n(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function r(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function a(e,t){var a=new n(e),i=t&&t.state,o=function(){return(a.next()>>>0)/4294967296};return o.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=a.next,o.quick=o,i&&("object"==typeof i&&r(i,a),o.state=function(){return r(a,{})}),o}t&&t.exports?t.exports=a:this.tychei=a}(0,e)})),e0=X$((function(e){!function(t,r){var a,i=this,o=256,s="random",c=r.pow(o,6),u=r.pow(2,52),l=2*u,f=255;function d(e,n,f){var d=[],v=g(function e(t,n){var r,a=[],i=typeof t;if(n&&"object"==i)for(r in t)try{a.push(e(t[r],n-1))}catch(e){}return a.length?a:"string"==i?t:t+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[e,m(t)]:null==e?function(){try{var e;return a&&(e=a.randomBytes)?e=e(o):(e=new Uint8Array(o),(i.crypto||i.msCrypto).getRandomValues(e)),m(e)}catch(e){var n=i.navigator,r=n&&n.plugins;return[+new Date,i,r,i.screen,m(t)]}}():e,3),d),b=new h(d),y=function(){for(var e=b.g(6),t=c,n=0;e<u;)e=(e+n)*o,t*=o,n=b.g(1);for(;e>=l;)e/=2,t/=2,n>>>=1;return(e+n)/t};return y.int32=function(){return 0|b.g(4)},y.quick=function(){return b.g(4)/4294967296},y.double=y,g(m(b.S),t),(n.pass||f||function(e,t,n,a){return a&&(a.S&&p(a,b),e.state=function(){return p(b,{})}),n?(r[s]=e,t):e})(y,v,"global"in n?n.global:this==r,n.state)}function h(e){var t,n=e.length,r=this,a=0,i=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);a<o;)s[a]=a++;for(a=0;a<o;a++)s[a]=s[i=f&i+e[a%n]+(t=s[a])],s[i]=t;(r.g=function(e){for(var t,n=0,a=r.i,i=r.j,s=r.S;e--;)t=s[a=f&a+1],n=n*o+s[f&(s[a]=s[i=f&i+t])+(s[i]=t)];return r.i=a,r.j=i,n})(o)}function p(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function g(e,t){for(var n,r=e+"",a=0;a<r.length;)t[f&a]=f&(n^=19*t[f&a])+r.charCodeAt(a++);return m(t)}function m(e){return String.fromCharCode.apply(0,e)}if(r["seed"+s]=d,g(r.random(),t),e.exports){e.exports=d;try{a=n(385)}catch(e){}}}([],Math)}));e0.alea=q$,e0.xor128=K$,e0.xorwow=Q$,e0.xorshift7=J$,e0.xor4096=Z$,e0.tychei=$$;var t0=e0.alea,n0=function(){function e(e,t,n,r,a){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var i=a||Math.random();this.random=t0(i.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var a=void 0,i=void 0,o=void 0;do{o=(a=2*this.random()-1)*a+(i=2*this.random()-1)*i}while(o>=1||0===o);var s=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*a*s,n=this.mean+this.stdDev*i*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)},e.prototype.convertValue=function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)},e.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},e}(),r0=function(){function e(e,t,n,r){this.alpha=e,this.beta=1/t,this.dtype=n;var a=r||Math.random();this.randu=t0(a.toString()),this.randn=new n0(0,1,n,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return e.prototype.nextValue=function(){for(var e,t,n,r,a,i;;){do{r=this.randn.nextValue(),i=1+this.c*r}while(i<=0);if(i*=i*i,t=1-.331*(e=r*r)*e,n=.5*e+this.d*(1-i+Math.log(i)),(a=this.randu())<t||Math.log(a)<n)break}return i=1/this.beta*this.d*i,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)},e.prototype.convertValue=function(e){return"float32"===this.dtype?e:Math.round(e)},e}(),a0=function(){function e(e,t,n,r){var a=this;if(void 0===e&&(e=0),void 0===t&&(t=1),this.canReturnFloat=function(){return null==a.dtype||"float32"===a.dtype},this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=t0(r)}return e.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},e.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},e}();function i0(e,t,n){return void 0===t&&(t="float32"),t=t||"float32",_J(e),new OJ(e,t,n)}var o0=M$({batchToSpaceND_:function(e,t,n){var r=d$(e,"x","batchToSpaceND"),a=t.reduce((function(e,t){return e*t}));return HQ(r.rank>=1+t.length,(function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length})),HQ(n.length===t.length,(function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+t.length})),HQ(r.shape[0]%a==0,(function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+a})),tZ.runKernelFunc((function(e){return e.batchToSpaceND(r,t,n)}),{$x:r},(function(e){return{$x:function(){return e.spaceToBatchND(t,n)}}}))}}),s0=M$({broadcastTo_:function(e,t){var n=d$(e,"broadcastTo","x"),r=n.shape;if(t.some((function(e){return!(e>0)||e%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<n.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+n.rank+".");if(t.length>n.rank){for(var a=n.shape.slice();a.length<t.length;)a.unshift(1);n=n.reshape(a)}for(var i=Array.from(t),o=t.length-1;o>=0;o--)if(n.shape[o]===t[o])i[o]=1;else if(1!==n.shape[o])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+t+"].");var s=i.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0}));return 0===s.length?n.clone():tZ.runKernelFunc((function(e){return e.tile(n,i)}),{input:n},(function(e){return{input:function(){return e.sum(s,!0)}}}))}}),c0=M$({cast_:function(e,t){var n=d$(e,"x","cast");if(!cJ(t))throw new Error("Failed to cast to unknown dtype "+t);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={dtype:t};return tZ.runKernelFunc((function(e){return e.cast(n,t)}),{x:n},(function(e){return{x:function(){return e.clone()}}}),"Cast",r)}}),u0=M$({clone_:function(e){var t=d$(e,"x","clone",null);return tZ.runKernelFunc((function(){return tZ.makeTensorFromDataId(t.dataId,t.shape,t.dtype)}),{$x:t},(function(e){return{$x:function(){return e.toFloat()}}}))}}),l0=M$({cumsum_:function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var a=d$(e,"x","cumsum"),i=y$([t|=0],a.rank),o=a;null!=i&&(o=a.transpose(i));var s=w$(1,a.rank)[0],c=tZ.runKernelFunc((function(e){return e.cumsum(o,s,n,r)}),{permutedX:o},(function(e){return{permutedX:function(){return e.cumsum(t,n,!r)}}}));return null!=i&&(c=c.transpose(i)),c}}),f0=M$({depthToSpace_:function(e,t,n){void 0===n&&(n="NHWC");var r=d$(e,"x","depthToSpace"),a="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];return HQ(a*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+a+" and "+t+"  for depthToSpace with input shape\n      "+r.shape})),HQ(i*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+t+" for depthToSpace with input shape\n          "+r.shape})),HQ(o%(t*t)==0,(function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+o+" for depthToSpace with input shape "+r.shape})),tZ.runKernelFunc((function(e){return e.depthToSpace(r,t,n)}),{$x:r})}}),d0=M$({expandDims_:function(e,t){void 0===t&&(t=0);var n=d$(e,"x","expandDims",null);HQ(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n.shape.slice();return t<0&&(HQ(-(n.rank+1)<=t,(function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"})),t=n.rank+t+1),r.splice(t,0,1),_0(n,r)}}),h0=M$({eye_:function(e,t,n,r){void 0===r&&(r="float32"),null==t&&(t=e);for(var a=i0([e,t],r),i=e<=t?e:t,o=0;o<i;++o)a.set(1,o,o);var s=a.toTensor().as2D(e,t);if(null==n)return s;if(1===n.length)return k0(d0(s,0),[n[0],1,1]);if(2===n.length)return k0(d0(d0(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return k0(d0(d0(d0(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),p0=M$({multinomial_:function(e,t,n,r){void 0===r&&(r=!1);var a=d$(e,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+o);n=n||Math.random();var s=1===o?a.as2D(1,-1):a,c=tZ.runKernelFunc((function(e){return e.multinomial(s,r,t,n)}),{logits2D:s});return 1===o?c.as1D():c}}),g0=M$({oneHot_:function(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var a=d$(e,"indices","oneHot","int32"),i=a.shape.concat([t]);return a=a.flatten(),tZ.runKernelFunc((function(e){return e.oneHot(a,t,n,r)}),{$indices:a},(function(e){return{$indices:function(){return P$(a.shape,"float32")}}})).reshape(i)}}),m0=M$({pad_:function(e,t,n){void 0===n&&(n=0);var r=d$(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:t,constantValue:n};return tZ.runKernelFunc((function(e){return e.pad(r,t,n)}),{x:r},(function(e){var n=t.map((function(e){return e[0]}));return{x:function(){return e.slice(n,r.shape)}}}),"PadV2",a)}}),v0=M$({pad1d_:function(e,t,n){return void 0===n&&(n=0),HQ(2===t.length,(function(){return"Invalid number of paddings. Must be length of 2."})),m0(e,[t],n)}}),b0=M$({pad2d_:function(e,t,n){return void 0===n&&(n=0),HQ(2===t.length&&2===t[0].length&&2===t[1].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),m0(e,t,n)}}),y0=M$({pad3d_:function(e,t,n){return void 0===n&&(n=0),HQ(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),m0(e,t,n)}}),x0=M$({pad4d_:function(e,t,n){return void 0===n&&(n=0),HQ(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),m0(e,t,n)}}),w0=M$({rand_:function(e,t,n){var r=KQ(e),a=null;if(null==n||"float32"===n)a=new Float32Array(r);else if("int32"===n)a=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);a=new Uint8Array(r)}for(var i=0;i<r;i++)a[i]=t();return tZ.makeTensor(a,e,n)}}),S0=M$({randomNormal_:function(e,t,n,r,a){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new n0(t,n,r,!1,a),o=i0(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}}),C0=M$({randomGamma_:function(e,t,n,r,a){if(void 0===n&&(n=1),void 0===r&&(r="float32"),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var i=new r0(t,n,r,a),o=i0(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}}),M0=M$({randomUniform_:function(e,t,n,r,a){void 0===t&&(t=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var i=i0(e,r),o=new a0(t,n,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}}),_0=M$({reshape_:function(e,t){var n=d$(e,"x","reshape",null);t=nJ(t,n.size),HQ(n.size===KQ(t),(function(){return"new shape and old shape must have the same number of elements."}));var r={shape:t};return tZ.runKernelFunc((function(e){return e.reshape(n,t)}),{x:n},(function(e){return{x:function(){return e.reshape(n.shape)}}}),"Reshape",r)}}),E0=M$({spaceToBatchND_:function(e,t,n){var r=d$(e,"x","spaceToBatchND");return HQ(r.rank>=1+t.length,(function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length})),HQ(n.length===t.length,(function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+t.length})),HQ(r.shape.reduce((function(e,r,a){return a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]==0:e}),!0),(function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+t.toString()})),tZ.runKernelFunc((function(e){return e.spaceToBatchND(r,t,n)}),{$x:r},(function(e){return{$x:function(){return e.batchToSpaceND(t,n)}}}))}}),T0=M$({squeeze_:function(e,t){var n=d$(e,"x","squeeze");return _0(n,aJ(n.shape,t).newShape)}}),I0=M$({stack_:function(e,t){void 0===t&&(t=0);var n=h$(e,"tensors","stack");if(HQ(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),1===n.length)return n[0].expandDims(t);var r=n[0].rank,a=n[0].shape,i=n[0].dtype;HQ(t<=r,(function(){return"Axis must be <= rank of the tensor"})),n.forEach((function(e){YQ(a,e.shape,"All tensors passed to stack must have matching shapes")})),n.forEach((function(e){HQ(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=n.map((function(e){return e.expandDims(t)}));return U$(o,t)}}),k0=M$({tile_:function(e,t){var n=d$(e,"x","tile",null);HQ(n.rank===t.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+t+"."}));var r=[n],a={reps:t};return tZ.runKernelFunc((function(e,r){var a=e.tile(n,t);return r([n]),a}),{x:n},(function(e,n){var r=n[0];return{x:function(){var n=B$(r);if(1===r.rank)for(var a=0;a<t[0];++a)n=n.add(e.slice([a*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(a=0;a<t[0];++a)for(var i=0;i<t[1];++i)n=n.add(e.slice([a*r.shape[0],i*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(a=0;a<t[0];++a)for(i=0;i<t[1];++i)for(var o=0;o<t[2];++o)n=n.add(e.slice([a*r.shape[0],i*r.shape[1],o*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(a=0;a<t[0];++a)for(i=0;i<t[1];++i)for(o=0;o<t[2];++o)for(var s=0;s<t[3];++s)n=n.add(e.slice([a*r.shape[0],i*r.shape[1],o*r.shape[2],s*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return n}}}),"Tile",a,r)}}),N0=M$({truncatedNormal_:function(e,t,n,r,a){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new n0(t,n,r,!0,a),o=i0(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}}),L0=M$({unstack_:function(e,t){void 0===t&&(t=0),t=t||0;var n=d$(e,"x","unstack");HQ(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = "+t+" is not in [-"+n.shape.length+", "+n.shape.length+")"})),t<0&&(t+=n.shape.length);var r={axis:t};return tZ.runKernelFunc((function(e){return e.unstack(n,t)}),{x:n},(function(e){return{x:function(){return I0(e,t)}}}),"Unpack",r)}});function A0(e,t,n,r){void 0===r&&(r=!0);var a=[];if(r)(a=a.concat(t.slice(0))).push(e[0]/n),a=a.concat(e.slice(1));else{a=a.concat(e[0]);for(var i=t.length,o=0;o<i;++o)a=a.concat([e[o+1]/t[o],t[o]]);a=a.concat(e.slice(i+1))}return a}function R0(e,t,n){void 0===n&&(n=!0);var r=[];if(n){r.push(t);for(var a=t+1;a<e;++a)a<=2*t?(r.push(a),r.push(a-(t+1))):r.push(a)}else{var i=[],o=[];for(a=1;a<e;++a)a>=2*t+1||a%2==1?o.push(a):i.push(a);r.push.apply(r,i),r.push(0),r.push.apply(r,o)}return r}function D0(e,t,n,r){void 0===r&&(r=!0);var a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(var i=1;i<e.length;++i)i<=t.length?r?a.push(t[i-1]*e[i]):a.push(e[i]/t[i-1]):a.push(e[i]);return a}function O0(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function P0(e,t,n){for(var r=e.slice(0,1),a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}function F0(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+e.rank);if(0===e.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var n=t.shape,r=n[n.length-1],a=1,i=0;i<n.length-1;++i)a*=n[i];var o=e.shape,s=n.slice();s.pop();var c=1;for(i=r;i<e.rank;++i)c*=o[i],s.push(o[i]);var u=yJ(e.shape).map((function(e){return e/c})).concat([1]).slice(0,r);return[s,a,c,u]}Object.freeze({prepareAndValidate:F0});function z0(e){return e<=30?e:bJ(e,Math.floor(Math.sqrt(e)))}function j0(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+t.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+a+".";if(n.rank<a)throw new Error(i+" update.rank < "+a+". ");if(e.length<r+(n.rank-a))throw new Error(i+" Output shape length < "+(r+(n.rank-a)));if(n.rank!==a+e.length-r)throw new Error(i+" update.rank != "+(a+e.length-r));for(var o=0;o<a;++o)if(n.shape[o]!==t.shape[o])throw new Error(i+" updates.shape["+o+"] ("+n.shape[o]+") != indices.shape["+o+"] ("+t.shape[o]+").");for(o=0;o<n.rank-a;++o)if(n.shape[o+a]!==e[o+r])throw new Error(i+" updates.shape["+(o+a)+"] ("+n.shape[o+a]+") != shape["+(o+a)+"] ("+e[o+a]+")")}function B0(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(0===e.size)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}j0(n,t,e)}function U0(e,t,n){for(var r=t.shape.length,a=r>1?t.shape[r-1]:1,i=n.length,o=1,s=a;s<i;++s)o*=n[s];var c=a<1?1:a;return{sliceRank:a,numUpdates:KQ(t.shape)/c,sliceSize:o,strides:yJ(n.slice(0,a)).concat([1]),outputSize:KQ(n)}}Object.freeze({validateUpdateShape:j0,validateInput:B0,calculateShapes:U0});function W0(e,t,n){HQ(e.rank===t.length,(function(){return"Error in slice"+e.rank+"D: Length of begin "+t+" must match the rank of the array ("+e.rank+")."})),HQ(e.rank===n.length,(function(){return"Error in slice"+e.rank+"D: Length of size "+n+" must match the rank of the array ("+e.rank+")."}));for(var r=function(r){HQ(t[r]+n[r]<=e.shape[r],(function(){return"Error in slice"+e.rank+"D: begin["+r+"] + size["+r+"] ("+(t[r]+n[r])+") would overflow input.shape["+r+"] ("+e.shape[r]+")"}))},a=0;a<e.rank;++a)r(a)}function G0(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function V0(e,t,n){for(var r=[],a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function H0(e,t,n,r,a){var i=t[a],o=n[a]||1;(e&1<<a||null==i)&&(i=o>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[a];return i<0&&(i+=s),WQ(0,i,s-1)}function Y0(e,t,n,r,a){var i=t[a],o=n[a]||1;(e&1<<a||null==i)&&(i=o>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[a];return i<0&&(i+=s),o>0?WQ(0,i,s):WQ(-1,i,s-1)}function X0(e,t,n){for(var r=n.length,a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(a=r+1;a<n.length;a++)if(t[a]>0||n[a]!==e[a])return!1;return!0}function q0(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}Object.freeze({assertParamsValid:W0,maskToAxes:G0,computeOutShape:V0,startForAxis:H0,stopForAxis:Y0,isSliceContinous:X0,computeFlatOffset:q0});function K0(e){return tZ.customGrad(e)}var Q0=M$({softmax_:function(e,t){void 0===t&&(t=-1);var n=d$(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+t);return tZ.runKernelFunc((function(e,r){var a=e.softmax(n,t);return r([a]),a}),{logits:n},(function(e,n){var r=n[0],a=e.mul(r);return{logits:function(){return a.sub(a.sum([t],!0).mul(r))}}}),"Softmax",{dim:t},[],[!0])}}),J0=M$({logSoftmax_:function(e,t){void 0===t&&(t=-1);var n=d$(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+t);return K0((function(e,n){var r=e.max(t,!0),a=e.sub(r),i=a.toFloat().sub(a.exp().sum(t,!0).log());return n([i]),{value:i,gradFunc:function(e,n){var r=n[0].exp();return e.sub(e.sum(t,!0).mul(r))}}}))(n)}}),Z0=function(){function e(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return e.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},e.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},e.prototype.has=function(e){return this.data.has(e)},e.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},e.prototype.numDataIds=function(){return this.dataIdsCount},e}(),$0=function(){function e(){}return e.prototype.time=function(e){return e1("time")},e.prototype.read=function(e){return e1("read")},e.prototype.readSync=function(e){return e1("readSync")},e.prototype.numDataIds=function(){return e1("numDataIds")},e.prototype.disposeData=function(e){return e1("disposeData")},e.prototype.write=function(e,t,n){return e1("write")},e.prototype.move=function(e,t,n,r){return e1("move")},e.prototype.memory=function(){return e1("memory")},e.prototype.floatPrecision=function(){return e1("floatPrecision")},e.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},e.prototype.batchMatMul=function(e,t,n,r){return e1("batchMatMul")},e.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,e1("fusedBatchMatMul")},e.prototype.slice=function(e,t,n){return e1("slice")},e.prototype.stridedSlice=function(e,t,n,r){return e1("stridedSlice")},e.prototype.unstack=function(e,t){return e1("unstack")},e.prototype.reverse=function(e,t){return e1("reverse")},e.prototype.concat=function(e,t){return e1("concat")},e.prototype.neg=function(e){return e1("neg")},e.prototype.add=function(e,t){return e1("add")},e.prototype.addN=function(e){return e1("addN")},e.prototype.subtract=function(e,t){return e1("subtract")},e.prototype.multiply=function(e,t){return e1("multiply")},e.prototype.realDivide=function(e,t){return e1("realDivide")},e.prototype.floorDiv=function(e,t){return e1("floorDiv")},e.prototype.sum=function(e,t){return e1("sum")},e.prototype.prod=function(e,t){return e1("prod")},e.prototype.unsortedSegmentSum=function(e,t,n){return e1("unsortedSegmentSum")},e.prototype.argMin=function(e,t){return e1("argMin")},e.prototype.argMax=function(e,t){return e1("argMax")},e.prototype.equal=function(e,t){return e1("equal")},e.prototype.notEqual=function(e,t){return e1("notEqual")},e.prototype.less=function(e,t){return e1("less")},e.prototype.lessEqual=function(e,t){return e1("lessEqual")},e.prototype.greater=function(e,t){return e1("greater")},e.prototype.greaterEqual=function(e,t){return e1("greaterEqual")},e.prototype.logicalNot=function(e){return e1("logicalNot")},e.prototype.logicalAnd=function(e,t){return e1("logicalAnd")},e.prototype.logicalOr=function(e,t){return e1("logicalOr")},e.prototype.where=function(e){return e1("where")},e.prototype.select=function(e,t,n){return e1("select")},e.prototype.topk=function(e,t,n){return e1("topk")},e.prototype.min=function(e,t){return e1("min")},e.prototype.minimum=function(e,t){return e1("minimum")},e.prototype.mod=function(e,t){return e1("mod")},e.prototype.max=function(e,t){return e1("max")},e.prototype.maximum=function(e,t){return e1("maximum")},e.prototype.all=function(e,t){return e1("all")},e.prototype.any=function(e,t){return e1("any")},e.prototype.squaredDifference=function(e,t){return e1("squaredDifference")},e.prototype.ceil=function(e){return e1("ceil")},e.prototype.floor=function(e){return e1("floor")},e.prototype.round=function(e){return e1("round")},e.prototype.sign=function(e){return e1("sign")},e.prototype.isNaN=function(e){return e1("isNaN")},e.prototype.isInf=function(e){return e1("isInf")},e.prototype.isFinite=function(e){return e1("isFinite")},e.prototype.pow=function(e,t){return e1("pow")},e.prototype.exp=function(e){return e1("exp")},e.prototype.expm1=function(e){return e1("expm1")},e.prototype.softmax=function(e,t){return e1("softmax")},e.prototype.log=function(e){return e1("log")},e.prototype.log1p=function(e){return e1("log1p")},e.prototype.sqrt=function(e){return e1("sqrt")},e.prototype.rsqrt=function(e){return e1("rsqrt")},e.prototype.square=function(e){return e1("square")},e.prototype.reciprocal=function(e){return e1("reciprocal")},e.prototype.relu=function(e){return e1("relu")},e.prototype.relu6=function(e){return e1("relu6")},e.prototype.prelu=function(e,t){return e1("prelu")},e.prototype.elu=function(e){return e1("elu")},e.prototype.eluDer=function(e,t){return e1("eluDer")},e.prototype.selu=function(e){return e1("selu")},e.prototype.int=function(e){return e1("int")},e.prototype.clip=function(e,t,n){return e1("clip")},e.prototype.abs=function(e){return e1("abs")},e.prototype.complexAbs=function(e){return e1("complexAbs")},e.prototype.sigmoid=function(e){return e1("sigmoid")},e.prototype.softplus=function(e){return e1("softplus")},e.prototype.sin=function(e){return e1("sin")},e.prototype.cos=function(e){return e1("cos")},e.prototype.tan=function(e){return e1("tan")},e.prototype.asin=function(e){return e1("asin")},e.prototype.acos=function(e){return e1("acos")},e.prototype.atan=function(e){return e1("atan")},e.prototype.atan2=function(e,t){return e1("atan2")},e.prototype.sinh=function(e){return e1("sinh")},e.prototype.cosh=function(e){return e1("cosh")},e.prototype.tanh=function(e){return e1("tanh")},e.prototype.asinh=function(e){return e1("asinh")},e.prototype.acosh=function(e){return e1("acosh")},e.prototype.atanh=function(e){return e1("atanh")},e.prototype.erf=function(e){return e1("erf")},e.prototype.step=function(e,t){return e1("step")},e.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,e1("fusedConv2d")},e.prototype.conv2d=function(e,t,n){return e1("conv2d")},e.prototype.conv2dDerInput=function(e,t,n){return e1("conv2dDerInput")},e.prototype.conv2dDerFilter=function(e,t,n){return e1("conv2dDerFilter")},e.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,e1("fusedDepthwiseConv2D")},e.prototype.depthwiseConv2D=function(e,t,n){return e1("depthwiseConv2D")},e.prototype.depthwiseConv2DDerInput=function(e,t,n){return e1("depthwiseConv2DDerInput")},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){return e1("depthwiseConv2DDerFilter")},e.prototype.conv3d=function(e,t,n){return e1("conv3d")},e.prototype.conv3dDerInput=function(e,t,n){return e1("conv3dDerInput")},e.prototype.conv3dDerFilter=function(e,t,n){return e1("conv3dDerFilter")},e.prototype.maxPool=function(e,t){return e1("maxPool")},e.prototype.maxPoolBackprop=function(e,t,n,r){return e1("maxPoolBackprop")},e.prototype.avgPool=function(e,t){return e1("avgPool")},e.prototype.avgPoolBackprop=function(e,t,n){return e1("avgPoolBackprop")},e.prototype.avgPool3d=function(e,t){return e1("avgPool3d")},e.prototype.avgPool3dBackprop=function(e,t,n){return e1("avgPool3dBackprop")},e.prototype.maxPool3d=function(e,t){return e1("maxPool3d")},e.prototype.maxPool3dBackprop=function(e,t,n,r){return e1("maxPool3dBackprop")},e.prototype.reshape=function(e,t){return e1("reshape")},e.prototype.cast=function(e,t){return e1("cast")},e.prototype.tile=function(e,t){return e1("tile")},e.prototype.pad=function(e,t,n){return e1("pad")},e.prototype.transpose=function(e,t){return e1("transpose")},e.prototype.gather=function(e,t,n){return e1("gather")},e.prototype.gatherND=function(e,t){return e1("gatherND")},e.prototype.scatterND=function(e,t,n){return e1("scatterND")},e.prototype.batchToSpaceND=function(e,t,n){return e1("batchToSpaceND")},e.prototype.spaceToBatchND=function(e,t,n){return e1("spaceToBatchND")},e.prototype.resizeBilinear=function(e,t,n,r){return e1("resizeBilinear")},e.prototype.resizeBilinearBackprop=function(e,t,n){return e1("resizeBilinearBackprop")},e.prototype.resizeNearestNeighbor=function(e,t,n,r){return e1("resizeNearestNeighbor")},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){return e1("resizeNearestNeighborBackprop")},e.prototype.batchNormalization=function(e,t,n,r,a,i){return e1("batchNormalization")},e.prototype.localResponseNormalization4D=function(e,t,n,r,a){return e1("localResponseNormalization4D")},e.prototype.LRNGrad=function(e,t,n,r,a,i,o){return e1("LRNGrad")},e.prototype.multinomial=function(e,t,n,r){return e1("multinomial")},e.prototype.oneHot=function(e,t,n,r){return e1("oneHot")},e.prototype.cumsum=function(e,t,n,r){return e1("cumsum")},e.prototype.nonMaxSuppression=function(e,t,n,r,a){return e1("nonMaxSuppression")},e.prototype.fft=function(e){return e1("fft")},e.prototype.ifft=function(e){return e1("ifft")},e.prototype.complex=function(e,t){return e1("complex")},e.prototype.real=function(e){return e1("real")},e.prototype.imag=function(e){return e1("imag")},e.prototype.cropAndResize=function(e,t,n,r,a,i){return e1("cropAndResize")},e.prototype.depthToSpace=function(e,t,n){return e1("depthToSpace")},e.prototype.split=function(e,t,n){return e1("split")},e.prototype.sparseToDense=function(e,t,n,r){return e1("sparseToDense")},e.prototype.diag=function(e){return e1("diag")},e.prototype.fill=function(e,t,n){return e1("fill")},e.prototype.onesLike=function(e){return e1("onesLike")},e.prototype.zerosLike=function(e){return e1("zerosLike")},e.prototype.linspace=function(e,t,n){return e1("linspace")},e.prototype.dispose=function(){return e1("dispose")},e}();function e1(e){throw new Error("'"+e+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function t1(e,t){for(var n=e.length,r=[],a=0;a<n;a++){var i=n-1-a,o=e[i]||1;(t[t.length-1-a]||1)>1&&1===o&&r.unshift(i)}return r}function n1(e,t){for(var n=[],r=0;r<t.length;r++){var a=e[e.length-r-1],i=t.length-r-1,o=t[i];(null==a||1===a&&o>1)&&n.unshift(i)}return n}function r1(e,t){for(var n=[],r=Math.max(e.length,t.length),a=0;a<r;a++){var i=e[e.length-a-1];null==i&&(i=1);var o=t[t.length-a-1];if(null==o&&(o=1),1===i)n.unshift(o);else if(1===o)n.unshift(i);else{if(i!==o)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(i)}}return n}function a1(e,t,n,r,a,i,o){void 0===o&&(o="channelsLast");var s,c=u1(t),u=c[0],l=c[1];if("channelsLast"===o)s=[u,l,e[3],e[3]];else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat "+o);s=[u,l,e[1],e[1]]}return o1(e,s,n,r,a,i,!1,o)}function i1(e,t,n,r,a,i,o){void 0===o&&(o="NDHWC");var s,c,u=l1(t),l=u[0],f=u[1],d=u[2];if("NDHWC"===o)c="channelsLast",s=[l,f,d,e[4],e[4]];else{if("NCDHW"!==o)throw new Error("Unknown dataFormat "+o);c="channelsFirst",s=[l,f,d,e[1],e[1]]}return s1(e,s,n,r,a,!1,c,i)}function o1(e,t,n,r,a,i,o,s){void 0===o&&(o=!1),void 0===s&&(s="channelsLast");var c=[-1,-1,-1,-1],u=c[0],l=c[1],f=c[2],d=c[3];if("channelsLast"===s)u=e[0],l=e[1],f=e[2],d=e[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);u=e[0],d=e[1],l=e[2],f=e[3]}var h,p=t[0],g=t[1],m=t[3],v=u1(n),b=v[0],y=v[1],x=u1(r),w=x[0],S=x[1],C=f1(p,w),M=f1(g,S),_=function(e,t,n,r,a,i,o,s){var c,u,l;if("number"==typeof e){c={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var f=function(e,t,n,r,a){null==r&&(r=c1(e,t,n));var i=e[1],o=d1((e[0]-t+2*r)/n+1,a);HQ(JQ(o),(function(){return"The output # of rows ("+o+") must be an integer. Change the stride and/or zero pad parameters"}));var s=d1((i-t+2*r)/n+1,a);return HQ(JQ(s),(function(){return"The output # of columns ("+s+") must be an integer. Change the stride and/or zero pad parameters"})),[o,s]}([t,n],i,r,e,s);u=f[0],l=f[1]}else if("same"===e){u=Math.ceil(t/r),l=Math.ceil(n/a);var d=Math.max(0,(u-1)*r+i-t),h=Math.max(0,(l-1)*a+o-n),p=Math.floor(d/2),g=d-p,m=Math.floor(h/2);c={top:p,bottom:g,left:m,right:h-m,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);c={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((t-i+1)/r),l=Math.ceil((n-o+1)/a)}return{padInfo:c,outHeight:u,outWidth:l}}(a,l,f,b,y,C,M,i),E=_.padInfo,T=_.outHeight,I=_.outWidth,k=o?m*d:m;return"channelsFirst"===s?h=[u,k,T,I]:"channelsLast"===s&&(h=[u,T,I,k]),{batchSize:u,dataFormat:s,inHeight:l,inWidth:f,inChannels:d,outHeight:T,outWidth:I,outChannels:k,padInfo:E,strideHeight:b,strideWidth:y,filterHeight:p,filterWidth:g,effectiveFilterHeight:C,effectiveFilterWidth:M,dilationHeight:w,dilationWidth:S,inShape:e,outShape:h,filterShape:t}}function s1(e,t,n,r,a,i,o,s){void 0===i&&(i=!1),void 0===o&&(o="channelsLast");var c=[-1,-1,-1,-1,-1],u=c[0],l=c[1],f=c[2],d=c[3],h=c[4];if("channelsLast"===o)u=e[0],l=e[1],f=e[2],d=e[3],h=e[4];else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat "+o);u=e[0],h=e[1],l=e[2],f=e[3],d=e[4]}var p,g=t[0],m=t[1],v=t[2],b=t[4],y=l1(n),x=y[0],w=y[1],S=y[2],C=l1(r),M=C[0],_=C[1],E=C[2],T=f1(g,M),I=f1(m,_),k=f1(v,E),N=function(e,t,n,r,a,i,o,s,c,u,l){var f,d,h,p;if("number"==typeof e){f={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var g=function(e,t,n,r,a,i){null==a&&(a=c1(e,t,r));var o=e[1],s=e[2],c=d1((e[0]-t+2*a)/r+1,i);HQ(JQ(c),(function(){return"The output # of depths ("+c+") must be an integer. Change the stride and/or zero pad parameters"}));var u=d1((o-t+2*a)/r+1,i);HQ(JQ(u),(function(){return"The output # of rows ("+u+") must be an integer. Change the stride and/or zero pad parameters"}));var l=d1((s-t+2*a)/r+1,i);return HQ(JQ(l),(function(){return"The output # of columns ("+l+") must be an integer. Change the stride and/or zero pad parameters"})),[c,u,l,1]}([t,n,r,1],s,0,a,e,l);d=g[0],h=g[1],p=g[2]}else if("same"===e){var m=((d=Math.ceil(t/a))-1)*a+s-t,v=((h=Math.ceil(n/i))-1)*i+c-n,b=((p=Math.ceil(r/o))-1)*o+u-r,y=Math.floor(m/2),x=m-y,w=Math.floor(v/2),S=v-w,C=Math.floor(b/2);f={top:w,bottom:S,left:C,right:b-C,front:y,back:x,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);f={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},d=Math.ceil((t-s+1)/a),h=Math.ceil((n-c+1)/i),p=Math.ceil((r-u+1)/o)}return{padInfo:f,outDepth:d,outHeight:h,outWidth:p}}(a,l,f,d,x,w,S,T,I,k,s),L=N.padInfo,A=N.outDepth,R=N.outHeight,D=N.outWidth,O=i?b*h:b;return"channelsFirst"===o?p=[u,O,A,R,D]:"channelsLast"===o&&(p=[u,A,R,D,O]),{batchSize:u,dataFormat:o,inDepth:l,inHeight:f,inWidth:d,inChannels:h,outDepth:A,outHeight:R,outWidth:D,outChannels:O,padInfo:L,strideDepth:x,strideHeight:w,strideWidth:S,filterDepth:g,filterHeight:m,filterWidth:v,effectiveFilterDepth:T,effectiveFilterHeight:I,effectiveFilterWidth:k,dilationDepth:M,dilationHeight:_,dilationWidth:E,inShape:e,outShape:p,filterShape:t}}function c1(e,t,n,r){void 0===r&&(r=1);var a=f1(t,r);return Math.floor((e[0]*(n-1)-n+a)/2)}function u1(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function l1(e){return"number"==typeof e?[e,e,e]:e}function f1(e,t){return t<=1?e:e+(e-1)*(t-1)}function d1(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function h1(e){var t=u1(e),n=t[0],r=t[1],a=t[2];return 1===n&&1===r&&1===a}function p1(e,t){return h1(e)||h1(t)}function g1(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat "+e)}function m1(e,t,n){if("complex64"===t){if("complex64"===e.dtype)return e.clone();var r=P$(e.shape),a=e.toFloat(),i=n.complex(a,r);return r.dispose(),a.dispose(),i}if(!uJ(e.dtype,t))return tZ.makeTensorFromDataId(e.dataId,e.shape,t);if("complex64"===e.dtype){var o=n.real(e);return i=o.cast(t),o.dispose(),i}if("int32"===t)return n.int(e);if("bool"===t){var s=N$(0,e.dtype);return i=n.notEqual(e,s),s.dispose(),i}throw new Error("Error in Cast: failed to cast "+e.dtype+" to "+t)}function v1(e,t){return tZ.makeTensorFromDataId(e.dataId,t,e.dtype)}function b1(e,t,n){var r=(t-e)/(n-1),a=CJ(n,"float32");a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+r;return L$(a,"float32")}Object.freeze({castTensor:m1,reshapeTensor:v1,linspaceImpl:b1,upcastType:XJ,axesAreInnerMostDims:p$,combineLocations:g$,computeOutAndReduceShapes:m$,expandShapeToKeepDim:v$,assertAxesAreInnerMostDims:b$,getAxesPermutation:y$,getUndoAxesPermutation:x$,getInnerMostAxes:w$,getBroadcastDims:t1,getReductionAxes:n1,assertAndGetBroadcastShape:r1,assertParamsConsistent:S$,computeOutShape:C$,computePool2DInfo:a1,computePool3DInfo:i1,computeConv2DInfo:o1,computeConv3DInfo:s1,computeDefaultPad:c1,tupleValuesAreOne:h1,eitherStridesOrDilationsAreOne:p1,convertConv2DDataFormat:g1,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:z0});function y1(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+t.length+".");for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function x1(e,t){return{real:e[2*t],imag:e[2*t+1]}}function w1(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function S1(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function C1(e,t,n){var r=function(e,t,n){return function(e,t,n){for(var r=0,a=e.length,i=0,o=!1;r<a;){var s=n(t,e[i=r+(a-r>>>1)]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}(e,t,n||M1)}(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function M1(e,t){return e>t?1:e<t?-1:0}function _1(e,t,n,r,a){return T1(e,t,n,r,a,0).selectedIndices}function E1(e,t,n,r,a,i){var o=T1(e,t,n,r,a,i,!0);return o.numValidOutputs.dispose(),{selectedIndices:o.selectedIndices,selectedScores:o.selectedScores}}function T1(e,t,n,r,a,i,o,s){void 0===o&&(o=!1),void 0===s&&(s=!1);for(var c=Array.from(t).map((function(e,t){return{score:e,boxIndex:t,suppressBeginIndex:0}})).filter((function(e){return e.score>a})).sort(N1),u=i>0?-.5/i:0,l=[],f=[];l.length<n&&c.length>0;){var d=c.pop(),h=d.score,p=d.boxIndex,g=d.suppressBeginIndex;if(h<a)break;for(var m=!1,v=l.length-1;v>=g;--v){var b=I1(e,p,l[v]);if(b>=r){m=!0;break}if(d.score=d.score*k1(r,u,b),d.score<=a)break}d.suppressBeginIndex=l.length,m||(d.score===h?(l.push(p),f.push(d.score)):d.score>a&&C1(c,d,N1))}var y=l.length;return s&&(l.fill(0,y),f.fill(0,y)),{selectedIndices:L$(l,"int32"),selectedScores:L$(f,"float32"),numValidOutputs:N$(y,"int32")}}function I1(e,t,n){var r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),c=Math.max(r[1],r[3]),u=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),f=Math.max(a[0],a[2]),d=Math.max(a[1],a[3]),h=(s-i)*(c-o),p=(f-u)*(d-l);if(h<=0||p<=0)return 0;var g=Math.max(i,u),m=Math.max(o,l),v=Math.min(s,f),b=Math.min(c,d),y=Math.max(v-g,0)*Math.max(b-m,0);return y/(h+p-y)}function k1(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function N1(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function L1(e,t,n){var r=new Array(e.rank).fill(0),a=e.shape.slice();return t.map((function(t){a[n]=t;var i=e.slice(r,a);return r[n]+=t,i}))}function A1(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];var a=i0(n,e.dtype);for(r=0;r<a.values.length;++r){for(var i=a.indexToLoc(r),o=new Array(e.rank),s=0;s<o.length;s++)o[s]=i[s]%e.shape[s];var c=e.locToIndex(o);a.values[r]=e.values[c]}return a.toTensor()}function R1(e,t,n,r,a){for(var i=t[t.length-1],o=[e.length/i,i],s=o[0],c=o[1],u=iJ(n,s*r),l=iJ("int32",s*r),f=0;f<s;f++){for(var d=f*c,h=e.subarray(d,d+c),p=[],g=0;g<h.length;g++)p.push({value:h[g],index:g});p.sort((function(e,t){return t.value-e.value}));var m=f*r,v=u.subarray(m,m+r),b=l.subarray(m,m+r);for(g=0;g<r;g++)v[g]=p[g].value,b[g]=p[g].index}var y=t.slice();return y[y.length-1]=r,[I$(u,y,n),I$(l,y,"int32")]}function D1(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);var a=i0(e,"int32"),i=i0([n.length,e.length],"int32");for(r=0;r<n.length;r++){var o=a.indexToLoc(n[r]),s=r*e.length;i.values.set(o,s)}return i.toTensor()}var O1=function(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((function(e,t){return"T"+t}));var n=[];this.variableNames.forEach((function(e){n.push("float v"+e+" = get"+e+"AtOutCoords();")}));var r=this.variableNames.map((function(e){return"v"+e})).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},P1=function(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((function(e,t){return"T"+t}));var n=[];this.variableNames.forEach((function(e){n.push("vec4 v"+e+" = get"+e+"AtOutCoords();")}));var r=this.variableNames.map((function(e){return"v"+e})).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},F1=function(e,t,n){this.variableNames=["A"];var r=e.windowSize,a=e.batchSize,i=e.inSize,o=Math.ceil(i/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[a,o];var s="max"===t?">":"<",c=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+c+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+s+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function z1(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return e+"."+t}))}function j1(e,t){return 1===t?[e]:z1(e,t)}function B1(){var e,t,n,r,a,i,o,s,c,u;return 2===AQ().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",i="outputColor",o="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",c="",u="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",i="gl_FragColor",o="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",c="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",u="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:c,defineRound:u}}function U1(e,t,n){void 0===n&&(n="index");var r=yJ(t);return r.map((function(t,a){return"int "+e[a]+" = "+n+" / "+t+"; "+(a===r.length-1?"int "+e[a+1]+" = "+n+" - "+e[a]+" * "+t:"index -= "+e[a]+" * "+t)+";"})).join("")}function W1(e){var t=yJ(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+t[0]+" + coords.y * "+t[1]+" + coords.z;\n  }\n"}var G1="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function V1(e,t,n,r){var a=[];e.forEach((function(e){var t=KQ(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?a.push("uniform float "+e.name+(t>1?"["+t+"]":"")+";"):(a.push("uniform sampler2D "+e.name+";"),a.push("uniform int offset"+e.name+";"))}));var i,o,s=a.join("\n"),c=e.map((function(e){return function(e,t,n){void 0===n&&(n=!1);var r="";r+=n?Y1(e):H1(e);var a=e.shapeInfo.logicalShape,i=t.logicalShape;return a.length<=i.length&&(r+=n?function(e,t){var n,r=e.name,a=r.charAt(0).toUpperCase()+r.slice(1),i="get"+a+"AtOutCoords",o=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,c=t1(e.shapeInfo.logicalShape,t.logicalShape),u=$1(s),l=s-o,f=["x","y","z","w","u","v"];n=0===o?"":s<2&&c.length>=1?"coords = 0;":c.map((function(e){return"coords."+f[e+l]+" = 0;"})).join("\n");var d;d=s<2&&o>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords."+f[t+l]})).join(", ");var h="return outputValue;",p=1===KQ(e.shapeInfo.logicalShape),g=1===KQ(t.logicalShape);if(1!==o||p||g){if(p&&!g)h=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(c.length){var m=o-2,v=o-1;c.indexOf(m)>-1&&c.indexOf(v)>-1?h="return vec4(outputValue.x);":c.indexOf(m)>-1?h="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":c.indexOf(v)>-1&&(h="return vec4(outputValue.xx, outputValue.zz);")}}else h="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+i+"() {\n      "+u+" coords = getOutputCoords();\n      "+n+"\n      vec4 outputValue = get"+a+"("+d+");\n      "+h+"\n    }\n  "}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",i=t.texShape,o=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,c=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===c&&null==e.shapeInfo.flatOffset&&QQ(o,i))return"\n      float "+a+"() {\n        return sampleTexture("+n+", resultUV);\n      }\n    ";var u,l=$1(c),f=t1(e.shapeInfo.logicalShape,t.logicalShape),d=c-s,h=["x","y","z","w","u","v"];u=0===s?"":c<2&&f.length>=1?"coords = 0;":f.map((function(e){return"coords."+h[e+d]+" = 0;"})).join("\n");var p;return p=c<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords."+h[t+d]})).join(", "),"\n    float "+a+"() {\n      "+l+" coords = getOutputCoords();\n      "+u+"\n      return get"+r+"("+p+");\n    }\n  "}(e,t)),r}(e,t,r)})).join("\n"),u=t.texShape,l=B1(),f=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+e.texture2D+"(textureSampler, uv).r;\n    }\n  "}(l),d=function(e){return e.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+e.varyingFs+" vec2 resultUV;\n    "+e.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+e.defineSpecialNaN+"\n    "+e.defineSpecialInf+"\n    "+e.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+X1+"\n    "+q1+"\n    "+K1+"\n  "}(l);return t.isPacked?(i=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===n[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===n[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return 2 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n    }\n  "}(0,t);case 2:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(QQ(e,t))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ";var r=Math.ceil(e[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=e,r=t,a=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],o=(i=Math.ceil(n[2]/2))*Math.ceil(n[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+a[0]+", "+a[1]+"));\n      int index = resTexRC.x * "+a[1]+" + resTexRC.y;\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+i+");\n      int c = imod(index, "+i+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(e,t){for(var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),a=r*Math.ceil(e[e.length-2]/2),i=a,o="",s="b, r, c",c=2;c<e.length-1;c++)o="\n      int b"+c+" = index / "+(i*=e[e.length-c-1])+";\n      index -= b"+c+" * "+i+";\n    "+o,s="b"+c+", "+s;return"\n    ivec"+e.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      "+o+"\n\n      int b = index / "+a+";\n      index -= b * "+a+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec"+e.length+"("+s+");\n    }\n  "}(e,t)}var n,r,a,i,o}(t.logicalShape,u),o=function(e){return"\n    void setOutput(vec4 val) {\n      "+e.output+" = val;\n    }\n  "}(l)):(i=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){return 1===t[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+t[1]+".0);\n      }\n    ":1===t[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+t[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      return resTexRC.x * "+t[1]+" + resTexRC.y;\n    }\n  "}(0,t);case 2:return function(e,t){return QQ(e,t)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+t[0]+", "+t[1]+"));\n      }\n    ":1===e[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===e[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      int r = index / "+e[1]+";\n      int c = index - r * "+e[1]+";\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=t,r=U1(["r","c","d"],e),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      "+r+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(e,t){var n=U1(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      "+n+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(e,t);case 5:return function(e,t){var n=U1(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+t[0]+",\n                             "+t[1]+"));\n\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(e,t);case 6:return function(e,t){var n=U1(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(e,t);default:throw new Error(e.length+"-D output sampling is not yet supported")}var n,r}(t.logicalShape,u),o=function(e){return"\n    void setOutput(float val) {\n      "+e.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(l)),r&&(d+=Q1),[d,f,o,s,i,c,n].join("\n")}function H1(e){var t=e.shapeInfo.logicalShape;switch(t.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float "+n+"() {return "+t+";}";var r=e.shapeInfo.texShape,a=r[0],i=r[1];if(1===a&&1===i)return"\n      float "+n+"() {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var o=e.shapeInfo.texShape;return"\n    float "+n+"() {\n      vec2 uv = uvFromFlat("+o[0]+", "+o[1]+", "+J1(t)+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float "+n+"(int index) {\n        "+Z1(e)+"\n      }\n    ";var r=e.shapeInfo.texShape,a=r[0],i=r[1];if(1===i&&1===a)return"\n      float "+n+"(int index) {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var o=J1(t);return 1===i?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+o+") + 0.5) / "+a+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":1===a?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index + "+o+") + 0.5) / "+i+".0, 0.5);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = uvFromFlat("+a+", "+i+", index + "+o+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape;if(null!=a&&QQ(t,a)){var i=a[0];return"\n    float "+r+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+a[1]+".0, "+i+".0);\n      return sampleTexture("+n+", uv);\n    }\n  "}var o=aJ(t),s=o.newShape,c=o.keptDims,u=s;if(u.length<t.length)return"\n      "+H1(e2(e,u))+"\n      float "+r+"(int row, int col) {\n        return "+r+"("+t2(["row","col"],c)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+t[1]+", 1)));\n        "+Z1(e)+"\n      }\n    ";var l=a[0],f=a[1],d=J1(n);return 1===f?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+d+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+l+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":1===l?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+d+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+f+".0, 0.5);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n  float "+r+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+t[1]+" + col + "+d+";\n    vec2 uv = uvFromFlat("+l+", "+f+", index);\n    return sampleTexture("+n+", uv);\n  }\n"}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[1]*t[2],i=t[2],o=aJ(t),s=o.newShape,c=o.keptDims,u=s;if(u.length<t.length)return"\n        "+H1(e2(e,u))+"\n        float "+r+"(int row, int col, int depth) {\n          return "+r+"("+t2(["row","col","depth"],c)+");\n        }\n      ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+a+", "+i+", 1)));\n        "+Z1(e)+"\n      }\n    ";var l=e.shapeInfo.texShape,f=l[0],d=l[1],h=e.shapeInfo.flatOffset;return d===a&&null==h?"\n        float "+r+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+i+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+d+".0, "+f+".0);\n          return sampleTexture("+n+", uv);\n        }\n      ":d===i&&null==h?"\n    float "+r+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+t[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+d+".0, "+f+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n      float "+r+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+a+" + col * "+i+" + depth + "+J1(n)+";\n        vec2 uv = uvFromFlat("+f+", "+d+", index);\n        return sampleTexture("+n+", uv);\n      }\n  "}(e);case 4:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[3],i=t[2]*a,o=t[1]*i,s=aJ(t),c=s.newShape,u=s.keptDims;if(c.length<t.length)return"\n      "+H1(e2(e,c))+"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        return "+r+"("+t2(["row","col","depth","depth2"],u)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+o+", "+i+", "+a+", 1)));\n        "+Z1(e)+"\n      }\n    ";var l=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,d=f[0],h=f[1];return h===o&&null==l?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+i+", "+a+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+h+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":h===a&&null==l?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+t[1]*t[2]+", "+t[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+h+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+o+" + col * "+i+" +\n          depth * "+a+" + depth2;\n      vec2 uv = uvFromFlat("+d+", "+h+", index + "+J1(n)+");\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 5:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],i=t[3]*a,o=t[2]*i,s=t[1]*o,c=aJ(t),u=c.newShape,l=c.keptDims;if(u.length<t.length)return"\n      "+H1(e2(e,u))+"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+r+"("+t2(["row","col","depth","depth2","depth3"],l)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+s+", "+o+", "+i+", "+a+")) +\n          depth3;\n        "+Z1(e)+"\n      }\n    ";var f=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,h=d[0],p=d[1];return p===s&&null==f?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+o+", "+i+", "+a+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+p+".0, "+h+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":p===a&&null==f?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]+",\n               "+t[2]*t[3]+", "+t[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+p+".0, "+h+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+o+" + depth * "+i+" +\n          depth2 * "+a+" + depth3 + "+J1(n)+";\n      vec2 uv = uvFromFlat("+h+", "+p+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=aJ(t),i=a.newShape,o=a.keptDims;if(i.length<t.length)return"\n      "+H1(e2(e,i))+"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+r+"("+t2(["row","col","depth","depth2","depth3","depth4"],o)+");\n      }\n    ";var s=t[5],c=t[4]*s,u=t[3]*c,l=t[2]*u,f=t[1]*l;if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+f+", "+l+", "+u+", "+c+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+s+", 1)));\n        "+Z1(e)+"\n      }\n    ";var d=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,p=h[0],g=h[1];return g===f&&null==d?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+l+", "+u+", "+c+", "+s+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+g+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":g===s&&null==d?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]*t[4]+",\n               "+t[2]*t[3]*t[4]+",\n               "+t[3]*t[4]+",\n               "+t[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+g+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+f+" + col * "+l+" + depth * "+u+" +\n          depth2 * "+c+" + depth3 * "+s+" + depth4 + "+J1(n)+";\n      vec2 uv = uvFromFlat("+p+", "+g+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function Y1(e){var t;switch(e.shapeInfo.logicalShape.length){case 0:return"\n    vec4 "+("get"+(t=e.name).charAt(0).toUpperCase()+t.slice(1))+"() {\n      return "+B1().texture2D+"("+t+", halfCR);\n    }\n  ";case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,a=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],i=B1();return"\n    vec4 "+n+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+a[0]+", "+a[1]+", index);\n      return "+i.texture2D+"("+t+", uv);\n    }\n  "}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=a[0],o=a[1],s=B1();if(null!=a&&QQ(t,a))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+o+".0, "+i+".0);\n\n        return "+s.texture2D+"("+n+", uv);\n      }\n    ";var c=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(t[1]/2)+", "+c[0]+", "+c[1]+", row, col);\n      return "+s.texture2D+"("+n+", uv);\n    }\n  "}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];if(1===t[0])return"\n        "+Y1(e2(e,t.slice(1)))+"\n        vec4 "+r+"(int b, int row, int col) {\n          return "+r+"("+t2(["b","row","col"],[1,2])+");\n        }\n      ";var o=i[0],s=i[1],c=Math.ceil(t[2]/2);return"\n    vec4 "+r+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+o+", "+s+", "+c*Math.ceil(t[1]/2)+", "+c+", b, row, col);\n      return "+B1().texture2D+"("+n+", uv);\n    }\n  "}(e);default:return function(e){for(var t=e.shapeInfo.logicalShape,n=t.length,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],s=o[0],c=o[1],u=Math.ceil(t[n-1]/2),l=u*Math.ceil(t[n-2]/2),f="int b, int row, int col",d="b * "+l+" + (row / 2) * "+u+" + (col / 2)",h=2;h<n-1;h++)f="int b"+h+", "+f,d="b"+h+" * "+(l*=t[n-h-1])+" + "+d;return"\n    vec4 "+a+"("+f+") {\n      int index = "+d+";\n      int texR = index / "+c+";\n      int texC = index - texR * "+c+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+c+", "+s+");\n      return "+B1().texture2D+"("+r+", uv);\n    }\n  "}(e)}}var X1="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",q1="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",K1="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Q1="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function J1(e){return"offset"+e}function Z1(e){var t=e.name,n=KQ(e.shapeInfo.logicalShape);return n<2?"return "+t+";":"\n    for (int i = 0; i < "+n+"; i++) {\n      if (i == index) {\n        return "+t+"[i];\n      }\n    }\n  "}function $1(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function e2(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function t2(e,t){return t.map((function(t){return e[t]})).join(", ")}var n2=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,HQ(e.length>2,(function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."}));var a=e[e.length-1],i=Math.ceil(a/t);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");var o,s,c=this.outputShape,u=c.length,l=$1(u),f=j1("coords",u);if(1===i){var d=$1(s=u+1);o="\n        "+d+" sourceLocR = "+d+"("+f.join()+", 0);\n        ++"+f[u-1]+";\n        "+d+" sourceLocG = "+d+"("+f.join()+", 0);\n        ++"+f[u-2]+";\n        "+d+" sourceLocA = "+d+"("+f.join()+", 0);\n        --"+f[u-1]+";\n        "+d+" sourceLocB = "+d+"("+f.join()+", 0);\n        --"+f[u-2]+";"}else s=u,o="\n        "+l+" sourceLocR = coords;\n        ++"+f[u-1]+";\n        "+l+" sourceLocG = coords;\n        ++"+f[u-2]+";\n        "+l+" sourceLocA = coords;\n        --"+f[u-1]+";\n        "+l+" sourceLocB = coords;\n        --"+f[u-2]+";";var h=["x","y","z","w","u","v"].slice(0,s),p="."+h[s-1],g=h.map((function(e){return"int "+e})),m=j1("sourceLocR",s-1).concat("inIdx.r"),v=j1("sourceLocG",s-1).concat("inIdx.g"),b=j1("sourceLocB",s-1).concat("inIdx.b"),y=j1("sourceLocA",s-1).concat("inIdx.a"),x="max"===n?"greaterThan":"lessThan",w=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+m.join()+"),\n                             getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+b.join()+"),\n                             getBestIndicesAChannel("+y.join()+")));",S="vec4(\n            getAChannel("+m.join()+"),\n            hasNextCol ? getAChannel("+v.join()+") : 0.,\n            hasNextRow ? getAChannel("+b.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+y.join()+") : 0.)",C=r?"":"\n      float getBestIndicesAChannel("+g.join()+") {\n        return getChannel(getBestIndicesA("+h.join()+"),\n                                          vec2("+h.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+g.join()+") {\n        return getChannel(getA("+h.join()+"),\n                               vec2("+h.slice(-2).join()+"));\n      }\n      "+C+"\n      void main() {\n        "+l+" coords = getOutputCoords();\n        bool hasNextCol = "+f[u-1]+" < "+(c[u-1]-1)+";\n        bool hasNextRow = "+f[u-2]+" < "+(c[u-2]-1)+";\n        "+o+"\n        ivec4 srcIdx = ivec4(sourceLocR"+p+", sourceLocG"+p+",\n          sourceLocB"+p+", sourceLocA"+p+") * "+t+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+S+";\n\n        for (int i = 0; i < "+t+"; i++) {\n          inIdx = srcIdx;\n          "+w+"\n          vec4 candidate = "+S+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+x+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},r2=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,i=e.dilationHeight,o=e.dilationWidth,s=e.effectiveFilterHeight,c=e.effectiveFilterWidth,u=s-1-e.padInfo.top,l=c-1-e.padInfo.left,f=1/(t*n);this.userCode="\n      const ivec2 pads = ivec2("+u+", "+l+");\n      const float avgMultiplier = float("+f+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+";\n            wR += "+i+") {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+c+";\n            wC+= "+o+") {\n            float dyC = float(dyCCorner + wC) / "+a+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},a2=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,a=e.strideDepth,i=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,l=e.effectiveFilterDepth,f=e.effectiveFilterHeight,d=e.effectiveFilterWidth,h=l-1-e.padInfo.front,p=f-1-e.padInfo.top,g=d-1-e.padInfo.left,m=1/(t*n*r);this.userCode="\n      const ivec3 pads = ivec3("+h+", "+p+", "+g+");\n      const float avgMultiplier = float("+m+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+s+") {\n          float dyD = float(dyDCorner + wD) / "+a+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+f+";\n              wR += "+c+") {\n            float dyR = float(dyRCorner + wR) / "+i+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+d+";\n                wC += "+u+") {\n              float dyC = float(dyCCorner + wC) / "+o+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},i2=function(e,t,n,r,a,i){this.outputShape=[],this.variableNames=["x","mean","variance"],r1(e,t),r1(e,n);var o="0.0";null!=r&&(r1(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var s="1.0";null!=a&&(r1(e,a),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+o+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+i+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},o2=function(e,t,n,r,a,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],r1(e,t),r1(e,n);var o="vec4(0.0)";null!=r&&(r1(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=a&&(r1(e,a),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        vec4 offset = "+o+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+i+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},s2=function(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=r1(t,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+e+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},c2="return a + b;",u2="return a - b;",l2="return a * b;",f2="return (a < 0.) ? b * a : a;",d2=function(e,t,n){this.variableNames=["A","B"],this.outputShape=r1(t,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+e+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},h2="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",p2=function(e,t,n,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r1(t,n);var a=this.outputShape.length,i="";if(r)if(0===a||1===KQ(this.outputShape))i="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(i="\n          "+$1(a)+" coords = getOutputCoords();\n        ",1===a)i+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var o=j1("coords",a);i+="\n            bool nextRowOutOfBounds =\n              ("+o[a-2]+" + 1) >= "+this.outputShape[a-2]+";\n            bool nextColOutOfBounds =\n              ("+o[a-1]+" + 1) >= "+this.outputShape[a-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+i+"\n\n        setOutput(result);\n      }\n    "},g2=function(){function e(e){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,a){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(a,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(a,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),m2=function(){function e(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,a){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(a,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(a,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),v2=function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},b2=function(e){this.outputShape=[],this.outputShape=C$(e,1),this.variableNames=e.map((function(e,t){return"T"+t}));var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<t.length;n++){var a=t[n-1];r.push("else if (yC < "+t[n]+") setOutput(getT"+n+"(yR, yC-"+a+"));")}var i=t.length,o=t[t.length-1];r.push("else setOutput(getT"+i+"(yR, yC-"+o+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},y2=function(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=C$(e,t);var n=this.outputShape,r=n.length,a=$1(r),i=j1("coords",r),o=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((function(e,t){return"T"+t}));var s=new Array(e.length-1);s[0]=e[0][t];for(var c=1;c<s.length;c++)s[c]=s[c-1]+e[c][t];var u=o[t],l=o.slice(-2),f=o.join(),d="if ("+u+" < "+s[0]+") {\n        return getChannel(\n            getT0("+f+"), vec2("+l.join()+"));\n        }";for(c=1;c<s.length;c++){var h=s[c-1];d+="\n        if ("+u+" < "+s[c]+"  && "+u+" >= "+s[c-1]+") {\n          return getChannel(\n            getT"+c+"("+x2(o,u,h)+"),\n            vec2("+x2(l,u,h)+"));\n        }"}var p=s.length,g=s[s.length-1];d+="\n        return getChannel(\n          getT"+p+"("+x2(o,u,g)+"),\n          vec2("+x2(l,u,g)+"));",this.userCode="\n      float getValue("+o.map((function(e){return"int "+e}))+") {\n        "+d+"\n      }\n\n      void main() {\n        "+a+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+i+"), 0., 0., 0.);\n\n        "+i[r-1]+" = "+i[r-1]+" + 1;\n        if ("+i[r-1]+" < "+n[r-1]+") {\n          result.g = getValue("+i+");\n        }\n\n        "+i[r-2]+" = "+i[r-2]+" + 1;\n        if ("+i[r-2]+" < "+n[r-2]+") {\n          result.a = getValue("+i+");\n        }\n\n        "+i[r-1]+" = "+i[r-1]+" - 1;\n        if ("+i[r-2]+" < "+n[r-2]+" &&\n            "+i[r-1]+" < "+n[r-1]+") {\n          result.b = getValue("+i+");\n        }\n        setOutput(result);\n      }\n    "};function x2(e,t,n){var r=e.indexOf(t);return e.map((function(e,t){return t===r?e+" - "+n:e})).join()}var w2=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,i="channelsLast"===e.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+a+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              if ("+i+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},S2=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,i="channelsLast"===e.dataFormat,o=t-1-e.padInfo.top,s=n-1-e.padInfo.left,c=i?1:2,u=i?2:3,l=i?3:1;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+l+"];\n\n        ivec2 dyCorner = ivec2(coords["+c+"], coords["+u+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+a+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n\n              if ("+i+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},C2=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,a=e.padInfo.front,i=e.padInfo.top,o=e.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yF = 0; yF < "+e.outDepth+"; yF++) {\n            int xF = wF + yF * "+t+" - "+a+";\n\n            if (xF < 0 || xF >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n              int xR = wR + yR * "+n+" - "+i+";\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n                int xC = wC + yC * "+r+" - "+o+";\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},M2=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,a=e.strideDepth,i=e.strideHeight,o=e.strideWidth,s=t-1-e.padInfo.front,c=n-1-e.padInfo.top,u=r-1-e.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+s+", "+c+", "+u+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+t+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+a+".0;\n\n          if (dyF < 0.0 || dyF >= "+e.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+t+" - 1 - wF;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+i+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+n+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+o+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},_2=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+i+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+a+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},E2=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,i=t-1-e.padInfo.top,o=n-1-e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+i+", "+o+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+a+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},T2=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var a=e.padInfo.top,i=e.padInfo.left,o=e.strideHeight,s=e.strideWidth,c=e.dilationHeight,u=e.dilationWidth,l=e.filterHeight,f=e.filterWidth,d=4*Math.floor(e.inChannels/4),h=e.inChannels%4,p="channelsLast"===e.dataFormat,g=p?1:2,m=p?2:3,v=p?3:1,b="",y="";n&&(b=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",y="result = activation(result);");var x=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+b+"\n\n      const ivec2 strides = ivec2("+o+", "+s+");\n      const ivec2 pads = ivec2("+a+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+v+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+g+"], coords["+m+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+l+"; wR++) {\n          int xR = xRCorner + wR * "+c+";\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+f+"; wC++) {\n            int xC = xCCorner + wC * "+u+";\n\n            if (xC < 0 || xC >= "+e.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+d+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+p+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===h)+") {\n\n              if ("+p+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+d+") *\n                    getW(wR, wC, "+d+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+d+", xR, xC) *\n                    getW(wR, wC, "+d+", d2);\n              }\n\n            } else if ("+(2===h)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+d+", d2),\n                getW(wR, wC, "+d+" + 1, d2)\n              );\n\n              if ("+p+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+d+"),\n                  getX(batch, xR, xC, "+d+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+d+", xR, xC),\n                  getX(batch, "+d+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===h)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+d+", d2),\n                getW(wR, wC, "+d+" + 1, d2),\n                getW(wR, wC, "+d+" + 2, d2)\n              );\n\n              if ("+p+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+d+"),\n                  getX(batch, xR, xC, "+d+" + 1),\n                  getX(batch, xR, xC, "+d+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+d+", xR, xC),\n                  getX(batch, "+d+" + 1, xR, xC),\n                  getX(batch, "+d+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+x+"\n        "+y+"\n        setOutput(result);\n      }\n    "},I2=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,a=e.strideDepth,i=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,l=e.filterDepth,f=e.filterHeight,d=e.filterWidth,h=4*Math.floor(e.inChannels/4),p=e.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+a+", "+i+", "+o+");\n      const ivec3 pads = ivec3("+t+", "+n+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+l+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+f+"; wR++) {\n            int xR = xRCorner + wR * "+c+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+d+"; wC++) {\n              int xC = xCCorner + wC * "+u+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+h+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===p)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+h+") *\n                  getW(wF, wR, wC, "+h+", d2);\n              } else if ("+(2===p)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===p)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1),\n                  getX(batch, xF, xR, xC, "+h+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2),\n                  getW(wF, wR, wC, "+h+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},k2=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var a=e.inHeight,i=e.inWidth,o=e.padInfo.top,s=e.padInfo.left,c=e.strideHeight,u=e.strideWidth,l=e.dilationHeight,f=e.dilationWidth,d=e.filterHeight,h=e.filterWidth,p=e.outChannels/e.inChannels,g="",m="";n&&(g=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",m="result = activation(result);");var v=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+g+"\n\n      const ivec2 strides = ivec2("+c+", "+u+");\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+p+";\n        int q = d2 - d1 * "+p+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+d+"; wR++) {\n          int xR = xRCorner + wR * "+l+";\n\n          if (xR < 0 || xR >= "+a+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+h+"; wC++) {\n            int xC = xCCorner + wC * "+f+";\n\n            if (xC < 0 || xC >= "+i+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+v+"\n        "+m+"\n        setOutput(result);\n      }\n    "},N2=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.outShape;for(var a=e.inHeight,i=e.inWidth,o=e.padInfo.top,s=e.padInfo.left,c=e.strideHeight,u=e.strideWidth,l=e.dilationHeight,f=e.dilationWidth,d=e.filterHeight,h=e.filterWidth,p=h,g="int xR; int xC; int xCOffset;",m=0;m<d;m++)for(var v=0;v<h;v++)g+="\n          vec4 xTexelR"+m+"C"+2*v+" = vec4(0.);\n          vec4 wR"+m+"C"+v+" = vec4(0.);\n          vec4 xR"+m+"C"+v+" = vec4(0.);";for(m=0;m<d;m++)for(var b=0;b<p;b++){if(g+="\n          xR = xRCorner + "+m*l+";\n          xC = xCCorner + "+(v=2*b)*f+";\n        ",1===u){if(v<h&&(g+=s%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+a+" && xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+m+"C"+v+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+i+") {\n                    xTexelR"+m+"C"+v+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+m+"C"+v+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+a+" && xCOffset >= 0 && xCOffset < "+i+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+i+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+m+"C"+v+" = vec4(previous.zw, xTexelR"+m+"C"+v+".xy);\n                } else {\n                  xR"+m+"C"+v+" = vec4(0, 0, xTexelR"+m+"C"+v+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+a+" && xC >= 0 && xC < "+i+") {\n                  xTexelR"+m+"C"+v+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+m+"C"+v+" = vec4(0.);\n                }\n\n                xR"+m+"C"+v+" = xTexelR"+m+"C"+v+";\n              ",v+1<h)){var y=s%2==0?GQ(f):f;f%2==0&&s%2==1||f%2!=0&&s%2!=1?(g+="\n                  xCOffset = xC + "+s%2+" + "+y+";\n\n                  if(xR >= 0 && xR < "+a+" &&\n                    xCOffset >= 0 && xCOffset < "+i+") {\n                    xTexelR"+m+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",f>1&&(g+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+a+" &&\n                      xCOffset >= 0 && xCOffset < "+i+") {\n                      xTexelR"+m+"C"+v+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+m+"C"+v+" = vec4(0.);\n                    }\n                  "),g+="\n                  xR"+m+"C"+(v+1)+" = vec4(\n                    xTexelR"+m+"C"+v+".zw, xTexelR"+m+"C"+(v+2)+".xy);\n                "):g+="\n                  xCOffset = xC + "+y+";\n\n                  if(xR >= 0 && xR < "+a+" &&\n                    xCOffset >= 0 && xCOffset < "+i+") {\n                    xTexelR"+m+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+m+"C"+(v+1)+" = xTexelR"+m+"C"+(v+2)+";\n                "}}else v<h&&(g+="\n              if(xR >= 0 && xR < "+a+") {\n            ",s%2==1?(g+="\n                xCOffset = xC + 1 - "+u+";\n                if(xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+m+"C"+v+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+m+"C"+v+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+i+") {\n                  xTexelR"+m+"C"+(v+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+m+"C"+(v+2)+" = vec4(0.);\n                }\n\n                xR"+m+"C"+v+" = vec4(\n                  xTexelR"+m+"C"+v+".zw, xTexelR"+m+"C"+(v+2)+".zw);\n              ",v+1<h&&(g+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+u+";\n                  if(xCOffset >= 0 && xCOffset < "+i+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+m+"C"+(v+1)+" = vec4(xTexelR"+m+"C"+(v+2)+".xy, final.xy);\n                ")):(g+="\n                if(xC >= 0 && xC < "+i+") {\n                  xTexelR"+m+"C"+v+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+m+"C"+v+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+u+";\n                if(xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+m+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+m+"C"+(v+2)+" = vec4(0.);\n                }\n\n                xR"+m+"C"+v+" = vec4(\n                  xTexelR"+m+"C"+v+".xy, xTexelR"+m+"C"+(v+2)+".xy);\n              ",v+1<h&&(g+="\n                  xR"+m+"C"+(v+1)+" = vec4(\n                    xTexelR"+m+"C"+v+".zw, xTexelR"+m+"C"+(v+2)+".zw);\n                ")),g+="}");v<h&&(g+="\n            vec4 wTexelR"+m+"C"+v+" = getW("+m+", "+v+", d1, q);\n            wR"+m+"C"+v+" = vec4(wTexelR"+m+"C"+v+".xz, wTexelR"+m+"C"+v+".xz);\n          ",v+1<h&&(g+="\n              vec4 wTexelR"+m+"C"+(v+1)+" = getW("+m+", "+(v+1)+", d1, q);\n              wR"+m+"C"+(v+1)+" =\n                vec4(wTexelR"+m+"C"+(v+1)+".xz, wTexelR"+m+"C"+(v+1)+".xz);"))}for(m=0;m<d;m++)for(v=0;v<h;v++)g+="dotProd += xR"+m+"C"+v+" * wR"+m+"C"+v+";";var x="",w="";n&&(x=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"vec4 activation(vec4 x) {\n          "+n+"\n        }",w="result = activation(result);");var S=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+x+"\n\n      const ivec2 strides = ivec2("+c+", "+u+");\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+g+"\n\n        vec4 result = dotProd;\n        "+S+"\n        "+w+"\n        setOutput(result);\n      }\n    "},L2=function(e,t,n,r,a){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var i=e[0],o=e[1],s=e[2],c=e[3],u=t[0],l=n[0],f=n[1];this.outputShape=[u,l,f,c];var d="bilinear"===r?1:0,h=[o-1+".0",s-1+".0"],p=h[0],g=h[1],m=l>1?[""+(o-1)/(l-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],v=m[0],b=m[1],y=m[2],x=f>1?[""+(s-1)/(f-1),"(x2-x1) * width_ratio","x1*"+g+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+g],w=x[0],S=x[1],C=x[2];this.userCode="\n      const float height_ratio = float("+v+");\n      const float width_ratio = float("+w+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+i+") {\n          return;\n        }\n\n        float height_scale = "+b+";\n        float width_scale = "+S+";\n\n        float in_y = "+y+";\n        if( in_y < 0.0 || in_y > "+p+" ) {\n          setOutput(float("+a+"));\n          return;\n        }\n        float in_x = "+C+";\n        if( in_x < 0.0 || in_x > "+g+" ) {\n          setOutput(float("+a+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+d+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},A2=function(e,t,n){this.variableNames=["x"],this.outputShape=e;var r=e.length,a=e[e.length-1],i=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+a+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+$1(r)+" coords = getOutputCoords();\n        int end = "+R2(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+a+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+i+" end) {\n            continue;\n          }\n          if (idx == end && "+t+") {\n            continue;\n          }\n          "+R2(r,"coords")+" = idx;\n          val += getX("+function(e,t){if(1===e)return""+t;if(2===e)return t+".x, "+t+".y";if(3===e)return t+".x, "+t+".y, "+t+".z";if(4===e)return t+".x, "+t+".y, "+t+".z, "+t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function R2(e,t){if(1===e)return""+t;if(2===e)return t+".y";if(3===e)return t+".z";if(4===e)return t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}var D2=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=aZ.DENSE;var t=dZ(e),n=B1();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+U1(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+n.output+" = result;\n      }\n    "},O2=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=aZ.DENSE;var t=dZ(e),n=B1();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+U1(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+n.output+" = result;\n      }\n    "},P2=function(){function e(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+t+";\n      int offset_h = imod(h, "+t+");\n      int in_w = w / "+t+";\n      int offset_w = imod(w, "+t+");\n      int offset_d = (offset_h * "+t+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return e.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e}(),F2=function(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},z2=function(e){this.variableNames=["A"],this.outTexUsage=iZ.DOWNLOAD;var t=B1();this.outputShape=e,this.userCode="\n      "+G1+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+t.output+" = encode_float(x);\n      }\n    "},j2=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=iZ.DOWNLOAD;var t=B1();this.outputShape=e,this.userCode="\n      "+G1+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+t.output+" = encode_float(x);\n      }\n    "},B2=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"];var r=B1(),a=t[0],i=t[1];this.outputShape=e;var o="result";n&&(o="floor(result * 255. + 0.5)"),this.userCode="\n      "+W1(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+i+";\n        int c = imod(flatIndex, "+i+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+i+".0, "+a+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+o+", 0., 0., 0.);\n      }\n    "},U2=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=B1(),a=t[0],i=t[1];this.outputShape=e;var o="",s="result";n&&(s="floor(result * 255. + 0.5)");for(var c=0;c<=1;c++)for(var u=0;u<=1;u++){var l=2*c+u;o+="\n          localCoords = coords;\n          if(localCoords[2] + "+u+" < "+e[2]+") {\n            localCoords[2] += "+u+";\n            if(localCoords[1] + "+c+" < "+e[1]+") {\n              localCoords[1] += "+c+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+i+";\n              c = imod(flatIndex, "+i+");\n              uv = (vec2(c, r) + halfCR) / vec2("+i+".0, "+a+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+l+"] = values[0];\n              } else if(offset == 1) {\n                result["+l+"] = values[1];\n              } else if(offset == 2) {\n                result["+l+"] = values[2];\n              } else {\n                result["+l+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+W1(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+o+"\n\n        "+r.output+" = "+s+";\n      }\n    "},W2=function(e,t,n){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var a=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,i=n?r+".0":"1.0";this.userCode="\n      const float exponentMultiplier = "+a+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+e+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+i+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},G2=function(){function e(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.valueLoc&&(t.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(t.valueLoc,e)}},e}(),V2=function(e,t,n){this.variableNames=["A","indices"];var r=e.slice();r[n]=t,this.outputShape=r,this.rank=r.length;var a=$1(this.rank),i=function(e,t){var n=e.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],i=0;i<e.length;i++)i===t?a.push("int(getIndices("+r[i]+"))"):a.push(""+r[i]);return a.join()}(e,n);this.userCode="\n      void main() {\n        "+a+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},H2=function(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;var r=$1(t.length),a=$1(n.length),i=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+a+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+i+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function Y2(e,t){var n=B1();return yZ(e,t,n.version+"\n    precision highp float;\n    "+n.attribute+" vec3 clipSpacePos;\n    "+n.attribute+" vec2 uv;\n    "+n.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function X2(e,t){return TZ(e,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function q2(e,t){return IZ(e,t,new Uint16Array([0,1,2,2,1,3]))}function K2(e,t,n,r,a,i,o){NZ(n,r);var s=kZ(e,t),c=e.TEXTURE_2D;return gZ(e,t,(function(){return e.bindTexture(c,s)})),gZ(e,t,(function(){return e.texParameteri(c,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),gZ(e,t,(function(){return e.texParameteri(c,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),gZ(e,t,(function(){return e.texParameteri(c,e.TEXTURE_MIN_FILTER,e.NEAREST)})),gZ(e,t,(function(){return e.texParameteri(c,e.TEXTURE_MAG_FILTER,e.NEAREST)})),gZ(e,t,(function(){return e.texImage2D(c,0,a,n,r,0,i,o,null)})),gZ(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),s}function Q2(e,t,n,r,a){var i=fZ(n,r);return K2(e,t,i[0],i[1],a.internalFormatFloat,a.textureFormatFloat,e.FLOAT)}function J2(e,t,n,r,a){var i=fZ(n,r);return K2(e,t,i[0],i[1],a.internalFormatHalfFloat,a.textureFormatFloat,a.textureTypeHalfFloat)}function Z2(e,t,n,r,a){var i=fZ(n,r);return K2(e,t,i[0],i[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}function $2(e,t,n,r,a){var i=hZ(n,r);return K2(e,t,i[0],i[1],a.internalFormatPackedFloat,e.RGBA,e.FLOAT)}function e3(e,t,n,r,a){var i=hZ(n,r);return K2(e,t,i[0],i[1],a.internalFormatPackedHalfFloat,e.RGBA,a.textureTypeHalfFloat)}function t3(e,t,n,r){return gZ(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),AZ(e,t,n,"clipSpacePos",r,3,20,0)&&AZ(e,t,n,"uv",r,2,20,12)}function n3(e,t,n,r,a,i,o){var s,c,u;gZ(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)})),i instanceof Uint8Array?(s=new Uint8Array(r*a*4),c=e.UNSIGNED_BYTE,u=e.RGBA):(s=new Float32Array(r*a*4),c=e.FLOAT,u=o.internalFormatPackedFloat),s.set(i),gZ(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,u,r,a,0,e.RGBA,c,s)})),gZ(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function r3(e,t,n,r){gZ(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)})),r.data instanceof Uint8Array?gZ(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,r.data)})):gZ(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)})),gZ(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function a3(e,t,n,r,a){var i=e.createBuffer();gZ(e,t,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,i)}));var o=16*n*r;return gZ(e,t,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,o,e.STREAM_READ)})),gZ(e,t,(function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,0)})),gZ(e,t,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),i}function i3(e,t,n){var r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}function o3(e,t,n,r,a){var i=fZ(n,r),o=i[0],s=i[1],c=new Uint8Array(n*r*4);return gZ(e,t,(function(){return e.readPixels(0,0,o,s,a.downloadTextureFormat,e.UNSIGNED_BYTE,c)})),new Float32Array(c.buffer)}function s3(e,t,n,r,a,i,o,s){var c=e,u=new Float32Array(function(e,t){var n=hZ(e,t);return n[0]*n[1]*4}(i,o));return c.bindBuffer(c.PIXEL_PACK_BUFFER,t),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,u),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),u}function c3(e,t,n,r){var a=new Float32Array(n*r*4);return gZ(e,t,(function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,a)})),a}var u3=Object.freeze({createVertexShader:Y2,createVertexBuffer:X2,createIndexBuffer:q2,createFloat32MatrixTexture:Q2,createFloat16MatrixTexture:J2,createUnsignedBytesMatrixTexture:Z2,createPackedMatrixTexture:$2,createFloat16PackedMatrixTexture:e3,bindVertexProgramAttributeStreams:t3,uploadDenseMatrixToTexture:n3,uploadPixelDataToTexture:r3,createBufferFromOutputTexture:a3,downloadFloat32MatrixFromBuffer:i3,downloadByteEncodedFloatMatrixFromOutputTexture:o3,downloadPackedMatrixFromBuffer:s3,downloadMatrixFromPackedOutputTexture:c3}),l3=function(){function e(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=AQ().getNumber("WEBGL_VERSION");null!=e?(this.gl=e,uZ(t,e)):this.gl=lZ(t);var n="WEBGL_color_buffer_float";if(1===AQ().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=bZ(this.gl,this.debug,"OES_texture_float"),ZZ(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=bZ(this.gl,this.debug,"OES_texture_half_float");else if(AQ().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),ZZ(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=bZ(this.gl,this.debug,"EXT_color_buffer_half_float");else if(AQ().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",ZZ(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!ZZ(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=X2(this.gl,this.debug),this.indexBuffer=q2(this.gl,this.debug),this.framebuffer=LZ(this.gl,this.debug),this.textureConfig=pZ(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(e.prototype,"debug",{get:function(){return AQ().getBool("DEBUG")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;gZ(t,this.debug,(function(){return t.finish()})),gZ(t,this.debug,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),gZ(t,this.debug,(function(){return t.deleteFramebuffer(e.framebuffer)})),gZ(t,this.debug,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),gZ(t,this.debug,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),gZ(t,this.debug,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}},e.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),Q2(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),J2(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),Z2(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),r3(this.gl,this.debug,e,t)},e.prototype.uploadDenseMatrixToTexture=function(e,t,n,r){this.throwIfDisposed(),n3(this.gl,this.debug,e,t,n,r,this.textureConfig)},e.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),e3(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),$2(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(zZ(this.gl,this.debug,this.framebuffer),this.outputTexture=null),gZ(this.gl,this.debug,(function(){return t.gl.deleteTexture(e)}))},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return o3(r.gl,r.debug,t,n,r.textureConfig)}))},e.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,r,a,i){return s3(this.gl,e,0,0,0,a,i,this.textureConfig)},e.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return i3(this.gl,e,t)},e.prototype.createBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var r=a3(this.gl,this.debug,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r},e.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},e.prototype.createFence=function(e){var t,n,r=this;if(AQ().getBool("WEBGL_FENCE_API_ENABLED")){var a=e,i=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=a.clientWaitSync(i,0,0);return e===a.ALREADY_SIGNALED||e===a.CONDITION_SATISFIED},t=i}else AQ().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,AQ().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}},e.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return c3(r.gl,r.debug,t,n)}))},e.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,n=xZ(t,this.debug,e),r=Y2(t,this.debug),a=MZ(t,this.debug);return gZ(t,this.debug,(function(){return t.attachShader(a,r)})),gZ(t,this.debug,(function(){return t.attachShader(a,n)})),_Z(t,this.debug,a),this.debug&&EZ(t,this.debug,a),this.vertexAttrsAreBound||(this.setProgram(a),this.vertexAttrsAreBound=t3(t,this.debug,this.program,this.vertexBuffer)),a},e.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&gZ(this.gl,this.debug,(function(){return t.gl.deleteProgram(e)}))},e.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&EZ(this.gl,this.debug,this.program),gZ(this.gl,this.debug,(function(){return t.gl.useProgram(e)}))},e.prototype.getUniformLocation=function(e,t,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?DZ(this.gl,this.debug,e,t):OZ(this.gl,e,t)},e.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),gZ(this.gl,this.debug,(function(){return n.gl.getAttribLocation(e,t)}))},e.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},e.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),PZ(this.gl,this.debug,this.program,e,t,n)},e.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},e.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var r=hZ(t,n),a=r[0],i=r[1];this.setOutputMatrixTextureDriver(e,a,i)},e.prototype.setOutputMatrixWriteRegion=function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)},e.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){null!=this.program&&EZ(this.gl,this.debug,this.program),jZ(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),gZ(e,this.debug,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))},e.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),gZ(this.gl,this.debug,(function(){return e.gl.finish()}))},e.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=bZ(this.gl,this.debug,2===AQ().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(2===AQ().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),a=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,a),a},e.prototype.endQuery=function(){if(2!==AQ().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(e){return kQ(this,void 0,void 0,(function(){var t=this;return NQ(this,(function(n){switch(n.label){case 0:return[4,tJ((function(){return t.disposed||t.isQueryAvailable(e,AQ().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}))];case 1:return n.sent(),[2,this.getQueryTime(e,AQ().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}}))}))},e.prototype.getQueryTime=function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint}return a=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint},e.prototype.pollFence=function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))},e.prototype.pollItems=function(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},e.prototype.addItemToPoll=function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||tJ((function(){return n.pollItems(),0===n.itemsToPoll.length}))},e.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),FZ(this.gl,this.debug,e,this.framebuffer),this.debug&&jZ(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(FZ(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&jZ(this.gl)):zZ(this.gl,this.debug,this.framebuffer)},e.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},e.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var r=this.gl;FZ(r,this.debug,e,this.framebuffer),this.debug&&jZ(r),this.outputTexture=e,gZ(r,this.debug,(function(){return r.viewport(0,0,t,n)})),gZ(r,this.debug,(function(){return r.scissor(0,0,t,n)}))},e.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,r){var a=this;this.throwIfDisposed(),gZ(this.gl,this.debug,(function(){return a.gl.scissor(e,t,n,r)}))},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},e}();function f3(e,t){if(e.length!==t.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+t.length+" inputs");e.forEach((function(e,n){var r=e.logicalShape,a=t[n],i=a.shape;if(!QQ(r,i))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+i+" must match");if(!e.isUniform||!a.isUniform){var o=e.texShape,s=a.isUniform?null:a.texData.texShape;if(!QQ(o,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+o+" and "+s+" must match")}}))}var d3=function(e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var r=n.filterWidth,a=n.inChannels,i=n.strideWidth,o=n.strideHeight,s=n.padInfo,c=n.outWidth,u=n.dilationWidth,l=n.dilationHeight,f=n.dataFormat,d=s.left,h=s.top,p=a*r,g=B1(),m="channelsLast"===f,v=m?0:1,b=m?1:2,y="",x=0;x<=1;x++)for(var w=0;w<=1;w++)y+="\n          blockIndex = rc.y + "+w+";\n          pos = rc.x + "+x+";\n\n          if(blockIndex < "+e[1]+" && pos < "+e[0]+") {\n            offsetY = int(blockIndex / ("+c+")) * "+o+" - "+h+";\n            d0 = offsetY + "+l+" * (pos / "+p+");\n\n            if(d0 < "+t[v]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+c+".) * "+i+". - "+d+".);\n              d1 = offsetX + "+u+" * (int(mod(float(pos), "+p+".) / "+a+".));\n\n              if(d1 < "+t[b]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+a+".));\n\n                if ("+m+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*x+w)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*x+w)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+y+"\n\n        "+g.output+" = result;\n      }\n    "},h3=function(e,t,n,r,a){this.variableNames=["x"],this.outputShape=[];var i,o=t,s=e[3]-1;this.outputShape=e;var c="float("+n+") + float("+r+") * sum";i=.5===a?"inversesqrt("+c+")":1===a?"1.0/("+c+")":"exp(log("+c+") * float(-"+a+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+o+"; j <= "+o+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+i+";\n        setOutput(val);\n      }\n    "},p3=function(e,t,n,r,a){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=a,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+t+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+t+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+a+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+a+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},g3=function(e,t,n,r,a){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var i,o=t,s=e[3]-1;this.outputShape=e;var c="float("+n+") + float("+r+") * sum";i=.5===a?"inversesqrt("+c+")":1===a?"1.0/("+c+")":"exp(log("+c+") * float(-"+a+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+o+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+o+"; j <= "+o+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+s+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+i+";\n        setOutput(result);\n      }\n    "},m3=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,a=e.effectiveFilterHeight,i=e.effectiveFilterWidth,o=a-1-e.padInfo.top,s=i-1-e.padInfo.left,c=a*i-1;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+a+";\n          wR += "+r+") {\n          float dyR = float(dyRCorner + wR) / "+t+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+i+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+c+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+i+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},v3=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,a=e.dilationDepth,i=e.dilationHeight,o=e.dilationWidth,s=e.effectiveFilterDepth,c=e.effectiveFilterHeight,u=e.effectiveFilterWidth,l=s-1-e.padInfo.front,f=c-1-e.padInfo.top,d=u-1-e.padInfo.left,h=s*c*u-1;this.userCode="\n      const ivec3 pads = ivec3("+l+", "+f+", "+d+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+s+";\n           wD += "+a+") {\n          float dyD = float(dyDCorner + wD) / "+t+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+c+";\n              wR += "+i+") {\n            float dyR = float(dyRCorner + wR) / "+n+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+u+";\n                wC += "+o+") {\n              float dyC = float(dyCCorner + wC) / "+r+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+h+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+c+" * "+u+" +\n                  wR * "+u+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},b3=function(e,t,n,r,a,i,o){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===a&&(a=!1),void 0===i&&(i=null),void 0===o&&(o=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;var s=n?e[1]:e[2],c=Math.ceil(s/2),u=n?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",f=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],d=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],h="",p="";i&&(h=o?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+i+"\n        }":"vec4 activation(vec4 x) {\n          "+i+"\n        }",p="result = activation(result);");var g=a?"result += getBiasAtOutCoords();":"";a&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+h+"\n\n      const float sharedDimension = "+c+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+c+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+u+");\n          vec4 b = getMatrixB(rc.x, "+l+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+f[0]+" * "+d[0]+");\n          result += ("+f[1]+" * "+d[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+g+"\n\n        "+p+"\n\n        setOutput(result);\n      }\n    "},y3=function(){function e(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(t-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(t-1)+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.seedLoc&&(t.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(t.seedLoc,e)}},e}(),x3=function(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "},w3=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;var t=e.length;if(0===t)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=j1("rc",t),r=$1(t),a=function(e,t,n){if(1===e)return"rc > "+t[0];for(var r="",a=e-2;a<e;a++)r+=n[a]+" >= "+t[a],a<e-1&&(r+="||");return r}(t,e,n),i=function(e,t,n,r){if(1===e)return"";var a=r.slice(-2);return"\n    int r = "+a[0]+";\n    int c = "+a[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+t+";\n    bool rEdge = rp1 >= "+n+";\n  "}(t,e[e.length-1],e[e.length-2],n),o=function(e,t){var n=e.length,r=function(e,t){for(var n=[],r=0;r<=1;r++)for(var a=0;a<=1;a++){for(var i=(0===r?"r":"rp1")+", "+(0===a?"c":"cp1"),o=2;o<e;o++)i=t[t.length-1-o]+","+i;n.push(i)}return n}(n,t);return 1===n?"getA(rc),\n            rc + 1 >= "+e[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+r[0]+"),\n          cEdge ? 0. : getA("+r[1]+"),\n          rEdge ? 0. : getA("+r[2]+"),\n          rEdge || cEdge ? 0. : getA("+r[3]+")"}(e,n);this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+a+") {\n            setOutput(vec4(0));\n          } else {\n            "+i+"\n\n            setOutput(vec4("+o+"));\n          }\n        }\n      "}},S3=function(e,t,n){this.variableNames=["x"],this.outputShape=t.map((function(t,n){return t[0]+e[n]+t[1]}));var r=e.length,a=$1(r),i=t.map((function(e){return e[0]})).join(","),o=t.map((function(t,n){return t[0]+e[n]})).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+a+" start = "+a+"("+i+");\n      "+a+" end = "+a+"("+o+");\n\n      void main() {\n        "+a+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+a+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+i+";\n        int end = "+o+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},C3=function(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((function(t,n){return t[0]+e[n]+t[1]}));for(var r=e.length,a=$1(r),i=t.map((function(e){return e[0]})).join(","),o=t.map((function(t,n){return t[0]+e[n]})).join(","),s=j1("rc",r),c=j1("source",r),u=s[r-1]+" < "+this.outputShape[r-1],l=1===r?"source":"vec2("+c.slice(-2).join()+")",f=[a+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+u+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+u+") {"],d=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",p=0,g=1===r?2:4;p<g;p++)h+="\n        "+f[p]+"\n        if ("+d+") {\n          result["+p+"] = float("+n+");\n        } else {\n          "+a+" source = rc - start;\n          result["+p+"] = getChannel(getX("+c.join()+"), "+l+");\n        }\n      ";h+=1===r?"} ":"}}",this.userCode="\n      const "+a+" start = "+a+"("+i+");\n      const "+a+" end = "+a+"("+o+");\n\n      void main() {\n        "+a+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+h+"\n        setOutput(result);\n      }\n    "},M3=function(e,t,n){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,a=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,s=e.dilationWidth,c=e.effectiveFilterHeight,u=e.effectiveFilterWidth,l=e.padInfo.top,f=e.padInfo.left;this.outputShape=e.outShape;var d="avg"===t,h="0.0";if(d||(h="-1.0 / 1e-20"),n)this.userCode="\n        const ivec2 strides = ivec2("+a+", "+i+");\n        const ivec2 pads = ivec2("+l+", "+f+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+c+";\n              wR += "+o+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+u+";\n                wC += "+s+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+u+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var p=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(p="avgValue / count");var g=4*Math.floor(r/4),m=r%4,v="\n      if ("+d+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+a+", "+i+");\n      const ivec2 pads = ivec2("+l+", "+f+");\n      const float initializationValue = "+h+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+h+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+c+";\n            wR += "+o+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+g+"; wC += 4) {\n            int xC = xCCorner + wC * "+s+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              getValue(batch, xR, xC + 3 * "+s+", d)\n            );\n\n            "+v+"\n          }\n\n          int xC = xCCorner + "+g+";\n          if ("+(1===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+v+"\n          } else if ("+(2===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+v+"\n          } else if ("+(3===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              initializationValue\n            );\n\n            "+v+"\n          }\n        }\n        setOutput("+p+");\n      }\n    "}},_3=function(e,t,n){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,a=e.strideDepth,i=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,l=e.effectiveFilterDepth,f=e.effectiveFilterHeight,d=e.effectiveFilterWidth,h=e.padInfo.front,p=e.padInfo.top,g=e.padInfo.left;this.outputShape=e.outShape;var m="avg"===t,v="0.0";if(m||(v="-1.0 / 1e-20"),n)this.userCode="\n        const ivec3 strides =\n            ivec3("+a+", "+i+", "+o+");\n        const ivec3 pads = ivec3("+h+", "+p+", "+g+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+l+";\n              wD += "+s+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+f+";\n                wR += "+c+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+d+";\n                  wC += "+u+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition =\n                      wD * "+f+" * "+d+" +\n                      wR * "+d+" + wC;;\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var b=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(b="avgValue / count");var y=4*Math.floor(r/4),x=r%4,w="\n      if ("+m+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+a+", "+i+", "+o+");\n      const ivec3 pads = ivec3("+h+", "+p+", "+g+");\n      const float initializationValue = "+v+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+v+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+s+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+f+";\n            wR += "+c+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+y+"; wC += 4) {\n              int xC = xCCorner + wC * "+u+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+u+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+u+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+u+", ch)\n              );\n\n              "+w+"\n            }\n\n            int xC = xCCorner + "+y+";\n            if ("+(1===x)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+w+"\n            } else if ("+(2===x)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+u+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+w+"\n            } else if ("+(3===x)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+u+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+u+", ch),\n                initializationValue\n              );\n\n              "+w+"\n            }\n          }\n          setOutput("+b+");\n        }\n      }\n    "}},E3=function(e,t){this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,a=e.inSize,i=Math.ceil(a/n);this.outputShape=[r,i];var o="0.0",s="";"prod"===t?o="1.0":"min"===t?(o="1.0 / 1e-20",s="min"):"max"===t&&(o="-1.0 / 1e-20",s="max");var c=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===t?c="sumValue":"prod"===t?c="prodValue":"all"===t?c="allValue":"any"===t&&(c="anyValue");var u=4*Math.floor(n/4),l=n%4,f="\n      if ("+("sum"===t)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===t)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",d="vec4";"all"===t?(o="1.0",f="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===t&&(o="0.0",f="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");var h="";a%n>0&&(h="\n        if (inIdx < 0 || inIdx >= "+a+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+o+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+h+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+o+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+u+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+f+"\n        }\n\n        int inIdx = inOffset + "+u+";\n        if ("+(1===l)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+f+"\n        } else if ("+(2===l)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+f+"\n        } else if ("+(3===l)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+f+"\n        }\n        setOutput("+c+");\n      }\n    "},T3=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var n="",r=0;r<4;r++){var a="thisRC = rc;";r%2==1&&(a+="thisRC.z += 1;"),r>1&&(a+="thisRC.y += 1;"),n+="\n        "+a+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+U1(["r","c","d"],t)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+W1(e)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+e[1]+";\n        int cols = "+e[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "},I3=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,a=r[1],i=r[2],o=e.shape,s=o[1],c=o[2],u=[n&&s>1?a-1:a,n&&c>1?i-1:i],l=[n&&s>1?s-1:s,n&&c>1?c-1:c],f=u[0]/l[0],d=u[1]/l[1],h=1/f,p=1/d,g=2*Math.ceil(h)+2,m=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+f+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+g+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+c+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(a-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(i-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},k3=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var a=e[0],i=e[1],o=e[2],s=e[3];this.outputShape=[a,t,n,s];var c=[r&&t>1?i-1:i,r&&n>1?o-1:o],u=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+c[0]/u[0]+",\n          "+c[1]/u[1]+");\n      const vec2 inputShapeRC = vec2("+i+".0, "+o+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},N3=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var a=e[0],i=e[1],o=e[2],s=e[3];this.outputShape=[a,t,n,s];var c=[r&&t>1?i-1:i,r&&n>1?o-1:o],u=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+c[0]/u[0]+",\n          "+c[1]/u[1]+",\n          "+c[1]/u[1]+");\n      const vec3 inputShapeRC = vec3("+i+".0, "+o+".0,\n                                     "+o+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(s-1)+";\n        bool hasNextRow = coords.z < "+(n-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},L3=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,a=r[1],i=r[2],o=e.shape,s=o[1],c=o[2],u=[n&&s>1?a-1:a,n&&c>1?i-1:i],l=[n&&s>1?s-1:s,n&&c>1?c-1:c],f=u[0]/l[0],d=u[1]/l[1],h=1/f,p=1/d,g=2*Math.ceil(h)+2,m=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+f+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+g+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+c+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+u[0]+") *\n                (float(dyR) / float("+l[0]+"));\n\n            float sourceFracCol =\n                float("+u[1]+") *\n                  (float(dyC) / float("+l[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+a+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+i+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},A3=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var a=e[0],i=e[1],o=e[2],s=e[3];this.outputShape=[a,t,n,s];var c=[r&&t>1?i-1:i,r&&n>1?o-1:o],u=[r&&t>1?t-1:t,r&&n>1?n-1:n],l=r?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+c[0]/u[0]+",\n          "+c[1]/u[1]+");\n      const vec2 inputShapeRC = vec2("+i+".0, "+o+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+l+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},R3=function(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=e,1!==n){var r=e.map((function(n,r){return function(n){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - coords["+n+"] - 1":"coords["+n+"]"}(r)})).join(","),a=$1(n);this.userCode="\n      void main() {\n        "+a+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+e[0]+" - coord - 1));\n        }\n      "},D3=function(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=e;var r=j1("rc",n),a=r[n-1]+" + 1 < "+this.outputShape[n-1],i=r[n-2]+" + 1 < "+this.outputShape[n-2],o=$1(n);function s(n){var r=e.map((function(r,a){return function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - "+r[n]+" - 1":""+r[n]}(a,n)}));return"getChannel(getX("+r.join(",")+"), vec2("+r.slice(-2).join(",")+"))"}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+e[0]+" - rc - 1),\n            "+e[0]+" - rc - 1);\n          if("+a+"){\n              result.g = getChannel(getX("+e[0]+" - (rc  + 1) - 1),\n                "+e[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+o+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+function(e){return s(e)}(r.slice())+";\n          if("+a+"){\n            result.g = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",s(e)}(r.slice())+";\n          }\n          if("+i+") {\n            result.b = "+function(e){return e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            if("+a+") {\n              result.a = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},O3=function(e,t,n,r,a,i,o){void 0===o&&(o=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var s=$1(a.length),c=$1(i.length),u="";1===n?u="i":2===n&&(u="i, j");var l="getIndices("+u+")",f="";1===r?f="i":2===r&&(f="i, coords[1]");var d="getUpdates("+f+")",h=t>1?"strides[j]":"strides";this.userCode="\n        "+s+" strides = "+s+"("+a+");\n\n        void main() {\n          "+c+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+e+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+t+"; j++) {\n              int index = round("+l+");\n              flattenedIndex += index * "+h+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+d+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},P3=function(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,a=e.inSize,i=e.numSegments,o=i*Math.ceil(a/n);this.outputShape=[r,o];var s=4*Math.floor(n/4),c=n%4,u="\n        sumValue += dot(values, segFilter);\n    ",l="";a%n>0&&(l="\n        if (inIdx < 0 || inIdx >= "+a+") {\n          return initializationValue;\n        }\n      ");var f="";a%n>0&&(f="\n        if (inIdx < 0 || inIdx >= "+a+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+l+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+f+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+i+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+i+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+u+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===c)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+u+"\n        } else if ("+(2===c)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+u+"\n        } else if ("+(3===c)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+u+"\n        }\n        setOutput(sumValue);\n      }\n    "},F3=function(e,t,n){var r,a;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)a="resRC",r="resRC";else{for(var i=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],s=[],c=0;c<t.length;c++)s.push(""+i[c]),c<e&&o.push(""+i[c]);r=o.join(),a=s.join()}var u=$1(n);this.userCode="\n      void main() {\n        "+u+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+a+"));\n        } else {\n          setOutput(getB("+a+"));\n        }\n      }\n    "},z3=function(){function e(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,n=$1(this.rank),r="uniform int start["+this.rank+"];",a=function(e){if(1===e)return"sourceLoc";if(e<=6)return j3.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank "+e+" is not yet supported")}(this.rank);t="\n        "+n+" sourceLoc;\n        "+n+" coords = getOutputCoords();\n        "+e.map((function(e,t){return"sourceLoc."+j3[t]+" = start["+t+"] + coords."+j3[t]+";"})).join("\n")+"\n      ",this.userCode="\n      "+r+"\n      void main() {\n        "+t+"\n        setOutput(getSource("+a+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),j3=["x","y","z","w","u","v"],B3=function(){function e(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=$1(this.rank),n=j1("coords",this.rank),r=j1("sourceLoc",this.rank),a=1===this.rank?"sourceLoc":"vec2("+r.slice(-2).join()+")",i="getChannel(getSource("+r.join()+"), "+a+")",o="\n      result.x = "+i+";\n      if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n        ++"+r[this.rank-1]+";\n        result.y = "+i+";\n        --"+r[this.rank-1]+";\n      }\n    ",s=1===this.rank?"":"\n      --"+n[this.rank-1]+";\n      if (++"+n[this.rank-2]+" < "+e[this.rank-2]+") {\n        ++"+r[this.rank-2]+";\n        result.z = "+i+";\n        if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n          ++"+r[this.rank-1]+";\n          result.w = "+i+";\n        }\n      }\n    ",c=this.rank<=4?"sourceLoc = coords +\n            "+t+"("+e.map((function(e,t){return"start["+t+"]"})).join()+");":e.map((function(e,t){return r[t]+" = "+n[t]+" + start["+t+"];"})).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+t+" coords = getOutputCoords();\n        "+t+" sourceLoc;\n        "+c+"\n        vec4 result = vec4(0.);\n        "+o+"\n        "+s+"\n        setOutput(result);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),U3=function(e,t,n){this.variableNames=["x"],this.outputShape=n;var r=n.length,a=$1(n.length),i=$1(n.length),o="";if(1===r)o="coords * strides + begin";else{var s=0;o=n.map((function(e,t){return s++,1===n.length?"coords * strides["+t+"] + begin["+t+"]":"coords["+(s-1)+"] * strides["+t+"] + begin["+t+"]"})).join(",")}this.userCode="\n      "+a+" begin = "+a+"("+e+");\n      "+a+" strides = "+a+"("+t+");\n\n      void main() {\n        "+i+" coords = getOutputCoords();\n        setOutput(getX("+o+"));\n      }\n    "},W3=function(){function e(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(e,t,n){var r,a=G3(t,n),i=V3(e,a,n);if(i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]),this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var o=this.freeTextures[i].shift();return this.usedTextures[i].push(o),o}return this.numUsedTextures++,this.log(),a===oZ.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):a===oZ.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):a===oZ.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):a===oZ.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):a===oZ.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(r),r},e.prototype.releaseTexture=function(e,t,n,r){if(null!=this.freeTextures){var a=V3(t,G3(n,r),r);a in this.freeTextures||(this.freeTextures[a]=[]),this.freeTextures[a].push(e),this.numFreeTextures++,this.numUsedTextures--;var i=this.usedTextures[a],o=i.indexOf(e);if(o<0)throw new Error("Cannot release a texture that was never provided by this texture manager");i.splice(o,1),this.log()}},e.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));for(var t in this.usedTextures)this.usedTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function G3(e,t){if(e===iZ.UPLOAD)return oZ.PACKED_2X2_FLOAT32;if(e===iZ.RENDER||null==e)return function(e){return AQ().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?oZ.PACKED_2X2_FLOAT32:oZ.UNPACKED_FLOAT32:e?oZ.PACKED_2X2_FLOAT16:oZ.UNPACKED_FLOAT16}(t);if(e===iZ.DOWNLOAD||e===iZ.PIXELS)return oZ.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function V3(e,t,n){return e[0]+"_"+e[1]+"_"+t+"_"+n}var H3=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;var a=$1(this.rank),i=function(e){var t=e.length;if(t>5)throw Error("Tile for rank "+t+" is not yet supported");if(1===t)return"imod(resRC, "+e[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],a=0;a<e.length;a++)r.push("imod("+n[a]+", "+e[a]+")");return r.join()}(e);this.userCode="\n      void main() {\n        "+a+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},Y3=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;var a=$1(this.rank),i=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank "+t+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),a=0;a<e.length;a++)r[e[a]]=n[a];return r.join()}(t);this.userCode="\n    void main() {\n      "+a+" resRC = getOutputCoords();\n      setOutput(getA("+i+"));\n    }\n    "},X3=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var a=$1(this.rank),i=z1("rc",this.rank),o=new Array(this.rank);for(r=0;r<t.length;r++)o[t[r]]=i[r];var s="vec2("+o.slice(-2).join()+")",c="++"+i[this.rank-1]+" < "+n[this.rank-1],u="getChannel(getA("+o.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+a+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+u+";\n      if("+c+") {\n        result[1] = "+u+";\n      }\n      --"+i[this.rank-1]+";\n      if(++"+i[this.rank-2]+" < "+n[this.rank-2]+") {\n        result[2] = "+u+";\n        if("+c+") {\n          result[3] = "+u+";\n        }\n      }\n      setOutput(result);\n    }\n    "},q3=1.7580993408473768,K3=1.0507009873554805,Q3=function(e,t){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      float unaryOperation(float x) {\n        "+t+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},J3="if (isnan(x)) return x;",Z3="return abs(x);",$3=J3+"\n  return (x < 0.0) ? 0.0 : x;\n",e4=J3+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",t4="return (x >= 0.0) ? x : (exp(x) - 1.0);",n4="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+q3+";\n  float scale = "+K3+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n",r4="return -x;",a4="return ceil(x);",i4="return floor(x);",o4="return exp(x);",s4="return exp(x) - 1.0;",c4=J3+"\n  return sin(x);\n",u4=J3+"\n  return cos(x);\n",l4=J3+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n",f4=J3+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n",d4=J3+"\n  return atan(x);\n",h4=J3+"return log(x + sqrt(x * x + 1.0));",p4=J3+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));",g4=J3+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;",m4="return x;",v4="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",b4="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",y4="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",x4=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},w4=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;var t=e.length,n=j1("rc",t),r=$1(t),a=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(t,n),i=n.slice(-2),o=t<=1?"rc":"vec2("+i.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+a+");\n\n        setOutput(getChannel(packedInput, "+o+"));\n      }\n    "},S4={};function C4(e,t){if(void 0===t&&(t=!1),"linear"===e)return"return x;";if("relu"===e)return t?v4:$3;if("elu"===e)return t?y4:t4;if("relu6"===e)return t?b4:e4;if("prelu"===e)return t?h2:f2;throw new Error("Activation "+e+" has not been implemented for the WebGL backend.")}var M4=function(e){function t(t){var n,r=e.call(this)||this;if(r.pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!AQ().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==t){var a=lZ(AQ().getNumber("WEBGL_VERSION"));r.binaryCache=((n=AQ().getNumber("WEBGL_VERSION"))in S4||(S4[n]={}),S4[n]),r.gpgpu=new l3(a),r.canvas=a.canvas,r.gpgpuCreatedLocally=!0}else r.gpgpu=t,r.binaryCache={},r.gpgpuCreatedLocally=!1,r.canvas=t.gl.canvas;return r.textureManager=new W3(r.gpgpu),r.numMBBeforeWarning=null==AQ().global.screen?1024:AQ().global.screen.height*AQ().global.screen.width*window.devicePixelRatio*600/1024/1024,r.texData=new Z0(r,tZ),r}return IQ(t,e),t.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},t.prototype.write=function(e,t,n){if(AQ().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:iZ.UPLOAD}),r},t.prototype.move=function(e,t,n,r){if(AQ().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:iZ.UPLOAD})},t.prototype.readSync=function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,a=t.complexTensors,i=t.slice,o=t.shape,s=t.isPacked;if(null!=i){var c;c=s?new x4(o,m4):new Q3(o,m4);var u=this.runWebGLProgram(c,[{dataId:e,shape:o,dtype:r}],r),l=this.readSync(u.dataId);return this.disposeData(u.dataId),l}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var f,d,h=null!=this.activeTimers;return h&&(f=MJ()),d="complex64"===r?y1(a.real.dataSync(),a.imag.dataSync()):this.getValuesFromTexture(e),h&&(this.downloadWaitMs+=MJ()-f),this.convertAndCacheOnCPU(e,d)},t.prototype.read=function(e){return kQ(this,void 0,void 0,(function(){var t,n,r,a,i,o,s,c,u,l,f,d,h,p,g,m,v,b,y,x,w,S;return NQ(this,(function(C){switch(C.label){case 0:if(this.pendingRead.has(e))return t=this.pendingRead.get(e),[2,new Promise((function(e){return t.push(e)}))];if(n=this.texData.get(e),r=n.values,a=n.shape,i=n.slice,o=n.dtype,s=n.complexTensors,c=n.isPacked,null!=i)return void 0,u=c?new x4(a,m4):new Q3(a,m4),l=this.runWebGLProgram(u,[{dataId:e,shape:a,dtype:o}],o),f=this.read(l.dataId),this.disposeData(l.dataId),[2,f];if(null!=r)return[2,this.convertAndCacheOnCPU(e)];if(!AQ().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===AQ().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return d=null,"complex64"!==o&&AQ().get("WEBGL_BUFFER_SUPPORTED")&&(h=this.decode(e),p=this.texData.get(h.dataId),d=(S=this.gpgpu).createBufferFromTexture.apply(S,[p.texture].concat(dZ(a)))),this.pendingRead.set(e,[]),"complex64"===o?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:C.sent(),C.label=2;case 2:return"complex64"!==o?[3,4]:[4,Promise.all([s.real.data(),s.imag.data()])];case 3:return m=C.sent(),v=m[0],b=m[1],g=y1(v,b),[3,5];case 4:null==d?g=this.getValuesFromTexture(e):(y=KQ(a),g=this.gpgpu.downloadFloat32MatrixFromBuffer(d,y)),C.label=5;case 5:return null!=h&&this.disposeData(h.dataId),x=this.convertAndCacheOnCPU(e,g),w=this.pendingRead.get(e),this.pendingRead.delete(e),w.forEach((function(e){return e(x)})),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,x]}}))}))},t.prototype.checkNumericalProblems=function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!mZ(n)){if(AQ().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value "+n+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value "+n+" cannot be represented on this device.")}}},t.prototype.getValuesFromTexture=function(e){var t,n=this.texData.get(e),r=n.shape,a=n.dtype,i=n.isPacked,o=KQ(r);if(AQ().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var s=this.decode(e),c=this.texData.get(s.dataId),u=(t=this.gpgpu).downloadMatrixFromPackedTexture.apply(t,[c.texture].concat(dZ(r))).subarray(0,o);return this.disposeData(s.dataId),u}var l=AQ().getBool("WEBGL_PACK")&&!0===i,f=l?HZ(r):r,d=l?new j2(f):new z2(f),h=this.runWebGLProgram(d,[{shape:f,dtype:a,dataId:e}],"float32"),p=this.texData.get(h.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(p.texture,p.texShape[0],p.texShape[1]).subarray(0,o);return this.disposeData(h.dataId),g},t.prototype.time=function(e){return kQ(this,void 0,void 0,(function(){var t,n,r,a,i,o,s;return NQ(this,(function(c){switch(c.label){case 0:return t=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e(),a=qQ(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),i=qQ(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e})),this.activeTimers=t,r&&(this.programTimersStack=null),o={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},AQ().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(a)]:[3,2];case 1:return s=c.sent(),o.kernelMs=VQ(s),o.getExtraProfileInfo=function(){return s.map((function(e,t){return{name:i[t],ms:e}})).map((function(e){return e.name+": "+e.ms})).join(", ")},[3,3];case 2:o.kernelMs={error:"WebGL query timers are not supported in this environment."},c.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,o]}}))}))},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return AQ().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:MJ(),endMs:null}},t.prototype.endTimer=function(e){return AQ().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=MJ(),e)},t.prototype.getQueryTime=function(e){return kQ(this,void 0,void 0,(function(){var t;return NQ(this,(function(n){return AQ().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(t=e).endMs-t.startMs]}))}))},t.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var t=this.texData.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.texData.delete(e)}}},t.prototype.releaseGPUData=function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,a=t.texShape,i=t.usage,o=t.isPacked,s=t.slice,c=s&&s.origDataId||e,u=this.dataRefCount.get(c);u>1?this.dataRefCount.set(c,u-1):(this.dataRefCount.delete(c),null!=n&&(this.numBytesInGPU-=this.computeBytes(a,r),this.textureManager.releaseTexture(n,a,i,o)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null},t.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},t.prototype.getDataInfo=function(e){return this.texData.get(e)},t.prototype.getCPUBackend=function(){return AQ().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=tZ.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(e,t){var n=this;return void 0===t&&(t=128),null!=this.getCPUBackend()&&e.every((function(e){return null==n.texData.get(e.dataId).texture&&e.size<t}))},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(e,t){var n=this.makeOutput(e.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:tZ.keep(e.clone()),imag:tZ.keep(t.clone())},n},t.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,n){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,t,n);if(0===KQ(n))return I$([],n,e.dtype);var r=this.texData.get(e.dataId).isPacked,a=X0(e.shape,t,n);if(r||!a){var i=AQ().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new B3(n):new z3(n),o=i.getCustomSetupFunc(t);return this.compileAndRun(i,[e],null,o)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,n)},t.prototype.shallowSlice=function(e,t,n){var r=this.texData.get(e.dataId),a=this.makeOutput(n,e.dtype),i=this.texData.get(a.dataId);Object.assign(i,r),i.shape=n,i.dtype=e.dtype;var o=q0(t,e.strides);r.slice&&(o+=r.slice.flatOffset),i.slice={flatOffset:o,origDataId:r.slice&&r.slice.origDataId||e.dataId};var s=this.dataRefCount.get(i.slice.origDataId)||1;return this.dataRefCount.set(i.slice.origDataId,s+1),a},t.prototype.stridedSlice=function(e,t,n,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,t,n,r);var a=V0(t,n,r);if(a.some((function(e){return 0===e})))return I$([],a);var i=new U3(t,r,a);return this.compileAndRun(i,[e])},t.prototype.reverse=function(e,t){var n=AQ().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new D3(e.shape,t):new R3(e.shape,t);return this.compileAndRun(n,[e])},t.prototype.concat=function(e,t){if("complex64"===e[0].dtype){var n=e.map((function(e){return E$(e)})),r=e.map((function(e){return T$(e)}));return _$(this.concat(n,t),this.concat(r,t))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,t);if(1===e.length)return e[0];if(e.length>AQ().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(e.length/2),i=this.concat(e.slice(0,a),t),o=this.concat(e.slice(a),t);return this.concat([i,o],t)}if(AQ().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var s=new y2(e.map((function(e){return e.shape})),t);return this.compileAndRun(s,e)}var c=C$(e.map((function(e){return e.shape})),t),u=e.map((function(e){return e.as2D(-1,KQ(e.shape.slice(t)))})),l=new b2(u.map((function(e){return e.shape})));return this.compileAndRun(l,u).reshape(c)},t.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(AQ().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,r4,e.dtype);var t=new Q3(e.shape,r4);return this.compileAndRun(t,[e])},t.prototype.batchMatMul=function(e,t,n,r){var a=n?e.shape[2]:e.shape[1],i=r?t.shape[1]:t.shape[2],o=n?e.shape[1]:e.shape[2],s=e.shape[0];if((1===a||1===i)&&o>1e3){n&&(e=e.transpose([0,2,1])),r&&(t=t.transpose([0,2,1]));var c=1===i?e:e.as3D(s,o,1),u=1===i?2:1,l=1===i?t.as3D(s,1,o):t;return this.multiply(c,l).sum(u,!0)}var f=XJ(e.dtype,t.dtype),d=new b3(e.shape,[s,a,i],n,r);return this.compileAndRun(d,[e,t],f)},t.prototype.fusedBatchMatMul=function(e){var t=e.a,n=e.b,r=e.transposeA,a=e.transposeB,i=e.bias,o=e.activation,s=e.preluActivationWeights,c=r?t.shape[2]:t.shape[1],u=a?n.shape[1]:n.shape[2],l=t.shape[0],f=XJ(t.dtype,n.dtype),d=null!=i,h=null!=s,p=o?C4(o,!0):null,g=new b3(t.shape,[l,c,u],r,a,d,p,h),m=[t,n];return i&&m.push(i),s&&m.push(s),this.compileAndRun(g,m,f)},t.prototype.multiply=function(e,t){if("complex64"===e.dtype){var n=this.texData.get(e.dataId),r=this.texData.get(t.dataId),a=new s2("return areal * breal - aimag * bimag;",e.shape,t.shape),i=new s2("return areal * bimag + aimag * breal;",e.shape,t.shape),o=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag),this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)],s=this.compileAndRun(a,o),c=this.compileAndRun(i,o),u=this.complex(s,c);return s.dispose(),c.dispose(),u}if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.multiply(e,t);if(AQ().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,l2,e.dtype);var l=new d2(l2,e.shape,t.shape);return this.compileAndRun(l,[e,t],e.dtype)},t.prototype.batchNormalization=function(e,t,n,r,a,i){var o=[e,t,n],s=null;null!=i&&(s=i.shape,o.push(i));var c=null;if(null!=a&&(c=a.shape,o.push(a)),AQ().getBool("WEBGL_PACK_NORMALIZATION")){var u=new o2(e.shape,t.shape,n.shape,s,c,r);return this.compileAndRun(u,o)}var l=new i2(e.shape,t.shape,n.shape,s,c,r);return this.compileAndRun(l,o)},t.prototype.localResponseNormalization4D=function(e,t,n,r,a){var i=AQ().getBool("WEBGL_PACK_NORMALIZATION")?new g3(e.shape,t,n,r,a):new h3(e.shape,t,n,r,a);return this.compileAndRun(i,[e])},t.prototype.LRNGrad=function(e,t,n,r,a,i,o){var s=new p3(t.shape,r,a,i,o);return this.compileAndRun(s,[t,n,e])},t.prototype.tile=function(e,t){if("string"===e.dtype){var n=this.readSync(e.dataId).map((function(e){return TJ(e)}));return A1(i0(e.shape,e.dtype,n),t)}var r=new H3(e.shape,t);return this.compileAndRun(r,[e])},t.prototype.pad=function(e,t,n){var r=AQ().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new C3(e.shape,t,n):new S3(e.shape,t,n);return this.compileAndRun(r,[e])},t.prototype.transpose=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,t);var n=AQ().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new X3(e.shape,t):new Y3(e.shape,t);return this.compileAndRun(n,[e])},t.prototype.gather=function(e,t,n){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.gather(e,t,n);var r=new V2(e.shape,t.size,n);return this.compileAndRun(r,[e,t])},t.prototype.batchToSpaceND=function(e,t,n){HQ(e.rank<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var r=t.reduce((function(e,t){return e*t})),a=A0(e.shape,t,r),i=R0(a.length,t.length),o=D0(e.shape,t,r),s=O0(n,t.length),c=P0(o,n,t.length);return e.reshape(a).transpose(i).reshape(o).slice(s,c)},t.prototype.spaceToBatchND=function(e,t,n){HQ(e.rank<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var r=t.reduce((function(e,t){return e*t})),a=[[0,0]];a.push.apply(a,n);for(var i=1+t.length;i<e.shape.length;++i)a.push([0,0]);var o=e.pad(a),s=A0(o.shape,t,r,!1),c=R0(s.length,t.length,!1),u=D0(o.shape,t,r,!1);return o.reshape(s).transpose(c).reshape(u)},t.prototype.reduce=function(e,t,n){var r=e.shape[0],a=e.shape[1],i=z0(a),o=new E3({windowSize:i,inSize:a,batchSize:r},t),s=this.compileAndRun(o,[e],n);return 1===s.shape[1]?s:this.reduce(s,t,n)},t.prototype.argReduce=function(e,t,n){void 0===n&&(n=null);var r=e.shape[0],a=e.shape[1];null!=n&&(r=n.shape[0],a=n.shape[1]);var i=z0(a),o=new F1({windowSize:i,inSize:a,batchSize:r},t,null==n),s=[e];null!=n&&s.push(n);var c=this.compileAndRun(o,s,"int32");return 1===c.shape[1]?c:this.argReduce(e,t,c)},t.prototype.argReducePacked=function(e,t,n){void 0===n&&(n=null);var r=null!=n?n.shape:e.shape,a=z0(r[r.length-1]),i=new n2(r,a,t,null==n),o=null==n?[e]:[e,n],s=this.compileAndRun(i,o,"int32");return s.rank===e.rank?this.argReducePacked(e,t,s):s},t.prototype.sum=function(e,t){b$("sum",t,e.rank);var n=m$(e.shape,t),r=n[0],a=KQ(n[1]),i=e.as2D(-1,a),o=qJ(e.dtype);return this.reduce(i,"sum",o).reshape(r)},t.prototype.prod=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,t);var n=m$(e.shape,t),r=n[0],a=KQ(n[1]),i=e.as2D(-1,a),o=qJ(e.dtype);return this.reduce(i,"prod",o).reshape(r)},t.prototype.unsortedSegmentSum=function(e,t,n){var r=0,a=y$([r],e.rank),i=e;null!=a&&(i=e.transpose(a),r=w$(1,e.rank)[0]);var o=function(e,t,n){for(var r=[],a=e.length,i=0;i<a;i++)i!==t?r.push(e[i]):r.push(n);return r}(i.shape,r,n),s=KQ([i.shape[r]]),c=i.as2D(-1,s),u=qJ(e.dtype),l=this.segOpCompute(c,"unsortedSegmentSum",t,u,n).reshape(o);return null!=a&&(l=l.transpose(x$(a))),l},t.prototype.segOpCompute=function(e,t,n,r,a){var i=e.shape[0],o=e.shape[1],s=function(e,t){var n,r=!1;for(e<=30?(n=e,r=!0):n=bJ(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=bJ(e,n+1);return n}(o,a),c=new P3({windowSize:s,inSize:o,batchSize:i,numSegments:a},t),u=this.compileAndRun(c,[e,n],r);return u.shape[1]===a?u:(n=z$(0,a).tile([o/s]),this.segOpCompute(u,t,n,r,a))},t.prototype.argMinMaxReduce=function(e,t,n){var r=[t];if(b$("arg"+n.charAt(0).toUpperCase()+n.slice(1),r,e.rank),!AQ().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var a=m$(e.shape,r),i=a[0],o=KQ(a[1]),s=e.as2D(-1,o);return this.argReduce(s,n).reshape(i)}return this.argReducePacked(e,n)},t.prototype.argMin=function(e,t){return this.argMinMaxReduce(e,t,"min")},t.prototype.argMax=function(e,t){return this.argMinMaxReduce(e,t,"max")},t.prototype.cumsum=function(e,t,n,r){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+t);var a=new A2(e.shape,n,r);return this.compileAndRun(a,[e])},t.prototype.equal=function(e,t){if(AQ().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(equal(a, b));\n","bool");var n=new d2("return float(a == b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.notEqual=function(e,t){if(AQ().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(notEqual(a, b));\n","bool");var n=new d2("return float(a != b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.less=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.less(e,t);if(AQ().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThan(a, b));\n","bool");var n=new d2("return float(a < b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.lessEqual=function(e,t){if(AQ().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new d2("return float(a <= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.greater=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.greater(e,t);if(AQ().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThan(a, b));\n","bool");var n=new d2("return float(a > b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.greaterEqual=function(e,t){if(AQ().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new d2("return float(a >= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.logicalNot=function(e){var t=new Q3(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(t,[e])},t.prototype.logicalAnd=function(e,t){if(AQ().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new d2("return float(a >= 1.0 && b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.logicalOr=function(e,t){if(AQ().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new d2("return float(a >= 1.0 || b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.select=function(e,t,n){var r=new F3(e.rank,t.shape,t.rank);return this.compileAndRun(r,[e,t,n],XJ(t.dtype,n.dtype))},t.prototype.where=function(e){u$("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return D1(e.shape,t)},t.prototype.topk=function(e,t,n){return R1(e.dataSync(),e.shape,e.dtype,t)},t.prototype.min=function(e,t){b$("min",t,e.rank);var n=m$(e.shape,t),r=n[0],a=KQ(n[1]),i=e.as2D(-1,a);return this.reduce(i,"min",i.dtype).reshape(r)},t.prototype.minimum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.minimum(e,t);var n=AQ().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new p2("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new d2("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.mod=function(e,t){var n=AQ().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new p2("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new d2("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.max=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,t);b$("max",t,e.rank);var n=m$(e.shape,t),r=n[0],a=KQ(n[1]),i=e.as2D(-1,a);return this.reduce(i,"max",i.dtype).reshape(r)},t.prototype.maximum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.maximum(e,t);var n=AQ().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new p2("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new d2("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.all=function(e,t){b$("all",t,e.rank);var n=m$(e.shape,t),r=n[0],a=KQ(n[1]),i=e.as2D(-1,a);return this.reduce(i,"all",i.dtype).reshape(r)},t.prototype.any=function(e,t){b$("any",t,e.rank);var n=m$(e.shape,t),r=n[0],a=KQ(n[1]),i=e.as2D(-1,a);return this.reduce(i,"any",i.dtype).reshape(r)},t.prototype.realDivide=function(e,t){if(AQ().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n","float32",!0);var n=new d2("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",e.shape,t.shape);return this.compileAndRun(n,[e,t],"float32")},t.prototype.floorDiv=function(e,t){if(AQ().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var n=new d2("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",e.shape,t.shape);return this.compileAndRun(n,[e,t],"int32")},t.prototype.add=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,c2);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.add(e,t);var n=XJ(e.dtype,t.dtype);if(AQ().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,c2,n);var r=new d2(c2,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},t.prototype.packedUnaryOp=function(e,t,n){var r=new x4(e.shape,t);return this.compileAndRun(r,[e],n)},t.prototype.packedBinaryOp=function(e,t,n,r,a){void 0===a&&(a=!1);var i=new p2(n,e.shape,t.shape,a);return this.compileAndRun(i,[e,t],r)},t.prototype.complexSeparableBinaryOp=function(e,t,n){var r=this,a=this.texData.get(e.dataId),i=this.texData.get(t.dataId),o=[[a.complexTensors.real,i.complexTensors.real],[a.complexTensors.imag,i.complexTensors.imag]].map((function(a){var i=a[0],o=a[1],s=r.makeComplexComponentTensorInfo(e,i),c=r.makeComplexComponentTensorInfo(t,o),u=new d2(n,e.shape,t.shape);return r.compileAndRun(u,[s,c],XJ(i.dtype,o.dtype))})),s=o[0],c=o[1],u=this.complex(s,c);return s.dispose(),c.dispose(),u},t.prototype.makeComplexComponentTensorInfo=function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}},t.prototype.addN=function(e){if(1===e.length)return e[0];if(e.length>AQ().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var t=Math.floor(e.length/2),n=this.addN(e.slice(0,t)),r=this.addN(e.slice(t));return this.addN([n,r])}var a=e.map((function(e){return e.dtype})).reduce((function(e,t){return XJ(e,t)})),i=e.map((function(e){return e.shape})),o=AQ().getBool("WEBGL_PACK")?new P1(e[0].shape,i):new O1(e[0].shape,i);return this.compileAndRun(o,e,a)},t.prototype.subtract=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,u2);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.subtract(e,t);var n=XJ(e.dtype,t.dtype);if(AQ().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,u2,e.dtype);var r=new d2(u2,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},t.prototype.pow=function(e,t){var n=AQ().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new p2("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new d2("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,t.shape),r=XJ(e.dtype,t.dtype);return this.compileAndRun(n,[e,t],r)},t.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(AQ().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,a4,e.dtype);var t=new Q3(e.shape,a4);return this.compileAndRun(t,[e])},t.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(AQ().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,i4,e.dtype);var t=new Q3(e.shape,i4);return this.compileAndRun(t,[e])},t.prototype.sign=function(e){var t=new Q3(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(t,[e])},t.prototype.isNaN=function(e){var t=new Q3(e.shape,"return float(isnan(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.isInf=function(e){var t=new Q3(e.shape,"return float(isinf(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.isFinite=function(e){var t=new Q3(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.round=function(e){var t=new Q3(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(t,[e])},t.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(AQ().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,o4,e.dtype);var t=new Q3(e.shape,o4);return this.compileAndRun(t,[e])},t.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(AQ().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,s4,e.dtype);var t=new Q3(e.shape,s4);return this.compileAndRun(t,[e])},t.prototype.softmax=function(e,t){var n=rJ([t],e.shape),r=this.max(e,n),a=v$(r.shape,n),i=this.subtract(e,r.reshape(a)),o=this.exp(i),s=this.sum(o,n).reshape(a);return this.realDivide(o,s)},t.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(AQ().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",e.dtype);var t=new Q3(e.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(t,[e])},t.prototype.log1p=function(e){var t=new Q3(e.shape,"return log(1.0 + x);");return this.compileAndRun(t,[e])},t.prototype.sqrt=function(e){var t=new Q3(e.shape,"return sqrt(x);");return this.compileAndRun(t,[e])},t.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var t=new Q3(e.shape,"return inversesqrt(x);");return this.compileAndRun(t,[e])},t.prototype.reciprocal=function(e){var t=new Q3(e.shape,"return 1.0 / x;");return this.compileAndRun(t,[e])},t.prototype.relu=function(e){var t;return t=AQ().getBool("WEBGL_PACK")?new x4(e.shape,v4):new Q3(e.shape,$3),this.compileAndRun(t,[e])},t.prototype.relu6=function(e){var t;return t=AQ().getBool("WEBGL_PACK")?new x4(e.shape,b4):new Q3(e.shape,e4),this.compileAndRun(t,[e])},t.prototype.prelu=function(e,t){var n=AQ().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new p2(h2,e.shape,t.shape):new d2(f2,e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.elu=function(e){if(AQ().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,y4,e.dtype);var t=new Q3(e.shape,t4);return this.compileAndRun(t,[e])},t.prototype.eluDer=function(e,t){var n=AQ().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new p2("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,t.shape):new d2("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.selu=function(e){var t=new Q3(e.shape,n4);return this.compileAndRun(t,[e])},t.prototype.int=function(e){var t=new Q3(e.shape,"return float(int(x));");return this.compileAndRun(t,[e],"int32")},t.prototype.clip=function(e,t,n){var r,a=(r=AQ().getBool("WEBGL_PACK_CLIP")?new m2(e.shape):new g2(e.shape)).getCustomSetupFunc(t,n);return this.compileAndRun(r,[e],null,a)},t.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(AQ().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Z3,e.dtype);var t=new Q3(e.shape,Z3);return this.compileAndRun(t,[e])},t.prototype.complexAbs=function(e){var t=this.texData.get(e.dataId),n=new v2(e.shape),r=[this.makeComplexComponentTensorInfo(e,t.complexTensors.real),this.makeComplexComponentTensorInfo(e,t.complexTensors.imag)];return this.compileAndRun(n,r)},t.prototype.sigmoid=function(e){var t=new Q3(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(t,[e])},t.prototype.softplus=function(e){var t=new Q3(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(t,[e])},t.prototype.sin=function(e){var t=new Q3(e.shape,c4);return this.compileAndRun(t,[e])},t.prototype.cos=function(e){var t=new Q3(e.shape,u4);return this.compileAndRun(t,[e])},t.prototype.tan=function(e){var t=new Q3(e.shape,"return tan(x);");return this.compileAndRun(t,[e])},t.prototype.asin=function(e){var t=new Q3(e.shape,l4);return this.compileAndRun(t,[e])},t.prototype.acos=function(e){var t=new Q3(e.shape,f4);return this.compileAndRun(t,[e])},t.prototype.atan=function(e){var t=new Q3(e.shape,d4);return this.compileAndRun(t,[e])},t.prototype.atan2=function(e,t){var n=AQ().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new p2("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new d2("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.sinh=function(e){var t=new Q3(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},t.prototype.cosh=function(e){var t=new Q3(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},t.prototype.tanh=function(e){var t=new Q3(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(t,[e])},t.prototype.asinh=function(e){var t=new Q3(e.shape,h4);return this.compileAndRun(t,[e])},t.prototype.acosh=function(e){var t=new Q3(e.shape,p4);return this.compileAndRun(t,[e])},t.prototype.atanh=function(e){var t=new Q3(e.shape,g4);return this.compileAndRun(t,[e])},t.prototype.erf=function(e){var t=new Q3(e.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(t,[e])},t.prototype.step=function(e,t){var n=new Q3(e.shape,function(e){return void 0===e&&(e=0),J3+"\n    return x > 0.0 ? 1.0 : float("+e+");\n  "}(t));return this.compileAndRun(n,[e])},t.prototype.conv2dByMatMul=function(e,t,n,r,a,i){var o=e.shape,s=this.texData.get(e.dataId),c=n.inChannels,u=o[0]*o[1]*o[2],l=n.outChannels,f="channelsLast"===n.dataFormat,d=(1===u||1===l)&&c>1e3,h=o[2]%2!=0&&!!s.isPacked;if(d||!AQ().getBool("WEBGL_LAZILY_UNPACK")||!AQ().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!h){var p=f?o[0]*o[1]*o[2]:o[0]*o[2]*o[3],g=this.reshape(e,[1,p,n.inChannels]),m=this.reshape(t,[1,n.inChannels,n.outChannels]);return this.reshape(this.fusedBatchMatMul({a:g,b:m,transposeA:!1,transposeB:!1,bias:r,activation:a,preluActivationWeights:i}),n.outShape)}var v=f?o[0]*o[1]*(o[2]+1):o[0]*o[2]*(o[3]+1),b={dataId:e.dataId,shape:[1,v,n.inChannels],dtype:e.dtype},y=s.shape;s.shape=s.shape.slice(),s.shape[s.shape.length-2]++,HQ(qZ(s.shape,b.shape),(function(){return"packed reshape "+s.shape+" to "+b.shape+" isn't free"}));var x=this.reshape(t,[1,n.inChannels,n.outChannels]),w=this.fusedBatchMatMul({a:b,b:x,transposeA:!1,transposeB:!1,bias:r,activation:a,preluActivationWeights:i}),S=this.texData.get(w.dataId);return HQ(S.isPacked,(function(){return"batchMatMul result is expected to be packed"})),s.shape=y,S.shape=n.outShape,tZ.makeTensorFromDataId(w.dataId,n.outShape,w.dtype)},t.prototype.conv2dWithIm2Row=function(e,t,n,r,a,i){var o=n.filterWidth,s=n.filterHeight,c=n.inChannels,u=n.outWidth,l=n.outHeight,f="channelsLast"===n.dataFormat,d=o*s*c,h=l*u,p=[d,h],g=e.squeeze([0]),m=t.reshape([1,d,-1]),v=new d3(p,g.shape,n),b=this.compileAndRun(v,[g]).reshape([1,p[0],p[1]]),y=null!=r,x=null!=i,w=a?C4(a,!0):null,S=new b3(b.shape,[1,h,n.outChannels],!0,!1,y,w,x),C=[b,m];r&&C.push(r),x&&C.push(i);var M=this.compileAndRun(S,C);return f?M.reshape([1,l,u,n.outChannels]):M.reshape([1,n.outChannels,l,u])},t.prototype.fusedConv2d=function(e){var t=e.input,n=e.filter,r=e.convInfo,a=e.bias,i=e.activation,o=e.preluActivationWeights;if(1===r.filterHeight&&1===r.filterWidth&&1===r.dilationHeight&&1===r.dilationWidth&&1===r.strideHeight&&1===r.strideWidth&&("SAME"===r.padInfo.type||"VALID"===r.padInfo.type))return this.conv2dByMatMul(t,n,r,a,i,o);if(AQ().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,n,r,a,i,o);var s=null!=a,c=null!=o,u=i?C4(i,!1):null,l=new T2(r,s,u,c),f=[t,n];return a&&f.push(a),o&&f.push(o),this.compileAndRun(l,f)},t.prototype.conv2d=function(e,t,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(e,t,n);if(AQ().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,t,n);var r=new T2(n);return this.compileAndRun(r,[e,t])},t.prototype.conv2dDerInput=function(e,t,n){var r=new S2(n);return this.compileAndRun(r,[e,t])},t.prototype.conv2dDerFilter=function(e,t,n){var r=new w2(n);return this.compileAndRun(r,[e,t])},t.prototype.fusedDepthwiseConv2D=function(e){var t,n=e.input,r=e.filter,a=e.convInfo,i=e.bias,o=e.activation,s=e.preluActivationWeights,c=AQ().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1,u=o?C4(o,c):null,l=[n,r],f=null!=i,d=null!=s;return f&&l.push(i),d&&l.push(s),c?(t=new N2(a,f,u,d),this.compileAndRun(t,l)):(t=new k2(a,f,u,d),this.compileAndRun(t,l))},t.prototype.depthwiseConv2D=function(e,t,n){var r;return AQ().getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new N2(n),this.compileAndRun(r,[e,t])):(r=new k2(n),this.compileAndRun(r,[e,t]))},t.prototype.depthwiseConv2DDerInput=function(e,t,n){var r=new E2(n);return this.compileAndRun(r,[e,t])},t.prototype.depthwiseConv2DDerFilter=function(e,t,n){var r=new _2(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3d=function(e,t,n){var r=new I2(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3dDerInput=function(e,t,n){var r=new M2(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3dDerFilter=function(e,t,n){var r=new C2(n);return this.compileAndRun(r,[e,t])},t.prototype.maxPool=function(e,t){var n=new M3(t,"max",!1);return this.compileAndRun(n,[e])},t.prototype.avgPool=function(e,t){var n=new M3(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.maxPoolBackprop=function(e,t,n,r){var a=new M3(r,"max",!0),i=this.compileAndRun(a,[t]),o=new m3(r),s=this.compileAndRun(o,[e,i],t.dtype);return i.dispose(),s},t.prototype.avgPoolBackprop=function(e,t,n){var r=new r2(n);return this.compileAndRun(r,[e],t.dtype)},t.prototype.cast=function(e,t){return m1(e,t,this)},t.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),a=0,i=0;i<e.rank;i++)i!==t&&(r[a++]=e.shape[i]);var o=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var c=new Array(n);for(i=0;i<c.length;i++)o[t]=i,c[i]=this.slice(e,o,s).reshape(r);return c},t.prototype.avgPool3d=function(e,t){var n=new _3(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.avgPool3dBackprop=function(e,t,n){var r=new a2(n);return this.compileAndRun(r,[e],t.dtype)},t.prototype.maxPool3d=function(e,t){var n=new _3(t,"max",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.maxPool3dBackprop=function(e,t,n,r){var a=new _3(r,"max",!0),i=this.compileAndRun(a,[t]),o=new v3(r),s=this.compileAndRun(o,[e,i],t.dtype);return i.dispose(),s},t.prototype.reshape=function(e,t){var n=this.texData.get(e.dataId);if(n.isPacked&&!qZ(e.shape,t)&&(null===n.texture||!qZ(n.shape,t))){var r=this.packedReshape(e,t);return tZ.makeTensorFromDataId(r.dataId,r.shape,r.dtype)}return v1(e,t)},t.prototype.resizeBilinear=function(e,t,n,r){var a=AQ().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new N3(e.shape,t,n,r):new k3(e.shape,t,n,r);return this.compileAndRun(a,[e],"float32")},t.prototype.resizeBilinearBackprop=function(e,t,n){var r=new I3(e,t,n);return this.compileAndRun(r,[e])},t.prototype.resizeNearestNeighbor=function(e,t,n,r){var a=new A3(e.shape,t,n,r);return this.compileAndRun(a,[e])},t.prototype.resizeNearestNeighborBackprop=function(e,t,n){var r=new L3(e,t,n);return this.compileAndRun(r,[e])},t.prototype.multinomial=function(e,t,n,r){var a=t?e:Q0(e),i=a.shape[0],o=a.shape[1],s=new y3(i,o,n),c=s.getCustomSetupFunc(r);return this.compileAndRun(s,[a],"int32",c)},t.prototype.oneHot=function(e,t,n,r){var a=new x3(e.size,t,n,r);return this.compileAndRun(a,[e])},t.prototype.diag=function(e){var t=new F2(e.size);return this.compileAndRun(t,[e])},t.prototype.nonMaxSuppression=function(e,t,n,r,a){return u$("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),_1(e.dataSync(),t.dataSync(),n,r,a)},t.prototype.cropAndResize=function(e,t,n,r,a,i){var o=new L2(e.shape,t.shape,r,a,i);return this.compileAndRun(o,[e,t,n],"float32")},t.prototype.depthToSpace=function(e,t,n){HQ(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+t}));var r=e.shape[0],a="NHWC"===n?e.shape[1]:e.shape[2],i="NHWC"===n?e.shape[2]:e.shape[3],o="NHWC"===n?e.shape[3]:e.shape[1],s=a*t,c=i*t,u=o/(t*t),l=new P2("NHWC"===n?[r,s,c,u]:[r,u,s,c],t,n);return this.compileAndRun(l,[e])},t.prototype.split=function(e,t,n){return L1(e,t,n)},t.prototype.scatterND=function(e,t,n){var r=U0(0,e,n),a=r.sliceRank,i=r.numUpdates,o=r.sliceSize,s=r.strides,c=r.outputSize,u=[c/o,o],l=e.reshape([i,a]),f=t.reshape([i,o]);if(0===c)return v1(I$([]),n);var d=N$(0),h=new O3(i,a,l.rank,f.rank,s,u);return this.compileAndRun(h,[f,l,d]).reshape(n)},t.prototype.sparseToDense=function(e,t,n,r){var a=U0(0,e,n),i=a.sliceRank,o=a.numUpdates,s=a.strides,c=a.outputSize,u=new O3(o,i,e.rank,t.rank,s,[c,1],!1);return this.compileAndRun(u,[t,e,r]).reshape(n)},t.prototype.fft=function(e){return this.fftImpl(e,!1)},t.prototype.ifft=function(e){return this.fftImpl(e,!0)},t.prototype.fftImpl=function(e,t){var n=this.texData.get(e.dataId),r=new W2("return real * expR - imag * expI;",e.shape,t),a=new W2("return real * expI + imag * expR;",e.shape,t),i=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag)],o=this.compileAndRun(r,i),s=this.compileAndRun(a,i),c=this.complex(o,s).as2D(e.shape[0],e.shape[1]);return o.dispose(),s.dispose(),c},t.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],a=F0(e,t),i=a[0],o=a[1],s=a[2],c=a[3],u=t.reshape([o,r]),l=e.reshape([e.size/s,s]),f=new H2(r,c,[o,s]);return this.compileAndRun(f,[l,u]).reshape(i)},t.prototype.fill=function(e,t,n){if("string"===(n=n||mJ(t))){var r=oJ(n,KQ(e));return r.fill(t),tZ.makeTensor(r,e,n,this)}var a=new G2(e,t),i=a.getCustomSetupFunc(t);return this.compileAndRun(a,[],n,i)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)},t.prototype.linspace=function(e,t,n){return b1(e,t,n)},t.prototype.makeTensorInfo=function(e,t){var n=this.write(null,e,t);return this.texData.get(n).usage=null,{dataId:n,shape:e,dtype:t}},t.prototype.makeOutput=function(e,t){var n=this.makeTensorInfo(e,t).dataId;return tZ.makeTensorFromDataId(n,e,t,this)},t.prototype.unpackTensor=function(e){var t=new w4(e.shape);return this.runWebGLProgram(t,[e],e.dtype)},t.prototype.packTensor=function(e){var t=new w3(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)},t.prototype.packedReshape=function(e,t){var n=[GZ(e.shape)].concat(VZ(e.shape)),r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[GZ(t)].concat(VZ(t)),i=new T3(a,n),o=this.runWebGLProgram(i,[r],e.dtype,null,!0);return{dataId:o.dataId,shape:t,dtype:o.dtype}},t.prototype.decode=function(e){var t,n=this.texData.get(e),r=n.isPacked,a=n.shape,i=n.dtype,o=HZ(a);return t=r?new O2(o):new D2(o),{dtype:i,shape:a,dataId:this.runWebGLProgram(t,[{shape:o,dtype:i,dataId:e}],i,null,!0).dataId}},t.prototype.runWebGLProgram=function(e,t,n,r,a){var i=this;void 0===a&&(a=!1);var o=this.makeTensorInfo(e.outputShape,n),s=this.texData.get(o.dataId);if(e.packedOutput&&(s.isPacked=!0),e.outPackingScheme===aZ.DENSE){var c=dZ(e.outputShape);s.texShape=c.map((function(e){return 2*e}))}if(null!=e.outTexUsage&&(s.usage=e.outTexUsage),0===KQ(o.shape))return s.values=iJ(o.dtype,0),o;var u=[],l=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=i.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&KQ(t.shape)<=AQ().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!=!!e.packedInputs)t=n.isPacked?i.unpackTensor(t):i.packTensor(t),u.push(t),n=i.texData.get(t.dataId);else if(n.isPacked&&!qZ(n.shape,t.shape)){var r=t,a=t.shape;t.shape=n.shape,t=i.packedReshape(t,a),u.push(t),n=i.texData.get(t.dataId),r.shape=a}return i.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(o.dataId);var f,d={shape:o.shape,texData:s,isUniform:!1},h=function(e,t,n){var r="";t.concat(n).forEach((function(e){var t=null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0,n=e.isUniform?"uniform":e.texData.texShape;r+=e.shape+"_"+n+"_"+t}));var a=e.userCode;return e.constructor.name+"_"+r+"_"+a}(e,l,d),p=this.getAndSaveBinary(h,(function(){return function(e,t,n,r){var a=t.userCode,i=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),o=i.map((function(e){return e.shapeInfo})),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},c=V1(i,s,a,t.packedInputs),u=e.createProgram(c),l=null,f=e.getUniformLocation(u,"NAN",!1);1===AQ().getNumber("WEBGL_VERSION")&&(l=e.getUniformLocation(u,"INFINITY",!1));for(var d={},h=0;h<t.variableNames.length;h++){var p=t.variableNames[h];d[p]=e.getUniformLocation(u,p,!1),d["offset"+p]=e.getUniformLocation(u,"offset"+p,!1)}return{program:t,source:c,webGLProgram:u,uniformLocations:d,inShapeInfos:o,outShapeInfo:s,infLoc:l,nanLoc:f}}(i.gpgpu,e,l,d)})),g=null!=this.activeTimers;if(g&&(f=this.startTimer()),function(e,t,n,r,a){f3(t.inShapeInfos,n),f3([t.outShapeInfo],[r]);var i=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(i,o[0],o[1]):e.setOutputMatrixTexture(i,o[0],o[1]),e.setProgram(t.webGLProgram),1===AQ().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach((function(n,r){var a=t.program.variableNames[r],i=t.uniformLocations[a],o=t.uniformLocations["offset"+a];if(null!=i)if(n.isUniform)if(KQ(n.shape)<2)e.gl.uniform1f(i,n.uniformValues[0]);else{var s=n.uniformValues;s instanceof Float32Array||(s=new Float32Array(s)),e.gl.uniform1fv(i,s)}else null!=n.texData.slice&&null!=o&&e.gl.uniform1i(o,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,i,r)})),null!=a&&a(e,t.webGLProgram),e.executeProgram()}(this.gpgpu,p,l,d,r),u.forEach((function(e){return i.disposeData(e.dataId)})),g&&(f=this.endTimer(f),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(f)})),!AQ().getBool("WEBGL_LAZILY_UNPACK")&&s.isPacked&&!1===a){var m=this.unpackTensor(o);return this.disposeData(o.dataId),m}return o},t.prototype.compileAndRun=function(e,t,n,r,a){void 0===a&&(a=!1),n=n||t[0].dtype;var i=this.runWebGLProgram(e,t,n,r,a);return tZ.makeTensorFromDataId(i.dataId,i.shape,i.dtype)},t.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){var e=this;this.disposed||(AQ().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=s$((function(){if(!AQ().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=AQ().getBool("DEBUG");AQ().set("DEBUG",!1);var n=e.abs(N$(1e-8)).dataSync()[0];if(AQ().set("DEBUG",t),n>0)return 32}return 16}))),this.floatPrecisionValue},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.uploadToGPU=function(e){var t,n=this.texData.get(e),r=n.shape,a=n.dtype,i=n.values,o=n.texture,s=n.usage,c=n.isPacked;if(null==o){var u,l=null!=this.activeTimers;l&&(u=MJ());var f=n.texShape;if(null==f&&(f=YZ(r,c),n.texShape=f),null!=i){var d=HZ(r),h=void 0,p=f[1],g=f[0],m=i instanceof Uint8Array;c?(p=(t=hZ(f[0],f[1]))[0],g=t[1],h=new U2(d,[g,p],m)):h=new B2(d,[g,p],m);var v=this.makeTensorInfo([g,p],a);this.texData.get(v.dataId).usage=m?iZ.PIXELS:iZ.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(v.dataId),p,g,i);var b=this.runWebGLProgram(h,[v],a,null,!0),y=this.texData.get(b.dataId);n.texture=y.texture,n.texShape=y.texShape,n.isPacked=y.isPacked,n.usage=y.usage,this.disposeData(v.dataId),this.texData.delete(b.dataId),n.values=null,l&&(this.uploadWaitMs+=MJ()-u)}else{var x=this.acquireTexture(f,s,a,c);n.texture=x}}},t.prototype.convertAndCacheOnCPU=function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype "+t)}(t,r)),n.values},t.prototype.acquireTexture=function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+a+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)},t.prototype.computeBytes=function(e,t){return e[0]*e[1]*fJ(t)},t}($0);nZ()&&tZ.registerBackend("webgl",(function(){return new M4}),2);var _4=M$({square_:function(e){var t=d$(e,"x","square"),n=[t];return tZ.runKernelFunc((function(e,n){return n([t]),e.square(t)}),{x:t},null,"Square",{},n,[])}}),E4="SquaredDifference",T4=M$({squaredDifference_:function(e,t){var n,r=d$(e,"a","squaredDifference"),a=d$(t,"b","squaredDifference");n=KJ(r,a),r=n[0],a=n[1],r1(r.shape,a.shape);var i={a:r,b:a},o=[r,a];return tZ.runKernelFunc((function(e,t){var n=e.squaredDifference(r,a);return t([r,a]),n}),i,(function(e,t){var n=t[0],r=t[1],a=N$(2);return{a:function(){return e.mul(n.sub(r).mul(a))},b:function(){return e.mul(r.sub(n).mul(a))}}}),E4,{},o,[])}}),I4=M$({abs_:function(e){var t=d$(e,"x","abs");return"complex64"===t.dtype?tZ.runKernelFunc((function(e){return e.complexAbs(t)}),{$x:t}):tZ.runKernelFunc((function(e,n){var r=e.abs(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().step(-1))}}}),"Abs")}}),k4=M$({acos_:function(e){var t=d$(e,"x","acos");return tZ.runKernelFunc((function(e,n){var r=e.acos(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(N$(1).sub(n.toFloat().square()).sqrt()).neg()}}}))}}),N4=M$({acosh_:function(e){var t=d$(e,"x","acosh");return tZ.runKernelFunc((function(e,n){var r=e.acosh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(n.toFloat().square().sub(1).sqrt())}}}))}}),L4=M$({asin_:function(e){var t=d$(e,"x","asin");return tZ.runKernelFunc((function(e,n){var r=e.asin(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(N$(1).sub(n.toFloat().square()).sqrt())}}}))}}),A4=M$({asinh_:function(e){var t=d$(e,"x","asinh");return tZ.runKernelFunc((function(e,n){var r=e.asinh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(N$(1).add(n.toFloat().square()).sqrt())}}}))}}),R4=M$({atan_:function(e){var t=d$(e,"x","atan");return tZ.runKernelFunc((function(e,n){var r=e.atan(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().square().add(1))}}}))}}),D4=M$({atanh_:function(e){var t=d$(e,"x","atanh");return tZ.runKernelFunc((function(e,n){var r=e.atanh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(N$(1).sub(n.toFloat().square()))}}}))}}),O4=M$({ceil_:function(e){var t=d$(e,"x","ceil");return tZ.runKernelFunc((function(e){return e.ceil(t)}),{$x:t},(function(e){return{$x:function(){return B$(e)}}}))}}),P4=M$({clipByValue_:function(e,t,n){var r=d$(e,"x","clipByValue");HQ(t<=n,(function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."}));var a=[r],i={min:t,max:n};return tZ.runKernelFunc((function(e,a){var i=e.clip(r,t,n);return a([r]),i}),{x:r},(function(e,r){var a=r[0];return{x:function(){return e.where(a.greaterEqual(t).logicalAnd(a.lessEqual(n)),B$(e))}}}),"ClipByValue",i,a)}}),F4=M$({cos_:function(e){var t=d$(e,"x","cos"),n=[t];return tZ.runKernelFunc((function(e,n){var r=e.cos(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return n.toFloat().sin().neg().mul(e)}}}),"Cos",{},n)}}),z4=M$({cosh_:function(e){var t=d$(e,"x","cosh");return tZ.runKernelFunc((function(e,n){var r=e.cosh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return n.toFloat().sinh().mulStrict(e)}}}))}}),j4=M$({erf_:function(e){var t=d$(e,"x","erf");return HQ("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=t.toFloat()),tZ.runKernelFunc((function(e,n){var r=e.erf(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}}))}}),B4=M$({exp_:function(e){var t=d$(e,"x","exp");return tZ.runKernelFunc((function(e,n){var r=e.exp(t);return n([r]),r}),{x:t},(function(e,t){return{x:function(){return e.mulStrict(t[0])}}}),"Exp",{},[],[!0])}}),U4=M$({expm1_:function(e){var t=d$(e,"x","expm1");return tZ.runKernelFunc((function(e,n){var r=e.expm1(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.exp())}}}))}}),W4=M$({floor_:function(e){var t=d$(e,"x","floor");return tZ.runKernelFunc((function(e){return e.floor(t)}),{$x:t},(function(e){return{$x:function(){return B$(e)}}}))}}),G4=M$({log_:function(e){var t=d$(e,"x","log"),n=[t];return tZ.runKernelFunc((function(e,n){var r=e.log(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.div(n.toFloat())}}}),"Log",{},n)}}),V4=M$({log1p_:function(e){var t=d$(e,"x","log1p");return tZ.runKernelFunc((function(e,n){var r=e.log1p(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.add(1))}}}))}}),H4=M$({logSigmoid_:function(e){var t=d$(e,"x","logSigmoid");return tZ.runKernelFunc((function(e,n){var r=e.softplus(t.neg()).neg();return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.neg().sigmoid())}}}))}}),Y4=M$({neg_:function(e){var t=d$(e,"x","neg"),n=[t];return tZ.runKernelFunc((function(e){return e.neg(t)}),{x:t},(function(e){return{x:function(){return e.neg()}}}),"Neg",{},n)}}),X4=M$({reciprocal_:function(e){var t=d$(e,"x","reciprocal");return tZ.runKernelFunc((function(e,n){var r=e.reciprocal(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.square().neg())}}}))}}),q4=M$({round_:function(e){var t=d$(e,"x","round");return tZ.runKernelFunc((function(e){return e.round(t)}),{$x:t},(function(e){return{$x:function(){return B$(e)}}}))}}),K4=M$({rsqrt_:function(e){var t=d$(e,"x","rsqrt"),n=[t];return tZ.runKernelFunc((function(e,n){var r=e.rsqrt(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.div(n.pow(1.5).mul(2)).neg()}}}),"Rsqrt",{},n)}}),Q4=M$({sigmoid_:function(e){var t=d$(e,"x","sigmoid");return tZ.runKernelFunc((function(e,n){var r=e.sigmoid(t);return n([r]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mul(n.mul(N$(1).sub(n)))}}}),"Sigmoid")}}),J4=M$({sign_:function(e){var t=d$(e,"x","sign");return tZ.runKernelFunc((function(e){return e.sign(t)}),{$x:t},(function(e){return{$x:function(){return B$(e)}}}))}}),Z4=M$({isNaN_:function(e){var t=d$(e,"x","isNaN");return tZ.runKernelFunc((function(e){return e.isNaN(t)}),{$x:t},(function(e){return{$x:function(){return B$(e)}}}))}}),$4=M$({isInf_:function(e){var t=d$(e,"x","isInf");return tZ.runKernelFunc((function(e){return e.isInf(t)}),{$x:t},(function(e){return{$x:function(){return B$(e)}}}))}}),e6=M$({isFinite_:function(e){var t=d$(e,"x","isFinite");return tZ.runKernelFunc((function(e){return e.isFinite(t)}),{$x:t},(function(e){return{$x:function(){return B$(e)}}}))}}),t6=M$({sin_:function(e){var t=d$(e,"x","sin"),n=[t];return tZ.runKernelFunc((function(e,n){var r=e.sin(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return n.toFloat().cos().mul(e)}}}),"Sin",{},n)}}),n6=M$({sinh_:function(e){var t=d$(e,"x","sinh");return tZ.runKernelFunc((function(e,n){var r=e.sinh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return n.toFloat().cosh().mulStrict(e)}}}))}}),r6=M$({softplus_:function(e){var t=d$(e,"x","softplus");return tZ.runKernelFunc((function(e,n){var r=e.softplus(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.sigmoid())}}}))}}),a6=M$({sqrt_:function(e){var t=d$(e,"x","sqrt");return tZ.runKernelFunc((function(e,n){var r=e.sqrt(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().sqrt().mul(2))}}}))}}),i6=M$({step_:function(e,t){void 0===t&&(t=0);var n=d$(e,"x","step");return tZ.runKernelFunc((function(e){return e.step(n,t)}),{$x:n},(function(e){return{$x:function(){return B$(e)}}}))}}),o6=M$({tan_:function(e){var t=d$(e,"x","tan");return tZ.runKernelFunc((function(e,n){var r=e.tan(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.cos().square())}}}))}}),s6=M$({tanh_:function(e){var t=d$(e,"x","tanh");return tZ.runKernelFunc((function(e,n){var r=e.tanh(t);return n([r]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return N$(1).sub(n.square()).mulStrict(e)}}}),"Tanh",{},null,[!0])}});function c6(e,t,n,r,a,i){var o,s,c=d$(e,"x","batchNorm"),u=d$(t,"mean","batchNorm"),l=d$(n,"variance","batchNorm");return null!=a&&(o=d$(a,"scale","batchNorm")),null!=r&&(s=d$(r,"offset","batchNorm")),HQ(2===c.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+c.rank+"."})),HQ(2===u.rank||1===u.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+u.rank+"."})),HQ(2===l.rank||1===l.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."})),null!=o&&HQ(2===o.rank||1===o.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+o.rank+"."})),null!=s&&HQ(2===s.rank||1===s.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."})),f6(c,u,l,s,o,i)}function u6(e,t,n,r,a,i){var o,s,c=d$(e,"x","batchNorm"),u=d$(t,"mean","batchNorm"),l=d$(n,"variance","batchNorm");return null!=a&&(o=d$(a,"scale","batchNorm")),null!=r&&(s=d$(r,"offset","batchNorm")),HQ(3===c.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+c.rank+"."})),HQ(3===u.rank||1===u.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+u.rank+"."})),HQ(3===l.rank||1===l.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."})),null!=o&&HQ(3===o.rank||1===o.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+o.rank+"."})),null!=s&&HQ(3===s.rank||1===s.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."})),f6(c,u,l,s,o,i)}function l6(e,t,n,r,a,i){var o,s,c=d$(e,"x","batchNorm"),u=d$(t,"mean","batchNorm"),l=d$(n,"variance","batchNorm");return null!=a&&(o=d$(a,"scale","batchNorm")),null!=r&&(s=d$(r,"offset","batchNorm")),HQ(4===c.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+c.rank+"."})),HQ(4===u.rank||1===u.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+u.rank+"."})),HQ(4===l.rank||1===l.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."})),null!=o&&HQ(4===o.rank||1===o.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+o.rank+"."})),null!=s&&HQ(4===s.rank||1===s.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."})),f6(c,u,l,s,o,i)}function f6(e,t,n,r,a,i){null==i&&(i=.001);var o,s,c,u=d$(e,"x","batchNorm"),l=d$(t,"mean","batchNorm"),f=d$(n,"variance","batchNorm");null!=a&&(o=d$(a,"scale","batchNorm")),null!=r&&(s=d$(r,"offset","batchNorm")),HQ(l.rank===f.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),HQ(null==s||l.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),HQ(null==o||l.rank===o.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),c=0===u.rank||1===u.rank?u.as4D(1,1,1,u.size):2===u.rank?u.as4D(1,1,u.shape[0],u.shape[1]):3===u.rank?u.as4D(1,u.shape[0],u.shape[1],u.shape[2]):u;var d=[u,l,f,o];return tZ.runKernelFunc((function(e,t){var n=e.batchNormalization(c,d6(l),d6(f),i,d6(o),d6(s));return t([u,l,f,o]),n}),{x:u,mean:l,variance:f,scale:o,offset:s},(function(e,t){var n=t,r=n[0],a=n[1],o=n[2],s=n[3],u=null==s?N$(1):s,l=n1(a.shape,c.shape),f=[];if(1===a.rank){for(var d=0;d<c.shape.length-1;++d)f.push(c.shape[d]);f.push(1)}var h=r.sub(a),p=e.mul(u),g=K4(o.add(N$(i))),m=g.mul(g).mul(g).mul(N$(-.5));return{x:function(){return 1===a.rank?e.mul(k0(g.as4D(1,1,1,a.shape[0]),f)).mul(u).reshape(r.shape):e.mul(g).mul(u).reshape(r.shape)},mean:function(){var e=g.mul(N$(-1)).mul(p);return 1===a.rank&&(e=e.sum(l)),e.reshape(a.shape)},variance:function(){var e=m.mul(h).mul(p);return 1===a.rank&&(e=e.sum(l)),e.reshape(a.shape)},scale:function(){var t=h.mul(g),n=e.mul(t);return 1===a.rank&&(n=n.sum(l)),n.reshape(a.shape)},offset:function(){var t=e;return 1===a.rank&&(t=t.sum(l)),t.reshape(a.shape)}}}),"BatchNormalization",{varianceEpsilon:i},d).reshape(u.shape)}function d6(e){return null==e?null:0===e.rank?e.as1D():1===e.rank?e:2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}function h6(){o$("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var p6=M$({batchNormalization2d_:function(e,t,n,r,a,i){return void 0===r&&(r=.001),h6(),c6(e,t,n,i,a,r)}}),g6=M$({batchNormalization3d_:function(e,t,n,r,a,i){return void 0===r&&(r=.001),h6(),u6(e,t,n,i,a,r)}}),m6=M$({batchNormalization4d_:function(e,t,n,r,a,i){return void 0===r&&(r=.001),h6(),l6(e,t,n,i,a,r)}}),v6=M$({batchNormalization_:function(e,t,n,r,a,i){return void 0===r&&(r=.001),h6(),f6(e,t,n,i,a,r)}}),b6=M$({batchNorm_:f6}),y6=M$({batchNorm2d_:c6}),x6=M$({batchNorm3d_:u6}),w6=M$({batchNorm4d_:l6}),S6=M$({logicalAnd_:function(e,t){var n=d$(e,"a","logicalAnd","bool"),r=d$(t,"b","logicalAnd","bool");return r1(n.shape,r.shape),tZ.runKernelFunc((function(e){return e.logicalAnd(n,r)}),{a:n,b:r},null,"LogicalAnd")}}),C6=M$({logicalNot_:function(e){var t=d$(e,"x","logicalNot","bool");return tZ.runKernelFunc((function(e){return e.logicalNot(t)}),{$x:t})}}),M6=M$({logicalOr_:function(e,t){var n=d$(e,"a","logicalOr","bool"),r=d$(t,"b","logicalOr","bool");return r1(n.shape,r.shape),tZ.runKernelFunc((function(e){return e.logicalOr(n,r)}),{$a:n,$b:r})}}),_6=M$({logicalXor_:function(e,t){var n=d$(e,"a","logicalXor","bool"),r=d$(t,"b","logicalXor","bool");return r1(n.shape,r.shape),M6(e,t).logicalAnd(S6(e,t).logicalNot())}}),E6=M$({where_:function(e,t,n){var r=d$(t,"a","where"),a=d$(n,"b","where"),i=d$(e,"condition","where","bool");return YQ(r.shape,a.shape,"Error in where: "),1===i.rank?HQ(i.shape[0]===r.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})):YQ(i.shape,a.shape,"Error in where: "),tZ.runKernelFunc((function(e,t){var n=e.select(i,r,a);return t([i]),n}),{$condition:i,$a:r,$b:a},(function(e,t){var n=t[0];return{$condition:function(){return B$(n).toFloat()},$a:function(){return e.mul(n.cast(e.dtype))},$b:function(){return e.mul(n.logicalNot().cast(e.dtype))}}}))}}),T6=function(e){return kQ(this,void 0,void 0,(function(){var t,n,r;return NQ(this,(function(a){switch(a.label){case 0:return[4,(t=d$(e,"condition","whereAsync","bool")).data()];case 1:return n=a.sent(),r=D1(t.shape,n),e!==t&&t.dispose(),[2,r]}}))}))},I6=M$({add_:function(e,t){var n,r=d$(e,"a","add"),a=d$(t,"b","add");n=KJ(r,a),r=n[0],a=n[1];var i=r1(r.shape,a.shape);return tZ.runKernelFunc((function(e){return e.add(r,a)}),{a:r,b:a},(function(e){return{a:function(){var t=e,n=n1(r.shape,i);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},b:function(){var t=e,n=n1(a.shape,i);return n.length>0&&(t=t.sum(n)),t.reshape(a.shape)}}}),"Add")}}),k6=M$({addN_:function(e){HQ(Array.isArray(e),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),HQ(e.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length}));var t=e.map((function(e,t){return d$(e,"tensors"+t,"addN")})),n=t[0];t.forEach((function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((function(e){if(!QQ(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var r=t;return tZ.runKernelFunc((function(e){return e.addN(t)}),r,(function(e){var n={};return t.forEach((function(t,r){n[r]=function(){return e.clone()}})),n}),"AddN")}}),N6=M$({addStrict_:function(e,t){var n=d$(e,"a","addStrict"),r=d$(t,"b","addStrict");return YQ(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),L6=M$({atan2_:function(e,t){var n,r=d$(e,"a","atan2"),a=d$(t,"b","atan2");n=KJ(r,a),r=n[0],a=n[1];var i=r1(r.shape,a.shape);return tZ.runKernelFunc((function(e,t){var n=e.atan2(r,a);return t([r,a]),n}),{$a:r,$b:a},(function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=I6(n.square(),r.square()),a=e.mul(r.div(t)),o=n1(n.shape,i);return o.length>0&&(a=a.sum(o)),a.reshape(n.shape)},$b:function(){var t=I6(n.square(),r.square()),a=Y4(e.mul(n.div(t))),o=n1(r.shape,i);return o.length>0&&(a=a.sum(o)),a.reshape(r.shape)}}}))}}),A6=M$({div_:function(e,t){var n,r=d$(e,"a","div"),a=d$(t,"b","div");if(n=KJ(r,a),r=n[0],a=n[1],"int32"===r.dtype&&"int32"===a.dtype)return O6(r,a);var i=r1(r.shape,a.shape);return tZ.runKernelFunc((function(e,t){var n=e.realDivide(r,a);return t([r,a]),n}),{a:r,b:a},(function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.div(r.toFloat()),a=n1(n.shape,i);return a.length>0?t.sum(a).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),a=n1(r.shape,i);a.length>0&&(t=t.sum(a).reshape(r.shape));var o=r.square();return t.div(o.toFloat()).neg()}}}),"Div")}}),R6=M$({divNoNan_:function(e,t){var n,r=d$(e,"a","div"),a=d$(t,"b","div");r=(n=KJ(r,a))[0],a=n[1];var i=A6(r,a),o=B$(i),s=a.equal(o);return E6(s,o,i)}}),D6=M$({divStrict_:function(e,t){var n=d$(e,"a","div"),r=d$(t,"b","div");return YQ(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),O6=M$({floorDiv_:function(e,t){var n,r=d$(e,"a","floorDiv"),a=d$(t,"b","floorDiv");n=KJ(r,a),r=n[0],a=n[1];var i=r1(r.shape,a.shape);return tZ.runKernelFunc((function(e,t){var n=e.floorDiv(r,a);return t([r,a]),n}),{a:r,b:a},(function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.div(r.toFloat()),a=n1(n.shape,i);return a.length>0?t.sum(a).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),a=n1(r.shape,i);a.length>0&&(t=t.sum(a).reshape(r.shape));var o=r.square();return t.div(o.toFloat()).neg()}}}),"FloorDiv")}}),P6=M$({maximum_:function(e,t){var n,r=d$(e,"a","maximum"),a=d$(t,"b","maximum");return n=KJ(r,a),r=n[0],a=n[1],"bool"===r.dtype&&(r=r.toInt(),a=a.toInt()),r1(r.shape,a.shape),tZ.runKernelFunc((function(e,t){var n=e.maximum(r,a);return t([r,a]),n}),{a:r,b:a},(function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.greaterEqual(r).toFloat())},b:function(){return e.mul(n.less(r).toFloat())}}}),"Maximum")}}),F6=M$({maximumStrict_:function(e,t){var n=d$(e,"a","maximumStrict"),r=d$(t,"b","maximumStrict");return YQ(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),z6=M$({minimum_:function(e,t){var n,r=d$(e,"a","minimum"),a=d$(t,"b","minimum");return n=KJ(r,a),r=n[0],a=n[1],"bool"===r.dtype&&(r=r.toInt(),a=a.toInt()),r1(r.shape,a.shape),tZ.runKernelFunc((function(e,t){var n=e.minimum(r,a);return t([r,a]),n}),{a:r,b:a},(function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.lessEqual(r).toFloat())},b:function(){return e.mul(n.greater(r).toFloat())}}}),"Minimum")}}),j6=M$({minimumStrict_:function(e,t){var n=d$(e,"a","minimumStrict"),r=d$(t,"b","minimumStrict");return YQ(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),B6=M$({mod_:function(e,t){var n,r=d$(e,"a","mod"),a=d$(t,"b","mod");n=KJ(r,a),r=n[0],a=n[1];var i=r1(r.shape,a.shape);return tZ.runKernelFunc((function(e,t){var n=e.mod(r,a);return t([r,a]),n}),{$a:r,$b:a},(function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=n1(n.shape,i);return t.length>0?e.sum(t).reshape(n.shape):e},$b:function(){var t=e.mul(n.div(r).floor().neg()),a=n1(r.shape,i);return a.length>0?t.sum(a).reshape(r.shape):t}}}))}}),U6=M$({modStrict_:function(e,t){var n=d$(e,"a","modStrict"),r=d$(t,"b","modStrict");return YQ(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),W6=M$({mul_:function(e,t){var n,r=d$(e,"a","mul"),a=d$(t,"b","mul");n=KJ(r,a),r=n[0],a=n[1];var i=r1(r.shape,a.shape);return tZ.runKernelFunc((function(e,t){var n=e.multiply(r,a);return t([r,a]),n}),{a:r,b:a},(function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.mul(r.toFloat()),a=n1(n.shape,i);return a.length>0?t.sum(a).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),a=n1(r.shape,i);return a.length>0?t.sum(a).reshape(r.shape):t}}}),"Mul")}}),G6=M$({mulStrict_:function(e,t){var n=d$(e,"a","mul"),r=d$(t,"b","mul");return YQ(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),V6=M$({pow_:function(e,t){var n,r=d$(e,"base","pow"),a=d$(t,"exp","pow");n=KJ(r,a),r=n[0],a=n[1];var i=r1(r.shape,a.shape),o=[r,a];return tZ.runKernelFunc((function(e,t){var n=e.pow(r,a);return t([r,a,n]),n}),{a:r,b:a},(function(e,t){var n=t[0],r=t[1],a=t[2];return{a:function(){var t=r.toFloat(),a=e.mul(t.mul(n.pow(t.sub(N$(1))))),o=n1(n.shape,i);return o.length>0&&(a=a.sum(o)),a.reshape(n.shape)},b:function(){var t=n.greater(0),o=n.log().where(t,B$(n)),s=e.mul(a.mul(o)),c=n1(r.shape,i);return c.length>0&&(s=s.sum(c)),s.reshape(r.shape)}}}),"Pow",{},o,[!0])}}),H6=M$({powStrict_:function(e,t){return YQ(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}}),Y6=M$({squaredDifferenceStrict_:function(e,t){var n=d$(e,"a","squaredDifferenceStrict"),r=d$(t,"b","squaredDifferenceStrict");return YQ(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),X6=M$({sub_:function(e,t){var n,r=d$(e,"a","sub"),a=d$(t,"b","sub");n=KJ(r,a),r=n[0],a=n[1];var i=r1(r.shape,a.shape);return tZ.runKernelFunc((function(e){return e.subtract(r,a)}),{a:r,b:a},(function(e){return{a:function(){var t=e,n=n1(r.shape,i);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},b:function(){var t=e,n=n1(a.shape,i);return n.length>0&&(t=t.sum(n)),t.neg().reshape(a.shape)}}}),"Sub")}}),q6=M$({subStrict_:function(e,t){var n=d$(e,"a","subStrict"),r=d$(t,"b","subStrict");return YQ(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),K6=M$({equal_:function(e,t){var n,r=d$(e,"a","equal"),a=d$(t,"b","equal");return n=KJ(r,a),r=n[0],a=n[1],r1(r.shape,a.shape),tZ.runKernelFunc((function(e){return e.equal(r,a)}),{$a:r,$b:a})}}),Q6=M$({equalStrict_:function(e,t){var n=d$(e,"a","equalStrict"),r=d$(t,"b","equalStrict");return YQ(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),J6=M$({greater_:function(e,t){var n,r=d$(e,"a","greater"),a=d$(t,"b","greater");return n=KJ(r,a),r=n[0],a=n[1],r1(r.shape,a.shape),tZ.runKernelFunc((function(e){return e.greater(r,a)}),{a:r,b:a},null,"Greater")}}),Z6=M$({greaterEqual_:function(e,t){var n,r=d$(e,"a","greaterEqual"),a=d$(t,"b","greaterEqual");return n=KJ(r,a),r=n[0],a=n[1],r1(r.shape,a.shape),tZ.runKernelFunc((function(e,t){var n=e.greaterEqual(r,a);return t([r,a]),n}),{a:r,b:a},(function(e,t){var n=t[0],r=t[1];return{a:function(){return B$(n)},b:function(){return B$(r)}}}),"GreaterEqual")}}),$6=M$({greaterEqualStrict_:function(e,t){var n=d$(e,"a","greaterEqualStrict"),r=d$(t,"b","greaterEqualStrict");return YQ(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),e5=M$({greaterStrict_:function(e,t){var n=d$(e,"a","greaterStrict"),r=d$(t,"b","greaterStrict");return YQ(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),t5=M$({less_:function(e,t){var n,r=d$(e,"a","less"),a=d$(t,"b","less");return n=KJ(r,a),r=n[0],a=n[1],r1(r.shape,a.shape),tZ.runKernelFunc((function(e){return e.less(r,a)}),{a:r,b:a},null,"Less")}}),n5=M$({lessEqual_:function(e,t){var n,r=d$(e,"a","lessEqual"),a=d$(t,"b","lessEqual");return n=KJ(r,a),r=n[0],a=n[1],r1(r.shape,a.shape),tZ.runKernelFunc((function(e,t){var n=e.lessEqual(r,a);return t([r,a]),n}),{a:r,b:a},null,"LessEqual")}}),r5=M$({lessEqualStrict_:function(e,t){var n=d$(e,"a","lessEqualStrict"),r=d$(t,"b","lessEqualStrict");return YQ(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),a5=M$({lessStrict_:function(e,t){var n=d$(e,"a","lessStrict"),r=d$(t,"b","lessStrict");return YQ(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),i5=M$({notEqual_:function(e,t){var n,r=d$(e,"a","notEqual"),a=d$(t,"b","notEqual");return n=KJ(r,a),r=n[0],a=n[1],r1(r.shape,a.shape),tZ.runKernelFunc((function(e){return e.notEqual(r,a)}),{a:r,b:a},null,"NotEqual")}}),o5=M$({notEqualStrict_:function(e,t){var n=d$(e,"a","notEqualStrict"),r=d$(t,"b","notEqualStrict");return YQ(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function s5(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function c5(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var u5=M$({gather_:function(e,t,n){void 0===n&&(n=0);var r=d$(e,"x","gather"),a=d$(t,"indices","gather","int32");n=rJ(n,r.shape)[0];var i=function(e,t,n){for(var r=e.shape[n],a=[],i=1,o=1,s=0;s<n;s++)a.push(e.shape[s]),i*=e.shape[s];for(s=0;s<t.rank;s++)a.push(t.shape[s]);for(s=n+1;s<e.rank;s++)a.push(e.shape[s]),o*=e.shape[s];return{batchSize:i,sliceSize:o,dimSize:r,outputShape:a}}(r,a,n);return tZ.runKernelFunc((function(e,t){var i=e.gather(r,a.flatten(),n);return t([a]),i}),{x:r,indices:a},(function(e,t){var a=t[0];return{x:function(){var t=r.shape,i=a.size,o=t.slice(0,n),s=o.length,c=t.slice(n,t.length).slice(1),u=c.length,l=s5(0,s),f=s5(s+1,s+1+u),d=c5([o,[i],c]),h=e.reshape(d),p=a.reshape([i]),g=c5([[s],l,f]),m=h.transpose(g),v=l5(m,p,r.shape[n]),b=x$(g);return v.transpose(b)},indices:function(){return a}}}),"Gather",{axis:n}).reshape(i.outputShape)}}),l5=M$({unsortedSegmentSum_:function(e,t,n){var r=d$(e,"x","unsortedSegmentSum"),a=d$(t,"segmentIds","unsortedSegmentSum","int32");return HQ(JQ(n),(function(){return"numSegments must be of dtype int"})),tZ.runKernelFunc((function(e,t){var i=e.unsortedSegmentSum(r,a,n);return t([a]),i}),{$x:r},(function(e,t){var n=t[0];return{$x:function(){return function(e,t){for(var n=P6(t,B$(t)),r=u5(e,n),a=Z6(t,N$(0,"int32")),i=r.rank-a.rank,o=0;o<i;++o)a=d0(a,o+1);a=S6(a,O$(r.shape,"bool"));var s=B$(r);return E6(a,r,s)}(e,n)}}}))}});function f5(e,t,n,r,a,i,o){void 0===i&&(i="NHWC"),HQ(e.length===t.rank,(function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"}));var s=e,c=t,u=!1;3===t.rank&&(u=!0,c=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),s=[1,e[0],e[1],e[2]]),HQ(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."})),HQ(4===c.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+c.rank})),HQ(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank}));var l="NHWC"===i?s[3]:s[1],f="NHWC"===i?c.shape[3]:c.shape[1];HQ(l===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+n.shape[2]+"."})),HQ(f===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output ("+f+") must match output depth for filter "+n.shape[3]+"."})),null!=o&&HQ(JQ(a),(function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+a+"."}));var d=g1(i),h=o1(s,n.shape,r,1,a,o,!1,d),p=tZ.runKernelFunc((function(e,t){var r=e.conv2dDerInput(c,n,h);return t([n,c]),r}),{dy4D:c,filter:n},(function(e,t){var n=t[0],s=t[1];return{dy4D:function(){return g5(e,n,r,a,i,1,o)},filter:function(){return v5(e,s,n.shape,r,a,i,o)}}}));return u?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function d5(e){var t=function(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}(e),n=t[0],r=t[1],a=t[2];return 1===n&&1===r&&1===a}function h5(e,t,n,r,a){HQ(e.length===t.rank,(function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"}));var i=e,o=t,s=!1;4===t.rank&&(s=!0,o=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),i=[1,e[0],e[1],e[2],e[3]]);var c=i[4],u=o.shape[4];HQ(5===i.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."})),HQ(5===o.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+o.rank})),HQ(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank})),HQ(c===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input ("+c+") must match input depth for filter "+n.shape[3]+"."})),HQ(u===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output ("+u+") must match output depth for filter "+n.shape[4]+"."}));var l=s1(i,n.shape,r,1,a),f=tZ.runKernelFunc((function(e){return e.conv3dDerInput(o,n,l)}),{dy5D:o});return s?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}var p5=M$({conv1d_:function(e,t,n,r,a,i,o){void 0===a&&(a="NWC"),void 0===i&&(i=1);var s=d$(e,"x","conv1d"),c=d$(t,"filter","conv1d"),u=s,l=!1;2===s.rank&&(l=!0,u=s.as3D(1,s.shape[0],s.shape[1])),HQ(3===u.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank "+u.rank+"."})),HQ(3===c.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+c.rank+"."})),null!=o&&HQ(JQ(r),(function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."})),HQ(u.shape[2]===c.shape[1],(function(){return"Error in conv1d: depth of input ("+u.shape[2]+") must match input depth for filter "+c.shape[1]+"."})),HQ(p1(n,i),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+i+"'"})),HQ("NWC"===a,(function(){return"Error in conv1d: got dataFormat of "+a+" but only NWC is currently supported."}));var f=c.as4D(1,c.shape[0],c.shape[1],c.shape[2]),d=u.as4D(u.shape[0],1,u.shape[1],u.shape[2]),h=g5(d,f,[1,n],r,"NHWC",[1,i],o);return l?h.as2D(h.shape[2],h.shape[3]):h.as3D(h.shape[0],h.shape[2],h.shape[3])}}),g5=M$({conv2d_:function(e,t,n,r,a,i,o){void 0===a&&(a="NHWC"),void 0===i&&(i=[1,1]);var s=d$(e,"x","conv2d"),c=d$(t,"filter","conv2d"),u=s,l=!1;3===s.rank&&(l=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),HQ(4===u.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank "+u.rank+"."})),HQ(4===c.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+c.rank+"."})),null!=o&&HQ(JQ(r),(function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}));var f="NHWC"===a?u.shape[3]:u.shape[1];HQ(f===c.shape[2],(function(){return"Error in conv2d: depth of input ("+f+") must match input depth for filter "+c.shape[2]+"."})),HQ(p1(n,i),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}));var d=g1(a),h=o1(u.shape,c.shape,n,i,r,o,!1,d),p=[c,u],g=tZ.runKernelFunc((function(e,t){var n=e.conv2d(u,c,h);return t([c,u]),n}),{x:u,filter:c},(function(e,t){var o=t,s=o[0],c=o[1];return HQ(h1(i),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"})),{x:function(){return b5(c.shape,e,s,n,r,a)},filter:function(){return v5(c,e,s.shape,n,r,a)}}}),"Conv2D",h,p);return l?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}}),m5=M$({conv3d_:function(e,t,n,r,a,i){void 0===a&&(a="NDHWC"),void 0===i&&(i=[1,1,1]);var o=d$(e,"x","conv3d"),s=d$(t,"filter","conv3d"),c=o,u=!1;4===o.rank&&(u=!0,c=o.as5D(1,o.shape[0],o.shape[1],o.shape[2],o.shape[3])),HQ(5===c.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank "+c.rank+"."})),HQ(5===s.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."})),HQ(c.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input ("+c.shape[4]+") must match input depth for filter "+s.shape[3]+"."})),HQ(function(e,t){return d5(e)||d5(t)}(n,i),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"})),HQ("NDHWC"===a,(function(){return"Error in conv3d: got dataFormat of "+a+" but only NDHWC is currently supported."}));var l=s1(c.shape,s.shape,n,i,r),f=tZ.runKernelFunc((function(e,t){var n=e.conv3d(c,s,l);return t([c,s]),n}),{x:c,$filter:s},(function(e,t){HQ(d5(i),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"}));var a=t[0],o=t[1];return{x:function(){return h5(a.shape,e,o,n,r)},$filter:function(){return function(e,t,n,r,a){var i=e;4===e.rank&&(i=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]));var o=t;4===o.rank&&(o=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3])),HQ(5===i.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+i.shape+"."})),HQ(5===o.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+o.shape+"."})),HQ(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."})),HQ(i.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input "+i.shape[4]+") must match input depth in filter ("+n[3]+"."})),HQ(o.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy ("+o.shape[4]+") must match output depth for filter ("+n[4]+")."}));var s=s1(i.shape,n,r,1,a);return tZ.runKernelFunc((function(e){return e.conv3dDerFilter(i,o,s)}),{x5D:i,dy5D:o})}(a,e,o.shape,n,r)}}}));return u?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),v5=M$({conv2dDerFilter_:function(e,t,n,r,a,i,o){void 0===i&&(i="NHWC");var s=e;3===e.rank&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var c=t;3===c.rank&&(c=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),HQ(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."})),HQ(4===c.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+c.shape+"."})),HQ(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."}));var u="NHWC"===i?s.shape[3]:s.shape[1],l="NHWC"===i?c.shape[3]:c.shape[1];HQ(u===n[2],(function(){return"Error in conv2dDerFilter: depth of input "+u+") must match input depth in filter ("+n[2]+"."})),HQ(l===n[3],(function(){return"Error in conv2dDerFilter: depth of dy ("+l+") must match output depth for filter ("+n[3]+")."})),null!=o&&HQ(JQ(a),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+a+"."}));var f=g1(i),d=o1(s.shape,n,r,1,a,o,!1,f);return tZ.runKernelFunc((function(e){return e.conv2dDerFilter(s,c,d)}),{x4D:s,dy4D:c})}}),b5=M$({conv2dDerInput_:f5}),y5=M$({depthwiseConv2d_:function(e,t,n,r,a,i,o){void 0===a&&(a="NHWC"),void 0===i&&(i=[1,1]);var s=d$(e,"x","depthwiseConv2d"),c=d$(t,"filter","depthwiseConv2d"),u=s,l=!1;3===s.rank&&(l=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),HQ(4===u.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+u.rank+"."})),HQ(4===c.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+c.rank+"."})),HQ(u.shape[3]===c.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels ("+u.shape[3]+") must match the inChannels dimension in filter "+c.shape[2]+"."})),null==i&&(i=[1,1]),HQ(p1(n,i),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"})),null!=o&&HQ(JQ(r),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}));var f=o1(u.shape,c.shape,n,i,r,o,!0),d=[u,c],h=tZ.runKernelFunc((function(e,t){var n=e.depthwiseConv2D(u,c,f);return t([u,c]),n}),{x:u,filter:c},(function(e,t){HQ(h1(i),(function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+i+"'"}));var n=t[0],r=t[1];return{x:function(){return x5(n.shape,e,r,f)},filter:function(){return w5(n,e,r.shape,f)}}}),"DepthwiseConv2dNative",f,d);return l?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),x5=M$({depthwiseConv2dDerInput_:function(e,t,n,r){var a=t,i=!1;3===t.rank&&(i=!0,a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var o=tZ.runKernelFunc((function(e){return e.depthwiseConv2DDerInput(a,n,r)}),{dy4D:a});return i?o.as3D(o.shape[1],o.shape[2],o.shape[3]):o}}),w5=M$({depthwiseConv2dDerFilter_:function(e,t,n,r){var a=e;3===e.rank&&(a=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var i=t;return 3===i.rank&&(i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),tZ.runKernelFunc((function(e){return e.depthwiseConv2DDerFilter(a,i,r)}),{x4D:a,dy4D:i})}}),S5=M$({separableConv2d_:function(e,t,n,r,a,i,o){void 0===i&&(i=[1,1]),void 0===o&&(o="NHWC");var s=d$(e,"x","separableConv2d"),c=d$(t,"depthwiseFilter","separableConv2d"),u=d$(n,"pointwiseFilter","separableConv2d"),l=s,f=!1;if(3===s.rank&&(f=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");HQ(4===l.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."})),HQ(4===c.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+c.rank+"."})),HQ(4===u.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+c.rank+"."})),HQ(1===u.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+u.shape[0]+"."})),HQ(1===u.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+u.shape[1]+"."}));var d=c.shape[2],h=c.shape[3];HQ(u.shape[2]===d*h,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+d*h+", but got "+u.shape[2]+"."}));var p=y5(l,c,r,a,o,i),g=g5(p,u,1,"valid",o);return f?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}}),C5=M$({conv2dTranspose_:function(e,t,n,r,a,i){return f5(n,d$(e,"x","conv2dTranspose"),d$(t,"filter","conv2dTranspose"),r,a,"NHWC",i)}}),M5=M$({conv3dTranspose_:function(e,t,n,r,a){return h5(n,d$(e,"x","conv3dTranspose"),d$(t,"filter","conv3dTranspose"),r,a)}}),_5=M$({matMul_:function(e,t,n,r){var a;void 0===n&&(n=!1),void 0===r&&(r=!1);var i=d$(e,"a","matMul"),o=d$(t,"b","matMul");a=KJ(i,o),i=a[0],o=a[1];var s=n?i.shape[i.rank-2]:i.shape[i.rank-1],c=r?o.shape[o.rank-1]:o.shape[o.rank-2],u=n?i.shape[i.rank-1]:i.shape[i.rank-2],l=r?o.shape[o.rank-2]:o.shape[o.rank-1],f=i.shape.slice(0,-2),d=o.shape.slice(0,-2),h=KQ(f),p=KQ(d);HQ(i.rank>=2&&o.rank>=2&&i.rank===o.rank,(function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+i.rank+" and "+o.rank+"."})),HQ(QQ(f,d),(function(){return"Error in matMul: outer dimensions ("+f+") and ("+d+") of Tensors with shapes "+i.shape+" and "+o.shape+" must match."})),HQ(s===c,(function(){return"Error in matMul: inner shapes ("+s+") and ("+c+") of Tensors with shapes "+i.shape+" and "+o.shape+" and transposeA="+n+" and transposeB="+r+" must match."}));var g=i.shape.slice(0,-2).concat([u,l]),m=n?i.as3D(h,s,u):i.as3D(h,u,s),v=r?o.as3D(p,l,c):o.as3D(p,c,l),b={transposeA:n,transposeB:r};return tZ.runKernelFunc((function(e,t){var a=e.batchMatMul(m,v,n,r);return t([m,v]),a}),{a:m,b:v},(function(e,t){var a=t,i=a[0],o=a[1];return n||r?!n&&r?{a:function(){return e.matMul(o,!1,!1)},b:function(){return e.matMul(i,!0,!1)}}:n&&!r?{a:function(){return o.matMul(e,!1,!0)},b:function(){return i.matMul(e,!1,!1)}}:{a:function(){return o.matMul(e,!0,!0)},b:function(){return e.matMul(i,!0,!0)}}:{a:function(){return e.matMul(o,!1,!0)},b:function(){return i.matMul(e,!0,!1)}}}),"BatchMatMul",b).reshape(g)}}),E5=M$({dot_:function(e,t){var n=d$(e,"t1","dot"),r=d$(t,"t2","dot");HQ(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."}));var a=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];return HQ(a===i,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+a+" and "+i+"."})),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),T5=M$({outerProduct_:function(e,t){var n=d$(e,"v1","outerProduct"),r=d$(t,"v2","outerProduct");return HQ(1===n.rank&&1===r.rank,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."})),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),I5=M$({reverse_:function(e,t){var n=d$(e,"x","reverse");if(0===n.rank)return n.clone();var r=rJ(t,n.shape);return tZ.runKernelFunc((function(e){return e.reverse(n,r)}),{$x:n},(function(e){return{$x:function(){return e.reverse(r)}}})).reshapeAs(n)}}),k5=M$({reverse1d_:function(e){var t=d$(e,"x","reverse");return HQ(1===t.rank,(function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."})),I5(t,0)}}),N5=M$({reverse2d_:function(e,t){var n=d$(e,"x","reverse");return HQ(2===n.rank,(function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."})),I5(n,t)}}),L5=M$({reverse3d_:function(e,t){var n=d$(e,"x","reverse");return HQ(3===n.rank,(function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."})),I5(n,t)}}),A5=M$({reverse4d_:function(e,t){var n=d$(e,"x","reverse");return HQ(4===n.rank,(function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."})),I5(n,t)}});function R5(e,t,n,r,a,i){var o=d$(e,"x","maxPool"),s=o,c=!1;3===o.rank&&(c=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),null==r&&(r=[1,1]),HQ(4===s.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."})),HQ(p1(n,r),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"})),null!=i&&HQ(JQ(a),(function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+a+"."}));var u=a1(s.shape,t,n,r,a,i);if(1===u.filterWidth&&1===u.filterHeight&&QQ(u.inShape,u.outShape))return o.clone();var l=[s],f=tZ.runKernelFunc((function(e,t){var n=e.maxPool(s,u);return t([s,n]),n}),{x:s},(function(e,i){var o=i[0],s=i[1];return{x:function(){return function(e,t,n,r,a,i,o,s){var c=d$(e,"dy","maxPoolBackprop"),u=d$(t,"input","maxPoolBackprop"),l=d$(n,"output","maxPoolBackprop");HQ(u.rank===c.rank,(function(){return"Rank of input ("+u.rank+") does not match rank of dy ("+c.rank+")"})),null==i&&(i=[1,1]),HQ(p1(a,i),(function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+i+"'"})),HQ(4===c.rank,(function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+c.rank+"."})),HQ(4===u.rank,(function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+u.rank+"."}));var f=a1(u.shape,r,a,i,o,s);return tZ.runKernelFunc((function(e){return e.maxPoolBackprop(c,u,l,f)}),{$dy:c,$input:u})}(e,o,s,t,n,r,a)}}}),"MaxPool",u,l);return c?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}function D5(e,t,n,r,a,i){var o=d$(e,"x","avgPool","float32");null==r&&(r=[1,1]),HQ(p1(n,r),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}));var s=o,c=!1;3===o.rank&&(c=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),HQ(4===s.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."})),null!=i&&HQ(JQ(a),(function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+a+"."}));var u=a1(s.shape,t,n,r,a,i);if(1===u.filterWidth&&1===u.filterHeight&&QQ(u.inShape,u.outShape))return o.clone();var l=tZ.runKernelFunc((function(e){return e.avgPool(s,u)}),{x:s},(function(e){return{x:function(){return function(e,t,n,r,a,i){var o=d$(e,"dy","avgPoolBackprop"),s=d$(t,"input","avgPoolBackprop");HQ(s.rank===o.rank,(function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+o.rank+")"})),null==a&&(a=[1,1]),HQ(p1(r,a),(function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+a+"'"}));var c=s,u=o,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),u=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),HQ(4===u.rank,(function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."})),HQ(4===c.rank,(function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+c.rank+"."}));var f=a1(c.shape,n,r,a,i),d=tZ.runKernelFunc((function(e){return e.avgPoolBackprop(u,c,f)}),{dy4D:u,input4D:c});return l?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}(e,s,t,n,r,a)}}}),"AvgPool",u);return l=l.cast(o.dtype),c?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var O5=M$({maxPool_:function(e,t,n,r,a){return R5(e,t,n,1,r,a)}}),P5=M$({avgPool_:function(e,t,n,r,a){return D5(e,t,n,1,r,a)}}),F5=M$({pool_:function(e,t,n,r,a,i){null==a&&(a=[1,1]),null==i&&(i=1),0===r&&(r="valid");var o=d$(e,"x","maxPool"),s=o,c=!1;3===o.rank&&(c=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),HQ(p1(i,a),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+a+"'"}));var u,l=a1(s.shape,t,i,a,r),f=[l.dilationHeight,l.dilationWidth];u="same"===r?function(e,t){var n=e.map((function(e,n){return e+(e-1)*(t[n]-1)})).map((function(e){return e-1})),r=n.map((function(e){return Math.floor(e/2)})),a=n.map((function(e,t){return e-r[t]}));return n.map((function(e,t){return[r[t],a[t]]}))}([l.filterHeight,l.filterWidth],f):[[0,0],[0,0]];var d=1===f[0]&&1===f[1],h=function(e,t,n){var r=n.map((function(e){return e[0]})),a=n.map((function(e){return e[1]})),i=e.concat(r,a),o=t.map((function(e,t){return(e-i[t]%e)%e})),s=a.map((function(e,t){return e+o[t]}));return[t.map((function(e,t){return[r[t],s[t]]})),t.map((function(e,t){return[0,o[t]]}))]}([l.inHeight,l.inWidth],f,u),p=h[0],g=h[1],m=d?r:"valid",v=d?s:E0(s,f,p),b=("avg"===n?function(){return D5(v,t,i,1,m)}:function(){return R5(v,t,i,1,m)})(),y=d?b:o0(b,f,g);return c?y.as3D(y.shape[1],y.shape[2],y.shape[3]):y}}),z5=M$({maxPool3d_:function(e,t,n,r,a,i,o){void 0===i&&(i="NDHWC");var s=d$(e,"x","maxPool3d"),c=s,u=!1;4===s.rank&&(u=!0,c=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==o&&(o=[1,1,1]),HQ(5===c.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank "+c.rank+"."})),HQ("NDHWC"===i,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+i})),HQ(p1(n,o),(function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"})),null!=a&&HQ(JQ(r),(function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}));var l=i1(c.shape,t,n,o,r,a,i),f=tZ.runKernelFunc((function(e,t){var n=e.maxPool3d(c,l);return t([c,n]),n}),{x:c},(function(e,i){var s=i[0],c=i[1];return{x:function(){return function(e,t,n,r,a,i,o,s){var c=d$(e,"dy","maxPool3dBackprop"),u=d$(t,"input","maxPool3dBackprop"),l=d$(n,"output","maxPool3dBackprop"),f=c,d=u,h=l,p=!1;4===u.rank&&(p=!0,f=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]),d=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]),h=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3])),HQ(5===f.rank,(function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+f.rank+"."})),HQ(5===d.rank,(function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+d.rank+"."})),HQ(5===h.rank,(function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+h.rank+"."})),null==i&&(i=[1,1,1]),HQ(p1(a,i),(function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+i+"'"})),null!=s&&HQ(JQ(o),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+o+"."}));var g=i1(d.shape,r,a,i,o,s),m=tZ.runKernelFunc((function(e){return e.maxPool3dBackprop(f,d,h,g)}),{dy5D:f,input5D:d});return p?m.as4D(m.shape[1],m.shape[2],m.shape[3],m.shape[4]):m}(e,s,c,t,n,o,r,a)}}}));return u?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),j5=M$({avgPool3d_:function(e,t,n,r,a,i,o){void 0===i&&(i="NDHWC");var s=d$(e,"x","avgPool3d","float32"),c=s,u=!1;4===s.rank&&(u=!0,c=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==o&&(o=[1,1,1]),HQ(5===c.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank "+c.rank+"."})),HQ("NDHWC"===i,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+i})),HQ(p1(n,o),(function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"})),null!=a&&HQ(JQ(r),(function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}));var l=i1(c.shape,t,n,o,r,a,i),f=tZ.runKernelFunc((function(e){return e.avgPool3d(c,l)}),{x:c},(function(e){return{x:function(){return function(e,t,n,r,a,i,o){var s=d$(e,"dy","avgPool3dBackprop"),c=d$(t,"input","avgPool3dBackprop"),u=s,l=c,f=!1;4===c.rank&&(f=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]),l=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3])),HQ(5===u.rank,(function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+u.rank+"."})),HQ(5===l.rank,(function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+l.rank+"."})),null==a&&(a=[1,1,1]),HQ(p1(r,a),(function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+a+"'"})),null!=o&&HQ(JQ(i),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."}));var d=i1(l.shape,n,r,a,i,o),h=tZ.runKernelFunc((function(e){return e.avgPool3dBackprop(u,l,d)}),{dy5D:u,input5D:l});return f?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}(e,c,t,n,o,r,a)}}}));return f=f.cast(c.dtype),u?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),B5=M$({slice_:function(e,t,n){var r,a,i=d$(e,"x","slice");if(0===i.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof t?[t].concat(new Array(i.rank-1).fill(0)):t.length<i.rank?t.concat(new Array(i.rank-t.length).fill(0)):t.slice()).forEach((function(e){HQ(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),a=(a=null==n?new Array(i.rank).fill(-1):"number"==typeof n?[n].concat(new Array(i.rank-1).fill(-1)):n.length<i.rank?n.concat(new Array(i.rank-n.length).fill(-1)):n).map((function(e,t){return e>=0?e:(HQ(-1===e,(function(){return"Negative size values should be exactly -1 but got "+e+" for the slice() size at index "+t+"."})),i.shape[t]-r[t])})),W0(i,r,a);var o=i.shape,s={begin:r,size:a};return tZ.runKernelFunc((function(e){return e.slice(i,r,a)}),{x:i},(function(e){for(var t=[],n=0;n<e.rank;n++)t.push([r[n],o[n]-r[n]-a[n]]);return{x:function(){return e.pad(t)}}}),"Slice",s)}}),U5=M$({slice1d_:function(e,t,n){var r=d$(e,"x","slice1d");return HQ(1===r.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"})),B5(r,[t],[n])}}),W5=M$({slice2d_:function(e,t,n){var r=d$(e,"x","slice2d");return HQ(2===r.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"})),B5(r,t,n)}}),G5=M$({slice3d_:function(e,t,n){var r=d$(e,"x","slice3d");return HQ(3===r.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"})),B5(r,t,n)}}),V5=M$({slice4d_:function(e,t,n){var r=d$(e,"x","slice4d");return HQ(4===r.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"})),B5(r,t,n)}});function H5(e,t,n,r,a){return t.rank<n.rank&&(t=t.reshape(v$(t.shape,r))),e.rank<n.rank&&(e=e.reshape(v$(e.shape,r))),{x:function(){var r=e.mul(n.equal(t).cast(e.dtype));return null==a?r:r.transpose(a)}}}var Y5=M$({all_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=d$(e,"x","all","bool"),a=rJ(t,r.shape),i=a,o=y$(i,r.rank);null!=o&&(r=r.transpose(o),i=w$(i.length,r.rank));var s=tZ.runKernelFunc((function(e){return e.all(r,i)}),{$x:r});if(n){var c=v$(s.shape,a);return s.reshape(c)}return s}}),X5=M$({any_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=d$(e,"x","any","bool"),a=rJ(t,r.shape),i=a,o=y$(i,r.rank);null!=o&&(r=r.transpose(o),i=w$(i.length,r.rank));var s=tZ.runKernelFunc((function(e){return e.any(r,i)}),{$x:r});if(n){var c=v$(s.shape,a);return s.reshape(c)}return s}}),q5=M$({argMax_:function(e,t){void 0===t&&(t=0);var n=d$(e,"x","argMax");null==t&&(t=0);var r=rJ(t,n.shape),a=y$(r,n.rank);null!=a&&(n=n.transpose(a),r=w$(r.length,n.rank));var i={axis:r[0]},o=[n];return tZ.runKernelFunc((function(e,t){var a=e.argMax(n,r[0]);return t([n]),a}),{x:n},(function(e,t){var n=t[0];return{x:function(){return B$(n)}}}),"ArgMax",i,o)}}),K5=M$({argMin_:function(e,t){void 0===t&&(t=0);var n=d$(e,"x","argMin");null==t&&(t=0);var r=rJ(t,n.shape),a=y$(r,n.rank);return null!=a&&(n=n.transpose(a),r=w$(r.length,n.rank)),tZ.runKernelFunc((function(e,t){var a=e.argMin(n,r[0]);return t([n]),a}),{$x:n},(function(e,t){var n=t[0];return{$x:function(){return B$(n)}}}))}}),Q5=M$({logSumExp_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=d$(e,"x","logSumExp"),a=rJ(t,r.shape),i=r.max(a,!0),o=r.sub(i).exp().sum(a).log(),s=i.reshape(o.shape).add(o);if(n){var c=v$(s.shape,a);return s.reshape(c)}return s}}),J5=M$({max_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=d$(e,"x","max"),a=r,i=rJ(t,r.shape),o=i,s=y$(o,r.rank);null!=s&&(r=r.transpose(s),o=w$(o.length,r.rank));var c=[r],u=tZ.runKernelFunc((function(e,t){var n=e.max(r,o);return t([a,n]),n}),{x:r},(function(e,t){return H5(e,t[1],t[0],i,s)}),"Max",{axes:o},c,[!0]);if(n){var l=v$(u.shape,i);u=u.reshape(l)}return u}}),Z5=M$({mean_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=d$(e,"x","mean"),a=rJ(t,r.shape),i=KQ(m$(r.shape,a)[1]);return K0((function(e){var r=N$(i);return{value:(r.dtype===e.dtype?e:e.cast(r.dtype)).div(r).sum(t,n),gradFunc:function(t){var n=e.shape.slice();return a.forEach((function(e){n[e]=1})),t.reshape(n).mul(O$(e.shape,"float32")).div(i)}}}))(r)}}),$5=M$({min_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=d$(e,"x","min"),a=r,i=rJ(t,r.shape),o=i,s=y$(o,r.rank);null!=s&&(r=r.transpose(s),o=w$(o.length,r.rank));var c=[r],u=tZ.runKernelFunc((function(e,t){var n=e.min(r,o);return t([a,n]),n}),{x:r},(function(e,t){return H5(e,t[1],t[0],i,s)}),"Min",{axes:o},c,[!0]);if(n){var l=v$(u.shape,i);u=u.reshape(l)}return u}}),e9=M$({moments_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=rJ(t,(e=d$(e,"x","moments")).shape),a=e.mean(r,n),i=a.shape;n||(i=v$(a.shape,r));var o=e.toFloat().sub(a.reshape(i)).square();return{mean:a,variance:o.mean(r,n)}}}),t9=M$({sum_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=d$(e,"x","sum");"bool"===r.dtype&&(r=r.toInt());var a=rJ(t,r.shape);return K0((function(e){var t=y$(a,e.rank),r=a,i=e;null!=t&&(i=e.transpose(t),r=w$(r.length,e.rank));var o=function(t){var n=e.shape.slice();return a.forEach((function(e){n[e]=1})),t.reshape(n).mul(O$(e.shape,"float32"))},s={axes:r},c=tZ.runKernelFunc((function(e){return e.sum(i,r)}),{x:i},(function(e){return{x:function(){return o(e)}}}),"Sum",s);if(n){var u=v$(c.shape,a);c=c.reshape(u)}return{value:c,gradFunc:o}}))(r)}}),n9=M$({prod_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=d$(e,"x","prod");"bool"===r.dtype&&(r=r.toInt());var a=rJ(t,r.shape),i=y$(a,r.rank),o=a,s=r;null!=i&&(s=r.transpose(i),o=w$(o.length,r.rank));var c=tZ.runKernelFunc((function(e){return e.prod(s,o)}),{permutedX:s});if(n){var u=v$(c.shape,a);c=c.reshape(u)}return c}}),r9=M$({elu_:function(e){var t=d$(e,"x","elu");return tZ.runKernelFunc((function(e,n){var r=e.elu(t);return n([r]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return tZ.runKernelFunc((function(t){return t.eluDer(e,n)}),{dy:e,y:n})}}}))}}),a9=M$({leakyRelu_:function(e,t){void 0===t&&(t=.2);var n=d$(e,"x","leakyRelu");return P6(N$(t).mul(n),n)}}),i9=M$({prelu_:function(e,t){var n=d$(e,"x","prelu"),r=d$(t,"alpha","prelu");return tZ.runKernelFunc((function(e,t){var a=e.prelu(n,r);return t([n,r]),a}),{x:n,alpha:r},(function(e,t){var n=t[0],r=t[1],a=n.greater(0);return{x:function(){return E6(a,e,e.mul(r))},alpha:function(){var t=E6(a,B$(e),e.mul(n)),i=n1(r.shape,e.shape);return i.length>0&&(t=t.sum(i)),t.reshape(r.shape)}}}),"Prelu")}}),o9=M$({relu_:function(e){var t=d$(e,"x","relu");return"bool"===t.dtype?t.toInt():tZ.runKernelFunc((function(e,n){var r=e.relu(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mulStrict(n.step().toFloat())}}}),"Relu")}}),s9=M$({relu6_:function(e){var t=d$(e,"x","relu6");return"bool"===t.dtype?t.toInt():tZ.runKernelFunc((function(e,n){var r=e.relu6(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0],r=n.lessEqual(6).mul(n.step());return{x:function(){return e.mulStrict(r.toFloat())}}}),"Relu6")}}),c9=M$({selu_:function(e){var t=d$(e,"x","selu");return tZ.runKernelFunc((function(e,n){var r=e.selu(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){var t=n.greater(N$(0)),r=N$(q3),a=N$(K3),i=e.mul(a),o=e.mul(r).mul(n.toFloat().exp());return E6(t,i,o)}}}))}}),u9=M$({transpose_:function(e,t){var n=d$(e,"x","transpose");if(null==t&&(t=n.shape.map((function(e,t){return t})).reverse()),HQ(n.rank===t.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+t+"."})),t.forEach((function(e){HQ(e>=0&&e<n.rank,(function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t}))})),n.rank<=1)return n.clone();var r={perm:t};return tZ.runKernelFunc((function(e){return e.transpose(n,t)}),{x:n},(function(e){var n=x$(t);return{x:function(){return e.transpose(n)}}}),"Transpose",r)}}),l9=M$({localResponseNormalization_:function(e,t,n,r,a){void 0===t&&(t=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===a&&(a=.5);var i=d$(e,"x","localResponseNormalization");HQ(4===i.rank||3===i.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+i.rank+"."})),HQ(JQ(t),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."}));var o=i,s=!1;3===i.rank&&(s=!0,o=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]));var c=tZ.runKernelFunc((function(e,i){var s=e.localResponseNormalization4D(o,t,n,r,a);return i([o,s]),s}),{x4D:o},(function(e,i){var o=i[0],s=i[1];return{x4D:function(){return tZ.runKernelFunc((function(i){return i.LRNGrad(e,o,s,t,n,r,a)}),{})}}}));return s?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),f9=M$({norm_:function(e,t,n,r){void 0===t&&(t="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var a=function e(t,n,r){if(void 0===r&&(r=null),0===t.rank)return t.abs();if(1!==t.rank&&null===r)return e(t.reshape([-1]),n,r);if(1===t.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return t.abs().sum(r);if(n===1/0)return t.abs().max(r);if(n===-1/0)return t.abs().min(r);if("euclidean"===n||2===n)return t.abs().pow(N$(2,"int32")).sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return t.abs().sum(r[0]).max(r[1]-1);if(n===1/0)return t.abs().sum(r[1]).max(r[0]);if(n===-1/0)return t.abs().sum(r[1]).min(r[0]);if("fro"===n||"euclidean"===n)return t.square().sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(e=d$(e,"x","norm"),t,n),i=a.shape;if(r){var o=rJ(n,e.shape);i=v$(a.shape,o)}return a.reshape(i)}}),d9=M$({basicLSTMCell_:function(e,t,n,r,a,i){var o=d$(e,"forgetBias","basicLSTMCell"),s=d$(t,"lstmKernel","basicLSTMCell"),c=d$(n,"lstmBias","basicLSTMCell"),u=d$(r,"data","basicLSTMCell"),l=d$(a,"c","basicLSTMCell"),f=d$(i,"h","basicLSTMCell"),d=u.concat(f,1).matMul(s).add(c),h=d.shape[0],p=d.shape[1]/4,g=[h,p],m=d.slice([0,0],g),v=d.slice([0,p],g),b=d.slice([0,2*p],g),y=d.slice([0,3*p],g),x=m.sigmoid().mulStrict(v.tanh()).addStrict(l.mulStrict(o.add(b).sigmoid())),w=x.tanh().mulStrict(y.sigmoid());return[x,w]}}),h9=M$({multiRNNCell_:function(e,t,n,r){for(var a=d$(t,"data","multiRNNCell"),i=h$(n,"c","multiRNNCell"),o=h$(r,"h","multiRNNCell"),s=a,c=[],u=0;u<e.length;u++){var l=e[u](s,i[u],o[u]);c.push(l[0]),c.push(l[1]),s=l[1]}var f=[],d=[];for(u=0;u<c.length;u+=2)f.push(c[u]),d.push(c[u+1]);return[f,d]}}),p9=M$({movingAverage_:function(e,t,n,r,a){void 0===a&&(a=!0);var i=d$(e,"v","movingAverage"),o=d$(t,"x","movingAverage"),s=d$(n,"decay","movingAverage");QJ(i,o),HQ(QQ(i.shape,o.shape),(function(){return"Shape mismatch in v and x"}));var c=N$(1),u=c.sub(s),l=o.sub(i).mul(u);if(a){HQ(null!=r,(function(){return"When using zeroDebias: true, step is required."}));var f=d$(r,"step","movingAverage");l=l.div(c.sub(V6(s,f)))}return i.add(l)}}),g9=M$({stridedSlice_:function(e,t,n,r,a,i,o,s,c){if(void 0===a&&(a=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===c&&(c=0),null==r&&(r=new Array(t.length)),0!==o)throw new Error("ellipsis mask is not yet supported");var u=d$(e,"x","stridedSlice"),l=G0(s),f=u.shape.slice();l.forEach((function(e){t[e]=0,n[e]=1,f.splice(e,0,1)})),u=u.reshape(f);for(var d=0;d<u.rank;d++)t[d]=H0(a,t,r,u.shape,d),n[d]=Y0(i,n,r,u.shape,d),r[d]=r[d]||1;var h=G0(c);h.forEach((function(e){n[e]=t[e]+1,r[e]=1}));var p=V0(t,n,r),g=p.filter((function(e,t){return-1===h.indexOf(t)}));return r.every((function(e){return 1===e}))?B5(u,t,p).reshape(g):tZ.runKernelFunc((function(e){return e.stridedSlice(u,t,n,r)}),{$x:u}).reshape(g)}}),m9=M$({topk_:function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=!0);var r=d$(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(t>a)throw new Error("'k' passed to topk() must be <= the last dimension ("+a+") but got "+t);var i=tZ.runKernelFunc((function(e){return e.topk(r,t,n)}),{$x:r});return{values:i[0],indices:i[1]}}}),v9=M$({scatterND_:function(e,t,n){var r=d$(e,"indices","scatterND","int32"),a=d$(t,"updates","scatterND");return B0(a,r,n),tZ.runKernelFunc((function(e){return e.scatterND(r,a,n)}),{indices:r,updates:a},null,"ScatterNd",{shape:n})}}),b9=M$({fft_:function(e){HQ("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+"."}));var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return tZ.runKernelFunc((function(e){return e.fft(r)}),{input:e}).reshape(e.shape)}}),y9=M$({ifft_:function(e){HQ("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+"."}));var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return tZ.runKernelFunc((function(e){return e.ifft(r)}),{input:e}).reshape(e.shape)}}),x9=M$({rfft_:function(e,t){HQ("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got "+e.dtype}));var n,r=e.shape[e.shape.length-1],a=e.size/r;if(null!=t&&t<r){var i=e.shape.map((function(e){return 0})),o=e.shape.map((function(e){return e}));o[e.shape.length-1]=t,n=e.slice(i,o),r=t}else if(null!=t&&t>r){var s=e.shape.map((function(e){return e}));s[e.shape.length-1]=t-r,n=e.concat(P$(s),e.shape.length-1),r=t}else n=e;var c=n.zerosLike(),u=_$(n,c).as2D(a,r),l=b9(u),f=Math.floor(r/2)+1,d=E$(l),h=T$(l),p=d.split([f,r-f],d.shape.length-1),g=h.split([f,r-f],h.shape.length-1),m=n.shape.slice();return m[n.shape.length-1]=f,_$(p[0],g[0]).reshape(m)}}),w9=M$({irfft_:function(e){var t=e.shape[e.shape.length-1],n=e.size/t;if(t<=2){var r=e.as2D(n,t),a=y9(r);return E$(a)}var i=[n,2*(t-1)],o=E$(e).as2D(n,t),s=T$(e).as2D(n,t),c=o.slice([0,1],[n,t-2]).reverse(1),u=s.slice([0,1],[n,t-2]).reverse(1).mul(N$(-1)),l=o.concat(c,1),f=s.concat(u,1);return r=_$(l,f).as2D(i[0],i[1]),a=y9(r),E$(a)}}),S9=Object.freeze({fft:b9,ifft:y9,rfft:x9,irfft:w9}),C9=M$({sparseToDense_:function(e,t,n,r){void 0===r&&(r=0);var a=d$(e,"sparseIndices","sparseToDense","int32"),i=d$(t,"sparseValues","sparseToDense"),o=d$(r,"defaultValue","sparseToDense",i.dtype);return function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+e.shape+".");var a=e.rank>0?e.shape[0]:1,i=e.rank>1?e.shape[1]:1;if(n.length!==i)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+i+".");var o=t.size;if(0!==t.rank&&(1!==t.rank||o!==a))throw new Error("sparseValues has incorrect shape "+t.shape+", should be [] or ["+a+"]");if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(a,i,n,o),tZ.runKernelFunc((function(e){return e.sparseToDense(a,i,n,o)}),{$sparseIndices:a,$sparseValues:i,$defaultValue:o})}}),M9=M$({gatherND_:function(e,t){var n=d$(t,"indices","gatherND","int32"),r=d$(e,"x","gatherND");return tZ.runKernelFunc((function(e){return e.gatherND(r,n)}),{x:r,indices:n},null,"GatherNd")}}),_9=M$({diag_:function(e){var t=d$(e,"x","diag").flatten(),n=e.shape.concat(e.shape);return tZ.runKernelFunc((function(e){return e.diag(t)}),{$x:t}).reshape(n)}}),E9=M$({dropout_:function(e,t,n,r){var a=d$(e,"x","dropout");if(HQ("float32"===a.dtype,(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+a.dtype+" tensor instead."})),HQ(t>=0&&t<1,(function(){return"rate must be a float in the range [0, 1), but got "+t+"."})),0===t)return e instanceof jJ?a.clone():a;var i=function(e,t){if(null==t)return e.shape.slice();if(QQ(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(a,n),o=1-t,s=M0(i,0,1,"float32",r).add(o).floor().div(o);return a.mul(s)}});function T9(e,t,n){for(var r=1-e%2,a=new Float32Array(e),i=0;i<e;++i){var o=2*Math.PI*i/(e+r-1);a[i]=t-n*Math.cos(o)}return L$(a,"float32")}var I9,k9=M$({hannWindow_:function(e){return T9(e,.5,.5)}}),N9=M$({hammingWindow_:function(e){return T9(e,.54,.46)}}),L9=M$({frame_:function(e,t,n,r,a){void 0===r&&(r=!1),void 0===a&&(a=0);for(var i=0,o=[];i+t<=e.size;)o.push(B5(e,i,t)),i+=n;if(r)for(;i<e.size;){var s=i+t-e.size,c=U$([B5(e,i,t-s),F$([s],a)]);o.push(c),i+=n}return 0===o.length?A$([],[0,t]):U$(o).as2D(o.length,t)}}),A9=M$({stft_:function(e,t,n,r,a){var i;void 0===a&&(a=k9),null==r&&(i=t,r=Math.floor(Math.pow(2,Math.ceil(Math.log(i)/Math.log(2)))));for(var o=L9(e,t,n),s=W6(o,a(t)),c=[],u=0;u<o.shape[0];u++)c.push(x9(s.slice([u,0],[1,t]),r));return U$(c)}}),R9=Object.freeze({hannWindow:k9,hammingWindow:N9,frame:L9,stft:A9});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(I9||(I9={}));var D9=M$({absoluteDifference_:function(e,t,n,r){void 0===r&&(r=I9.SUM_BY_NONZERO_WEIGHTS);var a=d$(e,"labels","absoluteDifference"),i=d$(t,"predictions","absoluteDifference"),o=null;null!=n&&(o=d$(n,"weights","absoluteDifference")),YQ(a.shape,i.shape,"Error in absoluteDifference: ");var s=a.sub(i).abs();return O9(s,o,r)}}),O9=M$({computeWeightedLoss_:function(e,t,n){void 0===n&&(n=I9.SUM_BY_NONZERO_WEIGHTS);var r=d$(e,"losses","computeWeightedLoss"),a=null;null!=t&&(a=d$(t,"weights","computeWeightedLoss"));var i=null==a?r:r.mul(a);if(n===I9.NONE)return i;if(n===I9.SUM)return i.sum();if(n===I9.MEAN){if(null==a)return i.mean();var o=r.size/a.size,s=i.sum().div(a.sum());return o>1?s.div(N$(o)):s}if(n===I9.SUM_BY_NONZERO_WEIGHTS){if(null==a)return i.sum().div(N$(r.size));var c=a.mul(O$(r.shape)).notEqual(N$(0)).sum().toFloat();return i.sum().div(c)}throw Error("Unknown reduction: "+n)}}),P9=M$({cosineDistance_:function(e,t,n,r,a){void 0===a&&(a=I9.SUM_BY_NONZERO_WEIGHTS);var i=d$(e,"labels","cosineDistance"),o=d$(t,"predictions","cosineDistance"),s=null;null!=r&&(s=d$(r,"weights","cosineDistance")),YQ(i.shape,o.shape,"Error in cosineDistance: ");var c=N$(1).sub(i.mul(o).sum(n,!0));return O9(c,s,a)}}),F9=M$({hingeLoss_:function(e,t,n,r){void 0===r&&(r=I9.SUM_BY_NONZERO_WEIGHTS);var a=d$(e,"labels","hingeLoss"),i=d$(t,"predictions","hingeLoss"),o=null;null!=n&&(o=d$(n,"weights","hingeLoss")),YQ(a.shape,i.shape,"Error in hingeLoss: ");var s=N$(1);a=N$(2).mul(a).sub(s);var c=s.sub(a.mul(i)).relu();return O9(c,o,r)}}),z9=M$({huberLoss_:function(e,t,n,r,a){void 0===r&&(r=1),void 0===a&&(a=I9.SUM_BY_NONZERO_WEIGHTS);var i=d$(e,"labels","huberLoss"),o=d$(t,"predictions","huberLoss"),s=null;null!=n&&(s=d$(n,"weights","huberLoss")),YQ(i.shape,o.shape,"Error in huberLoss: ");var c=N$(r),u=o.sub(i).abs(),l=z6(u,c),f=u.sub(l),d=N$(.5).mul(l.square()).add(c.mul(f));return O9(d,s,a)}}),j9=M$({logLoss_:function(e,t,n,r,a){void 0===r&&(r=1e-7),void 0===a&&(a=I9.SUM_BY_NONZERO_WEIGHTS);var i=d$(e,"labels","logLoss"),o=d$(t,"predictions","logLoss"),s=null;null!=n&&(s=d$(n,"weights","logLoss")),YQ(i.shape,o.shape,"Error in logLoss: ");var c=N$(1),u=N$(r),l=i.mul(o.add(u).log()).neg().sub(c.sub(i).mul(c.sub(o).add(u).log()));return O9(l,s,a)}}),B9=M$({meanSquaredError_:function(e,t,n,r){void 0===r&&(r=I9.SUM_BY_NONZERO_WEIGHTS);var a=d$(e,"labels","meanSquaredError"),i=d$(t,"predictions","meanSquaredError"),o=null;null!=n&&(o=d$(n,"weights","meanSquaredError")),YQ(a.shape,i.shape,"Error in meanSquaredError: ");var s=a.squaredDifference(i);return O9(s,o,r)}}),U9=M$({sigmoidCrossEntropy_:function(e,t,n,r,a){void 0===r&&(r=0),void 0===a&&(a=I9.SUM_BY_NONZERO_WEIGHTS);var i=d$(e,"multiClassLabels","sigmoidCrossEntropy"),o=d$(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=d$(n,"weights","sigmoidCrossEntropy")),YQ(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var c=N$(r),u=N$(1),l=N$(.5);i=i.mul(u.sub(c)).add(l.mul(c))}var f=function(e,t){var n=d$(e,"labels","sigmoidCrossEntropyWithLogits"),r=d$(t,"logits","sigmoidCrossEntropyWithLogits");YQ(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=r.relu(),i=r.mul(n),o=r.abs().neg().exp().log1p();return a.sub(i).add(o)}(i,o);return O9(f,s,a)}}),W9=M$({softmaxCrossEntropy_:function(e,t,n,r,a){void 0===r&&(r=0),void 0===a&&(a=I9.SUM_BY_NONZERO_WEIGHTS);var i=d$(e,"onehotLabels","softmaxCrossEntropy"),o=d$(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=d$(n,"weights","softmaxCrossEntropy")),YQ(i.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var c=N$(r),u=N$(1),l=N$(i.shape[1]);i=i.mul(u.sub(c)).add(c.div(l))}var f=function(e,t,n){if(void 0===n&&(n=-1),-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+t.rank+" and dim was "+n);return K0((function(e,t,r){var a=t.logSumExp([n],!0),i=t.toFloat().sub(a);return r([e,i]),{value:i.mul(e).neg().sum([n]),gradFunc:function(e,t){var r=t[0],a=t[1],i=v$(e.shape,[n]);return[e.reshape(i).mul(r.toFloat().sub(a.exp())),e.reshape(i).mul(a.exp().sub(r.toFloat()))]}}}))(e,t)}(i,o);return O9(f,s,a)}}),G9=Object.freeze({get Reduction(){return I9},absoluteDifference:D9,computeWeightedLoss:O9,cosineDistance:P9,hingeLoss:F9,huberLoss:z9,logLoss:j9,meanSquaredError:B9,sigmoidCrossEntropy:U9,softmaxCrossEntropy:W9});function V9(e,t){return void 0===t&&(t=!1),tZ.tidy((function(){if(2!==e.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var n=e.shape[0],r=e.shape[1],a=h0(n),i=e.clone(),o=A$([[1]],[1,1]),s=o.clone(),c=n>=r?r:n,u=function(e){var t,c=i,u=s,l=a;t=tZ.tidy((function(){var t=i.slice([e,e],[n-e,1]),c=t.norm(),u=i.slice([e,e],[1,1]),l=A$([[-1]]).where(u.greater(0),A$([[1]])),f=u.sub(l.mul(c)),d=t.div(f);s=1===d.shape[0]?o.clone():o.concat(d.slice([1,0],[d.shape[0]-1,d.shape[1]]),0);var h=l.matMul(f).div(c).neg(),p=i.slice([e,0],[n-e,r]),g=h.mul(s);if(0===e)i=p.sub(g.matMul(s.transpose().matMul(p)));else{var m=p.sub(g.matMul(s.transpose().matMul(p)));i=i.slice([0,0],[e,r]).concat(m,0)}var v=a.slice([0,e],[n,a.shape[1]-e]);if(0===e)a=v.sub(v.matMul(s).matMul(g.transpose()));else{var b=v.sub(v.matMul(s).matMul(g.transpose()));a=a.slice([0,0],[n,e]).concat(b,1)}return[s,i,a]})),s=t[0],i=t[1],a=t[2],c$([c,u,l])},l=0;l<c;++l)u(l);return!t&&n>r&&(a=a.slice([0,0],[n,r]),i=i.slice([0,0],[r,r])),[a,i]}))}var H9=M$({bandPart_:function(e,t,n){if(t%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+t+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var r=d$(e,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var a=r.shape,i=r.shape.slice(-2),o=i[0],s=i[1];if(!(t<=o))throw new Error("bandPart(): numLower ("+t+") must not be greater than the number of rows ("+o+").");if(!(n<=s))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+s+").");t<0&&(t=o),n<0&&(n=s);var c=z$(0,o,1,"int32").reshape([-1,1]),u=z$(0,s,1,"int32"),l=X6(c,u),f=S6(l.lessEqual(N$(+t,"int32")),l.greaterEqual(N$(-n,"int32"))),d=P$([o,s],r.dtype);return I0(L0(r.reshape([-1,o,s])).map((function(e){return E6(f,e,d)}))).reshape(a)}}),Y9=M$({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,HQ(null!=e&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=e[0].shape[0],r=function(t){HQ(e[t].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[t].shape[0]+" vs. "+n+")"}))},a=1;a<e.length;++a)r(a)}else t=!0,e=Y$(e,e.shape[0],0).map((function(e){return T0(e,[0])}));HQ(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+")."}));var i=[],o=e,s=function(e){i.push(tZ.tidy((function(){var t=o[e];if(e>0)for(var n=0;n<e;++n){var r=t9(i[n].mulStrict(t)).mul(i[n]);t=t.sub(r)}return t.div(f9(t,"euclidean"))})))};for(a=0;a<e.length;++a)s(a);return t?I0(i,0):i}}),X9=M$({qr_:function(e,t){if(void 0===t&&(t=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(2===e.rank)return V9(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=L0(e.reshape([n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],i=[];return r.forEach((function(e){var n=V9(e,t),r=n[0],o=n[1];a.push(r),i.push(o)})),[I0(a,0).reshape(e.shape),I0(i,0).reshape(e.shape)]}}),q9=Object.freeze({bandPart:H9,gramSchmidt:Y9,qr:X9});function K9(e,t,n,r,a,i){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==i&&(i=0);var o=e.shape[0];return n=Math.min(n,o),HQ(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"})),HQ(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"})),HQ(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]})),HQ(1===t.rank,(function(){return"scores must be a 1D tensor"})),HQ(t.shape[0]===o,(function(){return"scores has incompatible shape with boxes. Expected "+o+", but was "+t.shape[0]})),HQ(0<=i&&i<=1,(function(){return"softNmsSigma must be in [0, 1], but was '"+i+"'"})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}var Q9=M$({resizeBilinear_:function(e,t,n){void 0===n&&(n=!1);var r=d$(e,"images","resizeBilinear");HQ(3===r.rank||4===r.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."})),HQ(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."}));var a=r,i=!1;3===r.rank&&(i=!0,a=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=t[0],s=t[1],c=tZ.runKernelFunc((function(e,t){return t([a]),e.resizeBilinear(a,o,s,n)}),{x:a},(function(e,t){return{x:function(){return tZ.runKernelFunc((function(r){return r.resizeBilinearBackprop(e,t[0],n)}),{})}}}),"ResizeBilinear",{alignCorners:n,newHeight:o,newWidth:s});return i?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),J9=M$({resizeNearestNeighbor_:function(e,t,n){void 0===n&&(n=!1);var r=d$(e,"images","resizeNearestNeighbor");HQ(3===r.rank||4===r.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."})),HQ(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."})),HQ("float32"===r.dtype||"int32"===r.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"}));var a=r,i=!1;3===r.rank&&(i=!0,a=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=t[0],s=t[1],c=tZ.runKernelFunc((function(e,t){return t([a]),e.resizeNearestNeighbor(a,o,s,n)}),{batchImages:a},(function(e,t){return{batchImages:function(){return tZ.runKernelFunc((function(r){return r.resizeNearestNeighborBackprop(e,t[0],n)}),{})}}}));return i?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),Z9=M$({nonMaxSuppression_:function(e,t,n,r,a){void 0===r&&(r=.5),void 0===a&&(a=Number.NEGATIVE_INFINITY);var i=d$(e,"boxes","nonMaxSuppression"),o=d$(t,"scores","nonMaxSuppression"),s=K9(i,o,n,r,a);n=s.maxOutputSize,r=s.iouThreshold,a=s.scoreThreshold;var c={maxOutputSize:n,iouThreshold:r,scoreThreshold:a};return tZ.runKernelFunc((function(e){return e.nonMaxSuppression(i,o,n,r,a)}),{boxes:i,scores:o},null,"NonMaxSuppressionV3",c)}}),$9=M$({nonMaxSuppressionWithScore_:function(e,t,n,r,a,i){void 0===r&&(r=.5),void 0===a&&(a=Number.NEGATIVE_INFINITY),void 0===i&&(i=0);var o=d$(e,"boxes","nonMaxSuppression"),s=d$(t,"scores","nonMaxSuppression"),c=K9(o,s,n,r,a,i),u={maxOutputSize:n=c.maxOutputSize,iouThreshold:r=c.iouThreshold,scoreThreshold:a=c.scoreThreshold,softNmsSigma:i=c.softNmsSigma},l=tZ.runKernel("NonMaxSuppressionV5",{boxes:o,scores:s},u);return{selectedIndices:l[0],selectedScores:l[1]}}}),e8=M$({cropAndResize_:function(e,t,n,r,a,i){var o=d$(e,"image","cropAndResize"),s=d$(t,"boxes","cropAndResize","float32"),c=d$(n,"boxInd","cropAndResize","int32");a=a||"bilinear",i=i||0;var u=s.shape[0];return HQ(4===o.rank,(function(){return"Error in cropAndResize: image must be rank 4,but got rank "+o.rank+"."})),HQ(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size ["+u+",4] but had shape "+s.shape+"."})),HQ(1===c.rank&&c.shape[0]===u,(function(){return"Error in cropAndResize: boxInd must be have size ["+u+"] but had shape "+s.shape+"."})),HQ(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."})),HQ(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was "+r})),HQ("bilinear"===a||"nearest"===a,(function(){return"method must be bilinear or nearest, but was "+a})),tZ.runKernelFunc((function(e,t){return e.cropAndResize(o,s,c,r,a,i)}),{images:o,boxes:s,boxInd:c},null,"CropAndResize",{method:a,extrapolationValue:i,cropSize:r})}}),t8=Object.freeze({resizeBilinear:Q9,resizeNearestNeighbor:J9,nonMaxSuppression:Z9,nonMaxSuppressionAsync:function(e,t,n,r,a){return void 0===r&&(r=.5),void 0===a&&(a=Number.NEGATIVE_INFINITY),kQ(this,void 0,void 0,(function(){var i,o,s,c,u,l,f;return NQ(this,(function(d){switch(d.label){case 0:return i=d$(e,"boxes","nonMaxSuppressionAsync"),o=d$(t,"scores","nonMaxSuppressionAsync"),s=K9(i,o,n,r,a),n=s.maxOutputSize,r=s.iouThreshold,a=s.scoreThreshold,[4,Promise.all([i.data(),o.data()])];case 1:return c=d.sent(),u=c[0],l=c[1],f=_1(u,l,n,r,a),i!==e&&i.dispose(),o!==t&&o.dispose(),[2,f]}}))}))},nonMaxSuppressionWithScore:$9,nonMaxSuppressionWithScoreAsync:function(e,t,n,r,a,i){return void 0===r&&(r=.5),void 0===a&&(a=Number.NEGATIVE_INFINITY),void 0===i&&(i=0),kQ(this,void 0,void 0,(function(){var o,s,c,u,l,f,d;return NQ(this,(function(h){switch(h.label){case 0:return o=d$(e,"boxes","nonMaxSuppressionAsync"),s=d$(t,"scores","nonMaxSuppressionAsync"),c=K9(o,s,n,r,a,i),n=c.maxOutputSize,r=c.iouThreshold,a=c.scoreThreshold,i=c.softNmsSigma,[4,Promise.all([o.data(),s.data()])];case 1:return u=h.sent(),l=u[0],f=u[1],d=E1(l,f,n,r,a,i),o!==e&&o.dispose(),s!==t&&s.dispose(),[2,d]}}))}))},cropAndResize:e8}),n8=function(e,t){return!(e>0)||"linear"===t},r8=function(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return e.mul(t.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},a8=function(e,t){var n=t,r=n1(e.shape,t.shape);return r.length>0&&(n=n.sum(r)),n.reshape(e.shape)},i8=function(e,t,n){if("linear"===t)return e;if("relu"===t)return o9(e);if("elu"===t)return r9(e);if("relu6"===t)return s9(e);if("prelu"===t)return i9(e,n);throw new Error("Unknown fused activation "+t+".")},o8=M$({fusedMatMul_:function(e){var t,n=e.a,r=e.b,a=e.transposeA,i=void 0!==a&&a,o=e.transposeB,s=void 0!==o&&o,c=e.bias,u=e.activation,l=void 0===u?"linear":u,f=e.preluActivationWeights;if(!1===n8(tZ.state.gradientDepth,l)){var d=_5(n,r,i,s);return null!=c&&(d=I6(d,c)),i8(d,l,f)}var h=d$(n,"a","fused matMul"),p=d$(r,"b","fused matMul");t=KJ(h,p),h=t[0],p=t[1];var g=i?h.shape[h.rank-2]:h.shape[h.rank-1],m=s?p.shape[p.rank-1]:p.shape[p.rank-2],v=i?h.shape[h.rank-1]:h.shape[h.rank-2],b=s?p.shape[p.rank-2]:p.shape[p.rank-1],y=h.shape.slice(0,-2),x=p.shape.slice(0,-2),w=KQ(y),S=KQ(x);HQ(h.rank>=2&&p.rank>=2&&h.rank===p.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+h.rank+" and "+p.rank+"."})),HQ(QQ(y,x),(function(){return"Error in fused matMul: outer dimensions ("+y+") and ("+x+") of Tensors with shapes "+h.shape+" and "+p.shape+" must match."})),HQ(g===m,(function(){return"Error in fused matMul: inner shapes ("+g+") and ("+m+") of Tensors with shapes "+h.shape+" and "+p.shape+" and transposeA="+i+" and transposeB="+s+" must match."}));var C,M,_=h.shape.slice(0,-2).concat([v,b]),E=i?h.as3D(w,g,v):h.as3D(w,v,g),T=s?p.as3D(S,b,m):p.as3D(S,m,b);null!=c&&r1(_,(C=KJ(C=d$(c,"bias","fused matMul"),h)[0]).shape),null!=f&&(M=d$(f,"prelu weights","fused matMul"));var I={a:E,b:T};null!=c&&(I.bias=C),null!=f&&(I.preluActivationWeights=M);var k=[E,T];return tZ.runKernelFunc((function(e,t){var n=e.fusedBatchMatMul({a:E,b:T,transposeA:i,transposeB:s,bias:C,activation:l,preluActivationWeights:M});return t([E,T,n]),n}),I,(function(e,t){var n=t[0],r=t[1],a=t[2],o=r8(e,a,l),u={};return null!=c&&(u={bias:function(){return a8(C,o)}}),i||s?!i&&s?Object.assign({a:function(){return o.matMul(r,!1,!1)},b:function(){return o.matMul(n,!0,!1)}},u):i&&!s?Object.assign({a:function(){return r.matMul(o,!1,!0)},b:function(){return n.matMul(o,!1,!1)}},u):Object.assign({a:function(){return r.matMul(o,!0,!0)},b:function(){return o.matMul(n,!0,!0)}},u):Object.assign({a:function(){return o.matMul(r,!1,!0)},b:function(){return n.matMul(o,!0,!1)}},u)}),"_FusedMatMul",{transposeA:i,transposeB:s,activation:l},k,[!0]).reshape(_)}}),s8=M$({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,a=e.pad,i=e.dataFormat,o=void 0===i?"NHWC":i,s=e.dilations,c=void 0===s?[1,1]:s,u=e.dimRoundingMode,l=e.bias,f=e.activation,d=void 0===f?"linear":f,h=e.preluActivationWeights;if(d=d||"linear",!1===n8(tZ.state.gradientDepth,d)){var p=g5(t,n,r,a,o,c,u);return null!=l&&(p=I6(p,l)),i8(p,d,h)}var g=d$(t,"x","conv2d"),m=d$(n,"filter","conv2d"),v=g,b=!1;3===g.rank&&(b=!0,v=g.as4D(1,g.shape[0],g.shape[1],g.shape[2])),HQ(4===v.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+v.rank+"."})),HQ(4===m.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+m.rank+"."})),null!=u&&HQ(JQ(a),(function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+u+" but got pad "+a+"."})),HQ(v.shape[3]===m.shape[2],(function(){return"Error in conv2d: depth of input ("+v.shape[3]+") must match input depth for filter "+m.shape[2]+"."})),HQ(p1(r,c),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+c+"'"})),HQ("NHWC"===o,(function(){return"Error in conv2d: got dataFormat of "+o+" but only NHWC is currently supported."}));var y,x,w=o1(v.shape,m.shape,r,c,a,u);null!=l&&(y=KJ(y=d$(l,"bias","fused conv2d"),g)[0],r1(w.outShape,y.shape)),null!=h&&(x=d$(h,"prelu weights","fused conv2d"));var S={x:v,filter:m};null!=l&&(S.bias=y),null!=h&&(S.preluActivationWeights=x);var C=[m,v],M=tZ.runKernelFunc((function(e,t){var n=e.fusedConv2d({input:v,filter:m,convInfo:w,bias:y,activation:d,preluActivationWeights:x});return t([m,v,n]),n}),S,(function(e,t){var n=t,i=n[0],o=n[1],s=n[2],u=r8(e,s,d);HQ(h1(c),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+c+"'"}));var f={};return null!=l&&(f={bias:function(){return a8(y,u)}}),Object.assign({x:function(){return b5(o.shape,u,i,r,a)},filter:function(){return v5(o,u,i.shape,r,a)}},f)}),"FusedConv2D",{convInfo:w,activation:d},C,[!0]);return b?M.as3D(M.shape[1],M.shape[2],M.shape[3]):M}}),c8=M$({fusedDepthwiseConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,a=e.pad,i=e.dataFormat,o=void 0===i?"NHWC":i,s=e.dilations,c=void 0===s?[1,1]:s,u=e.dimRoundingMode,l=e.bias,f=e.activation,d=void 0===f?"linear":f,h=e.preluActivationWeights;if(!1===n8(tZ.state.gradientDepth,d)){var p=y5(t,n,r,a,o,c,u);return null!=l&&(p=I6(p,l)),i8(p,d,h)}var g=d$(t,"x","depthwiseConv2d"),m=d$(n,"filter","depthwiseConv2d"),v=g,b=!1;3===g.rank&&(b=!0,v=g.as4D(1,g.shape[0],g.shape[1],g.shape[2])),HQ(4===v.rank,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+v.rank+"."})),HQ(4===m.rank,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+m.rank+"."})),HQ(v.shape[3]===m.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels ("+v.shape[3]+") must match the inChannels dimension in filter "+m.shape[2]+"."})),null==c&&(c=[1,1]),HQ(p1(r,c),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+c+"'"})),null!=u&&HQ(JQ(a),(function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+u+" but got pad "+a+"."}));var y,x,w=o1(v.shape,m.shape,r,c,a,u,!0);null!=l&&(y=KJ(y=d$(l,"bias","fused conv2d"),g)[0],r1(w.outShape,y.shape)),null!=h&&(x=d$(h,"prelu weights","fused depthwiseConv2d"));var S={x:v,filter:m};null!=l&&(S.bias=y),null!=h&&(S.preluActivationWeights=x);var C=[m,v],M=tZ.runKernelFunc((function(e,t){var n=e.fusedDepthwiseConv2D({input:v,filter:m,convInfo:w,bias:y,activation:d,preluActivationWeights:x});return t([m,v,n]),n}),S,(function(e,t){HQ(h1(c),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+c+"'"}));var n=t[0],r=t[1],a=t[2],i=r8(e,a,d),o={};return null!=l&&(o={bias:function(){return a8(y,i)}}),Object.assign({x:function(){return x5(r.shape,i,n,w)},filter:function(){return w5(r,i,n.shape,w)}},o)}),"FusedDepthwiseConv2D",{convInfo:w,activation:d},C,[!0]);return b?M.as3D(M.shape[1],M.shape[2],M.shape[3]):M}}),u8=Object.freeze({matMul:o8,conv2d:s8,depthwiseConv2d:c8}),l8=Object.freeze({image:t8,linalg:q9,losses:G9,spectral:S9,fused:u8,signal:R9,square:_4,squaredDifference:T4,conv1d:p5,conv2d:g5,conv3d:m5,depthwiseConv2d:y5,separableConv2d:S5,conv2dTranspose:C5,conv3dTranspose:M5,op:M$,batchNormalization2d:p6,batchNormalization3d:g6,batchNormalization4d:m6,batchNormalization:v6,batchNorm:b6,batchNorm2d:y6,batchNorm3d:x6,batchNorm4d:w6,booleanMaskAsync:function(e,t,n){return kQ(this,void 0,void 0,(function(){var r,a,i,o,s,c,u,l,f,d,h,p,g;return NQ(this,(function(m){switch(m.label){case 0:for(r=d$(e,"tensor","boolMask"),a=d$(t,"mask","boolMask","bool"),i=null==n?0:n,o=a.rank,s=r.shape,HQ(o>0,(function(){return"mask cannot be scalar"})),YQ(s.slice(i,i+o),a.shape,"mask's shape must match the first K dimensions of tensor's shape,"),c=1,u=i;u<i+o;u++)c*=s[u];return l=s.slice(0,i).concat([c],s.slice(i+o)),f=r.reshape(l),d=a.reshape([-1]),[4,T6(d)];case 1:return h=m.sent(),p=h.squeeze([1]),g=u5(f,p,i),e!==r&&r.dispose(),t!==a&&a.dispose(),p.dispose(),f.dispose(),d.dispose(),h.dispose(),[2,g]}}))}))},complex:_$,real:E$,imag:T$,concat:U$,concat1d:W$,concat2d:G$,concat3d:V$,concat4d:H$,split:Y$,matMul:_5,dot:E5,outerProduct:T5,reverse:I5,reverse1d:k5,reverse2d:N5,reverse3d:L5,reverse4d:A5,maxPool:O5,avgPool:P5,pool:F5,maxPool3d:z5,avgPool3d:j5,slice:B5,slice1d:U5,slice2d:W5,slice3d:G5,slice4d:V5,abs:I4,acos:k4,acosh:N4,asin:L4,asinh:A4,atan:R4,atanh:D4,ceil:O4,clipByValue:P4,cos:F4,cosh:z4,erf:j4,exp:B4,expm1:U4,floor:W4,log:G4,log1p:V4,logSigmoid:H4,neg:Y4,reciprocal:X4,round:q4,rsqrt:K4,sigmoid:Q4,sign:J4,isNaN:Z4,isInf:$4,isFinite:e6,sin:t6,sinh:n6,softplus:r6,sqrt:a6,step:i6,tan:o6,tanh:s6,all:Y5,any:X5,argMax:q5,argMin:K5,logSumExp:Q5,max:J5,mean:Z5,min:$5,moments:e9,sum:t9,prod:n9,equal:K6,equalStrict:Q6,greater:J6,greaterEqual:Z6,greaterEqualStrict:$6,greaterStrict:e5,less:t5,lessEqual:n5,lessEqualStrict:r5,lessStrict:a5,notEqual:i5,notEqualStrict:o5,add:I6,addN:k6,addStrict:N6,atan2:L6,div:A6,divNoNan:R6,divStrict:D6,floorDiv:O6,maximum:P6,maximumStrict:F6,minimum:z6,minimumStrict:j6,mod:B6,modStrict:U6,mul:W6,mulStrict:G6,pow:V6,powStrict:H6,squaredDifferenceStrict:Y6,sub:X6,subStrict:q6,elu:r9,leakyRelu:a9,prelu:i9,relu:o9,relu6:s9,selu:c9,logicalAnd:S6,logicalNot:C6,logicalOr:M6,logicalXor:_6,where:E6,whereAsync:T6,buffer:i0,print:function(e,t){void 0===t&&(t=!1),console.log(e.toString(t))},batchToSpaceND:o0,broadcastTo:s0,cast:c0,clone:u0,cumsum:l0,depthToSpace:f0,expandDims:d0,eye:h0,multinomial:p0,oneHot:g0,pad:m0,pad1d:v0,pad2d:b0,pad3d:y0,pad4d:x0,rand:w0,randomNormal:S0,randomGamma:C0,randomUniform:M0,reshape:_0,spaceToBatchND:E0,squeeze:T0,stack:I0,tile:k0,truncatedNormal:N0,unstack:L0,setdiff1dAsync:function(e,t){return kQ(this,void 0,void 0,(function(){var n,r,a,i,o,s,c,u,l,f;return NQ(this,(function(d){switch(d.label){case 0:return n=d$(e,"x","setdiff1d"),r=d$(t,"y","setdiff1d"),HQ(n.dtype===r.dtype,(function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."})),HQ(1===n.rank,(function(){return"x should be 1D tensor, but got x ("+n.shape+")."})),HQ(1===r.rank,(function(){return"y should be 1D tensor, but got y ("+r.shape+")."})),[4,n.data()];case 1:return a=d.sent(),[4,r.data()];case 2:for(i=d.sent(),o=new Set(i),s=0,l=0;l<a.length;l++)o.has(a[l])||s++;for(c=new OJ([s],n.dtype),u=new OJ([s],"int32"),l=0,f=0;l<a.length;l++)o.has(a[l])||(c.values[f]=a[l],u.values[f]=l,f++);return[2,[c.toTensor(),u.toTensor()]]}}))}))},fill:F$,linspace:function(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return tZ.runKernelFunc((function(r){return r.linspace(e,t,n)}),{})},ones:O$,range:z$,scalar:N$,tensor:I$,tensor1d:L$,tensor2d:A$,tensor3d:R$,tensor4d:D$,tensor5d:function(e,t,n){if(XQ(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=l$(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return k$(e,t,r,n)},tensor6d:function(e,t,n){if(XQ(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=l$(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return k$(e,t=t||r,r,n)},variable:function(e,t,n,r){return void 0===t&&(t=!0),tZ.makeVariable(e,t,n,r)},zeros:P$,onesLike:j$,zerosLike:B$,transpose:u9,softmax:Q0,logSoftmax:J0,localResponseNormalization:l9,norm:f9,gather:u5,unsortedSegmentSum:l5,basicLSTMCell:d9,multiRNNCell:h9,movingAverage:p9,stridedSlice:g9,topk:m9,scatterND:v9,fft:b9,ifft:y9,rfft:x9,irfft:w9,sparseToDense:C9,gatherND:M9,diag:_9,dropout:E9,hannWindow:k9,hammingWindow:N9,frame:L9,stft:A9,inTopKAsync:function(e,t,n){return void 0===n&&(n=1),kQ(this,void 0,void 0,(function(){var r,a,i,o,s,c,u,l,f,d,h,p,g,m;return NQ(this,(function(v){switch(v.label){case 0:return r=d$(e,"predictions","inTopK"),a=d$(t,"targets","inTopK"),HQ(r.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank})),HQ(r.rank-1===a.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+a.rank})),YQ(r.shape.slice(0,r.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=r.shape[r.shape.length-1],HQ(n>0&&n<=i,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+i+"), but got "+n})),[4,r.data()];case 1:return o=v.sent(),[4,a.data()];case 2:for(s=v.sent(),c=[o.length/i,i],l=c[1],f=iJ("bool",u=c[0]),d=0;d<u;d++){for(h=d*l,p=o.subarray(h,h+l),g=[],m=0;m<p.length;m++)g.push({value:p[m],index:m});for(g.sort((function(e,t){return t.value-e.value})),f[d]=0,m=0;m<n;m++)if(g[m].index===s[d]){f[d]=1;break}}return e!==r&&r.dispose(),t!==a&&a.dispose(),[2,I$(f,a.shape,"bool")]}}))}))}});function f8(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&HQ("complex64"!==e.dtype,(function(){return t+" does not support complex64 tensors."}))}))}function d8(e,t,n,r){if("linear"===n)return e.linear(t);if("relu"===n)return e.relu(t);if("elu"===n)return e.elu(t);if("relu6"===n)return e.relu6(t);if("prelu"===n)return e.prelu(t,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var h8=function(e){function t(){var t=e.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new Z0(t,tZ),t}return IQ(t,e),t.prototype.write=function(e,t,n){this.firstUse&&(this.firstUse=!1,AQ().get("IS_NODE")&&u$("\n============================\nHi there \ud83d\udc4b. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var r={};return this.data.set(r,{values:e,dtype:n}),r},t.prototype.move=function(e,t,n,r){this.data.set(e,{values:t,dtype:r})},t.prototype.numDataIds=function(){return this.data.numDataIds()},t.prototype.read=function(e){return kQ(this,void 0,void 0,(function(){return NQ(this,(function(t){return[2,this.readSync(e)]}))}))},t.prototype.readSync=function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensors;return"complex64"===n?y1(this.readSync(r.real.dataId),this.readSync(r.imag.dataId)):this.data.get(e).values},t.prototype.bufferSync=function(e){var t=this.readSync(e.dataId),n=t;if("string"===e.dtype)try{n=t.map((function(e){return TJ(e)}))}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return i0(e.shape,e.dtype,n)},t.prototype.makeOutput=function(e,t,n){var r=this.write(e,t,n);return tZ.makeTensorFromDataId(r,t,n,this)},t.prototype.disposeData=function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.data.delete(e)}},t.prototype.time=function(e){return kQ(this,void 0,void 0,(function(){var t;return NQ(this,(function(n){return t=MJ(),e(),[2,{kernelMs:MJ()-t}]}))}))},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(e,t){var n=this.makeOutput(null,e.shape,"complex64");return this.data.get(n.dataId).complexTensors={real:tZ.keep(e.clone()),imag:tZ.keep(t.clone())},n},t.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,n){if(f8(e,"slice"),X0(e.shape,t,n)){var r=q0(t,e.strides),a=KQ(n);return I$(this.readSync(e.dataId).subarray(r,r+a),n,e.dtype)}for(var i=i0(n,e.dtype),o=this.bufferSync(e),s=0;s<i.size;++s){var c=i.indexToLoc(s).map((function(e,n){return e+t[n]}));i.values[s]=o.get.apply(o,c)}return i.toTensor()},t.prototype.stridedSlice=function(e,t,n,r){f8(e,"stridedSlice");var a=V0(t,n,r);if(a.some((function(e){return 0===e})))return I$([],a);for(var i=i0(a,e.dtype),o=this.bufferSync(e),s=0;s<i.size;s++){for(var c=i.indexToLoc(s),u=new Array(c.length),l=0;l<u.length;l++)u[l]=c[l]*r[l]+t[l];i.set.apply(i,[o.get.apply(o,u)].concat(c))}return i.toTensor()},t.prototype.diag=function(e){for(var t=this.readSync(e.dataId),n=i0([e.size,e.size],e.dtype),r=n.values,a=0;a<t.length;a++)r[a*e.size+a]=t[a];return n.toTensor()},t.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),a=0,i=0;i<e.rank;i++)i!==t&&(r[a++]=e.shape[i]);var o=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var c=new Array(n);for(i=0;i<c.length;i++)o[t]=i,c[i]=this.slice(e,o,s).reshape(r);return c},t.prototype.reverse=function(e,t){f8(e,"reverse");for(var n=i0(e.shape,e.dtype),r=this.bufferSync(e),a=function(a){var i=n.indexToLoc(a),o=i.slice();t.forEach((function(t){return o[t]=e.shape[t]-1-o[t]})),n.set.apply(n,[r.get.apply(r,o)].concat(i))},i=0;i<n.size;i++)a(i);return n.toTensor()},t.prototype.concat=function(e,t){var n=this;if("complex64"===e[0].dtype){var r=e.map((function(e){return E$(e)})),a=e.map((function(e){return T$(e)}));return _$(this.concat(r,t),this.concat(a,t))}var i=e.map((function(e){var n=KQ(e.shape.slice(t));return e.as2D(-1,n)})),o=C$(i.map((function(e){return e.shape})),1),s=i0(o,e[0].dtype).values;if(1===i[0].shape[0]){var c=0;i.forEach((function(e){s.set(n.readSync(e.dataId),c),c+=e.size}))}else{var u=0;i.forEach((function(e){for(var t=n.readSync(e.dataId),r=0,a=0;a<e.shape[0];++a)for(var i=a*o[1]+u,c=0;c<e.shape[1];++c)s[i+c]=t[r++];u+=e.shape[1]}))}var l=C$(e.map((function(e){return e.shape})),t);return I$(s,l,e[0].dtype)},t.prototype.neg=function(e){return f8(e,"neg"),this.multiply(N$(-1),e)},t.prototype.add=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e+n,imag:t+r}})):this.broadcastedBinaryOp(e,t,XJ(e.dtype,t.dtype),(function(e,t){return e+t}))},t.prototype.addN=function(e){var t=this;f8(e,"addN");for(var n=e.map((function(e){return t.readSync(e.dataId)})),r=i0(e[0].shape,e[0].dtype),a=r.values,i=0;i<e.length;i++)for(var o=n[i],s=0;s<a.length;s++)a[s]+=o[s];return r.toTensor()},t.prototype.softmax=function(e,t){var n=rJ([t],e.shape),r=this.max(e,n),a=v$(r.shape,n),i=this.subtract(e,r.reshape(a)),o=this.exp(i),s=this.sum(o,n).reshape(a);return this.realDivide(o,s)},t.prototype.subtract=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e-n,imag:t-r}})):this.broadcastedBinaryOp(e,t,XJ(e.dtype,t.dtype),(function(e,t){return e-t}))},t.prototype.pow=function(e,t){return f8([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.pow(e,t)}))},t.prototype.batchMatMul=function(e,t,n,r){f8([e,t],"matMul");for(var a=n?e.shape[1]:e.shape[2],i=n?e.shape[2]:e.shape[1],o=r?t.shape[1]:t.shape[2],s=e.shape[0],c=this.readSync(e.dataId),u=this.readSync(t.dataId),l=n?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],f=l[0],d=l[1],h=l[2],p=r?[1,t.strides[1],t.strides[0]]:[t.strides[1],1,t.strides[0]],g=p[0],m=p[1],v=p[2],b=i*o,y=i0([s,i,o],e.dtype),x=y.values,w=this.blockSize,S=0;S<s;S++)for(var C=0;C<i;C+=w)for(var M=0;M<o;M+=w)for(var _=0;_<a;_+=w)for(var E=Math.min(C+w,i),T=Math.min(M+w,o),I=Math.min(_+w,a),k=C;k<E;k++)for(var N=M;N<T;N++){for(var L=0,A=_;A<I;A++)L+=c[S*f+k*d+A*h]*u[A*g+N*m+S*v];x[S*b+(k*o+N)]+=L}return y.toTensor()},t.prototype.fusedBatchMatMul=function(e){var t=e.a,n=e.b,r=e.transposeA,a=e.transposeB,i=e.bias,o=e.activation,s=e.preluActivationWeights,c=this.batchMatMul(t,n,r,a);return i&&(c=this.add(c,i)),o&&(c=d8(this,c,o,s)),c},t.prototype.multiply=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}})):this.broadcastedBinaryOp(e,t,XJ(e.dtype,t.dtype),(function(e,t){return e*t}))},t.prototype.realDivide=function(e,t){return f8([e,t],"realDivide"),this.broadcastedBinaryOp(e,t,"float32",(function(e,t){return e/t}))},t.prototype.floorDiv=function(e,t){return f8([e,t],"floorDiv"),this.broadcastedBinaryOp(e,t,"int32",(function(e,t){return Math.floor(e/t)}))},t.prototype.sum=function(e,t){f8(e,"sum"),b$("sum",t,e.rank);for(var n=m$(e.shape,t),r=n[0],a=n[1],i=P$(r,XJ(e.dtype,"int32")),o=KQ(a),s=this.readSync(i.dataId),c=this.readSync(e.dataId),u=0;u<s.length;++u){for(var l=u*o,f=0,d=0;d<o;++d)f+=c[l+d];s[u]=f}return i},t.prototype.prod=function(e,t){f8(e,"sum");for(var n=m$(e.shape,t),r=n[0],a=n[1],i=P$(r,XJ(e.dtype,"int32")),o=KQ(a),s=this.readSync(i.dataId),c=this.readSync(e.dataId),u=0;u<s.length;++u){for(var l=u*o,f=1,d=0;d<o;++d)f*=c[l+d];s[u]=f}return i},t.prototype.unsortedSegmentSum=function(e,t,n){f8(e,"unsortedSegmentSum");for(var r=[],a=e.rank-t.rank,i=0;i<a;++i)t=t.expandDims(i+1);for(i=0;i<n;++i){var o=N$(i,"int32"),s=K6(o,t).asType("float32").mul(e).sum(0);r.push(s)}return I0(r)},t.prototype.argMin=function(e,t){f8(e,"argMin");var n=[t];b$("argMin",n,e.rank);for(var r=m$(e.shape,n),a=r[0],i=r[1],o=P$(a,"int32"),s=KQ(i),c=this.readSync(o.dataId),u=this.readSync(e.dataId),l=0;l<c.length;++l){for(var f=l*s,d=u[f],h=0,p=0;p<s;++p){var g=u[f+p];g<d&&(d=g,h=p)}c[l]=h}return o},t.prototype.argMax=function(e,t){f8(e,"argMax");var n=[t];b$("argMax",n,e.rank);for(var r=m$(e.shape,n),a=r[0],i=r[1],o=P$(a,"int32"),s=KQ(i),c=this.readSync(o.dataId),u=this.readSync(e.dataId),l=0;l<c.length;++l){for(var f=l*s,d=u[f],h=0,p=0;p<s;++p){var g=u[f+p];g>d&&(d=g,h=p)}c[l]=h}return o},t.prototype.cumsum=function(e,t,n,r){if(f8(e,"cumsum"),t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+t);for(var a=XJ(e.dtype,"int32"),i=P$(e.shape,a),o=this.readSync(i.dataId),s=this.readSync(e.dataId),c=e.shape[e.rank-1],u=r?function(e,t){return e+c-t-1}:function(e,t){return e+t},l=0;l<s.length;l+=c)for(var f=0;f<c;f++){var d=u(l,f);if(0===f)o[d]=n?0:s[d];else{var h=u(l,f-1);o[d]=n?s[h]+o[h]:s[d]+o[h]}}return i},t.prototype.equal=function(e,t){return f8([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e===t?1:0}))},t.prototype.notEqual=function(e,t){return f8([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e!==t?1:0}))},t.prototype.less=function(e,t){return f8([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e<t?1:0}))},t.prototype.lessEqual=function(e,t){return f8([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e<=t?1:0}))},t.prototype.greater=function(e,t){return f8([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e>t?1:0}))},t.prototype.greaterEqual=function(e,t){return f8([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e>=t?1:0}))},t.prototype.logicalNot=function(e){f8(e,"logicalNot");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t[r]?0:1;return this.makeOutput(n,e.shape,"bool")},t.prototype.logicalAnd=function(e,t){return f8([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e&&t}))},t.prototype.logicalOr=function(e,t){return f8([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e||t}))},t.prototype.select=function(e,t,n){f8([e,t,n],"select");for(var r=this.readSync(e.dataId),a=this.readSync(t.dataId),i=this.readSync(n.dataId),o=P$(t.shape,XJ(t.dtype,n.dtype)),s=this.readSync(o.dataId),c=0,u=0===e.rank||e.rank>1||1===t.rank?1:KQ(t.shape.slice(1)),l=0;l<r.length;l++)for(var f=0;f<u;f++)1===r[l]?s[c++]=a[l]:s[c++]=i[l];return o},t.prototype.where=function(e){f8([e],"where");var t=this.readSync(e.dataId);return D1(e.shape,t)},t.prototype.topk=function(e,t,n){return f8(e,"topk"),R1(this.readSync(e.dataId),e.shape,e.dtype,t)},t.prototype.min=function(e,t){f8(e,"min"),b$("min",t,e.rank);for(var n=m$(e.shape,t),r=n[0],a=n[1],i=P$(r,e.dtype),o=KQ(a),s=this.readSync(i.dataId),c=this.readSync(e.dataId),u=0;u<s.length;++u){for(var l=u*o,f=c[l],d=0;d<o;++d){var h=c[l+d];h<f&&(f=h)}s[u]=f}return i},t.prototype.minimum=function(e,t){return f8([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.min(e,t)}))},t.prototype.mod=function(e,t){return f8([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t}))},t.prototype.max=function(e,t){f8(e,"max"),b$("max",t,e.rank);for(var n=m$(e.shape,t),r=n[0],a=n[1],i=P$(r,e.dtype),o=KQ(a),s=this.readSync(i.dataId),c=this.readSync(e.dataId),u=0;u<s.length;++u){for(var l=u*o,f=c[l],d=0;d<o;++d){var h=c[l+d];h>f&&(f=h)}s[u]=f}return i},t.prototype.maximum=function(e,t){return f8([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.max(e,t)}))},t.prototype.all=function(e,t){f8(e,"all"),b$("all",t,e.rank);for(var n=m$(e.shape,t),r=n[0],a=n[1],i=P$(r,e.dtype),o=KQ(a),s=this.readSync(i.dataId),c=this.readSync(e.dataId),u=0;u<s.length;++u){for(var l=u*o,f=c[l],d=0;d<o;++d){var h=c[l+d];f=f&&h}s[u]=f}return i},t.prototype.any=function(e,t){f8(e,"any"),b$("any",t,e.rank);for(var n=m$(e.shape,t),r=n[0],a=n[1],i=P$(r,e.dtype),o=KQ(a),s=this.readSync(i.dataId),c=this.readSync(e.dataId),u=0;u<s.length;++u){for(var l=u*o,f=c[l],d=0;d<o;++d){var h=c[l+d];f=f||h}s[u]=f}return i},t.prototype.squaredDifference=function(e,t){return f8([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){var n=e-t;return n*n}))},t.prototype.ceil=function(e){f8(e,"ceil");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.ceil(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.floor=function(e){f8(e,"floor");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.floor(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.sign=function(e){f8(e,"x");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)t[r]<0?n[r]=-1:t[r]>0?n[r]=1:n[r]=0;return this.makeOutput(n,e.shape,"float32")},t.prototype.isNaN=function(e){f8(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isNaN(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.isInf=function(e){f8(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Math.abs(t[r])===1/0&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.isFinite=function(e){f8(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isFinite(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.round=function(e){f8(e,"round");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var a=Math.floor(t[r]);t[r]-a<.5?n[r]=Math.floor(t[r]):t[r]-a>.5?n[r]=Math.ceil(t[r]):n[r]=a%2==0?a:a+1}return this.makeOutput(n,e.shape,"float32")},t.prototype.exp=function(e){f8(e,"exp");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.exp(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.expm1=function(e){f8(e,"expm1");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.expm1(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.log=function(e){f8(e,"log");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var a=t[r];n[r]=Math.log(a)}return this.makeOutput(n,e.shape,"float32")},t.prototype.log1p=function(e){f8(e,"log1p");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var a=t[r];n[r]=Math.log1p(a)}return this.makeOutput(n,e.shape,"float32")},t.prototype.sqrt=function(e){f8(e,"sqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var a=t[r];n[r]=Math.sqrt(a)}return this.makeOutput(n,e.shape,"float32")},t.prototype.rsqrt=function(e){f8(e,"rsqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var a=t[r];n[r]=1/Math.sqrt(a)}return this.makeOutput(n,e.shape,"float32")},t.prototype.reciprocal=function(e){f8(e,"reciprocal");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=1/t[r];return this.makeOutput(n,e.shape,"float32")},t.prototype.linear=function(e){return e},t.prototype.relu=function(e){f8(e,"relu");for(var t=P$(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),a=0;a<r.length;++a)n[a]=Math.max(0,r[a]);return t},t.prototype.relu6=function(e){f8(e,"relu");for(var t=P$(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),a=0;a<r.length;++a)n[a]=Math.min(Math.max(0,r[a]),6);return t},t.prototype.prelu=function(e,t){return f8([e,t],"prelu"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return e<0?t*e:e}))},t.prototype.elu=function(e){f8(e,"elu");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var a=n[r];t[r]=a>=0?a:Math.exp(a)-1}return this.makeOutput(t,e.shape,"float32")},t.prototype.eluDer=function(e,t){f8([e,t],"eluDer");for(var n=new Float32Array(t.size),r=this.readSync(t.dataId),a=this.readSync(e.dataId),i=0;i<r.length;++i){var o=r[i];n[i]=o>=1?a[i]:a[i]*(o+1)}return this.makeOutput(n,t.shape,"float32")},t.prototype.selu=function(e){f8(e,"selu");for(var t=q3,n=K3,r=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i){var o=a[i];r[i]=o>=0?n*o:t*(Math.exp(o)-1)}return this.makeOutput(r,e.shape,"float32")},t.prototype.clip=function(e,t,n){f8(e,"clip");for(var r=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i){var o=a[i];r[i]=o>n?n:o<t?t:o}return this.makeOutput(r,e.shape,"float32")},t.prototype.abs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.abs(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.complexAbs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<e.size;++r){var a=n[2*r],i=n[2*r+1];t[r]=Math.hypot(a,i)}return this.makeOutput(t,e.shape,"float32")},t.prototype.int=function(e){f8(e,"int");for(var t=new Int32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=n[r];return this.makeOutput(t,e.shape,"int32")},t.prototype.sigmoid=function(e){f8(e,"sigmoid");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=1/(1+Math.exp(-n[r]));return this.makeOutput(t,e.shape,"float32")},t.prototype.softplus=function(e){f8(e,"softplus");for(var t=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(e.size),r=this.readSync(e.dataId),a=0;a<r.length;++a){var i,o=r[a]>-t,s=r[a]<t,c=Math.exp(r[a]);i=s?c:o?r[a]:Math.log(1+c),n[a]=i}return this.makeOutput(n,e.shape,"float32")},t.prototype.sin=function(e){f8(e,"sin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sin(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.cos=function(e){f8(e,"cos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cos(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.tan=function(e){f8(e,"tan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.tan(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.asin=function(e){f8(e,"asin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asin(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.acos=function(e){f8(e,"acos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acos(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atan=function(e){f8(e,"atan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atan(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atan2=function(e,t){return f8([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.atan2(e,t)}))},t.prototype.sinh=function(e){f8(e,"sinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sinh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.cosh=function(e){f8(e,"cosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cosh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.tanh=function(e){f8(e,"tanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=ZQ(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.asinh=function(e){f8(e,"asinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asinh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.acosh=function(e){f8(e,"acosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acosh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atanh=function(e){f8(e,"atanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atanh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.erf=function(e){f8(e,"erf");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var a=Math.sign(n[r]),i=Math.abs(n[r]),o=1/(1+.3275911*i);t[r]=a*(1-((((1.061405429*o-1.453152027)*o+1.421413741)*o-.284496736)*o+.254829592)*o*Math.exp(-i*i))}return this.makeOutput(t,e.shape,"float32")},t.prototype.step=function(e,t){void 0===t&&(t=0),f8(e,"step");for(var n=new Float32Array(e.size),r=this.readSync(e.dataId),a=0;a<r.length;++a){var i=r[a];isNaN(i)?n[a]=NaN:n[a]=i>0?1:t}return this.makeOutput(n,e.shape,"float32")},t.prototype.fusedConv2d=function(e){var t=e.input,n=e.filter,r=e.convInfo,a=e.bias,i=e.activation,o=e.preluActivationWeights,s=this.conv2d(t,n,r);return a&&(s=this.add(s,a)),i&&(s=d8(this,s,i,o)),s},t.prototype.conv2d=function(e,t,n){f8([e,t],"conv2d");for(var r=n.filterHeight,a=n.filterWidth,i=n.dilationHeight,o=n.dilationWidth,s=n.padInfo.left,c=n.padInfo.top,u="channelsLast"===n.dataFormat,l=i0(n.outShape,e.dtype),f=e.strides[0],d=u?e.strides[1]:e.strides[2],h=u?e.strides[2]:1,p=u?1:e.strides[1],g=l.strides[0],m=u?l.strides[1]:l.strides[2],v=u?l.strides[2]:1,b=u?1:l.strides[1],y=this.readSync(e.dataId),x=this.readSync(t.dataId),w=l.values,S=0;S<n.batchSize;++S)for(var C=S*f,M=S*g,_=0;_<n.outHeight;++_)for(var E=M+_*m,T=_*n.strideHeight-c,I=0;I<r;I++){var k=T+I*i;if(!(k<0||k>=n.inHeight))for(var N=I*t.strides[0],L=C+k*d,A=0;A<n.outWidth;++A)for(var R=E+A*v,D=A*n.strideWidth-s,O=0;O<a;O++){var P=D+O*o;if(!(P<0||P>=n.inWidth))for(var F=L+P*h,z=N+O*t.strides[1],j=0;j<n.inChannels;++j){for(var B=y[F+j*p],U=0;U<n.outChannels;++U)w[R+U*b]+=B*x[z+U];z+=n.outChannels}}}return l.toTensor()},t.prototype.conv3d=function(e,t,n){for(var r=n.filterDepth,a=n.filterHeight,i=n.filterWidth,o=n.dilationDepth,s=n.dilationHeight,c=n.dilationWidth,u=n.padInfo.front,l=n.padInfo.left,f=n.padInfo.top,d=i0(n.outShape,e.dtype),h=this.readSync(e.dataId),p=this.readSync(t.dataId),g=d.values,m=0;m<n.batchSize;++m)for(var v=m*e.strides[0],b=m*d.strides[0],y=0;y<n.outDepth;++y)for(var x=b+y*d.strides[1],w=y*n.strideDepth-u,S=0;S<r;S++){var C=w+S*o;if(!(C<0||C>=n.inDepth))for(var M=S*t.strides[0],_=v+C*e.strides[1],E=0;E<n.outHeight;++E)for(var T=x+E*d.strides[2],I=E*n.strideHeight-f,k=0;k<a;k++){var N=I+k*s;if(!(N<0||N>=n.inHeight))for(var L=M+k*t.strides[1],A=_+N*e.strides[2],R=0;R<n.outWidth;++R)for(var D=T+R*n.outChannels,O=R*n.strideWidth-l,P=0;P<i;P++){var F=O+P*c;if(!(F<0||F>=n.inWidth))for(var z=L+P*t.strides[2],j=A+F*n.inChannels,B=z,U=0;U<n.inChannels;++U){for(var W=h[j+U],G=0;G<n.outChannels;++G)g[D+G]+=W*p[B+G];B+=n.outChannels}}}}return d.toTensor()},t.prototype.conv2dDerInput=function(e,t,n){f8([e,t],"conv2dDerInput");for(var r=i0(n.inShape,"float32"),a=r.values,i=this.readSync(e.dataId),o=this.readSync(t.dataId),s=t.strides,c=s[0],u=s[1],l=s[2],f=n.batchSize,d=n.filterHeight,h=n.filterWidth,p=n.inChannels,g=n.inHeight,m=n.inWidth,v=n.outChannels,b=n.outHeight,y=n.outWidth,x=n.strideHeight,w=n.strideWidth,S=n.dataFormat,C=d-1-n.padInfo.top,M=h-1-n.padInfo.left,_="channelsLast"===S,E=r.strides[0],T=_?r.strides[1]:r.strides[2],I=_?r.strides[2]:1,k=_?1:r.strides[1],N=e.strides[0],L=_?e.strides[1]:e.strides[2],A=_?e.strides[2]:1,R=_?1:e.strides[1],D=0;D<f;++D)for(var O=0;O<p;++O)for(var P=0;P<g;++P)for(var F=P-C,z=Math.max(0,Math.ceil(F/x)),j=Math.min(b,(d+F)/x),B=0;B<m;++B){for(var U=B-M,W=Math.max(0,Math.ceil(U/w)),G=Math.min(y,(h+U)/w),V=0,H=z;H<j;++H)for(var Y=H*x-F,X=W;X<G;++X)for(var q=N*D+L*H+A*X,K=c*(d-1-Y)+u*(h-1-(X*w-U))+l*O,Q=0;Q<v;++Q)V+=i[q+R*Q]*o[K+Q];a[E*D+T*P+I*B+k*O]=V}return r.toTensor()},t.prototype.conv3dDerInput=function(e,t,n){for(var r=i0(n.inShape,"float32"),a=r.values,i=r.strides,o=i[0],s=i[1],c=i[2],u=i[3],l=this.readSync(e.dataId),f=e.strides,d=f[0],h=f[1],p=f[2],g=f[3],m=this.readSync(t.dataId),v=t.strides,b=v[0],y=v[1],x=v[2],w=v[3],S=n.batchSize,C=n.filterDepth,M=n.filterHeight,_=n.filterWidth,E=n.inChannels,T=n.inDepth,I=n.inHeight,k=n.inWidth,N=n.outChannels,L=n.outDepth,A=n.outHeight,R=n.outWidth,D=n.strideDepth,O=n.strideHeight,P=n.strideWidth,F=C-1-n.padInfo.front,z=M-1-n.padInfo.top,j=_-1-n.padInfo.left,B=0;B<S;++B)for(var U=0;U<E;++U)for(var W=0;W<T;++W)for(var G=W-F,V=Math.max(0,Math.ceil(G/D)),H=Math.min(L,(C+G)/D),Y=0;Y<I;++Y)for(var X=Y-z,q=Math.max(0,Math.ceil(X/O)),K=Math.min(A,(M+X)/O),Q=0;Q<k;++Q){for(var J=Q-j,Z=Math.max(0,Math.ceil(J/P)),$=Math.min(R,(_+J)/P),ee=0,te=V;te<H;++te)for(var ne=te*D-G,re=q;re<K;++re)for(var ae=re*O-X,ie=Z;ie<$;++ie)for(var oe=d*B+h*te+p*re+g*ie,se=b*(C-1-ne)+y*(M-1-ae)+x*(_-1-(ie*P-J))+w*U,ce=0;ce<N;++ce)ee+=l[oe+ce]*m[se+ce];a[o*B+s*W+c*Y+u*Q+U]=ee}return r.toTensor()},t.prototype.conv2dDerFilter=function(e,t,n){f8([e,t],"conv2dDerFilter");for(var r=n.strideHeight,a=n.strideWidth,i=n.filterHeight,o=n.filterWidth,s="channelsLast"===n.dataFormat,c=i0(n.filterShape,"float32"),u=n.padInfo.left,l=n.padInfo.top,f=this.bufferSync(e),d=this.bufferSync(t),h=0;h<i;++h)for(var p=Math.max(0,Math.ceil((l-h)/r)),g=Math.min(n.outHeight,(n.inHeight+l-h)/r),m=0;m<o;++m)for(var v=Math.max(0,Math.ceil((u-m)/a)),b=Math.min(n.outWidth,(n.inWidth+u-m)/a),y=0;y<n.inChannels;++y)for(var x=0;x<n.outChannels;++x){for(var w=0,S=0;S<n.batchSize;++S)for(var C=p;C<g;++C)for(var M=h+C*r-l,_=v;_<b;++_){var E=m+_*a-u;w+=s?f.get(S,M,E,y)*d.get(S,C,_,x):f.get(S,y,M,E)*d.get(S,x,C,_)}c.set(w,h,m,y,x)}return c.toTensor()},t.prototype.conv3dDerFilter=function(e,t,n){for(var r=n.strideDepth,a=n.strideHeight,i=n.strideWidth,o=n.filterDepth,s=n.filterHeight,c=n.filterWidth,u=i0(n.filterShape,"float32"),l=u.values,f=u.strides,d=f[0],h=f[1],p=f[2],g=f[3],m=this.readSync(t.dataId),v=t.strides,b=v[0],y=v[1],x=v[2],w=v[3],S=this.readSync(e.dataId),C=e.strides,M=C[0],_=C[1],E=C[2],T=C[3],I=n.padInfo.front,k=n.padInfo.left,N=n.padInfo.top,L=0;L<o;++L)for(var A=Math.max(0,Math.ceil((I-L)/r)),R=Math.min(n.outDepth,(n.inDepth+I-L)/r),D=L*d,O=0;O<s;++O)for(var P=Math.max(0,Math.ceil((N-O)/a)),F=Math.min(n.outHeight,(n.inHeight+N-O)/a),z=O*h+D,j=0;j<c;++j)for(var B=Math.max(0,Math.ceil((k-j)/i)),U=Math.min(n.outWidth,(n.inWidth+k-j)/i),W=j*p+z,G=0;G<n.inChannels;++G)for(var V=G*g+W,H=0;H<n.outChannels;++H){for(var Y=0,X=0;X<n.batchSize;++X)for(var q=X*M,K=X*b,Q=A;Q<R;++Q)for(var J=(L+Q*r-I)*_+q,Z=Q*y+K,$=P;$<F;++$)for(var ee=(O+$*a-N)*E+J,te=$*x+Z,ne=B;ne<U;++ne){var re=ne*w+te;Y+=S[(j+ne*i-k)*T+ee+G]*m[re+H]}l[V+H]=Y}return u.toTensor()},t.prototype.fusedDepthwiseConv2D=function(e){var t=e.input,n=e.filter,r=e.convInfo,a=e.bias,i=e.activation,o=e.preluActivationWeights,s=this.depthwiseConv2D(t,n,r);return a&&(s=this.add(s,a)),i&&(s=d8(this,s,i,o)),s},t.prototype.depthwiseConv2D=function(e,t,n){f8([e,t],"depthwiseConv2D");for(var r=n.filterHeight,a=n.filterWidth,i=n.dilationHeight,o=n.dilationWidth,s=n.padInfo.left,c=n.padInfo.top,u=n.outChannels/n.inChannels,l=i0(n.outShape,e.dtype),f=this.readSync(e.dataId),d=this.readSync(t.dataId),h=l.values,p=0;p<n.batchSize;++p)for(var g=p*e.strides[0],m=p*l.strides[0],v=0;v<n.outHeight;++v)for(var b=m+v*l.strides[1],y=v*n.strideHeight-s,x=0;x<r;++x){var w=y+x*i;if(!(w<0||w>=n.inHeight))for(var S=x*t.strides[0],C=g+w*e.strides[1],M=0;M<n.outWidth;++M)for(var _=b+M*l.strides[2],E=M*n.strideWidth-c,T=0;T<a;++T){var I=E+T*o;if(!(I<0||I>=n.inWidth))for(var k=S+T*t.strides[1],N=C+I*n.inChannels,L=_,A=k,R=0;R<n.inChannels;++R){for(var D=f[N+R],O=0;O<u;++O)h[L+O]+=D*d[A+O];L+=u,A+=u}}}return l.toTensor()},t.prototype.depthwiseConv2DDerInput=function(e,t,n){f8([e,t],"depthwiseConv2DDerInput");for(var r=i0(n.inShape,"float32"),a=r.values,i=r.strides,o=i[0],s=i[1],c=i[2],u=this.readSync(e.dataId),l=e.strides,f=l[0],d=l[1],h=l[2],p=this.readSync(t.dataId),g=t.strides,m=g[0],v=g[1],b=g[2],y=n.batchSize,x=n.filterHeight,w=n.filterWidth,S=n.inChannels,C=n.inHeight,M=n.inWidth,_=n.outChannels,E=n.outHeight,T=n.outWidth,I=n.strideHeight,k=n.strideWidth,N=x-1-n.padInfo.top,L=w-1-n.padInfo.left,A=_/S,R=0;R<y;++R)for(var D=0;D<S;++D)for(var O=0;O<C;++O)for(var P=O-N,F=Math.max(0,Math.ceil(P/I)),z=Math.min(E,(x+P)/I),j=0;j<M;++j){for(var B=j-L,U=Math.max(0,Math.ceil(B/k)),W=Math.min(T,(w+B)/k),G=0,V=F;V<z;++V)for(var H=V*I-P,Y=U;Y<W;++Y)for(var X=f*R+d*V+h*Y,q=m*(x-1-H)+v*(w-1-(Y*k-B))+b*D,K=0;K<A;++K)G+=u[X+(D*A+K)]*p[q+K];a[o*R+s*O+c*j+D]=G}return r.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(e,t,n){f8([e,t],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,a=n.strideWidth,i=n.filterHeight,o=n.filterWidth,s=i0(n.filterShape,"float32"),c=n.padInfo.left,u=n.padInfo.top,l=n.outChannels/n.inChannels,f=this.bufferSync(e),d=this.bufferSync(t),h=0;h<i;++h)for(var p=Math.max(0,Math.ceil((u-h)/r)),g=Math.min(n.outHeight,(n.inHeight+u-h)/r),m=0;m<o;++m)for(var v=Math.max(0,Math.ceil((c-m)/a)),b=Math.min(n.outWidth,(n.inWidth+c-m)/a),y=0;y<n.outChannels;++y){for(var x=Math.trunc(y/l),w=y%l,S=0,C=0;C<n.batchSize;++C)for(var M=p;M<g;++M)for(var _=h+M*r-u,E=v;E<b;++E){var T=m+E*a-c;S+=f.get(C,_,T,x)*d.get(C,M,E,y)}s.set(S,h,m,x,w)}return s.toTensor()},t.prototype.tile=function(e,t){return f8(e,"tile"),A1(this.bufferSync(e),t)},t.prototype.pad=function(e,t,n){f8(e,"pad");var r=t.map((function(t,n){return t[0]+e.shape[n]+t[1]})),a=t.map((function(e){return e[0]})),i=this.bufferSync(e),o=i0(r,e.dtype);0!==n&&o.values.fill(n);for(var s=0;s<e.size;s++){var c=i.indexToLoc(s),u=c.map((function(e,t){return e+a[t]}));o.set.apply(o,[i.get.apply(i,c)].concat(u))}return o.toTensor()},t.prototype.transpose=function(e,t){f8(e,"transpose");for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[t[r]];var a=this.readSync(e.dataId),i=i0(n,e.dtype),o=this.bufferSync(e);for(r=0;r<e.size;++r){for(var s=o.indexToLoc(r),c=new Array(s.length),u=0;u<c.length;u++)c[u]=s[t[u]];var l=i.locToIndex(c);i.values[l]=a[r]}return i.toTensor()},t.prototype.gather=function(e,t,n){f8([e,t],"gather");var r=e.shape.slice(),a=this.readSync(t.dataId);r[n]=a.length;for(var i=i0(r,e.dtype),o=this.bufferSync(e),s=0;s<i.size;++s){var c=i.indexToLoc(s),u=c.slice();u[n]=a[c[n]];var l=o.locToIndex(u);i.values[s]=o.values[l]}return i.toTensor()},t.prototype.batchToSpaceND=function(e,t,n){f8([e],"batchToSpaceND");var r=t.reduce((function(e,t){return e*t})),a=A0(e.shape,t,r),i=R0(a.length,t.length),o=D0(e.shape,t,r),s=O0(n,t.length),c=P0(o,n,t.length);return e.reshape(a).transpose(i).reshape(o).slice(s,c)},t.prototype.spaceToBatchND=function(e,t,n){f8([e],"spaceToBatchND");var r=t.reduce((function(e,t){return e*t})),a=[[0,0]];a.push.apply(a,n);for(var i=1+t.length;i<e.shape.length;++i)a.push([0,0]);var o=e.pad(a),s=A0(o.shape,t,r,!1),c=R0(s.length,t.length,!1),u=D0(o.shape,t,r,!1);return o.reshape(s).transpose(c).reshape(u)},t.prototype.pool=function(e,t,n){f8(e,"pool");for(var r=t.strideHeight,a=t.strideWidth,i=t.dilationHeight,o=t.dilationWidth,s=t.effectiveFilterHeight,c=t.effectiveFilterWidth,u=t.padInfo.top,l=t.padInfo.left,f="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,d=this.readSync(e.dataId),h=i0(t.outShape,e.dtype),p=h.values,g=t.outShape[1]*t.outShape[2]*t.outShape[3],m=t.outShape[2]*t.outShape[3],v=t.outShape[3],b=0;b<t.batchSize;++b)for(var y=b*g,x=b*e.strides[0],w=0;w<t.inChannels;++w)for(var S=0;S<t.outHeight;++S)for(var C=S*r-u,M=Math.max(0,C),_=Math.min(t.inHeight,s+C),E=y+S*m,T=0;T<t.outWidth;++T){for(var I=T*a-l,k=Math.max(0,I),N=Math.min(t.inWidth,c+I),L=f,A=0,R=0,D=M;D<_;D+=i){for(var O=x+D*e.strides[1],P=k;P<N;P+=o){var F=d[O+P*e.strides[2]+w];"max"===n&&F>L?L=F:"avg"===n&&(A+=F,R++)}if(isNaN(L))break}p[E+T*v+w]="avg"===n?A/R:L}return h.toTensor()},t.prototype.maxPool=function(e,t){return this.pool(e,t,"max")},t.prototype.maxPoolPositions=function(e,t){for(var n=i0(t.outShape,"int32"),r=t.strideHeight,a=t.strideWidth,i=t.dilationHeight,o=t.dilationWidth,s=t.effectiveFilterHeight,c=t.effectiveFilterWidth,u=t.padInfo.top,l=t.padInfo.left,f=this.bufferSync(e),d=0;d<t.batchSize;++d)for(var h=0;h<t.inChannels;++h)for(var p=0;p<t.outHeight;++p){for(var g=p*r-u,m=g;m<0;)m+=i;for(var v=Math.min(t.inHeight,s+g),b=0;b<t.outWidth;++b){for(var y=b*a-l,x=y;x<0;)x+=o;for(var w=Math.min(t.inWidth,c+y),S=Number.NEGATIVE_INFINITY,C=-1,M=m;M<v;M+=i)for(var _=M-g,E=x;E<w;E+=o){var T=E-y,I=f.get(d,M,E,h);I>S&&(S=I,C=_*c+T)}n.set(C,d,p,b,h)}}return n.toTensor()},t.prototype.maxPoolBackprop=function(e,t,n,r){f8([t,n],"maxPoolBackprop");for(var a=this.maxPoolPositions(t,r),i=r.strideHeight,o=r.strideWidth,s=r.dilationHeight,c=r.dilationWidth,u=r.effectiveFilterHeight,l=r.effectiveFilterWidth,f=l-1-r.padInfo.left,d=u-1-r.padInfo.top,h=i0(t.shape,"float32"),p=this.bufferSync(a),g=this.bufferSync(e),m=0;m<r.batchSize;++m)for(var v=0;v<r.inChannels;++v)for(var b=0;b<r.inHeight;++b)for(var y=0;y<r.inWidth;++y){for(var x=b-d,w=y-f,S=0,C=0;C<u;C+=s){var M=(x+C)/i;if(!(M<0||M>=r.outHeight||Math.floor(M)!==M))for(var _=0;_<l;_+=c){var E=(w+_)/o;if(!(E<0||E>=r.outWidth||Math.floor(E)!==E)){var T=u*l-1-p.get(m,M,E,v)===C*l+_?1:0;0!==T&&(S+=g.get(m,M,E,v)*T)}}}h.set(S,m,b,y,v)}return h.toTensor()},t.prototype.avgPoolBackprop=function(e,t,n){f8([e,t],"avgPoolBackprop");for(var r=n.strideHeight,a=n.strideWidth,i=n.filterHeight,o=n.filterWidth,s=n.dilationHeight,c=n.dilationWidth,u=n.effectiveFilterHeight,l=n.effectiveFilterWidth,f=l-1-n.padInfo.left,d=u-1-n.padInfo.top,h=i0(t.shape,"float32"),p=1/(i*o),g=this.bufferSync(e),m=0;m<n.batchSize;++m)for(var v=0;v<n.inChannels;++v)for(var b=0;b<n.inHeight;++b)for(var y=0;y<n.inWidth;++y){for(var x=b-d,w=y-f,S=0,C=0;C<u;C+=s){var M=(x+C)/r;if(!(M<0||M>=n.outHeight||Math.floor(M)!==M))for(var _=0;_<l;_+=c){var E=(w+_)/a;E<0||E>=n.outWidth||Math.floor(E)!==E||(S+=g.get(m,M,E,v))}}h.set(S*p,m,b,y,v)}return h.toTensor()},t.prototype.pool3d=function(e,t,n){f8(e,"pool3d");for(var r=t.strideDepth,a=t.strideHeight,i=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,c=t.dilationWidth,u=t.effectiveFilterDepth,l=t.effectiveFilterHeight,f=t.effectiveFilterWidth,d=t.padInfo.front,h=t.padInfo.top,p=t.padInfo.left,g="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=this.readSync(e.dataId),v=i0(t.outShape,e.dtype),b=v.values,y=t.outShape[1]*t.outShape[2]*t.outShape[3]*t.outShape[4],x=t.outShape[2]*t.outShape[3]*t.outShape[4],w=t.outShape[3]*t.outShape[4],S=t.outShape[4],C=0;C<t.batchSize;++C)for(var M=C*y,_=C*e.strides[0],E=0;E<t.inChannels;++E)for(var T=0;T<t.outDepth;++T){for(var I=T*r-d,k=I;k<0;)k+=o;for(var N=Math.min(t.inDepth,u+I),L=M+T*x,A=0;A<t.outHeight;++A){for(var R=A*a-h,D=R;D<0;)D+=s;for(var O=Math.min(t.inHeight,l+R),P=L+A*w,F=0;F<t.outWidth;++F){for(var z=F*i-p,j=z;j<0;)j+=c;for(var B=Math.min(t.inWidth,f+z),U=P+F*S,W=g,G=0,V=0,H=k;H<N;H+=o){for(var Y=_+H*e.strides[1],X=D;X<O;X+=s){for(var q=Y+X*e.strides[2],K=j;K<B;K+=c){var Q=m[q+K*e.strides[3]+E];if("max"===n&&Q>W?W=Q:"avg"===n&&(G+=Q,V++),isNaN(W))break}if(isNaN(W))break}if(isNaN(W))break}b[U+E]="avg"===n?G/V:W}}}return v.toTensor()},t.prototype.avgPool3d=function(e,t){return f8(e,"avgPool3d"),this.pool3d(e,t,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(e,t,n){f8([e,t],"avgPool3dBackprop");for(var r=n.strideDepth,a=n.strideHeight,i=n.strideWidth,o=n.filterDepth,s=n.filterHeight,c=n.filterWidth,u=n.dilationDepth,l=n.dilationHeight,f=n.dilationWidth,d=n.effectiveFilterDepth,h=n.effectiveFilterHeight,p=n.effectiveFilterWidth,g=d-1-n.padInfo.front,m=p-1-n.padInfo.left,v=h-1-n.padInfo.top,b=i0(t.shape,"float32"),y=1/(o*s*c),x=this.bufferSync(e),w=0;w<n.batchSize;++w)for(var S=0;S<n.inChannels;++S)for(var C=0;C<n.inDepth;++C)for(var M=0;M<n.inHeight;++M)for(var _=0;_<n.inWidth;++_){for(var E=C-g,T=M-v,I=_-m,k=0,N=0;N<d;N+=u){var L=(E+N)/r;if(!(L<0||L>=n.outDepth||Math.floor(L)!==L))for(var A=0;A<h;A+=l){var R=(T+A)/a;if(!(R<0||R>=n.outHeight||Math.floor(R)!==R))for(var D=0;D<p;D+=f){var O=(I+D)/i;O<0||O>=n.outWidth||Math.floor(O)!==O||(k+=x.get(w,L,R,O,S))}}}b.set(k*y,w,C,M,_,S)}return b.toTensor()},t.prototype.maxPool3d=function(e,t){return f8(e,"maxPool3d"),this.pool3d(e,t,"max").toFloat()},t.prototype.maxPool3dPositions=function(e,t){for(var n=i0(t.outShape,"int32"),r=t.strideDepth,a=t.strideHeight,i=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,c=t.dilationWidth,u=t.effectiveFilterDepth,l=t.effectiveFilterHeight,f=t.effectiveFilterWidth,d=t.padInfo.front,h=t.padInfo.top,p=t.padInfo.left,g=this.bufferSync(e),m=0;m<t.batchSize;++m)for(var v=0;v<t.inChannels;++v)for(var b=0;b<t.outDepth;++b){for(var y=b*r-d,x=y;x<0;)x+=o;for(var w=Math.min(t.inDepth,u+y),S=0;S<t.outHeight;++S){for(var C=S*a-h,M=C;M<0;)M+=s;for(var _=Math.min(t.inHeight,l+C),E=0;E<t.outWidth;++E){for(var T=E*i-p,I=T;I<0;)I+=c;for(var k=Math.min(t.inWidth,f+T),N=Number.NEGATIVE_INFINITY,L=-1,A=x;A<w;A+=o)for(var R=A-y,D=M;D<_;D+=s)for(var O=D-C,P=I;P<k;P+=c){var F=P-T,z=g.get(m,A,D,P,v);z>=N&&(N=z,L=R*l*f+O*l+F)}n.set(L,m,b,S,E,v)}}}return n.toTensor()},t.prototype.maxPool3dBackprop=function(e,t,n,r){f8([t,n],"maxPool3dBackprop");for(var a=this.maxPool3dPositions(t,r),i=r.strideDepth,o=r.strideHeight,s=r.strideWidth,c=r.dilationDepth,u=r.dilationHeight,l=r.dilationWidth,f=r.effectiveFilterDepth,d=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=f-1-r.padInfo.front,g=h-1-r.padInfo.left,m=d-1-r.padInfo.top,v=i0(t.shape,"float32"),b=this.bufferSync(a),y=this.bufferSync(e),x=0;x<r.batchSize;++x)for(var w=0;w<r.inChannels;++w)for(var S=0;S<r.inDepth;++S)for(var C=0;C<r.inHeight;++C)for(var M=0;M<r.inWidth;++M){for(var _=S-p,E=C-m,T=M-g,I=0,k=0;k<f;k+=c){var N=(_+k)/i;if(!(N<0||N>=r.outDepth||Math.floor(N)!==N))for(var L=0;L<d;L+=u){var A=(E+L)/o;if(!(A<0||A>=r.outHeight||Math.floor(A)!==A))for(var R=0;R<h;R+=l){var D=(T+R)/s;if(!(D<0||D>=r.outWidth||Math.floor(D)!==D)){var O=f*d*h-1-b.get(x,N,A,D,w)===k*d*h+L*h+R?1:0;0!==O&&(I+=y.get(x,N,A,D,w)*O)}}}}v.set(I,x,S,C,M,w)}return v.toTensor()},t.prototype.cast=function(e,t){return m1(e,t,this)},t.prototype.reshape=function(e,t){return v1(e,t)},t.prototype.avgPool=function(e,t){return f8(e,"avgPool"),this.pool(e,t,"avg").toFloat()},t.prototype.resizeBilinear=function(e,t,n,r){f8(e,"resizeBilinear");for(var a=e.shape,i=a[0],o=a[1],s=a[2],c=a[3],u=this.readSync(e.dataId),l=new Float32Array(KQ([i,t,n,c])),f=[r&&t>1?o-1:o,r&&n>1?s-1:s],d=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=0,p=f[0]/d[0],g=f[1]/d[1],m=0;m<i;m++)for(var v=0;v<t;v++)for(var b=p*v,y=Math.floor(b),x=b-y,w=Math.min(o-1,Math.ceil(b)),S=m*e.strides[0]+y*e.strides[1],C=m*e.strides[0]+w*e.strides[1],M=0;M<n;M++)for(var _=g*M,E=Math.floor(_),T=_-E,I=Math.min(s-1,Math.ceil(_)),k=S+E*e.strides[2],N=C+E*e.strides[2],L=S+I*e.strides[2],A=C+I*e.strides[2],R=0;R<c;R++){var D=u[k+R],O=u[N+R],P=D+(u[L+R]-D)*T,F=P+(O+(u[A+R]-O)*T-P)*x;l[h++]=F}return I$(l,[i,t,n,c])},t.prototype.resizeBilinearBackprop=function(e,t,n){f8([e,t],"resizeBilinearBackprop");for(var r=t.shape,a=r[0],i=r[1],o=r[2],s=r[3],c=e.shape,u=c[1],l=c[2],f=new Float32Array(a*i*o*s),d=[n&&u>1?i-1:i,n&&l>1?o-1:o],h=[n&&u>1?u-1:u,n&&l>1?l-1:l],p=d[0]/h[0],g=d[1]/h[1],m=this.readSync(e.dataId),v=0,b=0;b<a;b++)for(var y=b*t.strides[0],x=0;x<u;x++)for(var w=x*p,S=Math.floor(w),C=Math.min(Math.ceil(w),i-1),M=y+S*t.strides[1],_=y+C*t.strides[1],E=w-S,T=1-E,I=0;I<l;I++)for(var k=I*g,N=Math.floor(k),L=Math.min(Math.ceil(k),o-1),A=k-N,R=1-A,D=M+N*t.strides[2],O=M+L*t.strides[2],P=_+N*t.strides[2],F=_+L*t.strides[2],z=T*R,j=T*A,B=E*R,U=E*A,W=0;W<s;W++){var G=m[v++];f[D+W]+=G*z,f[O+W]+=G*j,f[P+W]+=G*B,f[F+W]+=G*U}return D$(f,[a,o,i,s],t.dtype)},t.prototype.resizeNearestNeighbor=function(e,t,n,r){f8(e,"resizeNearestNeighbor");for(var a=e.shape,i=a[0],o=a[1],s=a[2],c=a[3],u=this.readSync(e.dataId),l=new Float32Array(i*t*n*c),f=[r&&t>1?o-1:o,r&&n>1?s-1:s],d=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=f[0]/d[0],p=f[1]/d[1],g=0,m=0;m<i;m++)for(var v=m*e.strides[0],b=0;b<t;b++)for(var y=h*b,x=v+Math.min(o-1,r?Math.round(y):Math.floor(y))*e.strides[1],w=0;w<n;w++)for(var S=p*w,C=x+Math.min(s-1,r?Math.round(S):Math.floor(S))*e.strides[2],M=0;M<c;M++){var _=u[C+M];l[g++]=_}return I$(l,[i,t,n,c],e.dtype)},t.prototype.resizeNearestNeighborBackprop=function(e,t,n){f8([e,t],"resizeNearestNeighborBackprop");for(var r=t.shape,a=r[0],i=r[1],o=r[2],s=r[3],c=e.shape,u=c[1],l=c[2],f=new Float32Array(a*i*o*s),d=this.readSync(e.dataId),h=[n&&u>1?i-1:i,n&&l>1?o-1:o],p=[n&&u>1?u-1:u,n&&l>1?l-1:l],g=h[0]/p[0],m=h[1]/p[1],v=1/g,b=1/m,y=2*Math.ceil(v)+2,x=2*Math.ceil(b)+2,w=0;w<a;w++)for(var S=w*t.strides[0],C=0;C<i;C++)for(var M=S+C*t.strides[1],_=Math.floor(C*v),E=Math.floor(_-y/2),T=0;T<o;T++)for(var I=M+T*t.strides[2],k=Math.floor(T*b),N=Math.floor(k-x/2),L=0;L<s;L++){for(var A=0,R=0;R<y;R++){var D=R+E;if(!(D<0||D>=u)){var O=S+D*e.strides[1],P=D*g;if(C===Math.min(i-1,n?Math.round(P):Math.floor(P)))for(var F=0;F<x;F++){var z=F+N;if(!(z<0||z>=l)){var j=O+z*e.strides[2],B=z*m;T===Math.min(o-1,n?Math.round(B):Math.floor(B))&&(A+=d[j+L])}}}}f[I+L]=A}return D$(f,t.shape,t.dtype)},t.prototype.batchNormalization=function(e,t,n,r,a,i){f8([e,t,n,a,i],"batchNorm");for(var o=this.readSync(e.dataId),s=this.readSync(t.dataId),c=this.readSync(n.dataId),u=a?this.readSync(a.dataId):new Float32Array([1]),l=i?this.readSync(i.dataId):new Float32Array([0]),f=new Float32Array(o.length),d=l.length,h=u.length,p=c.length,g=s.length,m=0,v=0,b=0,y=0,x=0;x<o.length;++x)f[x]=l[m++]+(o[x]-s[v++])*u[b++]/Math.sqrt(c[y++]+r),m>=d&&(m=0),v>=g&&(v=0),b>=h&&(b=0),y>=p&&(y=0);return D$(f,e.shape)},t.prototype.localResponseNormalization4D=function(e,t,n,r,a){f8(e,"localResponseNormalization4D");var i=e.shape[3],o=i-1,s=this.readSync(e.dataId),c=e.size,u=new Float32Array(c);function l(e){for(var n=e%i,r=e-n+Math.max(0,n-t),a=e-n+Math.min(n+t,o),c=0;r<=a;r++){var u=s[r];c+=u*u}return c}for(var f=0;f<c;f++){var d=l(f),h=s[f]*Math.pow(n+r*d,-a);u[f]=h}return D$(u,e.shape)},t.prototype.LRNGrad=function(e,t,n,r,a,i,o){f8(e,"LRNGrad");for(var s=e.shape[3],c=this.readSync(e.dataId),u=this.readSync(t.dataId),l=this.readSync(n.dataId),f=new Float32Array(e.size),d=e.size,h=0;h<d;h++){for(var p=h%s,g=h-p+Math.max(0,p-r),m=h-p+Math.min(s,p+r+1),v=0,b=g;b<m;b++)v+=Math.pow(u[b],2);for(v=i*v+a,b=g;b<m;b++){var y=-2*i*o*u[b]*l[h]/v;h===b&&(y+=Math.pow(v,-o)),y*=c[h],f[b]+=y}}return D$(f,e.shape)},t.prototype.multinomial=function(e,t,n,r){f8(e,"multinomial");for(var a=t?e:Q0(e),i=a.shape[0],o=a.shape[1],s=P$([i,n],"int32"),c=this.readSync(s.dataId),u=this.readSync(a.dataId),l=0;l<i;++l){var f=l*o,d=new Float32Array(o-1);d[0]=u[f];for(var h=1;h<d.length;++h)d[h]=d[h-1]+u[f+h];for(var p=t0(r.toString()),g=l*n,m=0;m<n;++m){var v=p();c[g+m]=d.length;for(var b=0;b<d.length;b++)if(v<d[b]){c[g+m]=b;break}}}return s},t.prototype.oneHot=function(e,t,n,r){f8(e,"oneHot");var a=new Float32Array(e.size*t);a.fill(r);for(var i=this.readSync(e.dataId),o=0;o<e.size;++o)i[o]>=0&&i[o]<t&&(a[o*t+i[o]]=n);return A$(a,[e.size,t],"int32")},t.prototype.nonMaxSuppression=function(e,t,n,r,a){return f8(e,"nonMaxSuppression"),_1(this.readSync(e.dataId),this.readSync(t.dataId),n,r,a)},t.prototype.fft=function(e){return this.fftBatch(e,!1)},t.prototype.ifft=function(e){return this.fftBatch(e,!0)},t.prototype.fftBatch=function(e,t){for(var n=e.shape[0],r=e.shape[1],a=i0(e.shape,"float32"),i=i0(e.shape,"float32"),o=E$(e).as2D(n,r),s=T$(e).as2D(n,r),c=0;c<n;c++)for(var u=o.slice([c,0],[1,r]),l=s.slice([c,0],[1,r]),f=_$(u,l),d=this.readSync(this.fftImpl(f,t).dataId),h=0;h<r;h++){var p=x1(d,h);a.values[c*r+h]=p.real,i.values[c*r+h]=p.imag}return _$(a.toTensor(),i.toTensor()).as2D(n,r)},t.prototype.fftImpl=function(e,t){var n=e.as1D(),r=n.size;if(this.isExponentOf2(r)){var a=this.fftRadix2(n,r,t).as2D(e.shape[0],e.shape[1]);return t&&(a=_$(E$(a).div(N$(r)),T$(a).div(N$(r)))),a}var i=this.readSync(e.dataId),o=function(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}(this.fourierTransformByMatmul(i,r,t));return _$(o.real,o.imag).as2D(e.shape[0],e.shape[1])},t.prototype.isExponentOf2=function(e){return 0==(e&e-1)},t.prototype.fftRadix2=function(e,t,n){if(1===t)return e;var r=this.readSync(e.dataId),a=t/2,i=function(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=0;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}(r),o=_$(i.real,i.imag).as1D(),s=function(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=2;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}(r),c=_$(s.real,s.imag).as1D();o=this.fftRadix2(o,a,n),c=this.fftRadix2(c,a,n);var u=function(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),a=0;a<Math.ceil(e/2);a++){var i=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(i),r[a]=Math.sin(i)}return{real:n,imag:r}}(t,n),l=_$(u.real,u.imag).mul(c),f=o.add(l),d=o.sub(l),h=E$(f).concat(E$(d)),p=T$(f).concat(T$(d));return _$(h,p).as1D()},t.prototype.fourierTransformByMatmul=function(e,t,n){for(var r=new Float32Array(2*t),a=0;a<t;a++){for(var i=0,o=0,s=0;s<t;s++){var c=S1(a*s,t,n),u=x1(e,s);i+=u.real*c.real-u.imag*c.imag,o+=u.real*c.imag+u.imag*c.real}n&&(i/=t,o/=t),w1(r,i,o,a)}return r},t.prototype.depthToSpace=function(e,t,n){HQ("NHWC"===n,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n})),HQ(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+t}));for(var r=e.shape[0],a=e.shape[1],i=e.shape[2],o=e.shape[3],s=a*t,c=i*t,u=o/(t*t),l=this.readSync(e.dataId),f=new Float32Array(r*s*c*u),d=0,h=0;h<r;++h)for(var p=0;p<s;++p)for(var g=Math.floor(p/t),m=p%t,v=0;v<c;++v)for(var b=Math.floor(v/t),y=(m*t+v%t)*u,x=0;x<u;++x){var w=x+y+o*(b+i*(g+a*h));f[d++]=l[w]}return D$(f,[r,s,c,u])},t.prototype.broadcastedBinaryOp=function(e,t,n,r){var a=r1(e.shape,t.shape),i=i0(a,n),o=this.readSync(e.dataId),s=this.readSync(t.dataId),c=t1(e.shape,a),u=t1(t.shape,a),l=i.values;if(c.length+u.length===0)for(var f=0;f<l.length;++f)l[f]=r(o[f%o.length],s[f%s.length]);else{var d=this.bufferSync(e),h=this.bufferSync(t),p=function(n){var a=i.indexToLoc(n),f=a.slice(-e.rank);c.forEach((function(e){return f[e]=0}));var p=d.locToIndex(f),g=a.slice(-t.rank);u.forEach((function(e){return g[e]=0}));var m=h.locToIndex(g);l[n]=r(o[p],s[m])};for(f=0;f<l.length;++f)p(f)}return i.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(e,t,n){var r=r1(e.shape,t.shape),a=i0(r,"float32"),i=i0(r,"float32"),o=this.readSync(e.dataId),s=this.readSync(t.dataId),c=t1(e.shape,r),u=t1(t.shape,r),l=a.values,f=i.values;if(c.length+u.length===0)for(var d=0;d<l.length;d++){var h=d%o.length,p=d%s.length,g=n(o[2*h],o[2*h+1],s[2*p],s[2*p+1]);l[d]=g.real,f[d]=g.imag}else{var m=this.bufferSync(this.data.get(e.dataId).complexTensors.real),v=this.bufferSync(this.data.get(t.dataId).complexTensors.real),b=function(r){var i=a.indexToLoc(r),d=i.slice(-e.rank);c.forEach((function(e){return d[e]=0}));var h=m.locToIndex(d),p=i.slice(-t.rank);u.forEach((function(e){return p[e]=0}));var g=v.locToIndex(p),b=n(o[2*h],o[2*h+1],s[2*g],s[2*g+1]);l[r]=b.real,f[r]=b.imag};for(d=0;d<l.length;d++)b(d)}return this.complex(a.toTensor(),i.toTensor())},t.prototype.split=function(e,t,n){return L1(e,t,n)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(e,t,n,r,a,i){for(var o=e.shape,s=o[0],c=o[1],u=o[2],l=o[3],f=t.shape[0],d=r[0],h=r[1],p=i0([f,d,h,l],"float32"),g=this.readSync(t.dataId),m=this.readSync(n.dataId),v=this.readSync(e.dataId),b=e.strides,y=p.strides,x=0;x<f;x++){var w=4*x,S=g[w],C=g[w+1],M=g[w+2],_=g[w+3],E=m[x];if(!(E>=s))for(var T=d>1?(M-S)*(c-1)/(d-1):0,I=h>1?(_-C)*(u-1)/(h-1):0,k=0;k<d;k++){var N=d>1?S*(c-1)+k*T:.5*(S+M)*(c-1);if(N<0||N>c-1)for(var L=0;L<h;L++)for(var A=0;A<l;A++){var R=A+L*y[2]+k*y[1]+x*y[0];p.values[R]=i}else if("bilinear"===a){var D=Math.floor(N),O=Math.ceil(N),P=N-D;for(L=0;L<h;L++)if((H=h>1?C*(u-1)+L*I:.5*(C+_)*(u-1))<0||H>u-1)for(A=0;A<l;A++)R=A+L*y[2]+k*y[1]+x*y[0],p.values[R]=i;else{var F=Math.floor(H),z=Math.ceil(H),j=H-F;for(A=0;A<l;A++){var B=v[R=A+F*b[2]+D*b[1]+E*b[0]],U=v[R=A+z*b[2]+D*b[1]+E*b[0]],W=v[R=A+F*b[2]+O*b[1]+E*b[0]],G=B+(U-B)*j,V=W+(v[R=A+z*b[2]+O*b[1]+E*b[0]]-W)*j;R=A+L*y[2]+k*y[1]+x*y[0],p.values[R]=G+(V-G)*P}}}else for(L=0;L<h;++L){var H;if((H=h>1?C*(u-1)+L*I:.5*(C+_)*(u-1))<0||H>u-1)for(A=0;A<l;A++)R=A+L*y[2]+k*y[1]+x*y[0],p.values[R]=i;else{var Y=Math.round(H),X=Math.round(N);for(A=0;A<l;A++){var q=A+Y*b[2]+X*b[1]+E*b[0],K=A+L*y[2]+k*y[1]+x*y[0];p.values[K]=v[q]}}}}}return p.toTensor()},t.prototype.sparseToDense=function(e,t,n,r){var a=U0(0,e,n),i=a.sliceRank,o=a.numUpdates,s=a.sliceSize,c=a.strides,u=a.outputSize;return this.scatter(e,t,n,u,s,o,i,c,r,!1)},t.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],a=F0(e,t),i=a[0],o=a[1],s=a[2],c=a[3];if(0===o)return I$([],i,e.dtype);for(var u=new OJ([o,s],e.dtype),l=this.readSync(t.dataId),f=this.readSync(e.dataId),d=0;d<o;d++){for(var h=[],p=0,g=0;g<r;g++){var m=l[d*r+g];p+=m*c[g],h.push(m)}if(p<0||p>=e.size/s)throw new Error("Invalid indices: "+h+" does not index into "+e.shape);for(var v=0;v<s;v++)u.values[d*s+v]=f[p*s+v]}return u.toTensor().reshape(i)},t.prototype.scatterND=function(e,t,n){var r=U0(0,e,n),a=r.sliceRank,i=r.numUpdates,o=r.sliceSize,s=r.strides,c=r.outputSize,u=N$(0);return this.scatter(e,t,n,c,o,i,a,s,u,!0)},t.prototype.fill=function(e,t,n){var r=oJ(n=n||mJ(t),KQ(e));return r.fill(t),tZ.makeTensor(r,e,n,this)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){var t=oJ(e.dtype,KQ(e.shape));return this.makeOutput(t,e.shape,e.dtype)},t.prototype.linspace=function(e,t,n){return b1(e,t,n)},t.prototype.scatter=function(e,t,n,r,a,i,o,s,c,u){var l=[r/a,a],f=this.readSync(e.dataId),d=this.readSync(t.dataId);if(0===r)return I$([],n,t.dtype);var h=new OJ(l,t.dtype);h.values.fill(this.readSync(c.dataId)[0]);for(var p=0;p<i;p++){for(var g=[],m=0,v=0;v<o;v++){var b=f[p*o+v];g.push(b),m+=b*s[v]}if(m<0||m>=r/a)throw new Error("Invalid indices: "+g+" does not index into "+n);for(var y=0;y<a;y++)u?h.values[m*a+y]+=d[p*a+y]:h.values[m*a+y]=0===t.rank?d[0]:d[p*a+y]}return h.toTensor().reshape(n)},t}($0);tZ.registerBackend("cpu",(function(){return new h8}),1);for(var p8=0,g8=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t,i=a.boxes,o=a.scores,s=r,c=s.maxOutputSize,u=s.iouThreshold,l=s.scoreThreshold,f=s.softNmsSigma,d=n;f8(i,"NonMaxSuppressionWithScore");var h=E1(d.data.get(i.dataId).values,d.data.get(o.dataId).values,c,u,l,f);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n;f8(r,"square");for(var i=a.data.get(r.dataId).values,o=new Float32Array(i.length),s=0;s<i.length;++s){var c=i[s];o[s]=c*c}return{dataId:a.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:E4,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,a=r.a,i=r.b,o=n;f8([a,i],E4);var s=o.data.get(a.dataId).values,c=o.data.get(i.dataId).values,u=function(e,t,n,r,a,i){var o=r1(e,t),s=o.length,c=yJ(o),u=iJ(a,KQ(o)),l=e.length,f=t.length,d=yJ(e),h=yJ(t),p=t1(e,o),g=t1(t,o);if(p.length+g.length===0)for(var m=0;m<u.length;++m)u[m]=i(n[m%n.length],r[m%r.length]);else{var v=function(e){var t=kJ(e,s,c),a=t.slice(-l);p.forEach((function(e){return a[e]=0}));var o=IJ(a,l,d),m=t.slice(-f);g.forEach((function(e){return m[e]=0}));var v=IJ(m,f,h);u[e]=i(n[o],r[v])};for(m=0;m<u.length;++m)v(m)}return[u,o]}(a.shape,i.shape,s,c,a.dtype,(function(e,t){var n=e-t;return n*n})),l=u[0],f=u[1];return{dataId:o.write(l,f,a.dtype),shape:f,dtype:a.dtype}}}];p8<g8.length;p8++)zQ(g8[p8]);for(var m8,v8=function(e){this.variableNames=["A"];var t=B1(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n\n        vec4 values = "+t.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},b8=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=B1(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+n+".0);\n            vec4 values = "+t.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+t.output+" = result;\n      }\n    "},y8=0,x8=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.pixels,i=r.numChannels,o="undefined"!=typeof HTMLVideoElement&&a instanceof HTMLVideoElement,s="undefined"!=typeof HTMLImageElement&&a instanceof HTMLImageElement,c=o?[a.videoWidth,a.videoHeight]:[a.width,a.height],u=c[0],l=c[1],f=[l,u],d=[l,u,i];(s||o)&&(null==m8&&(m8=document.createElement("canvas").getContext("2d")),m8.canvas.width=u,m8.canvas.height=l,m8.drawImage(a,0,0,u,l),a=m8.canvas);var h=n.makeTensorInfo(f,"int32");n.texData.get(h.dataId).usage=iZ.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(h.dataId),a);var p=AQ().getBool("WEBGL_PACK")?new b8(d):new v8(d),g=n.runWebGLProgram(p,[h],"int32");return n.disposeData(h.dataId),g}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;u$("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var a=t,i=a.boxes,o=a.scores,s=r,c=s.maxOutputSize,u=s.iouThreshold,l=s.scoreThreshold,f=s.softNmsSigma,d=n,h=E1(d.readSync(i.dataId),d.readSync(o.dataId),c,u,l,f);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n,i=new Q3(r.shape,"return x * x;");return a.runWebGLProgram(i,[r],r.dtype)}},{kernelName:E4,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,a=r.a,i=r.b,o=n,s=AQ().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new p2("return (a - b) * (a - b);",a.shape,i.shape):new d2("return (a - b) * (a - b);",a.shape,i.shape);return o.compileAndRun(s,[a,i])}}];y8<x8.length;y8++)zQ(x8[y8]);for(var w8=0,S8=[{kernelName:"Square",gradFunc:function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().mul(2))}}}},{kernelName:E4,gradFunc:function(e,t){var n=t[0],r=t[1],a=N$(2);return{a:function(){return W6(e,W6(a,X6(n,r)))},b:function(){return W6(e,W6(a,X6(r,n)))}}}}];w8<S8.length;w8++)jQ(S8[w8]);var C8=function(){function e(){}return e.prototype.fetch=function(e,t){return fetch(e,t)},e.prototype.now=function(){return performance.now()},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got "+t);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},e}();AQ().get("IS_BROWSER")&&AQ().setPlatform("browser",new C8);var M8,_8=function(){function e(){this.util=n(3886),this.textEncoder=new this.util.TextEncoder}return e.prototype.fetch=function(e,t){return null!=AQ().global.fetch?AQ().global.fetch(e,t):(null==M8&&(M8=n(1065)),M8(e,t))},e.prototype.now=function(){var e=_Q.hrtime();return 1e3*e[0]+e[1]/1e6},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)},e}();AQ().get("IS_NODE")&&AQ().setPlatform("node",new _8);var E8={float32:4,int32:4,uint16:2,uint8:1,bool:1};function T8(e,t){for(var n={},r=0,a=function(t){var a=t.name,i=t.dtype,o=t.shape,s=KQ(o),c=void 0;if("quantization"in t){var u=t.quantization;if("uint8"!==u.dtype&&"uint16"!==u.dtype)throw new Error("Weight "+t.name+" has unknown quantization dtype "+u.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var l=E8[u.dtype],f=e.slice(r,r+s*l),d="uint8"===u.dtype?new Uint8Array(f):new Uint16Array(f);if("float32"===i)c=Float32Array.from(d,(function(e){return e*u.scale+u.min}));else{if("int32"!==i)throw new Error("Unsupported dtype in weight '"+a+"': "+i);c=Int32Array.from(d,(function(e){return Math.round(e*u.scale+u.min)}))}r+=s*l}else if("string"===i){var h=KQ(t.shape);c=[];for(var p=0;p<h;p++){var g=new Uint32Array(e.slice(r,r+4))[0];r+=4;var m=new Uint8Array(e.slice(r,r+g));c.push(m),r+=g}}else{var v=E8[i];if(f=e.slice(r,r+s*v),"float32"===i)c=new Float32Array(f);else if("int32"===i)c=new Int32Array(f);else{if("bool"!==i)throw new Error("Unsupported dtype in weight '"+a+"': "+i);c=new Uint8Array(f)}r+=s*v}n[a]=I$(c,o,i)},i=0,o=t;i<o.length;i++)a(o[i]);return n}function I8(e){if(null===e)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach((function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+e.constructor.name)}));var r=new Uint8Array(t),a=0;return n.forEach((function(e){r.set(new Uint8Array(e.buffer),a),a+=e.byteLength})),r.buffer}var k8="undefined"!=typeof EQ&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function N8(e){return k8?EQ.byteLength(e):new Blob([e]).size}function L8(e){var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function A8(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function R8(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:N8(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:N8(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}var D8=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerSaveRouter=function(t){e.getInstance().saveRouters.push(t)},e.registerLoadRouter=function(t){e.getInstance().loadRouters.push(t)},e.getSaveHandlers=function(t){return e.getHandlers(t,"save")},e.getLoadHandlers=function(t,n){return e.getHandlers(t,"load",n)},e.getHandlers=function(t,n,r){var a=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&a.push(n)})),a},e}(),O8="://",P8=function(){function e(){this.managers={}}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerManager=function(t,n){HQ(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith(O8)&&(t=t.slice(0,t.indexOf(O8))),HQ(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();HQ(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '"+t+"'."})),r.managers[t]=n},e.getManager=function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}();function F8(e){if(-1===e.indexOf(O8))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+P8.getSchemes().join(","));return{scheme:e.split(O8)[0],path:e.split(O8)[1]}}function z8(e,t,n){return void 0===n&&(n=!1),kQ(this,void 0,void 0,(function(){var r,a,i,o,s,c,u,l,f;return NQ(this,(function(d){switch(d.label){case 0:return HQ(e!==t,(function(){return"Old path and new path are the same: '"+e+"'"})),HQ((r=D8.getLoadHandlers(e)).length>0,(function(){return"Copying failed because no load handler is found for source URL "+e+"."})),HQ(r.length<2,(function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+e+"."})),a=r[0],HQ((i=D8.getSaveHandlers(t)).length>0,(function(){return"Copying failed because no save handler is found for destination URL "+t+"."})),HQ(i.length<2,(function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."})),o=i[0],s=F8(e).scheme,c=F8(e).path,u=s===F8(e).scheme,[4,a.load()];case 1:return l=d.sent(),n&&u?[4,P8.getManager(s).removeModel(c)]:[3,3];case 2:d.sent(),d.label=3;case 3:return[4,o.save(l)];case 4:return f=d.sent(),!n||u?[3,6]:[4,P8.getManager(s).removeModel(c)];case 5:d.sent(),d.label=6;case 6:return[2,f.modelArtifactsInfo]}}))}))}var j8="models_store",B8="model_info_store";function U8(){if(!AQ().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window||self,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function W8(e){var t=e.result;t.createObjectStore(j8,{keyPath:"modelPath"}),t.createObjectStore(B8,{keyPath:"modelPath"})}var G8=function(){function e(e){if(this.indexedDB=U8(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return e.prototype.save=function(e){return kQ(this,void 0,void 0,(function(){return NQ(this,(function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]}))}))},e.prototype.load=function(){return kQ(this,void 0,void 0,(function(){return NQ(this,(function(e){return[2,this.databaseAction(this.modelPath)]}))}))},e.prototype.databaseAction=function(e,t){var n=this;return new Promise((function(e,r){var a=n.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return W8(a)},a.onsuccess=function(){var i=a.result;if(null==t){var o=i.transaction(j8,"readonly"),s=o.objectStore(j8).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return i.close(),r(s.error)},o.oncomplete=function(){return i.close()}}else{var c,u=R8(t),l=i.transaction(B8,"readwrite"),f=l.objectStore(B8),d=f.put({modelPath:n.modelPath,modelArtifactsInfo:u});d.onsuccess=function(){var a=(c=i.transaction(j8,"readwrite")).objectStore(j8).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:u});a.onsuccess=function(){return e({modelArtifactsInfo:u})},a.onerror=function(e){var t=(f=l.objectStore(B8)).delete(n.modelPath);t.onsuccess=function(){return i.close(),r(a.error)},t.onerror=function(e){return i.close(),r(a.error)}}},d.onerror=function(e){return i.close(),r(d.error)},l.oncomplete=function(){null==c?i.close():c.oncomplete=function(){return i.close()}}}},a.onerror=function(e){return r(a.error)}}))},e.URL_SCHEME="indexeddb://",e}(),V8=function(e){return AQ().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(G8.URL_SCHEME)?(t=e.slice(G8.URL_SCHEME.length),new G8(t)):null;var t};D8.registerSaveRouter(V8),D8.registerLoadRouter(V8);var H8=function(){function e(){this.indexedDB=U8()}return e.prototype.listModels=function(){return kQ(this,void 0,void 0,(function(){var e=this;return NQ(this,(function(t){return[2,new Promise((function(t,n){var r=e.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return W8(r)},r.onsuccess=function(){var e=r.result,a=e.transaction(B8,"readonly"),i=a.objectStore(B8).getAll();i.onsuccess=function(){for(var e={},n=0,r=i.result;n<r.length;n++){var a=r[n];e[a.modelPath]=a.modelArtifactsInfo}t(e)},i.onerror=function(t){return e.close(),n(i.error)},a.oncomplete=function(){return e.close()}},r.onerror=function(e){return n(r.error)}}))]}))}))},e.prototype.removeModel=function(e){return kQ(this,void 0,void 0,(function(){var t=this;return NQ(this,(function(n){var r;return e=(r=e).startsWith(G8.URL_SCHEME)?r.slice(G8.URL_SCHEME.length):r,[2,new Promise((function(n,r){var a=t.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return W8(a)},a.onsuccess=function(){var t,i=a.result,o=i.transaction(B8,"readwrite"),s=o.objectStore(B8),c=s.get(e);c.onsuccess=function(){if(null==c.result)return i.close(),r(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var a=s.delete(e),o=function(){var a=(t=i.transaction(j8,"readwrite")).objectStore(j8).delete(e);a.onsuccess=function(){return n(c.result.modelArtifactsInfo)},a.onerror=function(e){return r(c.error)}};a.onsuccess=o,a.onerror=function(e){return o(),i.close(),r(c.error)}},c.onerror=function(e){return i.close(),r(c.error)},o.oncomplete=function(){null==t?i.close():t.oncomplete=function(){return i.close()}}},a.onerror=function(e){return r(a.error)}}))]}))}))},e}();if(AQ().getBool("IS_BROWSER"))try{P8.registerManager(G8.URL_SCHEME,new H8)}catch(lpe){}var Y8="/",X8="tensorflowjs_models",q8="info",K8="model_topology",Q8="weight_specs",J8="weight_data",Z8="model_metadata";function $8(e){return{info:[X8,e,q8].join(Y8),topology:[X8,e,K8].join(Y8),weightSpecs:[X8,e,Q8].join(Y8),weightData:[X8,e,J8].join(Y8),modelMetadata:[X8,e,Z8].join(Y8)}}function e7(e){var t=e.split(Y8);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(Y8)}var t7=function(){function e(e){if(!AQ().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=$8(this.modelPath)}return e.prototype.save=function(e){return kQ(this,void 0,void 0,(function(){var t,n,r;return NQ(this,(function(a){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),r=R8(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(e){if(k8)return EQ.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:r}]}catch(e){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}return[2]}))}))},e.prototype.load=function(){return kQ(this,void 0,void 0,(function(){var e,t,n,r,a,i,o;return NQ(this,(function(s){if(null==(e=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=r,null!=(a=this.LS.getItem(this.keys.modelMetadata))&&(i=JSON.parse(a),t.format=i.format,t.generatedBy=i.generatedBy,t.convertedBy=i.convertedBy,t.userDefinedMetadata=i.userDefinedMetadata),null==(o=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(e){if(k8){var t=EQ.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),a=0;a<n.length;++a)r.set([n.charCodeAt(a)],a);return r.buffer}(o),[2,t]}))}))},e.URL_SCHEME="localstorage://",e}(),n7=function(e){return AQ().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(t7.URL_SCHEME)?(t=e.slice(t7.URL_SCHEME.length),new t7(t)):null;var t};D8.registerSaveRouter(n7),D8.registerLoadRouter(n7);var r7=function(){function e(){HQ(AQ().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),HQ("undefined"==typeof window||void 0!==window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return e.prototype.listModels=function(){return kQ(this,void 0,void 0,(function(){var e,t,n,r,a,i;return NQ(this,(function(o){for(e={},t=X8+Y8,n=Y8+q8,r=0;r<this.LS.length;++r)(a=this.LS.key(r)).startsWith(t)&&a.endsWith(n)&&(i=e7(a),e[i]=JSON.parse(this.LS.getItem(a)));return[2,e]}))}))},e.prototype.removeModel=function(e){return kQ(this,void 0,void 0,(function(){var t,n;return NQ(this,(function(r){var a;if(e=(a=e).startsWith(t7.URL_SCHEME)?a.slice(t7.URL_SCHEME.length):a,t=$8(e),null==this.LS.getItem(t.info))throw new Error("Cannot find model at path '"+e+"'");return n=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,n]}))}))},e}();if(AQ().getBool("IS_BROWSER"))try{P8.registerManager(t7.URL_SCHEME,new r7)}catch(lpe){}function a7(e){return new Promise((function(e){return setTimeout(e)})).then(e)}var i7=function(){function e(t){if(!AQ().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelTopologyFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return e.prototype.save=function(e){return kQ(this,void 0,void 0,(function(){var t,n,r,a,i,o;return NQ(this,(function(s){switch(s.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n},a=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),(i=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,i.href=a,[4,a7((function(){return i.dispatchEvent(new MouseEvent("click"))}))];case 2:return s.sent(),null==e.weightData?[3,4]:((o=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,o.href=t,[4,a7((function(){return o.dispatchEvent(new MouseEvent("click"))}))]);case 3:s.sent(),s.label=4;case 4:return[2,{modelArtifactsInfo:R8(e)}]}}))}))},e.URL_SCHEME="downloads://",e}(),o7=function(){function e(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return e.prototype.load=function(){return kQ(this,void 0,void 0,(function(){var e,t,n=this;return NQ(this,(function(r){return e=this.files[0],t=this.files.slice(1),[2,new Promise((function(r,a){var i=new FileReader;i.onload=function(i){var o=JSON.parse(i.target.result),s=o.modelTopology;if(null!=s){0===t.length&&r({modelTopology:s});var c=o.weightsManifest;if(null!=c){var u;try{u=n.checkManifestAndWeightFiles(c,t)}catch(e){return void a(e)}var l=[],f=[],d=[];c.forEach((function(e){e.paths.forEach((function(e){f.push(e),d.push(null)})),l.push.apply(l,e.weights)})),c.forEach((function(e){e.paths.forEach((function(e){var t=new FileReader;t.onload=function(t){var n=t.target.result,a=f.indexOf(e);d[a]=n,-1===d.indexOf(null)&&r({modelTopology:s,weightSpecs:l,weightData:L8(d),format:o.format,generatedBy:o.generatedBy,convertedBy:o.convertedBy,userDefinedMetadata:o.userDefinedMetadata})},t.onerror=function(t){return a("Failed to weights data from file of path '"+e+"'.")},t.readAsArrayBuffer(u[e])}))}))}else a(new Error("weightManifest field is missing from file "+e.name))}else a(new Error("modelTopology field is missing from file "+e.name))},i.onerror=function(t){return a("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},i.readAsText(e)}))]}))}))},e.prototype.checkManifestAndWeightFiles=function(e,t){for(var n=[],r=t.map((function(e){return A8(e.name)})),a={},i=0,o=e;i<o.length;i++)o[i].paths.forEach((function(e){var i=A8(e);if(-1!==n.indexOf(i))throw new Error("Duplicate file basename found in weights manifest: '"+i+"'");if(n.push(i),-1===r.indexOf(i))throw new Error("Weight file with basename '"+i+"' is not provided.");a[e]=t[r.indexOf(i)]}));if(n.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+t.length+").");return a},e}();function s7(e,t,n,r){!function(e){HQ(null!=e&&Array.isArray(e)&&e.length>0,(function(){return"promises must be a none empty array"}))}(e),function(e,t){HQ(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction "+e})),HQ(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction "+t})),HQ(t>=e,(function(){return"startFraction must be no more than endFraction, but got startFraction "+e+" and endFraction "+t}))}(n=null==n?0:n,r=null==r?1:r);var a=0;return Promise.all(e.map((function(i){return i.then((function(i){var o=n+ ++a/e.length*(r-n);return t(o),i})),i})))}function c7(e,t){return kQ(this,void 0,void 0,(function(){var n,r,a,i,o,s,c,u,l;return NQ(this,(function(f){switch(f.label){case 0:return null==t&&(t={}),n=null==t.fetchFunc?AQ().platform.fetch:t.fetchFunc,r=e.map((function(e){return n(e,t.requestInit,{isBinary:!0})})),a=0,i=.5,null!=t.onProgress?[3,2]:[4,Promise.all(r)];case 1:return o=f.sent(),[3,4];case 2:return[4,s7(r,t.onProgress,a,i)];case 3:o=f.sent(),f.label=4;case 4:return s=o.map((function(e){return e.arrayBuffer()})),c=.5,u=1,null!=t.onProgress?[3,6]:[4,Promise.all(s)];case 5:return l=f.sent(),[3,8];case 6:return[4,s7(s,t.onProgress,c,u)];case 7:l=f.sent(),f.label=8;case 8:return[2,l]}}))}))}function u7(e){var t=this;return function(n,r,a){return void 0===r&&(r=""),kQ(t,void 0,void 0,(function(){var t,i,o,s,c,u,l,f,d,h;return NQ(this,(function(p){switch(p.label){case 0:if(t=n.map((function(){return!1})),i={},o=null!=a?a.map((function(){return!1})):[],s=[],n.forEach((function(e,n){var r=0;e.weights.forEach((function(e){var c="quantization"in e?e.quantization.dtype:e.dtype,u=E8[c]*KQ(e.shape),l=function(){t[n]=!0,null==i[n]&&(i[n]=[]),i[n].push({manifestEntry:e,groupOffset:r,sizeBytes:u})};null!=a?a.forEach((function(t,n){t===e.name&&(l(),o[n]=!0)})):l(),s.push(e.name),r+=u}))})),!o.every((function(e){return e})))throw c=a.filter((function(e,t){return!o[t]})),new Error("Could not find weights in manifest with names: "+c.join(", ")+". \nManifest JSON has weights with names: "+s.join(", ")+".");return u=t.reduce((function(e,t,n){return t&&e.push(n),e}),[]),l=[],u.forEach((function(e){n[e].paths.forEach((function(e){var t=r+(r.endsWith("/")?"":"/")+e;l.push(t)}))})),[4,e(l)];case 1:return f=p.sent(),d={},h=0,u.forEach((function(e){for(var t=n[e].paths.length,r=0,a=0;a<t;a++)r+=f[h+a].byteLength;for(var o=new ArrayBuffer(r),s=new Uint8Array(o),c=0,u=0;u<t;u++){var l=new Uint8Array(f[h+u]);s.set(l,c),c+=l.byteLength}i[e].forEach((function(e){var t=T8(o.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)d[n]=t[n]})),h+=t})),[2,d]}}))}))}}D8.registerSaveRouter((function(e){return AQ().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(i7.URL_SCHEME)?function(e){return void 0===e&&(e="model"),new i7(e)}(e.slice(i7.URL_SCHEME.length)):null}));var l7=function(){function e(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,null!=t.fetchFunc?(HQ("function"==typeof t.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=t.fetchFunc):this.fetch=AQ().platform.fetch,HQ(null!=e&&e.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(e)&&HQ(2===e.length,(function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."})),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return e.prototype.save=function(e){return kQ(this,void 0,void 0,(function(){var t,n,r,a;return NQ(this,(function(i){switch(i.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:n},t.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((a=i.sent()).ok)return[2,{modelArtifactsInfo:R8(e),responses:[a]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+a.status+".")}}))}))},e.prototype.load=function(){return kQ(this,void 0,void 0,(function(){var e,t,n,r,a,i,o,s,c,u,l,f;return NQ(this,(function(d){switch(d.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=d.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");d.label=2;case 2:return d.trys.push([2,4,,5]),[4,e.json()];case 3:return t=d.sent(),[3,5];case 4:throw d.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(r=t.modelTopology,a=t.weightsManifest,i=t.generatedBy,o=t.convertedBy,s=t.format,c=t.userDefinedMetadata,null==r&&null==a)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==a?[3,7]:[4,this.loadWeights(a)];case 6:f=d.sent(),u=f[0],l=f[1],d.label=7;case 7:return[2,{modelTopology:r,weightSpecs:u,weightData:l,userDefinedMetadata:c,generatedBy:i,convertedBy:o,format:s}]}}))}))},e.prototype.loadWeights=function(e){return kQ(this,void 0,void 0,(function(){var t,n,r,a,i,o,s,c,u,l,f;return NQ(this,(function(d){switch(d.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,n=function(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}(t),r=n[0],a=n[1],i=this.weightPathPrefix||r,o=[],s=0,c=e;s<c.length;s++)u=c[s],o.push.apply(o,u.weights);return l=[],e.forEach((function(e){e.paths.forEach((function(e){l.push(i+e+a)}))})),[4,c7(l,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return f=d.sent(),[2,[o,L8(f)]]}}))}))},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function f7(e){return null!=e.match(l7.URL_SCHEME_REGEX)}var d7=function(e,t){return"undefined"==typeof fetch?null:(Array.isArray(e)?e.every((function(e){return f7(e)})):f7(e))?h7(e,{onProgress:t}):null};function h7(e,t){return new l7(e,t)}D8.registerSaveRouter(d7),D8.registerLoadRouter(d7);var p7,g7=function(){function e(e){this.modelArtifacts=e}return e.prototype.load=function(){return kQ(this,void 0,void 0,(function(){return NQ(this,(function(e){return[2,this.modelArtifacts]}))}))},e}(),m7=function(){function e(e){this.saveHandler=e}return e.prototype.save=function(e){return kQ(this,void 0,void 0,(function(){return NQ(this,(function(t){return[2,this.saveHandler(e)]}))}))},e}(),v7=Object.freeze({browserFiles:function(e){return new o7(e)},browserHTTPRequest:function(e,t){return h7(e,t)},concatenateArrayBuffers:L8,decodeWeights:T8,encodeWeights:function(e,t){return kQ(this,void 0,void 0,(function(){var n,r,a,i,o,s=this;return NQ(this,(function(c){switch(c.label){case 0:for(n=[],r=[],a=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e),i=function(i){var o=a[i],c=Array.isArray(e)?e[i].tensor:e[o];if("float32"!==c.dtype&&"int32"!==c.dtype&&"bool"!==c.dtype&&"string"!==c.dtype)throw new Error("Unsupported dtype in weight '"+o+"': "+c.dtype);var u={name:o,shape:c.shape,dtype:c.dtype};if("string"===c.dtype){var l=new Promise((function(e){return kQ(s,void 0,void 0,(function(){var t,n,r,a,i,o,s;return NQ(this,(function(u){switch(u.label){case 0:return[4,c.bytes()];case 1:for(t=u.sent(),n=t.reduce((function(e,t){return e+t.length}),0)+4*t.length,r=new Uint8Array(n),a=0,i=0;i<t.length;i++)o=t[i],s=new Uint8Array(new Uint32Array([o.length]).buffer),r.set(s,a),a+=4,r.set(o,a),a+=o.length;return e(r),[2]}}))}))}));r.push(l)}else r.push(c.data());null!=t&&(u.group=t),n.push(u)},o=0;o<a.length;++o)i(o);return[4,Promise.all(r)];case 1:return[2,{data:I8(c.sent()),specs:n}]}}))}))},fromMemory:function(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new g7(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new g7({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new g7({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))},getLoadHandlers:function(e,t){return D8.getLoadHandlers(e,t)},getModelArtifactsInfoForJSON:R8,getSaveHandlers:function(e){return D8.getSaveHandlers(e)},http:h7,isHTTPScheme:f7,loadWeights:function(e,t,n,r){return void 0===t&&(t=""),kQ(this,void 0,void 0,(function(){return NQ(this,(function(a){return[2,u7((function(e){return c7(e,{requestInit:r})}))(e,t,n)]}))}))},registerLoadRouter:function(e){return D8.registerLoadRouter(e)},registerSaveRouter:function(e){return D8.registerSaveRouter(e)},weightsLoaderFactory:u7,withSaveHandler:function(e){return new m7(e)},copyModel:function(e,t){return kQ(this,void 0,void 0,(function(){return NQ(this,(function(n){return[2,z8(e,t,!1)]}))}))},listModels:function(){return kQ(this,void 0,void 0,(function(){var e,t,n,r,a,i,o;return NQ(this,(function(s){switch(s.label){case 0:e=P8.getSchemes(),t={},n=0,r=e,s.label=1;case 1:return n<r.length?(a=r[n],[4,P8.getManager(a).listModels()]):[3,4];case 2:for(o in i=s.sent())t[a+O8+o]=i[o];s.label=3;case 3:return n++,[3,1];case 4:return[2,t]}}))}))},moveModel:function(e,t){return kQ(this,void 0,void 0,(function(){return NQ(this,(function(n){return[2,z8(e,t,!0)]}))}))},removeModel:function(e){return kQ(this,void 0,void 0,(function(){var t;return NQ(this,(function(n){return t=F8(e),[2,P8.getManager(t.scheme).removeModel(t.path)]}))}))}}),b7=M$({confusionMatrix_:function(e,t,n){var r=d$(e,"labels","confusionMatrix"),a=d$(t,"predictions","confusionMatrix");HQ(null==n||n>0&&Number.isInteger(n),(function(){return"If provided, numClasses must be a positive integer, but got "+n})),HQ(1===r.rank,(function(){return"Expected the rank of labels to be 1, but got "+r.rank})),HQ(1===a.rank,(function(){return"Expected the rank of predictions to be 1, but got "+a.rank})),HQ(r.shape[0]===a.shape[0],(function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+a.shape[0]+". Labels and predictions should have the same number of elements."})),HQ(n>0&&Number.isInteger(n),(function(){return"numClasses is required to be a positive integer, but got "+n}));var i=g0(r.asType("int32"),n),o=g0(a.asType("int32"),n);return i.transpose().matMul(o).asType("int32")}}),y7=(Object.freeze({confusionMatrix:b7}),M$({fromPixels_:function(e,t){if(void 0===t&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,a=!1,i=!1,o=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)a=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)i=!0;else{if(null==e.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);o=!0}if(a&&a&&e.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=PQ("FromPixels",tZ.backendName))return tZ.runKernel("FromPixels",{pixels:e},{numChannels:t});var s,c,u=a?[e.videoWidth,e.videoHeight]:[e.width,e.height],l=u[0],f=u[1];if(o?s=e.getContext("2d").getImageData(0,0,l,f).data:r||n?s=e.data:(i||a)&&(null==p7&&(p7=document.createElement("canvas").getContext("2d")),p7.canvas.width=l,p7.canvas.height=f,p7.drawImage(e,0,0,l,f),s=p7.getImageData(0,0,l,f).data),4===t)c=new Int32Array(s);else{var d=l*f;c=new Int32Array(d*t);for(var h=0;h<d;h++)for(var p=0;p<t;++p)c[h*t+p]=s[4*h+p]}return R$(c,[f,l,t],"int32")}})),x7=Object.freeze({toPixels:function(e,t){return kQ(this,void 0,void 0,(function(){var n,r,a,i,o,s,c,u,l,f,d,h,p,g,m,v,b,y,x,w,S,C,M;return NQ(this,(function(_){switch(_.label){case 0:if(n=d$(e,"img","toPixels"),e instanceof jJ||(n=n.toInt()),2!==n.rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),a=r[0],i=r[1],(o=2===n.rank?1:n.shape[2])>4||2===o)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+o);return[4,n.data()];case 1:return s=_.sent(),c=n.min(),u=n.max(),[4,Promise.all([c.data(),u.data()])];case 2:if(l=_.sent(),f=l[0],d=l[1],h=f[0],p=d[0],c.dispose(),u.dispose(),"float32"===n.dtype){if(h<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+h+" - "+p+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(h<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+h+" - "+p+"].")}for(g="float32"===n.dtype?255:1,m=new Uint8ClampedArray(i*a*4),v=0;v<a*i;++v)b=void 0,y=void 0,x=void 0,w=void 0,1===o?(b=s[v]*g,y=s[v]*g,x=s[v]*g,w=255):3===o?(b=s[3*v]*g,y=s[3*v+1]*g,x=s[3*v+2]*g,w=255):4===o&&(b=s[4*v]*g,y=s[4*v+1]*g,x=s[4*v+2]*g,w=s[4*v+3]*g),m[0+(S=4*v)]=Math.round(b),m[S+1]=Math.round(y),m[S+2]=Math.round(x),m[S+3]=Math.round(w);return null!=t&&(t.width=i,t.height=a,C=t.getContext("2d"),M=new ImageData(m,i,a),C.putImageData(M,0,0)),n!==e&&n.dispose(),[2,m]}}))}))},fromPixels:y7}),w7=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(e,t){return new e(t)},e}(),S7=function(){function e(){this.classNameMap={}}return e.getMap=function(){return null==e.instance&&(e.instance=new e),e.instance},e.register=function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]},e}();function C7(e){HQ(null!=e.className,(function(){return"Class being registered does not have the static className property defined."})),HQ("string"==typeof e.className,(function(){return"className is required to be a string, but got type "+typeof e.className})),HQ(e.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),S7.register(e)}Object.freeze({Serializable:w7,SerializationMap:S7,registerClass:C7});function M7(){return 32===tZ.backend.floatPrecision()?.001:.1}function _7(e,t,n){var r=!0;if((lJ(e)||lJ(t))&&(r=!1),lJ(e)&&lJ(t)&&(r=!0),r){var a=e.constructor.name,i=t.constructor.name;if(a!==i)throw new Error("Arrays are of different type. Actual: "+a+". Expected: "+i)}if(Array.isArray(e)&&Array.isArray(t)){var o=l$(e),s=l$(t);if(!QQ(o,s))throw new Error("Arrays have different shapes. Actual: ["+o+"]. Expected: ["+s+"]")}var c=lJ(e)?e:qQ(e),u=lJ(t)?t:qQ(t);if(c.length!==u.length)throw new Error("Arrays have different lengths actual: "+c.length+" vs expected: "+u.length+".\nActual:   "+c+".\nExpected: "+u+".");for(var l=0;l<u.length;++l){var f=c[l],d=u[l];if(!n(f,d))throw new Error("Arrays differ: actual["+l+"] = "+f+", expected["+l+"] = "+d+".\nActual:   "+c+".\nExpected: "+u+".")}}function E7(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}Object.freeze({TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(e,t,n){return null==n&&(n=M7()),_7(e,t,(function(e,t){return E7(e,t,n)}))},testEpsilon:M7,expectPromiseToFail:function(e,t){e().then((function(){return t.fail()}),(function(){return t()}))},expectArraysEqual:function(e,t){var n="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return hJ(e)||hJ(e[0])||hJ(t)||hJ(t[0])?_7(e,n,(function(e,t){return e==t})):_7(e,t,(function(e,t){return E7(e,t,0)}))},expectNumbersClose:function(e,t,n){if(null==n&&(n=M7()),!E7(e,t,n))throw new Error("Numbers differ: actual === "+e+", expected === "+t)},expectValuesInRange:function(e,t,n){for(var r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error("Value out of range:"+e[r]+" low: "+t+", high: "+n)},expectArrayBuffersEqual:function(e,t){expect(new Float32Array(e)).toEqual(new Float32Array(t))}}),Object.freeze({gpgpu_util:u3,webgl_util:a$,forceHalfFloat:function(){AQ().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:M4,setWebGLContext:uZ,GPGPUContext:l3});var T7=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return IQ(t,e),t.prototype.minimize=function(e,t,n){void 0===t&&(t=!1);var r=this.computeGradients(e,n),a=r.value,i=r.grads;if(null!=n){var o=n.map((function(e){return{name:e.name,tensor:i[e.name]}}));this.applyGradients(o)}else this.applyGradients(i);return c$(i),t?a:(a.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(e,t){return function(e,t){HQ(vJ(e),(function(){return"The f passed in variableGrads(f) must be a function"})),HQ(null==t||Array.isArray(t)&&t.every((function(e){return e instanceof HJ})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var n=null!=t;if(!n)for(var r in t=[],tZ.registeredVariables)t.push(tZ.registeredVariables[r]);var a=n?t.filter((function(e){return!e.trainable})):null,i=t.length;HQ((t=t.filter((function(e){return e.trainable}))).length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+i+" variables is trainable."}));var o=tZ.gradients(e,t,null,!0),s=o.value,c=o.grads;HQ(c.some((function(e){return null!=e})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),HQ(0===s.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"}));var u={};return t.forEach((function(e,t){null!=c[t]&&(u[e.name]=c[t])})),null!=a&&a.forEach((function(e){return u[e.name]=null})),{value:s,grads:u}}(e,t)},t.prototype.dispose=function(){null!=this.iterations_&&c$(this.iterations_)},t.prototype.saveIterations=function(){return kQ(this,void 0,void 0,(function(){return NQ(this,(function(e){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:N$(this.iterations_,"int32")}]}))}))},t.prototype.getWeights=function(){return kQ(this,void 0,void 0,(function(){return NQ(this,(function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")}))}))},t.prototype.setWeights=function(e){return kQ(this,void 0,void 0,(function(){return NQ(this,(function(e){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())}))}))},t.prototype.extractIterations=function(e){return kQ(this,void 0,void 0,(function(){var t;return NQ(this,(function(n){switch(n.label){case 0:return t=this,[4,e[0].tensor.data()];case 1:return t.iterations_=n.sent()[0],[2,e.slice(1)]}}))}))},t}(w7);Object.defineProperty(T7,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var I7=function(e){function t(t,n,r){void 0===r&&(r=null);var a=e.call(this)||this;return a.learningRate=t,a.rho=n,a.epsilon=r,a.accumulatedGrads=[],a.accumulatedUpdates=[],null==r&&(a.epsilon=tZ.backend.epsilon()),a}return IQ(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=tZ.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accum_grad",variable:s$((function(){return B$(a).variable(!1)}))}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:n+"/accum_var",variable:s$((function(){return B$(a).variable(!1)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;s$((function(){var e=o.mul(t.rho).add(i.square().mul(1-t.rho)),n=s.add(t.epsilon).sqrt().div(o.add(t.epsilon).sqrt()).mul(i),r=s.mul(t.rho).add(n.square().mul(1-t.rho));o.assign(e),s.assign(r);var c=n.mul(-t.learningRate).add(a);a.assign(c)}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedUpdates&&(c$(this.accumulatedGrads.map((function(e){return e.variable}))),c$(this.accumulatedUpdates.map((function(e){return e.variable}))))},t.prototype.getWeights=function(){return kQ(this,void 0,void 0,(function(){var e;return NQ(this,(function(t){switch(t.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return kQ(this,void 0,void 0,(function(){var t;return NQ(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=e.length/2,this.accumulatedGrads=e.slice(0,t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedUpdates=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.rho,t.epsilon)},t.className="Adadelta",t}(T7);C7(I7);var k7=function(e){function t(t,n){void 0===n&&(n=.1);var r=e.call(this)||this;return r.learningRate=t,r.initialAccumulatorValue=n,r.accumulatedGrads=[],r}return IQ(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=tZ.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accumulator",variable:s$((function(){return F$(a.shape,t.initialAccumulatorValue).variable(!1)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable;s$((function(){var e=o.add(i.square());o.assign(e);var n=i.div(e.add(tZ.backend.epsilon()).sqrt()).mul(-t.learningRate).add(a);a.assign(n)}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedGrads&&c$(this.accumulatedGrads.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return kQ(this,void 0,void 0,(function(){return NQ(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return kQ(this,void 0,void 0,(function(){return NQ(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulatedGrads=e.map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)},t.className="Adagrad",t}(T7);C7(k7);var N7=function(e){function t(t,n,r,a){void 0===a&&(a=null);var i=e.call(this)||this;return i.learningRate=t,i.beta1=n,i.beta2=r,i.epsilon=a,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],s$((function(){i.accBeta1=N$(n).variable(),i.accBeta2=N$(r).variable()})),null==a&&(i.epsilon=tZ.backend.epsilon()),i}return IQ(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);s$((function(){var r=X6(1,t.accBeta1),a=X6(1,t.accBeta2);n.forEach((function(n,i){var o=tZ.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:n+"/m",variable:s$((function(){return B$(o).variable(!1)}))}),null==t.accumulatedSecondMoment[i]&&(t.accumulatedSecondMoment[i]={originalName:n+"/v",variable:s$((function(){return B$(o).variable(!1)}))});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var c=t.accumulatedFirstMoment[i].variable,u=t.accumulatedSecondMoment[i].variable,l=c.mul(t.beta1).add(s.mul(1-t.beta1)),f=u.mul(t.beta2).add(s.square().mul(1-t.beta2)),d=l.div(r),h=f.div(a);c.assign(l),u.assign(f);var p=d.div(h.sqrt().add(t.epsilon)).mul(-t.learningRate).add(o);o.assign(p)}})),t.accBeta1.assign(t.accBeta1.mul(t.beta1)),t.accBeta2.assign(t.accBeta2.mul(t.beta2))})),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&c$(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedSecondMoment&&c$(this.accumulatedSecondMoment.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return kQ(this,void 0,void 0,(function(){var e;return NQ(this,(function(t){switch(t.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return kQ(this,void 0,void 0,(function(){var t,n=this;return NQ(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),s$((function(){n.accBeta1.assign(V6(n.beta1,n.iterations_+1)),n.accBeta2.assign(V6(n.beta2,n.iterations_+1))})),t=e.length/2,this.accumulatedFirstMoment=e.slice(0,t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedSecondMoment=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)},t.className="Adam",t}(T7);C7(N7);var L7=function(e){function t(t,n,r,a,i){void 0===a&&(a=null),void 0===i&&(i=0);var o=e.call(this)||this;return o.learningRate=t,o.beta1=n,o.beta2=r,o.epsilon=a,o.decay=i,o.accumulatedFirstMoment=[],o.accumulatedWeightedInfNorm=[],s$((function(){o.iteration=N$(0).variable(),o.accBeta1=N$(n).variable()})),null==a&&(o.epsilon=tZ.backend.epsilon()),o}return IQ(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);s$((function(){var r=X6(1,t.accBeta1),a=A6(-t.learningRate,t.iteration.mul(t.decay).add(1));n.forEach((function(n,i){var o=tZ.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:n+"/m",variable:B$(o).variable(!1)}),null==t.accumulatedWeightedInfNorm[i]&&(t.accumulatedWeightedInfNorm[i]={originalName:n+"/v",variable:B$(o).variable(!1)});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var c=t.accumulatedFirstMoment[i].variable,u=t.accumulatedWeightedInfNorm[i].variable,l=c.mul(t.beta1).add(s.mul(1-t.beta1)),f=u.mul(t.beta2),d=s.abs(),h=f.maximum(d);c.assign(l),u.assign(h);var p=a.div(r).mul(l.div(h.add(t.epsilon))).add(o);o.assign(p)}})),t.iteration.assign(t.iteration.add(1)),t.accBeta1.assign(t.accBeta1.mul(t.beta1))})),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&c$(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedWeightedInfNorm&&c$(this.accumulatedWeightedInfNorm.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return kQ(this,void 0,void 0,(function(){return NQ(this,(function(e){throw new Error("getWeights() is not implemented for Adamax yet.")}))}))},t.prototype.setWeights=function(e){return kQ(this,void 0,void 0,(function(){return NQ(this,(function(e){throw new Error("setWeights() is not implemented for Adamax yet.")}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)},t.className="Adamax",t}(T7);C7(L7);var A7=function(e){function t(t){var n=e.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return IQ(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=tZ.registeredVariables[n];s$((function(){var e=t.c.mul(a).add(i);i.assign(e)}))}})),this.incrementIterations()},t.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=function(e){return tZ.keep(e)}(N$(-e))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return kQ(this,void 0,void 0,(function(){return NQ(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}}))}))},t.prototype.setWeights=function(e){return kQ(this,void 0,void 0,(function(){return NQ(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:if(0!==(e=t.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(e,t){return new e(t.learningRate)},t.className="SGD",t}(T7);C7(A7);var R7=function(e){function t(t,n,r){void 0===r&&(r=!1);var a=e.call(this,t)||this;return a.learningRate=t,a.momentum=n,a.useNesterov=r,a.accumulations=[],a.m=N$(a.momentum),a}return IQ(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=tZ.registeredVariables[n];null==t.accumulations[r]&&(t.accumulations[r]={originalName:n+"/momentum",variable:s$((function(){return B$(a).variable(!1)}))});var i=t.accumulations[r].variable,o=Array.isArray(e)?e[r].tensor:e[n];null!=o&&s$((function(){var e,n=t.m.mul(i).add(o);e=t.useNesterov?t.c.mul(o.add(n.mul(t.m))).add(a):t.c.mul(n).add(a),i.assign(n),a.assign(e)}))})),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&c$(this.accumulations.map((function(e){return e.variable})))},t.prototype.setMomentum=function(e){this.momentum=e},t.prototype.getWeights=function(){return kQ(this,void 0,void 0,(function(){return NQ(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return kQ(this,void 0,void 0,(function(){return NQ(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulations=e.map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)},t.className="Momentum",t}(A7);C7(R7);var D7=function(e){function t(t,n,r,a,i){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===a&&(a=null),void 0===i&&(i=!1);var o=e.call(this)||this;if(o.learningRate=t,o.decay=n,o.momentum=r,o.epsilon=a,o.accumulatedMeanSquares=[],o.accumulatedMoments=[],o.accumulatedMeanGrads=[],o.centered=i,null==a&&(o.epsilon=tZ.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.");return o}return IQ(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=tZ.registeredVariables[n];null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:n+"/rms",variable:s$((function(){return B$(a).variable(!1)}))}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:n+"/momentum",variable:s$((function(){return B$(a).variable(!1)}))}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:n+"/mg",variable:s$((function(){return B$(a).variable(!1)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedMeanSquares[r].variable,s=t.accumulatedMoments[r].variable;s$((function(){var e=o.mul(t.decay).add(i.square().mul(1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,c=n.mul(t.decay).add(i.mul(1-t.decay)),u=s.mul(t.momentum).add(i.mul(t.learningRate).div(e.sub(c.square().add(t.epsilon)).sqrt()));o.assign(e),n.assign(c),s.assign(u);var l=a.sub(u);a.assign(l)}else{var f=o.mul(t.decay).add(i.square().mul(1-t.decay));u=s.mul(t.momentum).add(i.mul(t.learningRate).div(f.add(t.epsilon).sqrt())),o.assign(f),s.assign(u),l=a.sub(u),a.assign(l)}}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&c$(this.accumulatedMeanSquares.map((function(e){return e.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&c$(this.accumulatedMeanGrads.map((function(e){return e.variable}))),null!=this.accumulatedMoments&&c$(this.accumulatedMoments.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return kQ(this,void 0,void 0,(function(){var e;return NQ(this,(function(t){switch(t.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return kQ(this,void 0,void 0,(function(){var t;return NQ(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=this.centered?e.length/3:e.length/2,this.accumulatedMeanSquares=e.slice(0,t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedMoments=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}))),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)},t.className="RMSProp",t}(T7);C7(D7);var O7=function(){function e(){}return e.sgd=function(e){return new A7(e)},e.momentum=function(e,t,n){return void 0===n&&(n=!1),new R7(e,t,n)},e.rmsprop=function(e,t,n,r,a){return void 0===t&&(t=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===a&&(a=!1),new D7(e,t,n,r,a)},e.adam=function(e,t,n,r){return void 0===e&&(e=.001),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),new N7(e,t,n,r)},e.adadelta=function(e,t,n){return void 0===e&&(e=.001),void 0===t&&(t=.95),void 0===n&&(n=null),new I7(e,t,n)},e.adamax=function(e,t,n,r,a){return void 0===e&&(e=.002),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),void 0===a&&(a=0),new L7(e,t,n,r,a)},e.adagrad=function(e,t){return void 0===t&&(t=.1),new k7(e,t)},e}();O7.sgd,O7.momentum,O7.adadelta,O7.adagrad,O7.rmsprop,O7.adamax,O7.adam,"undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate&&setImmediate;jJ.prototype.squaredDifference=function(e){return T4(this,e)},FJ=l8;var P7=function(e,t){return P7=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},P7(e,t)};function F7(e,t){function n(){this.constructor=e}P7(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var z7=function(){return z7=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},z7.apply(this,arguments)};function j7(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{c(r.next(e))}catch(IQ){i(IQ)}}function s(e){try{c(r.throw(e))}catch(IQ){i(IQ)}}function c(e){e.done?a(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}c((r=r.apply(e,t||[])).next())}))}function B7(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(IQ){i=[6,IQ],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function U7(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),a=0;for(t=0;t<n;t++)for(var i=arguments[t],o=0,s=i.length;o<s;o++,a++)r[a]=i[o];return r}var W7=function(){function e(e,t){if(!Q7(e)||!Q7(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e.prototype.reverse=function(){return new e(1/this.width,1/this.height)},e}();function G7(e,t){return e instanceof jJ&&e.shape.length===t}function V7(e){return G7(e,3)}function H7(e){return G7(e,4)}function Y7(e){return e%2===0}function X7(e){return e&&e.width&&e.height}function q7(e){return e.reduce((function(e,t){return e.add(t)}),new Z7(0,0)).div(new Z7(e.length,e.length))}function K7(e,t,n){return Array(e).fill(0).map((function(e,r){return t+r*n}))}function Q7(e){return!!e&&e!==1/0&&e!==-1/0&&!isNaN(e)||0===e}function J7(e){return Q7(e)&&0<=e&&e<=1}var Z7=function(){function e(e,t){this._x=e,this._y=t}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.sub=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.mul=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.div=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.abs=function(){return new e(Math.abs(this.x),Math.abs(this.y))},e.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e}(),$7=function(){function e(t,n){void 0===n&&(n=!0);var r=t||{},a=[r.left,r.top,r.right,r.bottom].every(Q7),i=[r.x,r.y,r.width,r.height].every(Q7);if(!i&&!a)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var o=i?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=o[0],c=o[1],u=o[2],l=o[3];e.assertIsValidBox({x:s,y:c,width:u,height:l},"Box.constructor",n),this._x=s,this._y=c,this._width=u,this._height=l}return e.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(Q7)},e.assertIsValidBox=function(t,n,r){if(void 0===r&&(r=!1),!e.isRect(t))throw new Error(n+" - invalid box: "+JSON.stringify(t)+", expected object with properties x, y, width, height");if(!r&&(t.width<0||t.height<0))throw new Error(n+" - width ("+t.width+") and height ("+t.height+") must be positive numbers")},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topLeft",{get:function(){return new Z7(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topRight",{get:function(){return new Z7(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomLeft",{get:function(){return new Z7(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRight",{get:function(){return new Z7(this.right,this.bottom)},enumerable:!0,configurable:!0}),e.prototype.round=function(){var t=[this.x,this.y,this.width,this.height].map((function(e){return Math.round(e)}));return new e({x:t[0],y:t[1],width:t[2],height:t[3]})},e.prototype.floor=function(){var t=[this.x,this.y,this.width,this.height].map((function(e){return Math.floor(e)}));return new e({x:t[0],y:t[1],width:t[2],height:t[3]})},e.prototype.toSquare=function(){var t=this,n=t.x,r=t.y,a=t.width,i=t.height,o=Math.abs(a-i);return a<i&&(n-=o/2,a+=o),i<a&&(r-=o/2,i+=o),new e({x:n,y:r,width:a,height:i})},e.prototype.rescale=function(t){var n=X7(t)?t.width:t,r=X7(t)?t.height:t;return new e({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})},e.prototype.pad=function(t,n){var r=[this.x-t/2,this.y-n/2,this.width+t,this.height+n];return new e({x:r[0],y:r[1],width:r[2],height:r[3]})},e.prototype.clipAtImageBorders=function(t,n){var r=this,a=r.x,i=r.y,o=r.right,s=r.bottom,c=Math.max(a,0),u=Math.max(i,0),l=o-c,f=s-u;return new e({x:c,y:u,width:Math.min(l,t-c),height:Math.min(f,n-u)}).floor()},e.prototype.shift=function(t,n){var r=this.width,a=this.height;return new e({x:this.x+t,y:this.y+n,width:r,height:a})},e.prototype.padAtBorders=function(e,t){var n=this.width+1,r=this.height+1,a=n,i=r,o=this.left,s=this.top,c=this.right,u=this.bottom;return c>t&&(a=-c+t+n,c=t),u>e&&(i=-u+e+r,u=e),o<1&&(i=2-o,o=1),s<1&&(i=2-s,s=1),{dy:1,edy:i,dx:1,edx:a,y:s,ey:u,x:o,ex:c,w:n,h:r}},e.prototype.calibrate=function(t){return new e({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()},e}(),eee=function(e){function t(t,n,r,a,i){return void 0===i&&(i=!1),e.call(this,{left:t,top:n,right:r,bottom:a},i)||this}return F7(t,e),t}($7),tee=function(){function e(e,t,n,r,a){this._imageDims=new W7(a.width,a.height),this._score=e,this._classScore=t,this._className=n,this._box=new $7(r).rescale(this._imageDims)}return Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativeBox",{get:function(){return new $7(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),e.prototype.forSize=function(t,n){return new e(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:n})},e}(),nee=function(e){function t(t,n,r){return e.call(this,t,t,"",n,r)||this}return F7(t,e),t.prototype.forSize=function(n,r){var a=e.prototype.forSize.call(this,n,r);return new t(a.score,a.relativeBox,a.imageDims)},t}(tee);function ree(e,t,n){void 0===n&&(n=!0);var r=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left))*Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top));return n?r/(e.area+t.area-r):r/Math.min(e.area,t.area)}function aee(e,t,n,r){void 0===r&&(r=!0);for(var a=t.map((function(e,t){return{score:e,boxIndex:t}})).sort((function(e,t){return e.score-t.score})).map((function(e){return e.boxIndex})),i=[],o=function(){var t=a.pop();i.push(t);for(var o=a,s=[],c=0;c<o.length;c++){var u=o[c],l=e[t],f=e[u];s.push(ree(l,f,r))}a=a.filter((function(e,t){return s[t]<=n}))};a.length>0;)o();return i}function iee(e,t){return s$((function(){var n=t[0],r=t[1],a=t[2],i=F$(U7(e.shape.slice(0,3),[1]),n),o=F$(U7(e.shape.slice(0,3),[1]),r),s=F$(U7(e.shape.slice(0,3),[1]),a),c=U$([i,o,s],3);return X6(e,c)}))}function oee(e){return 1/(1+Math.exp(-e))}var see=function(e){function t(t,n,r,a,i){return void 0===i&&(i=!1),e.call(this,{x:t,y:n,width:r,height:a},i)||this}return F7(t,e),t}($7),cee=function(){function e(e,t,n){void 0===n&&(n=new Z7(0,0));var r=t.width,a=t.height;this._imgDims=new W7(r,a),this._shift=n,this._positions=e.map((function(e){return e.mul(new Z7(r,a)).add(n)}))}return Object.defineProperty(e.prototype,"shift",{get:function(){return new Z7(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map((function(t){return t.sub(e._shift).div(new Z7(e.imageWidth,e.imageHeight))}))},enumerable:!0,configurable:!0}),e.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},e.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new Z7(e,t))},e.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},e.prototype.align=function(e,t){if(void 0===t&&(t={}),e){var n=e instanceof nee?e.box.floor():new $7(e);return this.shiftBy(n.x,n.y).align(null,t)}var r=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),a=r.useDlibAlignment,i=r.minBoxPadding;return a?this.alignDlib():this.alignMinBbox(i)},e.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),t=e[0],n=e[1],r=e[2],a=function(e){return r.sub(e).magnitude()},i=(a(t)+a(n))/2,o=Math.floor(i/.45),s=q7(e),c=Math.floor(Math.max(0,s.x-.5*o)),u=Math.floor(Math.max(0,s.y-.43*o));return new see(c,u,Math.min(o,this.imageWidth+c),Math.min(o,this.imageHeight+u))},e.prototype.alignMinBbox=function(e){var t=function(e){var t=e.map((function(e){return e.x})),n=e.map((function(e){return e.y})),r=t.reduce((function(e,t){return t<e?t:e}),1/0),a=n.reduce((function(e,t){return t<e?t:e}),1/0),i=t.reduce((function(e,t){return e<t?t:e}),0),o=n.reduce((function(e,t){return e<t?t:e}),0);return new eee(r,a,i,o)}(this.positions);return t.pad(t.width*e,t.height*e)},e.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},e}(),uee=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return F7(t,e),t.prototype.getRefPointsForAlignment=function(){var e=this.positions;return[e[0],e[1],q7([e[3],e[4]])]},t}(cee),lee=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return F7(t,e),t.prototype.getJawOutline=function(){return this.positions.slice(0,17)},t.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},t.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},t.prototype.getNose=function(){return this.positions.slice(27,36)},t.prototype.getLeftEye=function(){return this.positions.slice(36,42)},t.prototype.getRightEye=function(){return this.positions.slice(42,48)},t.prototype.getMouth=function(){return this.positions.slice(48,68)},t.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(q7)},t}(cee),fee=function(){function e(e,t){this._label=e,this._distance=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),e.prototype.toString=function(e){return void 0===e&&(e=!0),this.label+(e?" ("+function(e,t){void 0===t&&(t=2);var n=Math.pow(10,t);return Math.floor(e*n)/n}(this.distance)+")":"")},e}(),dee=function(e){function t(t,n){var r=e.call(this,t)||this;return r._label=n,r}return F7(t,e),t.assertIsValidLabeledBox=function(e,t){if($7.assertIsValidBox(e,t),!Q7(e.label))throw new Error(t+" - expected property label ("+e.label+") to be a number")},Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),t}($7),hee=function(){function e(e,t){if("string"!==typeof e)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some((function(e){return!(e instanceof Float32Array)})))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map((function(e){return Array.from(e)}))}},e.fromJSON=function(t){var n=t.descriptors.map((function(e){return new Float32Array(e)}));return new e(t.label,n)},e}();!function(e){function t(t,n,r,a){var i=e.call(this,t,n)||this;return i._score=r,i._classScore=a,i}F7(t,e),t.assertIsValidPredictedBox=function(e,t){if(dee.assertIsValidLabeledBox(e,t),!J7(e.score)||!J7(e.classScore))throw new Error(t+" - expected properties score ("+e.score+") and ("+e.classScore+") to be a number between [0, 1]")},Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0})}(dee);function pee(e,t){var n={detection:t};return Object.assign({},e,n)}function gee(){var e=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D:CanvasRenderingContext2D,Image:HTMLImageElement,ImageData:ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:e,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function mee(e){var t="";if(!e)try{e=n(Object(function(){var e=new Error("Cannot find module 'fs'");throw e.code="MODULE_NOT_FOUND",e}()))}catch(upe){t=upe.toString()}var r=e?function(t){return new Promise((function(n,r){e.readFile(t,(function(e,t){return e?r(e):n(t)}))}))}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+t)};return{readFile:r}}function vee(){var e=n.g.Canvas||n.g.HTMLCanvasElement,t=n.g.Image||n.g.HTMLImageElement,r=n.g.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},a=mee();return z7({Canvas:e||function(){},CanvasRenderingContext2D:n.g.CanvasRenderingContext2D||function(){},Image:t||function(){},ImageData:n.g.ImageData||function(){},Video:n.g.HTMLVideoElement||function(){},createCanvasElement:function(){if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:r},a)}function bee(){return"object"===typeof window&&"undefined"!==typeof document&&"undefined"!==typeof HTMLImageElement&&"undefined"!==typeof HTMLCanvasElement&&"undefined"!==typeof HTMLVideoElement&&"undefined"!==typeof ImageData&&"undefined"!==typeof CanvasRenderingContext2D}var yee,xee=n(2285);function wee(){return"object"===typeof n.g&&"undefined"!==typeof xee&&!!xee.version}function See(e){yee=e}function Cee(){bee()&&See(gee()),wee()&&See(vee())}var Mee,_ee={getEnv:function(){if(!yee)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return yee},setEnv:See,initialize:Cee,createBrowserEnv:gee,createFileSystem:mee,createNodejsEnv:vee,monkeyPatch:function(e){if(yee||Cee(),!yee)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=e.Canvas,n=void 0===t?yee.Canvas:t,r=e.Image,a=void 0===r?yee.Image:r;yee.Canvas=n,yee.Image=a,yee.createCanvasElement=e.createCanvasElement||function(){return new n},yee.createImageElement=e.createImageElement||function(){return new a},yee.ImageData=e.ImageData||yee.ImageData,yee.Video=e.Video||yee.Video,yee.fetch=e.fetch||yee.fetch,yee.readFile=e.readFile||yee.readFile},isBrowser:bee,isNodejs:wee};function Eee(e){return _ee.isNodejs()||"string"!==typeof e?e:document.getElementById(e)}function Tee(e){var t=_ee.getEnv(),n=t.Canvas;if(e instanceof t.CanvasRenderingContext2D)return e;var r=Eee(e);if(!(r instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var a=r.getContext("2d");if(!a)throw new Error("resolveContext2d - canvas 2d context is null");return a}Cee(),function(e){e.TOP_LEFT="TOP_LEFT",e.TOP_RIGHT="TOP_RIGHT",e.BOTTOM_LEFT="BOTTOM_LEFT",e.BOTTOM_RIGHT="BOTTOM_RIGHT"}(Mee||(Mee={}));var Iee=function(e){void 0===e&&(e={});var t=e.anchorPosition,n=e.backgroundColor,r=e.fontColor,a=e.fontSize,i=e.fontStyle,o=e.padding;this.anchorPosition=t||Mee.TOP_LEFT,this.backgroundColor=n||"rgba(0, 0, 0, 0.5)",this.fontColor=r||"rgba(255, 255, 255, 1)",this.fontSize=a||14,this.fontStyle=i||"Georgia",this.padding=o||4},kee=function(){function e(t,n,r){void 0===r&&(r={}),this.text="string"===typeof t?[t]:t instanceof e?t.text:t,this.anchor=n,this.options=new Iee(r)}return e.prototype.measureWidth=function(e){var t=this.options.padding;return this.text.map((function(t){return e.measureText(t).width})).reduce((function(e,t){return e<t?t:e}),0)+2*t},e.prototype.measureHeight=function(){var e=this.options,t=e.fontSize,n=e.padding;return this.text.length*t+2*n},e.prototype.getUpperLeft=function(e,t){var n=this.options.anchorPosition,r=n===Mee.BOTTOM_RIGHT||n===Mee.TOP_RIGHT,a=n===Mee.BOTTOM_LEFT||n===Mee.BOTTOM_RIGHT,i=this.measureWidth(e),o=this.measureHeight(),s=r?this.anchor.x-i:this.anchor.x,c=a?this.anchor.y-o:this.anchor.y;if(t){var u=t.width,l=t.height;return{x:Math.max(Math.min(s,u-i),0),y:Math.max(Math.min(c,l-o),0)}}return{x:s,y:c}},e.prototype.draw=function(e){var t=Eee(e),n=Tee(t),r=this.options,a=r.backgroundColor,i=r.fontColor,o=r.fontSize,s=r.fontStyle,c=r.padding;n.font=o+"px "+s;var u=this.measureWidth(n),l=this.measureHeight();n.fillStyle=a;var f=this.getUpperLeft(n,t);n.fillRect(f.x,f.y,u,l),n.fillStyle=i,this.text.forEach((function(e,t){var r=c+f.x,a=c+f.y+(t+1)*o;n.fillText(e,r,a)}))},e}(),Nee=function(e){void 0===e&&(e={});var t=e.boxColor,n=e.lineWidth,r=e.label,a=e.drawLabelOptions;this.boxColor=t||"rgba(0, 0, 255, 1)",this.lineWidth=n||2,this.label=r;var i={anchorPosition:Mee.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new Iee(Object.assign({},i,a))};!function(){function e(e,t){void 0===t&&(t={}),this.box=new $7(e),this.options=new Nee(t)}e.prototype.draw=function(e){var t=Tee(e),n=this.options,r=n.boxColor,a=n.lineWidth,i=this.box,o=i.x,s=i.y,c=i.width,u=i.height;t.strokeStyle=r,t.lineWidth=a,t.strokeRect(o,s,c,u);var l=this.options.label;l&&new kee([l],{x:o-a/2,y:s},this.options.drawLabelOptions).draw(e)}}();function Lee(e){var t=_ee.getEnv(),n=t.Image,r=t.Video;return e instanceof n&&e.complete||e instanceof r&&e.readyState>=3}function Aee(e){var t=_ee.getEnv(),n=t.Image,r=t.Video;return e instanceof n?new W7(e.naturalWidth,e.naturalHeight):e instanceof r?new W7(e.videoWidth,e.videoHeight):new W7(e.width,e.height)}function Ree(e){var t=e.width,n=e.height,r=(0,_ee.getEnv().createCanvasElement)();return r.width=t,r.height=n,r}function Dee(e,t){var n=_ee.getEnv().ImageData;if(!(e instanceof n)&&!Lee(e))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=t||Aee(e),a=r.width,i=r.height,o=Ree({width:a,height:i});return e instanceof n?Tee(o).putImageData(e,0,0):Tee(o).drawImage(e,0,0,a,i),o}function Oee(e,t){return j7(this,void 0,void 0,(function(){var n,r,a,i,o,s;return B7(this,(function(c){switch(c.label){case 0:return n=t||_ee.getEnv().createCanvasElement(),r=e.shape.slice(H7(e)?1:0),a=r[0],i=r[1],o=r[2],s=s$((function(){return e.as3D(a,i,o).toInt()})),[4,x7.toPixels(s,n)];case 1:return c.sent(),s.dispose(),[2,n]}}))}))}function Pee(e){var t=_ee.getEnv(),n=t.Image,r=t.Canvas,a=t.Video;return e instanceof n||e instanceof r||e instanceof a}var Fee=function(){function e(e,t){var n=this;if(void 0===t&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach((function(e,t){if(V7(e))return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape);if(H7(e)){var r=e.shape[0];if(1!==r)throw new Error("NetInput - tf.Tensor4D with batchSize "+r+" passed, but not supported in input array");return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape.slice(1))}var a=e instanceof _ee.getEnv().Canvas?e:Dee(e);n._canvases[t]=a,n._inputDimensions[t]=[a.height,a.width,3]}))}return Object.defineProperty(e.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reshapedInputDimensions",{get:function(){var e=this;return K7(this.batchSize,0,1).map((function(t,n){return e.getReshapedInputDimensions(n)}))},enumerable:!0,configurable:!0}),e.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},e.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},e.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},e.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},e.prototype.getReshapedInputDimensions=function(e){if("number"!==typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return function(e,t){var n=e.width,r=e.height,a=t/Math.max(r,n);return new W7(Math.round(n*a),Math.round(r*a))}({width:this.getInputWidth(e),height:this.getInputHeight(e)},this.inputSize)},e.prototype.toBatchTensor=function(e,t){var n=this;return void 0===t&&(t=!0),this._inputSize=e,s$((function(){var r=K7(n.batchSize,0,1).map((function(r){var a=n.getInput(r);if(a instanceof jJ){var i=H7(a)?a:a.expandDims();return i=function(e,t){return void 0===t&&(t=!1),s$((function(){var n=e.shape.slice(1),r=n[0],a=n[1];if(r===a)return e;var i=Math.abs(r-a),o=Math.round(i*(t?.5:1)),s=r>a?2:1,c=function(t){var n=e.shape.slice();return n[s]=t,F$(n,0)},u=c(o),l=i-u.shape[s],f=[t&&l?c(l):null,e,u].filter((function(e){return!!e})).map((function(e){return e.toFloat()}));return U$(f,s)}))}(i,t),i.shape[1]===e&&i.shape[2]===e||(i=t8.resizeBilinear(i,[e,e])),i.as3D(e,e,3)}if(a instanceof _ee.getEnv().Canvas)return x7.fromPixels(function(e,t,n){void 0===n&&(n=!1);var r=_ee.getEnv(),a=r.Image,i=r.Canvas;if(!(e instanceof a||e instanceof i))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var o=Aee(e),s=t/Math.max(o.height,o.width),c=s*o.width,u=s*o.height,l=Ree({width:t,height:t}),f=e instanceof i?e:Dee(e),d=Math.abs(c-u)/2,h=n&&c<u?d:0,p=n&&u<c?d:0;return Tee(l).drawImage(f,h,p,c,u),l}(a,e,t));throw new Error("toBatchTensor - at batchIdx "+r+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+a)}));return I0(r.map((function(e){return e.toFloat()}))).as4D(n.batchSize,e,e,3)}))},e}();function zee(e){return j7(this,void 0,void 0,(function(){var t,n,r;return B7(this,(function(a){switch(a.label){case 0:if(e instanceof Fee)return[2,e];if(!(t=Array.isArray(e)?e:[e]).length)throw new Error("toNetInput - empty array passed as input");return n=function(t){return Array.isArray(e)?" at input index "+t+":":""},(r=t.map(Eee)).forEach((function(e,r){if(!Pee(e)&&!V7(e)&&!H7(e)){if("string"===typeof t[r])throw new Error("toNetInput -"+n(r)+" string passed, but could not resolve HTMLElement for element id "+t[r]);throw new Error("toNetInput -"+n(r)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id")}if(H7(e)){var a=e.shape[0];if(1!==a)throw new Error("toNetInput -"+n(r)+" tf.Tensor4D with batchSize "+a+" passed, but not supported in input array")}})),[4,Promise.all(r.map((function(e){return Pee(e)&&(t=e,new Promise((function(e,n){if(t instanceof _ee.getEnv().Canvas||Lee(t))return e();function r(t){t.currentTarget&&(t.currentTarget.removeEventListener("load",r),t.currentTarget.removeEventListener("error",a),e(t))}function a(e){e.currentTarget&&(e.currentTarget.removeEventListener("load",r),e.currentTarget.removeEventListener("error",a),n(e))}t.addEventListener("load",r),t.addEventListener("error",a)})));var t})))];case 1:return a.sent(),[2,new Fee(r,Array.isArray(e))]}}))}))}function jee(e,t){return j7(this,void 0,void 0,(function(){var n,r,a,i,o,s;return B7(this,(function(c){switch(c.label){case 0:return n=_ee.getEnv().Canvas,r=e,e instanceof n?[3,5]:[4,zee(e)];case 1:if((a=c.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(i=a.getInput(0))instanceof n?(o=i,[3,4]):[3,2];case 2:return[4,Oee(i)];case 3:o=c.sent(),c.label=4;case 4:r=o,c.label=5;case 5:return s=Tee(r),[2,t.map((function(e){return e instanceof nee?e.forSize(r.width,r.height).box.floor():e})).map((function(e){return e.clipAtImageBorders(r.width,r.height)})).map((function(e){var t=e.x,n=e.y,r=e.width,a=e.height,i=Ree({width:r,height:a});return Tee(i).putImageData(s.getImageData(t,n,r,a),0,0),i}))]}}))}))}function Bee(e,t){return j7(this,void 0,void 0,(function(){return B7(this,(function(n){if(!V7(e)&&!H7(e))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(H7(e)&&e.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,s$((function(){var n=e.shape.slice(H7(e)?1:0),r=n[0],a=n[1],i=n[2],o=t.map((function(e){return e instanceof nee?e.forSize(a,r).box:e})).map((function(e){return e.clipAtImageBorders(a,r)})).map((function(t){var n=t.x,o=t.y,s=t.width,c=t.height;return G5(e.as3D(r,a,i),[o,n,0],[c,s,i])}));return o}))]}))}))}function Uee(e,t){return j7(this,void 0,void 0,(function(){var n;return B7(this,(function(r){switch(r.label){case 0:return[4,(0,_ee.getEnv().fetch)(e,t)];case 1:if(!((n=r.sent()).status<400))throw new Error("failed to fetch: ("+n.status+") "+n.statusText+", from url: "+n.url);return[2,n]}}))}))}function Wee(e){return j7(this,void 0,void 0,(function(){return B7(this,(function(t){switch(t.label){case 0:return[4,Uee(e)];case 1:return[2,t.sent().json()]}}))}))}function Gee(e,t){var n=t+"-weights_manifest.json";if(!e)return{modelBaseUri:"",manifestUri:n};if("/"===e)return{modelBaseUri:"/",manifestUri:"/"+n};var r=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"",a=(e=e.replace(r,"")).split("/").filter((function(e){return e})),i=e.endsWith(".json")?a[a.length-1]:n,o=r+(e.endsWith(".json")?a.slice(0,a.length-1):a).join("/");return{modelBaseUri:o=e.startsWith("/")?"/"+o:o,manifestUri:"/"===o?"/"+i:o+"/"+i}}function Vee(e,t){return j7(this,void 0,void 0,(function(){var n,r,a,i;return B7(this,(function(o){switch(o.label){case 0:return n=Gee(e,t),r=n.manifestUri,a=n.modelBaseUri,[4,Wee(r)];case 1:return i=o.sent(),[2,v7.loadWeights(i,a)]}}))}))}var Hee=function(){function e(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(e.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),e.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e);return t.obj[t.objProp]},e.prototype.reassignParamFromPath=function(e,t){var n=this.traversePropertyPath(e),r=n.obj,a=n.objProp;r[a].dispose(),r[a]=t},e.prototype.getParamList=function(){var e=this;return this._paramMappings.map((function(t){var n=t.paramPath;return{path:n,tensor:e.getParamFromPath(n)}}))},e.prototype.getTrainableParams=function(){return this.getParamList().filter((function(e){return e.tensor instanceof HJ}))},e.prototype.getFrozenParams=function(){return this.getParamList().filter((function(e){return!(e.tensor instanceof HJ)}))},e.prototype.variable=function(){var e=this;this.getFrozenParams().forEach((function(t){var n=t.path,r=t.tensor;e.reassignParamFromPath(n,r.variable())}))},e.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach((function(t){var n=t.path,r=t.tensor,a=I$(r.dataSync());r.dispose(),e.reassignParamFromPath(n,a)}))},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.getParamList().forEach((function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()})),this._params=void 0},e.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map((function(e){var t=e.tensor;return Array.from(t.dataSync())})).reduce((function(e,t){return e.concat(t)})))},e.prototype.load=function(e){return j7(this,void 0,void 0,(function(){return B7(this,(function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.loadFromUri=function(e){return j7(this,void 0,void 0,(function(){var t;return B7(this,(function(n){switch(n.label){case 0:if(e&&"string"!==typeof e)throw new Error(this._name+".loadFromUri - expected model uri");return[4,Vee(e,this.getDefaultModelName())];case 1:return t=n.sent(),this.loadFromWeightMap(t),[2]}}))}))},e.prototype.loadFromDisk=function(e){return j7(this,void 0,void 0,(function(){var t,n,r,a,i,o,s,c,u,l;return B7(this,(function(f){switch(f.label){case 0:if(e&&"string"!==typeof e)throw new Error(this._name+".loadFromDisk - expected model file path");return t=_ee.getEnv().readFile,n=Gee(e,this.getDefaultModelName()),r=n.manifestUri,a=n.modelBaseUri,i=function(e){return Promise.all(e.map((function(e){return t(e).then((function(e){return e.buffer}))})))},o=v7.weightsLoaderFactory(i),u=(c=JSON).parse,[4,t(r)];case 1:return s=u.apply(c,[f.sent().toString()]),[4,o(s,a)];case 2:return l=f.sent(),this.loadFromWeightMap(l),[2]}}))}))},e.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r},e.prototype.extractWeights=function(e){var t=this.extractParams(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r},e.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce((function(t,n){if(!t.nextObj.hasOwnProperty(n))throw new Error("traversePropertyPath - object does not have property "+n+", for path "+e);return{obj:t.nextObj,objProp:n,nextObj:t.nextObj[n]}}),{nextObj:this.params}),n=t.obj,r=t.objProp;if(!n||!r||!(n[r]instanceof jJ))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:n,objProp:r}},e}();function Yee(e,t,n){return s$((function(){var r=S5(e,t.depthwise_filter,t.pointwise_filter,n,"same");return r=I6(r,t.bias)}))}function Xee(e,t,n){return void 0===n&&(n=!1),s$((function(){var r=o9(n?I6(g5(e,t.conv0.filters,[2,2],"same"),t.conv0.bias):Yee(e,t.conv0,[2,2])),a=Yee(r,t.conv1,[1,1]),i=Yee(o9(I6(r,a)),t.conv2,[1,1]);return o9(I6(r,I6(a,i)))}))}function qee(e,t,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!0),s$((function(){var a=o9(n?I6(g5(e,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):Yee(e,t.conv0,r?[2,2]:[1,1])),i=Yee(a,t.conv1,[1,1]),o=Yee(o9(I6(a,i)),t.conv2,[1,1]),s=Yee(o9(I6(a,I6(i,o))),t.conv3,[1,1]);return o9(I6(a,I6(i,I6(o,s))))}))}function Kee(e,t,n,r){return void 0===n&&(n="same"),void 0===r&&(r=!1),s$((function(){var a=I6(g5(e,t.filters,[1,1],n),t.bias);return r?o9(a):a}))}function Qee(e,t){Object.keys(e).forEach((function(n){t.some((function(e){return e.originalPath===n}))||e[n].dispose()}))}function Jee(e,t){return function(n,r,a,i){var o=D$(e(n*r*a*a),[a,a,n,r]),s=L$(e(r));return t.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:o,bias:s}}}function Zee(e,t){return function(n,r,a){var i=A$(e(n*r),[n,r]),o=L$(e(r));return t.push({paramPath:a+"/weights"},{paramPath:a+"/bias"}),{weights:i,bias:o}}}var $ee=function(e,t,n){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=n};function ete(e,t){return function(n,r,a){var i=D$(e(9*n),[3,3,n,1]),o=D$(e(n*r),[1,1,n,r]),s=L$(e(r));return t.push({paramPath:a+"/depthwise_filter"},{paramPath:a+"/pointwise_filter"},{paramPath:a+"/bias"}),new $ee(i,o,s)}}function tte(e){return function(t){var n=e(t+"/depthwise_filter",4),r=e(t+"/pointwise_filter",4),a=e(t+"/bias",1);return new $ee(n,r,a)}}function nte(e,t){return function(n,r,a){var i=e[n];if(!G7(i,r))throw new Error("expected weightMap["+n+"] to be a Tensor"+r+"D, instead have "+i);return t.push({originalPath:n,paramPath:a||n}),i}}function rte(e){var t=e;return{extractWeights:function(e){var n=t.slice(0,e);return t=t.slice(e),n},getRemainingWeights:function(){return t}}}function ate(e,t){var n=Jee(e,t),r=ete(e,t);function a(e,t,a,i){return void 0===i&&(i=!1),{conv0:i?n(e,t,3,a+"/conv0"):r(e,t,a+"/conv0"),conv1:r(t,t,a+"/conv1"),conv2:r(t,t,a+"/conv2")}}return{extractDenseBlock3Params:a,extractDenseBlock4Params:function(e,t,n,i){void 0===i&&(i=!1);var o=a(e,t,n,i);return{conv0:o.conv0,conv1:o.conv1,conv2:o.conv2,conv3:r(t,t,n+"/conv3")}}}}function ite(e){return function(t){return{filters:e(t+"/filters",4),bias:e(t+"/bias",1)}}}function ote(e,t){var n=nte(e,t),r=ite(n),a=tte(n);return{extractDenseBlock3Params:function(e,t){return void 0===t&&(t=!1),{conv0:t?r(e+"/conv0"):a(e+"/conv0"),conv1:a(e+"/conv1"),conv2:a(e+"/conv2")}},extractDenseBlock4Params:function(e,t){return void 0===t&&(t=!1),{conv0:t?r(e+"/conv0"):a(e+"/conv0"),conv1:a(e+"/conv1"),conv2:a(e+"/conv2"),conv3:a(e+"/conv3")}}}}var ste=function(e){function t(){return e.call(this,"FaceFeatureExtractor")||this}return F7(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceFeatureExtractor - load model before inference");return s$((function(){var n=qee(iee(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(N$(255)),t.dense0,!0);return n=qee(n,t.dense1),n=qee(n,t.dense2),n=qee(n,t.dense3),n=P5(n,[7,7],[2,2],"valid")}))},t.prototype.forward=function(e){return j7(this,void 0,void 0,(function(){var t;return B7(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,zee(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=ote(e,t).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return Qee(e,t),{params:r,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=rte(e),r=n.extractWeights,a=n.getRemainingWeights,i=ate(r,t).extractDenseBlock4Params,o=i(3,32,"dense0",!0),s=i(32,64,"dense1"),c=i(64,128,"dense2"),u=i(128,256,"dense3");if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:t,params:{dense0:o,dense1:s,dense2:c,dense3:u}}}(e)},t}(Hee);function cte(e,t){return s$((function(){return I6(_5(e,t.weights),t.bias)}))}function ute(e){var t={},n={};return Object.keys(e).forEach((function(r){(r.startsWith("fc")?n:t)[r]=e[r]})),{featureExtractorMap:t,classifierMap:n}}var lte=function(e){function t(t,n){var r=e.call(this,t)||this;return r._faceFeatureExtractor=n,r}return F7(t,e),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var t=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return s$((function(){var r=e instanceof Fee?t.faceFeatureExtractor.forwardInput(e):e;return cte(r.as2D(r.shape[0],-1),n.fc)}))},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},t.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r},t.prototype.extractClassifierParams=function(e){return function(e,t,n){var r=[],a=rte(e),i=a.extractWeights,o=a.getRemainingWeights,s=Zee(i,r)(t,n,"fc");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:r,params:{fc:s}}}(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},t.prototype.extractParamsFromWeigthMap=function(e){var t=ute(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t=[],n=nte(e,t),r={fc:function(e){return{weights:n(e+"/weights",2),bias:n(e+"/bias",1)}}("fc")};return Qee(e,t),{params:r,paramMappings:t}}(r)},t.prototype.extractParams=function(e){var t=this.getClassifierChannelsIn(),n=this.getClassifierChannelsOut(),r=n*t+n,a=e.slice(0,e.length-r),i=e.slice(e.length-r);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(i)},t}(Hee),fte=["neutral","happy","sad","angry","fearful","disgusted","surprised"],dte=function(){function e(e){var t=this;if(7!==e.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);fte.forEach((function(n,r){t[n]=e[r]}))}return e.prototype.asSortedArray=function(){var e=this;return fte.map((function(t){return{expression:t,probability:e[t]}})).sort((function(e,t){return t.probability-e.probability}))},e}(),hte=function(e){function t(t){return void 0===t&&(t=new ste),e.call(this,"FaceExpressionNet",t)||this}return F7(t,e),t.prototype.forwardInput=function(e){var t=this;return s$((function(){return Q0(t.runNet(e))}))},t.prototype.forward=function(e){return j7(this,void 0,void 0,(function(){var t;return B7(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,zee(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.predictExpressions=function(e){return j7(this,void 0,void 0,(function(){var t,n,r,a,i=this;return B7(this,(function(o){switch(o.label){case 0:return[4,zee(e)];case 1:return t=o.sent(),[4,this.forwardInput(t)];case 2:return n=o.sent(),[4,Promise.all(L0(n).map((function(e){return j7(i,void 0,void 0,(function(){var t;return B7(this,(function(n){switch(n.label){case 0:return[4,e.data()];case 1:return t=n.sent(),e.dispose(),[2,t]}}))}))})))];case 3:return r=o.sent(),n.dispose(),a=r.map((function(e){return new dte(e)})),[2,t.isBatchInput?a:a[0]]}}))}))},t.prototype.getDefaultModelName=function(){return"face_expression_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t.prototype.getClassifierChannelsOut=function(){return 7},t}(lte);function pte(e,t){var n={expressions:t};return Object.assign({},e,n)}function gte(e){return function(e){return e.detection instanceof nee}(e)&&e.landmarks instanceof cee&&e.unshiftedLandmarks instanceof cee&&e.alignedRect instanceof nee}function mte(e,t){var n=e.detection.box,r=t.shiftBy(n.x,n.y),a=r.align(),i=e.detection.imageDims,o={landmarks:r,unshiftedLandmarks:t,alignedRect:new nee(e.detection.score,a.rescale(i.reverse()),i)};return Object.assign({},e,o)}function vte(e,t,n){if(void 0===n&&(n=!1),e.beginPath(),t.slice(1).forEach((function(n,r){var a=n.x,i=n.y,o=t[r];e.moveTo(o.x,o.y),e.lineTo(a,i)})),n){var r=t[t.length-1],a=t[0];if(!r||!a)return;e.moveTo(r.x,r.y),e.lineTo(a.x,a.y)}e.stroke()}var bte=function(e){void 0===e&&(e={});var t=e.drawLines,n=void 0===t||t,r=e.drawPoints,a=void 0===r||r,i=e.lineWidth,o=e.lineColor,s=e.pointSize,c=e.pointColor;this.drawLines=n,this.drawPoints=a,this.lineWidth=i||1,this.pointSize=s||2,this.lineColor=o||"rgba(0, 255, 255, 1)",this.pointColor=c||"rgba(255, 0, 255, 1)"};!function(){function e(e,t){void 0===t&&(t={}),this.faceLandmarks=e,this.options=new bte(t)}e.prototype.draw=function(e){var t=Tee(e),n=this.options,r=n.drawLines,a=n.drawPoints,i=n.lineWidth,o=n.lineColor,s=n.pointSize,c=n.pointColor;if(r&&this.faceLandmarks instanceof lee&&(t.strokeStyle=o,t.lineWidth=i,vte(t,this.faceLandmarks.getJawOutline()),vte(t,this.faceLandmarks.getLeftEyeBrow()),vte(t,this.faceLandmarks.getRightEyeBrow()),vte(t,this.faceLandmarks.getNose()),vte(t,this.faceLandmarks.getLeftEye(),!0),vte(t,this.faceLandmarks.getRightEye(),!0),vte(t,this.faceLandmarks.getMouth(),!0)),a){t.strokeStyle=c,t.fillStyle=c;this.faceLandmarks.positions.forEach((function(e){t.beginPath(),t.arc(e.x,e.y,s,0,2*Math.PI),t.fill()}))}}}();function yte(e,t){var n=[],r=rte(e),a=r.extractWeights,i=r.getRemainingWeights,o=function(e,t){var n=Jee(e,t),r=ete(e,t);return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:function(e,t,a){return{separable_conv0:r(e,t,a+"/separable_conv0"),separable_conv1:r(t,t,a+"/separable_conv1"),expansion_conv:n(e,t,1,a+"/expansion_conv")}},extractMainBlockParams:function(e,t){return{separable_conv0:r(e,e,t+"/separable_conv0"),separable_conv1:r(e,e,t+"/separable_conv1"),separable_conv2:r(e,e,t+"/separable_conv2")}}}}(a,n),s=o.extractConvParams,c=o.extractSeparableConvParams,u=o.extractReductionBlockParams,l=o.extractMainBlockParams,f={conv_in:s(3,32,3,"entry_flow/conv_in"),reduction_block_0:u(32,64,"entry_flow/reduction_block_0"),reduction_block_1:u(64,128,"entry_flow/reduction_block_1")},d={};K7(t,0,1).forEach((function(e){d["main_block_"+e]=l(128,"middle_flow/main_block_"+e)}));var h={reduction_block:u(128,256,"exit_flow/reduction_block"),separable_conv:c(256,512,"exit_flow/separable_conv")};if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:n,params:{entry_flow:f,middle_flow:d,exit_flow:h}}}function xte(e,t){var n=[],r=function(e,t){var n=nte(e,t),r=ite(n),a=tte(n);return{extractConvParams:r,extractSeparableConvParams:a,extractReductionBlockParams:function(e){return{separable_conv0:a(e+"/separable_conv0"),separable_conv1:a(e+"/separable_conv1"),expansion_conv:r(e+"/expansion_conv")}},extractMainBlockParams:function(e){return{separable_conv0:a(e+"/separable_conv0"),separable_conv1:a(e+"/separable_conv1"),separable_conv2:a(e+"/separable_conv2")}}}}(e,n),a=r.extractConvParams,i=r.extractSeparableConvParams,o=r.extractReductionBlockParams,s=r.extractMainBlockParams,c={conv_in:a("entry_flow/conv_in"),reduction_block_0:o("entry_flow/reduction_block_0"),reduction_block_1:o("entry_flow/reduction_block_1")},u={};K7(t,0,1).forEach((function(e){u["main_block_"+e]=s("middle_flow/main_block_"+e)}));var l={reduction_block:o("exit_flow/reduction_block"),separable_conv:i("exit_flow/separable_conv")};return Qee(e,n),{params:{entry_flow:c,middle_flow:u,exit_flow:l},paramMappings:n}}function wte(e,t,n){return I6(g5(e,t.filters,n,"same"),t.bias)}function Ste(e,t,n){void 0===n&&(n=!0);var r=n?o9(e):e;return r=Yee(r,t.separable_conv0,[1,1]),r=Yee(o9(r),t.separable_conv1,[1,1]),r=O5(r,[3,3],[2,2],"same"),r=I6(r,wte(e,t.expansion_conv,[2,2]))}var Cte,Mte=function(e){function t(t){var n=e.call(this,"TinyXception")||this;return n._numMainBlocks=t,n}return F7(t,e),t.prototype.forwardInput=function(e){var t=this,n=this.params;if(!n)throw new Error("TinyXception - load model before inference");return s$((function(){var r=iee(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(N$(256)),a=o9(wte(r,n.entry_flow.conv_in,[2,2]));return a=Ste(a,n.entry_flow.reduction_block_0,!1),a=Ste(a,n.entry_flow.reduction_block_1),K7(t._numMainBlocks,0,1).forEach((function(e){a=function(e,t){var n=Yee(o9(e),t.separable_conv0,[1,1]);return n=Yee(o9(n),t.separable_conv1,[1,1]),n=Yee(o9(n),t.separable_conv2,[1,1]),I6(n,e)}(a,n.middle_flow["main_block_"+e])})),a=Ste(a,n.exit_flow.reduction_block),a=o9(Yee(a,n.exit_flow.separable_conv,[1,1]))}))},t.prototype.forward=function(e){return j7(this,void 0,void 0,(function(){var t;return B7(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,zee(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.getDefaultModelName=function(){return"tiny_xception_model"},t.prototype.extractParamsFromWeigthMap=function(e){return xte(e,this._numMainBlocks)},t.prototype.extractParams=function(e){return yte(e,this._numMainBlocks)},t}(Hee);!function(e){e.FEMALE="female",e.MALE="male"}(Cte||(Cte={}));var _te=function(e){function t(t){void 0===t&&(t=new Mte(2));var n=e.call(this,"AgeGenderNet")||this;return n._faceFeatureExtractor=t,n}return F7(t,e),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var t=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return s$((function(){var r=e instanceof Fee?t.faceFeatureExtractor.forwardInput(e):e,a=P5(r,[7,7],[2,2],"valid").as2D(r.shape[0],-1);return{age:cte(a,n.fc.age).as1D(),gender:cte(a,n.fc.gender)}}))},t.prototype.forwardInput=function(e){var t=this;return s$((function(){var n=t.runNet(e),r=n.age,a=n.gender;return{age:r,gender:Q0(a)}}))},t.prototype.forward=function(e){return j7(this,void 0,void 0,(function(){var t;return B7(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,zee(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.predictAgeAndGender=function(e){return j7(this,void 0,void 0,(function(){var t,n,r,a,i,o,s=this;return B7(this,(function(c){switch(c.label){case 0:return[4,zee(e)];case 1:return t=c.sent(),[4,this.forwardInput(t)];case 2:return n=c.sent(),r=L0(n.age),a=L0(n.gender),i=r.map((function(e,t){return{ageTensor:e,genderTensor:a[t]}})),[4,Promise.all(i.map((function(e){var t=e.ageTensor,n=e.genderTensor;return j7(s,void 0,void 0,(function(){var e,r,a,i,o;return B7(this,(function(s){switch(s.label){case 0:return[4,t.data()];case 1:return e=s.sent()[0],[4,n.data()];case 2:return r=s.sent()[0],i=(a=r>.5)?Cte.MALE:Cte.FEMALE,o=a?r:1-r,t.dispose(),n.dispose(),[2,{age:e,gender:i,genderProbability:o}]}}))}))})))];case 3:return o=c.sent(),n.age.dispose(),n.gender.dispose(),[2,t.isBatchInput?o:o[0]]}}))}))},t.prototype.getDefaultModelName=function(){return"age_gender_model"},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},t.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r},t.prototype.extractClassifierParams=function(e){return function(e){var t=[],n=rte(e),r=n.extractWeights,a=n.getRemainingWeights,i=Zee(r,t),o=i(512,1,"fc/age"),s=i(512,2,"fc/gender");if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:t,params:{fc:{age:o,gender:s}}}}(e)},t.prototype.extractParamsFromWeigthMap=function(e){var t=ute(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t=[],n=nte(e,t);function r(e){return{weights:n(e+"/weights",2),bias:n(e+"/bias",1)}}var a={fc:{age:r("fc/age"),gender:r("fc/gender")}};return Qee(e,t),{params:a,paramMappings:t}}(r)},t.prototype.extractParams=function(e){var t=e.slice(0,e.length-1539),n=e.slice(e.length-1539);return this.faceFeatureExtractor.extractWeights(t),this.extractClassifierParams(n)},t}(Hee),Ete=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return F7(t,e),t.prototype.postProcess=function(e,t,n){var r=n.map((function(e){var n=e.width,r=e.height,a=t/Math.max(r,n);return{width:n*a,height:r*a}})),a=r.length;return s$((function(){var n=function(e,t){return I0([F$([68],e),F$([68],t)],1).as2D(1,136).as1D()},i=function(e,t){var n=r[e],a=n.width,i=n.height;return t(a,i)?Math.abs(a-i)/2:0},o=e.mul(F$([a,136],t)).sub(I0(Array.from(Array(a),(function(e,t){return n(function(e){return i(e,(function(e,t){return e<t}))}(t),function(e){return i(e,(function(e,t){return t<e}))}(t))})))).div(I0(Array.from(Array(a),(function(e,t){return n(r[t].width,r[t].height)}))));return o}))},t.prototype.forwardInput=function(e){var t=this;return s$((function(){var n=t.runNet(e);return t.postProcess(n,e.inputSize,e.inputDimensions.map((function(e){return{height:e[0],width:e[1]}})))}))},t.prototype.forward=function(e){return j7(this,void 0,void 0,(function(){var t;return B7(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,zee(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.detectLandmarks=function(e){return j7(this,void 0,void 0,(function(){var t,n,r,a=this;return B7(this,(function(i){switch(i.label){case 0:return[4,zee(e)];case 1:return t=i.sent(),n=s$((function(){return L0(a.forwardInput(t))})),[4,Promise.all(n.map((function(e,n){return j7(a,void 0,void 0,(function(){var r,a,i,o,s;return B7(this,(function(c){switch(c.label){case 0:return i=(a=Array).from,[4,e.data()];case 1:return r=i.apply(a,[c.sent()]),o=r.filter((function(e,t){return Y7(t)})),s=r.filter((function(e,t){return!Y7(t)})),[2,new lee(Array(68).fill(0).map((function(e,t){return new Z7(o[t],s[t])})),{height:t.getInputHeight(n),width:t.getInputWidth(n)})]}}))}))})))];case 2:return r=i.sent(),n.forEach((function(e){return e.dispose()})),[2,t.isBatchInput?r:r[0]]}}))}))},t.prototype.getClassifierChannelsOut=function(){return 136},t}(lte),Tte=function(e){function t(t){return void 0===t&&(t=new ste),e.call(this,"FaceLandmark68Net",t)||this}return F7(t,e),t.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t}(Ete);var Ite=function(e){function t(){return e.call(this,"TinyFaceFeatureExtractor")||this}return F7(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("TinyFaceFeatureExtractor - load model before inference");return s$((function(){var n=Xee(iee(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(N$(255)),t.dense0,!0);return n=Xee(n,t.dense1),n=Xee(n,t.dense2),n=P5(n,[14,14],[2,2],"valid")}))},t.prototype.forward=function(e){return j7(this,void 0,void 0,(function(){var t;return B7(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,zee(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=ote(e,t).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return Qee(e,t),{params:r,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=rte(e),r=n.extractWeights,a=n.getRemainingWeights,i=ate(r,t).extractDenseBlock3Params,o=i(3,32,"dense0",!0),s=i(32,64,"dense1"),c=i(64,128,"dense2");if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:t,params:{dense0:o,dense1:s,dense2:c}}}(e)},t}(Hee),kte=function(e){function t(t){return void 0===t&&(t=new Ite),e.call(this,"FaceLandmark68TinyNet",t)||this}return F7(t,e),t.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},t.prototype.getClassifierChannelsIn=function(){return 128},t}(Ete);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}F7(t,e)}(Tte);function Nte(e,t,n,r,a){void 0===a&&(a="same");var i=t.conv,o=i.filters,s=i.bias,c=g5(e,o,n,a);return c=function(e,t){return I6(W6(e,t.weights),t.biases)}(c=I6(c,s),t.scale),r?o9(c):c}function Lte(e,t){return Nte(e,t,[1,1],!1)}function Ate(e,t){return Nte(e,t,[2,2],!0,"valid")}function Rte(e,t){function n(n,r,a,i){var o=function(t,n,r){var a=e(t),i=a.length/(n*r*r);if(i%1!==0)throw new Error("depth has to be an integer: "+i+", weights.length: "+a.length+", numFilters: "+n+", filterSize: "+r);return s$((function(){return u9(D$(a,[n,i,r,r]),[2,3,1,0])}))}(n,r,a),s=L$(e(r));return t.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:o,bias:s}}function r(r,a,i,o){var s=n(r,a,i,o+"/conv"),c=function(n,r){var a=L$(e(n)),i=L$(e(n));return t.push({paramPath:r+"/weights"},{paramPath:r+"/biases"}),{weights:a,biases:i}}(a,o+"/scale");return{conv:s,scale:c}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e,t,n,a,i){return void 0===i&&(i=!1),{conv1:r((i?.5:1)*e,t,n,a+"/conv1"),conv2:r(e,t,n,a+"/conv2")}}}}function Dte(e,t){var n=nte(e,t);function r(e){var t=n(e+"/conv/filters",4),r=n(e+"/conv/bias",1),a=function(e){return{weights:n(e+"/scale/weights",1),biases:n(e+"/scale/biases",1)}}(e);return{conv:{filters:t,bias:r},scale:a}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e){return{conv1:r(e+"/conv1"),conv2:r(e+"/conv2")}}}}function Ote(e){var t=[],n=Dte(e,t),r=n.extractConvLayerParams,a=n.extractResidualLayerParams,i=r("conv32_down"),o=a("conv32_1"),s=a("conv32_2"),c=a("conv32_3"),u=a("conv64_down"),l=a("conv64_1"),f=a("conv64_2"),d=a("conv64_3"),h=a("conv128_down"),p=a("conv128_1"),g=a("conv128_2"),m=a("conv256_down"),v=a("conv256_1"),b=a("conv256_2"),y=a("conv256_down_out"),x=e.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!function(e){return G7(e,2)}(x))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+x);var w={conv32_down:i,conv32_1:o,conv32_2:s,conv32_3:c,conv64_down:u,conv64_1:l,conv64_2:f,conv64_3:d,conv128_down:h,conv128_1:p,conv128_2:g,conv256_down:m,conv256_1:v,conv256_2:b,conv256_down_out:y,fc:x};return Qee(e,t),{params:w,paramMappings:t}}function Pte(e,t){var n=function(e,t){return Nte(e,t,[1,1],!0)}(e,t.conv1);return n=Lte(n,t.conv2),n=I6(n,e),n=o9(n)}function Fte(e,t){var n=Ate(e,t.conv1);n=Lte(n,t.conv2);var r=P5(e,2,2,"valid"),a=P$(r.shape),i=r.shape[3]!==n.shape[3];if(r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2]){var o=U7(n.shape);o[1]=1;var s=P$(o),c=U7((n=U$([n,s],1)).shape);c[2]=1;var u=P$(c);n=U$([n,u],2)}return r=i?U$([r,a],3):r,n=I6(r,n),n=o9(n)}var zte=function(e){function t(){return e.call(this,"FaceRecognitionNet")||this}return F7(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceRecognitionNet - load model before inference");return s$((function(){var n=Ate(iee(e.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(N$(256)),t.conv32_down);n=Pte(n=O5(n,3,2,"valid"),t.conv32_1),n=Pte(n,t.conv32_2),n=Pte(n,t.conv32_3),n=Pte(n=Fte(n,t.conv64_down),t.conv64_1),n=Pte(n,t.conv64_2),n=Pte(n,t.conv64_3),n=Pte(n=Fte(n,t.conv128_down),t.conv128_1),n=Pte(n,t.conv128_2),n=Pte(n=Fte(n,t.conv256_down),t.conv256_1);var r=(n=Fte(n=Pte(n,t.conv256_2),t.conv256_down_out)).mean([1,2]);return _5(r,t.fc)}))},t.prototype.forward=function(e){return j7(this,void 0,void 0,(function(){var t;return B7(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,zee(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.computeFaceDescriptor=function(e){return j7(this,void 0,void 0,(function(){var t,n,r,a=this;return B7(this,(function(i){switch(i.label){case 0:return[4,zee(e)];case 1:return t=i.sent(),n=s$((function(){return L0(a.forwardInput(t))})),[4,Promise.all(n.map((function(e){return e.data()})))];case 2:return r=i.sent(),n.forEach((function(e){return e.dispose()})),[2,t.isBatchInput?r:r[0]]}}))}))},t.prototype.getDefaultModelName=function(){return"face_recognition_model"},t.prototype.extractParamsFromWeigthMap=function(e){return Ote(e)},t.prototype.extractParams=function(e){return function(e){var t=rte(e),n=t.extractWeights,r=t.getRemainingWeights,a=[],i=Rte(n,a),o=i.extractConvLayerParams,s=i.extractResidualLayerParams,c=o(4704,32,7,"conv32_down"),u=s(9216,32,3,"conv32_1"),l=s(9216,32,3,"conv32_2"),f=s(9216,32,3,"conv32_3"),d=s(36864,64,3,"conv64_down",!0),h=s(36864,64,3,"conv64_1"),p=s(36864,64,3,"conv64_2"),g=s(36864,64,3,"conv64_3"),m=s(147456,128,3,"conv128_down",!0),v=s(147456,128,3,"conv128_1"),b=s(147456,128,3,"conv128_2"),y=s(589824,256,3,"conv256_down",!0),x=s(589824,256,3,"conv256_1"),w=s(589824,256,3,"conv256_2"),S=s(589824,256,3,"conv256_down_out"),C=s$((function(){return u9(A$(n(32768),[128,256]),[1,0])}));if(a.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{conv32_down:c,conv32_1:u,conv32_2:l,conv32_3:f,conv64_down:d,conv64_1:h,conv64_2:p,conv64_3:g,conv128_down:m,conv128_1:v,conv128_2:b,conv256_down:y,conv256_1:x,conv256_2:w,conv256_down_out:S,fc:C},paramMappings:a}}(e)},t}(Hee);function jte(e,t,n){var r={gender:t,genderProbability:n};return Object.assign({},e,r)}var Bte=function(){function e(e){var t=void 0===e?{}:e,n=t.minFaceSize,r=t.scaleFactor,a=t.maxNumScales,i=t.scoreThresholds,o=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=n||20,this._scaleFactor=r||.709,this._maxNumScales=a||10,this._scoreThresholds=i||[.6,.7,.7],this._scaleSteps=o,"number"!==typeof this._minFaceSize||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!==typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!==typeof this._maxNumScales||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some((function(e){return"number"!==typeof e})))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some((function(e){return"number"!==typeof e}))))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(e.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),e}();function Ute(e,t){function n(n,r,a,i,o){var s=D$(e(n*r*a*a),[a,a,n,r]),c=L$(e(r));return t.push({paramPath:i+"/filters"},{paramPath:i+"/"+(o?"batch_norm_offset":"bias")}),{filters:s,bias:c}}function r(e,t,r,a){var i=n(e,t,r,a,!0);return{filters:i.filters,batch_norm_offset:i.bias}}function a(n,a,i){var o=function(n,r){var a=D$(e(9*n),[3,3,n,1]),i=L$(e(n)),o=L$(e(n)),s=L$(e(n)),c=L$(e(n));return t.push({paramPath:r+"/filters"},{paramPath:r+"/batch_norm_scale"},{paramPath:r+"/batch_norm_offset"},{paramPath:r+"/batch_norm_mean"},{paramPath:r+"/batch_norm_variance"}),{filters:a,batch_norm_scale:i,batch_norm_offset:o,batch_norm_mean:s,batch_norm_variance:c}}(n,i+"/depthwise_conv");return{depthwise_conv:o,pointwise_conv:r(n,a,1,i+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:r(3,32,3,"mobilenetv1/conv_0"),conv_1:a(32,64,"mobilenetv1/conv_1"),conv_2:a(64,128,"mobilenetv1/conv_2"),conv_3:a(128,128,"mobilenetv1/conv_3"),conv_4:a(128,256,"mobilenetv1/conv_4"),conv_5:a(256,256,"mobilenetv1/conv_5"),conv_6:a(256,512,"mobilenetv1/conv_6"),conv_7:a(512,512,"mobilenetv1/conv_7"),conv_8:a(512,512,"mobilenetv1/conv_8"),conv_9:a(512,512,"mobilenetv1/conv_9"),conv_10:a(512,512,"mobilenetv1/conv_10"),conv_11:a(512,512,"mobilenetv1/conv_11"),conv_12:a(512,1024,"mobilenetv1/conv_12"),conv_13:a(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:r(1024,256,1,"prediction_layer/conv_0"),conv_1:r(256,512,3,"prediction_layer/conv_1"),conv_2:r(512,128,1,"prediction_layer/conv_2"),conv_3:r(128,256,3,"prediction_layer/conv_3"),conv_4:r(256,128,1,"prediction_layer/conv_4"),conv_5:r(128,256,3,"prediction_layer/conv_5"),conv_6:r(256,64,1,"prediction_layer/conv_6"),conv_7:r(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:n(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:n(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:n(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}function Wte(e){var t=[],n=function(e,t){var n=nte(e,t);function r(e,t,r){return{filters:n(e+"/Conv2d_"+t+"_pointwise/weights",4,r+"/filters"),batch_norm_offset:n(e+"/Conv2d_"+t+"_pointwise/convolution_bn_offset",1,r+"/batch_norm_offset")}}function a(e){var t="mobilenetv1/conv_"+e,a="MobilenetV1/Conv2d_"+e+"_depthwise",i=t+"/depthwise_conv",o=t+"/pointwise_conv";return{depthwise_conv:{filters:n(a+"/depthwise_weights",4,i+"/filters"),batch_norm_scale:n(a+"/BatchNorm/gamma",1,i+"/batch_norm_scale"),batch_norm_offset:n(a+"/BatchNorm/beta",1,i+"/batch_norm_offset"),batch_norm_mean:n(a+"/BatchNorm/moving_mean",1,i+"/batch_norm_mean"),batch_norm_variance:n(a+"/BatchNorm/moving_variance",1,i+"/batch_norm_variance")},pointwise_conv:r("MobilenetV1",e,o)}}function i(e,t){return{filters:n(e+"/weights",4,t+"/filters"),bias:n(e+"/biases",1,t+"/bias")}}function o(e){return{box_encoding_predictor:i("Prediction/BoxPredictor_"+e+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+e+"/box_encoding_predictor"),class_predictor:i("Prediction/BoxPredictor_"+e+"/ClassPredictor","prediction_layer/box_predictor_"+e+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:a(1),conv_2:a(2),conv_3:a(3),conv_4:a(4),conv_5:a(5),conv_6:a(6),conv_7:a(7),conv_8:a(8),conv_9:a(9),conv_10:a(10),conv_11:a(11),conv_12:a(12),conv_13:a(13)}},extractPredictionLayerParams:function(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:o(0),box_predictor_1:o(1),box_predictor_2:o(2),box_predictor_3:o(3),box_predictor_4:o(4),box_predictor_5:o(5)}}}}(e,t),r=n.extractMobilenetV1Params,a=n.extractPredictionLayerParams,i=e["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!V7(i))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+i);var o={mobilenetv1:r(),prediction_layer:a(),output_layer:{extra_dim:i}};return Qee(e,t),{params:o,paramMappings:t}}function Gte(e,t,n){return s$((function(){var r=g5(e,t.filters,n,"same");return r=I6(r,t.batch_norm_offset),P4(r,0,6)}))}function Vte(e,t){return s$((function(){var n=null,r=Gte(e,t.conv_0,[2,2]);if([t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13].forEach((function(e,t){var a=t+1,i=function(e){return[2,4,6,12].some((function(t){return t===e}))?[2,2]:[1,1]}(a);r=function(e,t,n){return s$((function(){var r=y5(e,t.filters,n,"same");return r=b6(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,.0010000000474974513),P4(r,0,6)}))}(r,e.depthwise_conv,i),r=Gte(r,e.pointwise_conv,[1,1]),11===a&&(n=r)})),null===n)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}}))}function Hte(e,t,n){var r=e.arraySync(),a=Math.min(r[t][0],r[t][2]),i=Math.min(r[t][1],r[t][3]),o=Math.max(r[t][0],r[t][2]),s=Math.max(r[t][1],r[t][3]),c=Math.min(r[n][0],r[n][2]),u=Math.min(r[n][1],r[n][3]),l=Math.max(r[n][0],r[n][2]),f=Math.max(r[n][1],r[n][3]),d=(o-a)*(s-i),h=(l-c)*(f-u);if(d<=0||h<=0)return 0;var p=Math.max(a,c),g=Math.max(i,u),m=Math.min(o,l),v=Math.min(s,f),b=Math.max(m-p,0)*Math.max(v-g,0);return b/(d+h-b)}function Yte(e,t){var n=function(e){var t=L0(u9(e,[1,0])),n=[X6(t[2],t[0]),X6(t[3],t[1])];return{sizes:n,centers:[I6(t[0],A6(n[0],N$(2))),I6(t[1],A6(n[1],N$(2)))]}}(e),r=n.sizes,a=n.centers,i=L0(u9(t,[1,0])),o=A6(W6(B4(A6(i[2],N$(5))),r[0]),N$(2)),s=I6(W6(A6(i[0],N$(10)),r[0]),a[0]),c=A6(W6(B4(A6(i[3],N$(5))),r[1]),N$(2)),u=I6(W6(A6(i[1],N$(10)),r[1]),a[1]);return u9(I0([X6(s,o),X6(u,c),I6(s,o),I6(u,c)]),[1,0])}function Xte(e,t){return s$((function(){var n=e.shape[0];return{boxPredictionEncoding:_0(Kee(e,t.box_encoding_predictor),[n,-1,1,4]),classPrediction:_0(Kee(e,t.class_predictor),[n,-1,3])}}))}var qte=function(){function e(e){var t=void 0===e?{}:e,n=t.minConfidence,r=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=r||100,"number"!==typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!==typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(e.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),e}(),Kte=function(e){function t(){return e.call(this,"SsdMobilenetv1")||this}return F7(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("SsdMobilenetv1 - load model before inference");return s$((function(){var n=e.toBatchTensor(512,!1).toFloat(),r=Vte(X6(W6(n,N$(.007843137718737125)),N$(1)),t.mobilenetv1),a=function(e,t,n){return s$((function(){var r=Gte(e,n.conv_0,[1,1]),a=Gte(r,n.conv_1,[2,2]),i=Gte(a,n.conv_2,[1,1]),o=Gte(i,n.conv_3,[2,2]),s=Gte(o,n.conv_4,[1,1]),c=Gte(s,n.conv_5,[2,2]),u=Gte(c,n.conv_6,[1,1]),l=Gte(u,n.conv_7,[2,2]),f=Xte(t,n.box_predictor_0),d=Xte(e,n.box_predictor_1),h=Xte(a,n.box_predictor_2),p=Xte(o,n.box_predictor_3),g=Xte(c,n.box_predictor_4),m=Xte(l,n.box_predictor_5);return{boxPredictions:U$([f.boxPredictionEncoding,d.boxPredictionEncoding,h.boxPredictionEncoding,p.boxPredictionEncoding,g.boxPredictionEncoding,m.boxPredictionEncoding],1),classPredictions:U$([f.classPrediction,d.classPrediction,h.classPrediction,p.classPrediction,g.classPrediction,m.classPrediction],1)}}))}(r.out,r.conv11,t.prediction_layer);return function(e,t,n){return s$((function(){var r=e.shape[0],a=Yte(_0(k0(n.extra_dim,[r,1,1]),[-1,4]),_0(e,[-1,4]));a=_0(a,[r,a.shape[0]/r,4]);var i=Q4(B5(t,[0,0,1],[-1,-1,-1])),o=B5(i,[0,0,0],[-1,-1,1]);return o=_0(o,[r,o.shape[1]]),{boxes:L0(a),scores:L0(o)}}))}(a.boxPredictions,a.classPredictions,t.output_layer)}))},t.prototype.forward=function(e){return j7(this,void 0,void 0,(function(){var t;return B7(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,zee(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.locateFaces=function(e,t){return void 0===t&&(t={}),j7(this,void 0,void 0,(function(){var n,r,a,i,o,s,c,u,l,f,d,h,p,g,m,v,b,y,x,w;return B7(this,(function(S){switch(S.label){case 0:return n=new qte(t),r=n.maxResults,a=n.minConfidence,[4,zee(e)];case 1:for(i=S.sent(),o=this.forwardInput(i),s=o.boxes,c=o.scores,u=s[0],l=c[0],f=1;f<s.length;f++)s[f].dispose(),c[f].dispose();return p=(h=Array).from,[4,l.data()];case 2:return d=p.apply(h,[S.sent()]),g=function(e,t,n,r,a){var i=e.shape[0],o=Math.min(n,i),s=t.map((function(e,t){return{score:e,boxIndex:t}})).filter((function(e){return e.score>a})).sort((function(e,t){return t.score-e.score})),c=function(e){return e<=r?1:0},u=[];return s.forEach((function(t){if(!(u.length>=o)){for(var n=t.score,r=u.length-1;r>=0;--r){var i=Hte(e,t.boxIndex,u[r]);if(0!==i&&(t.score*=c(i),t.score<=a))break}n===t.score&&u.push(t.boxIndex)}})),u}(u,d,r,.5,a),m=i.getReshapedInputDimensions(0),v=i.inputSize,b=v/m.width,y=v/m.height,x=u.arraySync(),w=g.map((function(e){var t=[Math.max(0,x[e][0]),Math.min(1,x[e][2])].map((function(e){return e*y})),n=t[0],r=t[1],a=[Math.max(0,x[e][1]),Math.min(1,x[e][3])].map((function(e){return e*b})),o=a[0],s=a[1];return new nee(d[e],new see(o,n,s-o,r-n),{height:i.getInputHeight(0),width:i.getInputWidth(0)})})),u.dispose(),l.dispose(),[2,w]}}))}))},t.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},t.prototype.extractParamsFromWeigthMap=function(e){return Wte(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=rte(e),r=n.extractWeights,a=n.getRemainingWeights,i=Ute(r,t),o=i.extractMobilenetV1Params,s=i.extractPredictionLayerParams,c=o(),u=s(),l={extra_dim:R$(r(20472),[1,5118,4])};if(t.push({paramPath:"output_layer/extra_dim"}),0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{params:{mobilenetv1:c,prediction_layer:u,output_layer:l},paramMappings:t}}(e)},t}(Hee);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}F7(t,e)}(Kte);var Qte,Jte=[new Z7(.738768,.874946),new Z7(2.42204,2.65704),new Z7(4.30971,7.04493),new Z7(10.246,4.59428),new Z7(12.6868,11.8741)],Zte=[new Z7(1.603231,2.094468),new Z7(6.041143,7.080126),new Z7(2.882459,3.518061),new Z7(4.266906,5.178857),new Z7(9.041765,10.66308)],$te=[117.001,114.697,97.404],ene=function(e){return"number"===typeof e};function tne(e){return s$((function(){var t=W6(e,N$(.10000000149011612));return I6(o9(X6(e,t)),t)}))}function nne(e,t){return s$((function(){var n=m0(e,[[0,0],[1,1],[1,1],[0,0]]);return n=g5(n,t.conv.filters,[1,1],"valid"),n=X6(n,t.bn.sub),n=W6(n,t.bn.truediv),tne(n=I6(n,t.conv.bias))}))}function rne(e,t){return s$((function(){var n=m0(e,[[0,0],[1,1],[1,1],[0,0]]);return n=S5(n,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),tne(n=I6(n,t.bias))}))}function ane(e,t){var n=Jee(e,t);var r=ete(e,t);return{extractConvParams:n,extractConvWithBatchNormParams:function(r,a,i){var o=n(r,a,3,i+"/conv"),s=function(n,r){var a=L$(e(n)),i=L$(e(n));return t.push({paramPath:r+"/sub"},{paramPath:r+"/truediv"}),{sub:a,truediv:i}}(a,i+"/bn");return{conv:o,bn:s}},extractSeparableConvParams:r}}function ine(e,t){var n=nte(e,t);function r(e){return{filters:n(e+"/filters",4),bias:n(e+"/bias",1)}}return{extractConvParams:r,extractConvWithBatchNormParams:function(e){var t=r(e+"/conv"),a=function(e){return{sub:n(e+"/sub",1),truediv:n(e+"/truediv",1)}}(e+"/bn");return{conv:t,bn:a}},extractSeparableConvParams:tte(n)}}!function(e){e[e.XS=224]="XS",e[e.SM=320]="SM",e[e.MD=416]="MD",e[e.LG=608]="LG"}(Qte||(Qte={}));var one=function(){function e(e){var t=void 0===e?{}:e,n=t.inputSize,r=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=r||.5,"number"!==typeof this._inputSize||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!==typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),e}(),sne=function(e){function t(t){var n=e.call(this,"TinyYolov2")||this;return function(e){if(!e)throw new Error("invalid config: "+e);if("boolean"!==typeof e.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+e.withSeparableConvs);if(!ene(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+e.iouThreshold);if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every((function(e){return"string"===typeof e})))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(e.classes));if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map((function(e){return e||{}})).every((function(e){return ene(e.x)&&ene(e.y)})))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(e.anchors));if(e.meanRgb&&(!Array.isArray(e.meanRgb)||3!==e.meanRgb.length||!e.meanRgb.every(ene)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(e.meanRgb))}(t),n._config=t,n}return F7(t,e),Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),t.prototype.runTinyYolov2=function(e,t){var n=nne(e,t.conv0);return n=nne(n=O5(n,[2,2],[2,2],"same"),t.conv1),n=nne(n=O5(n,[2,2],[2,2],"same"),t.conv2),n=nne(n=O5(n,[2,2],[2,2],"same"),t.conv3),n=nne(n=O5(n,[2,2],[2,2],"same"),t.conv4),n=nne(n=O5(n,[2,2],[2,2],"same"),t.conv5),n=nne(n=O5(n,[2,2],[1,1],"same"),t.conv6),Kee(n=nne(n,t.conv7),t.conv8,"valid",!1)},t.prototype.runMobilenet=function(e,t){var n=this.config.isFirstLayerConv2d?tne(Kee(e,t.conv0,"valid",!1)):rne(e,t.conv0);return n=rne(n=O5(n,[2,2],[2,2],"same"),t.conv1),n=rne(n=O5(n,[2,2],[2,2],"same"),t.conv2),n=rne(n=O5(n,[2,2],[2,2],"same"),t.conv3),n=rne(n=O5(n,[2,2],[2,2],"same"),t.conv4),n=rne(n=O5(n,[2,2],[2,2],"same"),t.conv5),n=O5(n,[2,2],[1,1],"same"),n=t.conv6?rne(n,t.conv6):n,Kee(n=t.conv7?rne(n,t.conv7):n,t.conv8,"valid",!1)},t.prototype.forwardInput=function(e,t){var n=this,r=this.params;if(!r)throw new Error("TinyYolov2 - load model before inference");return s$((function(){var a=e.toBatchTensor(t,!1).toFloat();return a=(a=n.config.meanRgb?iee(a,n.config.meanRgb):a).div(N$(256)),n.config.withSeparableConvs?n.runMobilenet(a,r):n.runTinyYolov2(a,r)}))},t.prototype.forward=function(e,t){return j7(this,void 0,void 0,(function(){var n;return B7(this,(function(r){switch(r.label){case 0:return n=this.forwardInput,[4,zee(e)];case 1:return[4,n.apply(this,[r.sent(),t])];case 2:return[2,r.sent()]}}))}))},t.prototype.detect=function(e,t){return void 0===t&&(t={}),j7(this,void 0,void 0,(function(){var n,r,a,i,o,s,c,u,l,f,d,h,p,g=this;return B7(this,(function(m){switch(m.label){case 0:return n=new one(t),r=n.inputSize,a=n.scoreThreshold,[4,zee(e)];case 1:return i=m.sent(),[4,this.forwardInput(i,r)];case 2:return o=m.sent(),s=s$((function(){return L0(o)[0].expandDims()})),c={width:i.getInputWidth(0),height:i.getInputHeight(0)},[4,this.extractBoxes(s,i.getReshapedInputDimensions(0),a)];case 3:return u=m.sent(),o.dispose(),s.dispose(),l=u.map((function(e){return e.box})),f=u.map((function(e){return e.score})),d=u.map((function(e){return e.classScore})),h=u.map((function(e){return g.config.classes[e.label]})),p=aee(l.map((function(e){return e.rescale(r)})),f,this.config.iouThreshold,!0),[2,p.map((function(e){return new tee(f[e],d[e],h[e],l[e],c)}))]}}))}))},t.prototype.getDefaultModelName=function(){return""},t.prototype.extractParamsFromWeigthMap=function(e){return function(e,t){var n,r=[],a=ine(e,r),i=a.extractConvParams,o=a.extractConvWithBatchNormParams,s=a.extractSeparableConvParams;if(t.withSeparableConvs){var c=t.filterSizes&&t.filterSizes.length||9;n={conv0:t.isFirstLayerConv2d?i("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:c>7?s("conv6"):void 0,conv7:c>8?s("conv7"):void 0,conv8:i("conv8")}}else n={conv0:o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:o("conv6"),conv7:o("conv7"),conv8:i("conv8")};return Qee(e,r),{params:n,paramMappings:r}}(e,this.config)},t.prototype.extractParams=function(e){var n=this.config.filterSizes||t.DEFAULT_FILTER_SIZES,r=n?n.length:void 0;if(7!==r&&8!==r&&9!==r)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+r+" filterSizes in config");return function(e,t,n,r){var a,i=rte(e),o=i.extractWeights,s=i.getRemainingWeights,c=[],u=ane(o,c),l=u.extractConvParams,f=u.extractConvWithBatchNormParams,d=u.extractSeparableConvParams;if(t.withSeparableConvs){var h=r[0],p=r[1],g=r[2],m=r[3],v=r[4],b=r[5],y=r[6],x=r[7],w=r[8];a={conv0:t.isFirstLayerConv2d?l(h,p,3,"conv0"):d(h,p,"conv0"),conv1:d(p,g,"conv1"),conv2:d(g,m,"conv2"),conv3:d(m,v,"conv3"),conv4:d(v,b,"conv4"),conv5:d(b,y,"conv5"),conv6:x?d(y,x,"conv6"):void 0,conv7:w?d(x,w,"conv7"):void 0,conv8:l(w||x||y,5*n,1,"conv8")}}else h=r[0],p=r[1],g=r[2],m=r[3],v=r[4],b=r[5],y=r[6],x=r[7],w=r[8],a={conv0:f(h,p,"conv0"),conv1:f(p,g,"conv1"),conv2:f(g,m,"conv2"),conv3:f(m,v,"conv3"),conv4:f(v,b,"conv4"),conv5:f(b,y,"conv5"),conv6:f(y,x,"conv6"),conv7:f(x,w,"conv7"),conv8:l(w,5*n,1,"conv8")};if(0!==s().length)throw new Error("weights remaing after extract: "+s().length);return{params:a,paramMappings:c}}(e,this.config,this.boxEncodingSize,n)},t.prototype.extractBoxes=function(e,t,n){return j7(this,void 0,void 0,(function(){var r,a,i,o,s,c,u,l,f,d,h,p,g,m,v,b,y,x,w,S,C,M,_,E,T,I,k,N,L,A=this;return B7(this,(function(R){switch(R.label){case 0:return r=t.width,a=t.height,i=Math.max(r,a),o=i/r,s=i/a,c=e.shape[1],u=this.config.anchors.length,l=s$((function(){var t=e.reshape([c,c,u,A.boxEncodingSize]);return[t.slice([0,0,0,0],[c,c,u,4]),t.slice([0,0,0,4],[c,c,u,1]),A.withClassScores?Q0(t.slice([0,0,0,5],[c,c,u,A.config.classes.length]),3):N$(0)]})),f=l[0],d=l[1],h=l[2],p=[],[4,d.array()];case 1:return g=R.sent(),[4,f.array()];case 2:m=R.sent(),v=0,R.label=3;case 3:if(!(v<c))return[3,12];b=0,R.label=4;case 4:if(!(b<c))return[3,11];y=0,R.label=5;case 5:return y<u?(x=oee(g[v][b][y][0]),!n||x>n?(w=(b+oee(m[v][b][y][0]))/c*o,S=(v+oee(m[v][b][y][1]))/c*s,C=Math.exp(m[v][b][y][2])*this.config.anchors[y].x/c*o,M=Math.exp(m[v][b][y][3])*this.config.anchors[y].y/c*s,_=w-C/2,E=S-M/2,T={row:v,col:b,anchor:y},this.withClassScores?[4,this.extractPredictedClass(h,T)]:[3,7]):[3,9]):[3,10];case 6:return L=R.sent(),[3,8];case 7:L={classScore:1,label:0},R.label=8;case 8:k=(I=L).classScore,N=I.label,p.push(z7({box:new eee(_,E,_+C,E+M),score:x,classScore:x*k,label:N},T)),R.label=9;case 9:return y++,[3,5];case 10:return b++,[3,4];case 11:return v++,[3,3];case 12:return f.dispose(),d.dispose(),h.dispose(),[2,p]}}))}))},t.prototype.extractPredictedClass=function(e,t){return j7(this,void 0,void 0,(function(){var n,r,a,i;return B7(this,(function(o){switch(o.label){case 0:return n=t.row,r=t.col,a=t.anchor,[4,e.array()];case 1:return i=o.sent(),[2,Array(this.config.classes.length).fill(0).map((function(e,t){return i[n][r][a][t]})).map((function(e,t){return{classScore:e,label:t}})).reduce((function(e,t){return e.classScore>t.classScore?e:t}))]}}))}))},t.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],t}(Hee),cne=function(e){function t(t){void 0===t&&(t=!0);var n=Object.assign({},{withSeparableConvs:t,iouThreshold:.4,classes:["face"]},t?{anchors:Zte,meanRgb:$te}:{anchors:Jte,withClassScores:!0});return e.call(this,n)||this}return F7(t,e),Object.defineProperty(t.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,t){return j7(this,void 0,void 0,(function(){return B7(this,(function(n){switch(n.label){case 0:return[4,this.detect(e,t)];case 1:return[2,n.sent().map((function(e){return new nee(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})}))]}}))}))},t.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},t.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},t}(sne);var une=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return F7(t,e),t}(one),lne=function(){function e(){}return e.prototype.then=function(e){return j7(this,void 0,void 0,(function(){var t;return B7(this,(function(n){switch(n.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[n.sent()])]}}))}))},e.prototype.run=function(){return j7(this,void 0,void 0,(function(){return B7(this,(function(e){throw new Error("ComposableTask - run is not implemented")}))}))},e}();function fne(e,t){var n={descriptor:t};return Object.assign({},e,n)}function dne(e,t,n,r,a){return void 0===a&&(a=function(e){return e.alignedRect}),j7(this,void 0,void 0,(function(){var i,o,s,c,u;return B7(this,(function(l){switch(l.label){case 0:return i=e.map((function(e){return gte(e)?a(e):e.detection})),(s=r)?[3,5]:t instanceof jJ?[4,Bee(t,i)]:[3,2];case 1:return c=l.sent(),[3,4];case 2:return[4,jee(t,i)];case 3:c=l.sent(),l.label=4;case 4:s=c,l.label=5;case 5:return[4,n(o=s)];case 6:return u=l.sent(),o.forEach((function(e){return e instanceof jJ&&e.dispose()})),[2,u]}}))}))}function hne(e,t,n,r,a){return j7(this,void 0,void 0,(function(){var i=this;return B7(this,(function(o){return[2,dne([e],t,(function(e){return j7(i,void 0,void 0,(function(){return B7(this,(function(t){return[2,n(e[0])]}))}))}),r,a)]}))}))}function pne(e){var t=rte(e),n=t.extractWeights,r=t.getRemainingWeights,a=[],i=function(e,t){var n=Jee(e,t),r=Zee(e,t);function a(n,r){var a=L$(e(n));return t.push({paramPath:r}),a}function i(e,t,r){return void 0===r&&(r=!1),{conv1:n(e[0],e[1],3,t+"/conv1"),prelu1_alpha:a(e[1],t+"/prelu1_alpha"),conv2:n(e[1],e[2],3,t+"/conv2"),prelu2_alpha:a(e[2],t+"/prelu2_alpha"),conv3:n(e[2],e[3],r?2:3,t+"/conv3"),prelu3_alpha:a(e[3],t+"/prelu3_alpha")}}return{extractPNetParams:function(){var e=i([3,10,16,32],"pnet"),t=n(32,2,1,"pnet/conv4_1"),r=n(32,4,1,"pnet/conv4_2");return z7(z7({},e),{conv4_1:t,conv4_2:r})},extractRNetParams:function(){var e=i([3,28,48,64],"rnet",!0),t=r(576,128,"rnet/fc1"),n=a(128,"rnet/prelu4_alpha"),o=r(128,2,"rnet/fc2_1"),s=r(128,4,"rnet/fc2_2");return z7(z7({},e),{fc1:t,prelu4_alpha:n,fc2_1:o,fc2_2:s})},extractONetParams:function(){var e=i([3,32,64,64],"onet"),t=n(64,128,2,"onet/conv4"),o=a(128,"onet/prelu4_alpha"),s=r(1152,256,"onet/fc1"),c=a(256,"onet/prelu5_alpha"),u=r(256,2,"onet/fc2_1"),l=r(256,4,"onet/fc2_2"),f=r(256,10,"onet/fc2_3");return z7(z7({},e),{conv4:t,prelu4_alpha:o,fc1:s,prelu5_alpha:c,fc2_1:u,fc2_2:l,fc2_3:f})}}}(n,a),o=i.extractPNetParams,s=i.extractRNetParams,c=i.extractONetParams,u=o(),l=s(),f=c();if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:u,rnet:l,onet:f},paramMappings:a}}function gne(e){var t=[],n=function(e,t){var n=nte(e,t);function r(e){return{filters:n(e+"/weights",4,e+"/filters"),bias:n(e+"/bias",1)}}function a(e){return{weights:n(e+"/weights",2),bias:n(e+"/bias",1)}}function i(e){return n(e,1)}function o(e){return{conv1:r(e+"/conv1"),prelu1_alpha:i(e+"/prelu1_alpha"),conv2:r(e+"/conv2"),prelu2_alpha:i(e+"/prelu2_alpha"),conv3:r(e+"/conv3"),prelu3_alpha:i(e+"/prelu3_alpha")}}return{extractPNetParams:function(){var e=o("pnet"),t=r("pnet/conv4_1"),n=r("pnet/conv4_2");return z7(z7({},e),{conv4_1:t,conv4_2:n})},extractRNetParams:function(){var e=o("rnet"),t=a("rnet/fc1"),n=i("rnet/prelu4_alpha"),r=a("rnet/fc2_1"),s=a("rnet/fc2_2");return z7(z7({},e),{fc1:t,prelu4_alpha:n,fc2_1:r,fc2_2:s})},extractONetParams:function(){var e=o("onet"),t=r("onet/conv4"),n=i("onet/prelu4_alpha"),s=a("onet/fc1"),c=i("onet/prelu5_alpha"),u=a("onet/fc2_1"),l=a("onet/fc2_2"),f=a("onet/fc2_3");return z7(z7({},e),{conv4:t,prelu4_alpha:n,fc1:s,prelu5_alpha:c,fc2_1:u,fc2_2:l,fc2_3:f})}}}(e,t),r=n.extractPNetParams,a=n.extractRNetParams,i=n.extractONetParams,o=r(),s=a(),c=i();return Qee(e,t),{params:{pnet:o,rnet:s,onet:c},paramMappings:t}}function mne(e,t){var n=t[0],r=t[1];return{height:Math.floor(n*e),width:Math.floor(r*e)}}var vne=function(e){function t(t,n,r,a){return e.call(this,{left:t,top:n,right:r,bottom:a},!0)||this}return F7(t,e),t}($7);function bne(e){return s$((function(){return W6(X6(e,N$(127.5)),N$(.0078125))}))}function yne(e,t){return s$((function(){return I6(o9(e),W6(t,Y4(o9(Y4(e)))))}))}function xne(e,t,n){return void 0===n&&(n=!1),s$((function(){var r=Kee(e,t.conv1,"valid");return r=yne(r,t.prelu1_alpha),r=yne(r=Kee(r=O5(r,n?[2,2]:[3,3],[2,2],"same"),t.conv2,"valid"),t.prelu2_alpha),r=yne(r=Kee(r=n?r:O5(r,[3,3],[2,2],"valid"),t.conv3,"valid"),t.prelu3_alpha)}))}function wne(e,t,n,r,a){a.stage1=[];var i=t.map((function(t){return s$((function(){var n={scale:t},a=function(e,t){return s$((function(){var n=mne(t,e.shape.slice(1)),r=n.height,a=n.width,i=bne(t8.resizeBilinear(e,[r,a]));return u9(i,[0,2,1,3])}))}(e,t),i=Date.now(),o=function(e,t){return s$((function(){var n=xne(e,t,!0),r=Kee(n,t.conv4_1,"valid"),a=d0(J5(r,3),3);return{prob:Q0(X6(r,a),3),regions:Kee(n,t.conv4_2,"valid")}}))}(a,r),s=o.prob,c=o.regions;return n.pnet=Date.now()-i,{scoresTensor:L0(L0(s,3)[1])[0],regionsTensor:L0(c)[0],scale:t,statsForScale:n}}))})),o=i.map((function(e){var t=e.scoresTensor,r=e.regionsTensor,i=e.scale,o=e.statsForScale,s=function(e,t,n,r){for(var a=[],i=e.arraySync(),o=0;o<e.shape[0];o++)for(var s=0;s<e.shape[1];s++)i[o][s]>=r&&a.push(new Z7(s,o));return a.map((function(e){var r=new eee(Math.round((2*e.y+1)/n),Math.round((2*e.x+1)/n),Math.round((2*e.y+12)/n),Math.round((2*e.x+12)/n)),a=i[e.y][e.x],o=t.arraySync();return{cell:r,score:a,region:new vne(o[e.y][e.x][0],o[e.y][e.x][1],o[e.y][e.x][2],o[e.y][e.x][3])}}))}(t,r,i,n);if(t.dispose(),r.dispose(),!s.length)return a.stage1.push(o),[];var c=Date.now(),u=aee(s.map((function(e){return e.cell})),s.map((function(e){return e.score})),.5);return o.nms=Date.now()-c,o.numBoxes=u.length,a.stage1.push(o),u.map((function(e){return s[e]}))})),s=o.reduce((function(e,t){return e.concat(t)}),[]),c=[],u=[];if(s.length>0){var l=Date.now(),f=aee(s.map((function(e){return e.cell})),s.map((function(e){return e.score})),.7);a.stage1_nms=Date.now()-l,u=f.map((function(e){return s[e].score})),c=f.map((function(e){return s[e]})).map((function(e){var t=e.cell,n=e.region;return new eee(t.left+n.left*t.width,t.top+n.top*t.height,t.right+n.right*t.width,t.bottom+n.bottom*t.height).toSquare().round()}))}return{boxes:c,scores:u}}function Sne(e,t,n){var r=n.width,a=n.height;return j7(this,void 0,void 0,(function(){var n,i,o,s=this;return B7(this,(function(c){switch(c.label){case 0:return n=Tee(e),[4,Promise.all(t.map((function(t){return j7(s,void 0,void 0,(function(){var r,a,i,o,s,c,u,l;return B7(this,(function(f){return r=t.padAtBorders(e.height,e.width),a=r.y,i=r.ey,o=r.x,s=r.ex,c=o-1,u=a-1,l=n.getImageData(c,u,s-c,i-u),[2,_ee.isNodejs()?Dee(l):createImageBitmap(l)]}))}))})))];case 1:return i=c.sent(),o=[],i.forEach((function(e){var t=Tee(Ree({width:r,height:a}));t.drawImage(e,0,0,r,a);for(var n=t.getImageData(0,0,r,a).data,i=[],s=0;s<n.length;s+=4)i.push(n[s+2]),i.push(n[s+1]),i.push(n[s]);o.push(i)})),[2,o.map((function(e){return s$((function(){return bne(u9(D$(e,[1,r,a,3]),[0,2,1,3]).toFloat())}))}))]}}))}))}function Cne(e,t,n,r,a){return j7(this,void 0,void 0,(function(){var i,o,s,c,u,l,f,d,h,p,g,m,v,b;return B7(this,(function(y){switch(y.label){case 0:return i=Date.now(),[4,Sne(e,t,{width:24,height:24})];case 1:return o=y.sent(),a.stage2_extractImagePatches=Date.now()-i,i=Date.now(),s=o.map((function(e){var t=function(e,t){return s$((function(){var n=xne(e,t),r=yne(cte(_0(n,[n.shape[0],t.fc1.weights.shape[0]]),t.fc1),t.prelu4_alpha),a=cte(r,t.fc2_1),i=d0(J5(a,1),1),o=Q0(X6(a,i),1),s=cte(r,t.fc2_2);return{scores:L0(o,1)[1],regions:s}}))}(e,r);return e.dispose(),t})),a.stage2_rnet=Date.now()-i,c=s.length>1?U$(s.map((function(e){return e.scores}))):s[0].scores,f=(l=Array).from,[4,c.data()];case 2:return u=f.apply(l,[y.sent()]),c.dispose(),d=u.map((function(e,t){return{score:e,idx:t}})).filter((function(e){return e.score>n})).map((function(e){return e.idx})),h=d.map((function(e){return t[e]})),p=d.map((function(e){return u[e]})),g=[],m=[],h.length>0&&(i=Date.now(),v=aee(h,p,.7),a.stage2_nms=Date.now()-i,b=v.map((function(e){var t=s[d[e]].regions.arraySync();return new vne(t[0][0],t[0][1],t[0][2],t[0][3])})),m=v.map((function(e){return p[e]})),g=v.map((function(e,t){return h[e].calibrate(b[t])}))),s.forEach((function(e){e.regions.dispose(),e.scores.dispose()})),[2,{boxes:g,scores:m}]}}))}))}function Mne(e,t,n,r,a){return j7(this,void 0,void 0,(function(){var i,o,s,c,u,l,f,d,h,p,g,m,v,b,y;return B7(this,(function(x){switch(x.label){case 0:return i=Date.now(),[4,Sne(e,t,{width:48,height:48})];case 1:return o=x.sent(),a.stage3_extractImagePatches=Date.now()-i,i=Date.now(),s=o.map((function(e){var t=function(e,t){return s$((function(){var n=xne(e,t);n=yne(n=Kee(n=O5(n,[2,2],[2,2],"same"),t.conv4,"valid"),t.prelu4_alpha);var r=yne(cte(_0(n,[n.shape[0],t.fc1.weights.shape[0]]),t.fc1),t.prelu5_alpha),a=cte(r,t.fc2_1),i=d0(J5(a,1),1),o=Q0(X6(a,i),1),s=cte(r,t.fc2_2),c=cte(r,t.fc2_3);return{scores:L0(o,1)[1],regions:s,points:c}}))}(e,r);return e.dispose(),t})),a.stage3_onet=Date.now()-i,c=s.length>1?U$(s.map((function(e){return e.scores}))):s[0].scores,f=(l=Array).from,[4,c.data()];case 2:return u=f.apply(l,[x.sent()]),c.dispose(),d=u.map((function(e,t){return{score:e,idx:t}})).filter((function(e){return e.score>n})).map((function(e){return e.idx})),h=d.map((function(e){var t=s[e].regions.arraySync();return new vne(t[0][0],t[0][1],t[0][2],t[0][3])})),p=d.map((function(e,n){return t[e].calibrate(h[n])})),g=d.map((function(e){return u[e]})),m=[],v=[],b=[],p.length>0&&(i=Date.now(),y=aee(p,g,.7,!1),a.stage3_nms=Date.now()-i,m=y.map((function(e){return p[e]})),v=y.map((function(e){return g[e]})),b=y.map((function(e,t){return Array(5).fill(0).map((function(n,r){var a=s[e].points.arraySync();return new Z7(a[0][r]*(m[t].width+1)+m[t].left,a[0][r+5]*(m[t].height+1)+m[t].top)}))}))),s.forEach((function(e){e.regions.dispose(),e.scores.dispose(),e.points.dispose()})),[2,{boxes:m,scores:v,points:b}]}}))}))}var _ne=function(e){function t(){return e.call(this,"Mtcnn")||this}return F7(t,e),t.prototype.load=function(t){return j7(this,void 0,void 0,(function(){return B7(this,(function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.load.call(this,t)]}))}))},t.prototype.loadFromDisk=function(t){return j7(this,void 0,void 0,(function(){return B7(this,(function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.loadFromDisk.call(this,t)]}))}))},t.prototype.forwardInput=function(e,t){return void 0===t&&(t={}),j7(this,void 0,void 0,(function(){var n,r,a,i,o,s,c,u,l,f,d,h,p,g,m,v,b,y,x,w,S;return B7(this,(function(C){switch(C.label){case 0:if(!(n=this.params))throw new Error("Mtcnn - load model before inference");if(!(r=e.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return a={},i=Date.now(),o=s$((function(){return function(e){return s$((function(){return I0(L0(e,3).reverse(),3)}))}(d0(x7.fromPixels(r)).toFloat())})),s=function(e){return o.dispose(),a.total=Date.now()-i,e},c=o.shape.slice(1),u=c[0],l=c[1],f=new Bte(t),d=f.minFaceSize,h=f.scaleFactor,p=f.maxNumScales,g=f.scoreThresholds,m=f.scaleSteps,v=(m||function(e,t,n){for(var r=n[0],a=n[1],i=12/e,o=[],s=Math.min(r,a)*i,c=0;s>=12;)o.push(i*Math.pow(t,c)),s*=t,c+=1;return o}(d,h,[u,l])).filter((function(e){var t=mne(e,[u,l]);return Math.min(t.width,t.height)>12})).slice(0,p),a.scales=v,a.pyramid=v.map((function(e){return mne(e,[u,l])})),b=Date.now(),[4,wne(o,v,g[0],n.pnet,a)];case 1:return y=C.sent(),a.total_stage1=Date.now()-b,y.boxes.length?(a.stage2_numInputBoxes=y.boxes.length,b=Date.now(),[4,Cne(r,y.boxes,g[1],n.rnet,a)]):[2,s({results:[],stats:a})];case 2:return x=C.sent(),a.total_stage2=Date.now()-b,x.boxes.length?(a.stage3_numInputBoxes=x.boxes.length,b=Date.now(),[4,Mne(r,x.boxes,g[2],n.onet,a)]):[2,s({results:[],stats:a})];case 3:return w=C.sent(),a.total_stage3=Date.now()-b,S=w.boxes.map((function(e,t){return mte(pee({},new nee(w.scores[t],new see(e.left/l,e.top/u,e.width/l,e.height/u),{height:u,width:l})),new uee(w.points[t].map((function(t){return t.sub(new Z7(e.left,e.top)).div(new Z7(e.width,e.height))})),{width:e.width,height:e.height}))})),[2,s({results:S,stats:a})]}}))}))},t.prototype.forward=function(e,t){return void 0===t&&(t={}),j7(this,void 0,void 0,(function(){var n;return B7(this,(function(r){switch(r.label){case 0:return n=this.forwardInput,[4,zee(e)];case 1:return[4,n.apply(this,[r.sent(),t])];case 2:return[2,r.sent().results]}}))}))},t.prototype.forwardWithStats=function(e,t){return void 0===t&&(t={}),j7(this,void 0,void 0,(function(){var n;return B7(this,(function(r){switch(r.label){case 0:return n=this.forwardInput,[4,zee(e)];case 1:return[2,n.apply(this,[r.sent(),t])]}}))}))},t.prototype.getDefaultModelName=function(){return"mtcnn_model"},t.prototype.extractParamsFromWeigthMap=function(e){return gne(e)},t.prototype.extractParams=function(e){return pne(e)},t}(Hee),Ene=[new Z7(1.603231,2.094468),new Z7(6.041143,7.080126),new Z7(2.882459,3.518061),new Z7(4.266906,5.178857),new Z7(9.041765,10.66308)],Tne=[117.001,114.697,97.404],Ine=function(e){function t(){var t={withSeparableConvs:!0,iouThreshold:.4,classes:["face"],anchors:Ene,meanRgb:Tne,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return e.call(this,t)||this}return F7(t,e),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,t){return j7(this,void 0,void 0,(function(){return B7(this,(function(n){switch(n.label){case 0:return[4,this.detect(e,t)];case 1:return[2,n.sent().map((function(e){return new nee(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})}))]}}))}))},t.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},t.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},t}(sne),kne={ssdMobilenetv1:new Kte,tinyFaceDetector:new Ine,tinyYolov2:new cne,mtcnn:new _ne,faceLandmark68Net:new Tte,faceLandmark68TinyNet:new kte,faceRecognitionNet:new zte,faceExpressionNet:new hte,ageGenderNet:new _te};function Nne(e,t){var n={age:t};return Object.assign({},e,n)}var Lne=function(e){function t(t,n,r){var a=e.call(this)||this;return a.parentTask=t,a.input=n,a.extractedFaces=r,a}return F7(t,e),t}(lne),Ane=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return F7(t,e),t.prototype.run=function(){return j7(this,void 0,void 0,(function(){var e,t,n=this;return B7(this,(function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,dne(e=r.sent(),this.input,(function(e){return j7(n,void 0,void 0,(function(){return B7(this,(function(t){switch(t.label){case 0:return[4,Promise.all(e.map((function(e){return kne.faceExpressionNet.predictExpressions(e)})))];case 1:return[2,t.sent()]}}))}))}),this.extractedFaces)];case 2:return t=r.sent(),[2,e.map((function(e,n){return pte(e,t[n])}))]}}))}))},t.prototype.withAgeAndGender=function(){return new Fne(this,this.input)},t}(Lne),Rne=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return F7(t,e),t.prototype.run=function(){return j7(this,void 0,void 0,(function(){var e,t;return B7(this,(function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(e=n.sent())?[4,hne(e,this.input,(function(e){return kne.faceExpressionNet.predictExpressions(e)}),this.extractedFaces)]:[2];case 2:return t=n.sent(),[2,pte(e,t)]}}))}))},t.prototype.withAgeAndGender=function(){return new zne(this,this.input)},t}(Lne),Dne=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return F7(t,e),t.prototype.withAgeAndGender=function(){return new jne(this,this.input)},t.prototype.withFaceDescriptors=function(){return new Wne(this,this.input)},t}(Ane),One=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return F7(t,e),t.prototype.withAgeAndGender=function(){return new Bne(this,this.input)},t.prototype.withFaceDescriptor=function(){return new Gne(this,this.input)},t}(Rne),Pne=function(e){function t(t,n,r){var a=e.call(this)||this;return a.parentTask=t,a.input=n,a.extractedFaces=r,a}return F7(t,e),t}(lne),Fne=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return F7(t,e),t.prototype.run=function(){return j7(this,void 0,void 0,(function(){var e,t,n=this;return B7(this,(function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,dne(e=r.sent(),this.input,(function(e){return j7(n,void 0,void 0,(function(){return B7(this,(function(t){switch(t.label){case 0:return[4,Promise.all(e.map((function(e){return kne.ageGenderNet.predictAgeAndGender(e)})))];case 1:return[2,t.sent()]}}))}))}),this.extractedFaces)];case 2:return t=r.sent(),[2,e.map((function(e,n){var r=t[n],a=r.age;return Nne(jte(e,r.gender,r.genderProbability),a)}))]}}))}))},t.prototype.withFaceExpressions=function(){return new Ane(this,this.input)},t}(Pne),zne=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return F7(t,e),t.prototype.run=function(){return j7(this,void 0,void 0,(function(){var e,t,n,r,a;return B7(this,(function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return(e=i.sent())?[4,hne(e,this.input,(function(e){return kne.ageGenderNet.predictAgeAndGender(e)}),this.extractedFaces)]:[2];case 2:return t=i.sent(),n=t.age,r=t.gender,a=t.genderProbability,[2,Nne(jte(e,r,a),n)]}}))}))},t.prototype.withFaceExpressions=function(){return new Rne(this,this.input)},t}(Pne),jne=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return F7(t,e),t.prototype.withFaceExpressions=function(){return new Dne(this,this.input)},t.prototype.withFaceDescriptors=function(){return new Wne(this,this.input)},t}(Fne),Bne=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return F7(t,e),t.prototype.withFaceExpressions=function(){return new One(this,this.input)},t.prototype.withFaceDescriptor=function(){return new Gne(this,this.input)},t}(zne),Une=function(e){function t(t,n){var r=e.call(this)||this;return r.parentTask=t,r.input=n,r}return F7(t,e),t}(lne),Wne=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return F7(t,e),t.prototype.run=function(){return j7(this,void 0,void 0,(function(){var e;return B7(this,(function(t){switch(t.label){case 0:return[4,this.parentTask];case 1:return[4,dne(e=t.sent(),this.input,(function(e){return Promise.all(e.map((function(e){return kne.faceRecognitionNet.computeFaceDescriptor(e)})))}),null,(function(e){return e.landmarks.align(null,{useDlibAlignment:!0})}))];case 2:return[2,t.sent().map((function(t,n){return fne(e[n],t)}))]}}))}))},t.prototype.withFaceExpressions=function(){return new Dne(this,this.input)},t.prototype.withAgeAndGender=function(){return new jne(this,this.input)},t}(Une),Gne=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return F7(t,e),t.prototype.run=function(){return j7(this,void 0,void 0,(function(){var e,t;return B7(this,(function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(e=n.sent())?[4,hne(e,this.input,(function(e){return kne.faceRecognitionNet.computeFaceDescriptor(e)}),null,(function(e){return e.landmarks.align(null,{useDlibAlignment:!0})}))]:[2];case 2:return t=n.sent(),[2,fne(e,t)]}}))}))},t.prototype.withFaceExpressions=function(){return new One(this,this.input)},t.prototype.withAgeAndGender=function(){return new Bne(this,this.input)},t}(Une),Vne=function(e){function t(t,n,r){var a=e.call(this)||this;return a.parentTask=t,a.input=n,a.useTinyLandmarkNet=r,a}return F7(t,e),Object.defineProperty(t.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?kne.faceLandmark68TinyNet:kne.faceLandmark68Net},enumerable:!0,configurable:!0}),t}(lne),Hne=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return F7(t,e),t.prototype.run=function(){return j7(this,void 0,void 0,(function(){var e,t,n,r,a,i=this;return B7(this,(function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return e=o.sent(),t=e.map((function(e){return e.detection})),this.input instanceof jJ?[4,Bee(this.input,t)]:[3,3];case 2:return r=o.sent(),[3,5];case 3:return[4,jee(this.input,t)];case 4:r=o.sent(),o.label=5;case 5:return n=r,[4,Promise.all(n.map((function(e){return i.landmarkNet.detectLandmarks(e)})))];case 6:return a=o.sent(),n.forEach((function(e){return e instanceof jJ&&e.dispose()})),[2,e.map((function(e,t){return mte(e,a[t])}))]}}))}))},t.prototype.withFaceExpressions=function(){return new Dne(this,this.input)},t.prototype.withAgeAndGender=function(){return new jne(this,this.input)},t.prototype.withFaceDescriptors=function(){return new Wne(this,this.input)},t}(Vne),Yne=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return F7(t,e),t.prototype.run=function(){return j7(this,void 0,void 0,(function(){var e,t,n,r,a;return B7(this,(function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return(e=i.sent())?(t=e.detection,this.input instanceof jJ?[4,Bee(this.input,[t])]:[3,3]):[2];case 2:return r=i.sent(),[3,5];case 3:return[4,jee(this.input,[t])];case 4:r=i.sent(),i.label=5;case 5:return n=r,[4,this.landmarkNet.detectLandmarks(n[0])];case 6:return a=i.sent(),n.forEach((function(e){return e instanceof jJ&&e.dispose()})),[2,mte(e,a)]}}))}))},t.prototype.withFaceExpressions=function(){return new One(this,this.input)},t.prototype.withAgeAndGender=function(){return new Bne(this,this.input)},t.prototype.withFaceDescriptor=function(){return new Gne(this,this.input)},t}(Vne),Xne=function(e){function t(t,n){void 0===n&&(n=new qte);var r=e.call(this)||this;return r.input=t,r.options=n,r}return F7(t,e),t}(lne),qne=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return F7(t,e),t.prototype.run=function(){return j7(this,void 0,void 0,(function(){var e,t,n,r;return B7(this,(function(a){switch(a.label){case 0:return t=(e=this).input,(n=e.options)instanceof Bte?[4,kne.mtcnn.forward(t,n)]:[3,2];case 1:return[2,a.sent().map((function(e){return e.detection}))];case 2:if(r=n instanceof une?function(e){return kne.tinyFaceDetector.locateFaces(e,n)}:n instanceof qte?function(e){return kne.ssdMobilenetv1.locateFaces(e,n)}:n instanceof one?function(e){return kne.tinyYolov2.locateFaces(e,n)}:null,!r)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,r(t)]}}))}))},t.prototype.runAndExtendWithFaceDetections=function(){var e=this;return new Promise((function(t){return j7(e,void 0,void 0,(function(){var e;return B7(this,(function(n){switch(n.label){case 0:return[4,this.run()];case 1:return e=n.sent(),[2,t(e.map((function(e){return pee({},e)})))]}}))}))}))},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new Hne(this.runAndExtendWithFaceDetections(),this.input,e)},t.prototype.withFaceExpressions=function(){return new Ane(this.runAndExtendWithFaceDetections(),this.input)},t.prototype.withAgeAndGender=function(){return new Fne(this.runAndExtendWithFaceDetections(),this.input)},t}(Xne);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}F7(t,e),t.prototype.run=function(){return j7(this,void 0,void 0,(function(){var e,t;return B7(this,(function(n){switch(n.label){case 0:return[4,new qne(this.input,this.options)];case 1:return e=n.sent(),t=e[0],e.forEach((function(e){e.score>t.score&&(t=e)})),[2,t]}}))}))},t.prototype.runAndExtendWithFaceDetection=function(){var e=this;return new Promise((function(t){return j7(e,void 0,void 0,(function(){var e;return B7(this,(function(n){switch(n.label){case 0:return[4,this.run()];case 1:return e=n.sent(),[2,t(e?pee({},e):void 0)]}}))}))}))},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new Yne(this.runAndExtendWithFaceDetection(),this.input,e)},t.prototype.withFaceExpressions=function(){return new Rne(this.runAndExtendWithFaceDetection(),this.input)},t.prototype.withAgeAndGender=function(){return new zne(this.runAndExtendWithFaceDetection(),this.input)}}(Xne);!function(){function e(e,t){void 0===t&&(t=.6),this._distanceThreshold=t;var n=Array.isArray(e)?e:[e];if(!n.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var r=1,a=function(){return"person "+r++};this._labeledDescriptors=n.map((function(e){if(e instanceof hee)return e;if(e instanceof Float32Array)return new hee(a(),[e]);if(e.descriptor&&e.descriptor instanceof Float32Array)return new hee(a(),[e.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")}))}Object.defineProperty(e.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),e.prototype.computeMeanDistance=function(e,t){return t.map((function(t){return function(e,t){if(e.length!==t.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var n=Array.from(e),r=Array.from(t);return Math.sqrt(n.map((function(e,t){return e-r[t]})).reduce((function(e,t){return e+Math.pow(t,2)}),0))}(t,e)})).reduce((function(e,t){return e+t}),0)/(t.length||1)},e.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map((function(n){var r=n.descriptors,a=n.label;return new fee(a,t.computeMeanDistance(e,r))})).reduce((function(e,t){return e.distance<t.distance?e:t}))},e.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new fee("unknown",t.distance)},e.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map((function(e){return e.toJSON()}))}},e.fromJSON=function(t){var n=t.labeledDescriptors.map((function(e){return hee.fromJSON(e)}));return new e(n,t.distanceThreshold)}}();const Kne="172",Qne=0,Jne=1,Zne=2,$ne=100,ere=101,tre=102,nre=200,rre=201,are=202,ire=203,ore=204,sre=205,cre=206,ure=207,lre=208,fre=209,dre=210,hre=211,pre=212,gre=213,mre=214,vre=0,bre=1,yre=2,xre=3,wre=4,Sre=5,Cre=6,Mre=7,_re="attached",Ere=301,Tre=302,Ire=303,kre=304,Nre=306,Lre=1e3,Are=1001,Rre=1002,Dre=1003,Ore=1004,Pre=1005,Fre=1006,zre=1007,jre=1008,Bre=1009,Ure=1010,Wre=1011,Gre=1012,Vre=1013,Hre=1014,Yre=1015,Xre=1016,qre=1017,Kre=1018,Qre=1020,Jre=35902,Zre=1023,$re=1026,eae=1027,tae=1028,nae=1029,rae=1031,aae=1033,iae=33776,oae=33777,sae=33778,cae=33779,uae=35840,lae=35841,fae=35842,dae=35843,hae=36196,pae=37492,gae=37496,mae=37808,vae=37809,bae=37810,yae=37811,xae=37812,wae=37813,Sae=37814,Cae=37815,Mae=37816,_ae=37817,Eae=37818,Tae=37819,Iae=37820,kae=37821,Nae=36492,Lae=36494,Aae=36495,Rae=36284,Dae=36285,Oae=36286,Pae=2300,Fae=2301,zae=2302,jae=2400,Bae=2401,Uae=2402,Wae=2500,Gae="",Vae="srgb",Hae="srgb-linear",Yae="linear",Xae="srgb",qae=7680,Kae=512,Qae=513,Jae=514,Zae=515,$ae=516,eie=517,tie=518,nie=519,rie=35044,aie="300 es",iie=2e3,oie=2001;class sie{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,r=n.length;t<r;t++)n[t].call(this,e);e.target=null}}}const cie=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let uie=1234567;const lie=Math.PI/180,fie=180/Math.PI;function die(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(cie[255&e]+cie[e>>8&255]+cie[e>>16&255]+cie[e>>24&255]+"-"+cie[255&t]+cie[t>>8&255]+"-"+cie[t>>16&15|64]+cie[t>>24&255]+"-"+cie[63&n|128]+cie[n>>8&255]+"-"+cie[n>>16&255]+cie[n>>24&255]+cie[255&r]+cie[r>>8&255]+cie[r>>16&255]+cie[r>>24&255]).toLowerCase()}function hie(e,t,n){return Math.max(t,Math.min(n,e))}function pie(e,t){return(e%t+t)%t}function gie(e,t,n){return(1-n)*e+n*t}function mie(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function vie(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}const bie={DEG2RAD:lie,RAD2DEG:fie,generateUUID:die,clamp:hie,euclideanModulo:pie,mapLinear:function(e,t,n,r,a){return r+(e-t)*(a-r)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:gie,damp:function(e,t,n,r){return gie(e,t,1-Math.exp(-n*r))},pingpong:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t-Math.abs(pie(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(uie=e);let t=uie+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*lie},radToDeg:function(e){return e*fie},isPowerOfTwo:function(e){return 0===(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,r,a){const i=Math.cos,o=Math.sin,s=i(n/2),c=o(n/2),u=i((t+r)/2),l=o((t+r)/2),f=i((t-r)/2),d=o((t-r)/2),h=i((r-t)/2),p=o((r-t)/2);switch(a){case"XYX":e.set(s*l,c*f,c*d,s*u);break;case"YZY":e.set(c*d,s*l,c*f,s*u);break;case"ZXZ":e.set(c*f,c*d,s*l,s*u);break;case"XZX":e.set(s*l,c*p,c*h,s*u);break;case"YXY":e.set(c*h,s*l,c*p,s*u);break;case"ZYZ":e.set(c*p,c*h,s*l,s*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+a)}},normalize:vie,denormalize:mie};class yie{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;yie.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=hie(this.x,e.x,t.x),this.y=hie(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=hie(this.x,e,t),this.y=hie(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(hie(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(hie(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),a=this.x-e.x,i=this.y-e.y;return this.x=a*n-i*r+e.x,this.y=a*r+i*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class xie{constructor(e,t,n,r,a,i,o,s,c){xie.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,n,r,a,i,o,s,c)}set(e,t,n,r,a,i,o,s,c){const u=this.elements;return u[0]=e,u[1]=r,u[2]=o,u[3]=t,u[4]=a,u[5]=s,u[6]=n,u[7]=i,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,a=this.elements,i=n[0],o=n[3],s=n[6],c=n[1],u=n[4],l=n[7],f=n[2],d=n[5],h=n[8],p=r[0],g=r[3],m=r[6],v=r[1],b=r[4],y=r[7],x=r[2],w=r[5],S=r[8];return a[0]=i*p+o*v+s*x,a[3]=i*g+o*b+s*w,a[6]=i*m+o*y+s*S,a[1]=c*p+u*v+l*x,a[4]=c*g+u*b+l*w,a[7]=c*m+u*y+l*S,a[2]=f*p+d*v+h*x,a[5]=f*g+d*b+h*w,a[8]=f*m+d*y+h*S,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],a=e[3],i=e[4],o=e[5],s=e[6],c=e[7],u=e[8];return t*i*u-t*o*c-n*a*u+n*o*s+r*a*c-r*i*s}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],a=e[3],i=e[4],o=e[5],s=e[6],c=e[7],u=e[8],l=u*i-o*c,f=o*s-u*a,d=c*a-i*s,h=t*l+n*f+r*d;if(0===h)return this.set(0,0,0,0,0,0,0,0,0);const p=1/h;return e[0]=l*p,e[1]=(r*c-u*n)*p,e[2]=(o*n-r*i)*p,e[3]=f*p,e[4]=(u*t-r*s)*p,e[5]=(r*a-o*t)*p,e[6]=d*p,e[7]=(n*s-c*t)*p,e[8]=(i*t-n*a)*p,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,a,i,o){const s=Math.cos(a),c=Math.sin(a);return this.set(n*s,n*c,-n*(s*i+c*o)+i+e,-r*c,r*s,-r*(-c*i+s*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(wie.makeScale(e,t)),this}rotate(e){return this.premultiply(wie.makeRotation(-e)),this}translate(e,t){return this.premultiply(wie.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const wie=new xie;function Sie(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;function Cie(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function Mie(){const e=Cie("canvas");return e.style.display="block",e}const _ie={};function Eie(e){e in _ie||(_ie[e]=!0,console.warn(e))}const Tie=(new xie).set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Iie=(new xie).set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function kie(){const e={enabled:!0,workingColorSpace:Hae,spaces:{},convert:function(e,t,n){return!1!==this.enabled&&t!==n&&t&&n?(this.spaces[t].transfer===Xae&&(e.r=Lie(e.r),e.g=Lie(e.g),e.b=Lie(e.b)),this.spaces[t].primaries!==this.spaces[n].primaries&&(e.applyMatrix3(this.spaces[t].toXYZ),e.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===Xae&&(e.r=Aie(e.r),e.g=Aie(e.g),e.b=Aie(e.b)),e):e},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)},getPrimaries:function(e){return this.spaces[e].primaries},getTransfer:function(e){return e===Gae?Yae:this.spaces[e].transfer},getLuminanceCoefficients:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.workingColorSpace;return e.fromArray(this.spaces[t].luminanceCoefficients)},define:function(e){Object.assign(this.spaces,e)},_getMatrix:function(e,t,n){return e.copy(this.spaces[t].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(e){return this.spaces[e].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.workingColorSpace;return this.spaces[e].workingColorSpaceConfig.unpackColorSpace}},t=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],r=[.3127,.329];return e.define({[Hae]:{primaries:t,whitePoint:r,transfer:Yae,toXYZ:Tie,fromXYZ:Iie,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:Vae},outputColorSpaceConfig:{drawingBufferColorSpace:Vae}},[Vae]:{primaries:t,whitePoint:r,transfer:Xae,toXYZ:Tie,fromXYZ:Iie,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:Vae}}}),e}const Nie=kie();function Lie(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Aie(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}let Rie;class Die{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"===typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Rie&&(Rie=Cie("canvas")),Rie.width=e.width,Rie.height=e.height;const n=Rie.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Rie}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){const t=Cie("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),a=r.data;for(let e=0;e<a.length;e++)a[e]=255*Lie(a[e]/255);return n.putImageData(r,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*Lie(t[e]/255)):t[e]=Lie(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Oie=0;class Pie{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isSource=!0,Object.defineProperty(this,"id",{value:Oie++}),this.uuid=die(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(null!==r){let e;if(Array.isArray(r)){e=[];for(let t=0,n=r.length;t<n;t++)r[t].isDataTexture?e.push(Fie(r[t].image)):e.push(Fie(r[t]))}else e=Fie(r);n.url=e}return t||(e.images[this.uuid]=n),n}}function Fie(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap?Die.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let zie=0;class jie extends sie{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:jie.DEFAULT_IMAGE,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:jie.DEFAULT_MAPPING,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Are,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Are,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Fre,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:jre,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Zre,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Bre,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:jie.DEFAULT_ANISOTROPY,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:Gae;super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:zie++}),this.uuid=die(),this.name="",this.source=new Pie(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=a,this.minFilter=i,this.anisotropy=c,this.format=o,this.internalFormat=null,this.type=s,this.offset=new yie(0,0),this.repeat=new yie(1,1),this.center=new yie(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new xie,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e){void 0===e&&(e=null),this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Lre:e.x=e.x-Math.floor(e.x);break;case Are:e.x=e.x<0?0:1;break;case Rre:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case Lre:e.y=e.y-Math.floor(e.y);break;case Are:e.y=e.y<0?0:1;break;case Rre:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){!0===e&&this.pmremVersion++}}jie.DEFAULT_IMAGE=null,jie.DEFAULT_MAPPING=300,jie.DEFAULT_ANISOTROPY=1;class Bie{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Bie.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,a=this.w,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r+i[12]*a,this.y=i[1]*t+i[5]*n+i[9]*r+i[13]*a,this.z=i[2]*t+i[6]*n+i[10]*r+i[14]*a,this.w=i[3]*t+i[7]*n+i[11]*r+i[15]*a,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,a;const i=.01,o=.1,s=e.elements,c=s[0],u=s[4],l=s[8],f=s[1],d=s[5],h=s[9],p=s[2],g=s[6],m=s[10];if(Math.abs(u-f)<i&&Math.abs(l-p)<i&&Math.abs(h-g)<i){if(Math.abs(u+f)<o&&Math.abs(l+p)<o&&Math.abs(h+g)<o&&Math.abs(c+d+m-3)<o)return this.set(1,0,0,0),this;t=Math.PI;const e=(c+1)/2,s=(d+1)/2,v=(m+1)/2,b=(u+f)/4,y=(l+p)/4,x=(h+g)/4;return e>s&&e>v?e<i?(n=0,r=.707106781,a=.707106781):(n=Math.sqrt(e),r=b/n,a=y/n):s>v?s<i?(n=.707106781,r=0,a=.707106781):(r=Math.sqrt(s),n=b/r,a=x/r):v<i?(n=.707106781,r=.707106781,a=0):(a=Math.sqrt(v),n=y/a,r=x/a),this.set(n,r,a,t),this}let v=Math.sqrt((g-h)*(g-h)+(l-p)*(l-p)+(f-u)*(f-u));return Math.abs(v)<.001&&(v=1),this.x=(g-h)/v,this.y=(l-p)/v,this.z=(f-u)/v,this.w=Math.acos((c+d+m-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=hie(this.x,e.x,t.x),this.y=hie(this.y,e.y,t.y),this.z=hie(this.z,e.z,t.z),this.w=hie(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=hie(this.x,e,t),this.y=hie(this.y,e,t),this.z=hie(this.z,e,t),this.w=hie(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(hie(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Uie extends sie{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Bie(0,0,e,t),this.scissorTest=!1,this.viewport=new Bie(0,0,e,t);const r={width:e,height:t,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Fre,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},n);const a=new jie(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);a.flipY=!1,a.generateMipmaps=n.generateMipmaps,a.internalFormat=n.internalFormat,this.textures=[];const i=n.count;for(let o=0;o<i;o++)this.textures[o]=a.clone(),this.textures[o].isRenderTargetTexture=!0,this.textures[o].renderTarget=this;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){null!==this._depthTexture&&(this._depthTexture.renderTarget=null),null!==e&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let r=0,a=this.textures.length;r<a;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=n;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let n=0,r=e.textures.length;n<r;n++)this.textures[n]=e.textures[n].clone(),this.textures[n].isRenderTargetTexture=!0,this.textures[n].renderTarget=this;const t=Object.assign({},e.texture.image);return this.texture.source=new Pie(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Wie extends Uie{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}),this.isWebGLRenderTarget=!0}}class Gie extends jie{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=Dre,this.minFilter=Dre,this.wrapR=Are,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class Vie extends jie{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=Dre,this.minFilter=Dre,this.wrapR=Are,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Hie{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=r}static slerpFlat(e,t,n,r,a,i,o){let s=n[r+0],c=n[r+1],u=n[r+2],l=n[r+3];const f=a[i+0],d=a[i+1],h=a[i+2],p=a[i+3];if(0===o)return e[t+0]=s,e[t+1]=c,e[t+2]=u,void(e[t+3]=l);if(1===o)return e[t+0]=f,e[t+1]=d,e[t+2]=h,void(e[t+3]=p);if(l!==p||s!==f||c!==d||u!==h){let e=1-o;const t=s*f+c*d+u*h+l*p,n=t>=0?1:-1,r=1-t*t;if(r>Number.EPSILON){const a=Math.sqrt(r),i=Math.atan2(a,t*n);e=Math.sin(e*i)/a,o=Math.sin(o*i)/a}const a=o*n;if(s=s*e+f*a,c=c*e+d*a,u=u*e+h*a,l=l*e+p*a,e===1-o){const e=1/Math.sqrt(s*s+c*c+u*u+l*l);s*=e,c*=e,u*=e,l*=e}}e[t]=s,e[t+1]=c,e[t+2]=u,e[t+3]=l}static multiplyQuaternionsFlat(e,t,n,r,a,i){const o=n[r],s=n[r+1],c=n[r+2],u=n[r+3],l=a[i],f=a[i+1],d=a[i+2],h=a[i+3];return e[t]=o*h+u*l+s*d-c*f,e[t+1]=s*h+u*f+c*l-o*d,e[t+2]=c*h+u*d+o*f-s*l,e[t+3]=u*h-o*l-s*f-c*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=e._x,r=e._y,a=e._z,i=e._order,o=Math.cos,s=Math.sin,c=o(n/2),u=o(r/2),l=o(a/2),f=s(n/2),d=s(r/2),h=s(a/2);switch(i){case"XYZ":this._x=f*u*l+c*d*h,this._y=c*d*l-f*u*h,this._z=c*u*h+f*d*l,this._w=c*u*l-f*d*h;break;case"YXZ":this._x=f*u*l+c*d*h,this._y=c*d*l-f*u*h,this._z=c*u*h-f*d*l,this._w=c*u*l+f*d*h;break;case"ZXY":this._x=f*u*l-c*d*h,this._y=c*d*l+f*u*h,this._z=c*u*h+f*d*l,this._w=c*u*l-f*d*h;break;case"ZYX":this._x=f*u*l-c*d*h,this._y=c*d*l+f*u*h,this._z=c*u*h-f*d*l,this._w=c*u*l+f*d*h;break;case"YZX":this._x=f*u*l+c*d*h,this._y=c*d*l+f*u*h,this._z=c*u*h-f*d*l,this._w=c*u*l-f*d*h;break;case"XZY":this._x=f*u*l-c*d*h,this._y=c*d*l-f*u*h,this._z=c*u*h+f*d*l,this._w=c*u*l+f*d*h;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+i)}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],a=t[8],i=t[1],o=t[5],s=t[9],c=t[2],u=t[6],l=t[10],f=n+o+l;if(f>0){const e=.5/Math.sqrt(f+1);this._w=.25/e,this._x=(u-s)*e,this._y=(a-c)*e,this._z=(i-r)*e}else if(n>o&&n>l){const e=2*Math.sqrt(1+n-o-l);this._w=(u-s)/e,this._x=.25*e,this._y=(r+i)/e,this._z=(a+c)/e}else if(o>l){const e=2*Math.sqrt(1+o-n-l);this._w=(a-c)/e,this._x=(r+i)/e,this._y=.25*e,this._z=(s+u)/e}else{const e=2*Math.sqrt(1+l-n-o);this._w=(i-r)/e,this._x=(a+c)/e,this._y=(s+u)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(hie(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,a=e._z,i=e._w,o=t._x,s=t._y,c=t._z,u=t._w;return this._x=n*u+i*o+r*c-a*s,this._y=r*u+i*s+a*o-n*c,this._z=a*u+i*c+n*s-r*o,this._w=i*u-n*o-r*s-a*c,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,r=this._y,a=this._z,i=this._w;let o=i*e._w+n*e._x+r*e._y+a*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=i,this._x=n,this._y=r,this._z=a,this;const s=1-o*o;if(s<=Number.EPSILON){const e=1-t;return this._w=e*i+t*this._w,this._x=e*n+t*this._x,this._y=e*r+t*this._y,this._z=e*a+t*this._z,this.normalize(),this}const c=Math.sqrt(s),u=Math.atan2(c,o),l=Math.sin((1-t)*u)/c,f=Math.sin(t*u)/c;return this._w=i*l+this._w*f,this._x=n*l+this._x*f,this._y=r*l+this._y*f,this._z=a*l+this._z*f,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),a=Math.sqrt(n);return this.set(r*Math.sin(e),r*Math.cos(e),a*Math.sin(t),a*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Yie{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Yie.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(qie.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(qie.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,a=e.elements;return this.x=a[0]*t+a[3]*n+a[6]*r,this.y=a[1]*t+a[4]*n+a[7]*r,this.z=a[2]*t+a[5]*n+a[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,a=e.elements,i=1/(a[3]*t+a[7]*n+a[11]*r+a[15]);return this.x=(a[0]*t+a[4]*n+a[8]*r+a[12])*i,this.y=(a[1]*t+a[5]*n+a[9]*r+a[13])*i,this.z=(a[2]*t+a[6]*n+a[10]*r+a[14])*i,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,a=e.x,i=e.y,o=e.z,s=e.w,c=2*(i*r-o*n),u=2*(o*t-a*r),l=2*(a*n-i*t);return this.x=t+s*c+i*l-o*u,this.y=n+s*u+o*c-a*l,this.z=r+s*l+a*u-i*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*r,this.y=a[1]*t+a[5]*n+a[9]*r,this.z=a[2]*t+a[6]*n+a[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=hie(this.x,e.x,t.x),this.y=hie(this.y,e.y,t.y),this.z=hie(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=hie(this.x,e,t),this.y=hie(this.y,e,t),this.z=hie(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(hie(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,a=e.z,i=t.x,o=t.y,s=t.z;return this.x=r*s-a*o,this.y=a*i-n*s,this.z=n*o-r*i,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Xie.copy(this).projectOnVector(e),this.sub(Xie)}reflect(e){return this.sub(Xie.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(hie(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=2*Math.random()-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Xie=new Yie,qie=new Hie;class Kie{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yie(1/0,1/0,1/0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yie(-1/0,-1/0,-1/0);this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(Jie.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(Jie.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Jie.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n){const r=n.getAttribute("position");if(!0===t&&void 0!==r&&!0!==e.isInstancedMesh)for(let t=0,n=r.count;t<n;t++)!0===e.isMesh?e.getVertexPosition(t,Jie):Jie.fromBufferAttribute(r,t),Jie.applyMatrix4(e.matrixWorld),this.expandByPoint(Jie);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),Zie.copy(e.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),Zie.copy(n.boundingBox)),Zie.applyMatrix4(e.matrixWorld),this.union(Zie)}const r=e.children;for(let a=0,i=r.length;a<i;a++)this.expandByObject(r[a],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Jie),Jie.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(ioe),ooe.subVectors(this.max,ioe),$ie.subVectors(e.a,ioe),eoe.subVectors(e.b,ioe),toe.subVectors(e.c,ioe),noe.subVectors(eoe,$ie),roe.subVectors(toe,eoe),aoe.subVectors($ie,toe);let t=[0,-noe.z,noe.y,0,-roe.z,roe.y,0,-aoe.z,aoe.y,noe.z,0,-noe.x,roe.z,0,-roe.x,aoe.z,0,-aoe.x,-noe.y,noe.x,0,-roe.y,roe.x,0,-aoe.y,aoe.x,0];return!!uoe(t,$ie,eoe,toe,ooe)&&(t=[1,0,0,0,1,0,0,0,1],!!uoe(t,$ie,eoe,toe,ooe)&&(soe.crossVectors(noe,roe),t=[soe.x,soe.y,soe.z],uoe(t,$ie,eoe,toe,ooe)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Jie).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(Jie).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Qie[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Qie[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Qie[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Qie[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Qie[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Qie[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Qie[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Qie[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Qie)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Qie=[new Yie,new Yie,new Yie,new Yie,new Yie,new Yie,new Yie,new Yie],Jie=new Yie,Zie=new Kie,$ie=new Yie,eoe=new Yie,toe=new Yie,noe=new Yie,roe=new Yie,aoe=new Yie,ioe=new Yie,ooe=new Yie,soe=new Yie,coe=new Yie;function uoe(e,t,n,r,a){for(let i=0,o=e.length-3;i<=o;i+=3){coe.fromArray(e,i);const o=a.x*Math.abs(coe.x)+a.y*Math.abs(coe.y)+a.z*Math.abs(coe.z),s=t.dot(coe),c=n.dot(coe),u=r.dot(coe);if(Math.max(-Math.max(s,c,u),Math.min(s,c,u))>o)return!1}return!0}const loe=new Kie,foe=new Yie,doe=new Yie;class hoe{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yie,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):loe.setFromPoints(e).getCenter(n);let r=0;for(let a=0,i=e.length;a<i;a++)r=Math.max(r,n.distanceToSquared(e[a]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;foe.subVectors(e,this.center);const t=foe.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(foe,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(doe.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(foe.copy(e.center).add(doe)),this.expandByPoint(foe.copy(e.center).sub(doe))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const poe=new Yie,goe=new Yie,moe=new Yie,voe=new Yie,boe=new Yie,yoe=new Yie,xoe=new Yie;class woe{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yie,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yie(0,0,-1);this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,poe)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=poe.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(poe.copy(this.origin).addScaledVector(this.direction,t),poe.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){goe.copy(e).add(t).multiplyScalar(.5),moe.copy(t).sub(e).normalize(),voe.copy(this.origin).sub(goe);const a=.5*e.distanceTo(t),i=-this.direction.dot(moe),o=voe.dot(this.direction),s=-voe.dot(moe),c=voe.lengthSq(),u=Math.abs(1-i*i);let l,f,d,h;if(u>0)if(l=i*s-o,f=i*o-s,h=a*u,l>=0)if(f>=-h)if(f<=h){const e=1/u;l*=e,f*=e,d=l*(l+i*f+2*o)+f*(i*l+f+2*s)+c}else f=a,l=Math.max(0,-(i*f+o)),d=-l*l+f*(f+2*s)+c;else f=-a,l=Math.max(0,-(i*f+o)),d=-l*l+f*(f+2*s)+c;else f<=-h?(l=Math.max(0,-(-i*a+o)),f=l>0?-a:Math.min(Math.max(-a,-s),a),d=-l*l+f*(f+2*s)+c):f<=h?(l=0,f=Math.min(Math.max(-a,-s),a),d=f*(f+2*s)+c):(l=Math.max(0,-(i*a+o)),f=l>0?a:Math.min(Math.max(-a,-s),a),d=-l*l+f*(f+2*s)+c);else f=i>0?-a:a,l=Math.max(0,-(i*f+o)),d=-l*l+f*(f+2*s)+c;return n&&n.copy(this.origin).addScaledVector(this.direction,l),r&&r.copy(goe).addScaledVector(moe,f),d}intersectSphere(e,t){poe.subVectors(e.center,this.origin);const n=poe.dot(this.direction),r=poe.dot(poe)-n*n,a=e.radius*e.radius;if(r>a)return null;const i=Math.sqrt(a-r),o=n-i,s=n+i;return s<0?null:o<0?this.at(s,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,a,i,o,s;const c=1/this.direction.x,u=1/this.direction.y,l=1/this.direction.z,f=this.origin;return c>=0?(n=(e.min.x-f.x)*c,r=(e.max.x-f.x)*c):(n=(e.max.x-f.x)*c,r=(e.min.x-f.x)*c),u>=0?(a=(e.min.y-f.y)*u,i=(e.max.y-f.y)*u):(a=(e.max.y-f.y)*u,i=(e.min.y-f.y)*u),n>i||a>r?null:((a>n||isNaN(n))&&(n=a),(i<r||isNaN(r))&&(r=i),l>=0?(o=(e.min.z-f.z)*l,s=(e.max.z-f.z)*l):(o=(e.max.z-f.z)*l,s=(e.min.z-f.z)*l),n>s||o>r?null:((o>n||n!==n)&&(n=o),(s<r||r!==r)&&(r=s),r<0?null:this.at(n>=0?n:r,t)))}intersectsBox(e){return null!==this.intersectBox(e,poe)}intersectTriangle(e,t,n,r,a){boe.subVectors(t,e),yoe.subVectors(n,e),xoe.crossVectors(boe,yoe);let i,o=this.direction.dot(xoe);if(o>0){if(r)return null;i=1}else{if(!(o<0))return null;i=-1,o=-o}voe.subVectors(this.origin,e);const s=i*this.direction.dot(yoe.crossVectors(voe,yoe));if(s<0)return null;const c=i*this.direction.dot(boe.cross(voe));if(c<0)return null;if(s+c>o)return null;const u=-i*voe.dot(xoe);return u<0?null:this.at(u/o,a)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Soe{constructor(e,t,n,r,a,i,o,s,c,u,l,f,d,h,p,g){Soe.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,n,r,a,i,o,s,c,u,l,f,d,h,p,g)}set(e,t,n,r,a,i,o,s,c,u,l,f,d,h,p,g){const m=this.elements;return m[0]=e,m[4]=t,m[8]=n,m[12]=r,m[1]=a,m[5]=i,m[9]=o,m[13]=s,m[2]=c,m[6]=u,m[10]=l,m[14]=f,m[3]=d,m[7]=h,m[11]=p,m[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Soe).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/Coe.setFromMatrixColumn(e,0).length(),a=1/Coe.setFromMatrixColumn(e,1).length(),i=1/Coe.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=0,t[8]=n[8]*i,t[9]=n[9]*i,t[10]=n[10]*i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,r=e.y,a=e.z,i=Math.cos(n),o=Math.sin(n),s=Math.cos(r),c=Math.sin(r),u=Math.cos(a),l=Math.sin(a);if("XYZ"===e.order){const e=i*u,n=i*l,r=o*u,a=o*l;t[0]=s*u,t[4]=-s*l,t[8]=c,t[1]=n+r*c,t[5]=e-a*c,t[9]=-o*s,t[2]=a-e*c,t[6]=r+n*c,t[10]=i*s}else if("YXZ"===e.order){const e=s*u,n=s*l,r=c*u,a=c*l;t[0]=e+a*o,t[4]=r*o-n,t[8]=i*c,t[1]=i*l,t[5]=i*u,t[9]=-o,t[2]=n*o-r,t[6]=a+e*o,t[10]=i*s}else if("ZXY"===e.order){const e=s*u,n=s*l,r=c*u,a=c*l;t[0]=e-a*o,t[4]=-i*l,t[8]=r+n*o,t[1]=n+r*o,t[5]=i*u,t[9]=a-e*o,t[2]=-i*c,t[6]=o,t[10]=i*s}else if("ZYX"===e.order){const e=i*u,n=i*l,r=o*u,a=o*l;t[0]=s*u,t[4]=r*c-n,t[8]=e*c+a,t[1]=s*l,t[5]=a*c+e,t[9]=n*c-r,t[2]=-c,t[6]=o*s,t[10]=i*s}else if("YZX"===e.order){const e=i*s,n=i*c,r=o*s,a=o*c;t[0]=s*u,t[4]=a-e*l,t[8]=r*l+n,t[1]=l,t[5]=i*u,t[9]=-o*u,t[2]=-c*u,t[6]=n*l+r,t[10]=e-a*l}else if("XZY"===e.order){const e=i*s,n=i*c,r=o*s,a=o*c;t[0]=s*u,t[4]=-l,t[8]=c*u,t[1]=e*l+a,t[5]=i*u,t[9]=n*l-r,t[2]=r*l-n,t[6]=o*u,t[10]=a*l+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(_oe,e,Eoe)}lookAt(e,t,n){const r=this.elements;return koe.subVectors(e,t),0===koe.lengthSq()&&(koe.z=1),koe.normalize(),Toe.crossVectors(n,koe),0===Toe.lengthSq()&&(1===Math.abs(n.z)?koe.x+=1e-4:koe.z+=1e-4,koe.normalize(),Toe.crossVectors(n,koe)),Toe.normalize(),Ioe.crossVectors(koe,Toe),r[0]=Toe.x,r[4]=Ioe.x,r[8]=koe.x,r[1]=Toe.y,r[5]=Ioe.y,r[9]=koe.y,r[2]=Toe.z,r[6]=Ioe.z,r[10]=koe.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,a=this.elements,i=n[0],o=n[4],s=n[8],c=n[12],u=n[1],l=n[5],f=n[9],d=n[13],h=n[2],p=n[6],g=n[10],m=n[14],v=n[3],b=n[7],y=n[11],x=n[15],w=r[0],S=r[4],C=r[8],M=r[12],_=r[1],E=r[5],T=r[9],I=r[13],k=r[2],N=r[6],L=r[10],A=r[14],R=r[3],D=r[7],O=r[11],P=r[15];return a[0]=i*w+o*_+s*k+c*R,a[4]=i*S+o*E+s*N+c*D,a[8]=i*C+o*T+s*L+c*O,a[12]=i*M+o*I+s*A+c*P,a[1]=u*w+l*_+f*k+d*R,a[5]=u*S+l*E+f*N+d*D,a[9]=u*C+l*T+f*L+d*O,a[13]=u*M+l*I+f*A+d*P,a[2]=h*w+p*_+g*k+m*R,a[6]=h*S+p*E+g*N+m*D,a[10]=h*C+p*T+g*L+m*O,a[14]=h*M+p*I+g*A+m*P,a[3]=v*w+b*_+y*k+x*R,a[7]=v*S+b*E+y*N+x*D,a[11]=v*C+b*T+y*L+x*O,a[15]=v*M+b*I+y*A+x*P,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],a=e[12],i=e[1],o=e[5],s=e[9],c=e[13],u=e[2],l=e[6],f=e[10],d=e[14];return e[3]*(+a*s*l-r*c*l-a*o*f+n*c*f+r*o*d-n*s*d)+e[7]*(+t*s*d-t*c*f+a*i*f-r*i*d+r*c*u-a*s*u)+e[11]*(+t*c*l-t*o*d-a*i*l+n*i*d+a*o*u-n*c*u)+e[15]*(-r*o*u-t*s*l+t*o*f+r*i*l-n*i*f+n*s*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],a=e[3],i=e[4],o=e[5],s=e[6],c=e[7],u=e[8],l=e[9],f=e[10],d=e[11],h=e[12],p=e[13],g=e[14],m=e[15],v=l*g*c-p*f*c+p*s*d-o*g*d-l*s*m+o*f*m,b=h*f*c-u*g*c-h*s*d+i*g*d+u*s*m-i*f*m,y=u*p*c-h*l*c+h*o*d-i*p*d-u*o*m+i*l*m,x=h*l*s-u*p*s-h*o*f+i*p*f+u*o*g-i*l*g,w=t*v+n*b+r*y+a*x;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const S=1/w;return e[0]=v*S,e[1]=(p*f*a-l*g*a-p*r*d+n*g*d+l*r*m-n*f*m)*S,e[2]=(o*g*a-p*s*a+p*r*c-n*g*c-o*r*m+n*s*m)*S,e[3]=(l*s*a-o*f*a-l*r*c+n*f*c+o*r*d-n*s*d)*S,e[4]=b*S,e[5]=(u*g*a-h*f*a+h*r*d-t*g*d-u*r*m+t*f*m)*S,e[6]=(h*s*a-i*g*a-h*r*c+t*g*c+i*r*m-t*s*m)*S,e[7]=(i*f*a-u*s*a+u*r*c-t*f*c-i*r*d+t*s*d)*S,e[8]=y*S,e[9]=(h*l*a-u*p*a-h*n*d+t*p*d+u*n*m-t*l*m)*S,e[10]=(i*p*a-h*o*a+h*n*c-t*p*c-i*n*m+t*o*m)*S,e[11]=(u*o*a-i*l*a-u*n*c+t*l*c+i*n*d-t*o*d)*S,e[12]=x*S,e[13]=(u*p*r-h*l*r+h*n*f-t*p*f-u*n*g+t*l*g)*S,e[14]=(h*o*r-i*p*r-h*n*s+t*p*s+i*n*g-t*o*g)*S,e[15]=(i*l*r-u*o*r+u*n*s-t*l*s-i*n*f+t*o*f)*S,this}scale(e){const t=this.elements,n=e.x,r=e.y,a=e.z;return t[0]*=n,t[4]*=r,t[8]*=a,t[1]*=n,t[5]*=r,t[9]*=a,t[2]*=n,t[6]*=r,t[10]*=a,t[3]*=n,t[7]*=r,t[11]*=a,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),a=1-n,i=e.x,o=e.y,s=e.z,c=a*i,u=a*o;return this.set(c*i+n,c*o-r*s,c*s+r*o,0,c*o+r*s,u*o+n,u*s-r*i,0,c*s-r*o,u*s+r*i,a*s*s+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,a,i){return this.set(1,n,a,0,e,1,i,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,a=t._x,i=t._y,o=t._z,s=t._w,c=a+a,u=i+i,l=o+o,f=a*c,d=a*u,h=a*l,p=i*u,g=i*l,m=o*l,v=s*c,b=s*u,y=s*l,x=n.x,w=n.y,S=n.z;return r[0]=(1-(p+m))*x,r[1]=(d+y)*x,r[2]=(h-b)*x,r[3]=0,r[4]=(d-y)*w,r[5]=(1-(f+m))*w,r[6]=(g+v)*w,r[7]=0,r[8]=(h+b)*S,r[9]=(g-v)*S,r[10]=(1-(f+p))*S,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let a=Coe.set(r[0],r[1],r[2]).length();const i=Coe.set(r[4],r[5],r[6]).length(),o=Coe.set(r[8],r[9],r[10]).length();this.determinant()<0&&(a=-a),e.x=r[12],e.y=r[13],e.z=r[14],Moe.copy(this);const s=1/a,c=1/i,u=1/o;return Moe.elements[0]*=s,Moe.elements[1]*=s,Moe.elements[2]*=s,Moe.elements[4]*=c,Moe.elements[5]*=c,Moe.elements[6]*=c,Moe.elements[8]*=u,Moe.elements[9]*=u,Moe.elements[10]*=u,t.setFromRotationMatrix(Moe),n.x=a,n.y=i,n.z=o,this}makePerspective(e,t,n,r,a,i){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:iie;const s=this.elements,c=2*a/(t-e),u=2*a/(n-r),l=(t+e)/(t-e),f=(n+r)/(n-r);let d,h;if(o===iie)d=-(i+a)/(i-a),h=-2*i*a/(i-a);else{if(o!==oie)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);d=-i/(i-a),h=-i*a/(i-a)}return s[0]=c,s[4]=0,s[8]=l,s[12]=0,s[1]=0,s[5]=u,s[9]=f,s[13]=0,s[2]=0,s[6]=0,s[10]=d,s[14]=h,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(e,t,n,r,a,i){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:iie;const s=this.elements,c=1/(t-e),u=1/(n-r),l=1/(i-a),f=(t+e)*c,d=(n+r)*u;let h,p;if(o===iie)h=(i+a)*l,p=-2*l;else{if(o!==oie)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);h=a*l,p=-1*l}return s[0]=2*c,s[4]=0,s[8]=0,s[12]=-f,s[1]=0,s[5]=2*u,s[9]=0,s[13]=-d,s[2]=0,s[6]=0,s[10]=p,s[14]=-h,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const Coe=new Yie,Moe=new Soe,_oe=new Yie(0,0,0),Eoe=new Yie(1,1,1),Toe=new Yie,Ioe=new Yie,koe=new Yie,Noe=new Soe,Loe=new Hie;class Aoe{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Aoe.DEFAULT_ORDER;this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=e.elements,a=r[0],i=r[4],o=r[8],s=r[1],c=r[5],u=r[9],l=r[2],f=r[6],d=r[10];switch(t){case"XYZ":this._y=Math.asin(hie(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-i,a)):(this._x=Math.atan2(f,c),this._z=0);break;case"YXZ":this._x=Math.asin(-hie(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(s,c)):(this._y=Math.atan2(-l,a),this._z=0);break;case"ZXY":this._x=Math.asin(hie(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-l,d),this._z=Math.atan2(-i,c)):(this._y=0,this._z=Math.atan2(s,a));break;case"ZYX":this._y=Math.asin(-hie(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(f,d),this._z=Math.atan2(s,a)):(this._x=0,this._z=Math.atan2(-i,c));break;case"YZX":this._z=Math.asin(hie(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-l,a)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-hie(i,-1,1)),Math.abs(i)<.9999999?(this._x=Math.atan2(f,c),this._y=Math.atan2(o,a)):(this._x=Math.atan2(-u,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return Noe.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Noe,t,n)}setFromVector3(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}reorder(e){return Loe.setFromEuler(this),this.setFromQuaternion(Loe,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Aoe.DEFAULT_ORDER="XYZ";class Roe{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return 0!==(this.mask&e.mask)}isEnabled(e){return 0!==(this.mask&1<<e)}}let Doe=0;const Ooe=new Yie,Poe=new Hie,Foe=new Soe,zoe=new Yie,joe=new Yie,Boe=new Yie,Uoe=new Hie,Woe=new Yie(1,0,0),Goe=new Yie(0,1,0),Voe=new Yie(0,0,1),Hoe={type:"added"},Yoe={type:"removed"},Xoe={type:"childadded",child:null},qoe={type:"childremoved",child:null};class Koe extends sie{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Doe++}),this.uuid=die(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Koe.DEFAULT_UP.clone();const e=new Yie,t=new Aoe,n=new Hie,r=new Yie(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Soe},normalMatrix:{value:new xie}}),this.matrix=new Soe,this.matrixWorld=new Soe,this.matrixAutoUpdate=Koe.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Koe.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Roe,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Poe.setFromAxisAngle(e,t),this.quaternion.multiply(Poe),this}rotateOnWorldAxis(e,t){return Poe.setFromAxisAngle(e,t),this.quaternion.premultiply(Poe),this}rotateX(e){return this.rotateOnAxis(Woe,e)}rotateY(e){return this.rotateOnAxis(Goe,e)}rotateZ(e){return this.rotateOnAxis(Voe,e)}translateOnAxis(e,t){return Ooe.copy(e).applyQuaternion(this.quaternion),this.position.add(Ooe.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Woe,e)}translateY(e){return this.translateOnAxis(Goe,e)}translateZ(e){return this.translateOnAxis(Voe,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Foe.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?zoe.copy(e):zoe.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),joe.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Foe.lookAt(joe,zoe,this.up):Foe.lookAt(zoe,joe,this.up),this.quaternion.setFromRotationMatrix(Foe),r&&(Foe.extractRotation(r.matrixWorld),Poe.setFromRotationMatrix(Foe),this.quaternion.premultiply(Poe.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Hoe),Xoe.child=e,this.dispatchEvent(Xoe),Xoe.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Yoe),qoe.child=e,this.dispatchEvent(qoe),qoe.child=null),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Foe.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Foe.multiply(e.parent.matrixWorld)),e.applyMatrix4(Foe),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Hoe),Xoe.child=e,this.dispatchEvent(Xoe),Xoe.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}}getObjectsByProperty(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];this[e]===t&&n.push(this);const r=this.children;for(let a=0,i=r.length;a<i;a++)r[a].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(joe,e,Boe),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(joe,Uoe,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++){t[n].updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++){e[t].updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"===typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};function a(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map((e=>({boxInitialized:e.boxInitialized,boxMin:e.box.min.toArray(),boxMax:e.box.max.toArray(),sphereInitialized:e.sphereInitialized,sphereRadius:e.sphere.radius,sphereCenter:e.sphere.center.toArray()}))),r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(e),null!==this._colorsTexture&&(r.colorsTexture=this._colorsTexture.toJSON(e)),null!==this.boundingSphere&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),null!==this.boundingBox&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=a(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,r=n.length;t<r;t++){const r=n[t];a(e.shapes,r)}else a(e.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(a(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,r=this.material.length;n<r;n++)t.push(a(e.materials,this.material[n]));r.material=t}else r.material=a(e.materials,this.material);if(this.children.length>0){r.children=[];for(let t=0;t<this.children.length;t++)r.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];r.animations.push(a(e.animations,n))}}if(t){const t=i(e.geometries),r=i(e.materials),a=i(e.textures),o=i(e.images),s=i(e.shapes),c=i(e.skeletons),u=i(e.animations),l=i(e.nodes);t.length>0&&(n.geometries=t),r.length>0&&(n.materials=r),a.length>0&&(n.textures=a),o.length>0&&(n.images=o),s.length>0&&(n.shapes=s),c.length>0&&(n.skeletons=c),u.length>0&&(n.animations=u),l.length>0&&(n.nodes=l)}return n.object=r,n;function i(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let n=0;n<e.children.length;n++){const t=e.children[n];this.add(t.clone())}return this}}Koe.DEFAULT_UP=new Yie(0,1,0),Koe.DEFAULT_MATRIX_AUTO_UPDATE=!0,Koe.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Qoe=new Yie,Joe=new Yie,Zoe=new Yie,$oe=new Yie,ese=new Yie,tse=new Yie,nse=new Yie,rse=new Yie,ase=new Yie,ise=new Yie,ose=new Bie,sse=new Bie,cse=new Bie;class use{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yie,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yie,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Yie;this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),Qoe.subVectors(e,t),r.cross(Qoe);const a=r.lengthSq();return a>0?r.multiplyScalar(1/Math.sqrt(a)):r.set(0,0,0)}static getBarycoord(e,t,n,r,a){Qoe.subVectors(r,t),Joe.subVectors(n,t),Zoe.subVectors(e,t);const i=Qoe.dot(Qoe),o=Qoe.dot(Joe),s=Qoe.dot(Zoe),c=Joe.dot(Joe),u=Joe.dot(Zoe),l=i*c-o*o;if(0===l)return a.set(0,0,0),null;const f=1/l,d=(c*s-o*u)*f,h=(i*u-o*s)*f;return a.set(1-d-h,h,d)}static containsPoint(e,t,n,r){return null!==this.getBarycoord(e,t,n,r,$oe)&&($oe.x>=0&&$oe.y>=0&&$oe.x+$oe.y<=1)}static getInterpolation(e,t,n,r,a,i,o,s){return null===this.getBarycoord(e,t,n,r,$oe)?(s.x=0,s.y=0,"z"in s&&(s.z=0),"w"in s&&(s.w=0),null):(s.setScalar(0),s.addScaledVector(a,$oe.x),s.addScaledVector(i,$oe.y),s.addScaledVector(o,$oe.z),s)}static getInterpolatedAttribute(e,t,n,r,a,i){return ose.setScalar(0),sse.setScalar(0),cse.setScalar(0),ose.fromBufferAttribute(e,t),sse.fromBufferAttribute(e,n),cse.fromBufferAttribute(e,r),i.setScalar(0),i.addScaledVector(ose,a.x),i.addScaledVector(sse,a.y),i.addScaledVector(cse,a.z),i}static isFrontFacing(e,t,n,r){return Qoe.subVectors(n,t),Joe.subVectors(e,t),Qoe.cross(Joe).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Qoe.subVectors(this.c,this.b),Joe.subVectors(this.a,this.b),.5*Qoe.cross(Joe).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return use.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return use.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,r,a){return use.getInterpolation(e,this.a,this.b,this.c,t,n,r,a)}containsPoint(e){return use.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return use.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,a=this.c;let i,o;ese.subVectors(r,n),tse.subVectors(a,n),rse.subVectors(e,n);const s=ese.dot(rse),c=tse.dot(rse);if(s<=0&&c<=0)return t.copy(n);ase.subVectors(e,r);const u=ese.dot(ase),l=tse.dot(ase);if(u>=0&&l<=u)return t.copy(r);const f=s*l-u*c;if(f<=0&&s>=0&&u<=0)return i=s/(s-u),t.copy(n).addScaledVector(ese,i);ise.subVectors(e,a);const d=ese.dot(ise),h=tse.dot(ise);if(h>=0&&d<=h)return t.copy(a);const p=d*c-s*h;if(p<=0&&c>=0&&h<=0)return o=c/(c-h),t.copy(n).addScaledVector(tse,o);const g=u*h-d*l;if(g<=0&&l-u>=0&&d-h>=0)return nse.subVectors(a,r),o=(l-u)/(l-u+(d-h)),t.copy(r).addScaledVector(nse,o);const m=1/(g+p+f);return i=p*m,o=f*m,t.copy(n).addScaledVector(ese,i).addScaledVector(tse,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const lse={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},fse={h:0,s:0,l:0},dse={h:0,s:0,l:0};function hse(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class pse{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(void 0===t&&void 0===n){const t=e;t&&t.isColor?this.copy(t):"number"===typeof t?this.setHex(t):"string"===typeof t&&this.setStyle(t)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Vae;return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Nie.toWorkingColorSpace(this,t),this}setRGB(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Nie.workingColorSpace;return this.r=e,this.g=t,this.b=n,Nie.toWorkingColorSpace(this,r),this}setHSL(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Nie.workingColorSpace;if(e=pie(e,1),t=hie(t,0,1),n=hie(n,0,1),0===t)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,a=2*n-r;this.r=hse(a,r,e+1/3),this.g=hse(a,r,e),this.b=hse(a,r,e-1/3)}return Nie.toWorkingColorSpace(this,r),this}setStyle(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Vae;function r(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(t=/^(\w+)\(([^\)]*)\)/.exec(e)){let a;const i=t[1],o=t[2];switch(i){case"rgb":case"rgba":if(a=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(a[4]),this.setRGB(Math.min(255,parseInt(a[1],10))/255,Math.min(255,parseInt(a[2],10))/255,Math.min(255,parseInt(a[3],10))/255,n);if(a=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(a[4]),this.setRGB(Math.min(100,parseInt(a[1],10))/100,Math.min(100,parseInt(a[2],10))/100,Math.min(100,parseInt(a[3],10))/100,n);break;case"hsl":case"hsla":if(a=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(a[4]),this.setHSL(parseFloat(a[1])/360,parseFloat(a[2])/100,parseFloat(a[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(t=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=t[1],a=r.length;if(3===a)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,n);if(6===a)return this.setHex(parseInt(r,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Vae;const n=lse[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Lie(e.r),this.g=Lie(e.g),this.b=Lie(e.b),this}copyLinearToSRGB(e){return this.r=Aie(e.r),this.g=Aie(e.g),this.b=Aie(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Vae;return Nie.fromWorkingColorSpace(gse.copy(this),e),65536*Math.round(hie(255*gse.r,0,255))+256*Math.round(hie(255*gse.g,0,255))+Math.round(hie(255*gse.b,0,255))}getHexString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Vae;return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Nie.workingColorSpace;Nie.fromWorkingColorSpace(gse.copy(this),t);const n=gse.r,r=gse.g,a=gse.b,i=Math.max(n,r,a),o=Math.min(n,r,a);let s,c;const u=(o+i)/2;if(o===i)s=0,c=0;else{const e=i-o;switch(c=u<=.5?e/(i+o):e/(2-i-o),i){case n:s=(r-a)/e+(r<a?6:0);break;case r:s=(a-n)/e+2;break;case a:s=(n-r)/e+4}s/=6}return e.h=s,e.s=c,e.l=u,e}getRGB(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Nie.workingColorSpace;return Nie.fromWorkingColorSpace(gse.copy(this),t),e.r=gse.r,e.g=gse.g,e.b=gse.b,e}getStyle(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Vae;Nie.fromWorkingColorSpace(gse.copy(this),e);const t=gse.r,n=gse.g,r=gse.b;return e!==Vae?"color(".concat(e," ").concat(t.toFixed(3)," ").concat(n.toFixed(3)," ").concat(r.toFixed(3),")"):"rgb(".concat(Math.round(255*t),",").concat(Math.round(255*n),",").concat(Math.round(255*r),")")}offsetHSL(e,t,n){return this.getHSL(fse),this.setHSL(fse.h+e,fse.s+t,fse.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(fse),e.getHSL(dse);const n=gie(fse.h,dse.h,t),r=gie(fse.s,dse.s,t),a=gie(fse.l,dse.l,t);return this.setHSL(n,r,a),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,r=this.b,a=e.elements;return this.r=a[0]*t+a[3]*n+a[6]*r,this.g=a[1]*t+a[4]*n+a[7]*r,this.b=a[2]*t+a[5]*n+a[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const gse=new pse;pse.NAMES=lse;let mse=0;class vse extends sie{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:mse++}),this.uuid=die(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=$ne,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new pse(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=qae,this.stencilZFail=qae,this.stencilZPass=qae,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!==e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Material: parameter '".concat(t,"' has value of undefined."));continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn("THREE.Material: '".concat(t,"' is not a property of THREE.").concat(this.type,"."))}}toJSON(e){const t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function r(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),204!==this.blendSrc&&(n.blendSrc=this.blendSrc),205!==this.blendDst&&(n.blendDst=this.blendDst),this.blendEquation!==$ne&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==qae&&(n.stencilFail=this.stencilFail),this.stencilZFail!==qae&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==qae&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=r(e.textures),a=r(e.images);t.length>0&&(n.textures=t),a.length>0&&(n.images=a)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let r=0;r!==e;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class bse extends vse{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new pse(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Aoe,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const yse=new Yie,xse=new yie;class wse{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=rie,this.updateRanges=[],this.gpuType=Yre,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,a=this.itemSize;r<a;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)xse.fromBufferAttribute(this,t),xse.applyMatrix3(e),this.setXY(t,xse.x,xse.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)yse.fromBufferAttribute(this,t),yse.applyMatrix3(e),this.setXYZ(t,yse.x,yse.y,yse.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)yse.fromBufferAttribute(this,t),yse.applyMatrix4(e),this.setXYZ(t,yse.x,yse.y,yse.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)yse.fromBufferAttribute(this,t),yse.applyNormalMatrix(e),this.setXYZ(t,yse.x,yse.y,yse.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)yse.fromBufferAttribute(this,t),yse.transformDirection(e),this.setXYZ(t,yse.x,yse.y,yse.z);return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=mie(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=vie(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=mie(t,this.array)),t}setX(e,t){return this.normalized&&(t=vie(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=mie(t,this.array)),t}setY(e,t){return this.normalized&&(t=vie(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=mie(t,this.array)),t}setZ(e,t){return this.normalized&&(t=vie(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=mie(t,this.array)),t}setW(e,t){return this.normalized&&(t=vie(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=vie(t,this.array),n=vie(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=vie(t,this.array),n=vie(n,this.array),r=vie(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,a){return e*=this.itemSize,this.normalized&&(t=vie(t,this.array),n=vie(n,this.array),r=vie(r,this.array),a=vie(a,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=a,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==rie&&(e.usage=this.usage),e}}class Sse extends wse{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Cse extends wse{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class Mse extends wse{constructor(e,t,n){super(new Float32Array(e),t,n)}}let _se=0;const Ese=new Soe,Tse=new Koe,Ise=new Yie,kse=new Kie,Nse=new Kie,Lse=new Yie;class Ase extends sie{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:_se++}),this.uuid=die(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Sie(e)?Cse:Sse)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new xie).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Ese.makeRotationFromQuaternion(e),this.applyMatrix4(Ese),this}rotateX(e){return Ese.makeRotationX(e),this.applyMatrix4(Ese),this}rotateY(e){return Ese.makeRotationY(e),this.applyMatrix4(Ese),this}rotateZ(e){return Ese.makeRotationZ(e),this.applyMatrix4(Ese),this}translate(e,t,n){return Ese.makeTranslation(e,t,n),this.applyMatrix4(Ese),this}scale(e,t,n){return Ese.makeScale(e,t,n),this.applyMatrix4(Ese),this}lookAt(e){return Tse.lookAt(e),Tse.updateMatrix(),this.applyMatrix4(Tse.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ise).negate(),this.translate(Ise.x,Ise.y,Ise.z),this}setFromPoints(e){const t=this.getAttribute("position");if(void 0===t){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];t.push(r.x,r.y,r.z||0)}this.setAttribute("position",new Mse(t,3))}else{const n=Math.min(e.length,t.count);for(let r=0;r<n;r++){const n=e[r];t.setXYZ(r,n.x,n.y,n.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Kie);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new Yie(-1/0,-1/0,-1/0),new Yie(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,r=t.length;n<r;n++){const e=t[n];kse.setFromBufferAttribute(e),this.morphTargetsRelative?(Lse.addVectors(this.boundingBox.min,kse.min),this.boundingBox.expandByPoint(Lse),Lse.addVectors(this.boundingBox.max,kse.max),this.boundingBox.expandByPoint(Lse)):(this.boundingBox.expandByPoint(kse.min),this.boundingBox.expandByPoint(kse.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new hoe);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new Yie,1/0);if(e){const n=this.boundingSphere.center;if(kse.setFromBufferAttribute(e),t)for(let e=0,a=t.length;e<a;e++){const n=t[e];Nse.setFromBufferAttribute(n),this.morphTargetsRelative?(Lse.addVectors(kse.min,Nse.min),kse.expandByPoint(Lse),Lse.addVectors(kse.max,Nse.max),kse.expandByPoint(Lse)):(kse.expandByPoint(Nse.min),kse.expandByPoint(Nse.max))}kse.getCenter(n);let r=0;for(let t=0,a=e.count;t<a;t++)Lse.fromBufferAttribute(e,t),r=Math.max(r,n.distanceToSquared(Lse));if(t)for(let a=0,i=t.length;a<i;a++){const i=t[a],o=this.morphTargetsRelative;for(let t=0,a=i.count;t<a;t++)Lse.fromBufferAttribute(i,t),o&&(Ise.fromBufferAttribute(e,t),Lse.add(Ise)),r=Math.max(r,n.distanceToSquared(Lse))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=t.position,r=t.normal,a=t.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new wse(new Float32Array(4*n.count),4));const i=this.getAttribute("tangent"),o=[],s=[];for(let C=0;C<n.count;C++)o[C]=new Yie,s[C]=new Yie;const c=new Yie,u=new Yie,l=new Yie,f=new yie,d=new yie,h=new yie,p=new Yie,g=new Yie;function m(e,t,r){c.fromBufferAttribute(n,e),u.fromBufferAttribute(n,t),l.fromBufferAttribute(n,r),f.fromBufferAttribute(a,e),d.fromBufferAttribute(a,t),h.fromBufferAttribute(a,r),u.sub(c),l.sub(c),d.sub(f),h.sub(f);const i=1/(d.x*h.y-h.x*d.y);isFinite(i)&&(p.copy(u).multiplyScalar(h.y).addScaledVector(l,-d.y).multiplyScalar(i),g.copy(l).multiplyScalar(d.x).addScaledVector(u,-h.x).multiplyScalar(i),o[e].add(p),o[t].add(p),o[r].add(p),s[e].add(g),s[t].add(g),s[r].add(g))}let v=this.groups;0===v.length&&(v=[{start:0,count:e.count}]);for(let C=0,M=v.length;C<M;++C){const t=v[C],n=t.start;for(let r=n,a=n+t.count;r<a;r+=3)m(e.getX(r+0),e.getX(r+1),e.getX(r+2))}const b=new Yie,y=new Yie,x=new Yie,w=new Yie;function S(e){x.fromBufferAttribute(r,e),w.copy(x);const t=o[e];b.copy(t),b.sub(x.multiplyScalar(x.dot(t))).normalize(),y.crossVectors(w,t);const n=y.dot(s[e])<0?-1:1;i.setXYZW(e,b.x,b.y,b.z,n)}for(let C=0,M=v.length;C<M;++C){const t=v[C],n=t.start;for(let r=n,a=n+t.count;r<a;r+=3)S(e.getX(r+0)),S(e.getX(r+1)),S(e.getX(r+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new wse(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const r=new Yie,a=new Yie,i=new Yie,o=new Yie,s=new Yie,c=new Yie,u=new Yie,l=new Yie;if(e)for(let f=0,d=e.count;f<d;f+=3){const d=e.getX(f+0),h=e.getX(f+1),p=e.getX(f+2);r.fromBufferAttribute(t,d),a.fromBufferAttribute(t,h),i.fromBufferAttribute(t,p),u.subVectors(i,a),l.subVectors(r,a),u.cross(l),o.fromBufferAttribute(n,d),s.fromBufferAttribute(n,h),c.fromBufferAttribute(n,p),o.add(u),s.add(u),c.add(u),n.setXYZ(d,o.x,o.y,o.z),n.setXYZ(h,s.x,s.y,s.z),n.setXYZ(p,c.x,c.y,c.z)}else for(let e=0,f=t.count;e<f;e+=3)r.fromBufferAttribute(t,e+0),a.fromBufferAttribute(t,e+1),i.fromBufferAttribute(t,e+2),u.subVectors(i,a),l.subVectors(r,a),u.cross(l),n.setXYZ(e+0,u.x,u.y,u.z),n.setXYZ(e+1,u.x,u.y,u.z),n.setXYZ(e+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Lse.fromBufferAttribute(e,t),Lse.normalize(),e.setXYZ(t,Lse.x,Lse.y,Lse.z)}toNonIndexed(){function e(e,t){const n=e.array,r=e.itemSize,a=e.normalized,i=new n.constructor(t.length*r);let o=0,s=0;for(let c=0,u=t.length;c<u;c++){o=e.isInterleavedBufferAttribute?t[c]*e.data.stride+e.offset:t[c]*r;for(let e=0;e<r;e++)i[s++]=n[o++]}return new wse(i,r,a)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Ase,n=this.index.array,r=this.attributes;for(const o in r){const a=e(r[o],n);t.setAttribute(o,a)}const a=this.morphAttributes;for(const o in a){const r=[],i=a[o];for(let t=0,a=i.length;t<a;t++){const a=e(i[t],n);r.push(a)}t.morphAttributes[o]=r}t.morphTargetsRelative=this.morphTargetsRelative;const i=this.groups;for(let o=0,s=i.length;o<s;o++){const e=i[o];t.addGroup(e.start,e.count,e.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const s in n){const t=n[s];e.data.attributes[s]=t.toJSON(e.data)}const r={};let a=!1;for(const s in this.morphAttributes){const t=this.morphAttributes[s],n=[];for(let r=0,a=t.length;r<a;r++){const a=t[r];n.push(a.toJSON(e.data))}n.length>0&&(r[s]=n,a=!0)}a&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const i=this.groups;i.length>0&&(e.data.groups=JSON.parse(JSON.stringify(i)));const o=this.boundingSphere;return null!==o&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const r=e.attributes;for(const c in r){const e=r[c];this.setAttribute(c,e.clone(t))}const a=e.morphAttributes;for(const c in a){const e=[],n=a[c];for(let r=0,a=n.length;r<a;r++)e.push(n[r].clone(t));this.morphAttributes[c]=e}this.morphTargetsRelative=e.morphTargetsRelative;const i=e.groups;for(let c=0,u=i.length;c<u;c++){const e=i[c];this.addGroup(e.start,e.count,e.materialIndex)}const o=e.boundingBox;null!==o&&(this.boundingBox=o.clone());const s=e.boundingSphere;return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Rse=new Soe,Dse=new woe,Ose=new hoe,Pse=new Yie,Fse=new Yie,zse=new Yie,jse=new Yie,Bse=new Yie,Use=new Yie,Wse=new Yie,Gse=new Yie;class Vse extends Koe{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ase,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new bse;super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,r=n.attributes.position,a=n.morphAttributes.position,i=n.morphTargetsRelative;t.fromBufferAttribute(r,e);const o=this.morphTargetInfluences;if(a&&o){Use.set(0,0,0);for(let n=0,r=a.length;n<r;n++){const r=o[n],s=a[n];0!==r&&(Bse.fromBufferAttribute(s,e),i?Use.addScaledVector(Bse,r):Use.addScaledVector(Bse.sub(t),r))}t.add(Use)}return t}raycast(e,t){const n=this.geometry,r=this.material,a=this.matrixWorld;if(void 0!==r){if(null===n.boundingSphere&&n.computeBoundingSphere(),Ose.copy(n.boundingSphere),Ose.applyMatrix4(a),Dse.copy(e.ray).recast(e.near),!1===Ose.containsPoint(Dse.origin)){if(null===Dse.intersectSphere(Ose,Pse))return;if(Dse.origin.distanceToSquared(Pse)>(e.far-e.near)**2)return}Rse.copy(a).invert(),Dse.copy(e.ray).applyMatrix4(Rse),null!==n.boundingBox&&!1===Dse.intersectsBox(n.boundingBox)||this._computeIntersections(e,t,Dse)}}_computeIntersections(e,t,n){let r;const a=this.geometry,i=this.material,o=a.index,s=a.attributes.position,c=a.attributes.uv,u=a.attributes.uv1,l=a.attributes.normal,f=a.groups,d=a.drawRange;if(null!==o)if(Array.isArray(i))for(let h=0,p=f.length;h<p;h++){const a=f[h],s=i[a.materialIndex];for(let i=Math.max(a.start,d.start),f=Math.min(o.count,Math.min(a.start+a.count,d.start+d.count));i<f;i+=3){r=Hse(this,s,e,n,c,u,l,o.getX(i),o.getX(i+1),o.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=a.materialIndex,t.push(r))}}else{for(let a=Math.max(0,d.start),s=Math.min(o.count,d.start+d.count);a<s;a+=3){r=Hse(this,i,e,n,c,u,l,o.getX(a),o.getX(a+1),o.getX(a+2)),r&&(r.faceIndex=Math.floor(a/3),t.push(r))}}else if(void 0!==s)if(Array.isArray(i))for(let h=0,p=f.length;h<p;h++){const a=f[h],o=i[a.materialIndex];for(let i=Math.max(a.start,d.start),f=Math.min(s.count,Math.min(a.start+a.count,d.start+d.count));i<f;i+=3){r=Hse(this,o,e,n,c,u,l,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=a.materialIndex,t.push(r))}}else{for(let a=Math.max(0,d.start),o=Math.min(s.count,d.start+d.count);a<o;a+=3){r=Hse(this,i,e,n,c,u,l,a,a+1,a+2),r&&(r.faceIndex=Math.floor(a/3),t.push(r))}}}}function Hse(e,t,n,r,a,i,o,s,c,u){e.getVertexPosition(s,Fse),e.getVertexPosition(c,zse),e.getVertexPosition(u,jse);const l=function(e,t,n,r,a,i,o,s){let c;if(c=1===t.side?r.intersectTriangle(o,i,a,!0,s):r.intersectTriangle(a,i,o,0===t.side,s),null===c)return null;Gse.copy(s),Gse.applyMatrix4(e.matrixWorld);const u=n.ray.origin.distanceTo(Gse);return u<n.near||u>n.far?null:{distance:u,point:Gse.clone(),object:e}}(e,t,n,r,Fse,zse,jse,Wse);if(l){const e=new Yie;use.getBarycoord(Wse,Fse,zse,jse,e),a&&(l.uv=use.getInterpolatedAttribute(a,s,c,u,e,new yie)),i&&(l.uv1=use.getInterpolatedAttribute(i,s,c,u,e,new yie)),o&&(l.normal=use.getInterpolatedAttribute(o,s,c,u,e,new Yie),l.normal.dot(r.direction)>0&&l.normal.multiplyScalar(-1));const t={a:s,b:c,c:u,normal:new Yie,materialIndex:0};use.getNormal(Fse,zse,jse,t.normal),l.face=t,l.barycoord=e}return l}class Yse extends Ase{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:a,depthSegments:i};const o=this;r=Math.floor(r),a=Math.floor(a),i=Math.floor(i);const s=[],c=[],u=[],l=[];let f=0,d=0;function h(e,t,n,r,a,i,h,p,g,m,v){const b=i/g,y=h/m,x=i/2,w=h/2,S=p/2,C=g+1,M=m+1;let _=0,E=0;const T=new Yie;for(let o=0;o<M;o++){const i=o*y-w;for(let s=0;s<C;s++){const f=s*b-x;T[e]=f*r,T[t]=i*a,T[n]=S,c.push(T.x,T.y,T.z),T[e]=0,T[t]=0,T[n]=p>0?1:-1,u.push(T.x,T.y,T.z),l.push(s/g),l.push(1-o/m),_+=1}}for(let o=0;o<m;o++)for(let e=0;e<g;e++){const t=f+e+C*o,n=f+e+C*(o+1),r=f+(e+1)+C*(o+1),a=f+(e+1)+C*o;s.push(t,n,a),s.push(n,r,a),E+=6}o.addGroup(d,E,v),d+=E,f+=_}h("z","y","x",-1,-1,n,t,e,i,a,0),h("z","y","x",1,-1,n,t,-e,i,a,1),h("x","z","y",1,1,e,n,t,r,i,2),h("x","z","y",1,-1,e,n,-t,r,i,3),h("x","y","z",1,-1,e,t,n,r,a,4),h("x","y","z",-1,-1,e,t,-n,r,a,5),this.setIndex(s),this.setAttribute("position",new Mse(c,3)),this.setAttribute("normal",new Mse(u,3)),this.setAttribute("uv",new Mse(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Yse(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Xse(e){const t={};for(const n in e){t[n]={};for(const r in e[n]){const a=e[n][r];a&&(a.isColor||a.isMatrix3||a.isMatrix4||a.isVector2||a.isVector3||a.isVector4||a.isTexture||a.isQuaternion)?a.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[n][r]=null):t[n][r]=a.clone():Array.isArray(a)?t[n][r]=a.slice():t[n][r]=a}}return t}function qse(e){const t={};for(let n=0;n<e.length;n++){const r=Xse(e[n]);for(const e in r)t[e]=r[e]}return t}function Kse(e){const t=e.getRenderTarget();return null===t?e.outputColorSpace:!0===t.isXRRenderTarget?t.texture.colorSpace:Nie.workingColorSpace}const Qse={clone:Xse,merge:qse};class Jse extends vse{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Xse(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const n=this.uniforms[r].value;n&&n.isTexture?t.uniforms[r]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[r]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[r]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[r]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[r]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[r]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[r]={type:"m4",value:n.toArray()}:t.uniforms[r]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const r in this.extensions)!0===this.extensions[r]&&(n[r]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class Zse extends Koe{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Soe,this.projectionMatrix=new Soe,this.projectionMatrixInverse=new Soe,this.coordinateSystem=iie}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const $se=new Yie,ece=new yie,tce=new yie;class nce extends Zse{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*fie*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*lie*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*fie*Math.atan(Math.tan(.5*lie*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){$se.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set($se.x,$se.y).multiplyScalar(-e/$se.z),$se.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set($se.x,$se.y).multiplyScalar(-e/$se.z)}getViewSize(e,t){return this.getViewBounds(e,ece,tce),t.subVectors(tce,ece)}setViewOffset(e,t,n,r,a,i){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=a,this.view.height=i,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*lie*this.fov)/this.zoom,n=2*t,r=this.aspect*n,a=-.5*r;const i=this.view;if(null!==this.view&&this.view.enabled){const e=i.fullWidth,o=i.fullHeight;a+=i.offsetX*r/e,t-=i.offsetY*n/o,r*=i.width/e,n*=i.height/o}const o=this.filmOffset;0!==o&&(a+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(a,a+r,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const rce=-90;class ace extends Koe{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new nce(rce,1,e,t);r.layers=this.layers,this.add(r);const a=new nce(rce,1,e,t);a.layers=this.layers,this.add(a);const i=new nce(rce,1,e,t);i.layers=this.layers,this.add(i);const o=new nce(rce,1,e,t);o.layers=this.layers,this.add(o);const s=new nce(rce,1,e,t);s.layers=this.layers,this.add(s);const c=new nce(rce,1,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,r,a,i,o,s]=t;for(const c of t)this.remove(c);if(e===iie)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),a.up.set(0,0,-1),a.lookAt(0,1,0),i.up.set(0,0,1),i.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),s.up.set(0,1,0),s.lookAt(0,0,-1);else{if(e!==oie)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),a.up.set(0,0,1),a.lookAt(0,1,0),i.up.set(0,0,-1),i.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),s.up.set(0,-1,0),s.lookAt(0,0,-1)}for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[a,i,o,s,c,u]=this.children,l=e.getRenderTarget(),f=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),h=e.xr.enabled;e.xr.enabled=!1;const p=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,r),e.render(t,a),e.setRenderTarget(n,1,r),e.render(t,i),e.setRenderTarget(n,2,r),e.render(t,o),e.setRenderTarget(n,3,r),e.render(t,s),e.setRenderTarget(n,4,r),e.render(t,c),n.texture.generateMipmaps=p,e.setRenderTarget(n,5,r),e.render(t,u),e.setRenderTarget(l,f,d),e.xr.enabled=h,n.texture.needsPMREMUpdate=!0}}class ice extends jie{constructor(e,t,n,r,a,i,o,s,c,u){super(e=void 0!==e?e:[],t=void 0!==t?t:Ere,n,r,a,i,o,s,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class oce extends Wie{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];this.texture=new ice(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:Fre}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={tEquirect:{value:null}},r="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",a="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",i=new Yse(5,5,5),o=new Jse({name:"CubemapFromEquirect",uniforms:Xse(n),vertexShader:r,fragmentShader:a,side:1,blending:0});o.uniforms.tEquirect.value=t;const s=new Vse(i,o),c=t.minFilter;t.minFilter===jre&&(t.minFilter=Fre);return new ace(1,10,this).update(e,s),t.minFilter=c,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,n,r){const a=e.getRenderTarget();for(let i=0;i<6;i++)e.setRenderTarget(this,i),e.clear(t,n,r);e.setRenderTarget(a)}}class sce extends Koe{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Aoe,this.environmentIntensity=1,this.environmentRotation=new Aoe,this.overrideMaterial=null,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class cce{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=rie,this.updateRanges=[],this.version=0,this.uuid=die()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,a=this.stride;r<a;r++)this.array[e+r]=t.array[n+r];return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=die()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=die()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const uce=new Yie;class lce{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)uce.fromBufferAttribute(this,t),uce.applyMatrix4(e),this.setXYZ(t,uce.x,uce.y,uce.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)uce.fromBufferAttribute(this,t),uce.applyNormalMatrix(e),this.setXYZ(t,uce.x,uce.y,uce.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)uce.fromBufferAttribute(this,t),uce.transformDirection(e),this.setXYZ(t,uce.x,uce.y,uce.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=mie(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=vie(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=vie(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=vie(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=vie(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=vie(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=mie(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=mie(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=mie(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=mie(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=vie(t,this.array),n=vie(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=vie(t,this.array),n=vie(n,this.array),r=vie(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,a){return e=e*this.data.stride+this.offset,this.normalized&&(t=vie(t,this.array),n=vie(n,this.array),r=vie(r,this.array),a=vie(a,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=a,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new wse(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new lce(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const fce=new Yie,dce=new Bie,hce=new Bie,pce=new Yie,gce=new Soe,mce=new Yie,vce=new hoe,bce=new Soe,yce=new woe;class xce extends Vse{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=_re,this.bindMatrix=new Soe,this.bindMatrixInverse=new Soe,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;null===this.boundingBox&&(this.boundingBox=new Kie),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,mce),this.boundingBox.expandByPoint(mce)}computeBoundingSphere(){const e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new hoe),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,mce),this.boundingSphere.expandByPoint(mce)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,r=this.matrixWorld;void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),vce.copy(this.boundingSphere),vce.applyMatrix4(r),!1!==e.ray.intersectsSphere(vce)&&(bce.copy(r).invert(),yce.copy(e.ray).applyMatrix4(bce),null!==this.boundingBox&&!1===yce.intersectsBox(this.boundingBox)||this._computeIntersections(e,t,yce)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Bie,t=this.geometry.attributes.skinWeight;for(let n=0,r=t.count;n<r;n++){e.fromBufferAttribute(t,n);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===_re?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,r=this.geometry;dce.fromBufferAttribute(r.attributes.skinIndex,e),hce.fromBufferAttribute(r.attributes.skinWeight,e),fce.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let a=0;a<4;a++){const e=hce.getComponent(a);if(0!==e){const r=dce.getComponent(a);gce.multiplyMatrices(n.bones[r].matrixWorld,n.boneInverses[r]),t.addScaledVector(pce.copy(fce).applyMatrix4(gce),e)}}return t.applyMatrix4(this.bindMatrixInverse)}}class wce extends Koe{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Sce extends jie{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(null,arguments.length>5?arguments[5]:void 0,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:Dre,arguments.length>9&&void 0!==arguments[9]?arguments[9]:Dre,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>10?arguments[10]:void 0,arguments.length>11?arguments[11]:void 0),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Cce=new Soe,Mce=new Soe;class _ce{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.uuid=die(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new Soe)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new Soe;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let a=0,i=e.length;a<i;a++){const r=e[a]?e[a].matrixWorld:Mce;Cce.multiplyMatrices(r,t[a]),Cce.toArray(n,16*a)}null!==r&&(r.needsUpdate=!0)}clone(){return new _ce(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new Sce(t,e,e,Zre,Yre);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,r=e.bones.length;n<r;n++){const r=e.bones[n];let a=t[r];void 0===a&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),a=new wce),this.bones.push(a),this.boneInverses.push((new Soe).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let r=0,a=t.length;r<a;r++){const a=t[r];e.bones.push(a.uuid);const i=n[r];e.boneInverses.push(i.toArray())}return e}}class Ece extends wse{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Tce=new Soe,Ice=new Soe,kce=[],Nce=new Kie,Lce=new Soe,Ace=new Vse,Rce=new hoe;class Dce extends Vse{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Ece(new Float32Array(16*n),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let r=0;r<n;r++)this.setMatrixAt(r,Lce)}computeBoundingBox(){const e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new Kie),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Tce),Nce.copy(e.boundingBox).applyMatrix4(Tce),this.boundingBox.union(Nce)}computeBoundingSphere(){const e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new hoe),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Tce),Rce.copy(e.boundingSphere).applyMatrix4(Tce),this.boundingSphere.union(Rce)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.morphTexture&&(this.morphTexture=e.morphTexture.clone()),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}getMorphAt(e,t){const n=t.morphTargetInfluences,r=this.morphTexture.source.data.data,a=e*(n.length+1)+1;for(let i=0;i<n.length;i++)n[i]=r[a+i]}raycast(e,t){const n=this.matrixWorld,r=this.count;if(Ace.geometry=this.geometry,Ace.material=this.material,void 0!==Ace.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),Rce.copy(this.boundingSphere),Rce.applyMatrix4(n),!1!==e.ray.intersectsSphere(Rce)))for(let a=0;a<r;a++){this.getMatrixAt(a,Tce),Ice.multiplyMatrices(n,Tce),Ace.matrixWorld=Ice,Ace.raycast(e,kce);for(let e=0,n=kce.length;e<n;e++){const n=kce[e];n.instanceId=a,n.object=this,t.push(n)}kce.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Ece(new Float32Array(3*this.instanceMatrix.count).fill(1),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}setMorphAt(e,t){const n=t.morphTargetInfluences,r=n.length+1;null===this.morphTexture&&(this.morphTexture=new Sce(new Float32Array(r*this.count),r,this.count,tae,Yre));const a=this.morphTexture.source.data.data;let i=0;for(let c=0;c<n.length;c++)i+=n[c];const o=this.geometry.morphTargetsRelative?1:1-i,s=r*e;a[s]=o,a.set(n,s+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null),this}}const Oce=new Yie,Pce=new Yie,Fce=new xie;class zce{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yie(1,0,0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=Oce.subVectors(n,t).cross(Pce.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(Oce),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const a=-(e.start.dot(this.normal)+this.constant)/r;return a<0||a>1?null:t.copy(e.start).addScaledVector(n,a)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||Fce.getNormalMatrix(e),r=this.coplanarPoint(Oce).applyMatrix4(e),a=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(a),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const jce=new hoe,Bce=new Yie;class Uce{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new zce,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new zce,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new zce,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new zce,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new zce,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new zce;this.planes=[e,t,n,r,a,i]}set(e,t,n,r,a,i){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(r),o[4].copy(a),o[5].copy(i),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:iie;const n=this.planes,r=e.elements,a=r[0],i=r[1],o=r[2],s=r[3],c=r[4],u=r[5],l=r[6],f=r[7],d=r[8],h=r[9],p=r[10],g=r[11],m=r[12],v=r[13],b=r[14],y=r[15];if(n[0].setComponents(s-a,f-c,g-d,y-m).normalize(),n[1].setComponents(s+a,f+c,g+d,y+m).normalize(),n[2].setComponents(s+i,f+u,g+h,y+v).normalize(),n[3].setComponents(s-i,f-u,g-h,y-v).normalize(),n[4].setComponents(s-o,f-l,g-p,y-b).normalize(),t===iie)n[5].setComponents(s+o,f+l,g+p,y+b).normalize();else{if(t!==oie)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);n[5].setComponents(o,l,p,b).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),jce.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),jce.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(jce)}intersectsSprite(e){return jce.center.set(0,0,0),jce.radius=.7071067811865476,jce.applyMatrix4(e.matrixWorld),this.intersectsSphere(jce)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let a=0;a<6;a++){if(t[a].distanceToPoint(n)<r)return!1}return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(Bce.x=r.normal.x>0?e.max.x:e.min.x,Bce.y=r.normal.y>0?e.max.y:e.min.y,Bce.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Bce)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}class Wce extends vse{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new pse(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Gce=new Yie,Vce=new Yie,Hce=new Soe,Yce=new woe,Xce=new hoe,qce=new Yie,Kce=new Yie;class Qce extends Koe{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ase,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Wce;super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,r=t.count;e<r;e++)Gce.fromBufferAttribute(t,e-1),Vce.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=Gce.distanceTo(Vce);e.setAttribute("lineDistance",new Mse(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,a=e.params.Line.threshold,i=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Xce.copy(n.boundingSphere),Xce.applyMatrix4(r),Xce.radius+=a,!1===e.ray.intersectsSphere(Xce))return;Hce.copy(r).invert(),Yce.copy(e.ray).applyMatrix4(Hce);const o=a/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,c=this.isLineSegments?2:1,u=n.index,l=n.attributes.position;if(null!==u){const n=Math.max(0,i.start),r=Math.min(u.count,i.start+i.count);for(let a=n,i=r-1;a<i;a+=c){const n=u.getX(a),r=u.getX(a+1),i=Jce(this,e,Yce,s,n,r);i&&t.push(i)}if(this.isLineLoop){const a=u.getX(r-1),i=u.getX(n),o=Jce(this,e,Yce,s,a,i);o&&t.push(o)}}else{const n=Math.max(0,i.start),r=Math.min(l.count,i.start+i.count);for(let a=n,i=r-1;a<i;a+=c){const n=Jce(this,e,Yce,s,a,a+1);n&&t.push(n)}if(this.isLineLoop){const a=Jce(this,e,Yce,s,r-1,n);a&&t.push(a)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function Jce(e,t,n,r,a,i){const o=e.geometry.attributes.position;Gce.fromBufferAttribute(o,a),Vce.fromBufferAttribute(o,i);if(n.distanceSqToSegment(Gce,Vce,qce,Kce)>r)return;qce.applyMatrix4(e.matrixWorld);const s=t.ray.origin.distanceTo(qce);return s<t.near||s>t.far?void 0:{distance:s,point:Kce.clone().applyMatrix4(e.matrixWorld),index:a,face:null,faceIndex:null,barycoord:null,object:e}}const Zce=new Yie,$ce=new Yie;class eue extends Qce{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,r=t.count;e<r;e+=2)Zce.fromBufferAttribute(t,e),$ce.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+Zce.distanceTo($ce);e.setAttribute("lineDistance",new Mse(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class tue extends Qce{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class nue extends vse{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new pse(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const rue=new Soe,aue=new woe,iue=new hoe,oue=new Yie;class sue extends Koe{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ase,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new nue;super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,a=e.params.Points.threshold,i=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),iue.copy(n.boundingSphere),iue.applyMatrix4(r),iue.radius+=a,!1===e.ray.intersectsSphere(iue))return;rue.copy(r).invert(),aue.copy(e.ray).applyMatrix4(rue);const o=a/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,c=n.index,u=n.attributes.position;if(null!==c){for(let n=Math.max(0,i.start),a=Math.min(c.count,i.start+i.count);n<a;n++){const a=c.getX(n);oue.fromBufferAttribute(u,a),cue(oue,a,s,r,e,t,this)}}else{for(let n=Math.max(0,i.start),a=Math.min(u.count,i.start+i.count);n<a;n++)oue.fromBufferAttribute(u,n),cue(oue,n,s,r,e,t,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function cue(e,t,n,r,a,i,o){const s=aue.distanceSqToPoint(e);if(s<n){const n=new Yie;aue.closestPointToPoint(e,n),n.applyMatrix4(r);const c=a.ray.origin.distanceTo(n);if(c<a.near||c>a.far)return;i.push({distance:c,distanceToRay:Math.sqrt(s),point:n,index:t,face:null,faceIndex:null,barycoord:null,object:o})}}class uue extends Koe{constructor(){super(),this.isGroup=!0,this.type="Group"}}class lue extends jie{constructor(e,t,n,r,a,i,o,s,c){let u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:$re;if(u!==$re&&u!==eae)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&u===$re&&(n=Hre),void 0===n&&u===eae&&(n=Qre),super(null,r,a,i,o,s,u,n,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==o?o:Dre,this.minFilter=void 0!==s?s:Dre,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}class fue extends Ase{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const a=e/2,i=t/2,o=Math.floor(n),s=Math.floor(r),c=o+1,u=s+1,l=e/o,f=t/s,d=[],h=[],p=[],g=[];for(let m=0;m<u;m++){const e=m*f-i;for(let t=0;t<c;t++){const n=t*l-a;h.push(n,-e,0),p.push(0,0,1),g.push(t/o),g.push(1-m/s)}}for(let m=0;m<s;m++)for(let e=0;e<o;e++){const t=e+c*m,n=e+c*(m+1),r=e+1+c*(m+1),a=e+1+c*m;d.push(t,n,a),d.push(n,r,a)}this.setIndex(d),this.setAttribute("position",new Mse(h,3)),this.setAttribute("normal",new Mse(p,3)),this.setAttribute("uv",new Mse(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new fue(e.width,e.height,e.widthSegments,e.heightSegments)}}class due extends vse{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new pse(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new pse(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new yie(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Aoe,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class hue extends due{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new yie(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return hie(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new pse(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new pse(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new pse(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!==e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!==e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!==e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!==e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!==e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!==e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class pue extends vse{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class gue extends vse{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function mue(e,t,n){return!e||!n&&e.constructor===t?e:"number"===typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function vue(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function bue(e){const t=e.length,n=new Array(t);for(let r=0;r!==t;++r)n[r]=r;return n.sort((function(t,n){return e[t]-e[n]})),n}function yue(e,t,n){const r=e.length,a=new e.constructor(r);for(let i=0,o=0;o!==r;++i){const r=n[i]*t;for(let n=0;n!==t;++n)a[o++]=e[r+n]}return a}function xue(e,t,n,r){let a=1,i=e[0];for(;void 0!==i&&void 0===i[r];)i=e[a++];if(void 0===i)return;let o=i[r];if(void 0!==o)if(Array.isArray(o))do{o=i[r],void 0!==o&&(t.push(i.time),n.push.apply(n,o)),i=e[a++]}while(void 0!==i);else if(void 0!==o.toArray)do{o=i[r],void 0!==o&&(t.push(i.time),o.toArray(n,n.length)),i=e[a++]}while(void 0!==i);else do{o=i[r],void 0!==o&&(t.push(i.time),n.push(o)),i=e[a++]}while(void 0!==i)}class wue{constructor(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,r=t[n],a=t[n-1];e:{t:{let i;n:{r:if(!(e<r)){for(let i=n+2;;){if(void 0===r){if(e<a)break r;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===i)break;if(a=r,r=t[++n],e<r)break t}i=t.length;break n}if(e>=a)break e;{const o=t[1];e<o&&(n=2,a=o);for(let i=n-2;;){if(void 0===a)return this._cachedIndex=0,this.copySampleValue_(0);if(n===i)break;if(r=a,a=t[--n-1],e>=a)break t}i=n,n=0}}for(;n<i;){const r=n+i>>>1;e<t[r]?i=r:n=r+1}if(r=t[n],a=t[n-1],void 0===a)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,a,r)}return this.interpolate_(n,a,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,a=e*r;for(let i=0;i!==r;++i)t[i]=n[a+i];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Sue extends wue{constructor(e,t,n,r){super(e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:jae,endingEnd:jae}}intervalChanged_(e,t,n){const r=this.parameterPositions;let a=e-2,i=e+1,o=r[a],s=r[i];if(void 0===o)switch(this.getSettings_().endingStart){case Bae:a=e,o=2*t-n;break;case Uae:a=r.length-2,o=t+r[a]-r[a+1];break;default:a=e,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case Bae:i=e,s=2*n-t;break;case Uae:i=1,s=n+r[1]-r[0];break;default:i=e-1,s=t}const c=.5*(n-t),u=this.valueSize;this._weightPrev=c/(t-o),this._weightNext=c/(s-n),this._offsetPrev=a*u,this._offsetNext=i*u}interpolate_(e,t,n,r){const a=this.resultBuffer,i=this.sampleValues,o=this.valueSize,s=e*o,c=s-o,u=this._offsetPrev,l=this._offsetNext,f=this._weightPrev,d=this._weightNext,h=(n-t)/(r-t),p=h*h,g=p*h,m=-f*g+2*f*p-f*h,v=(1+f)*g+(-1.5-2*f)*p+(-.5+f)*h+1,b=(-1-d)*g+(1.5+d)*p+.5*h,y=d*g-d*p;for(let x=0;x!==o;++x)a[x]=m*i[u+x]+v*i[c+x]+b*i[s+x]+y*i[l+x];return a}}class Cue extends wue{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const a=this.resultBuffer,i=this.sampleValues,o=this.valueSize,s=e*o,c=s-o,u=(n-t)/(r-t),l=1-u;for(let f=0;f!==o;++f)a[f]=i[c+f]*l+i[s+f]*u;return a}}class Mue extends wue{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class _ue{constructor(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=mue(t,this.TimeBufferType),this.values=mue(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:mue(e.times,Array),values:mue(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new Mue(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Cue(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Sue(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Pae:t=this.InterpolantFactoryMethodDiscrete;break;case Fae:t=this.InterpolantFactoryMethodLinear;break;case zae:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Pae;case this.InterpolantFactoryMethodLinear:return Fae;case this.InterpolantFactoryMethodSmooth:return zae}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this}trim(e,t){const n=this.times,r=n.length;let a=0,i=r-1;for(;a!==r&&n[a]<e;)++a;for(;-1!==i&&n[i]>t;)--i;if(++i,0!==a||i!==r){a>=i&&(i=Math.max(i,1),a=i-1);const e=this.getValueSize();this.times=n.slice(a,i),this.values=this.values.slice(a*e,i*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,r=this.values,a=n.length;0===a&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let i=null;for(let o=0;o!==a;o++){const t=n[o];if("number"===typeof t&&isNaN(t)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,t),e=!1;break}if(null!==i&&i>t){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,t,i),e=!1;break}i=t}if(void 0!==r&&vue(r))for(let o=0,s=r.length;o!==s;++o){const t=r[o];if(isNaN(t)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,t),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),r=this.getInterpolation()===zae,a=e.length-1;let i=1;for(let o=1;o<a;++o){let a=!1;const s=e[o];if(s!==e[o+1]&&(1!==o||s!==e[0]))if(r)a=!0;else{const e=o*n,r=e-n,i=e+n;for(let o=0;o!==n;++o){const n=t[e+o];if(n!==t[r+o]||n!==t[i+o]){a=!0;break}}}if(a){if(o!==i){e[i]=e[o];const r=o*n,a=i*n;for(let e=0;e!==n;++e)t[a+e]=t[r+e]}++i}}if(a>0){e[i]=e[a];for(let e=a*n,r=i*n,o=0;o!==n;++o)t[r+o]=t[e+o];++i}return i!==e.length?(this.times=e.slice(0,i),this.values=t.slice(0,i*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}_ue.prototype.TimeBufferType=Float32Array,_ue.prototype.ValueBufferType=Float32Array,_ue.prototype.DefaultInterpolation=Fae;class Eue extends _ue{constructor(e,t,n){super(e,t,n)}}Eue.prototype.ValueTypeName="bool",Eue.prototype.ValueBufferType=Array,Eue.prototype.DefaultInterpolation=Pae,Eue.prototype.InterpolantFactoryMethodLinear=void 0,Eue.prototype.InterpolantFactoryMethodSmooth=void 0;class Tue extends _ue{}Tue.prototype.ValueTypeName="color";class Iue extends _ue{}Iue.prototype.ValueTypeName="number";class kue extends wue{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const a=this.resultBuffer,i=this.sampleValues,o=this.valueSize,s=(n-t)/(r-t);let c=e*o;for(let u=c+o;c!==u;c+=4)Hie.slerpFlat(a,0,i,c-o,i,c,s);return a}}class Nue extends _ue{InterpolantFactoryMethodLinear(e){return new kue(this.times,this.values,this.getValueSize(),e)}}Nue.prototype.ValueTypeName="quaternion",Nue.prototype.InterpolantFactoryMethodSmooth=void 0;class Lue extends _ue{constructor(e,t,n){super(e,t,n)}}Lue.prototype.ValueTypeName="string",Lue.prototype.ValueBufferType=Array,Lue.prototype.DefaultInterpolation=Pae,Lue.prototype.InterpolantFactoryMethodLinear=void 0,Lue.prototype.InterpolantFactoryMethodSmooth=void 0;class Aue extends _ue{}Aue.prototype.ValueTypeName="vector";class Rue{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Wae;this.name=e,this.tracks=n,this.duration=t,this.blendMode=r,this.uuid=die(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,r=1/(e.fps||1);for(let i=0,o=n.length;i!==o;++i)t.push(Due(n[i]).scale(r));const a=new this(e.name,e.duration,t,e.blendMode);return a.uuid=e.uuid,a}static toJSON(e){const t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let a=0,i=n.length;a!==i;++a)t.push(_ue.toJSON(n[a]));return r}static CreateFromMorphTargetSequence(e,t,n,r){const a=t.length,i=[];for(let o=0;o<a;o++){let e=[],s=[];e.push((o+a-1)%a,o,(o+1)%a),s.push(0,1,0);const c=bue(e);e=yue(e,1,c),s=yue(s,1,c),r||0!==e[0]||(e.push(a),s.push(s[0])),i.push(new Iue(".morphTargetInfluences["+t[o].name+"]",e,s).scale(1/n))}return new this(e,-1,i)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let r=0;r<n.length;r++)if(n[r].name===t)return n[r];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const r={},a=/^([\w-]*?)([\d]+)$/;for(let o=0,s=e.length;o<s;o++){const t=e[o],n=t.name.match(a);if(n&&n.length>1){const e=n[1];let a=r[e];a||(r[e]=a=[]),a.push(t)}}const i=[];for(const o in r)i.push(this.CreateFromMorphTargetSequence(o,r[o],t,n));return i}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,r,a){if(0!==n.length){const i=[],o=[];xue(n,i,o,r),0!==i.length&&a.push(new e(t,i,o))}},r=[],a=e.name||"default",i=e.fps||30,o=e.blendMode;let s=e.length||-1;const c=e.hierarchy||[];for(let u=0;u<c.length;u++){const e=c[u].keys;if(e&&0!==e.length)if(e[0].morphTargets){const t={};let n;for(n=0;n<e.length;n++)if(e[n].morphTargets)for(let r=0;r<e[n].morphTargets.length;r++)t[e[n].morphTargets[r]]=-1;for(const a in t){const t=[],i=[];for(let r=0;r!==e[n].morphTargets.length;++r){const r=e[n];t.push(r.time),i.push(r.morphTarget===a?1:0)}r.push(new Iue(".morphTargetInfluence["+a+"]",t,i))}s=t.length*i}else{const a=".bones["+t[u].name+"]";n(Aue,a+".position",e,"pos",r),n(Nue,a+".quaternion",e,"rot",r),n(Aue,a+".scale",e,"scl",r)}}if(0===r.length)return null;return new this(a,s,r,o)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Due(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Iue;case"vector":case"vector2":case"vector3":case"vector4":return Aue;case"color":return Tue;case"quaternion":return Nue;case"bool":case"boolean":return Eue;case"string":return Lue}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];xue(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const Oue={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class Pue{constructor(e,t,n){const r=this;let a,i=!1,o=0,s=0;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){s++,!1===i&&void 0!==r.onStart&&r.onStart(e,o,s),i=!0},this.itemEnd=function(e){o++,void 0!==r.onProgress&&r.onProgress(e,o,s),o===s&&(i=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return a?a(e):e},this.setURLModifier=function(e){return a=e,this},this.addHandler=function(e,t){return c.push(e,t),this},this.removeHandler=function(e){const t=c.indexOf(e);return-1!==t&&c.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=c.length;t<n;t+=2){const n=c[t],r=c[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return r}return null}}}const Fue=new Pue;class zue{constructor(e){this.manager=void 0!==e?e:Fue,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise((function(r,a){n.load(e,r,t,a)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}zue.DEFAULT_MATERIAL_NAME="__DEFAULT";const jue={};class Bue extends Error{constructor(e,t){super(e),this.response=t}}class Uue extends zue{constructor(e){super(e)}load(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const a=Oue.get(e);if(void 0!==a)return this.manager.itemStart(e),setTimeout((()=>{t&&t(a),this.manager.itemEnd(e)}),0),a;if(void 0!==jue[e])return void jue[e].push({onLoad:t,onProgress:n,onError:r});jue[e]=[],jue[e].push({onLoad:t,onProgress:n,onError:r});const i=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,s=this.responseType;fetch(i).then((t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"===typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const n=jue[e],r=t.body.getReader(),a=t.headers.get("X-File-Size")||t.headers.get("Content-Length"),i=a?parseInt(a):0,o=0!==i;let s=0;const c=new ReadableStream({start(e){!function t(){r.read().then((r=>{let{done:a,value:c}=r;if(a)e.close();else{s+=c.byteLength;const r=new ProgressEvent("progress",{lengthComputable:o,loaded:s,total:i});for(let e=0,t=n.length;e<t;e++){const t=n[e];t.onProgress&&t.onProgress(r)}e.enqueue(c),t()}}),(t=>{e.error(t)}))}()}});return new Response(c)}throw new Bue('fetch for "'.concat(t.url,'" responded with ').concat(t.status,": ").concat(t.statusText),t)})).then((e=>{switch(s){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((e=>(new DOMParser).parseFromString(e,o)));case"json":return e.json();default:if(void 0===o)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(o),n=t&&t[1]?t[1].toLowerCase():void 0,r=new TextDecoder(n);return e.arrayBuffer().then((e=>r.decode(e)))}}})).then((t=>{Oue.add(e,t);const n=jue[e];delete jue[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onLoad&&r.onLoad(t)}})).catch((t=>{const n=jue[e];if(void 0===n)throw this.manager.itemError(e),t;delete jue[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onError&&r.onError(t)}this.manager.itemError(e)})).finally((()=>{this.manager.itemEnd(e)})),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Wue extends zue{constructor(e){super(e)}load(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const a=this,i=Oue.get(e);if(void 0!==i)return a.manager.itemStart(e),setTimeout((function(){t&&t(i),a.manager.itemEnd(e)}),0),i;const o=Cie("img");function s(){u(),Oue.add(e,this),t&&t(this),a.manager.itemEnd(e)}function c(t){u(),r&&r(t),a.manager.itemError(e),a.manager.itemEnd(e)}function u(){o.removeEventListener("load",s,!1),o.removeEventListener("error",c,!1)}return o.addEventListener("load",s,!1),o.addEventListener("error",c,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),a.manager.itemStart(e),o.src=e,o}}class Gue extends zue{constructor(e){super(e)}load(e,t,n,r){const a=new jie,i=new Wue(this.manager);return i.setCrossOrigin(this.crossOrigin),i.setPath(this.path),i.load(e,(function(e){a.image=e,a.needsUpdate=!0,void 0!==t&&t(a)}),n,r),a}}class Vue extends Koe{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;super(),this.isLight=!0,this.type="Light",this.color=new pse(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),void 0!==this.target&&(t.object.target=this.target.uuid),t}}const Hue=new Soe,Yue=new Yie,Xue=new Yie;class que{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new yie(512,512),this.map=null,this.mapPass=null,this.matrix=new Soe,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Uce,this._frameExtents=new yie(1,1),this._viewportCount=1,this._viewports=[new Bie(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;Yue.setFromMatrixPosition(e.matrixWorld),t.position.copy(Yue),Xue.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Xue),t.updateMatrixWorld(),Hue.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Hue),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Hue)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 1!==this.intensity&&(e.intensity=this.intensity),0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Kue extends que{constructor(){super(new nce(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=2*fie*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,a=e.distance||t.far;n===t.fov&&r===t.aspect&&a===t.far||(t.fov=n,t.aspect=r,t.far=a,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Que extends Vue{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2;super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Koe.DEFAULT_UP),this.updateMatrix(),this.target=new Koe,this.distance=n,this.angle=r,this.penumbra=a,this.decay=i,this.map=null,this.shadow=new Kue}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const Jue=new Soe,Zue=new Yie,$ue=new Yie;class ele extends que{constructor(){super(new nce(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new yie(4,2),this._viewportCount=6,this._viewports=[new Bie(2,1,1,1),new Bie(0,1,1,1),new Bie(3,1,1,1),new Bie(1,1,1,1),new Bie(3,0,1,1),new Bie(1,0,1,1)],this._cubeDirections=[new Yie(1,0,0),new Yie(-1,0,0),new Yie(0,0,1),new Yie(0,0,-1),new Yie(0,1,0),new Yie(0,-1,0)],this._cubeUps=[new Yie(0,1,0),new Yie(0,1,0),new Yie(0,1,0),new Yie(0,1,0),new Yie(0,0,1),new Yie(0,0,-1)]}updateMatrices(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.camera,r=this.matrix,a=e.distance||n.far;a!==n.far&&(n.far=a,n.updateProjectionMatrix()),Zue.setFromMatrixPosition(e.matrixWorld),n.position.copy(Zue),$ue.copy(n.position),$ue.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt($ue),n.updateMatrixWorld(),r.makeTranslation(-Zue.x,-Zue.y,-Zue.z),Jue.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Jue)}}class tle extends Vue{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new ele}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class nle extends Zse{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=a,this.far=i,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,a,i){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=a,this.view.height=i,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let a=n-e,i=n+e,o=r+t,s=r-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a+=e*this.view.offsetX,i=a+e*this.view.width,o-=t*this.view.offsetY,s=o-t*this.view.height}this.projectionMatrix.makeOrthographic(a,i,o,s,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}class rle extends que{constructor(){super(new nle(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class ale extends Vue{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Koe.DEFAULT_UP),this.updateMatrix(),this.target=new Koe,this.shadow=new rle}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class ile extends Vue{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class ole{static decodeText(e){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),"undefined"!==typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(IQ){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!==typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class sle extends zue{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const a=this,i=Oue.get(e);if(void 0!==i)return a.manager.itemStart(e),i.then?void i.then((n=>{t&&t(n),a.manager.itemEnd(e)})).catch((e=>{r&&r(e)})):(setTimeout((function(){t&&t(i),a.manager.itemEnd(e)}),0),i);const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader;const s=fetch(e,o).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(a.options,{colorSpaceConversion:"none"}))})).then((function(n){return Oue.add(e,n),t&&t(n),a.manager.itemEnd(e),n})).catch((function(t){r&&r(t),Oue.remove(e),a.manager.itemError(e),a.manager.itemEnd(e)}));Oue.add(e,s),a.manager.itemStart(e)}}class cle extends nce{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isArrayCamera=!0,this.cameras=e}}const ule="\\[\\]\\.:\\/",lle=new RegExp("["+ule+"]","g"),fle="[^"+ule+"]",dle="[^"+ule.replace("\\.","")+"]",hle=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",fle)+/(WCOD+)?/.source.replace("WCOD",dle)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",fle)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",fle)+"$"),ple=["material","materials","bones","map"];class gle{constructor(e,t,n){this.path=t,this.parsedPath=n||gle.parseTrackName(t),this.node=gle.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new gle.Composite(e,t,n):new gle(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(lle,"")}static parseTrackName(e){const t=hle.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const e=n.nodeName.substring(r+1);-1!==ple.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let r=0;r<e.length;r++){const a=e[r];if(a.name===t||a.uuid===t)return a;const i=n(a.children);if(i)return i}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let r=0,a=n.length;r!==a;++r)e[t++]=n[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let r=0,a=n.length;r!==a;++r)n[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,a=n.length;r!==a;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,a=n.length;r!==a;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,r=t.propertyName;let a=t.propertyIndex;if(e||(e=gle.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(n){let r=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===r){r=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==r){if(void 0===e[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[r]}}const i=e[r];if(void 0===i){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",e)}let o=this.Versioning.None;this.targetObject=e,!0===e.isMaterial?o=this.Versioning.NeedsUpdate:!0===e.isObject3D&&(o=this.Versioning.MatrixWorldNeedsUpdate);let s=this.BindingType.Direct;if(void 0!==a){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[a]&&(a=e.morphTargetDictionary[a])}s=this.BindingType.ArrayElement,this.resolvedProperty=i,this.propertyIndex=a}else void 0!==i.fromArray&&void 0!==i.toArray?(s=this.BindingType.HasFromToArray,this.resolvedProperty=i):Array.isArray(i)?(s=this.BindingType.EntireArray,this.resolvedProperty=i):this.propertyName=r;this.getValue=this.GetterByBindingType[s],this.setValue=this.SetterByBindingTypeAndVersioning[s][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}gle.Composite=class{constructor(e,t,n){const r=n||gle.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,a=n.length;r!==a;++r)n[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},gle.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},gle.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},gle.prototype.GetterByBindingType=[gle.prototype._getValue_direct,gle.prototype._getValue_array,gle.prototype._getValue_arrayElement,gle.prototype._getValue_toArray],gle.prototype.SetterByBindingTypeAndVersioning=[[gle.prototype._setValue_direct,gle.prototype._setValue_direct_setNeedsUpdate,gle.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[gle.prototype._setValue_array,gle.prototype._setValue_array_setNeedsUpdate,gle.prototype._setValue_array_setMatrixWorldNeedsUpdate],[gle.prototype._setValue_arrayElement,gle.prototype._setValue_arrayElement_setNeedsUpdate,gle.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[gle.prototype._setValue_fromArray,gle.prototype._setValue_fromArray_setNeedsUpdate,gle.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];new Float32Array(1);function mle(e,t,n,r){const a=function(e){switch(e){case Bre:case Ure:return{byteLength:1,components:1};case Gre:case Wre:case Xre:return{byteLength:2,components:1};case qre:case Kre:return{byteLength:2,components:4};case Hre:case Vre:case Yre:return{byteLength:4,components:1};case Jre:return{byteLength:4,components:3}}throw new Error("Unknown texture type ".concat(e,"."))}(r);switch(n){case 1021:case 1024:return e*t;case 1025:return e*t*2;case tae:case nae:return e*t/a.components*a.byteLength;case 1030:case rae:return e*t*2/a.components*a.byteLength;case 1022:return e*t*3/a.components*a.byteLength;case Zre:case aae:return e*t*4/a.components*a.byteLength;case iae:case oae:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case sae:case cae:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case lae:case dae:return Math.max(e,16)*Math.max(t,8)/4;case uae:case fae:return Math.max(e,8)*Math.max(t,8)/2;case hae:case pae:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case gae:case mae:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case vae:return Math.floor((e+4)/5)*Math.floor((t+3)/4)*16;case bae:return Math.floor((e+4)/5)*Math.floor((t+4)/5)*16;case yae:return Math.floor((e+5)/6)*Math.floor((t+4)/5)*16;case xae:return Math.floor((e+5)/6)*Math.floor((t+5)/6)*16;case wae:return Math.floor((e+7)/8)*Math.floor((t+4)/5)*16;case Sae:return Math.floor((e+7)/8)*Math.floor((t+5)/6)*16;case Cae:return Math.floor((e+7)/8)*Math.floor((t+7)/8)*16;case Mae:return Math.floor((e+9)/10)*Math.floor((t+4)/5)*16;case _ae:return Math.floor((e+9)/10)*Math.floor((t+5)/6)*16;case Eae:return Math.floor((e+9)/10)*Math.floor((t+7)/8)*16;case Tae:return Math.floor((e+9)/10)*Math.floor((t+9)/10)*16;case Iae:return Math.floor((e+11)/12)*Math.floor((t+9)/10)*16;case kae:return Math.floor((e+11)/12)*Math.floor((t+11)/12)*16;case Nae:case Lae:case Aae:return Math.ceil(e/4)*Math.ceil(t/4)*16;case 36283:case Rae:return Math.ceil(e/4)*Math.ceil(t/4)*8;case Dae:case Oae:return Math.ceil(e/4)*Math.ceil(t/4)*16}throw new Error("Unable to determine texture byte length for ".concat(n," format."))}function vle(){let e=null,t=!1,n=null,r=null;function a(t,i){n(t,i),r=e.requestAnimationFrame(a)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(a),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function ble(e){const t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);const r=t.get(n);r&&(e.deleteBuffer(r.buffer),t.delete(n))},update:function(n,r){if(n.isInterleavedBufferAttribute&&(n=n.data),n.isGLBufferAttribute){const e=t.get(n);return void((!e||e.version<n.version)&&t.set(n,{buffer:n.buffer,type:n.type,bytesPerElement:n.elementSize,version:n.version}))}const a=t.get(n);if(void 0===a)t.set(n,function(t,n){const r=t.array,a=t.usage,i=r.byteLength,o=e.createBuffer();let s;if(e.bindBuffer(n,o),e.bufferData(n,r,a),t.onUploadCallback(),r instanceof Float32Array)s=e.FLOAT;else if(r instanceof Uint16Array)s=t.isFloat16BufferAttribute?e.HALF_FLOAT:e.UNSIGNED_SHORT;else if(r instanceof Int16Array)s=e.SHORT;else if(r instanceof Uint32Array)s=e.UNSIGNED_INT;else if(r instanceof Int32Array)s=e.INT;else if(r instanceof Int8Array)s=e.BYTE;else if(r instanceof Uint8Array)s=e.UNSIGNED_BYTE;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);s=e.UNSIGNED_BYTE}return{buffer:o,type:s,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version,size:i}}(n,r));else if(a.version<n.version){if(a.size!==n.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(t,n,r){const a=n.array,i=n.updateRanges;if(e.bindBuffer(r,t),0===i.length)e.bufferSubData(r,0,a);else{i.sort(((e,t)=>e.start-t.start));let t=0;for(let e=1;e<i.length;e++){const n=i[t],r=i[e];r.start<=n.start+n.count+1?n.count=Math.max(n.count,r.start+r.count-n.start):(++t,i[t]=r)}i.length=t+1;for(let n=0,o=i.length;n<o;n++){const t=i[n];e.bufferSubData(r,t.start*a.BYTES_PER_ELEMENT,a,t.start,t.count)}n.clearUpdateRanges()}n.onUploadCallback()}(a.buffer,n,r),a.version=n.version}}}}"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Kne}})),"undefined"!==typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Kne);const yle={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n\tfloat getIndirectIndex( const in int i ) {\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\tvColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE\n\t\temissiveColor = sRGBTransferEOTF( emissiveColor );\n\t#endif\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"vec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferEOTF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec4( 0., 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec4( 1., 1., 1., 1. );\n\tfloat vuf;\n\tfloat af = modf( v * PackFactors.a, vuf );\n\tfloat bf = modf( vuf * ShiftRight8, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec3( 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec3( 1., 1., 1. );\n\tfloat vuf;\n\tfloat bf = modf( v * PackFactors.b, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec2( 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec2( 1., 1. );\n\tfloat vuf;\n\tfloat gf = modf( v * 256., vuf );\n\treturn vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n\treturn dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n\treturn v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 CineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t#else\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#elif DEPTH_PACKING == 3202\n\t\tgl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n\t#elif DEPTH_PACKING == 3203\n\t\tgl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix[ 3 ];\n\tvec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},xle={common:{diffuse:{value:new pse(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new xie},alphaMap:{value:null},alphaMapTransform:{value:new xie},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new xie}},envmap:{envMap:{value:null},envMapRotation:{value:new xie},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new xie}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new xie}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new xie},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new xie},normalScale:{value:new yie(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new xie},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new xie}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new xie}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new xie}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new pse(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new pse(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new xie},alphaTest:{value:0},uvTransform:{value:new xie}},sprite:{diffuse:{value:new pse(16777215)},opacity:{value:1},center:{value:new yie(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new xie},alphaMap:{value:null},alphaMapTransform:{value:new xie},alphaTest:{value:0}}},wle={basic:{uniforms:qse([xle.common,xle.specularmap,xle.envmap,xle.aomap,xle.lightmap,xle.fog]),vertexShader:yle.meshbasic_vert,fragmentShader:yle.meshbasic_frag},lambert:{uniforms:qse([xle.common,xle.specularmap,xle.envmap,xle.aomap,xle.lightmap,xle.emissivemap,xle.bumpmap,xle.normalmap,xle.displacementmap,xle.fog,xle.lights,{emissive:{value:new pse(0)}}]),vertexShader:yle.meshlambert_vert,fragmentShader:yle.meshlambert_frag},phong:{uniforms:qse([xle.common,xle.specularmap,xle.envmap,xle.aomap,xle.lightmap,xle.emissivemap,xle.bumpmap,xle.normalmap,xle.displacementmap,xle.fog,xle.lights,{emissive:{value:new pse(0)},specular:{value:new pse(1118481)},shininess:{value:30}}]),vertexShader:yle.meshphong_vert,fragmentShader:yle.meshphong_frag},standard:{uniforms:qse([xle.common,xle.envmap,xle.aomap,xle.lightmap,xle.emissivemap,xle.bumpmap,xle.normalmap,xle.displacementmap,xle.roughnessmap,xle.metalnessmap,xle.fog,xle.lights,{emissive:{value:new pse(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:yle.meshphysical_vert,fragmentShader:yle.meshphysical_frag},toon:{uniforms:qse([xle.common,xle.aomap,xle.lightmap,xle.emissivemap,xle.bumpmap,xle.normalmap,xle.displacementmap,xle.gradientmap,xle.fog,xle.lights,{emissive:{value:new pse(0)}}]),vertexShader:yle.meshtoon_vert,fragmentShader:yle.meshtoon_frag},matcap:{uniforms:qse([xle.common,xle.bumpmap,xle.normalmap,xle.displacementmap,xle.fog,{matcap:{value:null}}]),vertexShader:yle.meshmatcap_vert,fragmentShader:yle.meshmatcap_frag},points:{uniforms:qse([xle.points,xle.fog]),vertexShader:yle.points_vert,fragmentShader:yle.points_frag},dashed:{uniforms:qse([xle.common,xle.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:yle.linedashed_vert,fragmentShader:yle.linedashed_frag},depth:{uniforms:qse([xle.common,xle.displacementmap]),vertexShader:yle.depth_vert,fragmentShader:yle.depth_frag},normal:{uniforms:qse([xle.common,xle.bumpmap,xle.normalmap,xle.displacementmap,{opacity:{value:1}}]),vertexShader:yle.meshnormal_vert,fragmentShader:yle.meshnormal_frag},sprite:{uniforms:qse([xle.sprite,xle.fog]),vertexShader:yle.sprite_vert,fragmentShader:yle.sprite_frag},background:{uniforms:{uvTransform:{value:new xie},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:yle.background_vert,fragmentShader:yle.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new xie}},vertexShader:yle.backgroundCube_vert,fragmentShader:yle.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:yle.cube_vert,fragmentShader:yle.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:yle.equirect_vert,fragmentShader:yle.equirect_frag},distanceRGBA:{uniforms:qse([xle.common,xle.displacementmap,{referencePosition:{value:new Yie},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:yle.distanceRGBA_vert,fragmentShader:yle.distanceRGBA_frag},shadow:{uniforms:qse([xle.lights,xle.fog,{color:{value:new pse(0)},opacity:{value:1}}]),vertexShader:yle.shadow_vert,fragmentShader:yle.shadow_frag}};wle.physical={uniforms:qse([wle.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new xie},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new xie},clearcoatNormalScale:{value:new yie(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new xie},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new xie},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new xie},sheen:{value:0},sheenColor:{value:new pse(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new xie},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new xie},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new xie},transmissionSamplerSize:{value:new yie},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new xie},attenuationDistance:{value:0},attenuationColor:{value:new pse(0)},specularColor:{value:new pse(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new xie},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new xie},anisotropyVector:{value:new yie},anisotropyMap:{value:null},anisotropyMapTransform:{value:new xie}}]),vertexShader:yle.meshphysical_vert,fragmentShader:yle.meshphysical_frag};const Sle={r:0,b:0,g:0},Cle=new Aoe,Mle=new Soe;function _le(e,t,n,r,a,i,o){const s=new pse(0);let c,u,l=!0===i?0:1,f=null,d=0,h=null;function p(e){let r=!0===e.isScene?e.background:null;if(r&&r.isTexture){r=(e.backgroundBlurriness>0?n:t).get(r)}return r}function g(t,n){t.getRGB(Sle,Kse(e)),r.buffers.color.setClear(Sle.r,Sle.g,Sle.b,n,o)}return{getClearColor:function(){return s},setClearColor:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;s.set(e),l=t,g(s,l)},getClearAlpha:function(){return l},setClearAlpha:function(e){l=e,g(s,l)},render:function(t){let n=!1;const a=p(t);null===a?g(s,l):a&&a.isColor&&(g(a,1),n=!0);const i=e.xr.getEnvironmentBlendMode();"additive"===i?r.buffers.color.setClear(0,0,0,1,o):"alpha-blend"===i&&r.buffers.color.setClear(0,0,0,0,o),(e.autoClear||n)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil))},addToRenderList:function(t,n){const r=p(n);r&&(r.isCubeTexture||r.mapping===Nre)?(void 0===u&&(u=new Vse(new Yse(1,1,1),new Jse({name:"BackgroundCubeMaterial",uniforms:Xse(wle.backgroundCube.uniforms),vertexShader:wle.backgroundCube.vertexShader,fragmentShader:wle.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),a.update(u)),Cle.copy(n.backgroundRotation),Cle.x*=-1,Cle.y*=-1,Cle.z*=-1,r.isCubeTexture&&!1===r.isRenderTargetTexture&&(Cle.y*=-1,Cle.z*=-1),u.material.uniforms.envMap.value=r,u.material.uniforms.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,u.material.uniforms.backgroundBlurriness.value=n.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(Mle.makeRotationFromEuler(Cle)),u.material.toneMapped=Nie.getTransfer(r.colorSpace)!==Xae,f===r&&d===r.version&&h===e.toneMapping||(u.material.needsUpdate=!0,f=r,d=r.version,h=e.toneMapping),u.layers.enableAll(),t.unshift(u,u.geometry,u.material,0,0,null)):r&&r.isTexture&&(void 0===c&&(c=new Vse(new fue(2,2),new Jse({name:"BackgroundMaterial",uniforms:Xse(wle.background.uniforms),vertexShader:wle.background.vertexShader,fragmentShader:wle.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),a.update(c)),c.material.uniforms.t2D.value=r,c.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,c.material.toneMapped=Nie.getTransfer(r.colorSpace)!==Xae,!0===r.matrixAutoUpdate&&r.updateMatrix(),c.material.uniforms.uvTransform.value.copy(r.matrix),f===r&&d===r.version&&h===e.toneMapping||(c.material.needsUpdate=!0,f=r,d=r.version,h=e.toneMapping),c.layers.enableAll(),t.unshift(c,c.geometry,c.material,0,0,null))},dispose:function(){void 0!==u&&(u.geometry.dispose(),u.material.dispose()),void 0!==c&&(c.geometry.dispose(),c.material.dispose())}}}function Ele(e,t){const n=e.getParameter(e.MAX_VERTEX_ATTRIBS),r={},a=u(null);let i=a,o=!1;function s(t){return e.bindVertexArray(t)}function c(t){return e.deleteVertexArray(t)}function u(e){const t=[],r=[],a=[];for(let i=0;i<n;i++)t[i]=0,r[i]=0,a[i]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:r,attributeDivisors:a,object:e,attributes:{},index:null}}function l(){const e=i.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function f(e){d(e,0)}function d(t,n){const r=i.newAttributes,a=i.enabledAttributes,o=i.attributeDivisors;r[t]=1,0===a[t]&&(e.enableVertexAttribArray(t),a[t]=1),o[t]!==n&&(e.vertexAttribDivisor(t,n),o[t]=n)}function h(){const t=i.newAttributes,n=i.enabledAttributes;for(let r=0,a=n.length;r<a;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function p(t,n,r,a,i,o,s){!0===s?e.vertexAttribIPointer(t,n,r,i,o):e.vertexAttribPointer(t,n,r,a,i,o)}function g(){m(),o=!0,i!==a&&(i=a,s(i.object))}function m(){a.geometry=null,a.program=null,a.wireframe=!1}return{setup:function(n,a,c,g,m){let v=!1;const b=function(t,n,a){const i=!0===a.wireframe;let o=r[t.id];void 0===o&&(o={},r[t.id]=o);let s=o[n.id];void 0===s&&(s={},o[n.id]=s);let c=s[i];void 0===c&&(c=u(e.createVertexArray()),s[i]=c);return c}(g,c,a);i!==b&&(i=b,s(i.object)),v=function(e,t,n,r){const a=i.attributes,o=t.attributes;let s=0;const c=n.getAttributes();for(const i in c){if(c[i].location>=0){const t=a[i];let n=o[i];if(void 0===n&&("instanceMatrix"===i&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===i&&e.instanceColor&&(n=e.instanceColor)),void 0===t)return!0;if(t.attribute!==n)return!0;if(n&&t.data!==n.data)return!0;s++}}return i.attributesNum!==s||i.index!==r}(n,g,c,m),v&&function(e,t,n,r){const a={},o=t.attributes;let s=0;const c=n.getAttributes();for(const i in c){if(c[i].location>=0){let t=o[i];void 0===t&&("instanceMatrix"===i&&e.instanceMatrix&&(t=e.instanceMatrix),"instanceColor"===i&&e.instanceColor&&(t=e.instanceColor));const n={};n.attribute=t,t&&t.data&&(n.data=t.data),a[i]=n,s++}}i.attributes=a,i.attributesNum=s,i.index=r}(n,g,c,m),null!==m&&t.update(m,e.ELEMENT_ARRAY_BUFFER),(v||o)&&(o=!1,function(n,r,a,i){l();const o=i.attributes,s=a.getAttributes(),c=r.defaultAttributeValues;for(const u in s){const r=s[u];if(r.location>=0){let a=o[u];if(void 0===a&&("instanceMatrix"===u&&n.instanceMatrix&&(a=n.instanceMatrix),"instanceColor"===u&&n.instanceColor&&(a=n.instanceColor)),void 0!==a){const o=a.normalized,s=a.itemSize,c=t.get(a);if(void 0===c)continue;const u=c.buffer,l=c.type,h=c.bytesPerElement,g=l===e.INT||l===e.UNSIGNED_INT||a.gpuType===Vre;if(a.isInterleavedBufferAttribute){const t=a.data,c=t.stride,m=a.offset;if(t.isInstancedInterleavedBuffer){for(let e=0;e<r.locationSize;e++)d(r.location+e,t.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===i._maxInstanceCount&&(i._maxInstanceCount=t.meshPerAttribute*t.count)}else for(let e=0;e<r.locationSize;e++)f(r.location+e);e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<r.locationSize;e++)p(r.location+e,s/r.locationSize,l,o,c*h,(m+s/r.locationSize*e)*h,g)}else{if(a.isInstancedBufferAttribute){for(let e=0;e<r.locationSize;e++)d(r.location+e,a.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===i._maxInstanceCount&&(i._maxInstanceCount=a.meshPerAttribute*a.count)}else for(let e=0;e<r.locationSize;e++)f(r.location+e);e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<r.locationSize;e++)p(r.location+e,s/r.locationSize,l,o,s*h,s/r.locationSize*e*h,g)}}else if(void 0!==c){const t=c[u];if(void 0!==t)switch(t.length){case 2:e.vertexAttrib2fv(r.location,t);break;case 3:e.vertexAttrib3fv(r.location,t);break;case 4:e.vertexAttrib4fv(r.location,t);break;default:e.vertexAttrib1fv(r.location,t)}}}}h()}(n,a,c,g),null!==m&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.get(m).buffer))},reset:g,resetDefaultState:m,dispose:function(){g();for(const e in r){const t=r[e];for(const e in t){const n=t[e];for(const e in n)c(n[e].object),delete n[e];delete t[e]}delete r[e]}},releaseStatesOfGeometry:function(e){if(void 0===r[e.id])return;const t=r[e.id];for(const n in t){const e=t[n];for(const t in e)c(e[t].object),delete e[t];delete t[n]}delete r[e.id]},releaseStatesOfProgram:function(e){for(const t in r){const n=r[t];if(void 0===n[e.id])continue;const a=n[e.id];for(const e in a)c(a[e].object),delete a[e];delete n[e.id]}},initAttributes:l,enableAttribute:f,disableUnusedAttributes:h}}function Tle(e,t,n){let r;function a(t,a,i){0!==i&&(e.drawArraysInstanced(r,t,a,i),n.update(a,r,i))}this.setMode=function(e){r=e},this.render=function(t,a){e.drawArrays(r,t,a),n.update(a,r,1)},this.renderInstances=a,this.renderMultiDraw=function(e,a,i){if(0===i)return;t.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,e,0,a,0,i);let o=0;for(let t=0;t<i;t++)o+=a[t];n.update(o,r,1)},this.renderMultiDrawInstances=function(e,i,o,s){if(0===o)return;const c=t.get("WEBGL_multi_draw");if(null===c)for(let t=0;t<e.length;t++)a(e[t],i[t],s[t]);else{c.multiDrawArraysInstancedWEBGL(r,e,0,i,0,s,0,o);let t=0;for(let e=0;e<o;e++)t+=i[e]*s[e];n.update(t,r,1)}}}function Ile(e,t,n,r){let a;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let o=void 0!==n.precision?n.precision:"highp";const s=i(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);const c=!0===n.logarithmicDepthBuffer,u=!0===n.reverseDepthBuffer&&t.has("EXT_clip_control"),l=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),f=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==a)return a;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");a=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else a=0;return a},getMaxPrecision:i,textureFormatReadable:function(t){return t===Zre||r.convert(t)===e.getParameter(e.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(n){const a=n===Xre&&(t.has("EXT_color_buffer_half_float")||t.has("EXT_color_buffer_float"));return!(n!==Bre&&r.convert(n)!==e.getParameter(e.IMPLEMENTATION_COLOR_READ_TYPE)&&n!==Yre&&!a)},precision:o,logarithmicDepthBuffer:c,reverseDepthBuffer:u,maxTextures:l,maxVertexTextures:f,maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),maxCubemapSize:e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:e.getParameter(e.MAX_VERTEX_ATTRIBS),maxVertexUniforms:e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:e.getParameter(e.MAX_VARYING_VECTORS),maxFragmentUniforms:e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:f>0,maxSamples:e.getParameter(e.MAX_SAMPLES)}}function kle(e){const t=this;let n=null,r=0,a=!1,i=!1;const o=new zce,s=new xie,c={value:null,needsUpdate:!1};function u(e,n,r,a){const i=null!==e?e.length:0;let u=null;if(0!==i){if(u=c.value,!0!==a||null===u){const t=r+4*i,a=n.matrixWorldInverse;s.getNormalMatrix(a),(null===u||u.length<t)&&(u=new Float32Array(t));for(let n=0,c=r;n!==i;++n,c+=4)o.copy(e[n]).applyMatrix4(a,s),o.normal.toArray(u,c),u[c+3]=o.constant}c.value=u,c.needsUpdate=!0}return t.numPlanes=i,t.numIntersection=0,u}this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const n=0!==e.length||t||0!==r||a;return a=t,r=e.length,n},this.beginShadows=function(){i=!0,u(null)},this.endShadows=function(){i=!1},this.setGlobalState=function(e,t){n=u(e,t,0)},this.setState=function(o,s,l){const f=o.clippingPlanes,d=o.clipIntersection,h=o.clipShadows,p=e.get(o);if(!a||null===f||0===f.length||i&&!h)i?u(null):function(){c.value!==n&&(c.value=n,c.needsUpdate=r>0);t.numPlanes=r,t.numIntersection=0}();else{const e=i?0:r,t=4*e;let a=p.clippingState||null;c.value=a,a=u(f,s,t,l);for(let r=0;r!==t;++r)a[r]=n[r];p.clippingState=a,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function Nle(e){let t=new WeakMap;function n(e,t){return t===Ire?e.mapping=Ere:t===kre&&(e.mapping=Tre),e}function r(e){const n=e.target;n.removeEventListener("dispose",r);const a=t.get(n);void 0!==a&&(t.delete(n),a.dispose())}return{get:function(a){if(a&&a.isTexture){const i=a.mapping;if(i===Ire||i===kre){if(t.has(a)){return n(t.get(a).texture,a.mapping)}{const i=a.image;if(i&&i.height>0){const o=new oce(i.height);return o.fromEquirectangularTexture(e,a),t.set(a,o),a.addEventListener("dispose",r),n(o.texture,a.mapping)}return null}}}return a},dispose:function(){t=new WeakMap}}}const Lle=[.125,.215,.35,.446,.526,.582],Ale=20,Rle=new nle,Dle=new pse;let Ole=null,Ple=0,Fle=0,zle=!1;const jle=(1+Math.sqrt(5))/2,Ble=1/jle,Ule=[new Yie(-jle,Ble,0),new Yie(jle,Ble,0),new Yie(-Ble,0,jle),new Yie(Ble,0,jle),new Yie(0,jle,-Ble),new Yie(0,jle,Ble),new Yie(-1,1,-1),new Yie(1,1,-1),new Yie(-1,1,1),new Yie(1,1,1)];class Wle{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;Ole=this._renderer.getRenderTarget(),Ple=this._renderer.getActiveCubeFace(),Fle=this._renderer.getActiveMipmapLevel(),zle=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const a=this._allocateTargets();return a.depthBuffer=!0,this._sceneToCubeUV(e,n,r,a),t>0&&this._blur(a,0,0,t),this._applyPMREM(a),this._cleanup(a),a}fromEquirectangular(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}fromCubemap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Yle(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Hle(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Ole,Ple,Fle),this._renderer.xr.enabled=zle,e.scissorTest=!1,Vle(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Ere||e.mapping===Tre?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Ole=this._renderer.getRenderTarget(),Ple=this._renderer.getActiveCubeFace(),Fle=this._renderer.getActiveMipmapLevel(),zle=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Fre,minFilter:Fre,generateMipmaps:!1,type:Xre,format:Zre,colorSpace:Hae,depthBuffer:!1},r=Gle(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Gle(e,t,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],r=[];let a=e;const i=e-4+1+Lle.length;for(let o=0;o<i;o++){const i=Math.pow(2,a);n.push(i);let s=1/i;o>e-4?s=Lle[o-e+4-1]:0===o&&(s=0),r.push(s);const c=1/(i-2),u=-c,l=1+c,f=[u,u,l,u,l,l,u,u,l,l,u,l],d=6,h=6,p=3,g=2,m=1,v=new Float32Array(p*h*d),b=new Float32Array(g*h*d),y=new Float32Array(m*h*d);for(let e=0;e<d;e++){const t=e%3*2/3-1,n=e>2?0:-1,r=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];v.set(r,p*h*e),b.set(f,g*h*e);const a=[e,e,e,e,e,e];y.set(a,m*h*e)}const x=new Ase;x.setAttribute("position",new wse(v,p)),x.setAttribute("uv",new wse(b,g)),x.setAttribute("faceIndex",new wse(y,m)),t.push(x),a>4&&a--}return{lodPlanes:t,sizeLods:n,sigmas:r}}(r)),this._blurMaterial=function(e,t,n){const r=new Float32Array(Ale),a=new Yie(0,1,0),i=new Jse({name:"SphericalGaussianBlur",defines:{n:Ale,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:"".concat(e,".0")},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:a}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1});return i}(r,e,t)}return r}_compileMaterial(e){const t=new Vse(this._lodPlanes[0],e);this._renderer.compile(t,Rle)}_sceneToCubeUV(e,t,n,r){const a=new nce(90,1,t,n),i=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],s=this._renderer,c=s.autoClear,u=s.toneMapping;s.getClearColor(Dle),s.toneMapping=0,s.autoClear=!1;const l=new bse({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),f=new Vse(new Yse,l);let d=!1;const h=e.background;h?h.isColor&&(l.color.copy(h),e.background=null,d=!0):(l.color.copy(Dle),d=!0);for(let p=0;p<6;p++){const t=p%3;0===t?(a.up.set(0,i[p],0),a.lookAt(o[p],0,0)):1===t?(a.up.set(0,0,i[p]),a.lookAt(0,o[p],0)):(a.up.set(0,i[p],0),a.lookAt(0,0,o[p]));const n=this._cubeSize;Vle(r,t*n,p>2?n:0,n,n),s.setRenderTarget(r),d&&s.render(f,a),s.render(e,a)}f.geometry.dispose(),f.material.dispose(),s.toneMapping=u,s.autoClear=c,e.background=h}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===Ere||e.mapping===Tre;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=Yle()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Hle());const a=r?this._cubemapMaterial:this._equirectMaterial,i=new Vse(this._lodPlanes[0],a);a.uniforms.envMap.value=e;const o=this._cubeSize;Vle(t,0,0,3*o,2*o),n.setRenderTarget(t),n.render(i,Rle)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const r=this._lodPlanes.length;for(let a=1;a<r;a++){const t=Math.sqrt(this._sigmas[a]*this._sigmas[a]-this._sigmas[a-1]*this._sigmas[a-1]),n=Ule[(r-a-1)%Ule.length];this._blur(e,a-1,a,t,n)}t.autoClear=n}_blur(e,t,n,r,a){const i=this._pingPongRenderTarget;this._halfBlur(e,i,t,n,r,"latitudinal",a),this._halfBlur(i,e,n,n,r,"longitudinal",a)}_halfBlur(e,t,n,r,a,i,o){const s=this._renderer,c=this._blurMaterial;"latitudinal"!==i&&"longitudinal"!==i&&console.error("blur direction must be either latitudinal or longitudinal!");const u=new Vse(this._lodPlanes[r],c),l=c.uniforms,f=this._sizeLods[n]-1,d=isFinite(a)?Math.PI/(2*f):2*Math.PI/39,h=a/d,p=isFinite(a)?1+Math.floor(3*h):Ale;p>Ale&&console.warn("sigmaRadians, ".concat(a,", is too large and will clip, as it requested ").concat(p," samples when the maximum is set to ").concat(Ale));const g=[];let m=0;for(let y=0;y<Ale;++y){const e=y/h,t=Math.exp(-e*e/2);g.push(t),0===y?m+=t:y<p&&(m+=2*t)}for(let y=0;y<g.length;y++)g[y]=g[y]/m;l.envMap.value=e.texture,l.samples.value=p,l.weights.value=g,l.latitudinal.value="latitudinal"===i,o&&(l.poleAxis.value=o);const{_lodMax:v}=this;l.dTheta.value=d,l.mipInt.value=v-n;const b=this._sizeLods[r];Vle(t,3*b*(r>v-4?r-v+4:0),4*(this._cubeSize-b),3*b,2*b),s.setRenderTarget(t),s.render(u,Rle)}}function Gle(e,t,n){const r=new Wie(e,t,n);return r.texture.mapping=Nre,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function Vle(e,t,n,r,a){e.viewport.set(t,n,r,a),e.scissor.set(t,n,r,a)}function Hle(){return new Jse({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Yle(){return new Jse({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Xle(e){let t=new WeakMap,n=null;function r(e){const n=e.target;n.removeEventListener("dispose",r);const a=t.get(n);void 0!==a&&(t.delete(n),a.dispose())}return{get:function(a){if(a&&a.isTexture){const i=a.mapping,o=i===Ire||i===kre,s=i===Ere||i===Tre;if(o||s){let i=t.get(a);const c=void 0!==i?i.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==c)return null===n&&(n=new Wle(e)),i=o?n.fromEquirectangular(a,i):n.fromCubemap(a,i),i.texture.pmremVersion=a.pmremVersion,t.set(a,i),i.texture;if(void 0!==i)return i.texture;{const c=a.image;return o&&c&&c.height>0||s&&c&&function(e){let t=0;const n=6;for(let r=0;r<n;r++)void 0!==e[r]&&t++;return t===n}(c)?(null===n&&(n=new Wle(e)),i=o?n.fromEquirectangular(a):n.fromCubemap(a),i.texture.pmremVersion=a.pmremVersion,t.set(a,i),a.addEventListener("dispose",r),i.texture):null}}}return a},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function qle(e){const t={};function n(n){if(void 0!==t[n])return t[n];let r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(e){return null!==n(e)},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(e){const t=n(e);return null===t&&Eie("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Kle(e,t,n,r){const a={},i=new WeakMap;function o(e){const s=e.target;null!==s.index&&t.remove(s.index);for(const n in s.attributes)t.remove(s.attributes[n]);s.removeEventListener("dispose",o),delete a[s.id];const c=i.get(s);c&&(t.remove(c),i.delete(s)),r.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){const n=[],r=e.index,a=e.attributes.position;let o=0;if(null!==r){const e=r.array;o=r.version;for(let t=0,r=e.length;t<r;t+=3){const r=e[t+0],a=e[t+1],i=e[t+2];n.push(r,a,a,i,i,r)}}else{if(void 0===a)return;{const e=a.array;o=a.version;for(let t=0,r=e.length/3-1;t<r;t+=3){const e=t+0,r=t+1,a=t+2;n.push(e,r,r,a,a,e)}}}const s=new(Sie(n)?Cse:Sse)(n,1);s.version=o;const c=i.get(e);c&&t.remove(c),i.set(e,s)}return{get:function(e,t){return!0===a[t.id]||(t.addEventListener("dispose",o),a[t.id]=!0,n.memory.geometries++),t},update:function(n){const r=n.attributes;for(const a in r)t.update(r[a],e.ARRAY_BUFFER)},getWireframeAttribute:function(e){const t=i.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return i.get(e)}}}function Qle(e,t,n){let r,a,i;function o(t,o,s){0!==s&&(e.drawElementsInstanced(r,o,a,t*i,s),n.update(o,r,s))}this.setMode=function(e){r=e},this.setIndex=function(e){a=e.type,i=e.bytesPerElement},this.render=function(t,o){e.drawElements(r,o,a,t*i),n.update(o,r,1)},this.renderInstances=o,this.renderMultiDraw=function(e,i,o){if(0===o)return;t.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,i,0,a,e,0,o);let s=0;for(let t=0;t<o;t++)s+=i[t];n.update(s,r,1)},this.renderMultiDrawInstances=function(e,s,c,u){if(0===c)return;const l=t.get("WEBGL_multi_draw");if(null===l)for(let t=0;t<e.length;t++)o(e[t]/i,s[t],u[t]);else{l.multiDrawElementsInstancedWEBGL(r,s,0,a,e,0,u,0,c);let t=0;for(let e=0;e<c;e++)t+=s[e]*u[e];n.update(t,r,1)}}}function Jle(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,r,a){switch(t.calls++,r){case e.TRIANGLES:t.triangles+=a*(n/3);break;case e.LINES:t.lines+=a*(n/2);break;case e.LINE_STRIP:t.lines+=a*(n-1);break;case e.LINE_LOOP:t.lines+=a*n;break;case e.POINTS:t.points+=a*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function Zle(e,t,n){const r=new WeakMap,a=new Bie;return{update:function(i,o,s){const c=i.morphTargetInfluences,u=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,l=void 0!==u?u.length:0;let f=r.get(o);if(void 0===f||f.count!==l){void 0!==f&&f.texture.dispose();const d=void 0!==o.morphAttributes.position,h=void 0!==o.morphAttributes.normal,p=void 0!==o.morphAttributes.color,g=o.morphAttributes.position||[],m=o.morphAttributes.normal||[],v=o.morphAttributes.color||[];let b=0;!0===d&&(b=1),!0===h&&(b=2),!0===p&&(b=3);let y=o.attributes.position.count*b,x=1;y>t.maxTextureSize&&(x=Math.ceil(y/t.maxTextureSize),y=t.maxTextureSize);const w=new Float32Array(y*x*4*l),S=new Gie(w,y,x,l);S.type=Yre,S.needsUpdate=!0;const C=4*b;for(let _=0;_<l;_++){const E=g[_],T=m[_],I=v[_],k=y*x*4*_;for(let N=0;N<E.count;N++){const L=N*C;!0===d&&(a.fromBufferAttribute(E,N),w[k+L+0]=a.x,w[k+L+1]=a.y,w[k+L+2]=a.z,w[k+L+3]=0),!0===h&&(a.fromBufferAttribute(T,N),w[k+L+4]=a.x,w[k+L+5]=a.y,w[k+L+6]=a.z,w[k+L+7]=0),!0===p&&(a.fromBufferAttribute(I,N),w[k+L+8]=a.x,w[k+L+9]=a.y,w[k+L+10]=a.z,w[k+L+11]=4===I.itemSize?a.w:1)}}function M(){S.dispose(),r.delete(o),o.removeEventListener("dispose",M)}f={count:l,texture:S,size:new yie(y,x)},r.set(o,f),o.addEventListener("dispose",M)}if(!0===i.isInstancedMesh&&null!==i.morphTexture)s.getUniforms().setValue(e,"morphTexture",i.morphTexture,n);else{let A=0;for(let D=0;D<c.length;D++)A+=c[D];const R=o.morphTargetsRelative?1:1-A;s.getUniforms().setValue(e,"morphTargetBaseInfluence",R),s.getUniforms().setValue(e,"morphTargetInfluences",c)}s.getUniforms().setValue(e,"morphTargetsTexture",f.texture,n),s.getUniforms().setValue(e,"morphTargetsTextureSize",f.size)}}}function $le(e,t,n,r){let a=new WeakMap;function i(e){const t=e.target;t.removeEventListener("dispose",i),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(o){const s=r.render.frame,c=o.geometry,u=t.get(o,c);if(a.get(u)!==s&&(t.update(u),a.set(u,s)),o.isInstancedMesh&&(!1===o.hasEventListener("dispose",i)&&o.addEventListener("dispose",i),a.get(o)!==s&&(n.update(o.instanceMatrix,e.ARRAY_BUFFER),null!==o.instanceColor&&n.update(o.instanceColor,e.ARRAY_BUFFER),a.set(o,s))),o.isSkinnedMesh){const e=o.skeleton;a.get(e)!==s&&(e.update(),a.set(e,s))}return u},dispose:function(){a=new WeakMap}}}const efe=new jie,tfe=new lue(1,1),nfe=new Gie,rfe=new Vie,afe=new ice,ife=[],ofe=[],sfe=new Float32Array(16),cfe=new Float32Array(9),ufe=new Float32Array(4);function lfe(e,t,n){const r=e[0];if(r<=0||r>0)return e;const a=t*n;let i=ife[a];if(void 0===i&&(i=new Float32Array(a),ife[a]=i),0!==t){r.toArray(i,0);for(let r=1,a=0;r!==t;++r)a+=n,e[r].toArray(i,a)}return i}function ffe(e,t){if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function dfe(e,t){for(let n=0,r=t.length;n<r;n++)e[n]=t[n]}function hfe(e,t){let n=ofe[t];void 0===n&&(n=new Int32Array(t),ofe[t]=n);for(let r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function pfe(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function gfe(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(ffe(n,t))return;e.uniform2fv(this.addr,t),dfe(n,t)}}function mfe(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(ffe(n,t))return;e.uniform3fv(this.addr,t),dfe(n,t)}}function vfe(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(ffe(n,t))return;e.uniform4fv(this.addr,t),dfe(n,t)}}function bfe(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(ffe(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),dfe(n,t)}else{if(ffe(n,r))return;ufe.set(r),e.uniformMatrix2fv(this.addr,!1,ufe),dfe(n,r)}}function yfe(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(ffe(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),dfe(n,t)}else{if(ffe(n,r))return;cfe.set(r),e.uniformMatrix3fv(this.addr,!1,cfe),dfe(n,r)}}function xfe(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(ffe(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),dfe(n,t)}else{if(ffe(n,r))return;sfe.set(r),e.uniformMatrix4fv(this.addr,!1,sfe),dfe(n,r)}}function wfe(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Sfe(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(ffe(n,t))return;e.uniform2iv(this.addr,t),dfe(n,t)}}function Cfe(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(ffe(n,t))return;e.uniform3iv(this.addr,t),dfe(n,t)}}function Mfe(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(ffe(n,t))return;e.uniform4iv(this.addr,t),dfe(n,t)}}function _fe(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function Efe(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(ffe(n,t))return;e.uniform2uiv(this.addr,t),dfe(n,t)}}function Tfe(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(ffe(n,t))return;e.uniform3uiv(this.addr,t),dfe(n,t)}}function Ife(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(ffe(n,t))return;e.uniform4uiv(this.addr,t),dfe(n,t)}}function kfe(e,t,n){const r=this.cache,a=n.allocateTextureUnit();let i;r[0]!==a&&(e.uniform1i(this.addr,a),r[0]=a),this.type===e.SAMPLER_2D_SHADOW?(tfe.compareFunction=515,i=tfe):i=efe,n.setTexture2D(t||i,a)}function Nfe(e,t,n){const r=this.cache,a=n.allocateTextureUnit();r[0]!==a&&(e.uniform1i(this.addr,a),r[0]=a),n.setTexture3D(t||rfe,a)}function Lfe(e,t,n){const r=this.cache,a=n.allocateTextureUnit();r[0]!==a&&(e.uniform1i(this.addr,a),r[0]=a),n.setTextureCube(t||afe,a)}function Afe(e,t,n){const r=this.cache,a=n.allocateTextureUnit();r[0]!==a&&(e.uniform1i(this.addr,a),r[0]=a),n.setTexture2DArray(t||nfe,a)}function Rfe(e,t){e.uniform1fv(this.addr,t)}function Dfe(e,t){const n=lfe(t,this.size,2);e.uniform2fv(this.addr,n)}function Ofe(e,t){const n=lfe(t,this.size,3);e.uniform3fv(this.addr,n)}function Pfe(e,t){const n=lfe(t,this.size,4);e.uniform4fv(this.addr,n)}function Ffe(e,t){const n=lfe(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function zfe(e,t){const n=lfe(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function jfe(e,t){const n=lfe(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function Bfe(e,t){e.uniform1iv(this.addr,t)}function Ufe(e,t){e.uniform2iv(this.addr,t)}function Wfe(e,t){e.uniform3iv(this.addr,t)}function Gfe(e,t){e.uniform4iv(this.addr,t)}function Vfe(e,t){e.uniform1uiv(this.addr,t)}function Hfe(e,t){e.uniform2uiv(this.addr,t)}function Yfe(e,t){e.uniform3uiv(this.addr,t)}function Xfe(e,t){e.uniform4uiv(this.addr,t)}function qfe(e,t,n){const r=this.cache,a=t.length,i=hfe(n,a);ffe(r,i)||(e.uniform1iv(this.addr,i),dfe(r,i));for(let o=0;o!==a;++o)n.setTexture2D(t[o]||efe,i[o])}function Kfe(e,t,n){const r=this.cache,a=t.length,i=hfe(n,a);ffe(r,i)||(e.uniform1iv(this.addr,i),dfe(r,i));for(let o=0;o!==a;++o)n.setTexture3D(t[o]||rfe,i[o])}function Qfe(e,t,n){const r=this.cache,a=t.length,i=hfe(n,a);ffe(r,i)||(e.uniform1iv(this.addr,i),dfe(r,i));for(let o=0;o!==a;++o)n.setTextureCube(t[o]||afe,i[o])}function Jfe(e,t,n){const r=this.cache,a=t.length,i=hfe(n,a);ffe(r,i)||(e.uniform1iv(this.addr,i),dfe(r,i));for(let o=0;o!==a;++o)n.setTexture2DArray(t[o]||nfe,i[o])}class Zfe{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=function(e){switch(e){case 5126:return pfe;case 35664:return gfe;case 35665:return mfe;case 35666:return vfe;case 35674:return bfe;case 35675:return yfe;case 35676:return xfe;case 5124:case 35670:return wfe;case 35667:case 35671:return Sfe;case 35668:case 35672:return Cfe;case 35669:case 35673:return Mfe;case 5125:return _fe;case 36294:return Efe;case 36295:return Tfe;case 36296:return Ife;case 35678:case 36198:case 36298:case 36306:case 35682:return kfe;case 35679:case 36299:case 36307:return Nfe;case 35680:case 36300:case 36308:case 36293:return Lfe;case 36289:case 36303:case 36311:case 36292:return Afe}}(t.type)}}class $fe{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Rfe;case 35664:return Dfe;case 35665:return Ofe;case 35666:return Pfe;case 35674:return Ffe;case 35675:return zfe;case 35676:return jfe;case 5124:case 35670:return Bfe;case 35667:case 35671:return Ufe;case 35668:case 35672:return Wfe;case 35669:case 35673:return Gfe;case 5125:return Vfe;case 36294:return Hfe;case 36295:return Yfe;case 36296:return Xfe;case 35678:case 36198:case 36298:case 36306:case 35682:return qfe;case 35679:case 36299:case 36307:return Kfe;case 35680:case 36300:case 36308:case 36293:return Qfe;case 36289:case 36303:case 36311:case 36292:return Jfe}}(t.type)}}class ede{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const r=this.seq;for(let a=0,i=r.length;a!==i;++a){const i=r[a];i.setValue(e,t[i.id],n)}}}const tde=/(\w+)(\])?(\[|\.)?/g;function nde(e,t){e.seq.push(t),e.map[t.id]=t}function rde(e,t,n){const r=e.name,a=r.length;for(tde.lastIndex=0;;){const i=tde.exec(r),o=tde.lastIndex;let s=i[1];const c="]"===i[2],u=i[3];if(c&&(s|=0),void 0===u||"["===u&&o+2===a){nde(n,void 0===u?new Zfe(s,e,t):new $fe(s,e,t));break}{let e=n.map[s];void 0===e&&(e=new ede(s),nde(n,e)),n=e}}}class ade{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){const n=e.getActiveUniform(t,r);rde(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,r){const a=this.map[t];void 0!==a&&a.setValue(e,n,r)}setOptional(e,t,n){const r=t[n];void 0!==r&&this.setValue(e,n,r)}static upload(e,t,n,r){for(let a=0,i=t.length;a!==i;++a){const i=t[a],o=n[i.id];!1!==o.needsUpdate&&i.setValue(e,o.value,r)}}static seqWithValue(e,t){const n=[];for(let r=0,a=e.length;r!==a;++r){const a=e[r];a.id in t&&n.push(a)}return n}}function ide(e,t,n){const r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}let ode=0;const sde=new xie;function cde(e,t,n){const r=e.getShaderParameter(t,e.COMPILE_STATUS),a=e.getShaderInfoLog(t).trim();if(r&&""===a)return"";const i=/ERROR: 0:(\d+)/.exec(a);if(i){const r=parseInt(i[1]);return n.toUpperCase()+"\n\n"+a+"\n\n"+function(e,t){const n=e.split("\n"),r=[],a=Math.max(t-6,0),i=Math.min(t+6,n.length);for(let o=a;o<i;o++){const e=o+1;r.push("".concat(e===t?">":" "," ").concat(e,": ").concat(n[o]))}return r.join("\n")}(e.getShaderSource(t),r)}return a}function ude(e,t){const n=function(e){Nie._getMatrix(sde,Nie.workingColorSpace,e);const t="mat3( ".concat(sde.elements.map((e=>e.toFixed(4)))," )");switch(Nie.getTransfer(e)){case Yae:return[t,"LinearTransferOETF"];case Xae:return[t,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",e),[t,"LinearTransferOETF"]}}(t);return["vec4 ".concat(e,"( vec4 value ) {"),"\treturn ".concat(n[1],"( vec4( value.rgb * ").concat(n[0],", value.a ) );"),"}"].join("\n")}function lde(e,t){let n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="Cineon";break;case 4:n="ACESFilmic";break;case 6:n="AgX";break;case 7:n="Neutral";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}const fde=new Yie;function dde(){Nie.getLuminanceCoefficients(fde);const e=fde.x.toFixed(4),t=fde.y.toFixed(4),n=fde.z.toFixed(4);return["float luminance( const in vec3 rgb ) {","\tconst vec3 weights = vec3( ".concat(e,", ").concat(t,", ").concat(n," );"),"\treturn dot( weights, rgb );","}"].join("\n")}function hde(e){return""!==e}function pde(e,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function gde(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const mde=/^[ \t]*#include +<([\w\d./]+)>/gm;function vde(e){return e.replace(mde,yde)}const bde=new Map;function yde(e,t){let n=yle[t];if(void 0===n){const e=bde.get(t);if(void 0===e)throw new Error("Can not resolve #include <"+t+">");n=yle[e],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,e)}return vde(n)}const xde=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function wde(e){return e.replace(xde,Sde)}function Sde(e,t,n,r){let a="";for(let i=parseInt(t);i<parseInt(n);i++)a+=r.replace(/\[\s*i\s*\]/g,"[ "+i+" ]").replace(/UNROLLED_LOOP_INDEX/g,i);return a}function Cde(e){let t="precision ".concat(e.precision," float;\n\tprecision ").concat(e.precision," int;\n\tprecision ").concat(e.precision," sampler2D;\n\tprecision ").concat(e.precision," samplerCube;\n\tprecision ").concat(e.precision," sampler3D;\n\tprecision ").concat(e.precision," sampler2DArray;\n\tprecision ").concat(e.precision," sampler2DShadow;\n\tprecision ").concat(e.precision," samplerCubeShadow;\n\tprecision ").concat(e.precision," sampler2DArrayShadow;\n\tprecision ").concat(e.precision," isampler2D;\n\tprecision ").concat(e.precision," isampler3D;\n\tprecision ").concat(e.precision," isamplerCube;\n\tprecision ").concat(e.precision," isampler2DArray;\n\tprecision ").concat(e.precision," usampler2D;\n\tprecision ").concat(e.precision," usampler3D;\n\tprecision ").concat(e.precision," usamplerCube;\n\tprecision ").concat(e.precision," usampler2DArray;\n\t");return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Mde(e,t,n,r){const a=e.getContext(),i=n.defines;let o=n.vertexShader,s=n.fragmentShader;const c=function(e){let t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(n),u=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case Ere:case Tre:t="ENVMAP_TYPE_CUBE";break;case Nre:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),l=function(e){let t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===Tre&&(t="ENVMAP_MODE_REFRACTION");return t}(n),f=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),d=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n}}(n),h=function(e){return[e.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",e.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(hde).join("\n")}(n),p=function(e){const t=[];for(const n in e){const r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(i),g=a.createProgram();let m,v,b=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(m=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p].filter(hde).join("\n"),m.length>0&&(m+="\n"),v=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p].filter(hde).join("\n"),v.length>0&&(v+="\n")):(m=[Cde(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+l:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(hde).join("\n"),v=[Cde(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.envMap?"#define "+l:"",n.envMap?"#define "+f:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?yle.tonemapping_pars_fragment:"",0!==n.toneMapping?lde("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",yle.colorspace_pars_fragment,ude("linearToOutputTexel",n.outputColorSpace),dde(),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(hde).join("\n")),o=vde(o),o=pde(o,n),o=gde(o,n),s=vde(s),s=pde(s,n),s=gde(s,n),o=wde(o),s=wde(s),!0!==n.isRawShaderMaterial&&(b="#version 300 es\n",m=[h,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+m,v=["#define varying in",n.glslVersion===aie?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===aie?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const y=b+m+o,x=b+v+s,w=ide(a,a.VERTEX_SHADER,y),S=ide(a,a.FRAGMENT_SHADER,x);function C(t){if(e.debug.checkShaderErrors){const n=a.getProgramInfoLog(g).trim(),r=a.getShaderInfoLog(w).trim(),i=a.getShaderInfoLog(S).trim();let o=!0,s=!0;if(!1===a.getProgramParameter(g,a.LINK_STATUS))if(o=!1,"function"===typeof e.debug.onShaderError)e.debug.onShaderError(a,g,w,S);else{const e=cde(a,w,"vertex"),r=cde(a,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+a.getError()+" - VALIDATE_STATUS "+a.getProgramParameter(g,a.VALIDATE_STATUS)+"\n\nMaterial Name: "+t.name+"\nMaterial Type: "+t.type+"\n\nProgram Info Log: "+n+"\n"+e+"\n"+r)}else""!==n?console.warn("THREE.WebGLProgram: Program Info Log:",n):""!==r&&""!==i||(s=!1);s&&(t.diagnostics={runnable:o,programLog:n,vertexShader:{log:r,prefix:m},fragmentShader:{log:i,prefix:v}})}a.deleteShader(w),a.deleteShader(S),M=new ade(a,g),_=function(e,t){const n={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let a=0;a<r;a++){const r=e.getActiveAttrib(t,a),i=r.name;let o=1;r.type===e.FLOAT_MAT2&&(o=2),r.type===e.FLOAT_MAT3&&(o=3),r.type===e.FLOAT_MAT4&&(o=4),n[i]={type:r.type,location:e.getAttribLocation(t,i),locationSize:o}}return n}(a,g)}let M,_;a.attachShader(g,w),a.attachShader(g,S),void 0!==n.index0AttributeName?a.bindAttribLocation(g,0,n.index0AttributeName):!0===n.morphTargets&&a.bindAttribLocation(g,0,"position"),a.linkProgram(g),this.getUniforms=function(){return void 0===M&&C(this),M},this.getAttributes=function(){return void 0===_&&C(this),_};let E=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===E&&(E=a.getProgramParameter(g,37297)),E},this.destroy=function(){r.releaseStatesOfProgram(this),a.deleteProgram(g),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=ode++,this.cacheKey=t,this.usedTimes=1,this.program=g,this.vertexShader=w,this.fragmentShader=S,this}let _de=0;class Ede{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),a=this._getShaderStage(n),i=this._getShaderCacheForMaterial(e);return!1===i.has(r)&&(i.add(r),r.usedTimes++),!1===i.has(a)&&(i.add(a),a.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,0===n.usedTimes&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new Tde(e),t.set(e,n)),n}}class Tde{constructor(e){this.id=_de++,this.code=e,this.usedTimes=0}}function Ide(e,t,n,r,a,i,o){const s=new Roe,c=new Ede,u=new Set,l=[],f=a.logarithmicDepthBuffer,d=a.vertexTextures;let h=a.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(e){return u.add(e),0===e?"uv":"uv".concat(e)}return{getParameters:function(i,s,l,m,v){const b=m.fog,y=v.geometry,x=i.isMeshStandardMaterial?m.environment:null,w=(i.isMeshStandardMaterial?n:t).get(i.envMap||x),S=w&&w.mapping===Nre?w.image.height:null,C=p[i.type];null!==i.precision&&(h=a.getMaxPrecision(i.precision),h!==i.precision&&console.warn("THREE.WebGLProgram.getParameters:",i.precision,"not supported, using",h,"instead."));const M=y.morphAttributes.position||y.morphAttributes.normal||y.morphAttributes.color,_=void 0!==M?M.length:0;let E,T,I,k,N=0;if(void 0!==y.morphAttributes.position&&(N=1),void 0!==y.morphAttributes.normal&&(N=2),void 0!==y.morphAttributes.color&&(N=3),C){const e=wle[C];E=e.vertexShader,T=e.fragmentShader}else E=i.vertexShader,T=i.fragmentShader,c.update(i),I=c.getVertexShaderID(i),k=c.getFragmentShaderID(i);const L=e.getRenderTarget(),A=e.state.buffers.depth.getReversed(),R=!0===v.isInstancedMesh,D=!0===v.isBatchedMesh,O=!!i.map,P=!!i.matcap,F=!!w,z=!!i.aoMap,j=!!i.lightMap,B=!!i.bumpMap,U=!!i.normalMap,W=!!i.displacementMap,G=!!i.emissiveMap,V=!!i.metalnessMap,H=!!i.roughnessMap,Y=i.anisotropy>0,X=i.clearcoat>0,q=i.dispersion>0,K=i.iridescence>0,Q=i.sheen>0,J=i.transmission>0,Z=Y&&!!i.anisotropyMap,$=X&&!!i.clearcoatMap,ee=X&&!!i.clearcoatNormalMap,te=X&&!!i.clearcoatRoughnessMap,ne=K&&!!i.iridescenceMap,re=K&&!!i.iridescenceThicknessMap,ae=Q&&!!i.sheenColorMap,ie=Q&&!!i.sheenRoughnessMap,oe=!!i.specularMap,se=!!i.specularColorMap,ce=!!i.specularIntensityMap,ue=J&&!!i.transmissionMap,le=J&&!!i.thicknessMap,fe=!!i.gradientMap,de=!!i.alphaMap,he=i.alphaTest>0,pe=!!i.alphaHash,ge=!!i.extensions;let me=0;i.toneMapped&&(null!==L&&!0!==L.isXRRenderTarget||(me=e.toneMapping));const ve={shaderID:C,shaderType:i.type,shaderName:i.name,vertexShader:E,fragmentShader:T,defines:i.defines,customVertexShaderID:I,customFragmentShaderID:k,isRawShaderMaterial:!0===i.isRawShaderMaterial,glslVersion:i.glslVersion,precision:h,batching:D,batchingColor:D&&null!==v._colorsTexture,instancing:R,instancingColor:R&&null!==v.instanceColor,instancingMorph:R&&null!==v.morphTexture,supportsVertexTextures:d,outputColorSpace:null===L?e.outputColorSpace:!0===L.isXRRenderTarget?L.texture.colorSpace:Hae,alphaToCoverage:!!i.alphaToCoverage,map:O,matcap:P,envMap:F,envMapMode:F&&w.mapping,envMapCubeUVHeight:S,aoMap:z,lightMap:j,bumpMap:B,normalMap:U,displacementMap:d&&W,emissiveMap:G,normalMapObjectSpace:U&&1===i.normalMapType,normalMapTangentSpace:U&&0===i.normalMapType,metalnessMap:V,roughnessMap:H,anisotropy:Y,anisotropyMap:Z,clearcoat:X,clearcoatMap:$,clearcoatNormalMap:ee,clearcoatRoughnessMap:te,dispersion:q,iridescence:K,iridescenceMap:ne,iridescenceThicknessMap:re,sheen:Q,sheenColorMap:ae,sheenRoughnessMap:ie,specularMap:oe,specularColorMap:se,specularIntensityMap:ce,transmission:J,transmissionMap:ue,thicknessMap:le,gradientMap:fe,opaque:!1===i.transparent&&1===i.blending&&!1===i.alphaToCoverage,alphaMap:de,alphaTest:he,alphaHash:pe,combine:i.combine,mapUv:O&&g(i.map.channel),aoMapUv:z&&g(i.aoMap.channel),lightMapUv:j&&g(i.lightMap.channel),bumpMapUv:B&&g(i.bumpMap.channel),normalMapUv:U&&g(i.normalMap.channel),displacementMapUv:W&&g(i.displacementMap.channel),emissiveMapUv:G&&g(i.emissiveMap.channel),metalnessMapUv:V&&g(i.metalnessMap.channel),roughnessMapUv:H&&g(i.roughnessMap.channel),anisotropyMapUv:Z&&g(i.anisotropyMap.channel),clearcoatMapUv:$&&g(i.clearcoatMap.channel),clearcoatNormalMapUv:ee&&g(i.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:te&&g(i.clearcoatRoughnessMap.channel),iridescenceMapUv:ne&&g(i.iridescenceMap.channel),iridescenceThicknessMapUv:re&&g(i.iridescenceThicknessMap.channel),sheenColorMapUv:ae&&g(i.sheenColorMap.channel),sheenRoughnessMapUv:ie&&g(i.sheenRoughnessMap.channel),specularMapUv:oe&&g(i.specularMap.channel),specularColorMapUv:se&&g(i.specularColorMap.channel),specularIntensityMapUv:ce&&g(i.specularIntensityMap.channel),transmissionMapUv:ue&&g(i.transmissionMap.channel),thicknessMapUv:le&&g(i.thicknessMap.channel),alphaMapUv:de&&g(i.alphaMap.channel),vertexTangents:!!y.attributes.tangent&&(U||Y),vertexColors:i.vertexColors,vertexAlphas:!0===i.vertexColors&&!!y.attributes.color&&4===y.attributes.color.itemSize,pointsUvs:!0===v.isPoints&&!!y.attributes.uv&&(O||de),fog:!!b,useFog:!0===i.fog,fogExp2:!!b&&b.isFogExp2,flatShading:!0===i.flatShading,sizeAttenuation:!0===i.sizeAttenuation,logarithmicDepthBuffer:f,reverseDepthBuffer:A,skinning:!0===v.isSkinnedMesh,morphTargets:void 0!==y.morphAttributes.position,morphNormals:void 0!==y.morphAttributes.normal,morphColors:void 0!==y.morphAttributes.color,morphTargetsCount:_,morphTextureStride:N,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numSpotLightMaps:s.spotLightMap.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numSpotLightShadowsWithMaps:s.numSpotLightShadowsWithMaps,numLightProbes:s.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:i.dithering,shadowMapEnabled:e.shadowMap.enabled&&l.length>0,shadowMapType:e.shadowMap.type,toneMapping:me,decodeVideoTexture:O&&!0===i.map.isVideoTexture&&Nie.getTransfer(i.map.colorSpace)===Xae,decodeVideoTextureEmissive:G&&!0===i.emissiveMap.isVideoTexture&&Nie.getTransfer(i.emissiveMap.colorSpace)===Xae,premultipliedAlpha:i.premultipliedAlpha,doubleSided:2===i.side,flipSided:1===i.side,useDepthPacking:i.depthPacking>=0,depthPacking:i.depthPacking||0,index0AttributeName:i.index0AttributeName,extensionClipCullDistance:ge&&!0===i.extensions.clipCullDistance&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(ge&&!0===i.extensions.multiDraw||D)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:i.customProgramCacheKey()};return ve.vertexUv1s=u.has(1),ve.vertexUv2s=u.has(2),ve.vertexUv3s=u.has(3),u.clear(),ve},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.numLightProbes),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){s.disableAll(),t.supportsVertexTextures&&s.enable(0);t.instancing&&s.enable(1);t.instancingColor&&s.enable(2);t.instancingMorph&&s.enable(3);t.matcap&&s.enable(4);t.envMap&&s.enable(5);t.normalMapObjectSpace&&s.enable(6);t.normalMapTangentSpace&&s.enable(7);t.clearcoat&&s.enable(8);t.iridescence&&s.enable(9);t.alphaTest&&s.enable(10);t.vertexColors&&s.enable(11);t.vertexAlphas&&s.enable(12);t.vertexUv1s&&s.enable(13);t.vertexUv2s&&s.enable(14);t.vertexUv3s&&s.enable(15);t.vertexTangents&&s.enable(16);t.anisotropy&&s.enable(17);t.alphaHash&&s.enable(18);t.batching&&s.enable(19);t.dispersion&&s.enable(20);t.batchingColor&&s.enable(21);e.push(s.mask),s.disableAll(),t.fog&&s.enable(0);t.useFog&&s.enable(1);t.flatShading&&s.enable(2);t.logarithmicDepthBuffer&&s.enable(3);t.reverseDepthBuffer&&s.enable(4);t.skinning&&s.enable(5);t.morphTargets&&s.enable(6);t.morphNormals&&s.enable(7);t.morphColors&&s.enable(8);t.premultipliedAlpha&&s.enable(9);t.shadowMapEnabled&&s.enable(10);t.doubleSided&&s.enable(11);t.flipSided&&s.enable(12);t.useDepthPacking&&s.enable(13);t.dithering&&s.enable(14);t.transmission&&s.enable(15);t.sheen&&s.enable(16);t.opaque&&s.enable(17);t.pointsUvs&&s.enable(18);t.decodeVideoTexture&&s.enable(19);t.decodeVideoTextureEmissive&&s.enable(20);t.alphaToCoverage&&s.enable(21);e.push(s.mask)}(n,t),n.push(e.outputColorSpace)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=p[e.type];let n;if(t){const e=wle[t];n=Qse.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let r;for(let e=0,a=l.length;e<a;e++){const t=l[e];if(t.cacheKey===n){r=t,++r.usedTimes;break}}return void 0===r&&(r=new Mde(e,n,t,i),l.push(r)),r},releaseProgram:function(e){if(0===--e.usedTimes){const t=l.indexOf(e);l[t]=l[l.length-1],l.pop(),e.destroy()}},releaseShaderCache:function(e){c.remove(e)},programs:l,dispose:function(){c.dispose()}}}function kde(){let e=new WeakMap;return{has:function(t){return e.has(t)},get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function Nde(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Lde(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Ade(){const e=[];let t=0;const n=[],r=[],a=[];function i(n,r,a,i,o,s){let c=e[t];return void 0===c?(c={id:n.id,object:n,geometry:r,material:a,groupOrder:i,renderOrder:n.renderOrder,z:o,group:s},e[t]=c):(c.id=n.id,c.object=n,c.geometry=r,c.material=a,c.groupOrder=i,c.renderOrder=n.renderOrder,c.z=o,c.group=s),t++,c}return{opaque:n,transmissive:r,transparent:a,init:function(){t=0,n.length=0,r.length=0,a.length=0},push:function(e,t,o,s,c,u){const l=i(e,t,o,s,c,u);o.transmission>0?r.push(l):!0===o.transparent?a.push(l):n.push(l)},unshift:function(e,t,o,s,c,u){const l=i(e,t,o,s,c,u);o.transmission>0?r.unshift(l):!0===o.transparent?a.unshift(l):n.unshift(l)},finish:function(){for(let n=t,r=e.length;n<r;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||Nde),r.length>1&&r.sort(t||Lde),a.length>1&&a.sort(t||Lde)}}}function Rde(){let e=new WeakMap;return{get:function(t,n){const r=e.get(t);let a;return void 0===r?(a=new Ade,e.set(t,[a])):n>=r.length?(a=new Ade,r.push(a)):a=r[n],a},dispose:function(){e=new WeakMap}}}function Dde(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new Yie,color:new pse};break;case"SpotLight":n={position:new Yie,direction:new Yie,color:new pse,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Yie,color:new pse,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Yie,skyColor:new pse,groundColor:new pse};break;case"RectAreaLight":n={color:new pse,position:new Yie,halfWidth:new Yie,halfHeight:new Yie}}return e[t.id]=n,n}}}let Ode=0;function Pde(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function Fde(e){const t=new Dde,n=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new yie};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new yie,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let s=0;s<9;s++)r.probe.push(new Yie);const a=new Yie,i=new Soe,o=new Soe;return{setup:function(a){let i=0,o=0,s=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let c=0,u=0,l=0,f=0,d=0,h=0,p=0,g=0,m=0,v=0,b=0;a.sort(Pde);for(let e=0,x=a.length;e<x;e++){const y=a[e],x=y.color,w=y.intensity,S=y.distance,C=y.shadow&&y.shadow.map?y.shadow.map.texture:null;if(y.isAmbientLight)i+=x.r*w,o+=x.g*w,s+=x.b*w;else if(y.isLightProbe){for(let e=0;e<9;e++)r.probe[e].addScaledVector(y.sh.coefficients[e],w);b++}else if(y.isDirectionalLight){const e=t.get(y);if(e.color.copy(y.color).multiplyScalar(y.intensity),y.castShadow){const e=y.shadow,t=n.get(y);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,r.directionalShadow[c]=t,r.directionalShadowMap[c]=C,r.directionalShadowMatrix[c]=y.shadow.matrix,h++}r.directional[c]=e,c++}else if(y.isSpotLight){const e=t.get(y);e.position.setFromMatrixPosition(y.matrixWorld),e.color.copy(x).multiplyScalar(w),e.distance=S,e.coneCos=Math.cos(y.angle),e.penumbraCos=Math.cos(y.angle*(1-y.penumbra)),e.decay=y.decay,r.spot[l]=e;const a=y.shadow;if(y.map&&(r.spotLightMap[m]=y.map,m++,a.updateMatrices(y),y.castShadow&&v++),r.spotLightMatrix[l]=a.matrix,y.castShadow){const e=n.get(y);e.shadowIntensity=a.intensity,e.shadowBias=a.bias,e.shadowNormalBias=a.normalBias,e.shadowRadius=a.radius,e.shadowMapSize=a.mapSize,r.spotShadow[l]=e,r.spotShadowMap[l]=C,g++}l++}else if(y.isRectAreaLight){const e=t.get(y);e.color.copy(x).multiplyScalar(w),e.halfWidth.set(.5*y.width,0,0),e.halfHeight.set(0,.5*y.height,0),r.rectArea[f]=e,f++}else if(y.isPointLight){const e=t.get(y);if(e.color.copy(y.color).multiplyScalar(y.intensity),e.distance=y.distance,e.decay=y.decay,y.castShadow){const e=y.shadow,t=n.get(y);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,t.shadowCameraNear=e.camera.near,t.shadowCameraFar=e.camera.far,r.pointShadow[u]=t,r.pointShadowMap[u]=C,r.pointShadowMatrix[u]=y.shadow.matrix,p++}r.point[u]=e,u++}else if(y.isHemisphereLight){const e=t.get(y);e.skyColor.copy(y.color).multiplyScalar(w),e.groundColor.copy(y.groundColor).multiplyScalar(w),r.hemi[d]=e,d++}}f>0&&(!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=xle.LTC_FLOAT_1,r.rectAreaLTC2=xle.LTC_FLOAT_2):(r.rectAreaLTC1=xle.LTC_HALF_1,r.rectAreaLTC2=xle.LTC_HALF_2)),r.ambient[0]=i,r.ambient[1]=o,r.ambient[2]=s;const y=r.hash;y.directionalLength===c&&y.pointLength===u&&y.spotLength===l&&y.rectAreaLength===f&&y.hemiLength===d&&y.numDirectionalShadows===h&&y.numPointShadows===p&&y.numSpotShadows===g&&y.numSpotMaps===m&&y.numLightProbes===b||(r.directional.length=c,r.spot.length=l,r.rectArea.length=f,r.point.length=u,r.hemi.length=d,r.directionalShadow.length=h,r.directionalShadowMap.length=h,r.pointShadow.length=p,r.pointShadowMap.length=p,r.spotShadow.length=g,r.spotShadowMap.length=g,r.directionalShadowMatrix.length=h,r.pointShadowMatrix.length=p,r.spotLightMatrix.length=g+m-v,r.spotLightMap.length=m,r.numSpotLightShadowsWithMaps=v,r.numLightProbes=b,y.directionalLength=c,y.pointLength=u,y.spotLength=l,y.rectAreaLength=f,y.hemiLength=d,y.numDirectionalShadows=h,y.numPointShadows=p,y.numSpotShadows=g,y.numSpotMaps=m,y.numLightProbes=b,r.version=Ode++)},setupView:function(e,t){let n=0,s=0,c=0,u=0,l=0;const f=t.matrixWorldInverse;for(let d=0,h=e.length;d<h;d++){const t=e[d];if(t.isDirectionalLight){const e=r.directional[n];e.direction.setFromMatrixPosition(t.matrixWorld),a.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(f),n++}else if(t.isSpotLight){const e=r.spot[c];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(f),e.direction.setFromMatrixPosition(t.matrixWorld),a.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(f),c++}else if(t.isRectAreaLight){const e=r.rectArea[u];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(f),o.identity(),i.copy(t.matrixWorld),i.premultiply(f),o.extractRotation(i),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),e.halfWidth.applyMatrix4(o),e.halfHeight.applyMatrix4(o),u++}else if(t.isPointLight){const e=r.point[s];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(f),s++}else if(t.isHemisphereLight){const e=r.hemi[l];e.direction.setFromMatrixPosition(t.matrixWorld),e.direction.transformDirection(f),l++}}},state:r}}function zde(e){const t=new Fde(e),n=[],r=[];const a={lightsArray:n,shadowsArray:r,camera:null,lights:t,transmissionRenderTarget:{}};return{init:function(e){a.camera=e,n.length=0,r.length=0},state:a,setupLights:function(){t.setup(n)},setupLightsView:function(e){t.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){r.push(e)}}}function jde(e){let t=new WeakMap;return{get:function(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const a=t.get(n);let i;return void 0===a?(i=new zde(e),t.set(n,[i])):r>=a.length?(i=new zde(e),a.push(i)):i=a[r],i},dispose:function(){t=new WeakMap}}}function Bde(e,t,n){let r=new Uce;const a=new yie,i=new yie,o=new Bie,s=new pue({depthPacking:3201}),c=new gue,u={},l=n.maxTextureSize,f={[Qne]:1,[Jne]:0,[Zne]:2},d=new Jse({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new yie},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),h=d.clone();h.defines.HORIZONTAL_PASS=1;const p=new Ase;p.setAttribute("position",new wse(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const g=new Vse(p,d),m=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1;let v=this.type;function b(n,r){const i=t.update(g);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,h.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,h.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new Wie(a.x,a.y)),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,i,d,g,null),h.uniforms.shadow_pass.value=n.mapPass.texture,h.uniforms.resolution.value=n.mapSize,h.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,i,h,g,null)}function y(t,n,r,a){let i=null;const o=!0===r.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==o)i=o;else if(i=!0===r.isPointLight?c:s,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const e=i.uuid,t=n.uuid;let r=u[e];void 0===r&&(r={},u[e]=r);let a=r[t];void 0===a&&(a=i.clone(),r[t]=a,n.addEventListener("dispose",w)),i=a}if(i.visible=n.visible,i.wireframe=n.wireframe,i.side=3===a?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:f[n.side],i.alphaMap=n.alphaMap,i.alphaTest=n.alphaTest,i.map=n.map,i.clipShadows=n.clipShadows,i.clippingPlanes=n.clippingPlanes,i.clipIntersection=n.clipIntersection,i.displacementMap=n.displacementMap,i.displacementScale=n.displacementScale,i.displacementBias=n.displacementBias,i.wireframeLinewidth=n.wireframeLinewidth,i.linewidth=n.linewidth,!0===r.isPointLight&&!0===i.isMeshDistanceMaterial){e.properties.get(i).light=r}return i}function x(n,a,i,o,s){if(!1===n.visible)return;if(n.layers.test(a.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===s)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,n.matrixWorld);const r=t.update(n),c=n.material;if(Array.isArray(c)){const t=r.groups;for(let u=0,l=t.length;u<l;u++){const l=t[u],f=c[l.materialIndex];if(f&&f.visible){const t=y(n,f,o,s);n.onBeforeShadow(e,n,a,i,r,t,l),e.renderBufferDirect(i,null,r,t,n,l),n.onAfterShadow(e,n,a,i,r,t,l)}}}else if(c.visible){const t=y(n,c,o,s);n.onBeforeShadow(e,n,a,i,r,t,null),e.renderBufferDirect(i,null,r,t,n,null),n.onAfterShadow(e,n,a,i,r,t,null)}}const c=n.children;for(let e=0,t=c.length;e<t;e++)x(c[e],a,i,o,s)}function w(e){e.target.removeEventListener("dispose",w);for(const t in u){const n=u[t],r=e.target.uuid;if(r in n){n[r].dispose(),delete n[r]}}}this.render=function(t,n,s){if(!1===m.enabled)return;if(!1===m.autoUpdate&&!1===m.needsUpdate)return;if(0===t.length)return;const c=e.getRenderTarget(),u=e.getActiveCubeFace(),f=e.getActiveMipmapLevel(),d=e.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);const h=3!==v&&3===this.type,p=3===v&&3!==this.type;for(let g=0,m=t.length;g<m;g++){const c=t[g],u=c.shadow;if(void 0===u){console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");continue}if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;a.copy(u.mapSize);const f=u.getFrameExtents();if(a.multiply(f),i.copy(u.mapSize),(a.x>l||a.y>l)&&(a.x>l&&(i.x=Math.floor(l/f.x),a.x=i.x*f.x,u.mapSize.x=i.x),a.y>l&&(i.y=Math.floor(l/f.y),a.y=i.y*f.y,u.mapSize.y=i.y)),null===u.map||!0===h||!0===p){const e=3!==this.type?{minFilter:Dre,magFilter:Dre}:{};null!==u.map&&u.map.dispose(),u.map=new Wie(a.x,a.y,e),u.map.texture.name=c.name+".shadowMap",u.camera.updateProjectionMatrix()}e.setRenderTarget(u.map),e.clear();const m=u.getViewportCount();for(let e=0;e<m;e++){const t=u.getViewport(e);o.set(i.x*t.x,i.y*t.y,i.x*t.z,i.y*t.w),d.viewport(o),u.updateMatrices(c,e),r=u.getFrustum(),x(n,s,u.camera,c,this.type)}!0!==u.isPointLightShadow&&3===this.type&&b(u,s),u.needsUpdate=!1}v=this.type,m.needsUpdate=!1,e.setRenderTarget(c,u,f)}}const Ude={[vre]:1,[yre]:6,[wre]:7,[xre]:5,[bre]:0,[Cre]:2,[Mre]:4,[Sre]:3};function Wde(e,t){const n=new function(){let t=!1;const n=new Bie;let r=null;const a=new Bie(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,i,o,s){!0===s&&(t*=o,r*=o,i*=o),n.set(t,r,i,o),!1===a.equals(n)&&(e.clearColor(t,r,i,o),a.copy(n))},reset:function(){t=!1,r=null,a.set(-1,0,0,0)}}},r=new function(){let n=!1,r=!1,a=null,i=null,o=null;return{setReversed:function(e){if(r!==e){const e=t.get("EXT_clip_control");r?e.clipControlEXT(e.LOWER_LEFT_EXT,e.ZERO_TO_ONE_EXT):e.clipControlEXT(e.LOWER_LEFT_EXT,e.NEGATIVE_ONE_TO_ONE_EXT);const n=o;o=null,this.setClear(n)}r=e},getReversed:function(){return r},setTest:function(t){t?B(e.DEPTH_TEST):U(e.DEPTH_TEST)},setMask:function(t){a===t||n||(e.depthMask(t),a=t)},setFunc:function(t){if(r&&(t=Ude[t]),i!==t){switch(t){case 0:e.depthFunc(e.NEVER);break;case 1:e.depthFunc(e.ALWAYS);break;case 2:e.depthFunc(e.LESS);break;case 3:default:e.depthFunc(e.LEQUAL);break;case 4:e.depthFunc(e.EQUAL);break;case 5:e.depthFunc(e.GEQUAL);break;case 6:e.depthFunc(e.GREATER);break;case 7:e.depthFunc(e.NOTEQUAL)}i=t}},setLocked:function(e){n=e},setClear:function(t){o!==t&&(r&&(t=1-t),e.clearDepth(t),o=t)},reset:function(){n=!1,a=null,i=null,o=null,r=!1}}},a=new function(){let t=!1,n=null,r=null,a=null,i=null,o=null,s=null,c=null,u=null;return{setTest:function(n){t||(n?B(e.STENCIL_TEST):U(e.STENCIL_TEST))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,o){r===t&&a===n&&i===o||(e.stencilFunc(t,n,o),r=t,a=n,i=o)},setOp:function(t,n,r){o===t&&s===n&&c===r||(e.stencilOp(t,n,r),o=t,s=n,c=r)},setLocked:function(e){t=e},setClear:function(t){u!==t&&(e.clearStencil(t),u=t)},reset:function(){t=!1,n=null,r=null,a=null,i=null,o=null,s=null,c=null,u=null}}},i=new WeakMap,o=new WeakMap;let s={},c={},u=new WeakMap,l=[],f=null,d=!1,h=null,p=null,g=null,m=null,v=null,b=null,y=null,x=new pse(0,0,0),w=0,S=!1,C=null,M=null,_=null,E=null,T=null;const I=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let k=!1,N=0;const L=e.getParameter(e.VERSION);-1!==L.indexOf("WebGL")?(N=parseFloat(/^WebGL (\d)/.exec(L)[1]),k=N>=1):-1!==L.indexOf("OpenGL ES")&&(N=parseFloat(/^OpenGL ES (\d)/.exec(L)[1]),k=N>=2);let A=null,R={};const D=e.getParameter(e.SCISSOR_BOX),O=e.getParameter(e.VIEWPORT),P=(new Bie).fromArray(D),F=(new Bie).fromArray(O);function z(t,n,r,a){const i=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let s=0;s<r;s++)t===e.TEXTURE_3D||t===e.TEXTURE_2D_ARRAY?e.texImage3D(n,0,e.RGBA,1,1,a,0,e.RGBA,e.UNSIGNED_BYTE,i):e.texImage2D(n+s,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,i);return o}const j={};function B(t){!0!==s[t]&&(e.enable(t),s[t]=!0)}function U(t){!1!==s[t]&&(e.disable(t),s[t]=!1)}j[e.TEXTURE_2D]=z(e.TEXTURE_2D,e.TEXTURE_2D,1),j[e.TEXTURE_CUBE_MAP]=z(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),j[e.TEXTURE_2D_ARRAY]=z(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),j[e.TEXTURE_3D]=z(e.TEXTURE_3D,e.TEXTURE_3D,1,1),n.setClear(0,0,0,1),r.setClear(1),a.setClear(0),B(e.DEPTH_TEST),r.setFunc(3),H(!1),Y(1),B(e.CULL_FACE),V(0);const W={[$ne]:e.FUNC_ADD,[ere]:e.FUNC_SUBTRACT,[tre]:e.FUNC_REVERSE_SUBTRACT};W[103]=e.MIN,W[104]=e.MAX;const G={[nre]:e.ZERO,[rre]:e.ONE,[are]:e.SRC_COLOR,[ore]:e.SRC_ALPHA,[dre]:e.SRC_ALPHA_SATURATE,[lre]:e.DST_COLOR,[cre]:e.DST_ALPHA,[ire]:e.ONE_MINUS_SRC_COLOR,[sre]:e.ONE_MINUS_SRC_ALPHA,[fre]:e.ONE_MINUS_DST_COLOR,[ure]:e.ONE_MINUS_DST_ALPHA,[hre]:e.CONSTANT_COLOR,[pre]:e.ONE_MINUS_CONSTANT_COLOR,[gre]:e.CONSTANT_ALPHA,[mre]:e.ONE_MINUS_CONSTANT_ALPHA};function V(t,n,r,a,i,o,s,c,u,l){if(0!==t){if(!1===d&&(B(e.BLEND),d=!0),5===t)i=i||n,o=o||r,s=s||a,n===p&&i===v||(e.blendEquationSeparate(W[n],W[i]),p=n,v=i),r===g&&a===m&&o===b&&s===y||(e.blendFuncSeparate(G[r],G[a],G[o],G[s]),g=r,m=a,b=o,y=s),!1!==c.equals(x)&&u===w||(e.blendColor(c.r,c.g,c.b,u),x.copy(c),w=u),h=t,S=!1;else if(t!==h||l!==S){if(p===$ne&&v===$ne||(e.blendEquation(e.FUNC_ADD),p=$ne,v=$ne),l)switch(t){case 1:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.ONE,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}g=null,m=null,b=null,y=null,x.set(0,0,0),w=0,h=t,S=l}}else!0===d&&(U(e.BLEND),d=!1)}function H(t){C!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),C=t)}function Y(t){0!==t?(B(e.CULL_FACE),t!==M&&(1===t?e.cullFace(e.BACK):2===t?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):U(e.CULL_FACE),M=t}function X(t,n,r){t?(B(e.POLYGON_OFFSET_FILL),E===n&&T===r||(e.polygonOffset(n,r),E=n,T=r)):U(e.POLYGON_OFFSET_FILL)}return{buffers:{color:n,depth:r,stencil:a},enable:B,disable:U,bindFramebuffer:function(t,n){return c[t]!==n&&(e.bindFramebuffer(t,n),c[t]=n,t===e.DRAW_FRAMEBUFFER&&(c[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(c[e.DRAW_FRAMEBUFFER]=n),!0)},drawBuffers:function(t,n){let r=l,a=!1;if(t){r=u.get(n),void 0===r&&(r=[],u.set(n,r));const i=t.textures;if(r.length!==i.length||r[0]!==e.COLOR_ATTACHMENT0){for(let t=0,n=i.length;t<n;t++)r[t]=e.COLOR_ATTACHMENT0+t;r.length=i.length,a=!0}}else r[0]!==e.BACK&&(r[0]=e.BACK,a=!0);a&&e.drawBuffers(r)},useProgram:function(t){return f!==t&&(e.useProgram(t),f=t,!0)},setBlending:V,setMaterial:function(t,i){2===t.side?U(e.CULL_FACE):B(e.CULL_FACE);let o=1===t.side;i&&(o=!o),H(o),1===t.blending&&!1===t.transparent?V(0):V(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.blendColor,t.blendAlpha,t.premultipliedAlpha),r.setFunc(t.depthFunc),r.setTest(t.depthTest),r.setMask(t.depthWrite),n.setMask(t.colorWrite);const s=t.stencilWrite;a.setTest(s),s&&(a.setMask(t.stencilWriteMask),a.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),a.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),X(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?B(e.SAMPLE_ALPHA_TO_COVERAGE):U(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:H,setCullFace:Y,setLineWidth:function(t){t!==_&&(k&&e.lineWidth(t),_=t)},setPolygonOffset:X,setScissorTest:function(t){t?B(e.SCISSOR_TEST):U(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+I-1),A!==t&&(e.activeTexture(t),A=t)},bindTexture:function(t,n,r){void 0===r&&(r=null===A?e.TEXTURE0+I-1:A);let a=R[r];void 0===a&&(a={type:void 0,texture:void 0},R[r]=a),a.type===t&&a.texture===n||(A!==r&&(e.activeTexture(r),A=r),e.bindTexture(t,n||j[t]),a.type=t,a.texture=n)},unbindTexture:function(){const t=R[A];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},updateUBOMapping:function(t,n){let r=o.get(n);void 0===r&&(r=new WeakMap,o.set(n,r));let a=r.get(t);void 0===a&&(a=e.getUniformBlockIndex(n,t.name),r.set(t,a))},uniformBlockBinding:function(t,n){const r=o.get(n).get(t);i.get(n)!==r&&(e.uniformBlockBinding(n,r,t.__bindingPointIndex),i.set(n,r))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===P.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),P.copy(t))},viewport:function(t){!1===F.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),F.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),r.setReversed(!1),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),s={},A=null,R={},c={},u=new WeakMap,l=[],f=null,d=!1,h=null,p=null,g=null,m=null,v=null,b=null,y=null,x=new pse(0,0,0),w=0,S=!1,C=null,M=null,_=null,E=null,T=null,P.set(0,0,e.canvas.width,e.canvas.height),F.set(0,0,e.canvas.width,e.canvas.height),n.reset(),r.reset(),a.reset()}}}function Gde(e,t,n,r,a,i,o){const s=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,c="undefined"!==typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),u=new yie,l=new WeakMap;let f;const d=new WeakMap;let h=!1;try{h="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(upe){}function p(e,t){return h?new OffscreenCanvas(e,t):Cie("canvas")}function g(e,t,n){let r=1;const a=U(e);if((a.width>n||a.height>n)&&(r=n/Math.max(a.width,a.height)),r<1){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!==typeof VideoFrame&&e instanceof VideoFrame){const n=Math.floor(r*a.width),i=Math.floor(r*a.height);void 0===f&&(f=p(n,i));const o=t?p(n,i):f;o.width=n,o.height=i;return o.getContext("2d").drawImage(e,0,0,n,i),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+a.width+"x"+a.height+") to ("+n+"x"+i+")."),o}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+a.width+"x"+a.height+")."),e}return e}function m(e){return e.generateMipmaps}function v(t){e.generateMipmap(t)}function b(t){return t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:t.isWebGL3DRenderTarget?e.TEXTURE_3D:t.isWebGLArrayRenderTarget||t.isCompressedArrayTexture?e.TEXTURE_2D_ARRAY:e.TEXTURE_2D}function y(n,r,a,i){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let s=r;if(r===e.RED&&(a===e.FLOAT&&(s=e.R32F),a===e.HALF_FLOAT&&(s=e.R16F),a===e.UNSIGNED_BYTE&&(s=e.R8)),r===e.RED_INTEGER&&(a===e.UNSIGNED_BYTE&&(s=e.R8UI),a===e.UNSIGNED_SHORT&&(s=e.R16UI),a===e.UNSIGNED_INT&&(s=e.R32UI),a===e.BYTE&&(s=e.R8I),a===e.SHORT&&(s=e.R16I),a===e.INT&&(s=e.R32I)),r===e.RG&&(a===e.FLOAT&&(s=e.RG32F),a===e.HALF_FLOAT&&(s=e.RG16F),a===e.UNSIGNED_BYTE&&(s=e.RG8)),r===e.RG_INTEGER&&(a===e.UNSIGNED_BYTE&&(s=e.RG8UI),a===e.UNSIGNED_SHORT&&(s=e.RG16UI),a===e.UNSIGNED_INT&&(s=e.RG32UI),a===e.BYTE&&(s=e.RG8I),a===e.SHORT&&(s=e.RG16I),a===e.INT&&(s=e.RG32I)),r===e.RGB_INTEGER&&(a===e.UNSIGNED_BYTE&&(s=e.RGB8UI),a===e.UNSIGNED_SHORT&&(s=e.RGB16UI),a===e.UNSIGNED_INT&&(s=e.RGB32UI),a===e.BYTE&&(s=e.RGB8I),a===e.SHORT&&(s=e.RGB16I),a===e.INT&&(s=e.RGB32I)),r===e.RGBA_INTEGER&&(a===e.UNSIGNED_BYTE&&(s=e.RGBA8UI),a===e.UNSIGNED_SHORT&&(s=e.RGBA16UI),a===e.UNSIGNED_INT&&(s=e.RGBA32UI),a===e.BYTE&&(s=e.RGBA8I),a===e.SHORT&&(s=e.RGBA16I),a===e.INT&&(s=e.RGBA32I)),r===e.RGB&&a===e.UNSIGNED_INT_5_9_9_9_REV&&(s=e.RGB9_E5),r===e.RGBA){const t=o?Yae:Nie.getTransfer(i);a===e.FLOAT&&(s=e.RGBA32F),a===e.HALF_FLOAT&&(s=e.RGBA16F),a===e.UNSIGNED_BYTE&&(s=t===Xae?e.SRGB8_ALPHA8:e.RGBA8),a===e.UNSIGNED_SHORT_4_4_4_4&&(s=e.RGBA4),a===e.UNSIGNED_SHORT_5_5_5_1&&(s=e.RGB5_A1)}return s!==e.R16F&&s!==e.R32F&&s!==e.RG16F&&s!==e.RG32F&&s!==e.RGBA16F&&s!==e.RGBA32F||t.get("EXT_color_buffer_float"),s}function x(t,n){let r;return t?null===n||n===Hre||n===Qre?r=e.DEPTH24_STENCIL8:n===Yre?r=e.DEPTH32F_STENCIL8:n===Gre&&(r=e.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):null===n||n===Hre||n===Qre?r=e.DEPTH_COMPONENT24:n===Yre?r=e.DEPTH_COMPONENT32F:n===Gre&&(r=e.DEPTH_COMPONENT16),r}function w(e,t){return!0===m(e)||e.isFramebufferTexture&&e.minFilter!==Dre&&e.minFilter!==Fre?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function S(e){const t=e.target;t.removeEventListener("dispose",S),function(e){const t=r.get(e);if(void 0===t.__webglInit)return;const n=e.source,a=d.get(n);if(a){const r=a[t.__cacheKey];r.usedTimes--,0===r.usedTimes&&M(e),0===Object.keys(a).length&&d.delete(n)}r.remove(e)}(t),t.isVideoTexture&&l.delete(t)}function C(t){const n=t.target;n.removeEventListener("dispose",C),function(t){const n=r.get(t);t.depthTexture&&(t.depthTexture.dispose(),r.remove(t.depthTexture));if(t.isWebGLCubeRenderTarget)for(let r=0;r<6;r++){if(Array.isArray(n.__webglFramebuffer[r]))for(let t=0;t<n.__webglFramebuffer[r].length;t++)e.deleteFramebuffer(n.__webglFramebuffer[r][t]);else e.deleteFramebuffer(n.__webglFramebuffer[r]);n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[r])}else{if(Array.isArray(n.__webglFramebuffer))for(let t=0;t<n.__webglFramebuffer.length;t++)e.deleteFramebuffer(n.__webglFramebuffer[t]);else e.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let t=0;t<n.__webglColorRenderbuffer.length;t++)n.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(n.__webglColorRenderbuffer[t]);n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer)}const a=t.textures;for(let i=0,s=a.length;i<s;i++){const t=r.get(a[i]);t.__webglTexture&&(e.deleteTexture(t.__webglTexture),o.memory.textures--),r.remove(a[i])}r.remove(t)}(n)}function M(t){const n=r.get(t);e.deleteTexture(n.__webglTexture);const a=t.source;delete d.get(a)[n.__cacheKey],o.memory.textures--}let _=0;function E(t,a){const i=r.get(t);if(t.isVideoTexture&&function(e){const t=o.render.frame;l.get(e)!==t&&(l.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&i.__version!==t.version){const e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==e.complete)return void A(i,t,a);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(e.TEXTURE_2D,i.__webglTexture,e.TEXTURE0+a)}const T={[Lre]:e.REPEAT,[Are]:e.CLAMP_TO_EDGE,[Rre]:e.MIRRORED_REPEAT},I={[Dre]:e.NEAREST,[Ore]:e.NEAREST_MIPMAP_NEAREST,[Pre]:e.NEAREST_MIPMAP_LINEAR,[Fre]:e.LINEAR,[zre]:e.LINEAR_MIPMAP_NEAREST,[jre]:e.LINEAR_MIPMAP_LINEAR},k={[Kae]:e.NEVER,[nie]:e.ALWAYS,[Qae]:e.LESS,[Zae]:e.LEQUAL,[Jae]:e.EQUAL,[tie]:e.GEQUAL,[$ae]:e.GREATER,[eie]:e.NOTEQUAL};function N(n,i){if(i.type!==Yre||!1!==t.has("OES_texture_float_linear")||i.magFilter!==Fre&&i.magFilter!==zre&&i.magFilter!==Pre&&i.magFilter!==jre&&i.minFilter!==Fre&&i.minFilter!==zre&&i.minFilter!==Pre&&i.minFilter!==jre||console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),e.texParameteri(n,e.TEXTURE_WRAP_S,T[i.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,T[i.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,T[i.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,I[i.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,I[i.minFilter]),i.compareFunction&&(e.texParameteri(n,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,k[i.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){if(i.magFilter===Dre)return;if(i.minFilter!==Pre&&i.minFilter!==jre)return;if(i.type===Yre&&!1===t.has("OES_texture_float_linear"))return;if(i.anisotropy>1||r.get(i).__currentAnisotropy){const o=t.get("EXT_texture_filter_anisotropic");e.texParameterf(n,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(i.anisotropy,a.getMaxAnisotropy())),r.get(i).__currentAnisotropy=i.anisotropy}}}function L(t,n){let r=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",S));const a=n.source;let i=d.get(a);void 0===i&&(i={},d.set(a,i));const s=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(n);if(s!==t.__cacheKey){void 0===i[s]&&(i[s]={texture:e.createTexture(),usedTimes:0},o.memory.textures++,r=!0),i[s].usedTimes++;const a=i[t.__cacheKey];void 0!==a&&(i[t.__cacheKey].usedTimes--,0===a.usedTimes&&M(n)),t.__cacheKey=s,t.__webglTexture=i[s].texture}return r}function A(t,o,s){let c=e.TEXTURE_2D;(o.isDataArrayTexture||o.isCompressedArrayTexture)&&(c=e.TEXTURE_2D_ARRAY),o.isData3DTexture&&(c=e.TEXTURE_3D);const u=L(t,o),l=o.source;n.bindTexture(c,t.__webglTexture,e.TEXTURE0+s);const f=r.get(l);if(l.version!==f.__version||!0===u){n.activeTexture(e.TEXTURE0+s);const t=Nie.getPrimaries(Nie.workingColorSpace),r=o.colorSpace===Gae?null:Nie.getPrimaries(o.colorSpace),d=o.colorSpace===Gae||t===r?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,o.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,o.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);let h=g(o.image,!1,a.maxTextureSize);h=B(o,h);const p=i.convert(o.format,o.colorSpace),b=i.convert(o.type);let S,C=y(o.internalFormat,p,b,o.colorSpace,o.isVideoTexture);N(c,o);const M=o.mipmaps,_=!0!==o.isVideoTexture,E=void 0===f.__version||!0===u,T=l.dataReady,I=w(o,h);if(o.isDepthTexture)C=x(o.format===eae,o.type),E&&(_?n.texStorage2D(e.TEXTURE_2D,1,C,h.width,h.height):n.texImage2D(e.TEXTURE_2D,0,C,h.width,h.height,0,p,b,null));else if(o.isDataTexture)if(M.length>0){_&&E&&n.texStorage2D(e.TEXTURE_2D,I,C,M[0].width,M[0].height);for(let t=0,r=M.length;t<r;t++)S=M[t],_?T&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,S.width,S.height,p,b,S.data):n.texImage2D(e.TEXTURE_2D,t,C,S.width,S.height,0,p,b,S.data);o.generateMipmaps=!1}else _?(E&&n.texStorage2D(e.TEXTURE_2D,I,C,h.width,h.height),T&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,h.width,h.height,p,b,h.data)):n.texImage2D(e.TEXTURE_2D,0,C,h.width,h.height,0,p,b,h.data);else if(o.isCompressedTexture)if(o.isCompressedArrayTexture){_&&E&&n.texStorage3D(e.TEXTURE_2D_ARRAY,I,C,M[0].width,M[0].height,h.depth);for(let t=0,r=M.length;t<r;t++)if(S=M[t],o.format!==Zre)if(null!==p)if(_){if(T)if(o.layerUpdates.size>0){const r=mle(S.width,S.height,o.format,o.type);for(const a of o.layerUpdates){const i=S.data.subarray(a*r/S.data.BYTES_PER_ELEMENT,(a+1)*r/S.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,a,S.width,S.height,1,p,i)}o.clearLayerUpdates()}else n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,S.width,S.height,h.depth,p,S.data)}else n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,C,S.width,S.height,h.depth,0,S.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else _?T&&n.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,S.width,S.height,h.depth,p,b,S.data):n.texImage3D(e.TEXTURE_2D_ARRAY,t,C,S.width,S.height,h.depth,0,p,b,S.data)}else{_&&E&&n.texStorage2D(e.TEXTURE_2D,I,C,M[0].width,M[0].height);for(let t=0,r=M.length;t<r;t++)S=M[t],o.format!==Zre?null!==p?_?T&&n.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,S.width,S.height,p,S.data):n.compressedTexImage2D(e.TEXTURE_2D,t,C,S.width,S.height,0,S.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):_?T&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,S.width,S.height,p,b,S.data):n.texImage2D(e.TEXTURE_2D,t,C,S.width,S.height,0,p,b,S.data)}else if(o.isDataArrayTexture)if(_){if(E&&n.texStorage3D(e.TEXTURE_2D_ARRAY,I,C,h.width,h.height,h.depth),T)if(o.layerUpdates.size>0){const t=mle(h.width,h.height,o.format,o.type);for(const r of o.layerUpdates){const a=h.data.subarray(r*t/h.data.BYTES_PER_ELEMENT,(r+1)*t/h.data.BYTES_PER_ELEMENT);n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,r,h.width,h.height,1,p,b,a)}o.clearLayerUpdates()}else n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,h.width,h.height,h.depth,p,b,h.data)}else n.texImage3D(e.TEXTURE_2D_ARRAY,0,C,h.width,h.height,h.depth,0,p,b,h.data);else if(o.isData3DTexture)_?(E&&n.texStorage3D(e.TEXTURE_3D,I,C,h.width,h.height,h.depth),T&&n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,h.width,h.height,h.depth,p,b,h.data)):n.texImage3D(e.TEXTURE_3D,0,C,h.width,h.height,h.depth,0,p,b,h.data);else if(o.isFramebufferTexture){if(E)if(_)n.texStorage2D(e.TEXTURE_2D,I,C,h.width,h.height);else{let t=h.width,r=h.height;for(let a=0;a<I;a++)n.texImage2D(e.TEXTURE_2D,a,C,t,r,0,p,b,null),t>>=1,r>>=1}}else if(M.length>0){if(_&&E){const t=U(M[0]);n.texStorage2D(e.TEXTURE_2D,I,C,t.width,t.height)}for(let t=0,r=M.length;t<r;t++)S=M[t],_?T&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,p,b,S):n.texImage2D(e.TEXTURE_2D,t,C,p,b,S);o.generateMipmaps=!1}else if(_){if(E){const t=U(h);n.texStorage2D(e.TEXTURE_2D,I,C,t.width,t.height)}T&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,p,b,h)}else n.texImage2D(e.TEXTURE_2D,0,C,p,b,h);m(o)&&v(c),f.__version=l.version,o.onUpdate&&o.onUpdate(o)}t.__version=o.version}function R(t,a,o,c,u,l){const f=i.convert(o.format,o.colorSpace),d=i.convert(o.type),h=y(o.internalFormat,f,d,o.colorSpace),p=r.get(a),g=r.get(o);if(g.__renderTarget=a,!p.__hasExternalTextures){const t=Math.max(1,a.width>>l),r=Math.max(1,a.height>>l);u===e.TEXTURE_3D||u===e.TEXTURE_2D_ARRAY?n.texImage3D(u,l,h,t,r,a.depth,0,f,d,null):n.texImage2D(u,l,h,t,r,0,f,d,null)}n.bindFramebuffer(e.FRAMEBUFFER,t),j(a)?s.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,c,u,g.__webglTexture,0,z(a)):(u===e.TEXTURE_2D||u>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&u<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,c,u,g.__webglTexture,l),n.bindFramebuffer(e.FRAMEBUFFER,null)}function D(t,n,r){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer){const a=n.depthTexture,i=a&&a.isDepthTexture?a.type:null,o=x(n.stencilBuffer,i),c=n.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,u=z(n);j(n)?s.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,u,o,n.width,n.height):r?e.renderbufferStorageMultisample(e.RENDERBUFFER,u,o,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,o,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,c,e.RENDERBUFFER,t)}else{const t=n.textures;for(let a=0;a<t.length;a++){const o=t[a],c=i.convert(o.format,o.colorSpace),u=i.convert(o.type),l=y(o.internalFormat,c,u,o.colorSpace),f=z(n);r&&!1===j(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,f,l,n.width,n.height):j(n)?s.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,f,l,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,l,n.width,n.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function O(t){const a=r.get(t),i=!0===t.isWebGLCubeRenderTarget;if(a.__boundDepthTexture!==t.depthTexture){const e=t.depthTexture;if(a.__depthDisposeCallback&&a.__depthDisposeCallback(),e){const t=()=>{delete a.__boundDepthTexture,delete a.__depthDisposeCallback,e.removeEventListener("dispose",t)};e.addEventListener("dispose",t),a.__depthDisposeCallback=t}a.__boundDepthTexture=e}if(t.depthTexture&&!a.__autoAllocateDepthBuffer){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,a){if(a&&a.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!a.depthTexture||!a.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const i=r.get(a.depthTexture);i.__renderTarget=a,i.__webglTexture&&a.depthTexture.image.width===a.width&&a.depthTexture.image.height===a.height||(a.depthTexture.image.width=a.width,a.depthTexture.image.height=a.height,a.depthTexture.needsUpdate=!0),E(a.depthTexture,0);const o=i.__webglTexture,c=z(a);if(a.depthTexture.format===$re)j(a)?s.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,o,0,c):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,o,0);else{if(a.depthTexture.format!==eae)throw new Error("Unknown depthTexture format");j(a)?s.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,o,0,c):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,o,0)}}(a.__webglFramebuffer,t)}else if(i){a.__webglDepthbuffer=[];for(let r=0;r<6;r++)if(n.bindFramebuffer(e.FRAMEBUFFER,a.__webglFramebuffer[r]),void 0===a.__webglDepthbuffer[r])a.__webglDepthbuffer[r]=e.createRenderbuffer(),D(a.__webglDepthbuffer[r],t,!1);else{const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,i=a.__webglDepthbuffer[r];e.bindRenderbuffer(e.RENDERBUFFER,i),e.framebufferRenderbuffer(e.FRAMEBUFFER,n,e.RENDERBUFFER,i)}}else if(n.bindFramebuffer(e.FRAMEBUFFER,a.__webglFramebuffer),void 0===a.__webglDepthbuffer)a.__webglDepthbuffer=e.createRenderbuffer(),D(a.__webglDepthbuffer,t,!1);else{const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,r=a.__webglDepthbuffer;e.bindRenderbuffer(e.RENDERBUFFER,r),e.framebufferRenderbuffer(e.FRAMEBUFFER,n,e.RENDERBUFFER,r)}n.bindFramebuffer(e.FRAMEBUFFER,null)}const P=[],F=[];function z(e){return Math.min(a.maxSamples,e.samples)}function j(e){const n=r.get(e);return e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function B(e,t){const n=e.colorSpace,r=e.format,a=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||n!==Hae&&n!==Gae&&(Nie.getTransfer(n)===Xae?r===Zre&&a===Bre||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",n)),t}function U(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement?(u.width=e.naturalWidth||e.width,u.height=e.naturalHeight||e.height):"undefined"!==typeof VideoFrame&&e instanceof VideoFrame?(u.width=e.displayWidth,u.height=e.displayHeight):(u.width=e.width,u.height=e.height),u}this.allocateTextureUnit=function(){const e=_;return e>=a.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+a.maxTextures),_+=1,e},this.resetTextureUnits=function(){_=0},this.setTexture2D=E,this.setTexture2DArray=function(t,a){const i=r.get(t);t.version>0&&i.__version!==t.version?A(i,t,a):n.bindTexture(e.TEXTURE_2D_ARRAY,i.__webglTexture,e.TEXTURE0+a)},this.setTexture3D=function(t,a){const i=r.get(t);t.version>0&&i.__version!==t.version?A(i,t,a):n.bindTexture(e.TEXTURE_3D,i.__webglTexture,e.TEXTURE0+a)},this.setTextureCube=function(t,o){const s=r.get(t);t.version>0&&s.__version!==t.version?function(t,o,s){if(6!==o.image.length)return;const c=L(t,o),u=o.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+s);const l=r.get(u);if(u.version!==l.__version||!0===c){n.activeTexture(e.TEXTURE0+s);const t=Nie.getPrimaries(Nie.workingColorSpace),r=o.colorSpace===Gae?null:Nie.getPrimaries(o.colorSpace),f=o.colorSpace===Gae||t===r?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,o.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,o.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,f);const d=o.isCompressedTexture||o.image[0].isCompressedTexture,h=o.image[0]&&o.image[0].isDataTexture,p=[];for(let e=0;e<6;e++)p[e]=d||h?h?o.image[e].image:o.image[e]:g(o.image[e],!0,a.maxCubemapSize),p[e]=B(o,p[e]);const b=p[0],x=i.convert(o.format,o.colorSpace),S=i.convert(o.type),C=y(o.internalFormat,x,S,o.colorSpace),M=!0!==o.isVideoTexture,_=void 0===l.__version||!0===c,E=u.dataReady;let T,I=w(o,b);if(N(e.TEXTURE_CUBE_MAP,o),d){M&&_&&n.texStorage2D(e.TEXTURE_CUBE_MAP,I,C,b.width,b.height);for(let t=0;t<6;t++){T=p[t].mipmaps;for(let r=0;r<T.length;r++){const a=T[r];o.format!==Zre?null!==x?M?E&&n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,0,0,a.width,a.height,x,a.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,C,a.width,a.height,0,a.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):M?E&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,0,0,a.width,a.height,x,S,a.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,C,a.width,a.height,0,x,S,a.data)}}}else{if(T=o.mipmaps,M&&_){T.length>0&&I++;const t=U(p[0]);n.texStorage2D(e.TEXTURE_CUBE_MAP,I,C,t.width,t.height)}for(let t=0;t<6;t++)if(h){M?E&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,p[t].width,p[t].height,x,S,p[t].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,C,p[t].width,p[t].height,0,x,S,p[t].data);for(let r=0;r<T.length;r++){const a=T[r].image[t].image;M?E&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,0,0,a.width,a.height,x,S,a.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,C,a.width,a.height,0,x,S,a.data)}}else{M?E&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,x,S,p[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,C,x,S,p[t]);for(let r=0;r<T.length;r++){const a=T[r];M?E&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,0,0,x,S,a.image[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,C,x,S,a.image[t])}}}m(o)&&v(e.TEXTURE_CUBE_MAP),l.__version=u.version,o.onUpdate&&o.onUpdate(o)}t.__version=o.version}(s,t,o):n.bindTexture(e.TEXTURE_CUBE_MAP,s.__webglTexture,e.TEXTURE0+o)},this.rebindTextures=function(t,n,a){const i=r.get(t);void 0!==n&&R(i.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==a&&O(t)},this.setupRenderTarget=function(t){const a=t.texture,s=r.get(t),c=r.get(a);t.addEventListener("dispose",C);const u=t.textures,l=!0===t.isWebGLCubeRenderTarget,f=u.length>1;if(f||(void 0===c.__webglTexture&&(c.__webglTexture=e.createTexture()),c.__version=a.version,o.memory.textures++),l){s.__webglFramebuffer=[];for(let t=0;t<6;t++)if(a.mipmaps&&a.mipmaps.length>0){s.__webglFramebuffer[t]=[];for(let n=0;n<a.mipmaps.length;n++)s.__webglFramebuffer[t][n]=e.createFramebuffer()}else s.__webglFramebuffer[t]=e.createFramebuffer()}else{if(a.mipmaps&&a.mipmaps.length>0){s.__webglFramebuffer=[];for(let t=0;t<a.mipmaps.length;t++)s.__webglFramebuffer[t]=e.createFramebuffer()}else s.__webglFramebuffer=e.createFramebuffer();if(f)for(let t=0,n=u.length;t<n;t++){const n=r.get(u[t]);void 0===n.__webglTexture&&(n.__webglTexture=e.createTexture(),o.memory.textures++)}if(t.samples>0&&!1===j(t)){s.__webglMultisampledFramebuffer=e.createFramebuffer(),s.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,s.__webglMultisampledFramebuffer);for(let n=0;n<u.length;n++){const r=u[n];s.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,s.__webglColorRenderbuffer[n]);const a=i.convert(r.format,r.colorSpace),o=i.convert(r.type),c=y(r.internalFormat,a,o,r.colorSpace,!0===t.isXRRenderTarget),l=z(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,l,c,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,s.__webglColorRenderbuffer[n])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(s.__webglDepthRenderbuffer=e.createRenderbuffer(),D(s.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(l){n.bindTexture(e.TEXTURE_CUBE_MAP,c.__webglTexture),N(e.TEXTURE_CUBE_MAP,a);for(let n=0;n<6;n++)if(a.mipmaps&&a.mipmaps.length>0)for(let r=0;r<a.mipmaps.length;r++)R(s.__webglFramebuffer[n][r],t,a,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,r);else R(s.__webglFramebuffer[n],t,a,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);m(a)&&v(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(f){for(let a=0,i=u.length;a<i;a++){const i=u[a],o=r.get(i);n.bindTexture(e.TEXTURE_2D,o.__webglTexture),N(e.TEXTURE_2D,i),R(s.__webglFramebuffer,t,i,e.COLOR_ATTACHMENT0+a,e.TEXTURE_2D,0),m(i)&&v(e.TEXTURE_2D)}n.unbindTexture()}else{let r=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(r=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),n.bindTexture(r,c.__webglTexture),N(r,a),a.mipmaps&&a.mipmaps.length>0)for(let n=0;n<a.mipmaps.length;n++)R(s.__webglFramebuffer[n],t,a,e.COLOR_ATTACHMENT0,r,n);else R(s.__webglFramebuffer,t,a,e.COLOR_ATTACHMENT0,r,0);m(a)&&v(r),n.unbindTexture()}t.depthBuffer&&O(t)},this.updateRenderTargetMipmap=function(e){const t=e.textures;for(let a=0,i=t.length;a<i;a++){const i=t[a];if(m(i)){const t=b(e),a=r.get(i).__webglTexture;n.bindTexture(t,a),v(t),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(t.samples>0)if(!1===j(t)){const a=t.textures,i=t.width,o=t.height;let s=e.COLOR_BUFFER_BIT;const u=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,l=r.get(t),f=a.length>1;if(f)for(let t=0;t<a.length;t++)n.bindFramebuffer(e.FRAMEBUFFER,l.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,l.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,l.__webglMultisampledFramebuffer),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,l.__webglFramebuffer);for(let n=0;n<a.length;n++){if(t.resolveDepthBuffer&&(t.depthBuffer&&(s|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&t.resolveStencilBuffer&&(s|=e.STENCIL_BUFFER_BIT)),f){e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,l.__webglColorRenderbuffer[n]);const t=r.get(a[n]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,i,o,0,0,i,o,s,e.NEAREST),!0===c&&(P.length=0,F.length=0,P.push(e.COLOR_ATTACHMENT0+n),t.depthBuffer&&!1===t.resolveDepthBuffer&&(P.push(u),F.push(u),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,F)),e.invalidateFramebuffer(e.READ_FRAMEBUFFER,P))}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),f)for(let t=0;t<a.length;t++){n.bindFramebuffer(e.FRAMEBUFFER,l.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,l.__webglColorRenderbuffer[t]);const i=r.get(a[t]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,l.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,i,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,l.__webglMultisampledFramebuffer)}else if(t.depthBuffer&&!1===t.resolveDepthBuffer&&c){const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[n])}},this.setupDepthRenderbuffer=O,this.setupFrameBufferTexture=R,this.useMultisampledRTT=j}function Vde(e,t){return{convert:function(n){let r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Gae;const i=Nie.getTransfer(a);if(n===Bre)return e.UNSIGNED_BYTE;if(n===qre)return e.UNSIGNED_SHORT_4_4_4_4;if(n===Kre)return e.UNSIGNED_SHORT_5_5_5_1;if(n===Jre)return e.UNSIGNED_INT_5_9_9_9_REV;if(n===Ure)return e.BYTE;if(n===Wre)return e.SHORT;if(n===Gre)return e.UNSIGNED_SHORT;if(n===Vre)return e.INT;if(n===Hre)return e.UNSIGNED_INT;if(n===Yre)return e.FLOAT;if(n===Xre)return e.HALF_FLOAT;if(1021===n)return e.ALPHA;if(1022===n)return e.RGB;if(n===Zre)return e.RGBA;if(1024===n)return e.LUMINANCE;if(1025===n)return e.LUMINANCE_ALPHA;if(n===$re)return e.DEPTH_COMPONENT;if(n===eae)return e.DEPTH_STENCIL;if(n===tae)return e.RED;if(n===nae)return e.RED_INTEGER;if(1030===n)return e.RG;if(n===rae)return e.RG_INTEGER;if(n===aae)return e.RGBA_INTEGER;if(n===iae||n===oae||n===sae||n===cae)if(i===Xae){if(r=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===r)return null;if(n===iae)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===oae)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===sae)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===cae)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(r=t.get("WEBGL_compressed_texture_s3tc"),null===r)return null;if(n===iae)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===oae)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===sae)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===cae)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===uae||n===lae||n===fae||n===dae){if(r=t.get("WEBGL_compressed_texture_pvrtc"),null===r)return null;if(n===uae)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===lae)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===fae)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===dae)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===hae||n===pae||n===gae){if(r=t.get("WEBGL_compressed_texture_etc"),null===r)return null;if(n===hae||n===pae)return i===Xae?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(n===gae)return i===Xae?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}if(n===mae||n===vae||n===bae||n===yae||n===xae||n===wae||n===Sae||n===Cae||n===Mae||n===_ae||n===Eae||n===Tae||n===Iae||n===kae){if(r=t.get("WEBGL_compressed_texture_astc"),null===r)return null;if(n===mae)return i===Xae?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===vae)return i===Xae?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===bae)return i===Xae?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===yae)return i===Xae?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===xae)return i===Xae?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===wae)return i===Xae?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===Sae)return i===Xae?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===Cae)return i===Xae?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===Mae)return i===Xae?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===_ae)return i===Xae?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===Eae)return i===Xae?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===Tae)return i===Xae?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===Iae)return i===Xae?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===kae)return i===Xae?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===Nae||n===Lae||n===Aae){if(r=t.get("EXT_texture_compression_bptc"),null===r)return null;if(n===Nae)return i===Xae?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===Lae)return r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===Aae)return r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(36283===n||n===Rae||n===Dae||n===Oae){if(r=t.get("EXT_texture_compression_rgtc"),null===r)return null;if(n===Nae)return r.COMPRESSED_RED_RGTC1_EXT;if(n===Rae)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===Dae)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===Oae)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===Qre?e.UNSIGNED_INT_24_8:void 0!==e[n]?e[n]:null}}}const Hde={type:"move"};class Yde{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new uue,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new uue,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Yie,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Yie),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new uue,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Yie,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Yie),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let r=null,a=null,i=null;const o=this._targetRay,s=this._grip,c=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(c&&e.hand){i=!0;for(const i of e.hand.values()){const e=t.getJointPose(i,n),r=this._getHandJoint(c,i);null!==e&&(r.matrix.fromArray(e.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.matrixWorldNeedsUpdate=!0,r.jointRadius=e.radius),r.visible=null!==e}const r=c.joints["index-finger-tip"],a=c.joints["thumb-tip"],o=r.position.distanceTo(a.position),s=.02,u=.005;c.inputState.pinching&&o>s+u?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&o<=s-u&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&(a=t.getPose(e.gripSpace,n),null!==a&&(s.matrix.fromArray(a.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,a.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(a.linearVelocity)):s.hasLinearVelocity=!1,a.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(a.angularVelocity)):s.hasAngularVelocity=!1));null!==o&&(r=t.getPose(e.targetRaySpace,n),null===r&&null!==a&&(r=a),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(Hde)))}return null!==o&&(o.visible=null!==r),null!==s&&(s.visible=null!==a),null!==c&&(c.visible=null!==i),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const n=new uue;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class Xde{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,n){if(null===this.texture){const r=new jie;e.properties.get(r).__webglTexture=t.texture,t.depthNear===n.depthNear&&t.depthFar===n.depthFar||(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=r}}getMesh(e){if(null!==this.texture&&null===this.mesh){const t=e.cameras[0].viewport,n=new Jse({vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new Vse(new fue(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class qde extends sie{constructor(e,t){super();const n=this;let r=null,a=1,i=null,o="local-floor",s=1,c=null,u=null,l=null,f=null,d=null,h=null;const p=new Xde,g=t.getContextAttributes();let m=null,v=null;const b=[],y=[],x=new yie;let w=null;const S=new nce;S.viewport=new Bie;const C=new nce;C.viewport=new Bie;const M=[S,C],_=new cle;let E=null,T=null;function I(e){const t=y.indexOf(e.inputSource);if(-1===t)return;const n=b[t];void 0!==n&&(n.update(e.inputSource,e.frame,c||i),n.dispatchEvent({type:e.type,data:e.inputSource}))}function k(){r.removeEventListener("select",I),r.removeEventListener("selectstart",I),r.removeEventListener("selectend",I),r.removeEventListener("squeeze",I),r.removeEventListener("squeezestart",I),r.removeEventListener("squeezeend",I),r.removeEventListener("end",k),r.removeEventListener("inputsourceschange",N);for(let e=0;e<b.length;e++){const t=y[e];null!==t&&(y[e]=null,b[e].disconnect(t))}E=null,T=null,p.reset(),e.setRenderTarget(m),d=null,f=null,l=null,r=null,v=null,O.stop(),n.isPresenting=!1,e.setPixelRatio(w),e.setSize(x.width,x.height,!1),n.dispatchEvent({type:"sessionend"})}function N(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],r=y.indexOf(n);r>=0&&(y[r]=null,b[r].disconnect(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let r=y.indexOf(n);if(-1===r){for(let e=0;e<b.length;e++){if(e>=y.length){y.push(n),r=e;break}if(null===y[e]){y[e]=n,r=e;break}}if(-1===r)break}const a=b[r];a&&a.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=b[e];return void 0===t&&(t=new Yde,b[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=b[e];return void 0===t&&(t=new Yde,b[e]=t),t.getGripSpace()},this.getHand=function(e){let t=b[e];return void 0===t&&(t=new Yde,b[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){a=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){o=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||i},this.setReferenceSpace=function(e){c=e},this.getBaseLayer=function(){return null!==f?f:d},this.getBinding=function(){return l},this.getFrame=function(){return h},this.getSession=function(){return r},this.setSession=async function(u){if(r=u,null!==r){m=e.getRenderTarget(),r.addEventListener("select",I),r.addEventListener("selectstart",I),r.addEventListener("selectend",I),r.addEventListener("squeeze",I),r.addEventListener("squeezestart",I),r.addEventListener("squeezeend",I),r.addEventListener("end",k),r.addEventListener("inputsourceschange",N),!0!==g.xrCompatible&&await t.makeXRCompatible(),w=e.getPixelRatio(),e.getSize(x);if(void 0!==r.enabledFeatures&&r.enabledFeatures.includes("layers")){let n=null,i=null,o=null;g.depth&&(o=g.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,n=g.stencil?eae:$re,i=g.stencil?Qre:Hre);const s={colorFormat:t.RGBA8,depthFormat:o,scaleFactor:a};l=new XRWebGLBinding(r,t),f=l.createProjectionLayer(s),r.updateRenderState({layers:[f]}),e.setPixelRatio(1),e.setSize(f.textureWidth,f.textureHeight,!1),v=new Wie(f.textureWidth,f.textureHeight,{format:Zre,type:Bre,depthTexture:new lue(f.textureWidth,f.textureHeight,i,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:g.stencil,colorSpace:e.outputColorSpace,samples:g.antialias?4:0,resolveDepthBuffer:!1===f.ignoreDepthValues})}else{const n={antialias:g.antialias,alpha:!0,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:a};d=new XRWebGLLayer(r,t,n),r.updateRenderState({baseLayer:d}),e.setPixelRatio(1),e.setSize(d.framebufferWidth,d.framebufferHeight,!1),v=new Wie(d.framebufferWidth,d.framebufferHeight,{format:Zre,type:Bre,colorSpace:e.outputColorSpace,stencilBuffer:g.stencil})}v.isXRRenderTarget=!0,this.setFoveation(s),c=null,i=await r.requestReferenceSpace(o),O.setContext(r),O.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==r)return r.environmentBlendMode},this.getDepthTexture=function(){return p.getDepthTexture()};const L=new Yie,A=new Yie;function R(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===r)return;let t=e.near,n=e.far;null!==p.texture&&(p.depthNear>0&&(t=p.depthNear),p.depthFar>0&&(n=p.depthFar)),_.near=C.near=S.near=t,_.far=C.far=S.far=n,E===_.near&&T===_.far||(r.updateRenderState({depthNear:_.near,depthFar:_.far}),E=_.near,T=_.far),S.layers.mask=2|e.layers.mask,C.layers.mask=4|e.layers.mask,_.layers.mask=S.layers.mask|C.layers.mask;const a=e.parent,i=_.cameras;R(_,a);for(let r=0;r<i.length;r++)R(i[r],a);2===i.length?function(e,t,n){L.setFromMatrixPosition(t.matrixWorld),A.setFromMatrixPosition(n.matrixWorld);const r=L.distanceTo(A),a=t.projectionMatrix.elements,i=n.projectionMatrix.elements,o=a[14]/(a[10]-1),s=a[14]/(a[10]+1),c=(a[9]+1)/a[5],u=(a[9]-1)/a[5],l=(a[8]-1)/a[0],f=(i[8]+1)/i[0],d=o*l,h=o*f,p=r/(-l+f),g=p*-l;if(t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(g),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert(),-1===a[10])e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse);else{const t=o+p,n=s+p,a=d-g,i=h+(r-g),l=c*s/n*t,f=u*s/n*t;e.projectionMatrix.makePerspective(a,i,l,f,t,n),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}}(_,S,C):_.projectionMatrix.copy(S.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld));e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*fie*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,_,a)},this.getCamera=function(){return _},this.getFoveation=function(){if(null!==f||null!==d)return s},this.setFoveation=function(e){s=e,null!==f&&(f.fixedFoveation=e),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=e)},this.hasDepthSensing=function(){return null!==p.texture},this.getDepthSensingMesh=function(){return p.getMesh(_)};let D=null;const O=new vle;O.setAnimationLoop((function(t,a){if(u=a.getViewerPose(c||i),h=a,null!==u){const t=u.views;null!==d&&(e.setRenderTargetFramebuffer(v,d.framebuffer),e.setRenderTarget(v));let n=!1;t.length!==_.cameras.length&&(_.cameras.length=0,n=!0);for(let r=0;r<t.length;r++){const a=t[r];let i=null;if(null!==d)i=d.getViewport(a);else{const t=l.getViewSubImage(f,a);i=t.viewport,0===r&&(e.setRenderTargetTextures(v,t.colorTexture,f.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(v))}let o=M[r];void 0===o&&(o=new nce,o.layers.enable(r),o.viewport=new Bie,M[r]=o),o.matrix.fromArray(a.transform.matrix),o.matrix.decompose(o.position,o.quaternion,o.scale),o.projectionMatrix.fromArray(a.projectionMatrix),o.projectionMatrixInverse.copy(o.projectionMatrix).invert(),o.viewport.set(i.x,i.y,i.width,i.height),0===r&&(_.matrix.copy(o.matrix),_.matrix.decompose(_.position,_.quaternion,_.scale)),!0===n&&_.cameras.push(o)}const a=r.enabledFeatures;if(a&&a.includes("depth-sensing")){const n=l.getDepthInformation(t[0]);n&&n.isValid&&n.texture&&p.init(e,n,r.renderState)}}for(let e=0;e<b.length;e++){const t=y[e],n=b[e];null!==t&&void 0!==n&&n.update(t,a,c||i)}D&&D(t,a),a.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:a}),h=null})),this.setAnimationLoop=function(e){D=e},this.dispose=function(){}}}const Kde=new Aoe,Qde=new Soe;function Jde(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function r(e,r){e.opacity.value=r.opacity,r.color&&e.diffuse.value.copy(r.color),r.emissive&&e.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(e.map.value=r.map,n(r.map,e.mapTransform)),r.alphaMap&&(e.alphaMap.value=r.alphaMap,n(r.alphaMap,e.alphaMapTransform)),r.bumpMap&&(e.bumpMap.value=r.bumpMap,n(r.bumpMap,e.bumpMapTransform),e.bumpScale.value=r.bumpScale,1===r.side&&(e.bumpScale.value*=-1)),r.normalMap&&(e.normalMap.value=r.normalMap,n(r.normalMap,e.normalMapTransform),e.normalScale.value.copy(r.normalScale),1===r.side&&e.normalScale.value.negate()),r.displacementMap&&(e.displacementMap.value=r.displacementMap,n(r.displacementMap,e.displacementMapTransform),e.displacementScale.value=r.displacementScale,e.displacementBias.value=r.displacementBias),r.emissiveMap&&(e.emissiveMap.value=r.emissiveMap,n(r.emissiveMap,e.emissiveMapTransform)),r.specularMap&&(e.specularMap.value=r.specularMap,n(r.specularMap,e.specularMapTransform)),r.alphaTest>0&&(e.alphaTest.value=r.alphaTest);const a=t.get(r),i=a.envMap,o=a.envMapRotation;i&&(e.envMap.value=i,Kde.copy(o),Kde.x*=-1,Kde.y*=-1,Kde.z*=-1,i.isCubeTexture&&!1===i.isRenderTargetTexture&&(Kde.y*=-1,Kde.z*=-1),e.envMapRotation.value.setFromMatrix4(Qde.makeRotationFromEuler(Kde)),e.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,e.reflectivity.value=r.reflectivity,e.ior.value=r.ior,e.refractionRatio.value=r.refractionRatio),r.lightMap&&(e.lightMap.value=r.lightMap,e.lightMapIntensity.value=r.lightMapIntensity,n(r.lightMap,e.lightMapTransform)),r.aoMap&&(e.aoMap.value=r.aoMap,e.aoMapIntensity.value=r.aoMapIntensity,n(r.aoMap,e.aoMapTransform))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,Kse(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,a,i,o,s){a.isMeshBasicMaterial||a.isMeshLambertMaterial?r(e,a):a.isMeshToonMaterial?(r(e,a),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,a)):a.isMeshPhongMaterial?(r(e,a),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,a)):a.isMeshStandardMaterial?(r(e,a),function(e,t){e.metalness.value=t.metalness,t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap,n(t.metalnessMap,e.metalnessMapTransform));e.roughness.value=t.roughness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap,n(t.roughnessMap,e.roughnessMapTransform));t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}(e,a),a.isMeshPhysicalMaterial&&function(e,t,r){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform)));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),1===t.side&&e.clearcoatNormalScale.value.negate()));t.dispersion>0&&(e.dispersion.value=t.dispersion);t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform)));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=r.texture,e.transmissionSamplerSize.value.set(r.width,r.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,n(t.anisotropyMap,e.anisotropyMapTransform)));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform));t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,a,s)):a.isMeshMatcapMaterial?(r(e,a),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,a)):a.isMeshDepthMaterial?r(e,a):a.isMeshDistanceMaterial?(r(e,a),function(e,n){const r=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(r.matrixWorld),e.nearDistance.value=r.shadow.camera.near,e.farDistance.value=r.shadow.camera.far}(e,a)):a.isMeshNormalMaterial?r(e,a):a.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,a),a.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,a)):a.isPointsMaterial?function(e,t,r,a){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*r,e.scale.value=.5*a,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,a,i,o):a.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,a):a.isShadowMaterial?(e.color.value.copy(a.color),e.opacity.value=a.opacity):a.isShaderMaterial&&(a.uniformsNeedUpdate=!1)}}}function Zde(e,t,n,r){let a={},i={},o=[];const s=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);function c(e,t,n,r){const a=e.value,i=t+"_"+n;if(void 0===r[i])return r[i]="number"===typeof a||"boolean"===typeof a?a:a.clone(),!0;{const e=r[i];if("number"===typeof a||"boolean"===typeof a){if(e!==a)return r[i]=a,!0}else if(!1===e.equals(a))return e.copy(a),!0}return!1}function u(e){const t={boundary:0,storage:0};return"number"===typeof e||"boolean"===typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function l(t){const n=t.target;n.removeEventListener("dispose",l);const r=o.indexOf(n.__bindingPointIndex);o.splice(r,1),e.deleteBuffer(a[n.id]),delete a[n.id],delete i[n.id]}return{bind:function(e,t){const n=t.program;r.uniformBlockBinding(e,n)},update:function(n,f){let d=a[n.id];void 0===d&&(!function(e){const t=e.uniforms;let n=0;const r=16;for(let i=0,o=t.length;i<o;i++){const e=Array.isArray(t[i])?t[i]:[t[i]];for(let t=0,a=e.length;t<a;t++){const a=e[t],i=Array.isArray(a.value)?a.value:[a.value];for(let e=0,t=i.length;e<t;e++){const t=u(i[e]),o=n%r,s=o%t.boundary,c=o+s;n+=s,0!==c&&r-c<t.storage&&(n+=r-c),a.__data=new Float32Array(t.storage/Float32Array.BYTES_PER_ELEMENT),a.__offset=n,n+=t.storage}}}const a=n%r;a>0&&(n+=r-a);e.__size=n,e.__cache={}}(n),d=function(t){const n=function(){for(let e=0;e<s;e++)if(-1===o.indexOf(e))return o.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;const r=e.createBuffer(),a=t.__size,i=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,r),e.bufferData(e.UNIFORM_BUFFER,a,i),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,r),r}(n),a[n.id]=d,n.addEventListener("dispose",l));const h=f.program;r.updateUBOMapping(n,h);const p=t.render.frame;i[n.id]!==p&&(!function(t){const n=a[t.id],r=t.uniforms,i=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(let a=0,o=r.length;a<o;a++){const t=Array.isArray(r[a])?r[a]:[r[a]];for(let n=0,r=t.length;n<r;n++){const r=t[n];if(!0===c(r,a,n,i)){const t=r.__offset,n=Array.isArray(r.value)?r.value:[r.value];let a=0;for(let i=0;i<n.length;i++){const o=n[i],s=u(o);"number"===typeof o||"boolean"===typeof o?(r.__data[0]=o,e.bufferSubData(e.UNIFORM_BUFFER,t+a,r.__data)):o.isMatrix3?(r.__data[0]=o.elements[0],r.__data[1]=o.elements[1],r.__data[2]=o.elements[2],r.__data[3]=0,r.__data[4]=o.elements[3],r.__data[5]=o.elements[4],r.__data[6]=o.elements[5],r.__data[7]=0,r.__data[8]=o.elements[6],r.__data[9]=o.elements[7],r.__data[10]=o.elements[8],r.__data[11]=0):(o.toArray(r.__data,a),a+=s.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,r.__data)}}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),i[n.id]=p)},dispose:function(){for(const t in a)e.deleteBuffer(a[t]);o=[],a={},i={}}}}class $de{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{canvas:t=Mie(),context:n=null,depth:r=!0,stencil:a=!1,alpha:i=!1,antialias:o=!1,premultipliedAlpha:s=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:l=!1,reverseDepthBuffer:f=!1}=e;let d;if(this.isWebGLRenderer=!0,null!==n){if("undefined"!==typeof WebGLRenderingContext&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");d=n.getContextAttributes().alpha}else d=i;const h=new Uint32Array(4),p=new Int32Array(4);let g=null,m=null;const v=[],b=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Vae,this.toneMapping=0,this.toneMappingExposure=1;const y=this;let x=!1,w=0,S=0,C=null,M=-1,_=null;const E=new Bie,T=new Bie;let I=null;const k=new pse(0);let N=0,L=t.width,A=t.height,R=1,D=null,O=null;const P=new Bie(0,0,L,A),F=new Bie(0,0,L,A);let z=!1;const j=new Uce;let B=!1,U=!1;this.transmissionResolutionScale=1;const W=new Soe,G=new Soe,V=new Yie,H=new Bie,Y={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let X=!1;function q(){return null===C?R:1}let K,Q,J,Z,$,ee,te,ne,re,ae,ie,oe,se,ce,ue,le,fe,de,he,pe,ge,me,ve,be,ye=n;function xe(e,n){return t.getContext(e,n)}try{const e={alpha:!0,depth:r,stencil:a,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:l};if("setAttribute"in t&&t.setAttribute("data-engine","three.js r".concat(Kne)),t.addEventListener("webglcontextlost",Ce,!1),t.addEventListener("webglcontextrestored",Me,!1),t.addEventListener("webglcontextcreationerror",_e,!1),null===ye){const t="webgl2";if(ye=xe(t,e),null===ye)throw xe(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(Ge){throw console.error("THREE.WebGLRenderer: "+Ge.message),Ge}function we(){K=new qle(ye),K.init(),me=new Vde(ye,K),Q=new Ile(ye,K,e,me),J=new Wde(ye,K),Q.reverseDepthBuffer&&f&&J.buffers.depth.setReversed(!0),Z=new Jle(ye),$=new kde,ee=new Gde(ye,K,J,$,Q,me,Z),te=new Nle(y),ne=new Xle(y),re=new ble(ye),ve=new Ele(ye,re),ae=new Kle(ye,re,Z,ve),ie=new $le(ye,ae,re,Z),he=new Zle(ye,Q,ee),le=new kle($),oe=new Ide(y,te,ne,K,Q,ve,le),se=new Jde(y,$),ce=new Rde,ue=new jde(K),de=new _le(y,te,ne,J,ie,d,s),fe=new Bde(y,ie,Q),be=new Zde(ye,Z,Q,J),pe=new Tle(ye,K,Z),ge=new Qle(ye,K,Z),Z.programs=oe.programs,y.capabilities=Q,y.extensions=K,y.properties=$,y.renderLists=ce,y.shadowMap=fe,y.state=J,y.info=Z}we();const Se=new qde(y,ye);function Ce(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),x=!0}function Me(){console.log("THREE.WebGLRenderer: Context Restored."),x=!1;const e=Z.autoReset,t=fe.enabled,n=fe.autoUpdate,r=fe.needsUpdate,a=fe.type;we(),Z.autoReset=e,fe.enabled=t,fe.autoUpdate=n,fe.needsUpdate=r,fe.type=a}function _e(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Ee(e){const t=e.target;t.removeEventListener("dispose",Ee),function(e){(function(e){const t=$.get(e).programs;void 0!==t&&(t.forEach((function(e){oe.releaseProgram(e)})),e.isShaderMaterial&&oe.releaseShaderCache(e))})(e),$.remove(e)}(t)}function Te(e,t,n){!0===e.transparent&&2===e.side&&!1===e.forceSinglePass?(e.side=1,e.needsUpdate=!0,Fe(e,t,n),e.side=0,e.needsUpdate=!0,Fe(e,t,n),e.side=2):Fe(e,t,n)}this.xr=Se,this.getContext=function(){return ye},this.getContextAttributes=function(){return ye.getContextAttributes()},this.forceContextLoss=function(){const e=K.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=K.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return R},this.setPixelRatio=function(e){void 0!==e&&(R=e,this.setSize(L,A,!1))},this.getSize=function(e){return e.set(L,A)},this.setSize=function(e,n){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];Se.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(L=e,A=n,t.width=Math.floor(e*R),t.height=Math.floor(n*R),!0===r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(L*R,A*R).floor()},this.setDrawingBufferSize=function(e,n,r){L=e,A=n,R=r,t.width=Math.floor(e*r),t.height=Math.floor(n*r),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(E)},this.getViewport=function(e){return e.copy(P)},this.setViewport=function(e,t,n,r){e.isVector4?P.set(e.x,e.y,e.z,e.w):P.set(e,t,n,r),J.viewport(E.copy(P).multiplyScalar(R).round())},this.getScissor=function(e){return e.copy(F)},this.setScissor=function(e,t,n,r){e.isVector4?F.set(e.x,e.y,e.z,e.w):F.set(e,t,n,r),J.scissor(T.copy(F).multiplyScalar(R).round())},this.getScissorTest=function(){return z},this.setScissorTest=function(e){J.setScissorTest(z=e)},this.setOpaqueSort=function(e){D=e},this.setTransparentSort=function(e){O=e},this.getClearColor=function(e){return e.copy(de.getClearColor())},this.setClearColor=function(){de.setClearColor.apply(de,arguments)},this.getClearAlpha=function(){return de.getClearAlpha()},this.setClearAlpha=function(){de.setClearAlpha.apply(de,arguments)},this.clear=function(){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=0;if(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]){let e=!1;if(null!==C){const t=C.texture.format;e=t===aae||t===rae||t===nae}if(e){const e=C.texture.type,t=e===Bre||e===Hre||e===Gre||e===Qre||e===qre||e===Kre,n=de.getClearColor(),r=de.getClearAlpha(),a=n.r,i=n.g,o=n.b;t?(h[0]=a,h[1]=i,h[2]=o,h[3]=r,ye.clearBufferuiv(ye.COLOR,0,h)):(p[0]=a,p[1]=i,p[2]=o,p[3]=r,ye.clearBufferiv(ye.COLOR,0,p))}else n|=ye.COLOR_BUFFER_BIT}e&&(n|=ye.DEPTH_BUFFER_BIT),t&&(n|=ye.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ye.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ce,!1),t.removeEventListener("webglcontextrestored",Me,!1),t.removeEventListener("webglcontextcreationerror",_e,!1),de.dispose(),ce.dispose(),ue.dispose(),$.dispose(),te.dispose(),ne.dispose(),ie.dispose(),ve.dispose(),be.dispose(),oe.dispose(),Se.dispose(),Se.removeEventListener("sessionstart",ke),Se.removeEventListener("sessionend",Ne),Le.stop()},this.renderBufferDirect=function(e,t,n,r,a,i){null===t&&(t=Y);const o=a.isMesh&&a.matrixWorld.determinant()<0,s=function(e,t,n,r,a){!0!==t.isScene&&(t=Y);ee.resetTextureUnits();const i=t.fog,o=r.isMeshStandardMaterial?t.environment:null,s=null===C?y.outputColorSpace:!0===C.isXRRenderTarget?C.texture.colorSpace:Hae,c=(r.isMeshStandardMaterial?ne:te).get(r.envMap||o),u=!0===r.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,l=!!n.attributes.tangent&&(!!r.normalMap||r.anisotropy>0),f=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,h=!!n.morphAttributes.color;let p=0;r.toneMapped&&(null!==C&&!0!==C.isXRRenderTarget||(p=y.toneMapping));const g=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,v=void 0!==g?g.length:0,b=$.get(r),x=m.state.lights;if(!0===B&&(!0===U||e!==_)){const t=e===_&&r.id===M;le.setState(r,e,t)}let w=!1;r.version===b.__version?b.needsLights&&b.lightsStateVersion!==x.state.version||b.outputColorSpace!==s||a.isBatchedMesh&&!1===b.batching?w=!0:a.isBatchedMesh||!0!==b.batching?a.isBatchedMesh&&!0===b.batchingColor&&null===a.colorTexture||a.isBatchedMesh&&!1===b.batchingColor&&null!==a.colorTexture||a.isInstancedMesh&&!1===b.instancing?w=!0:a.isInstancedMesh||!0!==b.instancing?a.isSkinnedMesh&&!1===b.skinning?w=!0:a.isSkinnedMesh||!0!==b.skinning?a.isInstancedMesh&&!0===b.instancingColor&&null===a.instanceColor||a.isInstancedMesh&&!1===b.instancingColor&&null!==a.instanceColor||a.isInstancedMesh&&!0===b.instancingMorph&&null===a.morphTexture||a.isInstancedMesh&&!1===b.instancingMorph&&null!==a.morphTexture||b.envMap!==c||!0===r.fog&&b.fog!==i?w=!0:void 0===b.numClippingPlanes||b.numClippingPlanes===le.numPlanes&&b.numIntersection===le.numIntersection?(b.vertexAlphas!==u||b.vertexTangents!==l||b.morphTargets!==f||b.morphNormals!==d||b.morphColors!==h||b.toneMapping!==p||b.morphTargetsCount!==v)&&(w=!0):w=!0:w=!0:w=!0:w=!0:(w=!0,b.__version=r.version);let S=b.currentProgram;!0===w&&(S=Fe(r,t,a));let E=!1,T=!1,I=!1;const k=S.getUniforms(),N=b.uniforms;J.useProgram(S.program)&&(E=!0,T=!0,I=!0);r.id!==M&&(M=r.id,T=!0);if(E||_!==e){J.buffers.depth.getReversed()?(W.copy(e.projectionMatrix),function(e){const t=e.elements;t[2]=.5*t[2]+.5*t[3],t[6]=.5*t[6]+.5*t[7],t[10]=.5*t[10]+.5*t[11],t[14]=.5*t[14]+.5*t[15]}(W),function(e){const t=e.elements;-1===t[11]?(t[10]=-t[10]-1,t[14]=-t[14]):(t[10]=-t[10],t[14]=1-t[14])}(W),k.setValue(ye,"projectionMatrix",W)):k.setValue(ye,"projectionMatrix",e.projectionMatrix),k.setValue(ye,"viewMatrix",e.matrixWorldInverse);const t=k.map.cameraPosition;void 0!==t&&t.setValue(ye,V.setFromMatrixPosition(e.matrixWorld)),Q.logarithmicDepthBuffer&&k.setValue(ye,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&k.setValue(ye,"isOrthographic",!0===e.isOrthographicCamera),_!==e&&(_=e,T=!0,I=!0)}if(a.isSkinnedMesh){k.setOptional(ye,a,"bindMatrix"),k.setOptional(ye,a,"bindMatrixInverse");const e=a.skeleton;e&&(null===e.boneTexture&&e.computeBoneTexture(),k.setValue(ye,"boneTexture",e.boneTexture,ee))}a.isBatchedMesh&&(k.setOptional(ye,a,"batchingTexture"),k.setValue(ye,"batchingTexture",a._matricesTexture,ee),k.setOptional(ye,a,"batchingIdTexture"),k.setValue(ye,"batchingIdTexture",a._indirectTexture,ee),k.setOptional(ye,a,"batchingColorTexture"),null!==a._colorsTexture&&k.setValue(ye,"batchingColorTexture",a._colorsTexture,ee));const L=n.morphAttributes;void 0===L.position&&void 0===L.normal&&void 0===L.color||he.update(a,n,S);(T||b.receiveShadow!==a.receiveShadow)&&(b.receiveShadow=a.receiveShadow,k.setValue(ye,"receiveShadow",a.receiveShadow));r.isMeshGouraudMaterial&&null!==r.envMap&&(N.envMap.value=c,N.flipEnvMap.value=c.isCubeTexture&&!1===c.isRenderTargetTexture?-1:1);r.isMeshStandardMaterial&&null===r.envMap&&null!==t.environment&&(N.envMapIntensity.value=t.environmentIntensity);T&&(k.setValue(ye,"toneMappingExposure",y.toneMappingExposure),b.needsLights&&function(e,t){e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.directionalLightShadows.needsUpdate=t,e.pointLights.needsUpdate=t,e.pointLightShadows.needsUpdate=t,e.spotLights.needsUpdate=t,e.spotLightShadows.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}(N,I),i&&!0===r.fog&&se.refreshFogUniforms(N,i),se.refreshMaterialUniforms(N,r,R,A,m.state.transmissionRenderTarget[e.id]),ade.upload(ye,ze(b),N,ee));r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(ade.upload(ye,ze(b),N,ee),r.uniformsNeedUpdate=!1);r.isSpriteMaterial&&k.setValue(ye,"center",a.center);if(k.setValue(ye,"modelViewMatrix",a.modelViewMatrix),k.setValue(ye,"normalMatrix",a.normalMatrix),k.setValue(ye,"modelMatrix",a.matrixWorld),r.isShaderMaterial||r.isRawShaderMaterial){const e=r.uniformsGroups;for(let t=0,n=e.length;t<n;t++){const n=e[t];be.update(n,S),be.bind(n,S)}}return S}(e,t,n,r,a);J.setMaterial(r,o);let c=n.index,u=1;if(!0===r.wireframe){if(c=ae.getWireframeAttribute(n),void 0===c)return;u=2}const l=n.drawRange,f=n.attributes.position;let d=l.start*u,h=(l.start+l.count)*u;null!==i&&(d=Math.max(d,i.start*u),h=Math.min(h,(i.start+i.count)*u)),null!==c?(d=Math.max(d,0),h=Math.min(h,c.count)):void 0!==f&&null!==f&&(d=Math.max(d,0),h=Math.min(h,f.count));const p=h-d;if(p<0||p===1/0)return;let g;ve.setup(a,r,s,n,c);let v=pe;if(null!==c&&(g=re.get(c),v=ge,v.setIndex(g)),a.isMesh)!0===r.wireframe?(J.setLineWidth(r.wireframeLinewidth*q()),v.setMode(ye.LINES)):v.setMode(ye.TRIANGLES);else if(a.isLine){let e=r.linewidth;void 0===e&&(e=1),J.setLineWidth(e*q()),a.isLineSegments?v.setMode(ye.LINES):a.isLineLoop?v.setMode(ye.LINE_LOOP):v.setMode(ye.LINE_STRIP)}else a.isPoints?v.setMode(ye.POINTS):a.isSprite&&v.setMode(ye.TRIANGLES);if(a.isBatchedMesh)if(null!==a._multiDrawInstances)v.renderMultiDrawInstances(a._multiDrawStarts,a._multiDrawCounts,a._multiDrawCount,a._multiDrawInstances);else if(K.get("WEBGL_multi_draw"))v.renderMultiDraw(a._multiDrawStarts,a._multiDrawCounts,a._multiDrawCount);else{const e=a._multiDrawStarts,t=a._multiDrawCounts,n=a._multiDrawCount,i=c?re.get(c).bytesPerElement:1,o=$.get(r).currentProgram.getUniforms();for(let r=0;r<n;r++)o.setValue(ye,"_gl_DrawID",r),v.render(e[r]/i,t[r])}else if(a.isInstancedMesh)v.renderInstances(d,p,a.count);else if(n.isInstancedBufferGeometry){const e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);v.renderInstances(d,p,t)}else v.render(d,p)},this.compile=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===n&&(n=e),m=ue.get(n),m.init(t),b.push(m),n.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(m.pushLight(e),e.castShadow&&m.pushShadow(e))})),e!==n&&e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(m.pushLight(e),e.castShadow&&m.pushShadow(e))})),m.setupLights();const r=new Set;return e.traverse((function(e){if(!(e.isMesh||e.isPoints||e.isLine||e.isSprite))return;const t=e.material;if(t)if(Array.isArray(t))for(let a=0;a<t.length;a++){const i=t[a];Te(i,n,e),r.add(i)}else Te(t,n,e),r.add(t)})),b.pop(),m=null,r},this.compileAsync=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=this.compile(e,t,n);return new Promise((t=>{function n(){r.forEach((function(e){$.get(e).currentProgram.isReady()&&r.delete(e)})),0!==r.size?setTimeout(n,10):t(e)}null!==K.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)}))};let Ie=null;function ke(){Le.stop()}function Ne(){Le.start()}const Le=new vle;function Ae(e,t,n,r){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)m.pushLight(e),e.castShadow&&m.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||j.intersectsSprite(e)){r&&H.setFromMatrixPosition(e.matrixWorld).applyMatrix4(G);const t=ie.update(e),a=e.material;a.visible&&g.push(e,t,a,n,H.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||j.intersectsObject(e))){const t=ie.update(e),a=e.material;if(r&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),H.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),H.copy(t.boundingSphere.center)),H.applyMatrix4(e.matrixWorld).applyMatrix4(G)),Array.isArray(a)){const r=t.groups;for(let i=0,o=r.length;i<o;i++){const o=r[i],s=a[o.materialIndex];s&&s.visible&&g.push(e,t,s,n,H.z,o)}}else a.visible&&g.push(e,t,a,n,H.z,null)}const a=e.children;for(let i=0,o=a.length;i<o;i++)Ae(a[i],t,n,r)}function Re(e,t,n,r){const a=e.opaque,i=e.transmissive,o=e.transparent;m.setupLightsView(n),!0===B&&le.setGlobalState(y.clippingPlanes,n),r&&J.viewport(E.copy(r)),a.length>0&&Oe(a,t,n),i.length>0&&Oe(i,t,n),o.length>0&&Oe(o,t,n),J.buffers.depth.setTest(!0),J.buffers.depth.setMask(!0),J.buffers.color.setMask(!0),J.setPolygonOffset(!1)}function De(e,t,n,r){if(null!==(!0===n.isScene?n.overrideMaterial:null))return;void 0===m.state.transmissionRenderTarget[r.id]&&(m.state.transmissionRenderTarget[r.id]=new Wie(1,1,{generateMipmaps:!0,type:K.has("EXT_color_buffer_half_float")||K.has("EXT_color_buffer_float")?Xre:Bre,minFilter:jre,samples:4,stencilBuffer:a,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Nie.workingColorSpace}));const i=m.state.transmissionRenderTarget[r.id],o=r.viewport||E;i.setSize(o.z*y.transmissionResolutionScale,o.w*y.transmissionResolutionScale);const s=y.getRenderTarget();y.setRenderTarget(i),y.getClearColor(k),N=y.getClearAlpha(),N<1&&y.setClearColor(16777215,.5),y.clear(),X&&de.render(n);const c=y.toneMapping;y.toneMapping=0;const u=r.viewport;if(void 0!==r.viewport&&(r.viewport=void 0),m.setupLightsView(r),!0===B&&le.setGlobalState(y.clippingPlanes,r),Oe(e,n,r),ee.updateMultisampleRenderTarget(i),ee.updateRenderTargetMipmap(i),!1===K.has("WEBGL_multisampled_render_to_texture")){let e=!1;for(let a=0,i=t.length;a<i;a++){const i=t[a],o=i.object,s=i.geometry,c=i.material,u=i.group;if(2===c.side&&o.layers.test(r.layers)){const t=c.side;c.side=1,c.needsUpdate=!0,Pe(o,n,r,s,c,u),c.side=t,c.needsUpdate=!0,e=!0}}!0===e&&(ee.updateMultisampleRenderTarget(i),ee.updateRenderTargetMipmap(i))}y.setRenderTarget(s),y.setClearColor(k,N),void 0!==u&&(r.viewport=u),y.toneMapping=c}function Oe(e,t,n){const r=!0===t.isScene?t.overrideMaterial:null;for(let a=0,i=e.length;a<i;a++){const i=e[a],o=i.object,s=i.geometry,c=null===r?i.material:r,u=i.group;o.layers.test(n.layers)&&Pe(o,t,n,s,c,u)}}function Pe(e,t,n,r,a,i){e.onBeforeRender(y,t,n,r,a,i),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),a.onBeforeRender(y,t,n,r,e,i),!0===a.transparent&&2===a.side&&!1===a.forceSinglePass?(a.side=1,a.needsUpdate=!0,y.renderBufferDirect(n,t,r,a,e,i),a.side=0,a.needsUpdate=!0,y.renderBufferDirect(n,t,r,a,e,i),a.side=2):y.renderBufferDirect(n,t,r,a,e,i),e.onAfterRender(y,t,n,r,a,i)}function Fe(e,t,n){!0!==t.isScene&&(t=Y);const r=$.get(e),a=m.state.lights,i=m.state.shadowsArray,o=a.state.version,s=oe.getParameters(e,a.state,i,t,n),c=oe.getProgramCacheKey(s);let u=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?ne:te).get(e.envMap||r.environment),r.envMapRotation=null!==r.environment&&null===e.envMap?t.environmentRotation:e.envMapRotation,void 0===u&&(e.addEventListener("dispose",Ee),u=new Map,r.programs=u);let l=u.get(c);if(void 0!==l){if(r.currentProgram===l&&r.lightsStateVersion===o)return je(e,s),l}else s.uniforms=oe.getUniforms(e),e.onBeforeCompile(s,y),l=oe.acquireProgram(s,c),u.set(c,l),r.uniforms=s.uniforms;const f=r.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(f.clippingPlanes=le.uniform),je(e,s),r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=o,r.needsLights&&(f.ambientLightColor.value=a.state.ambient,f.lightProbe.value=a.state.probe,f.directionalLights.value=a.state.directional,f.directionalLightShadows.value=a.state.directionalShadow,f.spotLights.value=a.state.spot,f.spotLightShadows.value=a.state.spotShadow,f.rectAreaLights.value=a.state.rectArea,f.ltc_1.value=a.state.rectAreaLTC1,f.ltc_2.value=a.state.rectAreaLTC2,f.pointLights.value=a.state.point,f.pointLightShadows.value=a.state.pointShadow,f.hemisphereLights.value=a.state.hemi,f.directionalShadowMap.value=a.state.directionalShadowMap,f.directionalShadowMatrix.value=a.state.directionalShadowMatrix,f.spotShadowMap.value=a.state.spotShadowMap,f.spotLightMatrix.value=a.state.spotLightMatrix,f.spotLightMap.value=a.state.spotLightMap,f.pointShadowMap.value=a.state.pointShadowMap,f.pointShadowMatrix.value=a.state.pointShadowMatrix),r.currentProgram=l,r.uniformsList=null,l}function ze(e){if(null===e.uniformsList){const t=e.currentProgram.getUniforms();e.uniformsList=ade.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function je(e,t){const n=$.get(e);n.outputColorSpace=t.outputColorSpace,n.batching=t.batching,n.batchingColor=t.batchingColor,n.instancing=t.instancing,n.instancingColor=t.instancingColor,n.instancingMorph=t.instancingMorph,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}Le.setAnimationLoop((function(e){Ie&&Ie(e)})),"undefined"!==typeof self&&Le.setContext(self),this.setAnimationLoop=function(e){Ie=e,Se.setAnimationLoop(e),null===e?Le.stop():Le.start()},Se.addEventListener("sessionstart",ke),Se.addEventListener("sessionend",Ne),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===x)return;if(!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===Se.enabled&&!0===Se.isPresenting&&(!0===Se.cameraAutoUpdate&&Se.updateCamera(t),t=Se.getCamera()),!0===e.isScene&&e.onBeforeRender(y,e,t,C),m=ue.get(e,b.length),m.init(t),b.push(m),G.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),j.setFromProjectionMatrix(G),U=this.localClippingEnabled,B=le.init(this.clippingPlanes,U),g=ce.get(e,v.length),g.init(),v.push(g),!0===Se.enabled&&!0===Se.isPresenting){const e=y.xr.getDepthSensingMesh();null!==e&&Ae(e,t,-1/0,y.sortObjects)}Ae(e,t,0,y.sortObjects),g.finish(),!0===y.sortObjects&&g.sort(D,O),X=!1===Se.enabled||!1===Se.isPresenting||!1===Se.hasDepthSensing(),X&&de.addToRenderList(g,e),this.info.render.frame++,!0===B&&le.beginShadows();const n=m.state.shadowsArray;fe.render(n,e,t),!0===B&&le.endShadows(),!0===this.info.autoReset&&this.info.reset();const r=g.opaque,a=g.transmissive;if(m.setupLights(),t.isArrayCamera){const n=t.cameras;if(a.length>0)for(let t=0,i=n.length;t<i;t++){De(r,a,e,n[t])}X&&de.render(e);for(let t=0,r=n.length;t<r;t++){const r=n[t];Re(g,e,r,r.viewport)}}else a.length>0&&De(r,a,e,t),X&&de.render(e),Re(g,e,t);null!==C&&0===S&&(ee.updateMultisampleRenderTarget(C),ee.updateRenderTargetMipmap(C)),!0===e.isScene&&e.onAfterRender(y,e,t),ve.resetDefaultState(),M=-1,_=null,b.pop(),b.length>0?(m=b[b.length-1],!0===B&&le.setGlobalState(y.clippingPlanes,m.state.camera)):m=null,v.pop(),g=v.length>0?v[v.length-1]:null},this.getActiveCubeFace=function(){return w},this.getActiveMipmapLevel=function(){return S},this.getRenderTarget=function(){return C},this.setRenderTargetTextures=function(e,t,n){$.get(e.texture).__webglTexture=t,$.get(e.depthTexture).__webglTexture=n;const r=$.get(e);r.__hasExternalTextures=!0,r.__autoAllocateDepthBuffer=void 0===n,r.__autoAllocateDepthBuffer||!0===K.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),r.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(e,t){const n=$.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t};const Be=ye.createFramebuffer();this.setRenderTarget=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;C=e,w=t,S=n;let r=!0,a=null,i=!1,o=!1;if(e){const s=$.get(e);if(void 0!==s.__useDefaultFramebuffer)J.bindFramebuffer(ye.FRAMEBUFFER,null),r=!1;else if(void 0===s.__webglFramebuffer)ee.setupRenderTarget(e);else if(s.__hasExternalTextures)ee.rebindTextures(e,$.get(e.texture).__webglTexture,$.get(e.depthTexture).__webglTexture);else if(e.depthBuffer){const t=e.depthTexture;if(s.__boundDepthTexture!==t){if(null!==t&&$.has(t)&&(e.width!==t.image.width||e.height!==t.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");ee.setupDepthRenderbuffer(e)}}const c=e.texture;(c.isData3DTexture||c.isDataArrayTexture||c.isCompressedArrayTexture)&&(o=!0);const u=$.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(a=Array.isArray(u[t])?u[t][n]:u[t],i=!0):a=e.samples>0&&!1===ee.useMultisampledRTT(e)?$.get(e).__webglMultisampledFramebuffer:Array.isArray(u)?u[n]:u,E.copy(e.viewport),T.copy(e.scissor),I=e.scissorTest}else E.copy(P).multiplyScalar(R).floor(),T.copy(F).multiplyScalar(R).floor(),I=z;0!==n&&(a=Be);if(J.bindFramebuffer(ye.FRAMEBUFFER,a)&&r&&J.drawBuffers(e,a),J.viewport(E),J.scissor(T),J.setScissorTest(I),i){const r=$.get(e.texture);ye.framebufferTexture2D(ye.FRAMEBUFFER,ye.COLOR_ATTACHMENT0,ye.TEXTURE_CUBE_MAP_POSITIVE_X+t,r.__webglTexture,n)}else if(o){const r=$.get(e.texture),a=t;ye.framebufferTextureLayer(ye.FRAMEBUFFER,ye.COLOR_ATTACHMENT0,r.__webglTexture,n,a)}else if(null!==e&&0!==n){const t=$.get(e.texture);ye.framebufferTexture2D(ye.FRAMEBUFFER,ye.COLOR_ATTACHMENT0,ye.TEXTURE_2D,t.__webglTexture,n)}M=-1},this.readRenderTargetPixels=function(e,t,n,r,a,i,o){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let s=$.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(s=s[o]),s){J.bindFramebuffer(ye.FRAMEBUFFER,s);try{const o=e.texture,s=o.format,c=o.type;if(!Q.textureFormatReadable(s))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!Q.textureTypeReadable(c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-r&&n>=0&&n<=e.height-a&&ye.readPixels(t,n,r,a,me.convert(s),me.convert(c),i)}finally{const e=null!==C?$.get(C).__webglFramebuffer:null;J.bindFramebuffer(ye.FRAMEBUFFER,e)}}},this.readRenderTargetPixelsAsync=async function(e,t,n,r,a,i,o){if(!e||!e.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let s=$.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(s=s[o]),s){const o=e.texture,c=o.format,u=o.type;if(!Q.textureFormatReadable(c))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Q.textureTypeReadable(u))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(t>=0&&t<=e.width-r&&n>=0&&n<=e.height-a){J.bindFramebuffer(ye.FRAMEBUFFER,s);const e=ye.createBuffer();ye.bindBuffer(ye.PIXEL_PACK_BUFFER,e),ye.bufferData(ye.PIXEL_PACK_BUFFER,i.byteLength,ye.STREAM_READ),ye.readPixels(t,n,r,a,me.convert(c),me.convert(u),0);const o=null!==C?$.get(C).__webglFramebuffer:null;J.bindFramebuffer(ye.FRAMEBUFFER,o);const l=ye.fenceSync(ye.SYNC_GPU_COMMANDS_COMPLETE,0);return ye.flush(),await function(e,t,n){return new Promise((function(r,a){setTimeout((function i(){switch(e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:a();break;case e.TIMEOUT_EXPIRED:setTimeout(i,n);break;default:r()}}),n)}))}(ye,l,4),ye.bindBuffer(ye.PIXEL_PACK_BUFFER,e),ye.getBufferSubData(ye.PIXEL_PACK_BUFFER,0,i),ye.deleteBuffer(e),ye.deleteSync(l),i}throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;!0!==e.isTexture&&(Eie("WebGLRenderer: copyFramebufferToTexture function signature has changed."),t=arguments[0]||null,e=arguments[1]);const r=Math.pow(2,-n),a=Math.floor(e.image.width*r),i=Math.floor(e.image.height*r),o=null!==t?t.x:0,s=null!==t?t.y:0;ee.setTexture2D(e,0),ye.copyTexSubImage2D(ye.TEXTURE_2D,n,0,0,o,s,a,i),J.unbindTexture()};const Ue=ye.createFramebuffer(),We=ye.createFramebuffer();this.copyTextureToTexture=function(e,t){let n,r,a,i,o,s,c,u,l,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;!0!==e.isTexture&&(Eie("WebGLRenderer: copyTextureToTexture function signature has changed."),d=arguments[0]||null,e=arguments[1],t=arguments[2],p=arguments[3]||0,f=null),null===p&&(0!==h?(Eie("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),p=h,h=0):p=0);const g=e.isCompressedTexture?e.mipmaps[p]:e.image;if(null!==f)n=f.max.x-f.min.x,r=f.max.y-f.min.y,a=f.isBox3?f.max.z-f.min.z:1,i=f.min.x,o=f.min.y,s=f.isBox3?f.min.z:0;else{const t=Math.pow(2,-h);n=Math.floor(g.width*t),r=Math.floor(g.height*t),a=e.isDataArrayTexture?g.depth:e.isData3DTexture?Math.floor(g.depth*t):1,i=0,o=0,s=0}null!==d?(c=d.x,u=d.y,l=d.z):(c=0,u=0,l=0);const m=me.convert(t.format),v=me.convert(t.type);let b;t.isData3DTexture?(ee.setTexture3D(t,0),b=ye.TEXTURE_3D):t.isDataArrayTexture||t.isCompressedArrayTexture?(ee.setTexture2DArray(t,0),b=ye.TEXTURE_2D_ARRAY):(ee.setTexture2D(t,0),b=ye.TEXTURE_2D),ye.pixelStorei(ye.UNPACK_FLIP_Y_WEBGL,t.flipY),ye.pixelStorei(ye.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),ye.pixelStorei(ye.UNPACK_ALIGNMENT,t.unpackAlignment);const y=ye.getParameter(ye.UNPACK_ROW_LENGTH),x=ye.getParameter(ye.UNPACK_IMAGE_HEIGHT),w=ye.getParameter(ye.UNPACK_SKIP_PIXELS),S=ye.getParameter(ye.UNPACK_SKIP_ROWS),C=ye.getParameter(ye.UNPACK_SKIP_IMAGES);ye.pixelStorei(ye.UNPACK_ROW_LENGTH,g.width),ye.pixelStorei(ye.UNPACK_IMAGE_HEIGHT,g.height),ye.pixelStorei(ye.UNPACK_SKIP_PIXELS,i),ye.pixelStorei(ye.UNPACK_SKIP_ROWS,o),ye.pixelStorei(ye.UNPACK_SKIP_IMAGES,s);const M=e.isDataArrayTexture||e.isData3DTexture,_=t.isDataArrayTexture||t.isData3DTexture;if(e.isDepthTexture){const f=$.get(e),d=$.get(t),g=$.get(f.__renderTarget),m=$.get(d.__renderTarget);J.bindFramebuffer(ye.READ_FRAMEBUFFER,g.__webglFramebuffer),J.bindFramebuffer(ye.DRAW_FRAMEBUFFER,m.__webglFramebuffer);for(let v=0;v<a;v++)M&&(ye.framebufferTextureLayer(ye.READ_FRAMEBUFFER,ye.COLOR_ATTACHMENT0,$.get(e).__webglTexture,h,s+v),ye.framebufferTextureLayer(ye.DRAW_FRAMEBUFFER,ye.COLOR_ATTACHMENT0,$.get(t).__webglTexture,p,l+v)),ye.blitFramebuffer(i,o,n,r,c,u,n,r,ye.DEPTH_BUFFER_BIT,ye.NEAREST);J.bindFramebuffer(ye.READ_FRAMEBUFFER,null),J.bindFramebuffer(ye.DRAW_FRAMEBUFFER,null)}else if(0!==h||e.isRenderTargetTexture||$.has(e)){const f=$.get(e),d=$.get(t);J.bindFramebuffer(ye.READ_FRAMEBUFFER,Ue),J.bindFramebuffer(ye.DRAW_FRAMEBUFFER,We);for(let e=0;e<a;e++)M?ye.framebufferTextureLayer(ye.READ_FRAMEBUFFER,ye.COLOR_ATTACHMENT0,f.__webglTexture,h,s+e):ye.framebufferTexture2D(ye.READ_FRAMEBUFFER,ye.COLOR_ATTACHMENT0,ye.TEXTURE_2D,f.__webglTexture,h),_?ye.framebufferTextureLayer(ye.DRAW_FRAMEBUFFER,ye.COLOR_ATTACHMENT0,d.__webglTexture,p,l+e):ye.framebufferTexture2D(ye.DRAW_FRAMEBUFFER,ye.COLOR_ATTACHMENT0,ye.TEXTURE_2D,d.__webglTexture,p),0!==h?ye.blitFramebuffer(i,o,n,r,c,u,n,r,ye.COLOR_BUFFER_BIT,ye.NEAREST):_?ye.copyTexSubImage3D(b,p,c,u,l+e,i,o,n,r):ye.copyTexSubImage2D(b,p,c,u,i,o,n,r);J.bindFramebuffer(ye.READ_FRAMEBUFFER,null),J.bindFramebuffer(ye.DRAW_FRAMEBUFFER,null)}else _?e.isDataTexture||e.isData3DTexture?ye.texSubImage3D(b,p,c,u,l,n,r,a,m,v,g.data):t.isCompressedArrayTexture?ye.compressedTexSubImage3D(b,p,c,u,l,n,r,a,m,g.data):ye.texSubImage3D(b,p,c,u,l,n,r,a,m,v,g):e.isDataTexture?ye.texSubImage2D(ye.TEXTURE_2D,p,c,u,n,r,m,v,g.data):e.isCompressedTexture?ye.compressedTexSubImage2D(ye.TEXTURE_2D,p,c,u,g.width,g.height,m,g.data):ye.texSubImage2D(ye.TEXTURE_2D,p,c,u,n,r,m,v,g);ye.pixelStorei(ye.UNPACK_ROW_LENGTH,y),ye.pixelStorei(ye.UNPACK_IMAGE_HEIGHT,x),ye.pixelStorei(ye.UNPACK_SKIP_PIXELS,w),ye.pixelStorei(ye.UNPACK_SKIP_ROWS,S),ye.pixelStorei(ye.UNPACK_SKIP_IMAGES,C),0===p&&t.generateMipmaps&&ye.generateMipmap(b),J.unbindTexture()},this.copyTextureToTexture3D=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return!0!==e.isTexture&&(Eie("WebGLRenderer: copyTextureToTexture3D function signature has changed."),n=arguments[0]||null,r=arguments[1]||null,e=arguments[2],t=arguments[3],a=arguments[4]||0),Eie('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(e,t,n,r,a)},this.initRenderTarget=function(e){void 0===$.get(e).__webglFramebuffer&&ee.setupRenderTarget(e)},this.initTexture=function(e){e.isCubeTexture?ee.setTextureCube(e,0):e.isData3DTexture?ee.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?ee.setTexture2DArray(e,0):ee.setTexture2D(e,0),J.unbindTexture()},this.resetState=function(){w=0,S=0,C=null,J.reset(),ve.reset()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return iie}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorspace=Nie._getDrawingBufferColorSpace(e),t.unpackColorSpace=Nie._getUnpackColorSpace()}}function ehe(e,t){if(0===t)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(2===t||1===t){let n=e.getIndex();if(null===n){const t=[],r=e.getAttribute("position");if(void 0===r)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<r.count;e++)t.push(e);e.setIndex(t),n=e.getIndex()}const r=n.count-2,a=[];if(2===t)for(let e=1;e<=r;e++)a.push(n.getX(0)),a.push(n.getX(e)),a.push(n.getX(e+1));else for(let e=0;e<r;e++)e%2===0?(a.push(n.getX(e)),a.push(n.getX(e+1)),a.push(n.getX(e+2))):(a.push(n.getX(e+2)),a.push(n.getX(e+1)),a.push(n.getX(e)));a.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=e.clone();return i.setIndex(a),i.clearGroups(),i}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}class the extends zue{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new she(e)})),this.register((function(e){return new che(e)})),this.register((function(e){return new vhe(e)})),this.register((function(e){return new bhe(e)})),this.register((function(e){return new yhe(e)})),this.register((function(e){return new lhe(e)})),this.register((function(e){return new fhe(e)})),this.register((function(e){return new dhe(e)})),this.register((function(e){return new hhe(e)})),this.register((function(e){return new ohe(e)})),this.register((function(e){return new phe(e)})),this.register((function(e){return new uhe(e)})),this.register((function(e){return new mhe(e)})),this.register((function(e){return new ghe(e)})),this.register((function(e){return new ahe(e)})),this.register((function(e){return new xhe(e)})),this.register((function(e){return new whe(e)}))}load(e,t,n,r){const a=this;let i;if(""!==this.resourcePath)i=this.resourcePath;else if(""!==this.path){const t=ole.extractUrlBase(e);i=ole.resolveURL(t,this.path)}else i=ole.extractUrlBase(e);this.manager.itemStart(e);const o=function(t){r?r(t):console.error(t),a.manager.itemError(e),a.manager.itemEnd(e)},s=new Uue(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){try{a.parse(n,i,(function(n){t(n),a.manager.itemEnd(e)}),o)}catch(IQ){o(IQ)}}),n,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r){let a;const i={},o={},s=new TextDecoder;if("string"===typeof e)a=JSON.parse(e);else if(e instanceof ArrayBuffer){if(s.decode(new Uint8Array(e,0,4))===She){try{i[rhe.KHR_BINARY_GLTF]=new _he(e)}catch(u){return void(r&&r(u))}a=JSON.parse(i[rhe.KHR_BINARY_GLTF].content)}else a=JSON.parse(s.decode(e))}else a=e;if(void 0===a.asset||a.asset.version[0]<2)return void(r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const c=new Jhe(a,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let l=0;l<this.pluginCallbacks.length;l++){const e=this.pluginCallbacks[l](c);e.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[e.name]=e,i[e.name]=!0}if(a.extensionsUsed)for(let l=0;l<a.extensionsUsed.length;++l){const e=a.extensionsUsed[l],t=a.extensionsRequired||[];switch(e){case rhe.KHR_MATERIALS_UNLIT:i[e]=new ihe;break;case rhe.KHR_DRACO_MESH_COMPRESSION:i[e]=new Ehe(a,this.dracoLoader);break;case rhe.KHR_TEXTURE_TRANSFORM:i[e]=new The;break;case rhe.KHR_MESH_QUANTIZATION:i[e]=new Ihe;break;default:t.indexOf(e)>=0&&void 0===o[e]&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}c.setExtensions(i),c.setPlugins(o),c.parse(n,r)}parseAsync(e,t){const n=this;return new Promise((function(r,a){n.parse(e,t,r,a)}))}}function nhe(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const rhe={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class ahe{constructor(e){this.parser=e,this.name=rhe.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,r=t.length;n<r;n++){const r=t[n];r.extensions&&r.extensions[this.name]&&void 0!==r.extensions[this.name].light&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let r=t.cache.get(n);if(r)return r;const a=t.json,i=((a.extensions&&a.extensions[this.name]||{}).lights||[])[e];let o;const s=new pse(16777215);void 0!==i.color&&s.setRGB(i.color[0],i.color[1],i.color[2],Hae);const c=void 0!==i.range?i.range:0;switch(i.type){case"directional":o=new ale(s),o.target.position.set(0,0,-1),o.add(o.target);break;case"point":o=new tle(s),o.distance=c;break;case"spot":o=new Que(s),o.distance=c,i.spot=i.spot||{},i.spot.innerConeAngle=void 0!==i.spot.innerConeAngle?i.spot.innerConeAngle:0,i.spot.outerConeAngle=void 0!==i.spot.outerConeAngle?i.spot.outerConeAngle:Math.PI/4,o.angle=i.spot.outerConeAngle,o.penumbra=1-i.spot.innerConeAngle/i.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+i.type)}return o.position.set(0,0,0),o.decay=2,Hhe(o,i),void 0!==i.intensity&&(o.intensity=i.intensity),o.name=t.createUniqueName(i.name||"light_"+e),r=Promise.resolve(o),t.cache.add(n,r),r}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],a=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===a?null:this._loadLight(a).then((function(e){return n._getNodeRef(t.cache,a,e)}))}}class ihe{constructor(){this.name=rhe.KHR_MATERIALS_UNLIT}getMaterialType(){return bse}extendParams(e,t,n){const r=[];e.color=new pse(1,1,1),e.opacity=1;const a=t.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){const t=a.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],Hae),e.opacity=t[3]}void 0!==a.baseColorTexture&&r.push(n.assignTexture(e,"map",a.baseColorTexture,Vae))}return Promise.all(r)}}class ohe{constructor(e){this.parser=e,this.name=rhe.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name].emissiveStrength;return void 0!==r&&(t.emissiveIntensity=r),Promise.resolve()}}class she{constructor(e){this.parser=e,this.name=rhe.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?hue:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const a=[],i=r.extensions[this.name];if(void 0!==i.clearcoatFactor&&(t.clearcoat=i.clearcoatFactor),void 0!==i.clearcoatTexture&&a.push(n.assignTexture(t,"clearcoatMap",i.clearcoatTexture)),void 0!==i.clearcoatRoughnessFactor&&(t.clearcoatRoughness=i.clearcoatRoughnessFactor),void 0!==i.clearcoatRoughnessTexture&&a.push(n.assignTexture(t,"clearcoatRoughnessMap",i.clearcoatRoughnessTexture)),void 0!==i.clearcoatNormalTexture&&(a.push(n.assignTexture(t,"clearcoatNormalMap",i.clearcoatNormalTexture)),void 0!==i.clearcoatNormalTexture.scale)){const e=i.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new yie(e,e)}return Promise.all(a)}}class che{constructor(e){this.parser=e,this.name=rhe.KHR_MATERIALS_DISPERSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?hue:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.dispersion=void 0!==r.dispersion?r.dispersion:0,Promise.resolve()}}class uhe{constructor(e){this.parser=e,this.name=rhe.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?hue:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const a=[],i=r.extensions[this.name];return void 0!==i.iridescenceFactor&&(t.iridescence=i.iridescenceFactor),void 0!==i.iridescenceTexture&&a.push(n.assignTexture(t,"iridescenceMap",i.iridescenceTexture)),void 0!==i.iridescenceIor&&(t.iridescenceIOR=i.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==i.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=i.iridescenceThicknessMinimum),void 0!==i.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=i.iridescenceThicknessMaximum),void 0!==i.iridescenceThicknessTexture&&a.push(n.assignTexture(t,"iridescenceThicknessMap",i.iridescenceThicknessTexture)),Promise.all(a)}}class lhe{constructor(e){this.parser=e,this.name=rhe.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?hue:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const a=[];t.sheenColor=new pse(0,0,0),t.sheenRoughness=0,t.sheen=1;const i=r.extensions[this.name];if(void 0!==i.sheenColorFactor){const e=i.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],Hae)}return void 0!==i.sheenRoughnessFactor&&(t.sheenRoughness=i.sheenRoughnessFactor),void 0!==i.sheenColorTexture&&a.push(n.assignTexture(t,"sheenColorMap",i.sheenColorTexture,Vae)),void 0!==i.sheenRoughnessTexture&&a.push(n.assignTexture(t,"sheenRoughnessMap",i.sheenRoughnessTexture)),Promise.all(a)}}class fhe{constructor(e){this.parser=e,this.name=rhe.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?hue:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const a=[],i=r.extensions[this.name];return void 0!==i.transmissionFactor&&(t.transmission=i.transmissionFactor),void 0!==i.transmissionTexture&&a.push(n.assignTexture(t,"transmissionMap",i.transmissionTexture)),Promise.all(a)}}class dhe{constructor(e){this.parser=e,this.name=rhe.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?hue:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const a=[],i=r.extensions[this.name];t.thickness=void 0!==i.thicknessFactor?i.thicknessFactor:0,void 0!==i.thicknessTexture&&a.push(n.assignTexture(t,"thicknessMap",i.thicknessTexture)),t.attenuationDistance=i.attenuationDistance||1/0;const o=i.attenuationColor||[1,1,1];return t.attenuationColor=(new pse).setRGB(o[0],o[1],o[2],Hae),Promise.all(a)}}class hhe{constructor(e){this.parser=e,this.name=rhe.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?hue:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.ior=void 0!==r.ior?r.ior:1.5,Promise.resolve()}}class phe{constructor(e){this.parser=e,this.name=rhe.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?hue:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const a=[],i=r.extensions[this.name];t.specularIntensity=void 0!==i.specularFactor?i.specularFactor:1,void 0!==i.specularTexture&&a.push(n.assignTexture(t,"specularIntensityMap",i.specularTexture));const o=i.specularColorFactor||[1,1,1];return t.specularColor=(new pse).setRGB(o[0],o[1],o[2],Hae),void 0!==i.specularColorTexture&&a.push(n.assignTexture(t,"specularColorMap",i.specularColorTexture,Vae)),Promise.all(a)}}class ghe{constructor(e){this.parser=e,this.name=rhe.EXT_MATERIALS_BUMP}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?hue:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const a=[],i=r.extensions[this.name];return t.bumpScale=void 0!==i.bumpFactor?i.bumpFactor:1,void 0!==i.bumpTexture&&a.push(n.assignTexture(t,"bumpMap",i.bumpTexture)),Promise.all(a)}}class mhe{constructor(e){this.parser=e,this.name=rhe.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?hue:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const a=[],i=r.extensions[this.name];return void 0!==i.anisotropyStrength&&(t.anisotropy=i.anisotropyStrength),void 0!==i.anisotropyRotation&&(t.anisotropyRotation=i.anisotropyRotation),void 0!==i.anisotropyTexture&&a.push(n.assignTexture(t,"anisotropyMap",i.anisotropyTexture)),Promise.all(a)}}class vhe{constructor(e){this.parser=e,this.name=rhe.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const a=r.extensions[this.name],i=t.options.ktx2Loader;if(!i){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,a.source,i)}}class bhe{constructor(e){this.parser=e,this.name=rhe.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,a=r.textures[e];if(!a.extensions||!a.extensions[t])return null;const i=a.extensions[t],o=r.images[i.source];let s=n.textureLoader;if(o.uri){const e=n.options.manager.getHandler(o.uri);null!==e&&(s=e)}return this.detectSupport().then((function(a){if(a)return n.loadTextureImage(e,i.source,s);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class yhe{constructor(e){this.parser=e,this.name=rhe.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,a=r.textures[e];if(!a.extensions||!a.extensions[t])return null;const i=a.extensions[t],o=r.images[i.source];let s=n.textureLoader;if(o.uri){const e=n.options.manager.getHandler(o.uri);null!==e&&(s=e)}return this.detectSupport().then((function(a){if(a)return n.loadTextureImage(e,i.source,s);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class xhe{constructor(e){this.name=rhe.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const e=n.extensions[this.name],r=this.parser.getDependency("buffer",e.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then((function(t){const n=e.byteOffset||0,r=e.byteLength||0,i=e.count,o=e.byteStride,s=new Uint8Array(t,n,r);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(i,o,s,e.mode,e.filter).then((function(e){return e.buffer})):a.ready.then((function(){const t=new ArrayBuffer(i*o);return a.decodeGltfBuffer(new Uint8Array(t),i,o,s,e.mode,e.filter),t}))}))}return null}}class whe{constructor(e){this.name=rhe.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||void 0===n.mesh)return null;const r=t.meshes[n.mesh];for(const s of r.primitives)if(s.mode!==Ahe.TRIANGLES&&s.mode!==Ahe.TRIANGLE_STRIP&&s.mode!==Ahe.TRIANGLE_FAN&&void 0!==s.mode)return null;const a=n.extensions[this.name].attributes,i=[],o={};for(const s in a)i.push(this.parser.getDependency("accessor",a[s]).then((e=>(o[s]=e,o[s]))));return i.length<1?null:(i.push(this.parser.createNodeMesh(e)),Promise.all(i).then((e=>{const t=e.pop(),n=t.isGroup?t.children:[t],r=e[0].count,a=[];for(const i of n){const e=new Soe,t=new Yie,n=new Hie,s=new Yie(1,1,1),c=new Dce(i.geometry,i.material,r);for(let a=0;a<r;a++)o.TRANSLATION&&t.fromBufferAttribute(o.TRANSLATION,a),o.ROTATION&&n.fromBufferAttribute(o.ROTATION,a),o.SCALE&&s.fromBufferAttribute(o.SCALE,a),c.setMatrixAt(a,e.compose(t,n,s));for(const r in o)if("_COLOR_0"===r){const e=o[r];c.instanceColor=new Ece(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==r&&"ROTATION"!==r&&"SCALE"!==r&&i.geometry.setAttribute(r,o[r]);Koe.prototype.copy.call(c,i),this.parser.assignFinalMaterial(c),a.push(c)}return t.isGroup?(t.clear(),t.add(...a),t):a[0]})))}}const She="glTF",Che=1313821514,Mhe=5130562;class _he{constructor(e){this.name=rhe.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==She)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-12,a=new DataView(e,12);let i=0;for(;i<r;){const t=a.getUint32(i,!0);i+=4;const r=a.getUint32(i,!0);if(i+=4,r===Che){const r=new Uint8Array(e,12+i,t);this.content=n.decode(r)}else if(r===Mhe){const n=12+i;this.body=e.slice(n,n+t)}i+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Ehe{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=rhe.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,r=this.dracoLoader,a=e.extensions[this.name].bufferView,i=e.extensions[this.name].attributes,o={},s={},c={};for(const u in i){const e=Fhe[u]||u.toLowerCase();o[e]=i[u]}for(const u in e.attributes){const t=Fhe[u]||u.toLowerCase();if(void 0!==i[u]){const r=n.accessors[e.attributes[u]],a=Rhe[r.componentType];c[t]=a.name,s[t]=!0===r.normalized}}return t.getDependency("bufferView",a).then((function(e){return new Promise((function(t,n){r.decodeDracoFile(e,(function(e){for(const t in e.attributes){const n=e.attributes[t],r=s[t];void 0!==r&&(n.normalized=r)}t(e)}),o,c,Hae,n)}))}))}}class The{constructor(){this.name=rhe.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&t.texCoord!==e.channel||void 0!==t.offset||void 0!==t.rotation||void 0!==t.scale?(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0,e):e}}class Ihe{constructor(){this.name=rhe.KHR_MESH_QUANTIZATION}}class khe extends wue{constructor(e,t,n,r){super(e,t,n,r)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,a=e*r*3+r;for(let i=0;i!==r;i++)t[i]=n[a+i];return t}interpolate_(e,t,n,r){const a=this.resultBuffer,i=this.sampleValues,o=this.valueSize,s=2*o,c=3*o,u=r-t,l=(n-t)/u,f=l*l,d=f*l,h=e*c,p=h-c,g=-2*d+3*f,m=d-f,v=1-g,b=m-f+l;for(let y=0;y!==o;y++){const e=i[p+y+o],t=i[p+y+s]*u,n=i[h+y+o],r=i[h+y]*u;a[y]=v*e+b*t+g*n+m*r}return a}}const Nhe=new Hie;class Lhe extends khe{interpolate_(e,t,n,r){const a=super.interpolate_(e,t,n,r);return Nhe.fromArray(a).normalize().toArray(a),a}}const Ahe={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Rhe={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Dhe={9728:Dre,9729:Fre,9984:Ore,9985:zre,9986:Pre,9987:jre},Ohe={33071:Are,33648:Rre,10497:Lre},Phe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Fhe={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},zhe={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},jhe={CUBICSPLINE:void 0,LINEAR:Fae,STEP:Pae},Bhe="OPAQUE",Uhe="MASK",Whe="BLEND";function Ghe(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new due({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:0})),e.DefaultMaterial}function Vhe(e,t,n){for(const r in n.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=n.extensions[r])}function Hhe(e,t){void 0!==t.extras&&("object"===typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function Yhe(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let n=0,r=t.weights.length;n<r;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let t=0,r=n.length;t<r;t++)e.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Xhe(e){let t;const n=e.extensions&&e.extensions[rhe.KHR_DRACO_MESH_COMPRESSION];if(t=n?"draco:"+n.bufferView+":"+n.indices+":"+qhe(n.attributes):e.indices+":"+qhe(e.attributes)+":"+e.mode,void 0!==e.targets)for(let r=0,a=e.targets.length;r<a;r++)t+=":"+qhe(e.targets[r]);return t}function qhe(e){let t="";const n=Object.keys(e).sort();for(let r=0,a=n.length;r<a;r++)t+=n[r]+":"+e[n[r]]+";";return t}function Khe(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const Qhe=new Soe;class Jhe{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new nhe,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,r=-1,a=!1,i=-1;if("undefined"!==typeof navigator){const e=navigator.userAgent;n=!0===/^((?!chrome|android).)*safari/i.test(e);const t=e.match(/Version\/(\d+)/);r=n&&t?parseInt(t[1],10):-1,a=e.indexOf("Firefox")>-1,i=a?e.match(/Firefox\/([0-9]+)\./)[1]:-1}"undefined"===typeof createImageBitmap||n&&r<17||a&&i<98?this.textureLoader=new Gue(this.options.manager):this.textureLoader=new sle(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Uue(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,r=this.json,a=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(t){const i={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:n,userData:{}};return Vhe(a,i,r),Hhe(i,r),Promise.all(n._invokeAll((function(e){return e.afterRoot&&e.afterRoot(i)}))).then((function(){for(const e of i.scenes)e.updateMatrixWorld();e(i)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let r=0,a=t.length;r<a;r++){const n=t[r].joints;for(let t=0,r=n.length;t<r;t++)e[n[t]].isBone=!0}for(let r=0,a=e.length;r<a;r++){const t=e[r];void 0!==t.mesh&&(this._addNodeRef(this.meshCache,t.mesh),void 0!==t.skin&&(n[t.mesh].isSkinnedMesh=!0)),void 0!==t.camera&&this._addNodeRef(this.cameraCache,t.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const r=n.clone(),a=(e,t)=>{const n=this.associations.get(e);null!=n&&this.associations.set(t,n);for(const[r,i]of e.children.entries())a(i,t.children[r])};return a(n,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const r=e(t[n]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let r=0;r<t.length;r++){const a=e(t[r]);a&&n.push(a)}return n}getDependency(e,t){const n=e+":"+t;let r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne((function(e){return e.loadNode&&e.loadNode(t)}));break;case"mesh":r=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":r=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":r=this.loadCamera(t);break;default:if(r=this._invokeOne((function(n){return n!=this&&n.getDependency&&n.getDependency(e,t)})),!r)throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map((function(t,r){return n.getDependency(e,r)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[rhe.KHR_BINARY_GLTF].body);const r=this.options;return new Promise((function(e,a){n.load(ole.resolveURL(t.uri,r.path),e,void 0,(function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const n=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+n)}))}loadAccessor(e){const t=this,n=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse){const e=Phe[r.type],t=Rhe[r.componentType],n=!0===r.normalized,a=new t(r.count*e);return Promise.resolve(new wse(a,e,n))}const a=[];return void 0!==r.bufferView?a.push(this.getDependency("bufferView",r.bufferView)):a.push(null),void 0!==r.sparse&&(a.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(a).then((function(e){const a=e[0],i=Phe[r.type],o=Rhe[r.componentType],s=o.BYTES_PER_ELEMENT,c=s*i,u=r.byteOffset||0,l=void 0!==r.bufferView?n.bufferViews[r.bufferView].byteStride:void 0,f=!0===r.normalized;let d,h;if(l&&l!==c){const e=Math.floor(u/l),n="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+e+":"+r.count;let c=t.cache.get(n);c||(d=new o(a,e*l,r.count*l/s),c=new cce(d,l/s),t.cache.add(n,c)),h=new lce(c,i,u%l/s,f)}else d=null===a?new o(r.count*i):new o(a,u,r.count*i),h=new wse(d,i,f);if(void 0!==r.sparse){const t=Phe.SCALAR,n=Rhe[r.sparse.indices.componentType],s=r.sparse.indices.byteOffset||0,c=r.sparse.values.byteOffset||0,u=new n(e[1],s,r.sparse.count*t),l=new o(e[2],c,r.sparse.count*i);null!==a&&(h=new wse(h.array.slice(),h.itemSize,h.normalized)),h.normalized=!1;for(let e=0,r=u.length;e<r;e++){const t=u[e];if(h.setX(t,l[e*i]),i>=2&&h.setY(t,l[e*i+1]),i>=3&&h.setZ(t,l[e*i+2]),i>=4&&h.setW(t,l[e*i+3]),i>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}h.normalized=f}return h}))}loadTexture(e){const t=this.json,n=this.options,r=t.textures[e].source,a=t.images[r];let i=this.textureLoader;if(a.uri){const e=n.manager.getHandler(a.uri);null!==e&&(i=e)}return this.loadTextureImage(e,r,i)}loadTextureImage(e,t,n){const r=this,a=this.json,i=a.textures[e],o=a.images[t],s=(o.uri||o.bufferView)+":"+i.sampler;if(this.textureCache[s])return this.textureCache[s];const c=this.loadImageSource(t,n).then((function(t){t.flipY=!1,t.name=i.name||o.name||"",""===t.name&&"string"===typeof o.uri&&!1===o.uri.startsWith("data:image/")&&(t.name=o.uri);const n=(a.samplers||{})[i.sampler]||{};return t.magFilter=Dhe[n.magFilter]||Fre,t.minFilter=Dhe[n.minFilter]||jre,t.wrapS=Ohe[n.wrapS]||Lre,t.wrapT=Ohe[n.wrapT]||Lre,t.generateMipmaps=!t.isCompressedTexture&&t.minFilter!==Dre&&t.minFilter!==Fre,r.associations.set(t,{textures:e}),t})).catch((function(){return null}));return this.textureCache[s]=c,c}loadImageSource(e,t){const n=this,r=this.json,a=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((e=>e.clone()));const i=r.images[e],o=self.URL||self.webkitURL;let s=i.uri||"",c=!1;if(void 0!==i.bufferView)s=n.getDependency("bufferView",i.bufferView).then((function(e){c=!0;const t=new Blob([e],{type:i.mimeType});return s=o.createObjectURL(t),s}));else if(void 0===i.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(s).then((function(e){return new Promise((function(n,r){let i=n;!0===t.isImageBitmapLoader&&(i=function(e){const t=new jie(e);t.needsUpdate=!0,n(t)}),t.load(ole.resolveURL(e,a.path),i,void 0,r)}))})).then((function(e){var t;return!0===c&&o.revokeObjectURL(s),Hhe(e,i),e.userData.mimeType=i.mimeType||((t=i.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":t.search(/\.ktx2($|\?)/i)>0||0===t.search(/^data\:image\/ktx2/)?"image/ktx2":"image/png"),e})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",s),e}));return this.sourceCache[e]=u,u}assignTexture(e,t,n,r){const a=this;return this.getDependency("texture",n.index).then((function(i){if(!i)return null;if(void 0!==n.texCoord&&n.texCoord>0&&((i=i.clone()).channel=n.texCoord),a.extensions[rhe.KHR_TEXTURE_TRANSFORM]){const e=void 0!==n.extensions?n.extensions[rhe.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=a.associations.get(i);i=a.extensions[rhe.KHR_TEXTURE_TRANSFORM].extendTexture(i,e),a.associations.set(i,t)}}return void 0!==r&&(i.colorSpace=r),e[t]=i,i}))}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const r=void 0===t.attributes.tangent,a=void 0!==t.attributes.color,i=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new nue,vse.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,t.sizeAttenuation=!1,this.cache.add(e,t)),n=t}else if(e.isLine){const e="LineBasicMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new Wce,vse.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,this.cache.add(e,t)),n=t}if(r||a||i){let e="ClonedMaterial:"+n.uuid+":";r&&(e+="derivative-tangents:"),a&&(e+="vertex-colors:"),i&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=n.clone(),a&&(t.vertexColors=!0),i&&(t.flatShading=!0),r&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(n))),n=t}e.material=n}getMaterialType(){return due}loadMaterial(e){const t=this,n=this.json,r=this.extensions,a=n.materials[e];let i;const o={},s=[];if((a.extensions||{})[rhe.KHR_MATERIALS_UNLIT]){const e=r[rhe.KHR_MATERIALS_UNLIT];i=e.getMaterialType(),s.push(e.extendParams(o,a,t))}else{const n=a.pbrMetallicRoughness||{};if(o.color=new pse(1,1,1),o.opacity=1,Array.isArray(n.baseColorFactor)){const e=n.baseColorFactor;o.color.setRGB(e[0],e[1],e[2],Hae),o.opacity=e[3]}void 0!==n.baseColorTexture&&s.push(t.assignTexture(o,"map",n.baseColorTexture,Vae)),o.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,o.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(s.push(t.assignTexture(o,"metalnessMap",n.metallicRoughnessTexture)),s.push(t.assignTexture(o,"roughnessMap",n.metallicRoughnessTexture))),i=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),s.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,o)}))))}!0===a.doubleSided&&(o.side=2);const c=a.alphaMode||Bhe;if(c===Whe?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,c===Uhe&&(o.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&i!==bse&&(s.push(t.assignTexture(o,"normalMap",a.normalTexture)),o.normalScale=new yie(1,1),void 0!==a.normalTexture.scale)){const e=a.normalTexture.scale;o.normalScale.set(e,e)}if(void 0!==a.occlusionTexture&&i!==bse&&(s.push(t.assignTexture(o,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(o.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&i!==bse){const e=a.emissiveFactor;o.emissive=(new pse).setRGB(e[0],e[1],e[2],Hae)}return void 0!==a.emissiveTexture&&i!==bse&&s.push(t.assignTexture(o,"emissiveMap",a.emissiveTexture,Vae)),Promise.all(s).then((function(){const n=new i(o);return a.name&&(n.name=a.name),Hhe(n,a),t.associations.set(n,{materials:e}),a.extensions&&Vhe(r,n,a),n}))}createUniqueName(e){const t=gle.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,r=this.primitiveCache;function a(e){return n[rhe.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return Zhe(n,e,t)}))}const i=[];for(let o=0,s=e.length;o<s;o++){const n=e[o],s=Xhe(n),c=r[s];if(c)i.push(c.promise);else{let e;e=n.extensions&&n.extensions[rhe.KHR_DRACO_MESH_COMPRESSION]?a(n):Zhe(new Ase,n,t),r[s]={primitive:n,promise:e},i.push(e)}}return Promise.all(i)}loadMesh(e){const t=this,n=this.json,r=this.extensions,a=n.meshes[e],i=a.primitives,o=[];for(let s=0,c=i.length;s<c;s++){const e=void 0===i[s].material?Ghe(this.cache):this.getDependency("material",i[s].material);o.push(e)}return o.push(t.loadGeometries(i)),Promise.all(o).then((function(n){const o=n.slice(0,n.length-1),s=n[n.length-1],c=[];for(let l=0,f=s.length;l<f;l++){const n=s[l],u=i[l];let f;const d=o[l];if(u.mode===Ahe.TRIANGLES||u.mode===Ahe.TRIANGLE_STRIP||u.mode===Ahe.TRIANGLE_FAN||void 0===u.mode)f=!0===a.isSkinnedMesh?new xce(n,d):new Vse(n,d),!0===f.isSkinnedMesh&&f.normalizeSkinWeights(),u.mode===Ahe.TRIANGLE_STRIP?f.geometry=ehe(f.geometry,1):u.mode===Ahe.TRIANGLE_FAN&&(f.geometry=ehe(f.geometry,2));else if(u.mode===Ahe.LINES)f=new eue(n,d);else if(u.mode===Ahe.LINE_STRIP)f=new Qce(n,d);else if(u.mode===Ahe.LINE_LOOP)f=new tue(n,d);else{if(u.mode!==Ahe.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+u.mode);f=new sue(n,d)}Object.keys(f.geometry.morphAttributes).length>0&&Yhe(f,a),f.name=t.createUniqueName(a.name||"mesh_"+e),Hhe(f,a),u.extensions&&Vhe(r,f,u),t.assignFinalMaterial(f),c.push(f)}for(let r=0,a=c.length;r<a;r++)t.associations.set(c[r],{meshes:e,primitives:r});if(1===c.length)return a.extensions&&Vhe(r,c[0],a),c[0];const u=new uue;a.extensions&&Vhe(r,u,a),t.associations.set(u,{meshes:e});for(let e=0,t=c.length;e<t;e++)u.add(c[e]);return u}))}loadCamera(e){let t;const n=this.json.cameras[e],r=n[n.type];if(r)return"perspective"===n.type?t=new nce(bie.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===n.type&&(t=new nle(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),Hhe(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n=[];for(let r=0,a=t.joints.length;r<a;r++)n.push(this._loadNodeShallow(t.joints[r]));return void 0!==t.inverseBindMatrices?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then((function(e){const n=e.pop(),r=e,a=[],i=[];for(let o=0,s=r.length;o<s;o++){const e=r[o];if(e){a.push(e);const t=new Soe;null!==n&&t.fromArray(n.array,16*o),i.push(t)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[o])}return new _ce(a,i)}))}loadAnimation(e){const t=this.json,n=this,r=t.animations[e],a=r.name?r.name:"animation_"+e,i=[],o=[],s=[],c=[],u=[];for(let l=0,f=r.channels.length;l<f;l++){const e=r.channels[l],t=r.samplers[e.sampler],n=e.target,a=n.node,f=void 0!==r.parameters?r.parameters[t.input]:t.input,d=void 0!==r.parameters?r.parameters[t.output]:t.output;void 0!==n.node&&(i.push(this.getDependency("node",a)),o.push(this.getDependency("accessor",f)),s.push(this.getDependency("accessor",d)),c.push(t),u.push(n))}return Promise.all([Promise.all(i),Promise.all(o),Promise.all(s),Promise.all(c),Promise.all(u)]).then((function(e){const t=e[0],r=e[1],i=e[2],o=e[3],s=e[4],c=[];for(let a=0,u=t.length;a<u;a++){const e=t[a],u=r[a],l=i[a],f=o[a],d=s[a];if(void 0===e)continue;e.updateMatrix&&e.updateMatrix();const h=n._createAnimationTracks(e,u,l,f,d);if(h)for(let t=0;t<h.length;t++)c.push(h[t])}return new Rue(a,void 0,c)}))}createNodeMesh(e){const t=this.json,n=this,r=t.nodes[e];return void 0===r.mesh?null:n.getDependency("mesh",r.mesh).then((function(e){const t=n._getNodeRef(n.meshCache,r.mesh,e);return void 0!==r.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,n=r.weights.length;t<n;t++)e.morphTargetInfluences[t]=r.weights[t]})),t}))}loadNode(e){const t=this,n=this.json.nodes[e],r=t._loadNodeShallow(e),a=[],i=n.children||[];for(let s=0,c=i.length;s<c;s++)a.push(t.getDependency("node",i[s]));const o=void 0===n.skin?Promise.resolve(null):t.getDependency("skin",n.skin);return Promise.all([r,Promise.all(a),o]).then((function(e){const t=e[0],n=e[1],r=e[2];null!==r&&t.traverse((function(e){e.isSkinnedMesh&&e.bind(r,Qhe)}));for(let a=0,i=n.length;a<i;a++)t.add(n[a]);return t}))}_loadNodeShallow(e){const t=this.json,n=this.extensions,r=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const a=t.nodes[e],i=a.name?r.createUniqueName(a.name):"",o=[],s=r._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return s&&o.push(s),void 0!==a.camera&&o.push(r.getDependency("camera",a.camera).then((function(e){return r._getNodeRef(r.cameraCache,a.camera,e)}))),r._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){o.push(e)})),this.nodeCache[e]=Promise.all(o).then((function(t){let o;if(o=!0===a.isBone?new wce:t.length>1?new uue:1===t.length?t[0]:new Koe,o!==t[0])for(let e=0,n=t.length;e<n;e++)o.add(t[e]);if(a.name&&(o.userData.name=a.name,o.name=i),Hhe(o,a),a.extensions&&Vhe(n,o,a),void 0!==a.matrix){const e=new Soe;e.fromArray(a.matrix),o.applyMatrix4(e)}else void 0!==a.translation&&o.position.fromArray(a.translation),void 0!==a.rotation&&o.quaternion.fromArray(a.rotation),void 0!==a.scale&&o.scale.fromArray(a.scale);return r.associations.has(o)||r.associations.set(o,{}),r.associations.get(o).nodes=e,o})),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],r=this,a=new uue;n.name&&(a.name=r.createUniqueName(n.name)),Hhe(a,n),n.extensions&&Vhe(t,a,n);const i=n.nodes||[],o=[];for(let s=0,c=i.length;s<c;s++)o.push(r.getDependency("node",i[s]));return Promise.all(o).then((function(e){for(let t=0,n=e.length;t<n;t++)a.add(e[t]);return r.associations=(e=>{const t=new Map;for(const[n,a]of r.associations)(n instanceof vse||n instanceof jie)&&t.set(n,a);return e.traverse((e=>{const n=r.associations.get(e);null!=n&&t.set(e,n)})),t})(a),a}))}_createAnimationTracks(e,t,n,r,a){const i=[],o=e.name?e.name:e.uuid,s=[];let c;switch(zhe[a.path]===zhe.weights?e.traverse((function(e){e.morphTargetInfluences&&s.push(e.name?e.name:e.uuid)})):s.push(o),zhe[a.path]){case zhe.weights:c=Iue;break;case zhe.rotation:c=Nue;break;case zhe.position:case zhe.scale:c=Aue;break;default:if(1===n.itemSize)c=Iue;else c=Aue}const u=void 0!==r.interpolation?jhe[r.interpolation]:Fae,l=this._getArrayFromAccessor(n);for(let f=0,d=s.length;f<d;f++){const e=new c(s[f]+"."+zhe[a.path],t.array,l,u);"CUBICSPLINE"===r.interpolation&&this._createCubicSplineTrackInterpolant(e),i.push(e)}return i}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const e=Khe(t.constructor),n=new Float32Array(t.length);for(let r=0,a=t.length;r<a;r++)n[r]=t[r]*e;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof Nue?Lhe:khe)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Zhe(e,t,n){const r=t.attributes,a=[];function i(t,r){return n.getDependency("accessor",t).then((function(t){e.setAttribute(r,t)}))}for(const o in r){const t=Fhe[o]||o.toLowerCase();t in e.attributes||a.push(i(r[o],t))}if(void 0!==t.indices&&!e.index){const r=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));a.push(r)}return Nie.workingColorSpace!==Hae&&"COLOR_0"in r&&console.warn('THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "'.concat(Nie.workingColorSpace,'" not supported.')),Hhe(e,t),function(e,t,n){const r=t.attributes,a=new Kie;if(void 0===r.POSITION)return;{const e=n.json.accessors[r.POSITION],t=e.min,i=e.max;if(void 0===t||void 0===i)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(a.set(new Yie(t[0],t[1],t[2]),new Yie(i[0],i[1],i[2])),e.normalized){const t=Khe(Rhe[e.componentType]);a.min.multiplyScalar(t),a.max.multiplyScalar(t)}}const i=t.targets;if(void 0!==i){const e=new Yie,t=new Yie;for(let r=0,a=i.length;r<a;r++){const a=i[r];if(void 0!==a.POSITION){const r=n.json.accessors[a.POSITION],i=r.min,o=r.max;if(void 0!==i&&void 0!==o){if(t.setX(Math.max(Math.abs(i[0]),Math.abs(o[0]))),t.setY(Math.max(Math.abs(i[1]),Math.abs(o[1]))),t.setZ(Math.max(Math.abs(i[2]),Math.abs(o[2]))),r.normalized){const e=Khe(Rhe[r.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}a.expandByVector(e)}e.boundingBox=a;const o=new hoe;a.getCenter(o.center),o.radius=a.min.distanceTo(a.max)/2,e.boundingSphere=o}(e,t,n),Promise.all(a).then((function(){return void 0!==t.targets?function(e,t,n){let r=!1,a=!1,i=!1;for(let u=0,l=t.length;u<l;u++){const e=t[u];if(void 0!==e.POSITION&&(r=!0),void 0!==e.NORMAL&&(a=!0),void 0!==e.COLOR_0&&(i=!0),r&&a&&i)break}if(!r&&!a&&!i)return Promise.resolve(e);const o=[],s=[],c=[];for(let u=0,l=t.length;u<l;u++){const l=t[u];if(r){const t=void 0!==l.POSITION?n.getDependency("accessor",l.POSITION):e.attributes.position;o.push(t)}if(a){const t=void 0!==l.NORMAL?n.getDependency("accessor",l.NORMAL):e.attributes.normal;s.push(t)}if(i){const t=void 0!==l.COLOR_0?n.getDependency("accessor",l.COLOR_0):e.attributes.color;c.push(t)}}return Promise.all([Promise.all(o),Promise.all(s),Promise.all(c)]).then((function(t){const n=t[0],o=t[1],s=t[2];return r&&(e.morphAttributes.position=n),a&&(e.morphAttributes.normal=o),i&&(e.morphAttributes.color=s),e.morphTargetsRelative=!0,e}))}(e,t.targets,n):e}))}const $he=e=>{let{videoRef:t,activeFilter:n}=e;const r=(0,o.useRef)(null),a=(0,o.useRef)(null),i=(0,o.useRef)(null),s=(0,o.useRef)(null),c=(0,o.useRef)(null),[u,l]=(0,o.useState)(!1),[f,d]=(0,o.useState)(!0),[h,p]=(0,o.useState)(null),[g,m]=(0,o.useState)({width:640,height:480}),[v,b]=(0,o.useState)(!1),y={none:null,fox:"/models/fox_mask.glb",cat:"/models/cat_mask.glb",dog:"/models/dog_mask.glb",robot:"/models/robot_mask.glb",alien:"/models/alien_mask.glb",dragon:"/models/dragon_mask.glb",demon:"/models/demon_mask.glb",cyborg:"/models/cyborg_mask.glb",samurai:"/models/samurai_mask.glb",clown:"/models/clown_mask.glb"};return(0,o.useEffect)((()=>{const e=()=>{t.current&&m({width:t.current.videoWidth||640,height:t.current.videoHeight||480})};return t.current&&(t.current.addEventListener("loadedmetadata",e),t.current.videoWidth&&e()),()=>{t.current&&t.current.removeEventListener("loadedmetadata",e)}}),[t]),(0,o.useEffect)((()=>{const e=(()=>{if(!r.current)return!1;try{const e=new sce;a.current=e;const t=new nce(75,g.width/g.height,.1,1e3);t.position.z=5,i.current=t;const n=new $de({canvas:r.current,alpha:!0,antialias:!0});n.setSize(g.width,g.height),s.current=n;const o=new ile(16777215,.5);e.add(o);const c=new ale(16777215,.8);return c.position.set(0,1,2),e.add(c),!0}catch(upe){return console.error("Error initializing Three.js:",upe),p("Failed to initialize 3D renderer"),!1}})();return b(e),()=>{if(s.current&&s.current.dispose(),a.current)for(;a.current.children.length>0;)a.current.remove(a.current.children[0])}}),[g]),(0,o.useEffect)((()=>{(async()=>{try{d(!0),p(null),await yb.ready(),await(e="webgl",yb.setBackend(e));const t="".concat("","/models");await _ee.monkeyPatch({Canvas:HTMLCanvasElement,Image:HTMLImageElement,ImageData:ImageData,Video:HTMLVideoElement,createCanvasElement:()=>document.createElement("canvas"),createImageElement:()=>document.createElement("img")}),await kne.tinyFaceDetector.load(t),console.log("TinyFaceDetector loaded"),await kne.faceLandmark68Net.load(t),console.log("FaceLandmark68Net loaded"),await kne.faceRecognitionNet.load(t),console.log("FaceRecognitionNet loaded"),l(!0),d(!1)}catch(upe){console.error("Error initializing Face3DMasks:",upe),p(upe.message),d(!1)}var e})()}),[]),(0,o.useEffect)((()=>{if(!u||!v||!y[n]||!a.current)return void console.log("Not ready to load mask:",{isModelLoaded:u,isSceneInitialized:v,hasMaskPath:!!y[n],hasScene:!!a.current});console.log("Loading mask:",n),console.log("Mask path:",y[n]);return(new the).load(y[n],(e=>{console.log("Mask loaded successfully:",n),c.current&&a.current&&(console.log("Removing old mask"),a.current.remove(c.current),c.current=null);const t=e.scene;console.log("Mask scene:",t),t.position.set(0,0,0),t.rotation.set(0,Math.PI,0);t.scale.set(.1,.1,.1),t.traverse((e=>{e.isMesh&&(e.frustumCulled=!0,e.castShadow=!1,e.receiveShadow=!1,e.material&&(e.material.transparent=!0,e.material.opacity=1,e.material.side=2,e.material.depthTest=!0,e.material.needsUpdate=!0))})),a.current?(a.current.add(t),c.current=t,s.current&&i.current&&s.current.render(a.current,i.current),console.log("Mask added to scene")):console.error("Scene is null when trying to add mask")}),(e=>{const t=e.loaded/e.total*100;console.log("Loading mask ".concat(n,": ").concat(t.toFixed(2),"%"))}),(e=>{console.error("Error loading mask:",e),p("Failed to load mask model ".concat(n,": ").concat(e.message))})),()=>{c.current&&a.current&&(a.current.remove(c.current),c.current=null)}}),[n,u,v]),(0,o.useEffect)((()=>{if(!u||!t.current||!c.current)return void console.log("Face tracking not ready:",{isModelLoaded:u,hasVideo:!!t.current,hasMask:!!c.current});let e;const n=async()=>{try{if(!t.current||4!==t.current.readyState)return;const r=document.createElement("canvas");r.width=g.width,r.height=g.height;r.getContext("2d").drawImage(t.current,0,0,g.width,g.height);const o=await function(e,t){return void 0===t&&(t=new qte),new qne(e,t)}(r,new une({inputSize:416,scoreThreshold:.5})).withFaceLandmarks();if(o.length>0){const e=o[0],{landmarks:t}=e;if(c.current){const e=t.getNose(),n=t.getLeftEye(),r=t.getRightEye(),o=e[3],u=Math.atan2(r[0].y-n[0].y,r[0].x-n[0].x),l=.01*Math.abs(r[3].x-n[3].x);c.current.position.set(.008*(o.x-g.width/2),.008*-(o.y-g.height/2),0),c.current.rotation.z=u,c.current.scale.set(l,l,l),s.current&&a.current&&i.current&&s.current.render(a.current,i.current)}}e=requestAnimationFrame(n)}catch(upe){console.error("Error in face detection:",upe),p("Face detection failed")}};return console.log("Starting face detection"),n(),()=>{e&&cancelAnimationFrame(e)}}),[u,t,g]),h?(0,ga.jsxs)("div",{className:"face-3d-mask-error",children:["Error: ",h]}):f?(0,ga.jsx)("div",{className:"face-3d-mask-loading",children:"Loading face detection models..."}):(0,ga.jsx)("canvas",{ref:r,className:"face-3d-mask-canvas",width:g.width,height:g.height})},epe=e=>{let{activeMask:t,onMaskChange:n}=e;return(0,ga.jsx)("div",{className:"mask-3d-picker",children:(0,ga.jsx)("div",{className:"mask-3d-grid",children:[{id:"none",name:"\u0411\u0435\u0437 \u043c\u0430\u0441\u043a\u0438",preview:"/previews/none.jpg"},{id:"fox",name:"\u041b\u0438\u0441\u0430",preview:"/previews/fox.jpg"},{id:"cat",name:"\u041a\u043e\u0442",preview:"/previews/cat.jpg"},{id:"dog",name:"\u041f\u0451\u0441",preview:"/previews/dog.jpg"},{id:"robot",name:"\u0420\u043e\u0431\u043e\u0442",preview:"/previews/robot.jpg"},{id:"alien",name:"\u041f\u0440\u0438\u0448\u0435\u043b\u0435\u0446",preview:"/previews/alien.jpg"},{id:"dragon",name:"\u0414\u0440\u0430\u043a\u043e\u043d",preview:"/previews/dragon.jpg"},{id:"demon",name:"\u0414\u0435\u043c\u043e\u043d",preview:"/previews/demon.jpg"},{id:"cyborg",name:"\u041a\u0438\u0431\u043e\u0440\u0433",preview:"/previews/cyborg.jpg"},{id:"samurai",name:"\u0421\u0430\u043c\u0443\u0440\u0430\u0439",preview:"/previews/samurai.jpg"},{id:"clown",name:"\u041a\u043b\u043e\u0443\u043d",preview:"/previews/clown.jpg"}].map((e=>(0,ga.jsxs)("button",{className:"mask-3d-button ".concat(t===e.id?"active":""),onClick:()=>n(e.id),children:[(0,ga.jsx)("div",{className:"mask-3d-preview",children:(0,ga.jsx)("img",{src:e.preview,alt:e.name})}),(0,ga.jsx)("span",{className:"mask-3d-name",children:e.name})]},e.id)))})})};var tpe,npe;const rpe="https://ruletka.top",ape=Bs(rpe,{path:"/socket.io",transports:["websocket"],reconnection:!0,reconnectionAttempts:10,reconnectionDelay:1e3,reconnectionDelayMax:5e3,timeout:2e4,withCredentials:!0,autoConnect:!0,forceNew:!0,secure:!0});ape.on("connect",(()=>{console.log("Connected to server:",rpe),console.log("Socket ID:",ape.id)})),ape.on("connect_error",(e=>{console.error("Connection error:",e),setTimeout((()=>{ape.connect()}),1e3)})),ape.on("disconnect",(()=>{console.log("Disconnected from server"),setTimeout((()=>{ape.connect()}),1e3)}));const ipe=$t.div(tpe||(tpe=nn(["\n  min-height: 100vh;\n  display: flex;\n  flex-direction: column;\n"]))),ope=$t.div(npe||(npe=nn(["\n  flex: 1;\n  padding: 20px;\n"]))),spe=e=>{let{currentTheme:t}=e;const[n,r]=(0,o.useState)([]),[a,i]=(0,o.useState)(""),[s,c]=(0,o.useState)(!1),[u,l]=(0,o.useState)(!1),[f,d]=(0,o.useState)(!1),[h,p]=(0,o.useState)(!1),[g,m]=(0,o.useState)(!1),[v,b]=(0,o.useState)(!1),y=(0,o.useRef)(null),x=(0,o.useRef)(null),w=(0,o.useRef)(null),[S,C]=(0,o.useState)(null),[M,_]=(0,o.useState)("none"),[E,T]=(0,o.useState)(!1),[I,k]=(0,o.useState)(!1),[N,L]=(0,o.useState)(!1),A=(0,o.useRef)(null),R=(0,o.useRef)(null),[D,O]=(0,o.useState)(!1),[P,F]=(0,o.useState)(!1),[z,j]=(0,o.useState)(null),[B,U]=(0,o.useState)(null),[W,G]=(0,o.useState)("idle"),[V,H]=(0,o.useState)(null),[Y,X]=(0,o.useState)(0),[q,K]=(0,o.useState)(!1),[Q,J]=(0,o.useState)(!0),[Z,$]=(0,o.useState)("none"),[ee,te]=(0,o.useState)(!1),[ne,re]=(0,o.useState)({filter:"",maskUrl:null}),[ae,ie]=(0,o.useState)("none"),[oe,se]=(0,o.useState)(!1),[ce,ue]=(0,o.useState)("en"),[le,fe]=(0,o.useState)(0),[de,he]=(0,o.useState)(null),[pe,ge]=(0,o.useState)(!1),me={none:"",grayscale:"grayscale(100%)",sepia:"sepia(100%)",blur:"blur(3px)",brightness:"brightness(150%)",contrast:"contrast(200%)",hueRotate:"hue-rotate(90deg)"},ve=()=>{if(T(!E),!E&&A.current){const e=A.current,t=e.getContext("2d");let n=!1,r=0,a=0;e.addEventListener("mousedown",(e=>{n=!0,[r,a]=[e.offsetX,e.offsetY]})),e.addEventListener("mousemove",(e=>{n&&(t.beginPath(),t.moveTo(r,a),t.lineTo(e.offsetX,e.offsetY),t.strokeStyle="#00ff00",t.lineWidth=2,t.stroke(),[r,a]=[e.offsetX,e.offsetY])})),e.addEventListener("mouseup",(()=>n=!1))}},be=()=>{k(!I)},ye=async()=>{try{const e=await navigator.permissions.query({name:"camera"}),t=await navigator.permissions.query({name:"microphone"});if("denied"===e.state||"denied"===t.state)return void H("\u0414\u043e\u0441\u0442\u0443\u043f \u043a \u043a\u0430\u043c\u0435\u0440\u0435 \u0438\u043b\u0438 \u043c\u0438\u043a\u0440\u043e\u0444\u043e\u043d\u0443 \u0437\u0430\u043f\u0440\u0435\u0449\u0435\u043d. \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0440\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u0435 \u0434\u043e\u0441\u0442\u0443\u043f \u0432 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430\u0445 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0430.");const n=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720}},audio:!0}).catch((async e=>(console.warn("Failed to get audio+video, trying video only:",e),await navigator.mediaDevices.getUserMedia({video:!0,audio:!1}))));n&&y.current&&(y.current.srcObject=n,C(n),K(!0),J(!1),console.log("Media permissions granted"))}catch(upe){console.error("\u041e\u0448\u0438\u0431\u043a\u0430 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a \u043c\u0435\u0434\u0438\u0430:",upe),"NotAllowedError"===upe.name||"PermissionDeniedError"===upe.name?H("\u0414\u043e\u0441\u0442\u0443\u043f \u043a \u043a\u0430\u043c\u0435\u0440\u0435 \u0438\u043b\u0438 \u043c\u0438\u043a\u0440\u043e\u0444\u043e\u043d\u0443 \u0437\u0430\u043f\u0440\u0435\u0449\u0435\u043d. \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0440\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u0435 \u0434\u043e\u0441\u0442\u0443\u043f \u0432 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430\u0445 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0430."):"NotFoundError"===upe.name||"DevicesNotFoundError"===upe.name?H("\u041a\u0430\u043c\u0435\u0440\u0430 \u0438\u043b\u0438 \u043c\u0438\u043a\u0440\u043e\u0444\u043e\u043d \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b. \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u0435 \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0430."):"NotReadableError"===upe.name||"TrackStartError"===upe.name?H("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f \u043a \u043a\u0430\u043c\u0435\u0440\u0435 \u0438\u043b\u0438 \u043c\u0438\u043a\u0440\u043e\u0444\u043e\u043d\u0443. \u0412\u043e\u0437\u043c\u043e\u0436\u043d\u043e, \u043e\u043d\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442\u0441\u044f \u0434\u0440\u0443\u0433\u0438\u043c \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435\u043c."):H("\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0434\u043e\u0441\u0442\u0443\u043f\u0435 \u043a \u043a\u0430\u043c\u0435\u0440\u0435 \u0438\u043b\u0438 \u043c\u0438\u043a\u0440\u043e\u0444\u043e\u043d\u0443: "+upe.message),K(!1)}};(0,o.useEffect)((()=>(S||ye(),()=>{S&&S.getTracks().forEach((e=>e.stop()))})),[S]);const xe=()=>{if(S){const e=S.getAudioTracks()[0];e&&(e.enabled=!e.enabled,p(!h))}},we=()=>{if(S){const e=S.getVideoTracks()[0];e&&(e.enabled=!e.enabled,m(!g))}},Se=async()=>{try{if(v)S&&y.current&&(y.current.srcObject=S),b(!1);else{const e=await navigator.mediaDevices.getDisplayMedia({video:!0});y.current&&(y.current.srcObject=e),b(!0)}}catch(upe){console.error("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0434\u0435\u043c\u043e\u043d\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u044d\u043a\u0440\u0430\u043d\u0430:",upe)}};(0,o.useEffect)((()=>{(()=>{var e;null===(e=w.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})})()}),[n]),(0,o.useEffect)((()=>{console.log("Current states:",{isConnected:s,isSearching:u,connectionStatus:W,localStream:!!S,peer:!!z})}),[s,u,W,S,z]),(0,o.useEffect)((()=>(ape.on("connect",(()=>{console.log("Socket connected:",ape.id),H(null)})),ape.on("disconnect",(()=>{console.log("Socket disconnected"),c(!1),G("idle"),z&&(z.destroy(),j(null)),H("\u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c \u043f\u043e\u0442\u0435\u0440\u044f\u043d\u043e. \u041f\u0435\u0440\u0435\u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435...")})),ape.on("connect_error",(e=>{console.error("Connection error:",e),H("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u043a \u0441\u0435\u0440\u0432\u0435\u0440\u0443. \u041f\u0440\u043e\u0431\u0443\u0435\u043c \u043f\u0435\u0440\u0435\u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f...")})),ape.on("waiting",(()=>{console.log("Waiting for partner"),G("searching"),l(!0)})),ape.on("searchTimeout",(()=>{console.log("Search timeout"),G("idle"),l(!1),H("\u041f\u043e\u0438\u0441\u043a \u0441\u043e\u0431\u0435\u0441\u0435\u0434\u043d\u0438\u043a\u0430 \u0437\u0430\u043d\u044f\u043b \u0441\u043b\u0438\u0448\u043a\u043e\u043c \u043c\u043d\u043e\u0433\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0435 \u0440\u0430\u0437.")})),()=>{ape.off("connect"),ape.off("disconnect"),ape.off("connect_error"),ape.off("waiting"),ape.off("searchTimeout")})),[z]);const Ce=(0,o.useCallback)((()=>{S?(ape.connected||(console.log("Socket not connected, attempting to connect..."),ape.connect()),G("searching"),H(null),O(!0),r([]),ge(!1),fe(0),z&&(z.destroy(),j(null)),x.current&&(x.current.srcObject=null),setTimeout((()=>{console.log("Emitting startSearch"),ape.emit("startSearch"),l(!0),O(!1)}),1e3)):H("\u041d\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a \u043a\u0430\u043c\u0435\u0440\u0435")}),[S,z,ape]),Me=(0,o.useCallback)((()=>{z&&(z.destroy(),j(null)),G("failed"),setTimeout((()=>{"failed"===W&&Ce()}),3e3)}),[z,Ce]),_e=(0,o.useCallback)((()=>{x.current&&(x.current.srcObject=null),G("idle"),c(!1)}),[]),Ee=(0,o.useCallback)((()=>{if(console.log("ICE connection failed/disconnected"),z&&z._pc)try{z._pc.restartIce(),console.log("ICE restart initiated")}catch(upe){console.error("ICE restart failed:",upe),Me()}}),[z,Me]),Te=(0,o.useCallback)(((e,t)=>{try{const n=new(Ws())({initiator:e,trickle:!0,stream:t,config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"},{urls:"turn:turn.ruletka.top:3478",username:"ruletka",credential:"ruletka123"}],iceTransportPolicy:"all",iceCandidatePoolSize:10,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}});return n.on("connect",(()=>{console.log("Peer connection established"),G("connected")})),n.on("error",(e=>{console.error("Peer connection error:",e),H("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u043a \u0441\u043e\u0431\u0435\u0441\u0435\u0434\u043d\u0438\u043a\u0443"),Me()})),n.on("close",(()=>{console.log("Peer connection closed"),_e()})),n.on("iceStateChange",(e=>{console.log("ICE state:",e),"disconnected"!==e&&"failed"!==e||Ee()})),n.on("stream",(e=>{console.log("Received remote stream"),x.current&&(x.current.srcObject=e,G("connected"))})),n}catch(upe){return console.error("Error creating peer:",upe),H("\u041e\u0448\u0438\u0431\u043a\u0430 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f"),null}}),[Me,_e,Ee]);(0,o.useEffect)((()=>(ape.on("message",(e=>{if(console.log("Received message:",e),!e||!e.message)return;const t={id:Date.now(),type:e.message.type||"text",text:e.message.text||"",content:e.message.content||"",sender:"partner",translated:e.message.translated||null};("text"!==t.type||t.text)&&("image"!==t.type||t.content)&&r((e=>[...e,t]))})),ape.on("signal",(async e=>{console.log("Received signal from partner:",e);try{z&&e.signal&&await z.signal(e.signal)}catch(upe){console.error("Error processing signal:",upe)}})),ape.on("partnerLeft",(()=>{console.log("Partner left"),c(!1),G("idle"),ge(!1),z&&(z.destroy(),j(null)),x.current&&(x.current.srcObject=null)})),()=>{ape.off("message"),ape.off("signal"),ape.off("partnerLeft")})),[z]),(0,o.useEffect)((()=>(ape.on("connect",(()=>{console.log("Socket connected:",ape.id),H(null)})),ape.on("disconnect",(()=>{console.log("Socket disconnected"),c(!1),G("idle"),z&&(z.destroy(),j(null)),H("\u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c \u043f\u043e\u0442\u0435\u0440\u044f\u043d\u043e")})),ape.on("waiting",(()=>{console.log("Waiting for partner"),G("searching")})),ape.on("chatStarted",(async e=>{let{roomId:t}=e;if(console.log("Chat started in room:",t),U(t),c(!0),l(!1),G("connecting"),H(null),S)try{const e=Te(!0,S);if(e){j(e);const t=setTimeout((()=>{"connected"!==W&&(console.log("Connection timeout"),Me())}),15e3);e.on("connect",(()=>{clearTimeout(t)}))}}catch(upe){console.error("Error in chat start:",upe),Me()}})),ape.on("partnerJoined",(async e=>{if(console.log("Partner joined with signal:",e),G("connecting"),ge(!0),fe(0),S&&e.signal)try{const t=new(Ws())({initiator:!1,trickle:!1,stream:S,config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]}});t.on("signal",(e=>{console.log("Sending signal back to partner"),ape.emit("signal",{signal:e,roomId:B})})),t.on("stream",(e=>{if(console.log("Received remote stream"),x.current){x.current.srcObject=e,G("connected");const t=setInterval((()=>{fe((e=>e+1))}),1e3);he(t)}})),t.on("error",(e=>{console.error("Peer connection error:",e),H("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u043a \u0441\u043e\u0431\u0435\u0441\u0435\u0434\u043d\u0438\u043a\u0443")})),t.on("close",(()=>{console.log("Peer connection closed"),x.current&&(x.current.srcObject=null)})),j(t),await t.signal(e.signal)}catch(upe){console.error("Error creating peer:",upe),H("\u041e\u0448\u0438\u0431\u043a\u0430 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f")}})),ape.on("partnerLeft",(()=>{console.log("Partner left"),c(!1),G("idle"),ge(!1),de&&clearInterval(de),fe(0),z&&(z.destroy(),j(null)),x.current&&(x.current.srcObject=null)})),()=>{ape.off("connect"),ape.off("disconnect"),ape.off("waiting"),ape.off("chatStarted"),ape.off("partnerJoined"),ape.off("partnerLeft"),de&&clearInterval(de)})),[S,W]);const Ie=()=>{F(!0),r([]),ge(!1),fe(0),z&&(z.destroy(),j(null)),x.current&&(x.current.srcObject=null),setTimeout((()=>{F(!1),B&&ape.emit("nextPartner",{roomId:B})}),1e3)};(0,o.useEffect)((()=>(ape.on("updateOnlineCount",(e=>{X(e)})),()=>{ape.off("updateOnlineCount")})),[]);const ke=e=>{const t=Math.floor(e/60),n=e%60;return"".concat(t,":").concat(n.toString().padStart(2,"0"))};return(0,ga.jsxs)(ipe,{children:[(0,ga.jsx)(di,{theme:t}),(0,ga.jsxs)(ope,{children:[(0,ga.jsxs)("div",{className:"chat-container ".concat(s||u?"chat-active":""),children:[Q&&(0,ga.jsxs)("div",{className:"permission-message",children:[(0,ga.jsx)("h3",{children:"\u0420\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u0435 \u0434\u043e\u0441\u0442\u0443\u043f \u043a \u043a\u0430\u043c\u0435\u0440\u0435 \u0438 \u043c\u0438\u043a\u0440\u043e\u0444\u043e\u043d\u0443"}),(0,ga.jsx)("p",{children:'\u0414\u043b\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f \u0432\u0438\u0434\u0435\u043e\u0447\u0430\u0442\u0430 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c \u0434\u043e\u0441\u0442\u0443\u043f \u043a \u0432\u0430\u0448\u0435\u0439 \u043a\u0430\u043c\u0435\u0440\u0435 \u0438 \u043c\u0438\u043a\u0440\u043e\u0444\u043e\u043d\u0443. \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043d\u0430\u0436\u043c\u0438\u0442\u0435 "\u0420\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u044c" \u0432 \u0434\u0438\u0430\u043b\u043e\u0433\u043e\u0432\u043e\u043c \u043e\u043a\u043d\u0435 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0430.'}),(0,ga.jsxs)("div",{className:"permission-buttons",children:[(0,ga.jsx)("button",{className:"permission-button",onClick:ye,children:"\u0420\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f"}),(0,ga.jsx)("button",{className:"permission-button secondary",onClick:()=>window.location.reload(),children:"\u041f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443"})]}),V&&(0,ga.jsxs)("div",{className:"permission-error",children:[(0,ga.jsx)("p",{className:"permission-denied",children:V}),(0,ga.jsxs)("p",{className:"permission-help",children:["\u0427\u0442\u043e\u0431\u044b \u0440\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f:",(0,ga.jsx)("br",{}),"1. \u041d\u0430\u0436\u043c\u0438\u0442\u0435 \u043d\u0430 \u0437\u043d\u0430\u0447\u043e\u043a \ud83d\udd12 \u0441\u043b\u0435\u0432\u0430 \u043e\u0442 \u0430\u0434\u0440\u0435\u0441\u043d\u043e\u0439 \u0441\u0442\u0440\u043e\u043a\u0438",(0,ga.jsx)("br",{}),"2. \u041d\u0430\u0439\u0434\u0438\u0442\u0435 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u043a\u0430\u043c\u0435\u0440\u044b \u0438 \u043c\u0438\u043a\u0440\u043e\u0444\u043e\u043d\u0430",(0,ga.jsx)("br",{}),'3. \u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 "\u0420\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u044c"']})]})]}),D&&(0,ga.jsxs)("div",{className:"searching-animation",children:[(0,ga.jsxs)("div",{className:"connecting-lines",children:[(0,ga.jsx)("div",{className:"connecting-line"}),(0,ga.jsx)("div",{className:"connecting-line"}),(0,ga.jsx)("div",{className:"connecting-line"})]}),(0,ga.jsx)("div",{className:"roulette-wheel"}),(0,ga.jsx)("div",{className:"searching-text",children:"\u0418\u0449\u0435\u043c \u0441\u043e\u0431\u0435\u0441\u0435\u0434\u043d\u0438\u043a\u0430..."})]}),P&&(0,ga.jsx)("div",{className:"next-transition",children:(0,ga.jsx)("div",{className:"searching-text",children:"\u041f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0430\u0435\u043c..."})}),(0,ga.jsxs)("div",{className:"video-grid",children:[(0,ga.jsxs)("div",{className:"video-box",children:[(0,ga.jsxs)("div",{className:"video-wrapper",children:[(0,ga.jsx)("video",{ref:y,className:"video-stream",autoPlay:!0,muted:!0,playsInline:!0,style:{filter:me[M]}}),ne.maskUrl&&(0,ga.jsx)("img",{src:ne.maskUrl,alt:"mask",className:"video-mask"}),(0,ga.jsx)("div",{className:"user-label",children:"\u0412\u044b"}),(0,ga.jsx)($he,{videoRef:y,activeFilter:ae}),E&&(0,ga.jsx)("canvas",{ref:A,className:"drawing-canvas",width:"640",height:"480"})]}),(0,ga.jsxs)("div",{className:"video-controls",children:[(0,ga.jsx)("button",{onClick:xe,className:"control-btn",children:h?(0,ga.jsx)(Zd,{size:20}):(0,ga.jsx)(Jd,{size:20})}),(0,ga.jsx)("button",{onClick:we,className:"control-btn",children:g?(0,ga.jsx)(Kd,{size:20}):(0,ga.jsx)(qd,{size:20})}),(0,ga.jsx)("button",{onClick:Se,className:"control-btn",children:v?(0,ga.jsx)(th,{size:20}):(0,ga.jsx)(eh,{size:20})}),(0,ga.jsx)("button",{onClick:()=>se(!oe),className:"control-btn ".concat(oe?"active":""),children:(0,ga.jsx)(Qd,{size:20})}),(0,ga.jsx)("button",{onClick:ve,className:"control-btn",children:(0,ga.jsx)(Vr,{size:20})}),(0,ga.jsx)("button",{onClick:be,className:"control-btn ".concat(I?"active":""),children:(0,ga.jsx)(qr,{size:20})})]})]}),(0,ga.jsxs)("div",{className:"video-box",children:[(0,ga.jsx)("span",{className:"user-label",children:"\u0421\u043e\u0431\u0435\u0441\u0435\u0434\u043d\u0438\u043a"}),(0,ga.jsx)("span",{className:"chat-online-count",children:"connected"===W?ke(le):""}),"idle"===W?(0,ga.jsx)("div",{className:"video-placeholder",children:(0,ga.jsx)("span",{children:'\u041d\u0430\u0436\u043c\u0438\u0442\u0435 "\u0420\u0443\u043b\u0435\u0442\u0438\u043c" \u0447\u0442\u043e\u0431\u044b \u043d\u0430\u0447\u0430\u0442\u044c'})}):"connecting"===W?(0,ga.jsxs)("div",{className:"video-placeholder connecting",children:[(0,ga.jsx)(rh,{className:"loading-icon"}),(0,ga.jsx)("span",{children:"\u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u043a \u0441\u043e\u0431\u0435\u0441\u0435\u0434\u043d\u0438\u043a\u0443..."})]}):"failed"===W?(0,ga.jsxs)("div",{className:"video-placeholder error",children:[(0,ga.jsx)(nh,{className:"error-icon"}),(0,ga.jsx)("span",{children:V||"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f"}),(0,ga.jsx)("button",{onClick:Ie,className:"retry-button",children:"\u0421\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439 \u0441\u043e\u0431\u0435\u0441\u0435\u0434\u043d\u0438\u043a"})]}):(0,ga.jsx)("video",{ref:x,autoPlay:!0,playsInline:!0,className:"video-stream"})]})]}),oe&&(0,ga.jsx)(epe,{activeMask:ae,onMaskChange:e=>{console.log("Changing mask to:",e),ie(e)}}),(0,ga.jsxs)("div",{className:"control-buttons",children:[!s&&!u&&(0,ga.jsx)(ga.Fragment,{children:q?(0,ga.jsx)("button",{onClick:Ce,className:"btn-start",disabled:!S||u||s,children:S?"\u0420\u0443\u043b\u0435\u0442\u0438\u043c":"\u041e\u0436\u0438\u0434\u0430\u043d\u0438\u0435 \u043a\u0430\u043c\u0435\u0440\u044b..."}):(0,ga.jsx)("button",{onClick:ye,className:"btn-start",children:"\u0420\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f \u043a \u043a\u0430\u043c\u0435\u0440\u0435"})}),s&&(0,ga.jsxs)(ga.Fragment,{children:[(0,ga.jsx)("button",{onClick:Ie,className:"btn-next",children:"\u0421\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439"}),(0,ga.jsx)("button",{onClick:()=>{z&&(z.destroy(),j(null)),x.current&&(x.current.srcObject=null),B&&ape.emit("leaveRoom",{roomId:B}),c(!1),l(!1),r([]),G("idle"),ge(!1),fe(0),U(null)},className:"btn-end",children:"\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c"})]})]}),(0,ga.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),a.trim()&&s){let e=null;if(N){const t=/[\u0430-\u044f\u0410-\u042f]/.test(a);e=await(async(e,t)=>{try{const n="https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=".concat(t,"&dt=t&q=").concat(encodeURIComponent(e)),r=await fetch(n);return(await r.json())[0].map((e=>e[0])).join("")}catch(n){return console.error("Translation error:",n),e}})(a,t?"en":"ru")}const t={type:"text",text:a,translated:e},n=Ya(Ya({id:Date.now()},t),{},{sender:"you"});r((e=>[...e,n])),ape.emit("message",{roomId:B,message:t}),i("")}},className:"message-form",children:[(0,ga.jsxs)("div",{className:"messages-container",children:[n.map((e=>(0,ga.jsx)("div",{className:"message ".concat("you"===e.sender?"message-sent":"message-received"),children:"text"===e.type?(0,ga.jsxs)(ga.Fragment,{children:[e.text,e.translated&&(0,ga.jsx)("div",{className:"message-translation",children:e.translated})]}):"image"===e.type?(0,ga.jsx)("img",{src:e.content,alt:"shared",className:"shared-image"}):null},e.id))),(0,ga.jsx)("div",{ref:w})]}),(0,ga.jsxs)("div",{className:"input-wrapper",children:[(0,ga.jsx)("button",{type:"button",className:"emoji-button",onClick:()=>d(!f),children:(0,ga.jsx)(ea,{size:24})}),(0,ga.jsx)("button",{type:"button",className:"image-upload-button",onClick:()=>R.current.click(),children:(0,ga.jsx)(Yd,{size:24})}),(0,ga.jsx)("input",{ref:R,type:"file",accept:"image/*",onChange:e=>{const t=e.target.files[0];if(t&&t.type.startsWith("image/")){const e=new FileReader;e.onload=e=>{const t={type:"image",content:e.target.result},n=Ya(Ya({id:Date.now()},t),{},{sender:"you"});r((e=>[...e,n])),ape.emit("message",{roomId:B,message:t})},e.readAsDataURL(t)}},style:{display:"none"}}),(0,ga.jsx)("input",{type:"text",value:a,onChange:e=>i(e.target.value),placeholder:"\u041d\u0430\u043f\u0438\u0441\u0430\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435...",disabled:!s,className:"message-input"}),(0,ga.jsxs)("button",{type:"button",className:"translate-button ".concat(N?"active":""),onClick:()=>{L(!N),ue("en"===ce?"ru":"en")},children:[(0,ga.jsx)($d,{size:24}),(0,ga.jsx)("span",{className:"translate-lang",children:ce.toUpperCase()})]}),(0,ga.jsx)("button",{type:"submit",disabled:!s,className:"btn-send",children:(0,ga.jsx)(Xd,{size:24})})]}),f&&(0,ga.jsx)("div",{className:"emoji-picker-container",children:(0,ga.jsx)(Hd,{onEmojiClick:(e,t)=>{i((t=>t+e.emoji)),d(!1)}})})]}),pe&&(0,ga.jsx)("div",{className:"chat-timer",children:ke(le)})]}),!s&&!u&&(0,ga.jsx)(ki,{})]})]})};const cpe=function(){const[e,t]=(0,o.useState)("night"),[n,r]=(0,o.useState)(0);return(0,o.useEffect)((()=>{const e=()=>{r(Math.floor(1e3*Math.random())+500)};e();const t=setInterval(e,5e3);return()=>clearInterval(t)}),[]),(0,ga.jsxs)(Ir,{children:[(0,ga.jsx)(Ua,{currentTheme:e,onThemeChange:e=>{t(e)},onlineUsers:n}),(0,ga.jsxs)(Sr,{children:[(0,ga.jsx)(xr,{path:"/",element:(0,ga.jsx)(yo,{currentTheme:e,onlineUsers:n})}),(0,ga.jsx)(xr,{path:"/chat",element:(0,ga.jsx)(spe,{currentTheme:e})})]})]})};c.createRoot(document.getElementById("root")).render((0,ga.jsx)(o.StrictMode,{children:(0,ga.jsx)(Dt,{shouldComponentUpdate:!0,children:(0,ga.jsxs)(Ht,{theme:{colors:{primary:"#4169E1",secondary:"#FFD700",background:"#0F2027",text:"#FFFFFF"},fonts:{main:"'Roboto', sans-serif"},breakpoints:{mobile:"320px",tablet:"768px",desktop:"1024px"},transitions:{default:"0.3s ease"}},children:[(0,ga.jsx)(on,{}),(0,ga.jsx)(cpe,{})]})})}))})()})();
//# sourceMappingURL=main.36d72781.js.map